var apf={VERSION:"3.3beta",CDN:"",READY:false,NODE_HIDDEN:101,NODE_VISIBLE:102,NODE_O3:103,KEYBOARD:2,KEYBOARD_MOUSE:true,SUCCESS:1,TIMEOUT:2,ERROR:3,OFFLINE:4,debug:true,debugType:"Memory",debugFilter:"!teleport",includeStack:[],initialized:false,AppModules:[],autoLoadSkin:false,started:false,crypto:{},config:{},_GET:{},$asyncObjects:{"apf.oHttp":1,"apf.ajax":1},basePath:"./",ns:{apf:"http://ajax.org/2005/aml",aml:"http://ajax.org/2005/aml",xsd:"http://www.w3.org/2001/XMLSchema",xhtml:"http://www.w3.org/1999/xhtml",xslt:"http://www.w3.org/1999/XSL/Transform",xforms:"http://www.w3.org/2002/xforms",ev:"http://www.w3.org/2001/xml-events"},availHTTP:[],releaseHTTP:function(c){if(apf.brokenHttpAbort){return;}if(self.XMLHttpRequestUnSafe&&c.constructor==XMLHttpRequestUnSafe){return;}c.onreadystatechange=function(){};c.abort();this.availHTTP.push(c);},browserDetect:function(){if(this.$bdetect){return;}this.$bdetect=true;var k=navigator.userAgent.toLowerCase()||"";this.isOpera=(self.opera&&Object.prototype.toString.call(self.opera)=="[object Opera]");this.isKonqueror=k.indexOf("konqueror")!=-1;this.isSafari=/a/.__proto__=="//";this.isSafariOld=false;this.isIphone=k.indexOf("iphone")!=-1||k.indexOf("aspen simulator")!=-1;this.isChrome=Boolean(/source/.test((/a/.toString+"")))||k.indexOf("chrome")!=-1;this.isWebkit=this.isSafari||this.isChrome||this.isKonquerer;if(this.isWebkit){var i=k.match(/applewebkit\/(\d+)/);if(i){this.webkitRev=parseInt(i[1]);this.isSafariOld=parseInt(i[1])<420;}}this.isGecko=(function(n){n[n]=n+"";return n[n]!=n+"";})(new String("__count__"));this.isGecko3=this.isGecko&&(function c(){})[-5]=="x";this.isGecko35=this.isGecko&&(/a/[-1]&&Object.getPrototypeOf)?true:false;this.versionGecko=this.isGecko?parseFloat(k.match(/(?:gecko)\/([\d\.]+)/i)[1]):-1;this.versionFF=this.isGecko?parseFloat(k.match(/(?:firefox)\/([\d\.]+)/i)[1]):-1;var g;this.isIE=!+"\v1";if(this.isIE){this.isIE=parseFloat(k.match(/msie ([\d\.]*)/)[1]);}this.isIE8=this.isIE==8&&(g=true);this.isIE7=!g&&this.isIE==7&&(g=true);if(this.isIE==7&&document.documentMode==7){apf.isIE7=true;apf.isIE8=false;apf.isIE7Emulate=true;apf.isIE=7;}this.isIE6=!g&&this.isIE==6&&(g=true);var d=(navigator.platform.match(/mac|win|linux/i)||["other"])[0].toLowerCase();this.isWin=(d=="win");this.isMac=(d=="mac");this.isLinux=(d=="linux");this.isAIR=k.indexOf("adobeair")!=-1;try{}catch(j){this.isDeskrun=false;}},setCompatFlags:function(){this.TAGNAME=apf.isIE?"baseName":"localName";this.styleSheetRules=apf.isIE?"rules":"cssRules";this.brokenHttpAbort=apf.isIE6;this.canUseHtmlAsXml=apf.isIE;this.supportNamespaces=!apf.isIE;this.cannotSizeIframe=apf.isIE;this.hasConditionCompilation=apf.isIE;this.supportOverflowComponent=apf.isIE;this.hasEventSrcElement=apf.isIE;this.canHaveHtmlOverSelects=!apf.isIE6&&!apf.isIE5;this.hasInnerText=apf.isIE;this.hasMsRangeObject=apf.isIE;this.descPropJs=apf.isIE;this.hasClickFastBug=apf.isIE;this.hasExecScript=window.execScript?true:false;this.canDisableKeyCodes=apf.isIE;this.hasTextNodeWhiteSpaceBug=apf.isIE||apf.isIE>=8;this.hasCssUpdateScrollbarBug=apf.isIE;this.canUseInnerHtmlWithTables=!apf.isIE;this.hasSingleResizeEvent=!apf.isIE;this.hasStyleFilters=apf.isIE;this.supportOpacity=!apf.isIE;this.supportPng24=!apf.isIE6&&!apf.isIE5;this.cantParseXmlDefinition=apf.isIE50;this.hasDynamicItemList=!apf.isIE||apf.isIE>=7;this.canImportNode=apf.isIE;this.hasSingleRszEvent=!apf.isIE;this.hasXPathHtmlSupport=!apf.isIE;this.hasFocusBug=apf.isIE;this.hasReadyStateBug=apf.isIE50;this.dateSeparator=apf.isIE?"-":"/";this.canCreateStyleNode=!apf.isIE;this.supportFixedPosition=!apf.isIE||apf.isIE>=7;this.hasHtmlIdsInJs=apf.isIE&&apf.isIE<8||apf.isWebkit;this.needsCssPx=!apf.isIE;this.hasCSSChildOfSelector=!apf.isIE||apf.isIE>=8;this.styleAttrIsObj=apf.isIE<8;this.hasAutocompleteXulBug=apf.isGecko;this.loadsLocalFilesSync=apf.isIE||apf.isGecko;this.mouseEventBuffer=apf.isIE?20:6;this.hasComputedStyle=typeof document.defaultView!="undefined"&&typeof document.defaultView.getComputedStyle!="undefined";this.supportCSSAnim=apf.isWebkit&&(apf.webkitRev>525);this.w3cRange=Boolean(window.getSelection);this.locale=(apf.isIE?navigator.userLanguage:navigator.language).toLowerCase();this.characterSet=document.characterSet||document.defaultCharset||"utf-8";var k=document.createElement("div");this.hasContentEditable=(typeof k.contentEditable=="string"||typeof k.contentEditable=="boolean");var n=["transform","OTransform","KhtmlTransform","MozTransform","WebkitTransform"],q=["","O","Khtml","Moz","Webkit"],d=["","o-","khtml-","moz-","webkit-"],j=["transitionend","transitionend","transitionend","transitionend","webkitTransitionEnd"],g=0,c=5;this.supportCSSAnim=false;this.supportCSSTransition=false;for(;g<c&&!this.supportCSSAnim;++g){if(typeof k.style[n[g]]=="undefined"){continue;}this.supportCSSAnim=n[g];this.runtimeStylePrefix=q[g];this.classNamePrefix=d[g];this.cssAnimEvent=j[g];}k=null;delete k;this.supportVML=apf.isIE;this.supportSVG=!apf.isIE;this.hasHtml5XDomain=apf.versionGecko>=3.5;this.supportCanvas=!!document.createElement("canvas").getContext;this.supportCanvasText=!!(this.supportCanvas&&typeof document.createElement("canvas").getContext("2d").fillText=="function");this.hasVideo=!!document.createElement("video")["canPlayType"];this.hasAudio=!!document.createElement("audio")["canPlayType"];this.hasGeolocation=!!navigator.geolocation;this.supportHashChange=("onhashchange" in self)&&(!apf.isIE||apf.isIE>=8);this.windowHorBorder=this.windowVerBorder=apf.isIE8&&(!self.frameElement||parseInt(self.frameElement.frameBorder))?4:0;this.maxHttpRetries=apf.isOpera?0:3;this.percentageMatch=new RegExp();this.percentageMatch.compile("([\\-\\d\\.]+)\\%","g");this.reMatchXpath=new RegExp();this.reMatchXpath.compile("(^|\\|)(?!\\@|[\\w-]+::)","g");apf.isGears=!!apf.initGears()||0;},reboot:function(){apf.console.info("Restarting application...");location.href=location.href;},extend:function(d,j){var k,g,c=!d.notNull;if(arguments.length==2){for(k in j){if(c||j[k]){d[k]=j[k];}}return d;}for(g=1;g<arguments.length;g++){j=arguments[g];for(k in j){if(c||j[k]){d[k]=j[k];}}}return d;},$extend:function(c,d){for(var g in d){c[g]=d[g];}return c;},ajax:(function(){var c=function(){return this.oHttp.get.apply(this.oHttp,arguments);};c.exec=function(k,g,j,d){if(k=="ajax"&&g[0]){var i=g[1]||{};return this.oHttp.exec(i.method||"GET",[g[0]],i.callback,apf.extend(d||{},i));}};return c;})(),start:function(){this.started=true;var d=location.href.split("#")[0].split("?")[0];this.host=location.hostname&&d.replace(/(\/\/[^\/]*)\/.*$/,"$1");this.hostPath=d.replace(/\/[^\/]*$/,"")+"/";apf.console.info("Starting Ajax.org Platform Application...");apf.console.warn("Debug build of Ajax.org Platform "+(apf.VERSION?"version "+apf.VERSION:""));this.setCompatFlags();apf.$debugwin.start();if(this.isIE){apf.runIE();}if(apf.isWebkit){apf.runWebkit();}if(this.isOpera){apf.runOpera();}if(this.isGecko||!this.isIE&&!apf.isWebkit&&!this.isOpera){apf.runGecko();}this.oHttp=new this.http();this.Init.addConditional(this.parseAppMarkup,apf,["body"]);try{if(apf.isIE){document.execCommand("BackgroundImageCache",false,true);}}catch(g){}this.started=true;if(this.load_done){this.execDeferred();}this.root=true;for(var c=0;c<apf.$required.length;c++){apf.include(apf.$required[c]);}apf.require=apf.include;},nsqueue:{},findPrefix:function(d,j){var g;if(d.nodeType==9){if(!d.documentElement){return false;}if(d.documentElement.namespaceURI==j){return d.prefix||d.scopeName;}g=d.documentElement;}else{if(d.namespaceURI==j){return d.prefix||d.scopeName;}g=d.ownerDocument.documentElement;if(g&&g.namespaceURI==j){return d.prefix||d.scopeName;}while(d.parentNode){d=d.parentNode;if(d.namespaceURI==j){return d.prefix||d.scopeName;}}}if(g){for(var c=0;c<g.attributes.length;c++){if(g.attributes[c].nodeValue==j){return g.attributes[c][apf.TAGNAME];}}}return false;},importClass:function(d,c,i){if(!d){throw new Error(apf.formatErrorString(1018,null,"importing class","Could not load reference. Reference is null"));}if(!c){return apf.jsexec(d.toString(),i);}var g=d.toString().replace(/^\s*function\s*\w*\s*\([^\)]*\)\s*\{/,"").replace(/\}\s*$/,"");return apf.jsexec(g,i);},toString:function(){return"[Ajax.org Platform (apf)]";},all:[],implement:function(g){if(arguments.length==1){if(!g){throw new Error(apf.formatErrorString(0,this,"Implementing class","Could not implement from '"+g[j]+"'",this));}g.call(this);}else{for(var d,j=0,c=arguments.length;j<c;j++){d=arguments[j];if(!d){throw new Error(apf.formatErrorString(0,this,"Implementing class","Could not implement from '"+arguments[j]+"'",this));}arguments[j].call(this);}}return this;},uniqueHtmlIds:0,setUniqueHtmlId:function(c){var d;c.setAttribute("id",d="q"+this.uniqueHtmlIds++);return d;},getUniqueId:function(){return this.uniqueHtmlIds++;},lookup:function(c){return this.all[c];},findHost:function(d){while(d&&d.parentNode){try{if(d.host){break;}}catch(c){}d=d.parentNode;}return(d&&d.host&&typeof d.host!="string")?d.host:false;},setReference:function(c,d){return self[c]&&self[c].hasFeature?0:(self[c]=d);},console:{data:{time:{messages:{}},log:{messages:{}},custom:{messages:{}},warn:{messages:{}},error:{messages:{}},repeat:{messages:{}}},toggle:function(g,j){var c=apf.$debugwin?apf.$debugwin.resPath:apf.basePath+"core/debug/resources/";if(g.style.display=="block"){g.style.display="none";g.parentNode.style.backgroundImage="url("+c+"splus.gif)";g.innerHTML="";}else{g.style.display="block";g.parentNode.style.backgroundImage="url("+c+"smin.gif)";g.innerHTML=this.cache[j].replace(/\&/g,"&amp;").replace(/\t/g,"&nbsp;&nbsp;&nbsp;").replace(/ /g,"&nbsp;").replace(/\</g,"&lt;").replace(/\n/g,"<br />");var i=g.parentNode.parentNode.parentNode,d=g.parentNode.parentNode;if(i.scrollTop+i.offsetHeight<d.offsetTop+d.offsetHeight){i.scrollTop=d.offsetTop+d.offsetHeight-i.offsetHeight;}}},cache:[],history:[],typeLut:{time:"log",repeat:"log"},$lastmsg:"",$lastmsgcount:0,$detectSameMessage:function(){apf.console.$lastmsg="";if(apf.console.$lastmsgcount){var c=apf.console.$lastmsgcount+" times the same message";apf.console.$lastmsgcount=0;apf.console.write(c,"repeat");clearTimeout(apf.console.$timer);}},teleportList:[],teleport:function(c){if(this.teleportModel){c.setXml(this.teleportModel.data);}this.teleportList.push(c);},setTeleportModel:function(g){if(this.teleportModel==g){return;}this.teleportModel=g;var c=apf.getXml("<teleport />");for(var d=0;d<this.teleportList.length;d++){this.teleportList[d].setXml(c);}g.load(c);},write:function(g,t,q,n,s,k){clearTimeout(this.$timer);if(g==this.$lastmsg){this.$lastmsgcount++;this.$timer=$setTimeout(this.$detectSameMessage,1000);return;}this.$detectSameMessage();this.$lastmsg=g;this.$timer=$setTimeout(this.$detectSameMessage,1000);if(!Number.prototype.toPrettyDigit){Number.prototype.toPrettyDigit=function(){var u=this.toString();return(u.length==1)?"0"+u:u;};}var d=new Date(),c=String(d.getMilliseconds());while(c.length<3){c+="0";}var i=d.getHours().toPrettyDigit()+":"+d.getMinutes().toPrettyDigit()+":"+d.getSeconds().toPrettyDigit()+"."+c;g=(!k?"<span class='console_date'>["+i+"]</span> ":"")+String(g).replace(/(<[^>]+>)| /g,function(w,u,A){if(u){return u;}return"&nbsp;";}).replace(/\t/g,"&nbsp;&nbsp;&nbsp;");var j=apf.$debugwin&&apf.$debugwin.resPath?apf.$debugwin.resPath:apf.basePath+"core/debug/resources/";if(n){g+="<blockquote style='margin:2px 0 0 0;background:url("+j+"splus.gif) no-repeat 2px 3px'><strong style='width:120px;cursor:default;display:block;padding:0 0 0 17px' onmousedown='(self.apf || window.opener.apf).console.toggle(this.nextSibling, "+(this.cache.push(n)-1)+")'>More information</strong><div style='display:none;background-color:#EEEEEE;padding:3px 3px 20px 3px;overflow:auto;max-height:200px'></div></blockquote>";}g="<div class='console_line console_"+t+"' >"+g+"</div>";if(!q){q="default";}this.history.push([this.typeLut[t]||t,g]);if(this.win&&!this.win.closed){this.showWindow(g);}this.debugInfo.push(g);if(apf.dispatchEvent){apf.dispatchEvent("debug",{message:g,type:t});}},clear:function(){this.history=[];},getAll:function(n,j,k){var q={error:n,warn:j,log:k,custom:1};var d=[];for(var g=0,c=this.history.length;g<c;g++){if(q[this.history[g][0]]){d.push(this.history[g][1]);}}return d.join("");},debug:function(g,c,d){this.write(g,"time",c,d);},time:function(g,c,d){this.write(g,"time",c,d);},log:function(g,c,d){this.write(apf.htmlentities(g).replace(/\n/g,"<br />"),"log",c,d);},info:function(g,c,d){this.log(apf.htmlentities(g).replace(/\n/g,"<br />"),c,d);},warn:function(g,c,d){this.write(apf.htmlentities(g).replace(/\n/g,"<br />"),"warn",c,d);},error:function(g,c,d){this.write(g.replace(/\n/g,"<br />"),"error",c,d);},dir:function(d){var c=apf.$debugwin.$serializeObject(d,"Inspected via apf.console.dir");if(typeof c=="string"){this.write(c,"custom",null,null,null,true);}else{this.write(d?"Could not serialize object: "+c.message:d,"error",null,null,null,true);}},debugInfo:[],debugType:"",showWindow:function(c){if(!this.win||this.win.closed){this.win=window.open("","debug");this.win.document.write('<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><body style="margin:0;font-family:Verdana;font-size:8pt;"></body>');}if(!this.win){if(!this.haspopupkiller){alert("Could not open debug window, please check your popupkiller");}this.haspopupkiller=true;}else{this.win.document.write((c||this.debugInfo.join("")).replace(/\{imgpath\}/g,apf.debugwin?apf.debugwin.resPath:apf.basePath+"core/debug/resources/"));}}},htmlentities:function(c){return c;},formatErrorString:function(k,q,g,B,n,d,i){var s=[];if(n&&n.ownerDocument){if(n.nodeType==9){n=n.documentElement;}if(n.ownerDocument.documentElement){var j=n.ownerDocument.documentElement.getAttribute("filename");if(!j&&n.ownerDocument.documentElement.tagName=="html"){j=location.href;}j=j?apf.removePathContext(apf.hostPath,j):"Unkown filename";}else{j="Unknown filename";}if(apf.$debugwin){var A=apf.$debugwin.$serializeObject(n);}else{var A=(n.outerHTML||n.xml||n.serialize()).replace(/\<\?xml\:namespace prefix = j ns = "http\:\/\/ajax.org\/2005\/aml" \/\>/g,"").replace(/xmlns:a="[^"]*"\s*/g,"");}var u,c=0,t=n.previousSibling||n.parentNode&&n.parentNode.previousSibling;while(t&&t[apf.TAGNAME]!="body"){u=(t.outerHTML||t.xml||t.serialize()).split("\n").length;c+=u-1;t=t.previousSibling||t.parentNode&&t.parentNode.previousSibling;}if(t&&t[apf.TAGNAME]!="body"){c="unknown";}else{if(n.ownerDocument&&n.ownerDocument.documentElement.tagName=="html"){c+=apf.lineBodyStart;}}s.push("aml file: [line: "+c+"] "+j);}if(q){s.push("Element: "+(apf.$debugwin&&!apf.isDebugWindow?apf.$debugwin.$serializeObject(q):"'"+(q.name||(q.$aml?q.getAttribute("id"):null)||"{Anonymous}")+"' ["+q.tagName+"]"));}if(g){s.push("Process: "+g.replace(/ +/g," "));}if(B){s.push("Message: ["+k+"] "+B.replace(/ +/g," "));}if(d){s.push(d+": "+i);}if(n&&A){s.push("Related Markup: "+A);}return(apf.lastErrorMessage=s.join("\n"));},getDirname:function(c){return((c||"").match(/^([^#]*\/)[^\/]*(?:$|\#)/)||{})[1];},getFilename:function(c){return((c||"").split("?")[0].match(/(?:\/|^)([^\/]+)$/)||{})[1];},getAbsolutePath:function(d,c){return c.charAt(0)=="/"?c:(!c||!d||c.match(/^\w+\:\/\//)?c:d.replace(/\/$/,"")+"/"+c.replace(/^\//,""));},include:function(i,c,k,n){if(apf.started){apf.console.info("including js file: "+i);}var d=c?apf.getAbsolutePath(apf.basePath||"",i):i;var j=document.getElementsByTagName("head")[0],g=document.createElement("script");if(k){g.setAttribute("_apf_type",k);}if(n){g.text=n;}else{g.src=d;}j.appendChild(g);return g;},$required:[],require:function(){var d=apf.getDirname(location.href),g=0,c=arguments.length;for(;g<c;g++){this.$required.push(apf.getAbsolutePath(d,arguments[g]));}},Init:{queue:[],cond:{combined:[]},done:{},add:function(c,d){if(this.inited){c.call(d);}else{if(c){this.queue.push([c,d]);}}},addConditional:function(d,g,c){if(typeof c!="string"){if(this.checkCombined(c)){return d.call(g);}this.cond.combined.push([d,g,c]);}else{if(self[c]){d.call(g);}else{if(!this.cond[c]){this.cond[c]=[];}this.cond[c].push([d,g]);this.checkAllCombined();}}},checkAllCombined:function(){for(var c=0;c<this.cond.combined.length;c++){if(!this.cond.combined[c]){continue;}if(this.checkCombined(this.cond.combined[c][2])){this.cond.combined[c][0].call(this.cond.combined[c][1]);this.cond.combined[c]=null;}}},checkCombined:function(c){for(var d=0;d<c.length;d++){if(!this.done[c[d]]){return false;}}return true;},run:function(c){this.inited=this.done[c]=true;this.checkAllCombined();var g=c?this.cond[c]:this.queue;if(!g){return;}for(var d=0;d<g.length;d++){g[d][0].call(g[d][1]);}}},parseStrategy:0,parseAppMarkup:function(c){var d=false;if(d&&document.documentElement.outerHTML.split(">",1)[0].indexOf(apf.ns.aml)==-1){apf.console.warn("The aml namespace declaration wasn't found. No aml elements were found in the body. Exiting");return false;}if(this.parseStrategy==21||!this.parseStrategy&&!c){return apf.oHttp.get((apf.alternativeAml||document.body&&document.body.getAttribute("xmlurl")||location.href).split(/#/)[0],{type:"markup",callback:function(q,n,g){if(n!=apf.SUCCESS){var t=new Error(apf.formatErrorString(0,null,"Loading XML application data","Could not load XML from remote source: "+g.message));if(g.tpModule.retryTimeout(g,n,null,t)===true){return true;}throw t;}apf.lineBodyStart=(q.replace(/\n/g,"\\n").match(/(.*)<body/)||[""])[0].split("\\n").length;var s=q.replace(/\<\!DOCTYPE[^>]*>/,"").replace(/^[\r\n\s]*/,"");if(!apf.supportNamespaces){s=s.replace(/xmlns\=\"[^"]*\"/g,"");}if(self.ERROR_HAS_OCCURRED){return;}if(apf.isIE){document.body.innerHTML="";}else{var j=document.body.childNodes;for(var k=j.length-1;k>=0;k--){j[k].parentNode.removeChild(j[k]);}}document.documentElement.style.display="block";document.body.style.display="block";apf.initialize(s);},ignoreOffline:true});}else{document.body.style.display="block";if(!self.ERROR_HAS_OCCURRED){apf.initialize(c.outerHTML||c.xml);}}},namespaces:{},setNamespace:function(c,d){this.namespaces[c]=d;d.namespaceURI=c;},initialize:function(d){if(apf.initialized){return;}apf.initialized=true;apf.console.info("Initializing...");clearInterval(apf.Init.interval);apf.Init.run();var c=parseFloat(apf.getStyle(document.body,"marginTop"));apf.doesNotIncludeMarginInBodyOffset=(document.body.offsetTop!==c);apf.window.init(d);},execDeferred:function(){var c=apf.load_events.length;while(c--){(apf.load_events.shift())();}},load_events:[],load_timer:null,load_done:false,load_init:null,addDomLoadEvent:function(n){if(!this.$bdetect){this.browserDetect();}if(apf.load_done){return n();}if(!apf.load_init){apf.load_init=function(){if(apf.load_done){return;}clearInterval(apf.load_timer);apf.load_timer=null;apf.load_done=true;if(apf.started){apf.execDeferred();}};}apf.load_events.push(n);if(n&&apf.load_events.length==1){var q=document,g="undefined";if((typeof q.readyState!=g&&q.readyState=="complete")||(typeof q.readyState==g&&(q.getElementsByTagName("body")[0]||q.body))){return apf.load_init();}if(q.addEventListener&&!apf.isOpera){window.addEventListener("DOMContentLoaded",apf.load_init,false);}else{if(apf.isIE&&window==top){apf.load_timer=setInterval(function(){try{q.documentElement.doScroll("left");}catch(i){$setTimeout(arguments.callee,0);return;}apf.load_init();},10);}else{if(apf.isOpera){q.addEventListener("DOMContentLoaded",function(){apf.load_timer=setInterval(function(){for(var t=0,s=q.styleSheets.length;t<s;t++){if(q.styleSheets[t].disabled){return;}}apf.load_init();},10);},false);}else{if(apf.isWebkit&&!apf.isIphone){var k=q.getElementsByTagName("link"),d=k.length,j;for(;d>=0;d++){if(!k[d]||k[d].getAttribute("rel")!="stylesheet"){k.splice(d,0);}}j=k.length;apf.load_timer=setInterval(function(){if(/loaded|complete/.test(q.readyState)&&q.styleSheets.length==j){apf.load_init();}},10);}else{var c=window.onload;window.onload=function(){apf.load_init();if(c){c();}};}}}}}},addListener:function(g,d,c){if(g.addEventListener){g.addEventListener(d,c,false);}else{if(g.attachEvent){g.attachEvent("on"+d,c);}}return this;},removeListener:function(g,d,c){if(g.removeEventListener){g.removeEventListener(d,c,false);}else{if(g.detachEvent){g.detachEvent("on"+d,c);}}return this;},stopEvent:function(c){this.stopPropagation(c).preventDefault(c);return false;},stopPropagation:function(c){if(c.stopPropagation){c.stopPropagation();}else{c.cancelBubble=true;}return this;},preventDefault:function(c){if(c.preventDefault){c.preventDefault();}else{c.returnValue=false;}return this;},unload:function(d){apf.console.info("Initiating self destruct...");this.isDestroying=true;this.popup.destroy();var j,g=0,c=this.all.length;for(;g<c;g++){j=this.all[g];if(j&&j!=d&&j.destroy&&!j.apf){j.destroy(false);}}for(g=0,c=this.availHTTP.length;g<c;g++){this.availHTTP[g]=null;}this.availHTTP.length=0;if(apf.xmldb){apf.xmldb.unbind(apf.window);}this.isDestroying=false;}};var $xmlns=function(d,c,i,g){if(!apf.supportNamespaces){if(!g){g=apf.findPrefix(d,i);}if(d.style||d==document){return d.getElementsByTagName(c);}else{if(g){(d.nodeType==9?d:d.ownerDocument).setProperty("SelectionNamespaces","xmlns:"+g+"='"+i+"'");}return d.selectNodes(".//"+(g?g+":":"")+c);}}return d.getElementsByTagNameNS(i,c);};var $setTimeout=setTimeout;var $setInterval=setInterval;apf.setTimeout=function(d,c){apf.eventDepth++;return $setTimeout(function(){d();if(--apf.eventDepth==0){apf.queue.empty();}},c);};document.documentElement.className+=" has_apf";document.documentElement.style.display="none";apf.browserDetect();apf.Init.run("apf");apf.Class=function(){};apf.Class.prototype=new (function(){var FUN="function",OBJ="object",UNDEF="undefined",SEL="model",PROP="prop.",MODEL="model",VALUE="value";this.$regbase=0;this.hasFeature=function(test){return this.$regbase&test;};this.$initStack=[];this.$bufferEvents=[];this.$init=function(callback,nodeFunc,struct){if(typeof callback==FUN||callback===true){this.$bufferEvents=this.$bufferEvents.slice();if(callback===true){return this;}this.$initStack=this.$initStack.slice();this.$initStack.push(callback);return this;}this.addEventListener=realAddEventListener;this.$removalQueue=[];if(this.nodeType!=2){this.$uniqueId=apf.all.push(this)-1;}this.$captureStack={};this.$eventsStack={};this.$funcHandlers={};var i=0,l=this.$initStack.length;for(;i<l;i++){this.$initStack[i].apply(this,arguments);}for(i=0,l=this.$bufferEvents.length;i<l;i++){this.addEventListener.apply(this,this.$bufferEvents[i]);}delete realAddEventListener;delete this.$initStack;delete this.$bufferEvents;if(struct&&struct.htmlNode){this.$pHtmlNode=struct.htmlNode;this.ownerDocument.$domParser.$continueParsing(this);apf.queue.empty();}return this;};this.implement=apf.implement;this.$handlePropSet=function(prop,value){this[prop]=value;};this.$bindProperty=function(myProp,bObject,bProp,fParsed){if(!fParsed){return bObject.$handlePropSet(bProp,this[myProp]);}var eventName=PROP+myProp,eFunc,isBeingCalled,isLang;(this.$eventsStack[eventName]||(this.$eventsStack[eventName]=[])).push(eFunc=function(e){if(isBeingCalled){return;}isBeingCalled=true;try{if(fParsed.asyncs){return fParsed.call(bObject,bObject.xmlRoot,function(value){bObject.setProperty(bProp,value,true,false,10);isBeingCalled=false;});}else{var value=fParsed.call(bObject,bObject.xmlRoot);}}catch(e){apf.console.warn("[331] Could not execute binding for property "+bProp+"\n\n"+e.message);isBeingCalled=false;return;}bObject.setProperty(bProp,value,true,false,10);isBeingCalled=false;});return eFunc;};this.$attrExcludePropBind=false;this.$setDynamicProperty=function(prop,pValue){var exclNr=this.$attrExcludePropBind[prop],options;if(SEL.indexOf(prop)>-1||exclNr==3){options={xpathmode:2};}else{if(exclNr==2){options={nostring:true};}else{if(exclNr===0){options={parsecode:true,nothrow:this.target.match(/-debug$/)?true:false};}}}if(apf.config.debugLm){(options||(options={})).nothrow=true;}if(pValue&&pValue.dataType==apf.FUNCTION){var fParsed=pValue;pValue="";}else{var fParsed=apf.lm.compile(pValue,options);}if(prop==MODEL){(this.$modelParsed=fParsed).instruction=pValue;}else{if(exclNr===0){this.$lastFParsed=fParsed;}}if(fParsed.type==2){this[prop]=!pValue;return this.setProperty(prop,fParsed.str);}if(exclNr==2||fParsed.xpaths.length&&exclNr!=1){if(!this.hasFeature(apf.__DATABINDING__)){this.implement(apf.StandardBinding);}this.$addAttrBind(prop,fParsed,pValue);}var matches=exclNr&&exclNr!=3&&prop!=MODEL?{}:fParsed.props,found=false,_self=this,o,node,bProp,p;for(p in matches){o=p.split(".");if(o.length>2){bProp=o.pop();try{node=eval(o.join("."));}catch(e){if(arguments[2]){apf.console.warn("[287] Could not execute binding test : "+pValue.replace(/</g,"&lt;")+"\n\n"+e.message);}else{apf.queue.add(prop+":"+this.$uniqueId,function(){_self.$clearDynamicProperty(prop);_self.$setDynamicProperty(prop,pValue,true);});}continue;}if(!node||typeof node!=OBJ||(!node.$regbase&&node.$regbase!==0)){bProp=o[1];node=self[o[0]];}else{o.push(bProp);}}else{bProp=o[1];node=self[o[0]]||o[0]=="this"&&this;}if(!node){if(arguments[2]){apf.console.warn("[287] Could not execute binding test : "+pValue.replace(/</g,"&lt;")+"\n\n"+o[0]+" does not exist");}else{apf.queue.add(prop+":"+this.$uniqueId,function(){_self.$clearDynamicProperty(prop);_self.$setDynamicProperty(prop,pValue,true);});return;}}if(!node.$bindProperty){continue;}if(!this.$funcHandlers[prop]){this.$funcHandlers[prop]=[];}this.$funcHandlers[prop].push({amlNode:node,prop:bProp,handler:node.$bindProperty(bProp,this,prop,fParsed)});found=true;}if(found){this.$funcHandlers[prop][0].handler({initial:true});}else{if(exclNr){return this.setProperty(prop,pValue);}try{if(fParsed.asyncs){return fParsed.call(this,this.xmlRoot,function(value){_self.setProperty(prop,value,true);});}else{var value=fParsed.call(this,this.xmlRoot);}}catch(e){apf.console.warn("[331] Could not execute binding test or: "+pValue.replace(/</g,"&lt;")+"\n\n"+e.message);return;}this[prop]=!value;this.setProperty(prop,value,true);}};this.$clearDynamicProperty=function(prop){if(this.$removeAttrBind){this.$removeAttrBind(prop);}if(prop==MODEL){this.$modelParsed=null;}var f,i,l,h=this.$funcHandlers[prop];if(h&&typeof h!=FUN){for(i=0,l=h.length;i<l;i++){(f=h[i]).amlNode.removeEventListener(PROP+f.prop,f.handler);}delete this.$funcHandlers[prop];}};this.watch=function(propName,callback){var eventName=PROP+propName,wrapper=function(e){callback.call(this,propName,e.oldvalue,e.value);};wrapper.callback=callback;(this.$eventsStack[eventName]||(this.$eventsStack[eventName]=[])).push(wrapper);};this.unwatch=function(propName,callback){var list,eventName=PROP+propName;if(!(list=this.$eventsStack[eventName])){return;}for(var i=0,l=list.length;i<l;i++){if(list[i].callback==callback){list.remove(i);return;}}};this.getAvailableProperties=function(){return this.$supportedProperties.slice();};this.setProperty=function(prop,value,forceOnMe,setAttr,inherited){var s,r,arr,e,i,l,oldvalue=this[prop],isChanged=(typeof value==OBJ)?value!=(typeof oldvalue==OBJ?oldvalue:null):String(oldvalue)!==String(value),eventName=PROP+prop;if(isChanged){if(!forceOnMe){if(this.xmlRoot&&typeof value!=OBJ&&(!(s=this.$attrExcludePropBind[prop]))&&(r=(this.$attrBindings&&this.$attrBindings[prop]||prop!=VALUE&&this.$bindings[prop]&&this.$bindings[prop][0]))){if(r.cvalue.type==3){return apf.setNodeValue(this.$getDataNode(prop.toLowerCase(),this.xmlRoot,true),value,true);}}}if(this.$handlePropSet(prop,value,forceOnMe)===false){return;}value=this[prop];if(setAttr){this.setAttribute(prop,value,true);}}if(arr=this.$eventsStack[eventName]){if(this.dispatchEvent(eventName,{prop:prop,value:value,oldvalue:oldvalue})===false){e.returnValue=false;}}if((aci||(aci=apf.config.$inheritProperties))[prop]&&this.$amlLoaded){if(inherited!=10&&!value){delete this.$inheritProperties[prop];if(this.$setInheritedAttribute(prop)){return;}}else{if(inherited!=10){this.$inheritProperties[prop]=inherited||-1;}}if((!e||e.returnValue!==false)&&this.childNodes){(function recur(nodes){var i,l,node,n;for(i=0,l=nodes.length;i<l;i++){node=nodes[i];if(node.nodeType!=1){continue;}if(!(n=node.$inheritProperties[prop])){recur(node.childNodes);}else{if(n>0){node.setProperty(prop,value,false,false,2);}}}})(this.childNodes);}}return value;};var aci;this.getProperty=function(prop){return this[prop];};apf.eventDepth=0;this.eventDepth=0;this.dispatchEvent=function(eventName,options,e){var arr,result,rValue,i,l;apf.eventDepth++;this.eventDepth++;e=options&&options.name?options:e;if(options&&!options.bubbles&&options.currentTarget&&options.currentTarget!=this){throw new Error("Invalid use of options detected in dispatch Event");}if((!e||!e.currentTarget)&&(!options||!options.currentTarget)){if(!(options||(options={})).currentTarget){options.currentTarget=this;}if(arr=this.$captureStack[eventName]){for(i=0,l=arr.length;i<l;i++){rValue=arr[i].call(this,e||(e=new apf.AmlEvent(eventName,options)));if(typeof rValue!=UNDEF){result=rValue;}}}}if(options&&options.captureOnly){return e&&typeof e.returnValue!=UNDEF?e.returnValue:result;}else{if(this["on"+eventName]){result=this["on"+eventName].call(this,e||(e=new apf.AmlEvent(eventName,options)));}if(arr=this.$eventsStack[eventName]){for(i=0,l=arr.length;i<l;i++){if(!arr[i]){continue;}rValue=arr[i].call(this,e||(e=new apf.AmlEvent(eventName,options)));if(typeof rValue!=UNDEF){result=rValue;}}}}var p;while(this.$removalQueue.length){p=this.$removalQueue.shift();p[0].remove(p[1]);}if((e&&e.bubbles&&!e.cancelBubble||!e&&options&&options.bubbles)&&this!=apf){rValue=(this.parentNode||this.ownerElement||apf).dispatchEvent(eventName,options,e);if(typeof rValue!=UNDEF){result=rValue;}}if(--apf.eventDepth==0&&this.ownerDocument&&!this.ownerDocument.$domParser.$parseContext&&!apf.isDestroying&&eventName!="debug"&&apf.queue){apf.queue.empty();}this.eventDepth--;delete options.currentTarget;return e&&typeof e.returnValue!=UNDEF?e.returnValue:result;};this.addEventListener=function(a,b,c){this.$bufferEvents.push([a,b,c]);};var realAddEventListener=function(eventName,callback,useCapture){if(eventName.substr(0,2)=="on"){eventName=eventName.substr(2);}var s,stack=useCapture?this.$captureStack:this.$eventsStack;if(!(s=stack[eventName])){s=stack[eventName]=[];}if(s.indexOf(callback)==-1){s.unshift(callback);}for(var i=this.$removalQueue.length-1;i>=0;i--){if(this.$removalQueue[i][0]==s&&this.$removalQueue[i][1]==callback){this.$removalQueue.removeIndex(i);}}var f;if(f=this.$eventsStack["$event."+eventName]){f[0].call(this,callback);}};this.removeEventListener=function(eventName,callback,useCapture){var stack=(useCapture?this.$captureStack:this.$eventsStack)[eventName];if(stack){if(this.eventDepth){this.$removalQueue.push([stack,callback]);}else{stack.remove(callback);}}};this.hasEventListener=function(eventName){return(this.$eventsStack[eventName]&&this.$eventsStack[eventName].length>0);};this.destroy=function(deep,clean){if(typeof this.$uniqueId==UNDEF&&this.nodeType!=2){return;}this.$amlLoaded=false;this.$amlDestroyed=true;if(this.$destroy){this.$destroy();}this.dispatchEvent("DOMNodeRemoved",{bubbles:!apf.isDestroying});this.dispatchEvent("DOMNodeRemovedFromDocument");apf.all[this.$uniqueId]=undefined;if(!this.nodeFunc&&this.nodeType!=2){try{if(this.id||this.name){self[this.id||this.name]=null;}}catch(ex){}return;}if(this.$ext&&!this.$ext.isNative&&this.$ext.nodeType==1&&this.localName!="a"){this.$ext.oncontextmenu=this.$ext.host=null;if(clean){if(this.localName!="collection"){this.$ext.parentNode.removeChild(this.$ext);}}}if(this.$int&&!this.$int.isNative&&this.$int.nodeType==1&&this.localName!="a"){this.$int.host=null;}this.$aml=null;if(deep&&this.childNodes){var nodes=this.childNodes;for(i=nodes.length-1;i>=0;i--){if(nodes[i].destroy){nodes[i].destroy(true,clean&&this.localName=="collection");}}this.childNodes=null;}if(this.parentNode&&this.removeNode){this.removeNode();}else{if(this.ownerElement&&!this.ownerElement.$amlDestroyed){this.ownerElement.removeAttributeNode(this);}}if(this.$focussable&&this.focussable){apf.window.$removeFocus(this);}if(this.attributes){var attr=this.attributes;for(var i=attr.length-1;i>=0;i--){this.$clearDynamicProperty(attr[i].nodeName);attr[i].destroy();}}if(deep!==false&&this.childNodes&&this.childNodes.length){apf.console.warn("You have destroyed an Aml Node without destroying it's children. Please be aware that if you don't maintain a reference, memory might leak");}try{if(this.id||this.name){self[this.id||this.name]=null;}}catch(ex){}apf.nameserver.remove(this.localName,this);};})();apf.extend(apf,new apf.Class().$init());apf.Init.run("class");apf.color={colors:{aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgrey:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},fixHSB:function(c){return{h:Math.min(360,Math.max(0,c.h)),s:Math.min(100,Math.max(0,c.s)),b:Math.min(100,Math.max(0,c.b))};},fixRGB:function(c){return{r:Math.min(255,Math.max(0,c.r)),g:Math.min(255,Math.max(0,c.g)),b:Math.min(255,Math.max(0,c.b))};},fixHex:function(g){var c=6-g.length;if(c>0){var j=[],d=0;for(;d<c;d++){j.push("0");}j.push(g);g=j.join("");}return g;},hexToRGB:function(c){c=parseInt(((c.indexOf("#")>-1)?c.substring(1):c),16);return{r:c>>16,g:(c&65280)>>8,b:(c&255)};},hexToHSB:function(c){return this.RGBToHSB(this.hexToRGB(c));},RGBToHSB:function(g){var d={h:0,s:0,b:0};var i=Math.min(g.r,g.g,g.b),c=Math.max(g.r,g.g,g.b),j=c-i;d.b=c;if(c!=0){}d.s=c!=0?255*j/c:0;if(d.s!=0){if(g.r==c){d.h=(g.g-g.b)/j;}else{if(g.g==c){d.h=2+(g.b-g.r)/j;}else{d.h=4+(g.r-g.g)/j;}}}else{d.h=-1;}d.h*=60;if(d.h<0){d.h+=360;}d.s*=100/255;d.b*=100/255;return d;},HSBToRGB:function(c){var g={},n=Math.round(c.h),k=Math.round(c.s*255/100),d=Math.round(c.b*255/100);if(k==0){g.r=g.g=g.b=d;}else{var q=d,j=(255-k)*d/255,i=(q-j)*(n%60)/60;if(n==360){n=0;}if(n<60){g.r=q,g.b=j,g.g=j+i;}else{if(n<120){g.g=q,g.b=j,g.r=q-i;}else{if(n<180){g.g=q,g.r=j,g.b=j+i;}else{if(n<240){g.b=q,g.r=j,g.g=q-i;}else{if(n<300){g.b=q,g.g=j,g.r=j+i;}else{if(n<360){g.r=q,g.g=j,g.b=q-i;}else{g.r=0,g.g=0,g.b=0;}}}}}}}return{r:Math.round(g.r),g:Math.round(g.g),b:Math.round(g.b)};},RGBToHex:function(c){var g=[c.r.toString(16),c.g.toString(16),c.b.toString(16)],d=0;for(;d<3;d++){if(g[d].length==1){g[d]="0"+g[d];}}return g.join("");},HSBToHex:function(c){return this.RGBToHex(this.HSBToRGB(c));}};if(typeof isFinite=="undefined"){function isFinite(c){return c+1!=c;}}apf.NUMBER=1;apf.BOOLEAN=2;apf.STRING=3;apf.ARRAY=4;apf.DATE=5;apf.REGEXP=6;apf.FUNCTION=7;Array.prototype.dataType=apf.ARRAY;Number.prototype.dataType=apf.NUMBER;Date.prototype.dataType=apf.DATE;Boolean.prototype.dataType=apf.BOOLEAN;String.prototype.dataType=apf.STRING;RegExp.prototype.dataType=apf.REGEXP;Function.prototype.dataType=apf.FUNCTION;apf.getCgiString=function(c,j,g){var n=[];function k(s,i){var t;if(apf.isArray(s)){for(var q=0;q<s.length;q++){k(s[q],i+"%5B%5D");}}else{if(typeof s=="object"){for(t in s){if(apf.isSafariOld&&(!s[t]||typeof p[t]!="object")){continue;}if(typeof s[t]=="function"){continue;}k(s[t],i+"%5B"+encodeURIComponent(t)+"%5D");}}else{n.push(i+"="+encodeURIComponent(s));}}}if(j){n.push("func="+g);for(var d=0;d<c[0].length;d++){k(c[0][d],"f%5B"+d+"%5D");}}else{for(prop in c){if(apf.isSafariOld&&(!c[prop]||typeof c[prop]=="function")){continue;}k(c[prop],prop);}}return n.join("&");};apf.fromCgiString=function(d){if(!d){return false;}var s={};d=d.split("&");for(var n,k=0;k<d.length;k++){n=d[k].split("=");n[0]=decodeURIComponent(n[0]);var q=n[0].replace(/\]/g,"").split("[");var g=s;for(var c=0;c<q.length;c++){if(g[q[c]]){g=g[q[c]];}else{if(q.length==c+1){if(q[c]){g[q[c]]=decodeURIComponent(n[1]);}else{g.push(decodeURIComponent(n[1]));}break;}else{g[q[c]]=!q[c+1]?[]:{};g=g[q[c]];}}}}return s;};Function.prototype.extend=function(){apf.extend.apply(this,[this].concat(Array.prototype.slice.call(arguments)));return this;};Function.prototype.bindWithEvent=function(){var c=this,d=Array.prototype.slice.call(arguments),i=d.shift(),g=d.shift();return function(j){if(!j){j=window.event;}return c.apply(i,[j].concat(d).concat(Array.prototype.slice.call(arguments)));};};Array.prototype.copy=function(){var c=[];for(var g=0,d=this.length;g<d;g++){c[g]=this[g]&&this[g].copy?this[g].copy():this[g];}return c;};Array.prototype.merge=function(){for(var n=0,d=arguments.length;n<d;n++){for(var g=0,c=arguments[n].length;g<c;g++){this.push(arguments[n][g]);}}};Array.prototype.arrayAdd=function(){var q=this.copy();for(var n=0,d=arguments.length;n<d;n++){for(var g=0,c=q.length;g<c;g++){q[g]+=arguments[n][g];}}return q;};Array.prototype.equals=function(g){for(var d=0,c=this.length;d<c;d++){if(this[d]!=g[d]){return false;}}return true;};Array.prototype.makeUnique=function(){var c,g,d=[];for(c=0,g=this.length;c<g;c++){if(d.indexOf(this[c])==-1){d.push(this[c]);}}this.length=0;for(c=0,g=d.length;c<g;c++){this.push(d[c]);}return this;};Array.prototype.contains=function(c,d){return this.indexOf(c,d)!=-1;};Array.prototype.indexOf=Array.prototype.indexOf||function(g,j){var c=this.length;for(var d=(j<0)?Math.max(0,c+j):j||0;d<c;d++){if(this[d]===g){return d;}}return -1;};Array.prototype.lastIndexOf=Array.prototype.lastIndexOf||function(g,j){var c=this.length;for(var d=(j>=c)?c-1:(j<0)?j+c:c-1;d>=0;d--){if(this[d]===g){return d;}}return -1;};Array.prototype.pushUnique=function(c){if(this.indexOf(c)==-1){this.push(c);}return this;};Array.prototype.search=function(){for(var d=0,g=arguments.length;d<g;d++){if(typeof this[d]!="array"){continue;}for(var c=0;c<g;c++){if(this[d][c]!=arguments[c]){break;}else{if(c==(g-1)){return this[d];}}}}};Array.prototype.each=Array.prototype.forEach=Array.prototype.forEach||function(g){for(var d=0,c=this.length;d<c;d++){g.call(this,this[d],d,this);}return this;};Array.prototype.remove=function(d){for(var c=this.length-1;c>=0;c--){if(this[c]!=d){continue;}this.splice(c,1);}return this;};Array.prototype.removeIndex=function(c){if(!this.length){return null;}return this.splice(c,1);};Array.prototype.insertIndex=function(d,c){this.splice(c,0,d);};Array.prototype.invert=Array.prototype.reverse=Array.prototype.reverse||function(){var c=this.length-1;for(var d,g=0;g<Math.ceil(0.5*c);g++){d=this[g];this[g]=this[c-g];this[c-g]=d;}return this;};Array.prototype.filter=Array.prototype.filter||function(j,k){var g=[];for(var d=0,c=this.length;d<c;d++){if(j.call(k,this[d],d,this)){g.push(this[d]);}}return g;};Array.prototype.every=Array.prototype.every||function(g,j){for(var d=0,c=this.length;d<c;d++){if(!g.call(j,this[d],d,this)){return false;}}return true;};Array.prototype.map=Array.prototype.map||function(j,k){var g=[];for(var d=0,c=this.length;d<c;d++){g[d]=j.call(k,this[d],d,this);}return g;};Array.prototype.some=Array.prototype.some||function(g,j){for(var d=0,c=this.length;d<c;d++){if(g.call(j,this[d],d,this)){return true;}}return false;};Number.prototype.toPrettyDigit=Number.prototype.toPrettyDigit||function(){var c=this.toString();return(c.length==1)?"0"+c:c;};RegExp.prototype.getNativeFlags=function(){return(this.global?"g":"")+(this.ignoreCase?"i":"")+(this.multiline?"m":"")+(this.extended?"x":"")+(this.sticky?"y":"");};RegExp.prototype.addFlags=function(c){return new RegExp(this.source,(c||"")+this.getNativeFlags());};String.prototype.uCaseFirst=function(){return this.substr(0,1).toUpperCase()+this.substr(1);};String.prototype.trim=function(){return this.replace(/[\s\n\r]*$/,"").replace(/^[\s\n\r]*/,"");};String.prototype.repeat=function(c){return Array(c+1).join(this);};String.prototype.count=function(c){return this.split(c).length-1;};String.prototype.stripTags=function(){return this.replace(/<\/?[^>]+>/gi,"");};String.prototype.escape=function(){return escape(this);};String.prototype.toXml=function(){var g=apf.getXml("<root>"+this+"</root>");if(g.childNodes.length==1){return g.childNodes[0];}else{var d=g.ownerDocument.createDocumentFragment(),c=g.childNodes;while(c.length){d.appendChild(c[0]);}return d;}};if(typeof window!="undefined"&&typeof window.document!="undefined"&&typeof window.document.createElement=="function"){String.prototype.escapeHTML=function(){this.escapeHTML.text.data=this;return this.escapeHTML.div.innerHTML;};String.prototype.unescapeHTML=function(){var g=document.createElement("div");g.innerHTML=this.stripTags();if(g.childNodes[0]){if(g.childNodes.length>1){var c=[];for(var d=0;d<g.childNodes.length;d++){c.push(g.childNodes[d].nodeValue);}return c.join("");}else{return g.childNodes[0].nodeValue;}}return"";};String.prototype.escapeHTML.div=document.createElement("div");String.prototype.escapeHTML.text=document.createTextNode("");String.prototype.escapeHTML.div.appendChild(String.prototype.escapeHTML.text);if("<\n>".escapeHTML()!=="&lt;\n&gt;"){String.prototype.escapeHTML=null;}if("&lt;\n&gt;".unescapeHTML()!=="<\n>"){String.prototype.unescapeHTML=null;}}if(!String.prototype.escapeHTML){String.prototype.escapeHTML=function(){return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");};}if(!String.prototype.unescapeHTML){String.prototype.unescapeHTML=function(){return this.stripTags().replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&");};}String.prototype.truncate=function(d,c){return this.length>=d?this.substring(0,d-(c?4:1))+(c?"...":""):this;};String.prototype.pad=function(c,g,d){return d?(this+Array(c).join(g)).slice(0,c):(Array(c).join(g)+this).slice(-c);};apf.PAD_LEFT=false;apf.PAD_RIGHT=true;String.prototype.splitSafe=function(g,c,d){return(d&&this.toLowerCase()||this).replace(/(?:^\s+|\n|\s+$)/g,"").split(new RegExp("[\\s ]*"+g+"[\\s ]*","g"),c||999);};String.prototype.appendRandomNumber=function(g){for(var c=[],d=1;d<=g;d++){c.push(apf.randomGenerator.generate(1,9));}return this.toString()+c.join("");};String.prototype.prependRandomNumber=function(g){for(var c=[],d=1;d<=g;d++){c.push(apf.randomGenerator.generate(1,9));}return c.join("")+this.toString();};String.prototype.sprintf=function(){var j=this.toString(),c=0,g=j.indexOf("%s");while(g>=0){var d=arguments[c++]||" ";j=j.substr(0,g)+d+j.substr(g+2);g=j.indexOf("%s");}return j;};apf.isJson=(function(){var d=/\\["\\\/bfnrtu@]/g,c=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,i=/(?:^|:|,)(?:\s*\[)+/g,g=/^[\],:{}\s]*$/;return function(j){if(!j){return false;}return g.test(j.replace(d,"@").replace(c,"]").replace(i,""));};})();if(!self.JSON){self.JSON=(function(){var j=new RegExp('(?:false|true|null|[\\{\\}\\[\\]]|(?:-?\\b(?:0|[1-9][0-9]*)(?:\\.[0-9]+)?(?:[eE][+-]?[0-9]+)?\\b)|(?:"(?:[^\\0-\\x08\\x0a-\\x1f"\\\\]|\\\\(?:["/\\\\bfnrt]|u[0-9A-Fa-f]{4}))*"))',"g"),t=new RegExp("\\\\(?:([^u])|u(.{4}))","g"),n={'"':'"',"/":"/","\\":"\\",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"},q=function(u,w,A){return w?n[w]:String.fromCharCode(parseInt(A,16));},d=new String(""),c="\\",k={"{":Object,"[":Array},g=Object.hasOwnProperty,s=function(u,w){u=w+u;return u.substring(u.length-w.length);},i={0:function(w){if(w.nodeType&&w.ownerDocument&&w.cloneNode(true)){return"apf.xmldb.getXml("+JSON.stringify(apf.getXmlString(w))+")";}var u=[];for(var A in w){u.push('"'+A.replace(/(["\\])/g,"\\$1")+'": '+JSON.stringify(w[A]));}return"{"+u.join(", ")+"}";},5:function(u){u='"'+u.replace(/(["\\])/g,"\\$1")+'"';return u.replace(/(\n)/g,"\\n").replace(/\r/g,"");},2:function(u){return u.toString();},4:function(u){return u.toString();},3:function(u){return'{"jsonclass":["sys.ISODate", ["'+s(u.getUTCFullYear(),"0000")+s(u.getUTCMonth()+1,"00")+s(u.getUTCDate(),"00")+"T"+s(u.getUTCHours(),"00")+":"+s(u.getUTCMinutes(),"00")+":"+s(u.getUTCSeconds(),"00")+'"]]}';},1:function(u){for(var A=[],w=0;w<u.length;w++){A.push(JSON.stringify(u[w]));}return"["+A.join(", ")+"]";},7:function(u){return;}};return{parse:function(F,B){var A=F.match(j),H;var G=A[0];if("{"==G){H={};}else{if("["==G){H=[];}else{throw new Error(G);}}var E,I,C=[H];for(var w=1,u=A.length;w<u;++w){G=A[w];switch(G.charCodeAt(0)){default:I=C[0];I[E||I.length]=+(G);E=void 0;break;case 34:G=G.substring(1,G.length-1);if(G.indexOf(c)!==-1){G=G.replace(t,q);}I=C[0];if(!E){if(I instanceof Array){E=I.length;}else{E=G||d;break;}}I[E]=G;E=void 0;break;case 91:I=C[0];C.unshift(I[E||I.length]=[]);E=void 0;break;case 93:C.shift();break;case 102:I=C[0];I[E||I.length]=false;E=void 0;break;case 110:I=C[0];I[E||I.length]=null;E=void 0;break;case 116:I=C[0];I[E||I.length]=true;E=void 0;break;case 123:I=C[0];C.unshift(I[E||I.length]={});E=void 0;break;case 125:C.shift();break;}}if(C.length){throw new Error();}if(B){var D=function(O,N){var P=O[N];if(P&&typeof P=="object"){var J=null;for(var L in P){if(g.call(P,L)&&P!==O){var K=D(P,L);if(K!==void 0){P[L]=K;}else{if(!J){J=[];}J.push(L);}}}if(J){for(var M=J.length;--M>=0;){delete P[J[M]];}}}return B.call(O,N,P);};H=D({"":H},"");}return H;},stringify:function(u){if(typeof args=="function"||apf.isNot(u)){return"null";}return i[u.dataType||0](u);}};})();}apf.serialize=function(c){return self.JSON.stringify(c);};apf.unserialize=function(c){if(!c){return c;}return self.JSON.parse(c);};apf.hotkeys={};apf.keyMods={ctrl:1,alt:2,shift:4,meta:8};apf.keyNames={"32":"Spacebar","13":"Enter","9":"Tab","27":"Esc","46":"Del","36":"Home","35":"End","107":"+","37":"Left Arrow","38":"Up Arrow","39":"Right Arrow","40":"Down Arrow","33":"Page Up","34":"Page Down","112":"F1","113":"F2","114":"F3","115":"F4","116":"F5","117":"F6","118":"F7","119":"F8","120":"F9","121":"F10","122":"F11","123":"F12"};apf.registerHotkey=function(c,j){var q=0,g;var n=c.splitSafe("\\-|\\+",null,true),k=false,s=false;for(var d=0;d<n.length;d++){if(apf.keyMods[n[d]]){q=q|apf.keyMods[n[d]];if(apf.isMac){k=(apf.keyMods[n[d]]===apf.keyMods.ctrl);s=(apf.keyMods[n[d]]===apf.keyMods.meta);}}else{g=n[d];}}if(k&&!s){q=q|apf.keyMods.meta;}if(!g){throw new Error("missing key for hotkey: "+c);}(apf.hotkeys[q]||(apf.hotkeys[q]={}))[g]=j;if(!apf.initHotkey){apf.initHotkey=true;apf.addEventListener("hotkey",function(w){if(apf.isMac&&w.metaKey){w.ctrlKey=true;}var u=0|(w.ctrlKey?1:0)|(w.shiftKey?4:0)|(w.metaKey?8:0);var i=apf.keyNames[w.keyCode];if(!u&&!i){return;}var t=(apf.hotkeys[u]||{})[(i||String.fromCharCode(w.keyCode)).toLowerCase()];if(t){t();w.returnValue=false;apf.queue.empty();}});}};apf.removeHotkey=function(c){apf.registerHotkey(c,null);};apf.setStyleRule=function(d,t,u,c,q){d=d.toLowerCase();if(!c){var n=(q||self).document.styleSheets;for(var g=n.length-1;g>=0;g--){try{var w=n[g][apf.styleSheetRules];for(var k=0;k<w.length;k++){if(w.item(k).selectorText.toLowerCase()==d){w.item(k).style[t]=u;return true;}}}catch(s){}}}else{var w=(q||self).document.styleSheets[c||0][apf.styleSheetRules];for(var k=0;k<w.length;k++){if(w.item(k).selectorText.toLowerCase()==d){w.item(k).style[t]=u;return true;}}}return false;};apf.getStyleRule=function(d,t,c,q){d=d.toLowerCase();if(!c){var n=(q||self).document.styleSheets;for(var g=n.length-1;g>=0;g--){try{var u=n[g][apf.styleSheetRules];for(var k=0;k<u.length;k++){if(u.item(k).selectorText.toLowerCase()==d){return u.item(k).style[t];}}}catch(s){}}}else{var u=(q||self).document.styleSheets[c||0][apf.styleSheetRules];for(var k=0;k<u.length;k++){if(u.item(k).selectorText.toLowerCase()==d){return u.item(k).style[t];}}}return false;};apf.setStyleClass=function(g,d,i,j){if(!g||j&&this.disabled){return;}if(g.nodeFunc){throw new Error(apf.formatErrorString(0,this,"Setting style class","Trying to set style class on aml node. Only xml or html nodes can              be passed to this function"));}if(d){if(i){i[i.length]=d;}else{i=[d];}}var c=new RegExp("(^| +)(?:"+(i?i.join("|"):"")+")","gi");g.className!=null?(g.className=g.className.replace(c," ")+(d?" "+d:"")):g.setAttribute("class",(g.getAttribute("class")||"").replace(c," ")+(d?" "+d:""));return g;};apf.importCssString=function(d,j,i){j=j||document;var g=j.getElementsByTagName("head")[0];if(!apf.supportOpacity){d=d.replace(/opacity[ \s]*\:[ \s]*([\d\.]+)/g,function(k,n){return"filter:progid:DXImageTransform.Microsoft.Alpha(opacity="+(n*100)+")";});}if(apf.canCreateStyleNode){var c=j.createElement("style");c.appendChild(j.createTextNode(d));if(i){c.setAttribute("media",i);}g.appendChild(c);}else{g.insertAdjacentHTML("beforeend",".<style media='"+(i||"all")+"'>"+d+"</style>");}};apf.getStyleRecur=function(c,g){var d=apf.hasComputedStyle?document.defaultView.getComputedStyle(c,"").getPropertyValue(g.replace(/([A-Z])/g,function(i,j){return"-"+j.toLowerCase();})):c.currentStyle[g];return((!d||d=="transparent"||d=="inherit")&&c.parentNode&&c.parentNode.nodeType==1)?this.getStyleRecur(c.parentNode,g):d;};apf.importStylesheet=function(d,g){for(var c=0;c<d.length;c++){if(!d[c][1]){continue;}if(apf.isIE){(g||window).document.styleSheets[0].addRule(d[c][0],d[c][1]);}else{(g||window).document.styleSheets[0].insertRule(d[c][0]+" {"+d[c][1]+"}",0);}}};apf.isInRect=function(d,c,i){var g=this.getAbsolutePosition(d);if(c<g[0]||i<g[1]||c>d.offsetWidth+g[0]-10||i>d.offsetHeight+g[1]-10){return false;}return true;};apf.getOverflowParent=function(c){c=c.offsetParent;while(c&&(this.getStyle(c,"overflow")!="hidden"||"absolute|relative".indexOf(this.getStyle(c,"position"))==-1)){c=c.offsetParent;}return c||document.documentElement;};apf.getPositionedParent=function(c){c=c.offsetParent;while(c&&c.tagName.toLowerCase()!="body"&&"absolute|relative".indexOf(this.getStyle(c,"position"))==-1){c=c.offsetParent;}return c||document.documentElement;};apf.getAbsolutePosition=function(d,s,g){if("getBoundingClientRect" in document.documentElement){if(apf.doesNotIncludeMarginInBodyOffset&&d==document.body){return[d.offsetLeft+(parseFloat(apf.getStyle(d,apf.descPropJs?"marginLeft":"margin-top"))||0),+(d.scrollLeft||0),d.offsetTop+(parseFloat(apf.getStyle(d,apf.descPropJs?"marginTop":"margin-top"))||0)+(d.scrollTop||0)];}var k=d.getBoundingClientRect(),B=k.top,i=k.left,u=(apf.isIE&&apf.isIE<8);if(s&&s!=document.body){var A=apf.getAbsolutePosition(s,null,true);B-=A[1];i-=A[0];}if(!(apf.isIE&&d==document.documentElement)){i+=document.body.scrollLeft||document.documentElement.scrollLeft||0;B+=document.body.scrollTop||document.documentElement.scrollTop||0;}if(g&&!s){i+=parseInt(apf.getStyle(d,apf.descPropJs?"borderLeftWidth":"border-left-width"))||0;B+=parseInt(apf.getStyle(d,apf.descPropJs?"borderTopWidth":"border-top-width"))||0;}return[i-(u?2:0),B-(u?2:0)];}var n=g?0:d.offsetLeft,C=g?0:d.offsetTop;d=g?d:d.offsetParent||d.parentNode;if(apf.isIE8&&s){w=this.getStyle(d,"borderLeftWidth");n-=(apf.isIE&&d.currentStyle.borderLeftStyle!="none"&&w=="medium"?2:parseInt(w)||0);j=this.getStyle(d,"borderTopWidth");C-=(apf.isIE&&d.currentStyle.borderTopStyle!="none"&&j=="medium"?2:parseInt(j)||0);}var w,j,D;while(d&&d!=s){w=apf.isOpera||apf.isIE8?0:this.getStyle(d,apf.descPropJs?"borderLeftWidth":"border-left-width");n+=(apf.isIE&&d.currentStyle.borderLeftStyle!="none"&&w=="medium"?2:parseInt(w)||0)+d.offsetLeft;if(apf.isIE&&!apf.isIE8&&apf.getStyle(d,"styleFloat")=="none"&&apf.getStyle(d,"position")=="relative"){var c=d.previousSibling;while(c){if(c.nodeType==1){D=apf.getStyle(c,"styleFloat");if(D=="left"){n-=parseInt(apf.getStyle(d,"marginLeft"))||0;break;}else{if(D=="right"){break;}}}c=c.previousSibling;}}j=apf.isOpera||apf.isIE8?0:this.getStyle(d,apf.descPropJs?"borderTopWidth":"border-top-width");C+=(apf.isIE&&d.currentStyle.borderTopStyle!="none"&&j=="medium"?2:parseInt(j)||0)+d.offsetTop;if(!apf.isGecko&&d!=s&&(d.tagName!="HTML"||d.ownerDocument!=document)){n-=d.scrollLeft;C-=d.scrollTop;}if(d.tagName.toLowerCase()=="table"){C-=parseInt(d.border||0)+parseInt(d.cellSpacing||0);n-=parseInt(d.border||0)+parseInt(d.cellSpacing||0)*2;}else{if(d.tagName.toLowerCase()=="tr"){var t;C-=(t=parseInt(d.parentNode.parentNode.cellSpacing));while(d.previousSibling){C-=(d=d.previousSibling).offsetHeight+t;}}}if(apf.isIE&&!d.offsetParent&&d.parentNode.nodeType==1){n-=d.parentNode.scrollLeft;C-=d.parentNode.scrollTop;}d=d.offsetParent;}return[n,C];};apf.getViewPort=function(d){d=d||window;var c=(!d.document.compatMode||d.document.compatMode=="CSS1Compat")?d.document.html||d.document.documentElement:d.document.body;return{x:d.pageXOffset||c.scrollLeft,y:d.pageYOffset||c.scrollTop,width:d.innerWidth||c.clientWidth,height:d.innerHeight||c.clientHeight};};apf.plane={init:function(){if(!this.plane){this.plane=document.createElement("DIV");document.body.appendChild(this.plane);this.plane.style.background="url(images/spacer.gif)";this.plane.style.position="fixed";this.plane.style.zIndex=100000000;this.plane.style.left=0;this.plane.style.top=0;}},lastCursor:null,show:function(q,j,i,g){this.init();var d=this.plane;if(q){this.current=q;if(!j){this.lastZ=this.current.style.zIndex;this.current.style.zIndex=100000;}else{this.plane.appendChild(q);}}var c=(d.parentNode==document.body?g?document.documentElement.offsetWidth:apf.getWindowWidth():d.parentNode.offsetWidth);var k=(d.parentNode==document.body?g?document.documentElement.offsetHeight:apf.getWindowHeight():d.parentNode.offsetHeight);if(i){if(this.lastCursor===null){this.lastCursor=document.body.style.cursor;}document.body.style.cursor=apf.getStyle(q,"cursor");}this.plane.style.display="block";var n=apf.getDiff(d.parentNode);this.plane.style.width=(c-n[0])+"px";this.plane.style.height=(k-n[1])+"px";return d;},hide:function(){var c=apf.isChildOf(this.plane,document.activeElement);if(this.current){if(this.lastZ!==null){if(this.current.style.zIndex==100000){this.current.style.zIndex=this.lastZ;}this.lastZ=null;}if(this.current.parentNode==this.plane){this.plane.parentNode.appendChild(this.current);}}this.plane.style.display="none";if(c){if(!apf.isIE){document.activeElement.focus();}apf.document.activeElement.$focus();}this.current=null;if(this.lastCursor!==null){document.body.style.cursor=this.lastCursor;this.lastCursor=null;}return this.plane;}};apf.highlightXml=apf.highlightCode=function(k){var d=k.split(/\n\r?/);for(var j=1000,g=0,c=d.length;g<c;g++){j=Math.min(j,d[g].match(/^(\s+)?[^\s]/)&&RegExp.$1.length||1000);if(!j){break;}}k=k.replace(new RegExp("^ {"+j+"}","gm"),"").replace(/<!doctype([\s\S]+?)>|<!--([\s\S]+?)-->|<\?([\w\-]+)([\s\S]+?)\?>|<\!\[CDATA\[([\s\S]*?)\]\]>|<(\w+:)?script([\s\S]*?)>([\s\S]*?)<\/(?:\w+:)?script>|<([\/\w\:\-]+)([\s\S]*?)(\/?)>/g,function(s,u,w,t,B,C,i,A,E,q,D,n){if(u){return'<span style="color:gray">&lt;!doctype'+u.replace(/</g,"&lt;")+"&gt;</span>";}else{if(w){return'<span style="color:green">&lt;!--'+w.replace(/</g,"&lt;")+"--&gt;</span>";}else{if(t){return'<span style="color:orange">&lt;?'+t+"</span>"+apf.highlightJs(B,true)+'<span style="color:orange">?&gt;</span>';}else{if(C){return'<span style="color:gray">&lt;![CDATA['+C+"]]&gt;</span>";}else{if(i){return'<span style="color:#127ac6">&lt;'+i+"script"+(D?"</span>"+D.replace(/("[\s\S]*?")|([\w\-\:]+)/g,function(F,H,G){if(H){return H;}return'<span style="color:red">'+G+"</span>";})+'<span style="color:#127ac6">&gt;</span>':"&gt;</span>")+apf.highlightJs(E,true)+'<span style="color:#127ac6">&lt;/'+i+"script&gt;</span>";}else{if(q){return'<span style="color:#127ac6">&lt;'+(q.substr(0,2)=="a:"?"<a href='element."+q.substr(2)+"'>"+q+"</a>":q)+(D?"</span>"+D.replace(/("[\s\S]*?")|([\w\-\:]+)/g,function(F,H,G){if(H){return H;}return'<span style="color:red">'+G+"</span>";})+'<span style="color:#127ac6">'+n+"&gt;</span>":"&gt;</span>");}}}}}}});return k;};apf.removeStartWhitespaces=function(k){var d=k.split(/\n\r?/);for(var j=1000,g=0,c=d.length;g<c;g++){j=Math.min(j,d[g].match(/^(\s+)?[^\s]/)&&RegExp.$1.length||1000);if(!j){break;}}return k.replace(new RegExp("^ {"+j+"}","gm"),"");};apf.convertAmlToJson=function(k){var i=apf.getXml("<a:app xmlns:a='"+apf.ns.apf+"'>"+k+"</a:app>",null,true);var g=[],d={"true":1,"false":1};var c=(function j(q,E,B){var w=new Array(E+2).join("  "),t=[];for(var u,F=0,A=q.length;F<A;F++){u=q[F];if(u.nodeType==3||u.nodeType==4){if(u.nodeValue.replace(/[\s]*$/,"").replace(/^[\s]*/,"")){(B||t).push("data",'"'+u.nodeValue.trim().replace(/"/g,'\\"').replace(/\n/g,"\\\n")+'"');}continue;}else{if(u.nodeType==8){t.push(w+"//"+u.nodeValue);continue;}else{if(u.nodeType!=1){continue;}else{if(u[apf.TAGNAME]=="script"){var L=u.childNodes;for(var C=0,D=L.length;C<D;C++){if(L[C].nodeValue.trim()!="//"){g.push(L[C].nodeValue.replace(/^ {16}/gm,"").replace(/\/\/$/,"")+"\n");}}continue;}}}}var H,G=u.childNodes.length+(H=u.attributes).length;var J=0,n=[];t.push(w+"new apf."+u[apf.TAGNAME]+(G||!E?"({":"()"+(E==0?";":(F==A-1?"":","))));if(!E){n.push("htmlNode","document.body");J=Math.max(8,J);}for(var K,C=0,D=H.length;C<D;C++){n.push((K=H[C]).nodeName,K.nodeName.substr(0,2)=="on"?"function(){"+K.nodeValue+"}":(parseInt(K.nodeValue)==K.nodeValue||d[K.nodeValue]?K.nodeValue:'"'+K.nodeValue.replace(/"/g,'\\"')+'"'));J=Math.max(K.nodeName.length,J);}var I="";if(u[apf.TAGNAME]=="model"&&u.childNodes.length){n.push("data",'"'+apf.serializeChildren(u).trim().replace(/"/g,'\\"').replace(/\r?\n/g,"\\\n")+'"');}else{if(G){var I=j(u.childNodes,E+2,n);}}J=Math.max(I?10:4,J);J++;for(C=0,D=n.length;C<D;C+=2){t.push(w+"  "+n[C].pad(J," ",apf.PAD_RIGHT)+": "+n[C+1]+(C!=D-2||I?",":""));}if(I){t.push(w+"  "+"childNodes".pad(J," ",apf.PAD_RIGHT)+": [");t.push(I.substr(0,I.length-1));t.push(w+"  ]");}if(G||!E){t.push(w+"})"+(E==0?";":(F==A-1?"":",")));}}return t.join("\n")+(E==0?"\n\n"+g.join("").trim():"");})(i.childNodes,0);return c+"\n\n";};apf.highlightJs=function(c,n){if(!n){var g=c.split(/\n\r?/);for(var k=1000,j=0,d=g.length;j<d;j++){k=Math.min(k,g[j].match(/^(\s+)?[^\s]/)&&RegExp.$1.length||1000);if(!k){break;}}c=c.replace(new RegExp("^ {"+k+"}","gm"),"");}return c.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/(\/\*[\s\S]+\*\/)|(\/\/.*)$|("(?:[^"\\]+|\\[\s\S])*")|('(?:[^'\\]+|\\[\s\S])*')|(\W)(apf|break|continue|do|for|import|new|this|void|case|default|else|function|in|return|typeof|while|comment|delete|export|if|label|switch|var|with|abstract|implements|protected|boolean|instanceOf|public|byte|int|short|char|interface|static|double|long|synchronized|false|native|throws|final|null|transient|float|package|true|goto|private|catch|enum|throw|class|extends|try|const|finally|debugger|super)(\W)|(\W)(\w+)(\s*\()/gm,function(i,E,C,t,s,w,A,q,B,u,D){if(u){return B+'<span style="color:#ff8000">'+u+"</span>"+D;}else{if(C||E){return'<span style="color:green">'+(C||E)+"</span>";}else{if(t||s){return'<span style="color:#808080">'+(t||s)+"</span>";}else{if(w){return w+'<span style="color:#127ac6">'+A+"</span>"+q;}}}}});};apf.highlightCode2=function(c){var g=[],d=[];return c.replace(/(\/\*[\s\S]*?\*\/|\/\/.*)/g,function(i){g.push(i);return"###n"+(g.length-1)+"###";}).replace(/\"([\s\S]*?)\"/g,function(j,i){d.push(i);return"###s"+(d.length-1)+"###";}).replace(/\'([\s\S]*?)\'/g,function(j,i){d.push(i);return"###q"+(d.length-1)+"###";}).replace(/(\<)|(\>)/g,function(k,j,i){return"<span stylecolorwhite>"+(j?"@lt@":"@gt@")+"</span>";}).replace(/(\W)-?([\d\.]+)(\W)/g,"$1<span stylecolor#127ac6>$2</span>$3").replace(/([\|\&\=\;\,\:\?\+\*\-]+)/g,"<span stylecolorwhite>$1</span>").replace(/(\W)(break|continue|do|for|import|new|this|void|case|default|else|function|in|return|typeof|while|comment|delete|export|if|label|switch|var|with|abstract|implements|protected|boolean|instanceOf|public|byte|int|short|char|interface|static|double|long|synchronized|false|native|throws|final|null|transient|float|package|true|goto|private|catch|enum|throw|class|extends|try|const|finally|debugger|super)(\W)/g,"$1<span stylecolorgreen>$2</span>$3").replace(/([\(\)\{\}\[\]])/g,"<span stylecoloryellow>$1</span>").replace(/###n(\d+)###/g,function(j,i){return"<span stylecolorpurple>"+g[i].escapeHTML()+"</span>";}).replace(/###s(\d+)###/g,function(j,i){return'<span stylecolorgray>"'+d[i].escapeHTML()+'"</span>';}).replace(/###q(\d+)###/g,function(j,i){return"<span stylecolorgray>'"+d[i].escapeHTML()+"'</span>";}).replace(/stylecolor(.*?)\>/g,"style='color:$1'>").replace(/@(.*?)@/g,"&$1;");};apf.formatJS=function(g){var j=0,c=0;var k=[],i=[];return g.replace(/(\/\*[\s\S]*?\*\/|\/\/.*)/g,function(d){k.push(d);return"###n"+(k.length-1)+"###";}).replace(/\"([\s\S]*?)\"/g,function(n,d){i.push(d);return"###s"+(i.length-1)+"###";}).replace(/\'([\s\S]*?)\'/g,function(n,d){i.push(d);return"###q"+(i.length-1)+"###";}).replace(/;+/g,";").replace(/{;/g,"{").replace(/({)|(})|(\()|(\))|(;)/g,function(d,w,A,q,s,t){if(w){j++;}if(A){j--;}if(q){c++;return q;}if(s){c--;return s;}var u="";for(var n=0;n<j;n++){u+="\t";}if(w){return"{\n"+u;}if(A){return"\n"+u+"}";}if(t){return(c>0)?t:(";\n"+u);}}).replace(/;\s*\n\s*\n/g,";\n").replace(/}var/g,"}\nvar").replace(/([\n\s]*)###n(\d+)###[\n\s]*/g,function(n,d,q){return d+k[q]+d;}).replace(/###s(\d+)###/g,function(n,d,q){return'"'+i[d]+'"';}).replace(/###q(\d+)###/g,function(n,d,q){return"'"+i[d]+"'";});};apf.flash=(function(){function getControlVersion(){var version,axo;try{axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7");version=axo.GetVariable("$version");}catch(e){}if(!version){try{axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");version="WIN 6,0,21,0";axo.AllowScriptAccess="always";version=axo.GetVariable("$version");}catch(e){}}if(!version){try{axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.3");version=axo.GetVariable("$version");}catch(e){}}if(!version){try{axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.3");version="WIN 3,0,18,0";}catch(e){}}if(!version){try{axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");version="WIN 2,0,0,11";}catch(e){version=-1;}}return version;}function getSwfVersion(){var flashVer=-1,sAgent=navigator.userAgent.toLowerCase();if(navigator.plugins!=null&&navigator.plugins.length>0){if(navigator.plugins["Shockwave Flash 2.0"]||navigator.plugins["Shockwave Flash"]){var swVer2=navigator.plugins["Shockwave Flash 2.0"]?" 2.0":"",swfDescr=navigator.plugins["Shockwave Flash"+swVer2].description,aDescr=swfDescr.split(" "),aTempMaj=aDescr[2].split("."),nMajor=aTempMaj[0],nMinor=aTempMaj[1],sRev=aDescr[3];if(sRev==""){sRev=aDescr[4];}if(sRev[0]=="d"){sRev=sRev.substring(1);}else{if(sRev[0]=="r"){sRev=sRev.substring(1);if(sRev.indexOf("d")>0){sRev=sRev.substring(0,sRev.indexOf("d"));}}}flashVer=nMajor+"."+nMinor+"."+sRev;}}else{if(sAgent.indexOf("webtv/2.6")!=-1){flashVer=4;}else{if(sAgent.indexOf("webtv/2.5")!=-1){flashVer=3;}else{if(sAgent.indexOf("webtv")!=-1){flashVer=2;}else{if(apf.isIE&&!apf.isOpera){flashVer=getControlVersion();}}}}}return flashVer;}function detectFlashVersion(reqMajorVer,reqMinorVer,reqRevision){var versionStr=getSwfVersion();if(versionStr==-1){return false;}if(versionStr!=0){var aVersions;if(apf.isIE&&!apf.isOpera){var aTemp=versionStr.split(" "),sTemp=aTemp[1];aVersions=sTemp.split(",");}else{aVersions=versionStr.split(".");}var nMajor=aVersions[0],nMinor=aVersions[1],sRev=aVersions[2];if(nMajor>parseFloat(reqMajorVer)){return true;}if(nMajor==parseFloat(reqMajorVer)){if(nMinor>parseFloat(reqMinorVer)){return true;}if(nMinor==parseFloat(reqMinorVer)&&sRev>=parseFloat(reqRevision)){return true;}}return false;}}function generateObj(objAttrs,params,embedAttrs,stdout){if(stdout=="undefined"){stdout=false;}var i,str=[];if(apf.isIE&&!apf.isOpera){str.push("<object ");for(i in objAttrs){str.push(i,'="',objAttrs[i],'" ');}str.push(">");for(i in params){str.push('<param name="',i,'" value="',params[i],'" />');}str.push("</object>");}else{str.push("<embed ");for(i in embedAttrs){str.push(i,'="',embedAttrs[i],'" ');}str.push("></embed>");}var sOut=str.join("");if(stdout===true){document.write(sOut);}return sOut;}function AC_FL_RunContent(options){var ret=AC_GetArgs(options,"movie","clsid:d27cdb6e-ae6d-11cf-96b8-444553540000","application/x-shockwave-flash");return generateObj(ret.objAttrs,ret.params,ret.embedAttrs);}function buildContent(options){var v=isEightAvailable();if(isAvailable()&&!v){return buildInstaller(options||{});}if(v){return AC_FL_RunContent(options);}return'This content requires the             <a href="http://www.adobe.com/go/getflash/">Adobe Flash Player</a>.';}function embed(options){var obj=options.context,node=options.htmlNode,prop=options.property||"$player";delete options.context,delete options.htmlNode,delete options.property;var content=buildContent(options),cb=function(){$setTimeout(function(){node.innerHTML=content;obj[prop]=getElement(options.id);$setTimeout(function(){var fail=null;if(!obj[prop].parentNode){fail="File Uploader error: The movie has to be enabled manually because of Flashblock. No browser refresh is required.";}else{if(obj[prop].style.display=="none"){fail="File Uploader error: Adblock Plus blocks or hides the movie. Please enable it and refresh your browser.";}else{if(!obj[prop].offsetWidth){fail="File Uploader error: The Flash movie failed to load. Please check if the file exists and the path is correct.";}}}if(fail){apf.console.error(fail,"audio");obj.dispatchEvent("error",{message:fail});}},1000);},200);};return apf.loaded?cb():apf.addEventListener("load",cb);}function buildInstaller(options){if(!options){options={};}var ret=AC_GetArgs(options,"movie","clsid:d27cdb6e-ae6d-11cf-96b8-444553540000","application/x-shockwave-flash"),MMPlayerType=(apf.isIE==true)?"ActiveX":"PlugIn",MMredirectURL=window.location;document.title=document.title.slice(0,47)+" - Flash Player Installation";var MMdoctitle=document.title;return AC_FL_RunContent({src:"playerProductInstall",FlashVars:"MMredirectURL="+MMredirectURL+"&MMplayerType="+MMPlayerType+"&MMdoctitle="+MMdoctitle+"",width:"100%",height:"100%",align:"middle",id:ret.embedAttrs.name,quality:"high",bgcolor:"#000000",name:ret.embedAttrs.name,allowScriptAccess:"always",type:"application/x-shockwave-flash",pluginspage:"http://www.adobe.com/go/getflashplayer"});}var sSrc="src|movie",sObj="onafterupdate|onbeforeupdate|onblur|oncellchange|onclick|ondblclick|ondrag|ondragend|ondragenter|ondragleave|ondragover|ondrop|onfinish|onfocus|onhelp|onmousedown|onmouseup|onmouseover|onmousemove|onmouseout|onkeypress|onkeydown|onkeyup|onload|onlosecapture|onpropertychange|onreadystatechange|onrowsdelete|onrowenter|onrowexit|onrowsinserted|onstart|onscroll|onbeforeeditfocus|onactivate|onbeforedeactivate|ondeactivate|type|codebase|id",sEmb="width|height|align|vspace|hspace|class|title|accesskey|name|tabindex";function AC_GetArgs(options,srcParamName,classid,mimeType){var i,name,ret={embedAttrs:{},params:{},objAttrs:{}};for(i in options){name=i.toLowerCase();if(name=="classid"){continue;}if(name=="pluginspage"){ret.embedAttrs[i]=options[i];}else{if(sSrc.indexOf(name)>-1){ret.embedAttrs.src=options[i];ret.params[srcParamName]=options[i];}else{if(sObj.indexOf(name)>-1){ret.objAttrs[i]=options[i];}else{if(sEmb.indexOf(name)>-1){ret.embedAttrs[i]=ret.objAttrs[i]=options[i];}else{ret.embedAttrs[i]=ret.params[i]=options[i];}}}}}ret.objAttrs.classid=classid;if(mimeType){ret.embedAttrs.type=mimeType;}return ret;}function getElement(id){var elem;if(typeof id=="object"){return id;}if(apf.isIE){return self[id];}else{elem=document[id]?document[id]:document.getElementById(id);if(!elem){elem=apf.lookup(id);}return elem;}}var hash={},uniqueID=1;function addPlayer(player){hash[++uniqueID]=player;return uniqueID;}function getPlayer(id){return hash[id];}function callMethod(id,methodName){var player=hash[id];if(player==null){throw new Error(apf.formatErrorString(0,this,"Player with id: "+id+" not found"));}if(player[methodName]==null){throw new Error(apf.formatErrorString(0,this,"Method "+methodName+" Not found"));}apf.console.info("[FLASH] received method call for player '"+id+"', '"+methodName+"'");var args=[],i=2,l=arguments.length;for(;i<l;i++){args.push(decode(arguments[i]));}player[methodName].apply(player,args);}function remote(o,fn){if(typeof o=="string"){o=hash[o];}var rs=o.CallFunction('<invoke name="'+fn+'" returntype="javascript">'+__flash__argumentsToXML(arguments,2)+"</invoke>");return eval(rs);}function encode(data){if(!data||typeof data!="string"){return data;}return data.replace(/\&([^;]*)\;/g,"&amp;$1;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace("\\","&custom_backslash;").replace(/\0/g,"\\0").replace(/\"/g,"&quot;");}function decode(data){if(data&&data.length&&typeof data!="string"){data=data[0];}if(!data||typeof data!="string"){return data;}return data.replace(/\&custom_lt\;/g,"<").replace(/\&custom_gt\;/g,">").replace(/\&custom_backslash\;/g,"\\").replace(/\\0/g,"\0");}var aIsAvailable={};function isAvailable(sVersion){if(typeof sVersion!="string"){sVersion="6.0.65";}var aVersion=sVersion.split(".");while(aVersion.length<3){aVersion.push("0");}if(typeof aIsAvailable[sVersion]=="undefined"){aIsAvailable[sVersion]=detectFlashVersion(parseInt(aVersion[0]),parseInt(aVersion[1]),parseInt(aVersion[2]));}return aIsAvailable[sVersion];}function isEightAvailable(){return isAvailable("8.0.0");}var oSandboxTypes={remote:"remote (domain-based) rules",localwithfile:"local with file access (no internet access)",localwithnetwork:"local with network (internet access only, no local access)",localtrusted:"local, trusted (local + internet access)"};function getSandbox(sType){var oSandbox={type:null,description:null,noRemote:false,noLocal:false,error:null};oSandbox.type=sType.toLowerCase();oSandbox.description=oSandboxTypes[(typeof oSandboxTypes[oSandbox.type]!="undefined"?oSandbox.type:"unknown")];if(oSandbox.type=="localwithfile"){oSandbox.noRemote=true;oSandbox.noLocal=false;oSandbox.error="Flash security note: Network/internet URLs will not                                  load due to security restrictions.                                 Access can be configured via Flash Player Global Security                                 Settings Page:                                  http://www.macromedia.com/support/documentation/en/flashplayer/help/settings_manager04.html";}else{if(oSandbox.type=="localwithnetwork"){oSandbox.noRemote=false;oSandbox.noLocal=true;}else{if(oSandbox.type=="localtrusted"){oSandbox.noRemote=false;oSandbox.noLocal=false;}}}return oSandbox;}return{isAvailable:isAvailable,isEightAvailable:isEightAvailable,buildContent:buildContent,embed:embed,encode:encode,decode:decode,getElement:getElement,addPlayer:addPlayer,getPlayer:getPlayer,callMethod:callMethod,getSandbox:getSandbox,remote:remote};})();apf.setcookie=function(g,j,d,n,i,k){var c=g+"="+escape(j)+";";if(d){c+="expires="+new Date(d+new Date().getTimezoneOffset()*60).toGMTString()+";";}if(n){c+="path="+n+";";}if(i){c+="domain="+i+";";}if(k){c+="secure";}document.cookie=c;return j;};apf.getcookie=function(g){var d=document.cookie.split("; ");for(var j=0;j<d.length;j++){var c=d[j].split("=");if(g==c[0]){return unescape(c[1]);}}return"";};apf.delcookie=function(c,d){document.cookie=c+"=blah; expires=Fri, 31 Dec 1999 23:59:59 GMT;"+(d?"domain="+d:"");};apf.pasteWindow=function(d){var c=window.open("about:blank");c.document.write(d);};apf.xmlEntityMap={quot:"34",amp:"38",apos:"39",lt:"60",gt:"62",nbsp:"160",iexcl:"161",cent:"162",pound:"163",curren:"164",yen:"165",brvbar:"166",sect:"167",uml:"168",copy:"169",ordf:"170",laquo:"171",not:"172",shy:"173",reg:"174",macr:"175",deg:"176",plusmn:"177",sup2:"178",sup3:"179",acute:"180",micro:"181",para:"182",middot:"183",cedil:"184",sup1:"185",ordm:"186",raquo:"187",frac14:"188",frac12:"189",frac34:"190",iquest:"191",agrave:"192",aacute:"193",acirc:"194",atilde:"195",auml:"196",aring:"197",aelig:"198",ccedil:"199",egrave:"200",eacute:"201",ecirc:"202",euml:"203",igrave:"204",iacute:"205",icirc:"206",iuml:"207",eth:"208",ntilde:"209",ograve:"210",oacute:"211",ocirc:"212",otilde:"213",ouml:"214",times:"215",oslash:"216",ugrave:"217",uacute:"218",ucirc:"219",uuml:"220",yacute:"221",thorn:"222",szlig:"223",agrave:"224",aacute:"225",acirc:"226",atilde:"227",auml:"228",aring:"229",aelig:"230",ccedil:"231",egrave:"232",eacute:"233",ecirc:"234",euml:"235",igrave:"236",iacute:"237",icirc:"238",iuml:"239",eth:"240",ntilde:"241",ograve:"242",oacute:"243",ocirc:"244",otilde:"245",ouml:"246",divide:"247",oslash:"248",ugrave:"249",uacute:"250",ucirc:"251",uuml:"252",yacute:"253",thorn:"254",yuml:"255",oelig:"338",oelig:"339",scaron:"352",scaron:"353",yuml:"376",fnof:"402",circ:"710",tilde:"732",alpha:"913",beta:"914",gamma:"915",delta:"916",epsilon:"917",zeta:"918",eta:"919",theta:"920",iota:"921",kappa:"922",lambda:"923",mu:"924",nu:"925",xi:"926",omicron:"927",pi:"928",rho:"929",sigma:"931",tau:"932",upsilon:"933",phi:"934",chi:"935",psi:"936",omega:"937",alpha:"945",beta:"946",gamma:"947",delta:"948",epsilon:"949",zeta:"950",eta:"951",theta:"952",iota:"953",kappa:"954",lambda:"955",mu:"956",nu:"957",xi:"958",omicron:"959",pi:"960",rho:"961",sigmaf:"962",sigma:"963",tau:"964",upsilon:"965",phi:"966",chi:"967",psi:"968",omega:"969",thetasym:"977",upsih:"978",piv:"982",ensp:"8194",emsp:"8195",thinsp:"8201",zwnj:"8204",zwj:"8205",lrm:"8206",rlm:"8207",ndash:"8211",mdash:"8212",lsquo:"8216",rsquo:"8217",sbquo:"8218",ldquo:"8220",rdquo:"8221",bdquo:"8222",dagger:"8224",dagger:"8225",bull:"8226",hellip:"8230",permil:"8240",prime:"8242",prime:"8243",lsaquo:"8249",rsaquo:"8250",oline:"8254",frasl:"8260",euro:"8364",image:"8465",weierp:"8472",real:"8476",trade:"8482",alefsym:"8501",larr:"8592",uarr:"8593",rarr:"8594",darr:"8595",harr:"8596",crarr:"8629",larr:"8656",uarr:"8657",rarr:"8658",darr:"8659",harr:"8660",forall:"8704",part:"8706",exist:"8707",empty:"8709",nabla:"8711",isin:"8712",notin:"8713",ni:"8715",prod:"8719",sum:"8721",minus:"8722",lowast:"8727",radic:"8730",prop:"8733",infin:"8734",ang:"8736",and:"8743",or:"8744",cap:"8745",cup:"8746","int":"8747",there4:"8756",sim:"8764",cong:"8773",asymp:"8776",ne:"8800",equiv:"8801",le:"8804",ge:"8805",sub:"8834",sup:"8835",nsub:"8836",sube:"8838",supe:"8839",oplus:"8853",otimes:"8855",perp:"8869",sdot:"8901",lceil:"8968",rceil:"8969",lfloor:"8970",rfloor:"8971",lang:"9001",rang:"9002",loz:"9674",spades:"9824",clubs:"9827",hearts:"9829",diams:"9830"};apf.htmlentities=function(c){return c.escapeHTML();};apf.xmlentities=function(c){return c.replace(/&([a-z]+);/gi,function(g,d){if(apf.xmlEntityMap[d=d.toLowerCase()]){return"&#"+apf.xmlEntityMap[d]+";";}return g;});};apf.html_entity_decode=function(c){return(c||"").replace(/\&\#38;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&nbsp;/g," ");};apf.isCharacter=function(c){return(c<112||c>122)&&(c==32||c>42||c==8);};apf.randomGenerator={d:new Date(),seed:null,A:48271,M:2147483647,Q:null,R:null,oneOverM:null,generate:function(d,c){if(this.seed==null){this.seed=2345678901+(this.d.getSeconds()*16777215)+(this.d.getMinutes()*65535);}this.Q=this.M/this.A;this.R=this.M%this.A;this.oneOverM=1/this.M;return Math.floor((c-d+1)*this.next()+d);},next:function(){var c=this.seed/this.Q;var d=this.seed%this.Q;var g=this.A*d-this.R*c;if(g>0){this.seed=g;}else{this.seed=g+this.M;}return(this.seed*this.oneOverM);}};apf.getNoCacheUrl=function(c){return c+(c.indexOf("?")==-1?"?":"&")+"nocache="+new Date().getTime();};apf.parseExpression=function(str){if(!apf.parseExpression.regexp.test(str)){return str;}try{return eval(RegExp.$1);}catch(e){throw new Error(apf.formatErrorString(0,null,"Parsing Expression","Invalid expression given '"+str+"'"));}};apf.parseExpression.regexp=/^\{([\s\S]*)\}$/;apf.formatNumber=function(c,g){var d=parseFloat(c);if(!d){return c;}var i=new String(Math.round(d*100)/100).replace(/(\.\d?\d?)$/,function(j){return j.pad(3,"0",apf.PAD_RIGHT);});if(i.indexOf(".")==-1){i+=".00";}return g+i;};apf.jsexec=function(str,win){if(!str){return str;}if(!win){win=self;}if(apf.isO3){eval(str,self);}else{if(apf.hasExecScript){win.execScript(str);}else{var head=win.document.getElementsByTagName("head")[0];if(head){var script=win.document.createElement("script");script.setAttribute("type","text/javascript");script.text=str;head.appendChild(script);head.removeChild(script);}else{eval(str,win);}}}return str;};apf.K=function(){};apf.isNumber=function(c){return parseFloat(c)==c;};apf.isArray=function(c){return Object.prototype.toString.call(c)==="[object Array]";};apf.isTrue=function(d){return(d===true||d==="true"||d==="on"||typeof d=="number"&&d>0||d==="1");};apf.isFalse=function(d){return(d===false||d==="false"||d==="off"||d===0||d==="0");};apf.isNot=function(d){return(!d&&typeof d!="string"&&d!==0||(typeof d=="number"&&!isFinite(d)));};apf.removePathContext=function(d,c){if(!c){return"";}if(c.indexOf(d)>-1){return c.substr(d.length);}return c;};apf.cancelBubble=function(c,d){c.cancelBubble=true;if(d.$focussable&&!d.disabled){apf.window.$focus(d);}};apf.destroyHtmlNode=function(c){if(!c){return;}if(!apf.isIE||c.ownerDocument!=document){if(c.parentNode){c.parentNode.removeChild(c);}return;}var d=document.getElementById("IELeakGarbageBin");if(!d){d=document.createElement("DIV");d.id="IELeakGarbageBin";d.style.display="none";document.body.appendChild(d);}d.appendChild(c);d.innerHTML="";};apf.getRules=function(d){var g={};for(var c=d.firstChild;c;c=c.nextSibling){if(c.nodeType!=1){continue;}else{if(!g[c[apf.TAGNAME]]){g[c[apf.TAGNAME]]=[];}g[c[apf.TAGNAME]].push(c);}}return g;};apf.isCoord=function(c){return c||c===0;};apf.getCoord=function(d,c){return d||d===0?d:c;};apf.getBox=function(j,g){if(!g){g=0;}if(j==null||(!parseInt(j)&&parseInt(j)!=0)){return[0,0,0,0];}var c=String(j).split(" ");for(var d=0;d<c.length;d++){c[d]=parseInt(c[d])||0;}switch(c.length){case 1:c[1]=c[0];c[2]=c[0];c[3]=c[0];break;case 2:c[2]=c[0];c[3]=c[1];break;case 3:c[3]=c[1];break;}return c;};apf.getNode=function(g,c){var j=0;if(g!=null){for(var d=0;d<g.childNodes.length;d++){if(g.childNodes[d].nodeType==1){if(j==c[0]){g=g.childNodes[d];if(c.length>1){c.shift();g=this.getNode(g,c);}return g;}j++;}}}return null;};apf.getFirstElement=function(c){try{c.firstChild.nodeType==1?c.firstChild:c.firstChild.nextSibling;}catch(d){throw new Error(apf.formatErrorString(1052,null,"Xml Selection","Could not find element:\n"+(c?c.xml:"null")));}return c.firstChild.nodeType==1?c.firstChild:c.firstChild.nextSibling;};apf.getLastElement=function(c){try{c.lastChild.nodeType==1?c.lastChild:c.lastChild.nextSibling;}catch(d){throw new Error(apf.formatErrorString(1053,null,"Xml Selection","Could not find last element:\n"+(c?c.xml:"null")));}return c.lastChild.nodeType==1?c.lastChild:c.lastChild.previousSibling;};apf.selectTextHtml=function(d){if(!apf.hasMsRangeObject){return;}var c=document.selection.createRange();try{c.moveToElementText(d);}catch(g){}c.select();};apf.isChildOf=function(c,i,d){if(!c||!i){return false;}if(i.nodeType==2){i=i.ownerElement||i.selectSingleNode("..");}if(d&&c==i){return true;}var g=i.parentNode;while(g){if(g==c){return true;}g=g.parentNode;}return false;};apf.isOnlyChild=function(n,d){if(!n||!n.parentNode||d&&d.indexOf(n.nodeType)==-1){return false;}var j,c,k,g=n.parentNode.childNodes;for(j=0,c=g.length;j<c;j++){k=g[j];if(k.nodeType==1&&k!=n){return false;}if(k.nodeType==3&&!k.nodeValue.trim()){return false;}}return true;};apf.getChildNumber=function(k,q){var n=k.parentNode,d=0;if(!n){return 0;}if(!q){q=n.childNodes;}if(apf.hasIndexOfNodeList){return q.indexOf(k);}for(var g=0,c=q.length;g<c;g++){if(q[g]==k){return d;}d++;}return d;};apf.mergeXml=function(t,n,w){if(typeof n!="object"){n=getElementById(n);}if(w&&w.clearContents){var d,g,k,c=n.selectNodes("descendant::node()[@"+apf.xmldb.xmlListenTag+"]");for(k=c.length-1;k>=0;k--){var u=c[k].getAttribute(apf.xmldb.xmlListenTag).split(";");for(g=u.length-1;g>=0;g--){d=apf.all[u[g]];if(d.dataParent&&d.dataParent.xpath){d.dataParent.parent.signalXmlUpdate[d.$uniqueId]=true;}else{if(d.$model){d.$model.$waitForXml(d);}}}}c=n.childNodes;for(k=c.length-1;k>=0;k--){n.removeChild(c[k]);}}beforeNode=w&&w.beforeNode?w.beforeNode:apf.getNode(n,[0]);c=t.childNodes;if(n.ownerDocument.importNode){doc=n.ownerDocument;for(k=0,l=c.length;k<l;k++){n.insertBefore(doc.importNode(c[k],true),beforeNode);}}else{for(k=c.length-1;k>=0;k--){n.insertBefore(c[0],beforeNode);}}if(w&&w.copyAttributes){var q=t.attributes;for(k=0;k<q.length;k++){if(q[k].nodeName!=apf.xmldb.xmlIdTag){n.setAttribute(q[k].nodeName,q[k].nodeValue);}}}return n;};apf.setNodeValue=function(k,j,q,i){if(!k){return;}var n,c,g;if(i){n=i.undoObj;c=i.xpath;g=i.newNodes;n.extra.oldValue=i.forceNew?"":apf.queryValue(k,c);n.xmlNode=k;if(c){k=apf.createNodeFromXpath(k,c,g,i.forceNew);}n.extra.appliedNode=k;}if(k.nodeType==1){if(!k.firstChild){k.appendChild(k.ownerDocument.createTextNode("-"));}k.firstChild.nodeValue=apf.isNot(j)?"":j;if(q){apf.xmldb.applyChanges("synchronize",k,n);}}else{var d=k.nodeValue;k.nodeValue=apf.isNot(j)?"":j;if(k.$triggerUpdate){k.$triggerUpdate(null,d);}if(q){apf.xmldb.applyChanges("synchronize",k.parentNode||k.ownerElement||k.selectSingleNode(".."),n);}}};apf.setQueryValue=function(d,c,i){var g=apf.createNodeFromXpath(d,c);if(!g){return null;}apf.setNodeValue(g,i,true);return g;};apf.queryValue=function(d,c){if(!d){return"";}if(d.nodeType==2){return d.nodeValue;}if(c){d=d.selectSingleNode(c);if(!d){return"";}}return d.nodeType==1?(!d.firstChild?"":d.firstChild.nodeValue):d.nodeValue;};apf.queryValues=function(k,d){var g=[];if(!k){return g;}var c=k.selectNodes(d);if(!c.length){return g;}for(var j=0;j<c.length;j++){var q=c[j];if(q.nodeType==1){q=q.firstChild;}g.push(q.nodeValue||"");}return g;};apf.queryNodes=function(d,c){if(c&&(apf.hasXPathHtmlSupport&&c.selectSingleNode||!c.style)){return c.selectNodes(d);}return apf.XPath.selectNodes(d,c);};apf.queryNode=function(d,c){if(c&&(apf.hasXPathHtmlSupport&&c.selectSingleNode||!c.style)){return c.selectSingleNode(d);}var g=apf.queryNodes(d+(apf.isIE?"":"[1]"),c?c:null);return g.length>0?g[0]:null;};apf.getInheritedAttribute=function(i,g,j){var d,c;if(i.nodeValue!=1){i=i.parentNode;}while(i&&(i.nodeType!=1||!(d=g&&((c=i.getAttribute(g))||typeof c=="string")||j&&j(i)))){i=i.parentNode;}if(c==""){return"";}return !d&&g&&apf.config?apf.config[g]:d;};apf.createNodeFromXpath=function(k,D,n,s){var B,A="",E=D.replace(/('.*?')|(".*?")|\|/g,function(i,G,F){if(G||F){return G||F;}return"-%-|-%-";}).split("-%-|-%-")[0].split("/");if(!s&&(B=k.selectSingleNode(D))){return B;}var q=E.length-1;if(s){if(E[q].trim().match(/^\@(.*)$|^text\(\)$/)){q--;}}for(var c,t=false,g=0;g<q;g++){if(!t&&k.selectSingleNode(A+(g!=0?"/":"")+E[g])){A+=(g!=0?"/":"")+E[g];continue;}var d=E[g].match(/(\w+)\[@([\w-]+)=(\w+)\]/);if(!d&&E[g].match(/\@|\[.*\]|\(.*\)/)){throw new Error(apf.formatErrorString(1041,this,"Select via xPath","Could not use xPath to create xmlNode: "+D));}if(!d&&E[g].match(/\/\//)){throw new Error(apf.formatErrorString(1041,this,"Select via xPath","Could not use xPath to create xmlNode: "+D));}if(d){E[g]=d[1];}t=true;c=k.selectSingleNode(A||".").appendChild(k.ownerDocument.createElement(E[g]));if(d){c.setAttribute(d[2],d[3]);A+=(A?"/":"")+d[0];}else{A+=(A?"/":"")+E[g];}if(n){n.push(c);}}if(!A){A=".";}var w,j=E[q],u=k.nodeType==9?k:k.ownerDocument;do{if(j.match(/^\@(.*)$/)){(w||k.selectSingleNode(A)).setAttributeNode(w=k.ownerDocument.createAttribute(RegExp.$1));}else{if(j.trim()=="text()"){w=(w||k.selectSingleNode(A)).appendChild(k.ownerDocument.createTextNode(""));}else{var C=j.match(/(\w+)\[@([\w-]+)=(\w+)\]/);if(C){j=C[1];}w=(w||k.selectSingleNode(A)).appendChild(u.createElement(j));if(C){w.setAttribute(C[2],C[3]);}if(n){n.push(w);}}}A+=(A?"/":"")+E[q];}while((j=E[++q]));return w;};apf.convertMethods={json:function(c){return JSON.stringify(apf.xml2json(c));},cgivars:function(u,B){if(!B){B="";}var C,d,n,s,g,A=[],c=u.childNodes,q={},t=0,k=c.length;for(;t<k;++t){if(c[t].nodeType!=1){continue;}d=c[t].tagName;if(q[d]){continue;}n=u.selectNodes(d);if(n.length>1){q[d]=true;for(s=0,g=n.length;s<g;s++){C=this.cgivars(n[s],B+d+"["+s+"]");if(C){A.push(C);}}}else{C=this.cgivars(c[t],B+d);if(C){A.push(C);}}}var w=u.attributes;for(t=0,k=w.length;t<k;t++){if(w[t].nodeValue){if(B){A.push(B+"["+w[t].nodeName+"]="+escape(w[t].nodeValue));}else{A.push(w[t].nodeName+"="+escape(w[t].nodeValue));}}}if(A.length){return A.join("&");}C=apf.queryValue(u,"text()");if(B&&C){return B+"="+escape(C);}return"";},cgiobjects:function(t,A,E,F){if(!A){A="";}var g=t.childNodes,n;var k=[],D={};var G="",d,C;var B,s,q;var u,c;var w;for(s=0;s<g.length;s++){n=g[s];if(n.nodeType==1){d=n.tagName;w=n.parentNode.selectNodes(d).length==1?true:false;if(typeof D[d]=="undefined"){D[d]=0;}G=A+(E?"[":"")+d+(E?"]":"")+(w?"":"["+D[d]+"]");u=n.attributes;c=n.attributes.length;if(c>0){for(q=0;q<c;q++){if(!(B=u[q]).nodeValue){continue;}k.push(G+"[_"+B.nodeName+"]="+escape(B.nodeValue.trim()));}}C=this.cgiobjects(n,G,true);if(C.dataType!==1){k.push(C);}else{if(n.firstChild&&n.firstChild.nodeValue.trim()){k.push(G+(c>0?"[_]=":"=")+escape(n.firstChild.nodeValue.trim()));}else{if(c==0){if(F){k.push(G);}}}}D[d]++;}}if(!E&&t.getAttribute("id")){k.push("id="+escape(t.getAttribute("id")));}if(k.length){return k.join("&");}return k;}};apf.convertXml=function(c,d){return apf.convertMethods[d](c);};apf.getTextNode=function(c){for(var g=0,d=c.childNodes.length;g<d;++g){if(c.childNodes[g].nodeType==3||c.childNodes[g].nodeType==4){return c.childNodes[g];}}return false;};apf.getBoundValue=function(d,i,g){if(!i&&!d.xmlRoot){return"";}var c=d.$getDataNode("value",d.xmlRoot);return c?apf.queryValue(c):"";};apf.getArrayFromNodelist=function(i){for(var d=[],g=0,c=i.length;g<c;++g){d.push(i[g]);}return d;};apf.serializeChildren=function(j){var n,k=[],d=j.childNodes,g=0,c=d.length;for(;g<c;++g){k[g]=(n=d[g]).nodeType==1?n.xml||n.serialize():(n.nodeType==8?"":n.nodeValue);}return k.join("");};apf.getXmlString=function(d){var c=apf.xmldb.cleanNode(d.cloneNode(true));return c.xml||c.serialize();};apf.getXml=function(g,c,d){return apf.getXmlDom(g,c,d).documentElement;};apf.formatXml=function(k){k=k.trim();var d=k.split("\n"),j=0,g=0,c=d.length;for(;g<c;++g){d[g]=d[g].trim();}d=d.join("\n").replace(/\>\n/g,">").replace(/\>/g,">\n").replace(/\n\</g,"<").replace(/\</g,"\n<").split("\n");d.removeIndex(0);d.removeIndex(d.length);for(g=0,c=d.length;g<c;g++){d[g]="    ".repeat((d[g].match(/^\s*\<\//)?(j==0)?0:--j:(d[g].match(/^\s*\<[^\?][^>]+[^\/]\>/)?j++:j)))+d[g];}if(!k){return"";}return d.join("\n");};apf.xmlToXpath=function(t,u,s){if(!t){return"";}if(s===true&&t.nodeType==1&&t.getAttribute(apf.xmldb.xmlIdTag)){return"//node()[@"+apf.xmldb.xmlIdTag+"='"+t.getAttribute(apf.xmldb.xmlIdTag)+"']";}if(apf!=this&&this.lookup&&this.select){var k,d=this.lookup[t.tagName];if(d){k=t.selectSingleNode(d).nodeValue;return"//"+t.tagName+"["+d+"='"+k+"']";}for(var n=0,j=this.select.length;n<j;n++){if(t.selectSingleNode(this.select[n][0])){k=t.selectSingleNode(this.select[n][1]).nodeValue;return"//"+this.select[n][0]+"["+this.select[n][1]+"='"+k+"']";}}}if(t==u){return".";}if(!t.parentNode&&!t.ownerElement){throw new Error(apf.formatErrorString(0,null,"Converting XML to Xpath","Error xml node without parent and non matching context cannot             be converted to xml.",t));return false;}var q=[],g=t;if(g.nodeType==2){q.push("@"+g.nodeName);g=g.ownerElement||t.selectSingleNode("..");}var c;do{q.unshift((g.nodeType==1?g.tagName:"text()")+"["+(s&&(c=g.nodeType==1&&g.getAttribute(apf.xmldb.xmlIdTag))?"@"+apf.xmldb.xmlIdTag+"='"+c+"'":(apf.getChildNumber(g,g.parentNode.selectNodes(g.tagName))+1))+"]");g=g.parentNode;}while(g&&g.nodeType==1&&g!=u);return q.join("/");};apf.xpathToXml=function(c,d){if(!d){throw new Error(apf.formatErrorString(0,null,"Converting Xpath to XML","Error context xml node is empty, thus xml node cannot              be found for '"+c+"'"));return false;}return d.selectSingleNode(c);};apf.popup={cache:{},focusFix:{INPUT:1,TEXTAREA:1,SELECT:1},setContent:function(j,i,g,d,c){if(!this.popup){this.init();}this.cache[j]={content:i,style:g,width:d,height:c};i.style.position="absolute";i.onmousedown=function(k){if(!k){k=event;}if(apf.hasFocusBug&&!apf.popup.focusFix[(k.srcElement||k.target).tagName]){apf.window.$focusfix();}(k||event).cancelBubble=true;};return i.ownerDocument;},removeContent:function(c){this.cache[c]=null;delete this.cache[c];},init:function(){this.popup={};apf.addEventListener("hotkey",function(c){if(c.keyCode=="27"||c.altKey){apf.popup.forceHide();}});},show:function(u,w){w=apf.extend({x:0,y:0,animate:false,ref:null,width:null,height:null,callback:null,draggable:false,resizable:false,allowTogether:false,autoCorrect:true},w);if(!this.popup){this.init();}if((!w.allowTogether||w.allowTogether!=this.last)&&this.last!=u){this.hide();}var g=this.cache[u];g.options=w;var c=g.content,k=false;if(!g.content.style.zIndex){g.content.style.zIndex=10000000;}if(g.content.style.display&&g.content.style.display.indexOf("none")>-1){g.content.style.display="";}if(w.ref){var q=apf.getAbsolutePosition(w.ref,g.content.offsetParent||g.content.parentNode),s=(w.y||0)+q[1],d=apf.getOverflowParent(g.content);if(w.width||g.width){c.style.width=((w.width||g.width)-3)+"px";}k=w.autoCorrect&&(s+(w.height||g.height||g.content.offsetHeight))>(d==document.documentElement?(apf.isIE?d.offsetHeight:(window.innerHeight+window.pageYOffset))+d.scrollTop:d.offsetHeight+d.scrollTop);c.style.top=(k?(s-(w.height||g.height||g.content.offsetHeight)-(w.y||0)):s)+"px";c.style.left=((w.x||0)+q[0])+"px";}apf.setStyleClass(c,k?"upward":"downward",[k?"downward":"upward"]);if(w.animate){if(w.animate=="fade"){apf.tween.single(c,{type:"fade",from:0,to:1,anim:apf.tween.NORMAL,steps:apf.isIE?5:10,onfinish:function(){if(apf.isIE){c.style.filter="";}}});}else{var t,n=apf.isIE8?5:7,j=0;t=setInterval(function(){var i=++j*((w.height||g.height)/n);c.style.height=i+"px";if(k){c.style.top=(s-i-(w.y||0))+"px";}else{c.scrollTop=-1*(j-n)*((w.height||g.height)/n);}c.style.display="block";if(j>=n){clearInterval(t);if(w.callback){w.callback(c);}}},10);}}else{if(w.height||g.height){c.style.height=(w.height||g.height)+"px";}c.style.top=(s)+"px";c.style.display="block";if(w.callback){w.callback(c);}}$setTimeout(function(){apf.popup.last=u;});if(w.draggable){w.id=u;this.makeDraggable(w);}},hide:function(){if(this.isDragging){return;}var c=this.cache[this.last];if(c){if(c.content){c.content.style.display="none";}if(c.options&&c.options.onclose){c.options.onclose(apf.extend(c.options,{htmlNode:c.content}));c.options.onclose=false;}}},isShowing:function(c){return this.last&&this.last==c&&this.cache[this.last]&&this.cache[this.last].content.style.display!="none";},isDragging:false,makeDraggable:function(c){if(!apf.Interactive||this.cache[c.id].draggable){return;}var d=this.cache[c.id].content;this.cache[c.id].draggable=true;var g={$propHandlers:{},minwidth:10,minheight:10,maxwidth:10000,maxheight:10000,dragOutline:false,resizeOutline:false,draggable:true,resizable:c.resizable,$ext:d,oDrag:d.firstChild};d.onmousedown=d.firstChild.onmousedown=function(i){if(!i){i=event;}if(apf.hasFocusBug&&!apf.popup.focusFix[(i.srcElement||i.target).tagName]){apf.window.$focusfix();}(i||event).cancelBubble=true;};apf.implement.call(g,apf.Interactive);g.$propHandlers.draggable.call(g,true);g.$propHandlers.resizable.call(g,true);},forceHide:function(){if(this.last&&!apf.plane.current&&this.isShowing(this.last)){var c=apf.lookup(this.last);if(!c){this.last=null;}else{if(c.dispatchEvent("popuphide")!==false){this.hide();}}}},destroy:function(){for(var c in this.cache){if(this.cache[c]){this.cache[c].content.onmousedown=null;apf.destroyHtmlNode(this.cache[c].content);this.cache[c].content=null;this.cache[c]=null;}}if(!this.popup){return;}}};apf.nameserver={lookup:{},add:function(c,d){if(!this.lookup[c]){this.lookup[c]=[];}if(this.onchange){this.onchange(c,d);}return this.lookup[c].push(d)-1;},register:function(c,g,d){if(!this.lookup[c]){this.lookup[c]={};}if(this.onchange){this.onchange(c,d,g);}return(this.lookup[c][g]=d);},remove:function(c,d){var g=this.lookup[c];if(g){for(var i in g){if(g[i]==d){delete g[i];}}}},get:function(c,d){return this.lookup[c]?this.lookup[c][d]:null;},getAll:function(k){var g,c=[],d=this.lookup[k];if(!d){return c;}if(d.dataType==apf.ARRAY){for(var j=0;j<d.length;j++){c.push(d[j]);}}else{for(g in d){c.push(d[g]);}}return c;},getAllNames:function(g){var d,c=[];for(d in this.lookup[g]){if(parseInt(d)==d){continue;}c.push(d);}return c;}};apf.config=new apf.Class().$init();apf.extend(apf.config,{disableRightClick:false,allowSelect:false,allowBlur:true,autoDisableActions:true,autoDisable:false,disableF5:true,autoHideLoading:true,disableSpace:true,defaultPage:"home",disableBackspace:true,undokeys:false,outline:false,dragOutline:false,resizeOutline:false,autoDisableNavKeys:true,disableTabbing:false,resourcePath:null,initdelay:true,liveText:false,iphoneFullscreen:true,iphoneStatusbar:"default",iphoneIcon:null,iphoneIconIsGlossy:false,iphoneFixedViewport:true,skinset:"default",name:self.window&&window.location.href.replace(/[^0-9A-Za-z_]/g,"_"),tags:{},defaults:{},baseurl:"",model:"@default","empty-message":"No items","loading-message":"Loading...","offline-message":"You are currently offline.",setDefaults:function(){},getDefault:function(g,k){var j=this.defaults[g];if(!j){return;}for(var c=j.length-1;c>=0;c--){if(j[c][0]==k){return j[c][1];}}},setProperty:function(c,d){this[c.replace(/-(\w)/g,function(g,i){return i.toUpperCase();})]=this[c]=d;(this.$propHandlers&&this.$propHandlers[c]||apf.GuiElement.propHandlers[c]||apf.K).call(this,d);},$inheritProperties:{},$propHandlers:{baseurl:function(c){this.baseurl=apf.parseExpression(c);},language:function(c){},layout:function(c){apf.queue.add("layout",function(){apf.setModel(apf.config.layout,apf.layout);});},"resource-path":function(c){this.resourcePath=apf.parseExpression(c||"").replace(/resources\/?|\/$/g,"");},skinset:function(c){if(this.$amlLoaded){apf.skins.changeSkinset(c);}},outline:function(c){this.dragOutline=this.resizeOutline=this.outline=apf.isTrue(c);},"drag-outline":function(c){this.dragOutline=c?apf.isTrue(c):false;},"resize-outline":function(c){this.resizeOutline=c?!apf.isFalse(c):false;},storage:function(c){if(c){apf.storage.init(c);}},"disable-f5":function(c){if(apf.isDeskrun&&c){shell.norefresh=true;}},debug:function(c){if(c){apf.$debugwin.activate();apf.addEventListener("load",function(){apf.removeEventListener("load",arguments.callee);});}apf.debug=c;}}});apf.offline={onLine:true};apf.tween=(function(G){var S={left:function(W,V){W.style.left=V+u;},right:function(W,V){W.style.left="";W.style.right=V+u;},top:function(W,V){W.style.top=V+u;},bottom:function(W,V){W.style.top="";W.style.bottom=V+u;},width:function(X,W,V){X.style.width=W+u;},height:function(X,W,V){X.style.height=W+u;},scrollTop:function(X,W,V){X.scrollTop=W;},scrollLeft:function(X,W,V){X.scrollLeft=W;},"height-rsz":function(X,W,V){X.style.height=W+u;if(G.hasSingleResizeEvent){window.onresize();}},mwidth:function(W,V,Y){var X=G.getDiff(W);W.style.width=V+u;W.style.marginLeft=-1*(V/2+(parseInt(G.getStyle(W,"borderLeftWidth"))||X[0]/2)+(Y.margin||0))+u;},mheight:function(W,V,Y){var X=G.getDiff(W);W.style.height=V+u;W.style.marginTop=(-1*V/2-(parseInt(G.getStyle(W,"borderTopWidth"))||X[1]/2)+(Y.margin||0))+u;},scrollwidth:function(W,V){W.style.width=V+u;W.scrollLeft=W.scrollWidth;},scrollheight_old:function(W,V){try{W.style.height=V+u;W.scrollTop=W.scrollHeight;}catch(X){alert(V);}},scrollheight:function(X,W,Z){var Y=G.getHeightDiff(X),V=Z.$int||X;X.style.height=Math.max((W+(Z.diff||0)),0)+u;V.scrollTop=V.scrollHeight-V.offsetHeight-Y+(Z.diff||0);},scrolltop:function(W,V){W.style.height=V+u;W.style.top=(-1*V-2)+u;W.scrollTop=0;},clipright:function(X,W,V){X.style.clip="rect(auto, auto, auto, "+W+"px)";X.style.marginLeft=(-1*W)+u;},fade:function(W,V){if(!G.supportOpacity&&G.hasStyleFilters){W.style.filter="alpha(opacity="+parseInt(V*100)+")";}else{W.style.opacity=V;}},bgcolor:function(W,V){W.style.backgroundColor=V;},textcolor:function(W,V){W.style.color=V;},htmlcss:function(W,V,X){if(G.hasStyleFilters&&X.type=="filter"){W.style.filter="progid:DXImageTransform.Microsoft.Alpha(opacity="+V+")";}else{W.style[X.type]=V+(X.needsPx?u:"");}},transformscale:function(W,V,X){W.style[X.type]=t+parseFloat(V)+n;},transformrotate:function(W,V,X){W.style[X.type]=P+parseFloat(V)+O;},transformvalscale:function(V){return t+parseFloat(V)+n;},transformvalrotate:function(V){return P+parseFloat(V)+O;}};var w="id",u="px",B="number",E="transformval",s="transform",F="scale",t="scale(",P="rotate(",n=")",O="deg)",T=["linear","ease-in","ease-out","ease","ease-in-out","cubic-bezier"],A={left:"left",right:"right",top:"top",bottom:"bottom",width:"width",height:"height",scrollTop:false,scrollLeft:false,mwidth:false,mheight:false,scrollwidth:false,scrollheight:false,fade:"opacity",opacity:"opacity",bgcolor:"background-color",textcolor:"color",transform:"transform"},U=Math.pow,Q=Math.round,k=0,L=1,M=2,K={},I=null,i=function(V,W){if(!V.getAttribute(w)){G.setUniqueHtmlId(V);}if(!K[V.getAttribute(w)]){K[V.getAttribute(w)]=[];}K[V.getAttribute(w)].push(W);if(K[V.getAttribute(w)].length==1){W(0);}},N=function(W){var V=K[W.getAttribute(w)];if(!V){return;}V.shift();if(V.length){V[0](0);}},g=function(X,V){var W=K[X.getAttribute(w)];if(!W){return;}if(V&&I&&I.control){I.control.stop=true;}W.length=0;},q=function(aa,ab,X,W){var Z=0,V=W-1,Y=[ab];if(typeof aa==B){if(!aa){aa=G.tween.linear;}else{if(aa==1){aa=G.tween.easeInCubic;}else{if(aa==2){aa=G.tween.easeOutCubic;}}}}for(Z=0;Z<V;++Z){Y.push(aa(Z/W,ab,X-ab));}Y.push(X);return Y;},j=function(ab,V,aa,ac){var W,X,ad=G.color.colors,af=parseInt((ad[V]||V).slice(1),16),ae=parseInt((ad[aa]||aa).slice(1),16),Z=0,Y=[];for(;Z<ac;Z++){X=Z/(ac-1),W=1-X;Y[Y.length]="#"+("000000"+((Q((af&255)*W+(ae&255)*X)&255)|(Q((af&65280)*W+(ae&65280)*X)&65280)|(Q((af&16711680)*W+(ae&16711680)*X)&16711680)).toString(16)).slice(-6);}return Y;},R=function(V,W){W=G.extend({steps:3,interval:20,anim:G.tween.linear,control:{}},W);if(V.nodeFunc>100){W.$int=V.$int;V=V.$ext;}try{if("fixed|absolute|relative".indexOf(G.getStyle(V,"position"))==-1){V.style.position="relative";}}catch(Z){}var ad=(G.supportCSSAnim&&G.supportCSSTransition&&A[W.type]),Y=(W.type==s);W.method=ad?W.type:Y?S[s+(W.subType||F)]:S[W.type]||S.htmlcss;var ad=(G.supportCSSAnim&&G.supportCSSTransition&&A[W.type]),Y=(W.type==s);W.method=ad?W.type:Y?S[s+(W.subType||F)]:S[W.type]||S.htmlcss;if(!W.method){throw new Error(G.formatErrorString(0,this,"Single Value Tween","Could not find method for tweening operation '"+W.type+"'"));}if(ad){var aa=A[W.type];if(aa===false){return G.tween;}W.type=aa||W.type;if(Y){if(!W.subType){W.subType=F;}W.type=G.supportCSSAnim;}var X=(Y)?S[E+(W.subType||F)]:null;V.style[W.type]=Y?X(W.from):W.from+(D[W.type]?u:"");$setTimeout(function(){V.style[W.type]=Y?X(W.to):W.to+(D[W.type]?u:"");V.offsetTop;V.style[G.cssPrefix+"Transition"]=W.type+" "+((W.steps*W.interval)/1000)+"s "+T[W.anim||0];var ae=function(){if(W.onfinish){W.onfinish(V,W.userdata);}V.style[G.cssPrefix+"Transition"]="";V.removeEventListener(G.cssAnimEvent,ae);};V.addEventListener(G.cssAnimEvent,ae);});return G.tween;}if(W.control){W.control.stop=function(){W.control.state=L;g(V);if(W.onstop){W.onstop(V,W.userdata);}};}var ac=W.color?j(W.anim,W.from,W.to,W.steps):q(W.anim,parseFloat(W.from),parseFloat(W.to),W.steps),ab=function(ae){if(W.control&&W.control.state){W.control.state=M;return;}I=W;if(W.onbeforeeach&&W.onbeforeeach(V,W.userdata)===false){return;}try{W.method(V,ac[ae],W);}catch(af){}if(W.oneach){W.oneach(V,W.userdata);}if(ae<W.steps){return $setTimeout(function(){ab(ae+1);},W.interval);}I=null;if(W.control){W.control.state=M;}if(W.onfinish){W.onfinish(V,W.userdata);}N(V);};i(V,ab);return G.tween;},J=function(Y,ao){ao=G.extend({steps:3,interval:20,anim:G.tween.linear,control:{}},ao);if(Y.nodeFunc>100){ao.$int=Y.$int;Y=Y.$ext;}var an,ab,af=G.supportCSSAnim&&G.supportCSSTransition,ad=false,V=((ao.steps*ao.interval)/1000),W=T[ao.anim||0],am=[],ah=[],al=0,ai=ao.tweens.length;for(;al<ai;al++){var ap=ao.tweens[al];if(ap.oHtml&&ap.oHtml.nodeFunc>100){ap.$int=ap.oHtml.$int;ap.oHtml=ap.oHtml.$ext;}an=(af&&A[ap.type]);ab=(ap.type==s);if(ab){if(!ap.subType){ap.subType=F;}ap.type=G.supportCSSAnim;}ap.method=an?ap.type:ab?S[s+(ap.subType)]:S[ap.type]||S.htmlcss;if(!ap.method){throw new Error(G.formatErrorString(0,this,"Multi Value Tween","Could not find method for tweening operation '"+ap.type+"'"));}if(an){var X=ab?ap.type:A[ap.type];ap.type=X||ap.type;var ae=S[E+(ap.subType)];Y.style[ap.type]=ab?ae(ap.from):ap.from+(D[ap.type]?u:"");ah.push([ap.type,ab?ae(ap.to):ap.to+(D[ap.type]?u:"")]);am.push(ap.type+" "+V+"s "+W+" 0");ad=true;}else{am.push(ap.color?j(ao.anim,ap.from,ap.to,ao.steps):q(ao.anim,parseFloat(ap.from),parseFloat(ap.to),ao.steps));}}if(ad){Y.style[G.cssPrefix+"Transition"]=am.join(",");Y.offsetTop;var aa=0,Z=function(){aa++;if(aa==ah.length){if(ao.onfinish){ao.onfinish(Y,ao.userdata);}Y.style[G.cssPrefix+"Transition"]="";Y.removeEventListener(G.cssAnimEvent,Z);}};Y.addEventListener(G.cssAnimEvent,Z,false);for(var aj=0,ak=ah.length;aj<ak;aj++){Y.style[ah[aj][0]]=ah[aj][1];}return G.tween;}if(ao.control){ao.control.stop=function(){ao.control.state=L;g(Y);if(ao.onstop){ao.onstop(Y,ao.userdata);}};}var ag=ao.tweens,ac=function(ar){if(ao.control&&ao.control.state){ao.control.state=M;return;}I=ao;try{for(var aq=0;aq<am.length;aq++){ag[aq].method(ag[aq].oHtml||Y,am[aq][ar],ag[aq]);}}catch(at){}if(ao.oneach){ao.oneach(Y,ao.userdata);}if(ar<ao.steps){return $setTimeout(function(){ac(ar+1);},ao.interval);}I=null;if(ao.control){ao.control.state=M;}if(ao.onfinish){ao.onfinish(Y,ao.userdata);}N(Y);};i(Y,ac);return G.tween;},C=function(Z,W,al,am){(al=al||{}).tweens=[];if(Z.nodeFunc>100){Z=Z.$ext;}if(am){G.setStyleClass(Z,"",[W]);}var ah=function(an,ap){if(an){G.setStyleClass(Z,"",[W]);}else{G.setStyleClass(Z,W);}for(var ao=0;ao<al.tweens.length;ao++){if(al.tweens[ao].type=="filter"){continue;}Z.style[al.tweens[ao].type]="";}if(ap){ap.apply(this,arguments);}};var V=al.onfinish,Y=al.onstop;al.onfinish=function(){ah(am,V);};al.onstop=function(){ah(!am,Y);};var ad,aa,ae,ag,ak,aj,ac,ai,af={};for(ai=0;ai<document.styleSheets.length;ai++){ac=document.styleSheets[ai][G.styleSheetRules];for(ag=ac.length-1;ag>=0;ag--){var ab=ac[ag];if(!ab.style||!ab.selectorText.match("."+W+"$")){continue;}for(aj in ab.style){if(!ab.style[aj]||d.indexOf("|"+aj+"|")==-1){continue;}if(aj=="filter"){if(!ab.style[aj].match(/opacity\=([\d\.]+)/)){continue;}aa=RegExp.$1;ad=(G.getStyleRecur(Z,aj)||"").match(/opacity\=([\d\.]+)/);ae=ad?RegExp.$1:100;ak=false;if(aa==ae){if(am){ae=100;}else{aa=100;}}}else{aa=am&&Z.style[aj]||ab.style[aj];if(am){Z.style[aj]="";}ae=G.getStyleRecur(Z,aj);ak=aj.match(/color/i)?true:false;}af[aj]={type:aj,from:(ak?String:parseFloat)(am?aa:ae),to:(ak?String:parseFloat)(am?ae:aa),color:ak,needsPx:D[aj.toLowerCase()]||false};}}}for(var X in af){al.tweens.push(af[X]);}if(am){G.setStyleClass(Z,W);}return J(Z,al);},c=function(W,V,X){C(W,V,X,true);},D={left:true,top:true,bottom:true,right:true,width:true,height:true,fontSize:true,lineHeight:true,textIndent:true},d="|backgroundColor|backgroundPosition|color|width|filter|height|left|top|bottom|right|fontSize|letterSpacing|lineHeight|textIndent|opacity|paddingLeft|paddingTop|paddingRight|paddingBottom|borderLeftWidth|borderTopWidth|borderRightWidth|borderBottomWidth|borderLeftColor|borderTopColor|borderRightColor|borderBottomColor|marginLeft|marginTop|marginRight|marginBottom|transform|",H="|scale|rotate|";return{single:R,multi:J,css:C,cssRemove:c,clearQueue:g,addModule:function(V,W,X){if(typeof V!="string"||typeof W!="function"||(S[V]&&!X)){return this;}S[V]=W;return this;},NORMAL:0,EASEIN:1,EASEOUT:2,linear:function(W,X,V){return V*W+X;},easeInQuad:function(W,X,V){return V*U(W,2)+X;},easeOutQuad:function(W,X,V){return -V*W*(W-2)+X;},easeInOutQuad:function(W,X,V){if((W/=0.5)<1){return V/2*W*W+X;}return -V/2*((--W)*(W-2)-1)+X;},easeInCubic:function(W,X,V){return V*Math.pow(W,3)+X;},easeOutCubic:function(W,X,V){return V*(U(W-1,3)+1)+X;},easeInOutCubic:function(W,X,V){if((W/=0.5)<1){return V/2*__(W,3)+X;}return V/2*(__(W-2,3)+2)+X;},easeInQuart:function(W,X,V){return V*U(W,4)+X;},easeOutQuart:function(W,X,V){return -V*(U(W-1,4)-1)+X;},easeInOutQuart:function(W,X,V){if((W/=0.5)<1){return V/2*U(W,4)+X;}return -V/2*(U(W-2,4)-2)+X;},easeInQuint:function(W,X,V){return V*U(W,5)+X;},easeOutQuint:function(W,X,V){return V*(U(W-1,5)+1)+X;},easeInOutQuint:function(W,X,V){if((W/=0.5)<1){return V/2*U(W,5)+X;}return V/2*(U(W-2,5)+2)+X;},easeInSine:function(W,X,V){return -V*Math.cos(W*(Math.PI/2))+V+X;},easeOutSine:function(W,X,V){return V*Math.sin(W*(Math.PI/2))+X;},easeInOutSine:function(W,X,V){return -V/2*(Math.cos(Math.PI*W)-1)+X;},easeInExpo:function(W,X,V){return(W==0)?X:V*U(2,10*(W-1))+X;},easeOutExpo:function(W,X,V){return(W==1)?X+V:V*(-U(2,-10*W)+1)+X;},easeInOutExpo:function(W,X,V){if(W==0){return X;}if(W==1){return X+V;}if((W/=0.5)<1){return V/2*U(2,10*(W-1))+X;}return V/2*(-U(2,-10*--W)+2)+X;},easeInCirc:function(W,X,V){return -V*(Math.sqrt(1-W*W)-1)+X;},easeOutCirc:function(W,X,V){return V*Math.sqrt(1-(W-=1)*W)+X;},easeInOutCirc:function(W,X,V){if((W/=0.5)<1){return -V/2*(Math.sqrt(1-W*W)-1)+X;}return V/2*(Math.sqrt(1-(W-=2)*W)+1)+X;},easeInElastic:function(X,aa,W){var Y=1.70158,Z=0.3,V=W;if(X==0){return aa;}if(X==1){return aa+W;}if(!V||V<Math.abs(W)){V=W;Y=Z/4;}else{Y=Z/(2*Math.PI)*Math.asin(W/V);}return -(V*U(2,10*(X-=1))*Math.sin((X*1-Y)*(2*Math.PI)/Z))+aa;},easeOutElastic:function(X,aa,W){var Y=1.70158,Z=0.3,V=W;if(X==0){return aa;}if(X==1){return aa+W;}if(V<Math.abs(W)){V=W;Y=Z/4;}else{Y=Z/(2*Math.PI)*Math.asin(W/V);}return V*U(2,-10*X)*Math.sin((X-Y)*(2*Math.PI)/Z)+W+aa;},easeInOutElastic:function(X,aa,W){var Y=1.70158,Z=0,V=W;if(X==0){return aa;}if((X/2)==2){return aa+W;}if(!Z){Z=0.3*1.5;}if(V<Math.abs(W)){V=W;Y=Z/4;}else{Y=Z/(2*Math.PI)*Math.asin(W/V);}if(X<1){return -0.5*(V*U(2,10*(X-=1))*Math.sin((X-Y)*(2*Math.PI)/Z))+aa;}return V*U(2,-10*(X-=1))*Math.sin((X-Y)*(2*Math.PI)/Z)*0.5+W+aa;},easeInBack:function(W,Y,V){var X=1.70158;return V*U(W,2)*((X+1)*W-X)+Y;},easeOutBack:function(W,Y,V){var X=1.70158;return V*((W-=1)*W*((X+1)*W+X)+1)+Y;},easeInOutBack:function(W,Y,V){var X=1.70158;if((W/2)<1){return V/2*(W*W*(((X*=(1.525))+1)*W-X))+Y;}return V/2*((W-=2)*W*(((X*=(1.525))+1)*W+X)+2)+Y;},easeInBounce:function(W,X,V){return V-G.tween.easeOutBounce(1-W,0,V)+X;},easeOutBounce:function(W,X,V){if(W<(1/2.75)){return V*(7.5625*W*W)+X;}else{if(W<(2/2.75)){return V*(7.5625*(W-=(1.5/2.75))*W+0.75)+X;}else{if(W<(2.5/2.75)){return V*(7.5625*(W-=(2.25/2.75))*W+0.9375)+X;}else{return V*(7.5625*(W-=(2.625/2.75))*W+0.984375)+X;}}}},easeInOutBounce:function(W,X,V){if(W<1/2){return G.tween.easeInBounce(W*2,0,V)*0.5+X;}return G.tween.easeOutBounce(W*2-1,0,V)*0.5+V*0.5+X;}};})(apf);apf.date=(function(){return{masks:{"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"},i18n:{beginWeekday:1,dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNumbers:{Sun:0,Mon:1,Tue:2,Wed:3,Thu:4,Fri:5,Sat:6,Sunday:0,Monday:1,Tuesday:2,Wednesday:3,Thursday:4,Friday:5,Saturday:6},monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"],monthNumbers:{Jan:0,Feb:1,Mar:2,Apr:3,May:4,Jun:5,Jul:6,Aug:7,Sep:8,Oct:9,Nov:10,Dec:11}}};})();apf.date.dateFormat=(function(){var c=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,d=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,i=/[^-+\dA-Z]/g,g=function(k,j){k=String(k);j=j||2;while(k.length<j){k="0"+k;}return k;};return function(t,J,E){var n=apf.date;if(arguments.length==1&&(typeof t=="string"||t instanceof String)&&!/\d/.test(t)){J=t;t=undefined;}t=t?new Date(t):new Date();if(isNaN(t)){return"NaN";}J=String(n.masks[J]||J||n.masks["default"]);if(J.slice(0,4)=="UTC:"){J=J.slice(4);E=true;}var G=E?"getUTC":"get",A=t[G+"Date"](),j=t[G+"Day"](),u=t[G+"Month"](),C=t[G+"FullYear"](),F=t[G+"Hours"](),w=t[G+"Minutes"](),I=t[G+"Seconds"](),B=t[G+"Milliseconds"](),k=E?0:t.getTimezoneOffset(),q={d:A,dd:g(A),ddd:n.i18n.dayNames[j],dddd:n.i18n.dayNames[j+7],m:u+1,mm:g(u+1),mmm:n.i18n.monthNames[u],mmmm:n.i18n.monthNames[u+12],yy:String(C).slice(2),yyyy:C,h:F%12||12,hh:g(F%12||12),H:F,HH:g(F),M:w,MM:g(w),s:I,ss:g(I),l:g(B,3),L:g(B>99?Math.round(B/10):B),t:F<12?"a":"p",tt:F<12?"am":"pm",T:F<12?"A":"P",TT:F<12?"AM":"PM",Z:E?"UTC":(String(t).match(d)||[""]).pop().replace(i,""),o:(k>0?"-":"+")+g(Math.floor(Math.abs(k)/60)*100+Math.abs(k)%60,4),S:["th","st","nd","rd"][A%10>3?0:(A%100-A%10!=10)*A%10]};return J.replace(c,function(s){return s in q?q[s]:s.slice(1,s.length-1);});};})();apf.date.getDateTime=function(u,B){var j=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g;var n=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC:)(?:[-+]\d{4})?)\b/g;var c=0;var g,A=new Date().getFullYear(),i=1,t=1,k=12,q=0,D=0;var C=apf.date.i18n;if(!B){throw new Error(apf.formatErrorString(0,null,"date-format","Date format is null"));}B=B.replace(n,"");var w=B.replace(j,function(H,G,F){var d=u.substring(F+c,F+c+H.length);switch(H){case"d":case"m":case"h":case"H":case"M":case"s":if(!/[\/, :\-](d|m|h|H|M|s)$|^(d|m|h|H|M|s)[\/, :\-]|[\/, :\-](d|m|h|H|M|s)[\/, :\-]/.test(B)){throw new Error(apf.formatErrorString(0,null,"date-format","Dates without leading zero needs separators"));}var E=parseInt(u.substring(F+c,F+c+2));if(E.toString().length==2){c++;}return H=="d"?t=E:(H=="m"?i=E:(H=="M"?q=E:(H=="s"?D=E:k=E)));case"dd":return t=d;case"dddd":c+=C.dayNames[C.dayNumbers[d.substring(0,3)]+7].length-4;break;case"mm":return i=d;case"mmm":return i=C.monthNumbers[d]+1;case"mmmm":var s=C.monthNumbers[d.substring(0,3)];c+=C.monthNames[s+12].length-4;return i=s+1;case"yy":return A=parseInt(d)<70?"20"+d:d;case"yyyy":return A=d;case"hh":return k=d;case"HH":return k=d;case"MM":return q=d;case"ss":return D=d;case"'T'":case"'Z'":c-=2;break;}});return new Date(A,i-1,t,k,q,D);};Date.prototype.format=function(c,d){return apf.date.dateFormat(this,c,d);};Date.parse=function(d,c){return apf.date.getDateTime(d,c);};apf.xmldb=new (function(){this.xmlDocTag="a_doc";this.xmlIdTag="a_id";this.xmlListenTag="a_listen";this.htmlIdTag="id";this.disableRSB=false;this.$xmlDocLut=[];this.$nodeCount={};this.getElementById=function(i,g){if(!g){g=this.$xmlDocLut[i.split("|")[0]];}if(!g){return false;}return g.selectSingleNode("descendant-or-self::node()[@"+this.xmlIdTag+"='"+i+"']");};this.getNode=function(g){if(!g||!g.getAttribute(this.htmlIdTag)){return false;}return this.getElementById(g.getAttribute(this.htmlIdTag).split("|",2).join("|"));};this.getNodeById=function(j,i){var g=j.split("|");g.pop();return this.getElementById(g.join("|"),i);};this.getDocumentById=function(g){return this.$xmlDocLut[g];};this.getDocument=function(g){return this.$xmlDocLut[g.getAttribute(this.xmlIdTag).split("|")[0]];};this.getID=function(g,i){return g.getAttribute(this.xmlIdTag)+"|"+i.$uniqueId;};this.getElement=function(q,s){var g=q.childNodes;for(var k=0,n=0;n<g.length;n++){if(g[n].nodeType!=1){continue;}if(k++==s){return g[n];}}};this.setModel=function(g){apf.nameserver.register("model",g.data.ownerDocument.documentElement.getAttribute(this.xmlDocTag),g);};this.findModel=function(g){return apf.nameserver.get("model",g.ownerDocument.documentElement.getAttribute(this.xmlDocTag));};this.getXmlId=function(g){return g.getAttribute(this.xmlIdTag)||this.nodeConnect(apf.xmldb.getXmlDocId(g),g);};this.getHtmlNode=function(g,i){if(g&&g.nodeType==1&&g.getAttribute(this.xmlIdTag)){return i.$findHtmlNode(g.getAttribute(this.xmlIdTag)+"|"+i.$uniqueId);}return null;};this.findHtmlNode=function(g,i){do{if(g.nodeType==1&&g.getAttribute(this.xmlIdTag)){return i.$findHtmlNode(g.getAttribute(this.xmlIdTag)+"|"+i.$uniqueId);}if(g==i.xmlRoot){return null;}g=g.parentNode;}while(g&&g.nodeType!=9);return null;};this.findXmlNode=function(g){if(!g){return false;}var i;while(g&&g.nodeType==1&&(g.tagName.toLowerCase()!="body"&&!(i=g.getAttribute(this.htmlIdTag))||(i||(i=g.getAttribute(this.htmlIdTag)))&&i.match(/^q/))){if(g.host&&g.host.$ext==g){return g.host.xmlRoot;}g=g.parentNode;}if(!g||g.nodeType!=1){return false;}if(g.tagName.toLowerCase()=="body"){return false;}return this.getNode(g);};this.getXml=apf.getXml;this.nodeConnect=function(j,i,n,q){if(!this.$nodeCount[j]){this.$nodeCount[j]=0;}var k;k=i.getAttribute(this.xmlIdTag)||i.setAttribute(this.xmlIdTag,(k=j+"|"+ ++this.$nodeCount[j]))||k;if(!q){return k;}var g=k+"|"+q.$uniqueId;if(n){n.setAttribute(this.htmlIdTag,g);}return g;};this.$listeners=[];this.addNodeListener=function(i,k,j){if(!k||(!k.$xmlUpdate&&!k.setProperty)){throw new Error(apf.formatErrorString(1040,null,"Adding Node listener","Interface not supported."));}var n,g=String(i.getAttribute(this.xmlListenTag)||"");if(!j){j=String(k.$uniqueId);}if(j.charAt(0)=="p"){j=j.split("|");n=this.$listeners.push(function(){var q=apf.all[j[1]];if(q){q.$execProperty(j[2],i);}})-1;}else{n="e"+j;if(!this.$listeners[n]){this.$listeners[n]=function(q){var s=apf.all[j];if(s){s.$xmlUpdate.apply(s,q);}};}}if(!g||g.indexOf(n+";")==-1){i.setAttribute(this.xmlListenTag,(g?g+n:n)+";");}return i;};this.removeNodeListener=function(n,s,t){var k=n.getAttribute(this.xmlListenTag);var g=(k?k.split(";"):[]);if(!t){t=s.$uniqueId;}for(var q=[],j=0;j<g.length;j++){if(g[j]!=t){q.push(g[j]);}}n.setAttribute(this.xmlListenTag,q.join(";"));return n;};this.setTextNode=apf.setTextNode=function(i,k,g,n){var j;if(g){j=i.selectSingleNode(g);if(!j){return;}i=j.nodeType==1?j:null;}if(i.nodeType!=1){j=i;}else{if(i||!j){j=i.selectSingleNode("text()");if(!j){j=i.appendChild(i.ownerDocument.createTextNode(""));}}}if(n){n.extra.oldValue=j.nodeValue;}j.nodeValue=k;if(j.$regbase){j.$setValue(k);}this.applyChanges("text",j.parentNode,n);};this.setAttribute=apf.setAttribute=function(j,i,k,g,n){(g?j.selectSingleNode(g):j).setAttribute(i,k);this.applyChanges("attribute",j,n);};this.removeAttribute=apf.removeAttribute=function(j,i,g,k){if(k){k.name=i;}(g?j.selectSingleNode(g):j).removeAttribute(i);this.applyChanges("attribute",j,k);};this.replaceNode=apf.replaceNode=function(j,k,i,n){if(i){k=k.selectSingleNode(i);}if(n){n.oldNode=k;n.xmlNode=j;}var g=k.parentNode;g.replaceChild(j,k);this.copyConnections(k,j);this.applyChanges("replacechild",j,n);return j;};this.addChildNode=apf.addChildNode=function(s,q,g,j,t){var n=s.insertBefore(s.ownerDocument.createElement(q),j);for(var k=0;k<g.length;k++){n.setAttribute(g[k][0],g[k][1]);}if(t){t.extra.addedNode=n;}this.applyChanges("add",n,t);return n;};this.appendChild=apf.appendChild=function(n,k,i,s,g,q){if(s&&n.selectSingleNode(k.tagName)){return false;}if(q){this.cleanNode(k);}if(n.ownerDocument.importNode&&n.ownerDocument!=k.ownerDocument){k=n.ownerDocument.importNode(k,true);}if(g){var j=[];var n=apf.createNodeFromXpath(n,g,j);if(j.length){n.appendChild(k);while(j.length){if(n==j.pop()&&j.length){n=n.parentNode;}}}}else{if(k.parentNode){this.removeNode(k);}}n.insertBefore(k,i);this.applyChanges("add",k,q);return k;};this.moveNode=apf.moveNode=function(k,j,i,g,n){if(!n){n={extra:{}};}n.extra.oldParent=j.parentNode;n.extra.beforeNode=j.nextSibling;n.extra.parent=(g?k.selectSingleNode(g):k);this.applyChanges("move-away",j,n);if(!apf.isWebkit&&apf.xmldb.getXmlDocId(j)!=apf.xmldb.getXmlDocId(k)){j.removeAttributeNode(j.getAttributeNode(this.xmlIdTag));this.nodeConnect(apf.xmldb.getXmlDocId(k),j);}if(apf.isWebkit&&k.ownerDocument!=j.ownerDocument){j=k.ownerDocument.importNode(j,true);}n.extra.parent.insertBefore(j,i);this.applyChanges("move",j,n);};this.removeNode=apf.removeNode=function(i,g,k){if(g){i=i.selectSingleNode(g);}if(k){k.extra.parent=i.parentNode;k.extra.removedNode=i;k.extra.beforeNode=i.nextSibling;}this.applyChanges("remove",i,k);var j=i.parentNode;j.removeChild(i);this.applyChanges("redo-remove",i,null,j);};this.removeNodeList=apf.removeNodeList=function(g,q){for(var k=[],j=0;j<g.length;j++){if(q){k.push({pNode:g[j].parentNode,removedNode:g[j],beforeNode:g[j].nextSibling});}this.applyChanges("remove",g[j],q);var n=g[j].parentNode;n.removeChild(g[j]);this.applyChanges("redo-remove",g[j],null,n);}if(q){q.extra.removeList=k;}};var d={},c;this.$hasQueue=false;this.applyChanges=function(t,E,G,n){if(G&&G.$dontapply){return;}if(G&&!G.xmlNode){G.xmlNode=E;}var g=n,F=(E.nodeType==1?E:E.parentNode);if(!this.delayUpdate&&"|remove|move-away|".indexOf("|"+t+"|")>-1){this.notifyQueued();}var s,D,B,A,u,w,k,q,C,H;while(F&&F.nodeType==1){s=F.getAttribute(this.xmlListenTag);if(s){B=s.split(";");for(A=0;A<B.length;A++){D=B[A];w=d[D];if(!w){d[D]=w=[];}if("|update|attribute|text|".indexOf("|"+t+"|")>-1){H=false;for(u=0;u<w.length;u++){if(w[u]&&E==w[u][1]&&"|update|attribute|text|".indexOf("|"+w[u][0]+"|")>-1){w[u]=null;H=true;continue;}}w.push(["update",E,F,G,g]);C=true;continue;}if("|remove|move-away|move|add|".indexOf("|"+t+"|")>-1){if(this.$listeners[D]){this.$listeners[D]([t,E,F,G,g]);}}else{w.push([t,E,F,G,g]);C=true;}}}F=F.parentNode||n;if(F==n){n=null;}}if(G&&!this.delayUpdate){apf.xmldb.notifyQueued();}else{if(C){clearTimeout(c);this.$hasQueue=true;c=$setTimeout(function(){apf.xmldb.notifyQueued();});}}};this.notifyQueued=function(){this.$hasQueue=false;clearTimeout(c);for(var k in d){if(!k){continue;}var n=d[k];var j=this.$listeners[k];if(!n){continue;}for(var g=0;g<n.length;g++){if(!n[g]){continue;}j(n[g]);}}d={};};this.notifyListeners=function(k){var i=k.getAttribute(apf.xmldb.xmlListenTag);if(i){i=i.split(";");for(var g=0;g<i.length;g++){apf.all[i[g]].$xmlUpdate("synchronize",k,k);}}};this.copyConnections=function(i,g){try{g.setAttribute(this.xmlListenTag,i.getAttribute(this.xmlListenTag));}catch(j){}try{g.setAttribute(this.xmlIdTag,i.getAttribute(this.xmlIdTag));}catch(j){}};this.cleanNode=function(k){try{var j,g=k.selectNodes("descendant-or-self::node()[@"+this.xmlListenTag+"]");for(j=g.length-1;j>=0;j--){g[j].removeAttribute(this.xmlListenTag);}g=k.selectNodes("descendant-or-self::node()[@"+this.xmlIdTag+"]");for(j=g.length-1;j>=0;j--){g[j].removeAttribute(this.xmlIdTag);}g=k.selectNodes("descendant-or-self::node()[@"+this.xmlDocTag+"]");for(j=g.length-1;j>=0;j--){g[j].removeAttribute(this.xmlDocTag);}g=k.selectNodes("descendant-or-self::node()[@a_loaded]");for(j=g.length-1;j>=0;j--){g[j].removeAttribute("a_loaded");}}catch(n){}return k;};this.copy=this.getCleanCopy=apf.getCleanCopy=function(g){return apf.xmldb.cleanNode(g.cloneNode(true));};this.unbind=function(u){for(var A={},s=0;s<u.apf.all.length;s++){if(u.apf.all[s]&&u.apf.all[s].unloadBindings){A[u.apf.all[s].unloadBindings()]=true;}}for(var g=0;g<this.$xmlDocLut.length;g++){if(!this.$xmlDocLut[g]){continue;}var w=this.$xmlDocLut[g].selectNodes("//self::node()[@"+this.xmlListenTag+"]");if(!w){continue;}for(var s=0;s<w.length;s++){var q=w[s].getAttribute(this.xmlListenTag).split(";");for(var t=[],n=0;n<q.length;n++){if(!A[q[n]]){t.push(q[n]);}}if(t.length!=q.length){w[s].setAttribute(this.xmlListenTag,t.join(";"));}}}};this.getXmlDocId=function(j,g){var k=j.ownerDocument.documentElement;if(!apf.isChildOf(k,j)){k=j;}var i=(k||j).getAttribute(this.xmlDocTag)||this.$xmlDocLut.indexOf(k||j.ownerDocument||j);if(!i||i==-1){i=this.$xmlDocLut.push(k||j.ownerDocument||j)-1;if(k){k.setAttribute(this.xmlDocTag,i);}}if(g){apf.nameserver.register("model",i,g);}return i;};});apf.queue={q:{},timer:null,add:function(d,c){this.q[d]=c;if(!this.timer){this.timer=$setTimeout("apf.queue.empty()");}},remove:function(c){delete this.q[c];},empty:function(g){clearTimeout(this.timer);this.timer=null;if(apf.layout&&apf.layout.$hasQueue){apf.layout.processQueue();}if(apf.xmldb&&apf.xmldb.$hasQueue){apf.xmldb.notifyQueued();}var d=this.q;for(var g in d){var c=d[g];if(c){delete d[g];c();}}}};apf.storage={modules:{},init:function(c){if(!c){c=this.autodetect();}var d=this.getProvider(c);apf.storage=apf.extend(this,d);apf.storage.init=null;apf.console.info("Installed storage provider '"+c+"'");return d;},getProvider:function(c){var d=apf.storage.modules[c];if(!d||typeof d!="object"){apf.console.warn("Could not find storage provider '"+c+"'");return false;}if(!d.isAvailable()){apf.console.warn("Storage provider '"+c+"' is not available");return false;}if(!d.initialized&&(!d.init||d.init()===false)){apf.console.warn("Could not install storage provider '"+c+"");return false;}d.name=c;apf.extend(d,this.base);return d;},autodetect:function(){for(var c in this.modules){if("memory|cookie".indexOf(c)>-1){continue;}if(this.modules[c].isAvailable()){return c;}}return !location.host&&this.modules.cookie?"cookie":(this.modules.memory?"memory":null);},base:{namespace:"default",isValidKeyArray:function(c){return(!c||!c.join)?false:/^[0-9A-Za-z_\.\-]*$/.test(c.join(""));},isValidKey:function(c){return(c===null||c===undefined)?false:/^[0-9A-Za-z_\.\-]*$/.test(c);},getAllPairs:function(j,d){var k=this.getKeys(j);if(!k||!k.length){return;}var c=this.getMultiple(k,j);for(var g=0;g<k.length&&c;g++){if(c[g]){d[k[g]]=c[g];}}return k.length;}}};apf.Sort=function(d){var g={};this.parseXml=function(q,k){if(k){g={};}g.order=q.order;g.getValue=q.csort||q.$compile("sort");g.getNodes=self[q["nodes-method"]];g.ascending=(g.order||"").indexOf("desc")==-1;g.order=null;if(q["data-type"]){g.method=i[q["data-type"]];}else{if(q["sort-method"]){g.method=self[q["sort-method"]];if(!g.method){throw new Error(apf.formatErrorString(0,null,"Sorting nodes","Invalid or missing sort function name provided '"+q["sort-method"]+"'",q));}}else{g.method=i.alpha;}}var s=q["date-format"];if(s){g.sort_dateFmtStr=s;g.method=i.date;var j=s.match(/(D+|Y+|M+|h+|m+|s+)/g);if(j){for(var t={},n=0;n<j.length;n++){t[j[n].substr(0,1)]=n+1;}g.dateFormat=new RegExp(s.replace(/([^\sDYMhms])/g,"\\$1").replace(/YYYY/,"(\\d\\d\\d\\d)").replace(/(DD|YY|MM|hh|mm|ss)/g,"(\\d\\d)"));g.dateReplace="$"+t.M+"/$"+t.D+"/$"+t.Y;if(t.h){g.dateReplace+=" $"+t.h+":$"+t.m+":$"+t.s;}}}};this.set=function(k,j){if(j){g={};}apf.extend(g,k);if(!g.ascending){g.ascending=k.order?k.order.indexOf("desc")==-1:true;}g.order=null;if(k.type){g.method=i[k.type];}else{if(k.method){g.method=self[k.method];}else{if(!g.method){g.method=i.alpha;}}}if(!g.getValue){g.getValue=function(n){return apf.queryValue(n,g.xpath);};}};this.get=function(){return apf.extend({},g);};this.findSortSibling=function(q,n){var j=getNodes?getNodes(q,n):this.getTraverseNodes(q);for(var k=0;k<j.length;k++){if(!compare(n,j[k],true,sortSettings)){return j[k];}}return null;};var c=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000"];var i={alpha:function(j){return j.toString().toLowerCase();},number:function(j){return(j.length<c.length?c[c.length-j.length]:"")+j;},date:function(k,j){var n=g.dateFormat;var s=g.dateReplace;var u=g.sort_dateFmtStr;var q;if(!n){q=new Date(k);}else{if(u=="*"){q=Date.parse(k);}else{q=(new Date(k.replace(n,s))).getTime();}}k=""+q.getTime();if(k=="NaN"){k="0";}return(k.length<c.length?c[c.length-k.length]:"")+k;}};this.apply=function(k,A,q,j,u){var B=[],t=k.length;while(t--){var C=g.getValue(k[t]);if(k){B[B.length]={toString:function(){return this.v;},xmlNode:k[t],v:(g.method||i.alpha)(C||"",A,k[t])};}}B.sort();var s=u?Math.min(B.length,j+u):B.length;if(!j){j=0;}if(q){if(g.ascending){for(t=j;t<s;t++){f(t,s,B[t].xmlNode,B[t].v);}}else{for(t=s-1;t>=j;t--){f(s-t-1,s,B[t].xmlNode,B[t].v);}}}else{var w=[];if(g.ascending){for(t=j;t<s;t++){w[w.length]=B[t].xmlNode;}}else{for(t=s-1;t>=j;t--){w[w.length]=B[t].xmlNode;}}return w;}};if(d){this.parseXml(d);}};apf.skins={skins:{},css:[],events:["onmousemove","onmousedown","onmouseup","onmouseout","onclick","ondragcopy","ondragstart"],Init:function(u,q,w){var g=(q?q.getAttribute("id"):null)||u.getAttribute("id");var j=(q?q.getAttribute("src").match(/\//)||w:"")?(w||q.getAttribute("src")).replace(/\/[^\/]*$/,"")+"/":"";var k=null,s=null;k=u.getAttribute("media-path");if(k!==null){k=apf.getAbsolutePath(j||apf.hostPath,k);}else{if(q){k=q.getAttribute("media-path");if(k!==null){k=apf.getAbsolutePath(apf.hostPath,k);}else{k=apf.getAbsolutePath(j||apf.hostPath,"images/");}}}s=u.getAttribute("icon-path");if(s!==null){s=apf.getAbsolutePath(j||apf.hostPath,s);}else{if(q){s=q.getAttribute("icon-path");if(s!==null){s=apf.getAbsolutePath(apf.hostPath,s);}else{s=apf.getAbsolutePath(j||apf.hostPath,"icons/");}}}if(!g){g="default";}if(u.getAttribute("id")){document.body.className+=" "+u.getAttribute("id");}var t=g.split("|");g=t[0];if(!this.skins[g]||g=="default"){this.skins[g]={base:j,name:g,iconPath:s,mediaPath:k,templates:{},originals:{},xml:u};if(t.length>1){for(var n=0;n<t.length;n++){this.skins[t[n]]=this.skins[g];}}}if(!this.skins["default"]&&this.$first==q){this.skins["default"]=this.skins[g];}var d=u.childNodes;for(var n=d.length-1;n>=0;n--){if(d[n].nodeType!=1){continue;}this.skins[g].templates[d[n].getAttribute("name")]=d[n];if(d[n].ownerDocument){this.importSkinDef(d[n],j,g);}}this.purgeCss(k,s);if(this.queue[g]){for(var c in this.queue[g]){this.queue[g][c]();}}},loadStylesheet:function(filename,title){var o;with(o=document.getElementsByTagName("head")[0].appendChild(document.createElement("LINK"))){rel="stylesheet";type="text/css";href=filename;title=title;}return o;},importSkinDef:function(xmlNode,basepath,name){var i,l,nodes=$xmlns(xmlNode,"style",apf.ns.aml),tnode,node;for(i=0,l=nodes.length;i<l;i++){node=nodes[i];if(node.getAttribute("src")){this.loadStylesheet(node.getAttribute("src").replace(/src/,basepath+"/src"));}else{var test=true;if(node.getAttribute("condition")){try{test=eval(node.getAttribute("condition"));}catch(e){test=false;}}if(test){tnode=node.firstChild;while(tnode){this.css.push(tnode.nodeValue);tnode=tnode.nextSibling;}}}}nodes=$xmlns(xmlNode,"alias",apf.ns.apf);var t=this.skins[name].templates;for(i=0;i<nodes.length;i++){if(!nodes[i].firstChild){continue;}t[nodes[i].firstChild.nodeValue.toLowerCase()]=xmlNode;}},loadedCss:"",purgeCss:function(c,g){if(!this.css.length){return;}var d=this.css.join("\n").replace(/images\//g,c).replace(/icons\//g,g);apf.importCssString(d);this.css=[];},loadCssInWindow:function(c,q,g,k){this.css=[];var d=c.split(":");var n=this.skins[d[0]];var i=n.templates[d[1]];this.importSkinDef(i,n.base,n.name);var j=this.css.join("\n").replace(/images\//g,g).replace(/icons\//g,k);apf.importCssString(j);this.css=[];},setSkinPaths:function(c,g){c=c.split(":");var d=c[0];var i=c[1];if(!this.skins[d]){throw new Error(apf.formatErrorString(1076,null,"Retrieving Skin","Could not find skin '"+d+"'",g.$aml));}g.iconPath=this.skins[d].iconPath;g.mediaPath=this.skins[d].mediaPath;},getTemplate:function(g,d){g=g.split(":");var k=g[0];var q=g[1];if(!this.skins[k]){if(d){return false;}throw new Error(apf.formatErrorString(1077,null,"Retrieving Template","Could not find skin '"+k+"'"));return false;}if(!this.skins[k].templates[q]){return false;}var s=this.skins[k].templates[q];var c=this.skins[k].originals[q];if(!c){c=this.skins[k].originals[q]={};if(!$xmlns(s,"presentation",apf.ns.aml)[0]){throw new Error(apf.formatErrorString(1078,null,"Retrieving Template","Missing presentation tag in '"+k+"'"));}var j=$xmlns(s,"presentation",apf.ns.aml)[0].childNodes;for(var n=0;n<j.length;n++){if(j[n].nodeType!=1){continue;}c[j[n].baseName||j[n][apf.TAGNAME]]=j[n];}}return c;},getCssString:function(c){return apf.queryValue($xmlns(this.skins[c.split(":")[0]].xml,"style",apf.ns.aml)[0],"text()");},queue:{},waitForSkin:function(c,g,d){if(this.skins[c]){return;}(this.queue[c]||(this.queue[c]={}))[g]=d;return true;},iconMaps:{},addIconMap:function(c){this.iconMaps[c.name]=c;if(c.size){c.width=c.height=c.size;}else{if(!c.width){c.width=1;}if(!c.height){c.height=1;}}},setIcon:function(g,q,c){if(!q){g.style.backgroundImage="";return;}if(g.tagName.toLowerCase()=="img"){g.setAttribute("src",q?(c||"")+q:"");return;}var n=q.split(":");var k=this.iconMaps[n[0]];if(k){var j,i,d=n[1].split(",");j=(d[(k.type=="vertical")?1:0]||0)*k.width;i=(d[(k.type=="vertical")?0:1]||0)*k.height;g.style.backgroundImage="url("+(c||"")+k.src+")";g.style.backgroundPosition=((-1*j)-k.offset[0])+"px "+((-1*i)-k.offset[1])+"px";}else{g.style.backgroundImage="url("+(c||"")+q+")";}}};apf.layout={layouts:{},addParent:function(d,c){var g;if(!(g=d.getAttribute("id"))){g=apf.setUniqueHtmlId(d);}return this.layouts[g]={layout:new apf.layoutParser(d,c),controls:[]};},splitters:{},freesplitters:[],vars:{},getSplitter:function(c){if(!this.splitters[this.getHtmlId(c.parentNode)]){this.splitters[this.getHtmlId(c.parentNode)]=[];}if(this.freesplitters.length){var d=this.freesplitters.pop();}else{var d=new apf.splitter();var g=apf.findHost(c.parentNode)||apf.document.documentElement;d.parentNode=g;d.skinset=apf.getInheritedAttribute(g,"skinset");d.dispatchEvent("DOMNodeInsertedIntoDocument");}this.splitters[this.getHtmlId(c.parentNode)].push(d);return d;},clearSplitters:function(g){var c=this.splitters[this.getHtmlId(g.parentNode)];if(!c){return;}for(var d=0;d<c.length;d++){this.freesplitters.push(c[d]);if(!c[d].$ext.parentNode){continue;}c[d].$ext.parentNode.removeChild(c[d].$ext);}c.length=0;},get:function(g,c){var d=this.layouts[g.getAttribute("id")];if(!d){d=this.addParent(g,c);}return d;},isLoadedXml:function(j){var c=j.childNodes;var k=j.selectSingleNode(".//node[@name]");var i=k?self[k.getAttribute("name")]:null;if(!i){throw new Error(apf.formatErrorString(0,null,"Loading Alignment from XML","Could not find AML node"+(k?" by name '"+k.getAttribute("name")+"'":""),j));}var g=i.$ext.parentNode;var d=this.getHtmlId(g);return(this.loadedXml[d]==j);},$loadFrom:function(c){apf.getData(c,{callback:function(d){if(!d){return;}if(!d){throw new Error(apf.formatErrorString(0,null,"Loading default layout","Could not find default layout using processing                      instruction: '"+c+"'"));return;}apf.layout.loadXml(d);}});},loadedXml:{},cacheXml:{},loadXml:function(n){var c=n.childNodes;var s=n.selectSingleNode(".//node[@name]");var k=s?self[s.getAttribute("name")]:null;if(!k){throw new Error(apf.formatErrorString(0,null,"Loading Alignment from XML","Could not find AML node"+(s?" by name '"+s.getAttribute("name")+"'":""),n));}var j=k.$ext.parentNode;var q=this.get(j,apf.getBox(n.getAttribute("margin")||""));var g=this.getHtmlId(j);this.metadata=[];for(var d=0;d<c.length;d++){if(c[d].nodeType!=1){continue;}q.root=this.parseXml(c[d],q);break;}this.compile(j);if(apf.window.inited){this.activateRules(j);}this.loadedXml[g]=n;},metadata:[],getData:function(c,d){return{vbox:(c=="vbox"),hbox:(c=="hbox"),node:"vbox|hbox".indexOf(c)==-1,children:[],isRight:false,isBottom:false,edgeMargin:0,splitter:null,minwidth:0,minheight:0,weight:1,pHtml:d.parentNode,size:[300,200],position:[0,0],last:{},toString:function(){var j=apf.vardump(this,null,false);for(var g=0;g<this.children.length;g++){j+="\n{Child "+g+"\n===========\n"+this.children[g].toString()+"}";}return j;},copy:function(){var j=apf.extend({},this);j.toString=this.toString;if(!this.node){j.children=[];for(var g=0;g<this.children.length;g++){j.children[g]=this.children[g].copy();j.children[g].parent=j;}}return j;},hidden:false,hiddenChildren:[],prehide:function(k){if(this.hidden==3){this.hidden=true;if(this.hid){apf.lookup(this.hid).visible=false;}if(this.oHtml){this.oHtml.style.display="none";}return;}if(this.hidden&&!k){return;}if(!this.parent){return;}this.hidepos={prev:this.parent.children[this.stackId-1],next:this.parent.children[this.stackId+1]};this.hidden=true;var j,t,s=0,n,g,q=["children","hiddenChildren"];while(q.length){j=this.parent[q.pop()];for(n=0,g=j.length;n<g;n++){t=j[n];if(t!=this&&!t.hidden){s=1;break;}}}if(!s){this.parent.prehide(k);}if(k){return this.hide(true);}if(apf.layout.dlist.contains(this)){apf.layout.dlist.remove(this);return false;}else{apf.layout.dlist.pushUnique(this);}},preshow:function(g){if(!this.hidden){return;}this.hidden=false;if(g){return this.show(true);}if(this.parent.hidden){this.parent.preshow();}if(apf.layout.dlist.contains(this)){apf.layout.dlist.remove(this);return false;}else{apf.layout.dlist.pushUnique(this);}},hide:function(j){var g=this.parent.children;g.removeIndex(this.stackId);for(var k=0;k<g.length;k++){g[k].stackId=k;}this.parent.hiddenChildren.push(this);if(j){return;}if(this.hidden!=3){if(this.hid){apf.lookup(this.hid).visible=false;}if(this.oHtml){this.oHtml.style.display="none";}}},show:function(j){var g=this.parent.children;if(this.hidepos.prev&&this.hidepos.prev.parent==this.parent&&!this.hidepos.prev.hidden&&!apf.layout.dlist.contains(this.hidepos.prev)){if(g.length<this.hidepos.prev.stackId+1){g.push(this);}else{g.insertIndex(this,this.hidepos.prev.stackId+1);}}else{if(this.hidepos.next&&this.hidepos.next.parent==this.parent&&!this.hidepos.next.hidden&&!apf.layout.dlist.contains(this.hidepos.next)){if(this.hidepos.next.stackId==0){g.unshift(this);}else{if(g.length<this.hidepos.next.stackId-1){g.push(this);}else{g.insertIndex(this,this.hidepos.next.stackId-1);}}}else{if(!this.hidepos.prev){g.unshift(this);}else{if(!this.hidepos.next){g.push(this);}else{if(this.stackId<g.length){g.insertIndex(this,this.stackId);}else{g.push(this);}}}}}for(var k=0;k<g.length;k++){if(g[k]){g[k].stackId=k;}}this.parent.hiddenChildren.remove(this);if(!j){if(this.hidden!=3){if(this.hid){apf.lookup(this.hid).visible=true;}if(this.oHtml){this.oHtml.style.display="block";}}}this.hidden=false;this.hidepos=null;},remove:function(){var k=this.parent;if(!k){return;}if(this.hidden||k.hiddenChildren.contains(this)){k.hiddenChildren.remove(this);apf.layout.dlist.remove(this);}else{var g=k.children;g.remove(this);for(var j=0;j<g.length;j++){g[j].stackId=j;}}for(var n in this.last){if(n=="splitter"){if(k.originalMargin){if(k.parent.pOriginalMargin){k.parent.splitter=null;k.parent.edgeMargin=k.parent.pOriginalMargin[0];k.parent.pOriginalMargin=null;delete k.last.splitter;}k.splitter=null;k.edgeMargin=k.originalMargin[0];k.originalMargin=null;}}this[n]=k[n]||this.last[n];}this.last={};if(!k.children.length&&!k.hiddenChildren.length){k.remove();}this.parent=null;},add:function(k){this.parent=k;if(this.hidden){var g=k.hiddenChildren;g.push(this);}else{var g=k.children;g.push(this);for(var j=0;j<g.length;j++){if(g[j]){g[j].stackId=j;}}}}};},parseXml:function(x,layout,amlNode,norecur){var aData=this.getData(typeof amlNode=="string"?amlNode:x.localName||x[apf.TAGNAME],layout.layout);if(aData.node){if(!amlNode){amlNode=self[x.getAttribute("name")];if(!amlNode){throw new Error(apf.formatErrorString(0,null,"Parsing Alignment from XML","Could not find AML node"+x.getAttribute("name"),x));}}aData.oHtml=amlNode.$ext;amlNode.aData=aData;amlNode.$setLayout("alignment");var aml=amlNode;if(aml.getAttribute("width")){aData.fwidth=aml.getAttribute("width");}if(aml.getAttribute("height")){aData.fheight=aml.getAttribute("height");}if(!this.getHtmlId(aData.oHtml)){apf.setUniqueHtmlId(aData.oHtml);}aData.id=this.getHtmlId(aData.oHtml);if(aData.oHtml.style){aData.oHtml.style.position="absolute";}aData.hid=amlNode.$uniqueId;}else{aData.id=this.metadata.push(aData)-1;}if(x.getAttribute("align")){aData.template=x.getAttribute("align");}if(x.getAttribute("lean")){aData.isBottom=x.getAttribute("lean").match(/bottom/);}if(x.getAttribute("lean")){aData.isRight=x.getAttribute("lean").match(/right/);}if(x.getAttribute("edge")&&x.getAttribute("edge")!="splitter"){aData.edgeMargin=x.getAttribute("edge");}if(x.getAttribute("weight")){aData.weight=parseFloat(x.getAttribute("weight"));}if(x.getAttribute("splitter")||x.getAttribute("edge")=="splitter"){aData.splitter=x.getAttribute("splitter")||(x.getAttribute("edge")=="splitter"?4:false);}if(x.getAttribute("width")){aData.fwidth=String(apf.parseExpression(x.getAttribute("width")));}if(x.getAttribute("height")){aData.fheight=String(apf.parseExpression(x.getAttribute("height")));}if(x.getAttribute("lastsplitter")){aData.lastsplitter=x.getAttribute("lastsplitter");}if(x.getAttribute("hidden")){aData.hidden=(x.getAttribute("hidden")==3)?x.getAttribute("hidden"):apf.isTrue(x.getAttribute("hidden"));}else{if(x.getAttribute("visible")=="false"){aData.hidden=true;}}if(x.getAttribute("state")){aData.state=x.getAttribute("state");}if(x.getAttribute("stack")){aData.stackId=parseInt(x.getAttribute("stack"));}if(x.getAttribute("position")){aData.position=x.getAttribute("position").split(",");}if(x.getAttribute("size")){aData.size=x.getAttribute("size").split(",");}if(aData.fwidth&&aData.fwidth.indexOf("/")>-1){aData.fwidth=eval(aData.fwidth);if(aData.fwidth<=1){aData.fwidth=(aData.fwidth*100)+"%";}}if(aData.fheight&&aData.fheight.indexOf("/")>-1){aData.fheight=eval(aData.fheight);if(aData.fheight<=1){aData.fheight=(aData.fheight*100)+"%";}}aData.edgeMargin=Math.max(aData.splitter||0,aData.edgeMargin||0);aData.xml=x;return aData;},checkInheritance:function(k){var j=k.children[k.children.length-1];if(k.originalMargin){if(k.parent.pOriginalMargin){k.parent.splitter=null;k.parent.edgeMargin=k.parent.pOriginalMargin[0];k.parent.pOriginalMargin=null;k.splitter=k.last.splitter;delete k.last.splitter;}k.splitter=null;var c=k.originalMargin[1];k.edgeMargin=k.originalMargin[0];c.splitter=c.splitter===false?false:c.last.splitter;k.originalMargin=null;delete c.last.splitter;}if(j&&j.template&&(j.splitter||j.splitter===null&&k.originalMargin)&&k.parent){if(!k.splitter){j.last.splitter=k.splitter=j.splitter;k.originalMargin=[k.edgeMargin,j];k.edgeMargin=Math.max(k.edgeMargin,k.splitter);}j.splitter=null;if(k.parent&&k.stackId==k.parent.children.length-1&&(k.parent.parent&&k.parent.parent.children.length>1)){if(!k.parent.splitter){k.last.splitter=k.parent.splitter=k.splitter;k.parent.last.splitter=null;k.parent.edgeMargin=Math.max(k.parent.edgeMargin,k.parent.splitter);k.parent.pOriginalMargin=[k.parent.edgeMargin];}k.splitter=null;}else{if(k.parent.pOriginalMargin){k.parent.splitter=null;k.parent.edgeMargin=k.parent.pOriginalMargin[0];k.parent.pOriginalMargin=null;k.splitter=k.last.splitter;delete k.last.splitter;}}}for(var g=0;g<k.children.length;g++){if(!k.children[g].node){this.checkInheritance(k.children[g]);}}var n=k.children[0];if(n&&k.parent){if(k.vbox){if(!k.fwidth&&n.fwidth||n.last.fwidth&&n.fwidth!==null&&n.last.fwidth==k.fwidth){n.last.fwidth=k.fwidth=n.fwidth;n.fwidth=null;}var d=k.parent;if((d&&!d.fheight&&n.fheight||n.last.fheight&&n.fheight!==null&&n.last.fheight==d.fheight)&&k.children.length==1){n.last.fheight=d.fheight=n.fheight;n.fheight=null;}}else{if((!k.fheight&&n.fheight||n.last.fheight&&n.fheight!==null&&n.last.fheight==k.fheight)&&k.children.length==1){n.last.fheight=k.fheight=n.fheight;n.fheight=null;}}if(n.weight||n.last.weight&&n.last.weight==k.weight){n.last.weight=k.weight=n.weight;}}},compileAlignment:function(d){if(!d.children.length){this.removeRule(d.pHtml,"layout");var c=this.layouts[d.pHtml.getAttribute("id")];if(c){apf.layout.clearSplitters(c.layout);}return;}var k=d.children;for(var j=false,g=0;g<k.length;g++){if(k[g].template=="bottom"){if(k[g].splitter){k[g-1].splitter=k[g].splitter;k[g].splitter=null;}k[g-1].edgeMargin=Math.max(k[g].edgeMargin,k[g-1].edgeMargin||0,k[g-1].splitter||0);k[g].edgeMargin=null;}if(k[g].hidden){k[g].prehide(true);}}this.checkInheritance(d);var c=this.layouts[d.pHtml.getAttribute("id")];c.layout.compile(d.copy());c.layout.reset();},addAlignNode:function(k,c){var C=(typeof k.align=="undefined"?k.getAttribute("align"):k.align).split("-");var F=c.children;var D=k.aData;if(typeof k.splitter=="undefined"){if(C[1]=="splitter"){D.splitter=C[2]||4;}else{D.splitter=false;}}D.edgeMargin=Math.max(D.edgeMargin,D.splitter||0);C=C[0];D.template=C;if(C=="top"){for(var d=F.length,u=0;u<F.length;u++){if(F[u].template!="top"){d=u;break;}}for(var u=F.length-1;u>=d;u--){F[u+1]=F[u];F[u].stackId=u+1;}F[d]=D;F[d].stackId=d;D.parent=c;}else{if(C=="bottom"){D.stackId=F.push(D)-1;D.parent=c;}else{var t=null;for(var d=-1,u=0;u<F.length;u++){if(F[u].hbox){t=F[u];break;}else{if(F[u].node&&F[u].template=="top"){d=u;}}}if(!t){var q=apf.layout.get(c.pHtml);t=apf.layout.parseXml(apf.xmldb.getXml("<hbox />"),q,null,true);t.parent=c;if(d>-1){for(var u=F.length-1;u>d;u--){F[u+1]=F[u];F[u].stackId++;}F[d+1]=t;t.stackId=d+1;}else{t.stackId=F.unshift(t)-1;}}var j,g=t.children.concat(t.hiddenChildren);for(var u=0;u<g.length;u++){if(g[u].template==C){j=g[u];break;}}g=t.children;if(!j){var q=apf.layout.get(c.pHtml);j=apf.layout.parseXml(apf.xmldb.getXml("<vbox />"),q,null,true);j.parent=t;j.template=C;if(C=="left"){if(!D.fwidth){var A;for(var E=false,u=0;u<g.length;u++){if(g[u].template=="middle"){E=g[u];break;}}if(E&&!E.children.length){g.remove(E);for(var u=0;u<g.length;u++){g[u].stackId=u;}}}g.unshift(j);for(var u=0;u<g.length;u++){g[u].stackId=u;}}else{if(C=="right"){if(D.fwidth){var A;for(var E=false,u=0;u<g.length;u++){if(g[u].template=="middle"||g[u].template=="left"&&!g[u].fwidth){E=true;break;}}if(!E){A=apf.layout.parseXml(apf.xmldb.getXml("<vbox />"),q,null,true);A.parent=t;A.template="middle";A.stackId=g.push(A)-1;}}j.stackId=g.push(j)-1;}else{if(C=="middle"){for(var B,u=0;u<g.length;u++){if(g[u].template=="right"){B=u;}}var w=g[B];if(w){g[B]=j;j.stackId=B;w.stackId=g.push(w)-1;}else{j.stackId=g.push(j)-1;}}}}}D.stackId=j.children.push(D)-1;D.parent=j;if(j.hidden){j.preshow(true);}}}},compile:function(g){var d=this.layouts[g.getAttribute("id")];if(!d){return false;}var c=d.root.copy();d.layout.compile(c);d.layout.reset();},removeAll:function(d){d.children.length=null;this.compileAlignment(d);var c=this.getHtmlId(d.pHtml);if(!this.rules[c]){delete this.qlist[c];}},timer:null,qlist:{},dlist:[],$hasQueue:false,queue:function(d,g,c){this.$hasQueue=true;var i;if(!(i=this.getHtmlId(d))){i=apf.setUniqueHtmlId(d);}if(this.qlist[i]){if(g){this.qlist[i][2].push(g);}if(c){this.qlist[i][1]=c;}return;}this.qlist[i]=[d,c,[g]];if(!this.timer){this.timer=$setTimeout("apf.layout.processQueue()");}},processQueue:function(){var g,n,c,k,j;for(g=0;g<this.dlist.length;g++){if(this.dlist[g].hidden){this.dlist[g].hide();}else{this.dlist[g].show();}}do{var d=this.qlist;this.qlist={};this.$hasQueue=false;for(n in d){k=d[n];if(k[1]){apf.layout.compileAlignment(k[1]);}j=k[2];for(g=0,c=j.length;g<c;g++){if(j[g]){j[g].$updateLayout();}}apf.layout.activateRules(k[0]);}}while(this.$hasQueue);if(apf.hasSingleRszEvent){apf.layout.forceResize();}this.dlist=[];clearTimeout(this.timer);this.timer=null;},rules:{},onresize:{},getHtmlId:function(c){return c.getAttribute?c.getAttribute("id"):1;},setRules:function(g,j,i,d){if(!this.getHtmlId(g)){apf.setUniqueHtmlId(g);}if(!this.rules[this.getHtmlId(g)]){this.rules[this.getHtmlId(g)]={};}var c=this.rules[this.getHtmlId(g)][j];if(!d&&c){this.rules[this.getHtmlId(g)][j]=i+"\n"+c;}else{this.rules[this.getHtmlId(g)][j]=i;}},getRules:function(c,d){return d?this.rules[this.getHtmlId(c)][d]:this.rules[this.getHtmlId(c)];},removeRule:function(i,n){var d=this.getHtmlId(i);if(!this.rules[d]){return;}var g=this.rules[d][n]||false;delete this.rules[d][n];var k;for(k in this.rules[d]){}if(!k){delete this.rules[d];}if(apf.hasSingleRszEvent){if(this.onresize[d]){this.onresize[d]=null;}else{var j=i.parentNode;while(j&&j.nodeType==1&&!this.onresize[j.getAttribute("id")]){j=j.parentNode;}if(j&&j.nodeType==1){var c=this.onresize[j.getAttribute("id")];if(c.children){delete c.children[d];}}}}return g;},activateRules:function(j,s){if(!j){var c,k;for(c in this.rules){k=document.getElementById(c);if(!k||k.onresize){continue;}this.activateRules(k);}if(apf.hasSingleRszEvent&&window.onresize){window.onresize();}return;}var n,i,t,A,w=[];if(!apf.hasSingleRszEvent){A=this.rules[this.getHtmlId(j)];if(!A){j.onresize=null;return false;}for(i in A){if(typeof A[i]!="string"){continue;}w.push(A[i]);}n=apf.needsCssPx?new Function(w.join("\n")):new Function(w.join("\n").replace(/ \+ 'px'|try\{\}catch\(e\)\{\}\n/g,""));j.onresize=n;if(!s){n();}}else{var g=this.getHtmlId(j);A=this.rules[g];if(!A){return false;}for(i in A){if(typeof A[i]!="string"){continue;}w.push(A[i]);}var d=j.parentNode;while(d&&d.nodeType==1&&!this.onresize[d.getAttribute("id")]){d=d.parentNode;}var q=new Function(w.join("\n"));if(this.onresize[g]){q.children=this.onresize[g].children;}if(d&&d.nodeType==1){var u=this.onresize[d.getAttribute("id")];(u.children||(u.children={}))[g]=q;}else{this.onresize[g]=q;}if(!s){q();}if(!window.onresize){var n=function(D){try{var F=[];for(var B in D){F.unshift(D[B]);}for(var C=0;C<F.length;C++){F[C]();if(F[C].children){n(F[C].children);}}}catch(E){}};window.onresize=function(){n(apf.layout.onresize);};}}},forceResize:function(k){if(apf.hasSingleRszEvent){return window.onresize&&window.onresize();}var d=k.onresize;if(d){d();}var j=k.getElementsByTagName("*");for(var g=0,c=j.length;g<c;g++){if(j[g].onresize){j[g].onresize();}}},paused:{},pause:function(d,g){if(apf.hasSingleRszEvent){var c=this.getHtmlId(d);this.paused[c]=this.onresize[c]||true;if(g){this.onresize[c]=g;this.onresize[c].children=this.paused[c].children;g();}else{delete this.onresize[c];}}else{this.paused[this.getHtmlId(d)]=d.onresize||true;if(g){d.onresize=g;g();}else{d.onresize=null;}}},play:function(d){if(!this.paused[this.getHtmlId(d)]){return;}if(apf.hasSingleRszEvent){var c=this.getHtmlId(d);var g=this.paused[c];if(typeof g=="function"){this.onresize[c]=g;}else{delete this.onresize[c];}if(window.onresize){window.onresize();}this.paused[this.getHtmlId(d)]=null;}else{var g=this.paused[this.getHtmlId(d)];if(typeof g=="function"){d.onresize=g;g();}else{d.onresize=null;}this.paused[this.getHtmlId(d)]=null;}}};apf.layout.load=apf.layout.loadXml;apf.getWindowWidth=function(){return apf.isIE?document.documentElement.offsetWidth-apf.windowHorBorder:window.innerWidth;};apf.getWindowHeight=function(){return apf.isIE?document.documentElement.offsetHeight-apf.windowVerBorder:window.innerHeight;};apf.layoutParser=function(c,g){g=(g&&g.length==4)?g:[0,0,0,0];this.pMargin=g;this.RULES=[];this.parentNode=c;if(!this.parentNode.getAttribute("id")){apf.setUniqueHtmlId(this.parentNode);}var k={};var i=0;var j=0;this.createSplitters=true;this.setMargin=function(n){g=n;};this.reset=function(){this.RULES=[];k={};this.lastType=this.globalEdge=this.globalSplitter=null;};this.compile=function(n,q){this.addRule("var v = apf.layout.vars");this.globalSplitter=n.splitter;this.globalEdge=n.edgeMargin;if(this.globalSplitter||this.globalEdge){this.setglobals(n);}this.preparse(n);this.parserules(n);if(this.createSplitters){apf.layout.clearSplitters(this);this.parsesplitters(n);}this.RULES=new d().calc(this.RULES);var s=("try{"+this.RULES.join("}catch(e){}\ntry{")+"}catch(e){}\n").replace(/([^=]+\.style[^=]+) = (.*?)\}/g,"$1 = ($2) + 'px'}");if(!apf.hasHtmlIdsInJs){s=s.replace(/q([\w|]+)\.(offset|style)/g,'document.getElementById("q$1").$2');}this.lastRoot=n;if(!q){apf.layout.setRules(this.parentNode,"layout",s,true);apf.layout.queue(this.parentNode);}else{return s;}return false;};this.addRule=function(n){this.RULES.push(n);};this.setglobals=function(q,s){if(!s&&this.globalEdge&&!q.edgeMargin&&(!q.xml||!q.xml.getAttribute("edge"))){if(!q.splitter){q.splitter=this.globalSplitter;}q.edgeMargin=Math.max(this.globalSplitter,this.globalEdge);}if(q.node){return;}for(var n=0;n<q.children.length;n++){this.setglobals(q.children[n],n==q.children.length-1);}};this.preparse=function(q){if(q.node){return;}else{var D=q.vbox?"height":"width";var t=0;var C=0;var I=0;q.childweight=0;q.childminwidth=0;q.childminheight=0;var H=["v."+D+"_"+q.id],s=[];var n=q.children;for(var w=0;w<n.length;w++){if(w<n.length-1){H.push(" - "+n[w].edgeMargin);}var B=n[w]["f"+D];if(B){s.push((B.indexOf("%")>-1)?" - ("+(n[w]["calc"+D]="v.innerspace_"+q.id+" * "+parseFloat(B)/100)+")":" - ("+B+")");}else{q.childweight+=n[w].weight;n[w]["calc"+D]="Math."+(w%2==0?"ceil":"floor")+"(v.restspace_"+q.id+" * ("+n[w].weight+"/v.weight_"+q.id+"))";}var A=(q.vbox?"width":"height");var F=n[w]["f"+A];if(!F){n[w]["calc"+A]=(q.vbox?"v.width_":"v.height_")+q.id;}else{n[w]["calc"+A]=F.indexOf("%")>-1?"v.innerspace_"+q.id+" * "+parseFloat(F)/100:F;}if(n[w].node&&n[w].xml.visible!==false){n[w].oHtml.style.display="block";}else{this.preparse(n[w]);}if(q.vbox){q.childminheight+=Math.max(n[w].childminheight||0,n[w].minheight||0,10)+n[w].edgeMargin;q.childminwidth=Math.max(q.childminwidth,n[w].minwidth||n[w].childminwidth||10);}else{q.childminwidth+=Math.max(n[w].minwidth||0,n[w].childminwidth||0,10)+n[w].edgeMargin;q.childminheight=Math.max(q.childminheight,n[w].minheight||n[w].childminheight||10);}}q.innerspace=H.join("");q.restspace=q.innerspace+" "+s.join("");if(!q.parent){var u=0,K=0;if(this.parentNode.tagName.toLowerCase()!="body"){var E=apf.getDiff(this.parentNode);K=E[0];u=E[1];}var J=(this.parentNode.tagName.toLowerCase()=="body"?"apf.getWindowWidth()":"document.getElementById('"+this.parentNode.id+"').offsetWidth");var G=(this.parentNode.tagName.toLowerCase()=="body"?"apf.getWindowHeight()":"document.getElementById('"+this.parentNode.id+"').offsetHeight");q.calcwidth="Math.max("+i+", "+J+" - "+(g[1])+" - "+g[3]+" - "+u+")";q.calcheight="Math.max("+j+", "+G+" - "+(g[2])+" - "+g[0]+" - "+K+")";}}};this.parserules=function(w){if(!w.node){this.addRule("v.width_"+w.id+" = Math.max("+w.childminwidth+","+w.minwidth+","+(w.calcwidth||w.fwidth)+")");this.addRule("v.height_"+w.id+" = Math.max("+w.childminheight+","+w.minheight+","+(w.calcheight||w.fheight)+")");this.addRule("v.weight_"+w.id+" = "+w.childweight);this.addRule("v.innerspace_"+w.id+" = "+w.innerspace);this.addRule("v.restspace_"+w.id+" = "+w.restspace);var q=apf.layout.metadata[w.id];q.calcData=w;w.original=q;if(!w.parent){this.addRule("v.left_"+w.id+" = "+g[3]);this.addRule("v.top_"+w.id+" = "+g[0]);for(var t=0;t<w.children.length;t++){this.parserules(w.children[t]);}return;}else{var C=["v.top_"+w.id," = "];var E=["v.left_"+w.id," = "];}}else{var C=[w.id,".style.top = "];var E=[w.id,".style.left = "];if(w.hid){var q=apf.lookup(w.hid).aData;q.calcData=w;w.original=q;}var u=w.oHtml;var B=apf.getDiff(u);var D=B[1];var s=B[0];if(w.calcwidth){this.addRule(w.id+".style.width = -"+s+" + Math.max( "+w.calcwidth+", "+w.minwidth+")");}else{u.style.width=Math.max(0,w.fwidth-s)+"px";}if(w.calcheight){this.addRule(w.id+".style.height = -"+D+" + Math.max( "+w.calcheight+", "+w.minheight+")");}else{u.style.height=Math.max(0,w.fheight-D)+"px";}}var n=w.parent.children[w.stackId-1];var A=w.parent.children[w.stackId+1];if(w.parent.vbox){if(w.parent.isBottom){if(!A){C.push("v.top_",w.parent.id," + v.height_",w.parent.id," - ",w.id,".offsetHeight");}else{if(A.node){C.push(A.id,".offsetTop - ",A.edgeMargin," - ",w.id,".offsetHeight");}else{C.push("v.top_"+A.id," - ",A.edgeMargin," - ",(w.node?w.id+".offsetHeight":"v.height_"+w.id));}}}else{if(!w.stackId){C.push("v.top_"+w.parent.id);}else{if(n){if(n.node){C.push(n.id,".offsetTop + ",n.id,".offsetHeight + ",n.edgeMargin);}else{C.push("v.top_",n.id," + v.height_",n.id," + ",n.edgeMargin);}}}}}else{C.push("v.top_"+w.parent.id);}if(w.parent.hbox){if(w.parent.isRight){if(!A){E.push("v.left_",w.parent.id," + v.width_",w.parent.id," - ",(w.node?w.id+".offsetWidth":"v.width_"+w.id),null);}else{if(A.node){E.push(A.id,".offsetLeft - ",A.edgeMargin," - ",(w.node?w.id+".offsetWidth":"v.width_"+w.id));}else{E.push("v.left_"+A.id," - ",A.edgeMargin," - ",(w.node?w.id+".offsetWidth":"v.width_"+w.id));}}}else{if(!w.stackId){E.push("v.left_"+w.parent.id);}else{if(n){if(n.node){E.push(n.id,".offsetLeft + ",n.id,".offsetWidth + ",n.edgeMargin);}else{E.push("v.left_",n.id," + v.width_",n.id," + ",n.edgeMargin);}}}}}else{E.push("v.left_"+w.parent.id);}if(E.length>2){this.addRule(E.join(""));}if(C.length>2){this.addRule(C.join(""));}if(!w.node){for(var t=0;t<w.children.length;t++){this.parserules(w.children[t]);}}};this.parsesplitters=function(q){if(q.parent&&q.splitter>0){apf.layout.getSplitter(this).init(q.splitter,q.hid,q);}if(!q.node){for(var n=0;n<q.children.length;n++){this.parsesplitters(q.children[n]);}}};function d(){this.parselookup={};this.nRules=[];this.doneRules={};this.maskText=function(t,s,q,n){return s+".offset"+q.toUpperCase();};this.handleVar=function(t,s,q,n){var u="a"+s.replace(/\|/g,"_")+"_style_"+q.toLowerCase();return k[u]?u:t;};this.parseRule=function(w){var s=w.split(" = "),B=s[0].replace(/^([_\w\d\|]+)\.style\.(\w)/,this.maskText),u="a"+s[0].replace(/[\.\|]/g,"_");k[u]=true;var t=s[1].split(/[ \(\)]/),A=[],n;for(var q=0;q<t.length;q++){if(t[q].match(/^([_\w\d\|]+)\.offset(\w+)$/)&&!t[q].match(/PNODE/)){A.push(t[q]);}}if(u.match(/width|height/i)){s[1]=s[1].replace(/^(\s*[\-\d]+[\s\-\+]+)/,"");n=s[0]+" = "+RegExp.$1+u;}else{n=s[0]+" = "+u;}if(w.match(/^v\./)){return{id:B,rule_p1:s[0]+" = ",rule_p2:s[1],ruleb:null,deps:A,processed:false};}return{id:B,rule_p1:"var "+u+" = ",rule_p2:s[1],ruleb:n,deps:A,processed:false};};this.calc=function(s){var q,w,u="";for(q=0;q<s.length;q++){if(s[q].match(/^var/)){this.nRules.push(s[q]);continue;}var t=this.parseRule(s[q],q);this.parselookup[t.id]=t;}for(w in this.parselookup){this.processNode(this.parselookup[w]);}for(w in this.parselookup){var n=this.parselookup[w];this.walkRules(n);}for(w in this.parselookup){this.nRules.push(this.parselookup[w].ruleb);}return this.nRules;};this.walkRules=function(n){if(this.doneRules[n.id]){return;}for(var q=0;q<n.deps.length;q++){if(n.deps[q]&&!n.deps[q].walked&&!this.doneRules[n.deps[q].id]){n.deps[q].walked=true;this.walkRules(n.deps[q]);}}this.doneRules[n.id]=true;this.nRules.push(n.rule_p1+n.rule_p2.replace(/([_\w\d\|]+)\.offset(\w+)/g,this.handleVar));};this.processNode=function(s){for(var q=0;q<s.deps.length;q++){var n=typeof s.deps[q]=="string"?this.parselookup[s.deps[q]]:s.deps[q];if(!n){s.deps[q]=null;continue;}s.deps[q]=n;if(!n.processed){n.processed=true;this.processNode(n);}}};}};apf.saveData=apf.getData=function(d,A){if(!d){return false;}var B,n=d.charAt(0),w=A.callback;var k=function(F,E,D){var C=this;$setTimeout(function(){u.call(C,F,E,D);});};var u=function(E,D,C){var F=A.callback;if(D!=apf.SUCCESS){return F(E,D,C||{});}return F(E,D,C||{});};if(!A){A={};}var j=A.fParsed||(d.indexOf("{")>-1||d.indexOf("[")>-1?apf.lm.compile(d,{withopt:true,precall:A.precall,alwayscb:true,simplexpath:true}):{str:d,type:2});if(A.precall){A.asyncs=j.asyncs;}if(j.type==3){if(j.xpaths[0]){var s=j.xpaths[0],t=j.xpaths[1];if(s=="#"||t=="#"){var i=(apf.lm.compile(d,{xpathmode:5}))();if(typeof i!="string"){s=i.model&&i.model.$isModel&&i.model;if(s){t=i.xpath;}else{if(i.model){s=apf.xmldb.findModel(i.model);t=apf.xmlToXpath(i.model,s.data)+(i.xpath?"/"+i.xpath:"");}else{throw new Error();}}}else{s=null;}}else{s=apf.nameserver.get("model",s);}if(!s){throw new Error("Could not find model '"+s+"' in "+d);}return k(s.data.selectSingleNode(t),apf.SUCCESS,{});}else{if(!A.xmlNode){throw new Error(apf.formatErrorString(0,null,"Loading data","Xpath found without model and no xmlNode specified"+d));}return k(A.xmlNode.data.selectSingleNode(j.xpaths[1]),apf.SUCCESS,{});}}if(n=="<"){if(j.type==2){B=j.str;}else{return j(A.xmlNode,k,A);}}else{if((n=="["||n=="{")){return j(A.xmlNode,k,A);}else{if(j.type==1||j.type==3){var q=w;w=A.callback=function(F,E,C){if(A._pc===true){return;}if(E!=apf.SUCCESS){return q.apply(this,arguments);}var D=F.split(" "),G="get";if(D.length>1&&D[0].length<10){G=D.shift();D=D.join(" ");}else{D=F;}w=A.callback=q;apf.oHttp.exec(G,[D],k,A);};j(A.xmlNode,k,A);}else{if(A._pc===true){return;}var g=d.split(" "),c="get";if(g.length>1&&g[0].length<10){c=g.shift();g=g.join(" ");}else{g=d;}apf.oHttp.exec(c,[g],k,A);}}}if(B){if(w){k(B,apf.SUCCESS,{});}else{return B;}}};apf.setModel=function(c,i){if(!c){return;}var g=c.indexOf("{")>-1||c.indexOf("[")>-1?apf.lm.compile(c,{alwayscb:true}):{type:2,str:c};if(c=="@default"||g.type==2){var d=apf.nameserver.get("model",c);if(d){return d.register(i);}else{if(c=="@default"){return;}}if(c.indexOf(".")==-1&&c.indexOf("/")==-1){apf.console.warn("Could not find model '"+c+"'");return;}}if(g.type==3){if(g.models){if(g.xpaths.length==2&&g.xpaths[0]!="#"&&g.xpaths[1]!="#"){if(!apf.nameserver.get("model",g.xpaths[0])){throw new Error("Could not find model '"+g.xpaths[0]+"' in "+c);}apf.nameserver.get("model",g.xpaths[0]).register(i,g.xpaths[1]);return;}}else{apf.console.warn("Xpath found without model. This might fail if no                context is specified using local(): "+c);}}if(i.clear){i.clear("loading");}apf.getData(c,{parsed:g,xmlNode:i&&i.xmlRoot,callback:function(q,n,j){if(n!=apf.SUCCESS){throw new Error(apf.formatErrorString(0,null,"Loading new data","Could not load data into model.                 \nMessage: "+j.message+"                \nInstruction: '"+c+"'"));}if(!q){return i.clear&&i.clear();}if(typeof q=="string"){if(q.charAt(0)=="<"){q=apf.getXml(q);}else{if(q.indexOf("http://")==0){return apf.setModel(q,i);}else{throw new Error("Invalid data from server");}}}var k=apf.xmldb.findModel(q);if(k){k.register(i,apf.xmlToXpath(q,k.data));}else{new apf.model().register(i).load(q);}}});};apf.storage.modules.gears=apf.storage.modules["gears.sql"]={table_name:"STORAGE",initialized:false,$available:null,$db:null,init:function(){this.factory=apf.nameserver.get("google","gears");this.database_name=apf.config.name.substr(0,46)+".apf.offline.gears";this.$db=this.factory.create("beta.database","1.0");this.$db.open(this.database_name);try{this.$sql("CREATE TABLE IF NOT EXISTS "+this.table_name+"(  namespace TEXT,  key TEXT,  value TEXT )");this.$sql("CREATE UNIQUE INDEX IF NOT EXISTS namespace_key_index ON "+this.table_name+" (namespace, key)");this.initialized=true;}catch(c){apf.console.warn(c.message);return false;}},$sql:function(d,g){var c=this.$db.execute(d,g);return this.$normalizeResults(c);},destroy:function(){this.$db.close();},$normalizeResults:function(c){var g=[];if(!c){return[];}while(c.isValidRow()){var k={};for(var d=0;d<c.fieldCount();d++){var n=c.fieldName(d);var j=c.field(d);k[n]=j;}g.push(k);c.next();}c.close();return g;},isAvailable:function(){return apf.isGears;},put:function(c,g,d){if(this.isValidKey(c)==false){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Invalid key given: "+c));}if(!d){d=this.namespace;}if(this.isValidKey(d)==false){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Invalid namespace given: "+d));}g=apf.serialize(g);try{this.$sql("DELETE FROM "+this.table_name+" WHERE namespace = ? AND key = ?",[d,c]);this.$sql("INSERT INTO "+this.table_name+" VALUES (?, ?, ?)",[d,c,g]);}catch(i){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Error setting name/value pair: "+i.message));return false;}return true;},get:function(d,g){if(this.isValidKey(d)==false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid key given: "+d));}if(!g){g=this.namespace;}if(this.isValidKey(g)==false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid namespace given: "+g));}var c=this.$sql("SELECT * FROM "+this.table_name+" WHERE namespace = ? AND  key = ?",[g,d]);if(!c.length){return null;}return apf.unserialize(c[0].value);},getNamespaces:function(){var g=[this.namespace];var c=this.$sql("SELECT namespace FROM "+this.table_name+" DESC GROUP BY namespace");for(var d=0;d<c.length;d++){if(c[d].namespace!=this.namespace){g.push(c[d].namespace);}}return g;},getKeys:function(j){if(!j){j=this.namespace;}if(this.isValidKey(j)==false){throw new Error(apf.formatErrorString(0,null,"Retrieving keys","Invalid namespace given: "+j));}var c=this.$sql("SELECT key FROM "+this.table_name+" WHERE namespace = ?",[j]);var g=[];for(var d=0;d<c.length;d++){g.push(c[d].key);}return g;},clear:function(c){if(!c){c=this.namespace;}if(this.isValidKey(c)==false){throw new Error(apf.formatErrorString(0,null,"Clearing storage","Invalid namespace given: "+c));}this.$sql("DELETE FROM "+this.table_name+" WHERE namespace = ?",[c]);},remove:function(c,d){if(!d){d=this.namespace;}if(this.isValidKey(d)==false){throw new Error(apf.formatErrorString(0,null,"Removing key","Invalid namespace given: "+d));}this.$sql("DELETE FROM "+this.table_name+" WHERE namespace = ? AND key = ?",[d,c]);},putMultiple:function(j,c,g){if(this.isValidKeyArray(j)===false||!c instanceof Array||j.length!=c.length){throw new Error(apf.formatErrorString(0,null,"Setting multiple name/value pairs","Invalid arguments: keys = ["+j+"],                                     values = ["+c+"]"));}if(!g){g=this.namespace;}if(this.isValidKey(g)==false){throw new Error(apf.formatErrorString(0,null,"Setting multiple name/value pairs","Invalid namespace given: "+g));}try{this.$sql.open();this.$sql.db.execute("BEGIN TRANSACTION");var n="REPLACE INTO "+this.table_name+" VALUES (?, ?, ?)";for(var d=0;d<j.length;d++){var k=apf.serialize(c[d]);this.$sql.db.execute(n,[g,j[d],k]);}this.$sql.db.execute("COMMIT TRANSACTION");this.$sql.close();}catch(q){throw new Error(apf.formatErrorString(0,null,"Writing multiple name/value pair","Error writing file: "+q.message));return false;}return true;},getMultiple:function(k,j){if(this.isValidKeyArray(k)===false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid key array given: "+k));}if(!j){j=this.namespace;}if(this.isValidKey(j)==false){throw new Error(apf.formatErrorString(0,null,"Getting multiple name/value pairs","Invalid namespace given: "+j));}var n="SELECT * FROM "+this.table_name+" WHERE namespace = ? AND  key = ?";var g=[];for(var d=0;d<k.length;d++){var c=this.$sql(n,[j,k[d]]);g[d]=c.length?apf.unserialize(c[0].value):null;}return g;},removeMultiple:function(g,d){if(this.isValidKeyArray(g)===false){throw new Error(apf.formatErrorString(0,null,"Removing name/value pair","Invalid key array given: "+g));}if(!d){d=this.namespace;}if(this.isValidKey(d)==false){throw new Error(apf.formatErrorString(0,null,"Removing multiple name/value pairs","Invalid namespace given: "+d));}this.$sql.open();this.$sql.db.execute("BEGIN TRANSACTION");var j="DELETE FROM "+this.table_name+" WHERE namespace = ? AND key = ?";for(var c=0;c<g.length;c++){this.$sql.db.execute(j,[d,g[c]]);}this.$sql.db.execute("COMMIT TRANSACTION");this.$sql.close();},isPermanent:function(){return true;},getMaximumSize:function(){return this.SIZE_NO_LIMIT;},hasSettingsUI:function(){return false;},showSettingsUI:function(){throw new Error(this.declaredClass+" does not support a storage settings user-interface");},hideSettingsUI:function(){throw new Error(this.declaredClass+" does not support a storage settings user-interface");}};apf.storage.modules.air={init:function(){this.ByteArray=window.runtime.flash.utils.ByteArray;this.EncryptedLocalStore=window.runtime.flash.data.EncryptedLocalStore;},isAvailable:function(){return apf.isAIR;},_getItem:function(c){var d=this.EncryptedLocalStore.getItem("__apf_"+c);return d?d.readUTFBytes(d.length):"";},_setItem:function(d,g){var c=new this.ByteArray();c.writeUTFBytes(g);this.EncryptedLocalStore.setItem("__apf_"+d,c);},_removeItem:function(c){this.EncryptedLocalStore.removeItem("__apf_"+c);},put:function(c,j,d){if(this.isValidKey(c)==false){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Invalid key given: "+c));}if(!d){d=this.namespace;}if(this.isValidKey(d)==false){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Invalid namespace given: "+d));}try{var i=this._getItem("namespaces")||"";if(i.indexOf("|"+d+"|")==-1){this._setItem("namespaces",i+d+"|");}var g=this._getItem(d+"_keys")||"";if(g.indexOf("|"+c+"|")==-1){this._setItem(d+"_keys",g+c+"|");}this._setItem("_"+d+"_"+c,j);}catch(k){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Error writing: "+k.message));return false;}return true;},get:function(c,d){if(this.isValidKey(c)==false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid key given: "+c));}if(!d){d=this.namespace;}if(this.isValidKey(d)==false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid namespace given: "+d));}return this._getItem("_"+d+"_"+c);},getNamespaces:function(){var d=[this.namespace];var g=(this._getItem("namespaces")||"").split("|");for(var c=0;c<g.length;c++){if(g[c]&&g[c]!=this.namespace){d.push(g[c]);}}return d;},getKeys:function(g){if(!g){g=this.namespace;}if(this.isValidKey(g)==false){throw new Error(apf.formatErrorString(0,null,"Getting keys","Invalid namespace given: "+g));}var d=[];var j=(this._getItem(g+"_keys")||"").split("|");for(var c=0;c<j.length;c++){if(j[c]){d.push(j[c]);}}return d;},clear:function(d){if(!d){d=this.namespace;}if(this.isValidKey(d)==false){throw new Error(apf.formatErrorString(0,null,"Clearing storage","Invalid namespace given: "+d));}var j=this._getItem("namespaces")||"";if(j.indexOf("|"+d+"|")!=-1){this._setItem("namespaces",j.replace("|"+d+"|","|"));}var g=(this._getItem(d+"_keys")||"").split("|");for(var c=0;c<g.length;c++){if(g[c].length){this._removeItem(d+"_"+g[c]);}}this._removeItem(d+"_keys");},remove:function(c,d){if(!d){d=this.namespace;}if(this.isValidKey(d)==false){throw new Error(apf.formatErrorString(0,null,"Removing key","Invalid namespace given: "+d));}var g=this._getItem(d+"_keys")||"";if(g.indexOf("|"+c+"|")!=-1){this._setItem(d+"_keys",g.replace("|"+c+"|","|"));}this._removeItem("_"+d+"_"+c);},putMultiple:function(j,c,g){if(this.isValidKeyArray(j)===false||!c instanceof Array||j.length!=c.length){throw new Error(apf.formatErrorString(0,null,"Setting multiple name/value pairs","Invalid arguments: keys = ["+j+"], values = ["+c+"]"));}if(!g){g=this.namespace;}if(this.isValidKey(g)==false){throw new Error(apf.formatErrorString(0,null,"Setting multiple name/value pairs","Invalid namespace given: "+g));}try{for(var d=0;d<j.length;d++){this.put(j[d],value[d],null,g);}}catch(k){throw new Error(apf.formatErrorString(0,null,"Writing multiple name/value pair","Error writing file: "+k.message));return false;}return true;},getMultiple:function(j,g){if(this.isValidKeyArray(j)===false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid key array given: "+j));}if(!g){g=this.namespace;}if(this.isValidKey(g)==false){throw new Error(apf.formatErrorString(0,null,"Getting multiple name/value pairs","Invalid namespace given: "+g));}var d=[];for(var c=0;c<j.length;c++){d[c]=this.get(j[c],g);}return d;},removeMultiple:function(g,d){if(this.isValidKeyArray(g)===false){throw new Error(apf.formatErrorString(0,null,"Removing name/value pair","Invalid key array given: "+g));}if(!d){d=this.namespace;}if(this.isValidKey(d)==false){throw new Error(apf.formatErrorString(0,null,"Removing multiple name/value pairs","Invalid namespace given: "+d));}for(var c=0;c<g.length;c++){this.remove(g[c],d);}},isPermanent:function(){return true;},getMaximumSize:function(){return this.SIZE_NO_LIMIT;},hasSettingsUI:function(){return false;},showSettingsUI:function(){throw new Error(this.declaredClass+" does not support a storage settings user-interface");},hideSettingsUI:function(){throw new Error(this.declaredClass+" does not support a storage settings user-interface");}};apf.storage.modules.memory={initialized:true,store:{},isAvailable:function(){return true;},put:function(c,g,d){if(this.isValidKey(c)==false){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Invalid key given: "+c));}if(!d){d=this.namespace;}if(this.isValidKey(d)==false){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Invalid namespace given: "+d));}g=apf.serialize(g);if(!this.store[d]){this.store[d]={};}this.store[d][c]=g;},get:function(c,d){if(this.isValidKey(c)==false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid key given: "+c));}if(!d){d=this.namespace;}if(this.isValidKey(d)==false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid namespace given: "+d));}if(!this.store[d]||!this.store[d][c]){return null;}return apf.unserialize(this.store[d][c]);},getNamespaces:function(){var c=[this.namespace];for(var d in this.store){c.push(d);}return c;},getKeys:function(d){if(!d){d=this.namespace;}if(this.isValidKey(d)==false){throw new Error(apf.formatErrorString(0,null,"Clearing storage","Invalid namespace given: "+d));}var c=[];for(var g in this.store[d]){c.push(g);}return c;},clear:function(c){if(!c){c=this.namespace;}if(this.isValidKey(c)==false){throw new Error(apf.formatErrorString(0,null,"Clearing storage","Invalid namespace given: "+c));}delete this.store[c];},remove:function(c,d){if(!d){d=this.namespace;}if(this.isValidKey(d)==false){throw new Error(apf.formatErrorString(0,null,"Removing key","Invalid namespace given: "+d));}if(this.store[d]){delete this.store[d][c];}},putMultiple:function(j,c,g){if(this.isValidKeyArray(j)===false||!c instanceof Array||j.length!=c.length){throw new Error(apf.formatErrorString(0,null,"Setting multiple name/value pairs","Invalid arguments: keys = ["+j+"],                                     values = ["+c+"]"));}if(!g){g=this.namespace;}if(this.isValidKey(g)==false){throw new Error(apf.formatErrorString(0,null,"Setting multiple name/value pairs","Invalid namespace given: "+g));}if(!this.store[g]){this.store[g]={};}for(var d=0;d<j.length;d++){this.store[g][j[d]]=apf.serialize(c[d]);}return true;},getMultiple:function(j,g){if(this.isValidKeyArray(j)===false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid key array given: "+j));}if(!g){g=this.namespace;}if(this.isValidKey(g)==false){throw new Error(apf.formatErrorString(0,null,"Getting multiple name/value pairs","Invalid namespace given: "+g));}if(!this.store[g]){return[];}var d=[];for(var c=0;c<j.length;c++){if(this.store[g][j[c]]){d.push(apf.unserialize(this.store[g][j[c]]));}}return d;},removeMultiple:function(g,d){if(this.isValidKeyArray(g)===false){throw new Error(apf.formatErrorString(0,null,"Removing name/value pair","Invalid key array given: "+g));}if(!d){d=this.namespace;}if(this.isValidKey(d)==false){throw new Error(apf.formatErrorString(0,null,"Removing multiple name/value pairs","Invalid namespace given: "+d));}if(!this.store[d]){return;}for(var c=0;c<g.length;c++){delete this.store[d][g[c]];}},isPermanent:function(){return false;},getMaximumSize:function(){return this.SIZE_NO_LIMIT;},hasSettingsUI:function(){return false;},showSettingsUI:function(){throw new Error(this.declaredClass+" does not support a storage settings user-interface");},hideSettingsUI:function(){throw new Error(this.declaredClass+" does not support a storage settings user-interface");}};apf.storage.modules.flash={initialized:false,asyncInit:true,_available:null,_statusHandler:null,_flashReady:false,_pageReady:false,delayCalls:[],init:function(){this.name="flashStorage";this.id=apf.flash.addPlayer(this);this.STORAGE_SWF=(apf.config.resourcePath||apf.basePath)+"resources/apfStorage.swf?cachebust="+new Date().getTime();var flash=apf.flash.buildContent("src",this.STORAGE_SWF,"width","215","height","138","align","middle","id",this.name,"quality","high","bgcolor","#ffffff","allowFullScreen","true","name",this.name,"flashvars","playerID="+this.id,"allowScriptAccess","always","type","application/x-shockwave-flash","pluginspage","http://www.adobe.com/go/getflashplayer","menu","true");this.container=document.createElement("div");this.container.id=this.name+"_Container";this.container.className="apfVideo";with(this.container.style){width=height="0px";overflow="hidden";}document.body.appendChild(this.container);this.container.innerHTML=flash;this.player=apf.flash.getElement(this.name);this._allNamespaces=this.getNamespaces();this._flashReady=this._pageReady=true;},setVisible:function(visible){if(visible==true){this.container.style.position="absolute";this.container.style.visibility="visible";}else{with(this.container.style){position="absolute";x="-1000px";y="-1000px";visibility="hidden";}}return this;},callMethod:function(){if(!this.initialized||typeof this.player.callMethod!="function"){this.delayCalls.push(arguments);}else{var d=[this.player,"callMethod"],j=apf.flash,g=0,c=arguments.length;for(;g<c;g++){d.push(j.encode(d[g]));}j.remote.apply(null,d);}},delayedCallTimer:null,makeDelayCalls:function(){clearTimeout(this.delayedCallTimer);if(!this.delayCalls.length){if(typeof this["onready"]=="function"){this.onready();}return this;}this.callMethod.apply(this,this.delayCalls[0]);this.delayCalls.splice(0,1);var c=this;this.delayedCallTimer=window.setTimeout(function(){c.makeDelayCalls();},1);return this;},ready:function(c){if(this.initialized){c();}else{this.onready=c;}},event:function(d,g){if(d=="status"){var c=apf.storage;if(statusResult==c.PENDING){this.setVisible(true);}else{this.setVisible(false);}if(c._statusHandler){c._statusHandler.call(null,g.status,g.keyName,g.namespace);}}else{if(d=="loaded"){this.initialized=true;this.setVisible(false).makeDelayCalls();}}},setFlushDelay:function(c){if(c===null||typeof c==="undefined"||isNaN(c)){throw new Error("Invalid argunment: "+c);}this.callMethod("setFlushDelay",String(c));},getFlushDelay:function(){return Number(this.callMethod("getFlushDelay"));},flush:function(c){if(c==null||typeof c=="undefined"){c=apf.storage.namespace;}this.callMethod("flush",c);},isAvailable:function(){return location.protocol!="file:"&&apf.flash.isEightAvailable();},put:function(c,g,d){if(this.isValidKey(c)==false){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Invalid key given: "+c));}if(!d){d=this.namespace;}if(this.isValidKey(d)==false){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Invalid namespace given: "+d));}this.callMethod("put",c,apf.serialize(g),d);},putMultiple:function(n,d,j){if(this.isValidKeyArray(n)===false||!d instanceof Array||n.length!=d.length){throw new Error(apf.formatErrorString(0,null,"Setting multiple name/value pairs","Invalid arguments: keys = ["+n+"], values = ["+d+"]"));}if(!j){j=this.namespace;}if(this.isValidKey(j)==false){throw new Error(apf.formatErrorString(0,null,"Setting multiple name/value pairs","Invalid namespace given: "+j));}var q=n.join(",");var s=[];for(var g=0;g<d.length;g++){d[g]=apf.unserialize(d[g]);s[g]=d[g].length;}var c=d.join("");var k=s.join(",");this.callMethod("putMultiple",q,c,k,j);},get:function(d,g){if(this.isValidKey(d)==false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid key given: "+d));}if(!g){g=this.namespace;}if(this.isValidKey(g)==false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid namespace given: "+g));}var c=this.callMethod("get",d,g);if(c==""){return null;}return apf.unserialize(apf.flash.decode(c));},getMultiple:function(keys,namespace){if(this.isValidKeyArray(keys)===false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid key array given: "+keys));}if(!namespace){namespace=this.namespace;}if(this.isValidKey(namespace)==false){throw new Error(apf.formatErrorString(0,null,"Getting multiple name/value pairs","Invalid namespace given: "+namespace));}var metaKey=keys.join(",");var metaResults=this.callMethod("getMultiple",metaKey,namespace);if(!metaResults){return null;}var results=eval("("+metaResults.replace(/""([^",\]]+)/g,'"\\"$1').replace(/([^",]+)""/g,'$1\\""')+")");for(var i=0;i<results.length;i++){results[i]=(results[i]=="")?null:apf.unserialize(apf.flash.decode(results[i]));}return results;},_destringify:function(results){if(typeof results=="string"&&(/^string:/.test(results))){results=results.substring("string:".length);}else{results=eval(results);}return results;},getKeys:function(d){if(!d){d=this.namespace;}if(this.isValidKey(d)==false){throw new Error(apf.formatErrorString(0,null,"Clearing storage","Invalid namespace given: "+d));}var c=this.callMethod("getKeys",d);if(c==this||c==null||c=="null"){c="";}c=c.split(",");c.sort();return c;},getNamespaces:function(){var c=this.callMethod("getNamespaces");if(c==this||c==null||c=="null"){c=apf.storage.namespace||"default";}c=c.split(",");c.sort();return c;},clear:function(c){if(!c){c=this.namespace;}if(this.isValidKey(c)==false){throw new Error(apf.formatErrorString(0,null,"Clearing storage","Invalid namespace given: "+c));}this.callMethod("clear",c);},remove:function(c,d){if(!d){d=this.namespace;}if(this.isValidKey(d)==false){throw new Error(apf.formatErrorString(0,null,"Removing key","Invalid namespace given: "+d));}this.callMethod("remove",c,d);},removeMultiple:function(d,c){if(this.isValidKeyArray(d)===false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid key array given: "+d));}if(!c){c=this.namespace;}if(this.isValidKey(c)==false){throw new Error(apf.formatErrorString(0,null,"Getting multiple name/value pairs","Invalid namespace given: "+c));}var g=d.join(",");this.callMethod("removeMultiple",g,c);},isPermanent:function(){return true;},getMaximumSize:function(){return this.SIZE_NO_LIMIT;},hasSettingsUI:function(){return false;},showSettingsUI:function(){throw new Error(apf.formatErrorString(0,null,this.declaredClass+" does not support a storage settings user-interface"));},hideSettingsUI:function(){throw new Error(apf.formatErrorString(0,null,this.declaredClass+" does not support a storage settings user-interface"));},getResourceList:function(){return[];}};apf.storage.modules.cookie={initialized:true,isAvailable:function(){return true;},put:function(c,g,d){if(this.isValidKey(c)==false){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Invalid key given: "+c));}if(!d){d=this.namespace;}if(this.isValidKey(d)==false){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Invalid namespace given: "+d));}g=apf.serialize(g);apf.setcookie(d+"~"+c,g,new Date().getTime()+(60*60*24*365*10000));},get:function(c,d){if(this.isValidKey(c)==false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid key given: "+c));}if(!d){d=this.namespace;}if(this.isValidKey(d)==false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid namespace given: "+d));}var g=apf.getcookie(d+"~"+c);return g?apf.unserialize(g):null;},getNamespaces:function(){throw new Error("Not Implemented");var c=[this.namespace];for(var d in this.store){c.push(d);}return c;},getKeys:function(d){throw new Error("Not Implemented");if(!d){d=this.namespace;}if(this.isValidKey(d)==false){throw new Error(apf.formatErrorString(0,null,"Clearing storage","Invalid namespace given: "+d));}var c=[];for(var g in this.store[d]){c.push(g);}return c;},clear:function(c){throw new Error("Not Implemented");if(!c){c=this.namespace;}if(this.isValidKey(c)==false){throw new Error(apf.formatErrorString(0,null,"Clearing storage","Invalid namespace given: "+c));}delete this.store[c];},remove:function(c,d){if(!d){d=this.namespace;}if(this.isValidKey(d)==false){throw new Error(apf.formatErrorString(0,null,"Removing key","Invalid namespace given: "+d));}apf.delcookie(d+"~"+c);},putMultiple:function(j,c,g){throw new Error("Not Implemented");if(this.isValidKeyArray(j)===false||!c instanceof Array||j.length!=c.length){throw new Error(apf.formatErrorString(0,null,"Setting multiple name/value pairs","Invalid arguments: keys = ["+j+"],                                     values = ["+c+"]"));}if(!g){g=this.namespace;}if(this.isValidKey(g)==false){throw new Error(apf.formatErrorString(0,null,"Setting multiple name/value pairs","Invalid namespace given: "+g));}if(!this.store[g]){this.store[g]={};}for(var d=0;d<j.length;d++){this.store[g][j[d]]=apf.serialize(c[d]);}return true;},getMultiple:function(j,g){throw new Error("Not Implemented");if(this.isValidKeyArray(j)===false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid key array given: "+j));}if(!g){g=this.namespace;}if(this.isValidKey(g)==false){throw new Error(apf.formatErrorString(0,null,"Getting multiple name/value pairs","Invalid namespace given: "+g));}if(!this.store[g]){return[];}var d=[];for(var c=0;c<j.length;c++){if(this.store[g][j[c]]){d.push(apf.unserialize(this.store[g][j[c]]));}}return d;},removeMultiple:function(g,d){throw new Error("Not Implemented");if(this.isValidKeyArray(g)===false){throw new Error(apf.formatErrorString(0,null,"Removing name/value pair","Invalid key array given: "+g));}if(!d){d=this.namespace;}if(this.isValidKey(d)==false){throw new Error(apf.formatErrorString(0,null,"Removing multiple name/value pairs","Invalid namespace given: "+d));}if(!this.store[d]){return;}for(var c=0;c<g.length;c++){delete this.store[d][g[c]];}},isPermanent:function(){return false;},getMaximumSize:function(){return this.SIZE_NO_LIMIT;},hasSettingsUI:function(){return false;},showSettingsUI:function(){throw new Error(this.declaredClass+" does not support a storage settings user-interface");},hideSettingsUI:function(){throw new Error(this.declaredClass+" does not support a storage settings user-interface");}};apf.storage.modules.html5={domain:(location.hostname=="localhost")?"localhost.localdomain":location.hostname,initialized:true,storage:apf.isIE?self.localStorage:self.globalStorage,isAvailable:function(){try{var d=this.storage[location.href];}catch(c){return false;}return true;},put:function(c,g,d){if(this.isValidKey(c)==false){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Invalid key given: "+c));}c=this.getFullKey(c,d);g=apf.serialize(g);try{var j=this.storage[this.domain];j.setItem(c,g);}catch(i){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Could not set name/value pair"));}},get:function(d,g){if(this.isValidKey(d)==false){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Invalid key given: "+d));}d=this.getFullKey(d,g);var i=this.storage[this.domain];var c=i.getItem(d);if(c==null||c==""){return null;}return apf.unserialize(c);},getNamespaces:function(){var g=[this.namespace];var k={};var n=this.storage[this.domain];var c=/^__([^_]*)_/;for(var d=0;d<n.length;d++){var q=n.key(d);if(c.test(q)==true){var j=q.match(c)[1];if(typeof k[j]=="undefined"){k[j]=true;g.push(j);}}}return g;},getKeys:function(g){if(!g){g=this.namespace;}if(this.isValidKey(g)==false){throw new Error(apf.formatErrorString(0,null,"Getting keys","Invalid namespace given: "+g));}var n=new RegExp(g==this.namespace?"^([^_]{2}.*)$":"^__"+g+"_(.*)$");var j=this.storage[this.domain];var c=[];for(var d=0;d<j.length;d++){var k=j.key(d);if(n.test(k)==true){k=k.match(n)[1];c.push(k);}}return c;},clear:function(d){if(!d){d=this.namespace;}if(this.isValidKey(d)==false){throw new Error(apf.formatErrorString(0,null,"Clearing storage","Invalid namespace given: "+d));}var j=new RegExp(d==this.namespace?"^[^_]{2}":"^__"+d+"_");var g=this.storage[this.domain];for(var c=g.length-1;c>=0;c--){if(j.test(g.key(c))==true){g.removeItem(g.key(c));}}},remove:function(c,d){c=this.getFullKey(c,d);var g=this.storage[this.domain];g.removeItem(c);},isPermanent:function(){return true;},getMaximumSize:function(){return 0;},hasSettingsUI:function(){return false;},showSettingsUI:function(){throw new Error(apf.formatErrorString(0,null,this.declaredClass+" does not support a storage settings user-interface"));},hideSettingsUI:function(){throw new Error(apf.formatErrorString(0,null,this.declaredClass+" does not support a storage settings user-interface"));},getFullKey:function(c,d){if(!d){d=this.namespace;}if(this.isValidKey(d)==false){throw new Error(apf.formatErrorString(0,null,"Clearing storage","Invalid namespace given: "+d));}return d==this.namespace?c:"__"+d+"_"+c;}};apf.storage.modules["air.file"]={initialized:false,init:function(){this.File=window.runtime.flash.filesystem.File;this.FileStream=window.runtime.flash.filesystem.FileStream;this.FileMode=window.runtime.flash.filesystem.FileMode;this.storagePath="__APF_"+(apf.config.name?apf.config.name.toUpperCase():"STORAGE")+"/";try{var c=this.File.applicationStorageDirectory.resolvePath(this.storagePath);if(!c.exists){c.createDirectory();}this.initialized=true;}catch(d){apf.console.warn(d.message);return false;}},isAvailable:function(){return apf.isAIR;},put:function(g,j,i){if(this.isValidKey(g)==false){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Invalid key given: "+g));}if(!i){i=this.namespace;}if(this.isValidKey(i)==false){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Invalid namespace given: "+i));}try{this.remove(g,i);var c=this.File.applicationStorageDirectory.resolvePath(this.storagePath+i);if(!c.exists){c.createDirectory();}var d=c.resolvePath(g);var n=new this.FileStream();n.open(d,this.FileMode.WRITE);n.writeObject(j);n.close();}catch(k){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Error writing file: "+k.message));return false;}return true;},get:function(g,i){if(this.isValidKey(g)==false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid key given: "+g));}if(!i){i=this.namespace;}if(this.isValidKey(i)==false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid namespace given: "+i));}var d=this.File.applicationStorageDirectory.resolvePath(this.storagePath+i+"/"+g);if(!d.exists||d.isDirectory){return false;}var j=new this.FileStream();j.open(d,this.FileMode.READ);var c=j.readObject();j.close();return c;},getNamespaces:function(){var g=[this.namespace];var c=this.File.applicationStorageDirectory.resolvePath(this.storagePath);var j=c.getDirectoryListing();for(var d=0;d<j.length;d++){if(j[d].isDirectory&&j[d].name!=this.namespace){g.push(j[d].name);}}return g;},getKeys:function(j){if(!j){j=this.namespace;}if(this.isValidKey(j)==false){throw new Error(apf.formatErrorString(0,null,"Clearing storage","Invalid namespace given: "+j));}var g=[];var c=this.File.applicationStorageDirectory.resolvePath(this.storagePath+j);if(c.exists&&c.isDirectory){var k=c.getDirectoryListing();for(var d=0;d<k.length;d++){g.push(k[d].name);}}return g;},clear:function(d){if(!d){d=this.namespace;}if(this.isValidKey(d)==false){throw new Error(apf.formatErrorString(0,null,"Clearing storage","Invalid namespace given: "+d));}var c=this.File.applicationStorageDirectory.resolvePath(this.storagePath+d);if(c.exists&&c.isDirectory){c.deleteDirectory(true);}},remove:function(d,g){if(!g){g=this.namespace;}if(this.isValidKey(g)==false){throw new Error(apf.formatErrorString(0,null,"Removing key","Invalid namespace given: "+g));}var c=this.File.applicationStorageDirectory.resolvePath(this.storagePath+g+"/"+d);if(c.exists&&!c.isDirectory){c.deleteFile();}},putMultiple:function(j,c,g){if(this.isValidKeyArray(j)===false||!c instanceof Array||j.length!=c.length){throw new Error(apf.formatErrorString(0,null,"Setting multiple name/value pairs","Invalid arguments: keys = ["+j+"], values = ["+c+"]"));}if(!g){g=this.namespace;}if(this.isValidKey(g)==false){throw new Error(apf.formatErrorString(0,null,"Setting multiple name/value pairs","Invalid namespace given: "+g));}try{for(var d=0;d<j.length;d++){this.put(j[d],c[d],null,g);}}catch(k){throw new Error(apf.formatErrorString(0,null,"Writing multiple name/value pair","Error writing file: "+k.message));return false;}return true;},getMultiple:function(j,g){if(this.isValidKeyArray(j)===false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid key array given: "+j));}if(!g){g=this.namespace;}if(this.isValidKey(g)==false){throw new Error(apf.formatErrorString(0,null,"Getting multiple name/value pairs","Invalid namespace given: "+g));}var d=[];for(var c=0;c<j.length;c++){d[c]=this.get(j[c],g);}return d;},removeMultiple:function(g,d){if(this.isValidKeyArray(g)===false){throw new Error(apf.formatErrorString(0,null,"Removing name/value pair","Invalid key array given: "+g));}if(!d){d=this.namespace;}if(this.isValidKey(d)==false){throw new Error(apf.formatErrorString(0,null,"Removing multiple name/value pairs","Invalid namespace given: "+d));}for(var c=0;c<g.length;c++){this.remove(g[c],d);}},isPermanent:function(){return true;},getMaximumSize:function(){return this.SIZE_NO_LIMIT;},hasSettingsUI:function(){return false;},showSettingsUI:function(){throw new Error(this.declaredClass+" does not support a storage settings user-interface");},hideSettingsUI:function(){throw new Error(this.declaredClass+" does not support a storage settings user-interface");}};apf.storage.modules["air.sql"]={database_file:"apf.db",initialized:false,_db:null,init:function(){this.File=window.runtime.flash.filesystem.File;this.SQLConnection=window.runtime.flash.data.SQLConnection;this.SQLStatement=window.runtime.flash.data.SQLStatement;this.table_name="__APF_"+(apf.config.name?apf.config.name.toUpperCase():"STORAGE");try{this._db=new this.SQLConnection();this._db.open(this.File.applicationStorageDirectory.resolvePath(this.database_file));this._sql("CREATE TABLE IF NOT EXISTS "+this.table_name+"(namespace TEXT, key TEXT, value TEXT)");this._sql("CREATE UNIQUE INDEX IF NOT EXISTS namespace_key_index ON "+this.table_name+" (namespace, key)");this.initialized=true;}catch(c){apf.console.warn(c.message);return false;}},_sql:function(d,g){var c=new this.SQLStatement();c.sqlConnection=this._db;c.text=d;if(g){apf.extend(c.parameters,g);}c.execute();return c.getResult();},isAvailable:function(){return apf.isAIR;},put:function(c,g,d){if(this.isValidKey(c)==false){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Invalid key given: "+c));}if(!d){d=this.namespace;}if(this.isValidKey(d)==false){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Invalid namespace given: "+d));}try{this._sql("DELETE FROM "+this.table_name+" WHERE namespace = :namespace AND key = :key",{":namespace":d,":key":c});this._sql("INSERT INTO "+this.table_name+" VALUES (:namespace, :key, :value)",{":namespace":d,":key":c,":value":g});}catch(i){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Error writing file: "+i.message));return false;}return true;},get:function(d,g){if(this.isValidKey(d)==false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid key given: "+d));}if(!g){g=this.namespace;}if(this.isValidKey(g)==false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid namespace given: "+g));}var c=this._sql("SELECT * FROM "+this.table_name+" WHERE namespace = :namespace AND key = :key",{":namespace":g,":key":d});if(c.data&&c.data.length){return c.data[0].value;}return null;},getNamespaces:function(){var g=[this.namespace];var c=this._sql("SELECT namespace FROM "+this.table_name+" DESC GROUP BY namespace");if(c.data){for(var d=0;d<c.data.length;d++){if(c.data[d].namespace!=this.namespace){g.push(c.data[d].namespace);}}}return g;},getKeys:function(j){if(!j){j=this.namespace;}if(this.isValidKey(j)==false){throw new Error(apf.formatErrorString(0,null,"Clearing storage","Invalid namespace given: "+j));}var g=[];var c=this._sql("SELECT key FROM "+this.table_name+" WHERE namespace = :namespace",{":namespace":j});if(c.data){for(var d=0;d<c.data.length;d++){g.push(c.data[d].key);}}return g;},clear:function(c){if(!c){c=this.namespace;}if(this.isValidKey(c)==false){throw new Error(apf.formatErrorString(0,null,"Clearing storage","Invalid namespace given: "+c));}this._sql("DELETE FROM "+this.table_name+" WHERE namespace = :namespace",{":namespace":c});},remove:function(c,d){if(!d){d=this.namespace;}if(this.isValidKey(d)==false){throw new Error(apf.formatErrorString(0,null,"Removing key","Invalid namespace given: "+d));}this._sql("DELETE FROM "+this.table_name+" WHERE namespace = :namespace AND key = :key",{":namespace":d,":key":c});},putMultiple:function(j,c,g){if(this.isValidKeyArray(j)===false||!c instanceof Array||j.length!=c.length){throw new Error(apf.formatErrorString(0,null,"Setting multiple name/value pairs","Invalid arguments: keys = ["+j+"], values = ["+c+"]"));}if(!g){g=this.namespace;}if(this.isValidKey(g)==false){throw new Error(apf.formatErrorString(0,null,"Setting multiple name/value pairs","Invalid namespace given: "+g));}try{this._db.begin();for(var d=0;d<j.length;d++){this._sql("DELETE FROM "+this.table_name+" WHERE namespace = :namespace AND key = :key",{":namespace":g,":key":key[d]});this._sql("INSERT INTO "+this.table_name+" VALUES (:namespace, :key, :value)",{":namespace":g,":key":key[d],":value":value});}this._db.commit();}catch(k){throw new Error(apf.formatErrorString(0,null,"Writing multiple name/value pair","Error writing file: "+k.message));return false;}return true;},getMultiple:function(k,j){if(this.isValidKeyArray(k)===false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid key array given: "+k));}if(!j){j=this.namespace;}if(this.isValidKey(j)==false){throw new Error(apf.formatErrorString(0,null,"Getting multiple name/value pairs","Invalid namespace given: "+j));}var g=[];for(var d=0;d<k.length;d++){var c=this._sql("SELECT * FROM "+this.table_name+" WHERE namespace = :namespace AND key = :key",{":namespace":j,":key":k[d]});g[d]=c.data&&c.data.length?c.data[0].value:null;}return g;},removeMultiple:function(g,d){if(this.isValidKeyArray(g)===false){throw new Error(apf.formatErrorString(0,null,"Removing name/value pair","Invalid key array given: "+g));}if(!d){d=this.namespace;}if(this.isValidKey(d)==false){throw new Error(apf.formatErrorString(0,null,"Removing multiple name/value pairs","Invalid namespace given: "+d));}this._db.begin();for(var c=0;c<g.length;c++){this._sql("DELETE FROM "+this.table_name+" WHERE namespace = namespace = :namespace AND key = :key",{":namespace":d,":key":g[c]});}this._db.commit();},isPermanent:function(){return true;},getMaximumSize:function(){return this.SIZE_NO_LIMIT;},hasSettingsUI:function(){return false;},showSettingsUI:function(){throw new Error(this.declaredClass+" does not support a storage settings user-interface");},hideSettingsUI:function(){throw new Error(this.declaredClass+" does not support a storage settings user-interface");}};apf.http=function(){this.queue=[null];this.callbacks={};this.cache={};this.timeout=this.timeout||10000;this.autoroute=this.autoroute||false;this["route-server"]=this["route-server"]||null;if(!this.$uniqueId){this.$uniqueId=apf.all.push(this)-1;}this.toString=this.toString||function(){return"[Ajax.org Teleport Component : (HTTP)]";};this.getXml=function(d,g,c){if(!c){c={};}c.useXML=true;c.callback=g;return this.get(d,c);};this.get=this.$get=function(j,d){if(!d){d={};}var i=this;var s=d.id;var k=d.async=(d.async||typeof d.async=="undefined"||apf.isOpera||false);if(apf.isWebkit){j=apf.html_entity_decode(j);}var E=d.data||"";if(apf.isNot(s)){var u=apf.getHttpReq();s=this.queue.push({http:u,url:j,callback:d.callback,retries:0,options:d})-1;}else{var u=this.queue[s].http;u.abort();}if(k){u.onreadystatechange=function(){if(!i.queue[s]||u.readyState!=4){return;}i.receive(s);};}var t=this.autoroute&&apf.isOpera?true:(d.autoroute||this.shouldAutoroute),w=t?this["route-server"]:j;if(!d.hideLogMessage){apf.console.teleport(this.queue[s].log=new apf.teleportLog({id:s,tp:this,type:d.type,method:this.method||d.method||"GET",url:j,route:t?w:"",data:new String(E&&E.xml?E.xml:E),start:new Date()}));}var c=[];function D(G,H){c.push(G+": "+H);u.setRequestHeader(G,H);}var g=false;try{if(d.nocache){w=apf.getNoCacheUrl(w);}try{netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");}catch(A){if(apf.hasHtml5XDomain&&w.match(/^http:\/\//)&&!new apf.url(w).isSameLocation()){throw new Error(apf.formatErrorString(0,this,"Communication error","Url: "+w+"\nReason: Same origin policy in effect"));}}u.open(this.method||d.method||"GET",w,k);if(d.username){D("Authorization","Basic "+apf.crypto.Base64.encode(d.username+":"+d.password));}if(!apf.isWebkit){D("User-Agent","Ajax.org Teleport 3.0");}D("X-Requested-With","XMLHttpRequest");if(!d.headers||!d.headers["Content-type"]){D("Content-type",this.contentType||(this.useXML||d.useXML?"text/xml":"text/plain"));}if(t){D("X-Route-Request",j);D("X-Proxy-Request",j);D("X-Compress-Response","gzip");}}catch(A){g=A.message;}if(g){var C=false;if(self.XMLHttpRequestUnSafe){try{u=new XMLHttpRequestUnSafe();u.onreadystatechange=function(){if(!i.queue[s]||u.readyState!=4){return;}i.receive(s);};u.open(this.method||d.method||"GET",(d.nocache?apf.getNoCacheUrl(w):w),k);D("X-Requested-With","XMLHttpRequest");if(!d.headers||!d.headers["Content-type"]){D("Content-type",this.contentType||(this.useXML||d.useXML?"text/xml":"text/plain"));}this.queue[s].http=u;d.async=true;C=true;}catch(A){}}if(!C&&this.autoroute&&!t){this.shouldAutoroute=true;d.autoroute=true;return this.get(j,d);}if(!C){var B=d.callback?d.callback(null,apf.ERROR,{userdata:d.userdata,http:u,url:j,tpModule:this,id:s,message:"Permission denied accessing remote resource: "+j+"\nMessage: "+g}):false;if(!B){this.clearQueueItem(s);}return;}}if(this.$headerHook){this.$headerHook(u);}if(d.headers){for(var F in d.headers){D(F,d.headers[F]);}}if(!d.hideLogMessage){this.queue[s].log.request(c);}function q(){var I=self.navigator.onLine?"File or Resource not available "+j:"Browser is currently working offline";apf.console.warn(I,"teleport");if(!d.hideLogMessage){i.queue[s].log.response({end:new Date(),message:I,http:u});}var G=self.navigator&&navigator.onLine?apf.ERROR:apf.TIMEOUT;var H=d.callback?d.callback(null,G,{userdata:d.userdata,http:u,url:j,tpModule:i,id:s,message:I}):false;if(!H){i.clearQueueItem(s);}}function n(I){var G;if(apf.isIE&&I){var H=window.onerror;window.onerror=function(){if(arguments.caller.callee==n){window.onerror=H;return true;}else{window.onerror=H;if(H){return H.apply(window,arguments);}}};u.send(E);window.onerror=H;}else{try{u.send(E);}catch(J){G=true;}}if(G){q();return;}}if(!k){n.call(this);return this.receive(s);}else{if(apf.loadsLocalFilesSync&&location.protocol=="file:"&&j.indexOf("http://")==-1){$setTimeout(function(){n.call(i,true);});}else{n.call(i);}return s;}};if(!this.exec){this.exec=function(k,g,j,d){if(!d){d={};}var c=g[0],i="";if(!d.method){d.method=k.toUpperCase();}if(!d.callback){d.callback=j;}this.contentType="application/x-www-form-urlencoded";this.$get(apf.getAbsolutePath(apf.config.baseurl,c),d.method=="GET"?d:apf.extend({data:i},d));};}this.receive=function(c){if(!this.queue[c]){return false;}var g=this.queue[c],n=g.http,q=g.callback;if(self.navigator&&navigator.onLine===false&&(location.protocol!="file:"||g.url.indexOf("http://")>-1)){return false;}if(g.async){try{if(n.status){}}catch(j){var k=this;return $setTimeout(function(){k.receive(c);},10);}}if(!g.options.hideLogMessage){apf.console.info("[HTTP] Receiving ["+c+"]"+(n.isCaching?"[<span style='color:orange'>cached</span>]":"")+" from "+g.url,"teleport",n.responseText);}var i=[],d={end:new Date(),tpModule:this,http:n,url:g.url,callback:q,id:c,retries:g.retries||0,userdata:g.options.userdata};if(n.status>600){return this.$timeout(c);}d.data=n.responseText;if(n.status>=400&&n.status<600||n.status<10&&n.status!=0){i.push("HTTP error ["+c+"]:"+n.status+"\n"+n.responseText);}if(g.options.useXML||this.useXML){if((n.responseText||"").replace(/^[\s\n\r]+|[\s\n\r]+$/g,"")==""){i.push("Received an empty XML document (0 bytes)");}else{try{var s=(n.responseXML&&n.responseXML.documentElement)?apf.xmlParseError(n.responseXML):apf.getXmlDom(n.responseText);if(!apf.supportNamespaces){s.setProperty("SelectionLanguage","XPath");}d.data=s.documentElement;}catch(j){i.push("Received invalid XML\n\n"+j.message);}}}if(i.length){d.message=i.join("\n");if(g.log){g.log.response(d);}if(!q||!q(d.data,apf.ERROR,d)){this.clearQueueItem(c);}return;}if(g.log){g.log.response(d);}if(!q||!q(d.data,apf.SUCCESS,d)){this.clearQueueItem(c);}return d.data;};this.$timeout=function(q){if(!this.queue[q]){return false;}var n=this.queue[q],g=n.http;try{if(g.status){}}catch(i){var d=this;return $setTimeout(function(){d.$timeout(q);},10);}var k=n.callback;g.abort();apf.console.info("HTTP Timeout ["+q+"]","teleport");var c;var j=k?k(null,apf.TIMEOUT,c={end:new Date(),userdata:n.options.userdata,http:g,url:n.url,tpModule:this,id:q,message:"HTTP Call timed out",retries:n.retries||0}):false;if(n.log){n.log.response(c);}if(!j){this.clearQueueItem(q);}};this.retryTimeout=function(c,g,d,j,i){if(g==apf.TIMEOUT&&c.retries<(i||apf.maxHttpRetries)){return c.tpModule.retry(c.id);}j=j||new Error(apf.formatErrorString(0,this,"Communication "+(g==apf.TIMEOUT?"timeout":"error"),"Url: "+c.url+"\nInfo: "+c.message));if((d||apf).dispatchEvent("error",apf.extend({error:j,state:g,bubbles:true},c))===false){return true;}};this.clearQueueItem=function(c){if(!this.queue[c]){return false;}if(apf.releaseHTTP){apf.releaseHTTP(this.queue[c].http);}this.queue[c]=null;delete this.queue[c];return true;};this.retry=function(d){if(!this.queue[d]){return false;}var c=this.queue[d];apf.console.info("[HTTP] Retrying request ["+d+"]","teleport");c.retries++;c.options.id=d;this.get(c.url,c.options);return true;};this.cancel=function(c){if(c===null){c=this.queue.length-1;}if(!this.queue[c]){return false;}this.clearQueueItem(c);};if(!this.$loadAml&&!this.instantiate&&!this.call){this.$loadAml=function(c){var n=this["receive"];for(var k=0,d=this.childNodes.length;k<d;k++){if(this.childNodes[k].nodeType!=1){continue;}var j=this.childNodes[k].getAttribute("url"),q=self[this.childNodes[k].getAttribute("receive")||n],g={useXML:this.childNodes[k].getAttribute("type")=="XML",async:!apf.isFalse(this.childNodes[k].getAttribute("async"))};this[this.childNodes[k].getAttribute("name")]=function(s,i){g.userdata=i;g.data=s;return this.get(j,g);};}};this.instantiate=function(c){var i=c.getAttribute("src"),g={async:c.getAttribute("async")!="false",nocache:true};this.getURL=function(k,j){g.data=k;g.userdata=j;g.callback=this.callbacks.getURL;return this.get(i,g);};var d="http"+Math.round(Math.random()*100000);apf.setReference(d,this);return d+".getURL()";};this.call=function(d,c){this[d].call(this,c);};}};apf.teleportLog=function(c){var g,i=c.method+" "+c.url+" HTTP/1.1\n\n"+c.data;this.setXml=function(j){if(!g){var k=j.ownerDocument;g=k.createElement(c.tp.localName||c.type||"http");g.appendChild(k.createElement("request")).appendChild(k.createTextNode(i||"-"));g.appendChild(k.createElement("response")).appendChild(k.createTextNode(d||"-"));}apf.xmldb.appendChild(j,g);};this.request=function(j){i=i.replace(/\n\n/,"\n"+j.join("\n")+"\n\n");if(g){apf.setQueryValue(g,"request/text()",i);}this.request=function(){};};var d="";this.response=function(j){var k=j.http.getAllResponseHeaders();d="HTTP/1.1 "+j.http.status+" "+j.http.statusText+"\n"+(k?k:"\n")+j.http.responseText;if(g){apf.setQueryValue(g,"response/text()",d);}};};apf.Init.run("http");apf.USEIFRAME=false;function runTpIframe(){function d(){this.$uniqueId=apf.all.push(this);var g=this;if(apf.USEIFRAME){this.iframe=document.body.appendChild(document.createElement("iframe"));this.iframe.style.width="400px";this.iframe.style.height="300px";this.iframe.style.position="absolute";this.iframe.style.left="0";this.iframe.style.top="0";this.iframe.style.zIndex=1000000000;document.body.style.display="block";}else{var j=document.body.appendChild(document.createElement("xml"));this.xmlDocument=j.XMLDocument;this.xmlDocument.setProperty("SelectionLanguage","XPath");document.body.removeChild(j);}this.readyState=0;this.status=null;this.responseText=null;this.responseXML=null;this.setRequestHeader=function(){};this.send=function(){this.done=false;if(apf.USEIFRAME){this.iframe.src=this.url;}else{this.xmlDocument.load(this.url);}};this.open=function(t,q,s){this.method=t;this.url=q;this.async=s;if(apf.USEIFRAME){if(!s){throw new Error(apf.formatErrorString(1081,null,"Iframe callback","Compatibility mode prevents possibility of non-async calls"));}this.iframe.onload=i;}else{this.xmlDocument.async=s;this.xmlDocument.onreadystatechange=k;}};this.abort=function(){if(apf.USEIFRAME){this.iframe.onreadystatechange=null;this.iframe.src="about:blank";g.done=false;g.readyState="";}else{this.xmlDocument.abort();}};var n=this;function k(){n.receive();}this.receive=function(){this.readyState=this.xmlDocument.readyState;if(this.readyState==4){this.status=200;this.responseText=this.xmlDocument.responseText||this.xmlDocument.xml;this.responseXML=this.xmlDocument;}if(this.onreadystatechange){this.onreadystatechange();}};function i(){if(g.done){return;}g.done=true;g.receiveIframe();}this.receiveIframe=function(){var s=this.iframe.contentWindow.document.body.innerText;s=s.replace(/^- /gm,"");try{this.responseXML=apf.getXmlDom(s);this.responseXML.setProperty("SelectionLanguage","XPath");this.responseXML.loadXML(s);}catch(q){this.responseXML=null;}this.responseText=this.responseXML?this.responseXML.xml:s;this.status=200;this.readyState=4;if(this.onreadystatechange){this.onreadystatechange();}};}function c(k,j){var g=document.body.appendChild(document.createElement("xml"));var i=g.XMLDocument;document.body.removeChild(g);i.setProperty("SelectionLanguage","XPath");if(k){i.loadXML(k);}if(!j){apf.xmlParseError(i);}return i;}}apf.DOMParser=function(){};apf.DOMParser.prototype=new (function(){this.caseInsensitive=true;this.preserveWhiteSpace=true;this.$shouldWait=0;var d=[/\<\!(DOCTYPE|doctype)[^>]*>/,/&nbsp;/g,/<\s*\/?\s*(?:\w+:\s*)[\w-]*[\s>\/]/g],c="//@*[not(contains(local-name(), '.')) and not(translate(local-name(), 'ABCDEFGHIJKLMNOPQRSTUVWXYZ', 'abcdefghijklmnopqrstuvwxyz') = local-name())]";this.parseFromString=function(j,n,g){var i;if(this.caseInsensitive){var k=j.replace(d[0],"").replace(d[2],function(q){return q.toLowerCase();});if(!this.supportNamespaces){k=k.replace(/xmlns\=\"[^"]*\"/g,"");}var i=apf.getXmlDom(k);if(apf.xmlParseError){apf.xmlParseError(i);}i=i.documentElement;}else{i=apf.getXmlDom(j,null,this.preserveWhiteSpace||apf.debug).documentElement;}return this.parseFromXml(i,g);};this.parseFromXml=function(k,q){var N,g,G,F;if(!q){q={};}if(!q.delayedRender&&!q.include){if(q.doc){N=q.doc;g=q.docFrag||N.createDocumentFragment();}else{N=new apf.AmlDocument();N.$aml=k;N.$domParser=this;}G=this.$createNode(N,k.nodeType,k);(g||N).appendChild(G);if(q.htmlNode){G.$int=q.htmlNode;}}else{G=q.amlNode;N=q.doc;if(q.include){var H=G.childNodes;var C=H.indexOf(q.beforeNode);var A=C?H.splice(C,H.length-C):[];}}this.$parseContext=[G,q];var I,E={},w=[],s=this;(function B(P,j){var Q,U,O,T,n=P.childNodes,S=0,R=j.length;for(;S<R;S++){U=s.$createNode(N,(O=j[S]).nodeType,O);if(!U){continue;}n[Q=n.length]=U;U.parentNode=P;if(Q>0){(U.previousSibling=n[Q-1]).nextSibling=U;}if(!U.render&&U.canHaveChildren&&(T=O.childNodes).length){B(U,T);}if(U.$parsePrio){if(U.$parsePrio=="001"){U.dispatchEvent("DOMNodeInsertedIntoDocument");continue;}(E[U.$parsePrio]||(w.push(U.$parsePrio)&&(E[U.$parsePrio]=[]))).push(U);}}P.firstChild=n[0];P.lastChild=n[Q];})(G,k.childNodes);if(q.include&&A.length){var t=H.length-1;H.push.apply(H,A);var u=H[t];var D=H[t+1];(D.previousSibling=u).nextSibling=D;G.lastChild=H[H.length-1];}if(q.delay){G.$parseOptions={prios:w,nodelist:E};return(g||N);}w.sort();var M,L,K,J;for(M=0,K=w.length;M<K;M++){I=E[w[M]];for(L=0,J=I.length;L<J;L++){I[L].dispatchEvent("DOMNodeInsertedIntoDocument");}}if(this.$shouldWait){return(g||N);}if(q.timeout){$setTimeout(function(){s.$continueParsing(G,q);});}else{this.$continueParsing(G,q);}return(g||N);};this.$callCount=0;this.$continueParsing=function(k,B){if(this.$shouldWait&&--this.$shouldWait!=0){return;}if(!B){B={};}this.$callCount++;if(k.$parseOptions){var u=k.$parseOptions.prios,A=k.$parseOptions.nodelist,t,s,q,n,g;delete k.$parseOptions;u.sort();for(t=0,q=u.length;t<q;t++){nodes=A[u[t]];for(s=0,n=nodes.length;s<n;s++){if(!(g=nodes[s]).parentNode||g.$amlLoaded){continue;}nodes[s].dispatchEvent("DOMNodeInsertedIntoDocument");}}}if(!B.ignoreSelf&&!k.$amlLoaded){k.dispatchEvent("DOMNodeInsertedIntoDocument");}(function w(C){var E,F;for(var D=0,j=C.length;D<j;D++){if(!(E=C[D]).$parsePrio&&!E.$amlLoaded){E.dispatchEvent("DOMNodeInsertedIntoDocument");}if(!E.render&&(F=E.childNodes).length){w(F);}}})(k.childNodes);if(!--this.$callCount&&!B.delay){apf.queue.empty();}if(B.callback){B.callback.call(k.ownerDocument);}delete this.$parseContext;};this.$createNode=function(G,u,H,k,F,B){var j;switch(u){case 1:var g,A;if(H){if((k=H.namespaceURI||apf.ns.xhtml)&&!(A=G.$prefixes[k])){G.$prefixes[A=H.prefix||H.scopeName||""]=k;G.$namespaceURIs[k]=A;if(!G.namespaceURI&&!A){G.namespaceURI=k;G.prefix=A;}}F=H.baseName||H.localName||H.tagName.split(":").pop();}else{A=G.$prefixes[k]||"";}if(!k){throw new Error("Missing namespace definition.");}if(!apf.namespaces[k]){if(this.allowAnyElement){k=apf.ns.xhtml;}else{throw new Error("Missing namespace handler for '"+k+"'");}}var t=apf.namespaces[k].elements;if(!(t[F]||t["@default"])){throw new Error("Missing element constructor: "+F);}j=new (t[F]||t["@default"])(null,F);j.prefix=A||"";j.namespaceURI=k;j.tagName=A?A+":"+F:F;if(H){if(g=H.getAttribute("id")){j.$propHandlers.id.call(j,j.id=g);}var D=H.attributes,q;for(var E,w=0,s=D.length;w<s;w++){j.attributes.push(new apf.AmlAttr(j,(q=(E=D[w]).nodeName),E.nodeValue));if(q=="render"){j.render=true;}}}break;case 2:j=new apf.AmlAttr();j.name=j.nodeName=F;if(B||(B=H&&H.nodeValue)){j.value=j.nodeValue=B;}if(H){if(H.namespaceURI&&!(j.prefix=G.$namespaceURIs[j.namespaceURI=H.namespaceURI])){G.$prefixes[j.prefix=H.prefix||H.scopeName]=j.namespaceURI;}}else{j.prefix=G.$prefixes[k];}break;case 3:if(H){B=H&&H.nodeValue;}if(!this.preserveWhitespace&&!(B||"").trim()){return;}j=new apf.AmlText();j.nodeValue=B||H&&H.nodeValue;break;case 7:var C=F||H&&H.nodeName;if(!apf.aml.processingInstructions[C]){throw new Error(apf.formatErrorString(0,null,"The processing instruction does not exist","Could not find the processing instruction with target: "+C));}j=new apf.aml.processingInstructions[C]();j.target=j.nodeName=C;j.data=j.nodeValue=B||H&&H.nodeValue;break;case 4:j=new apf.AmlCDATASection();j.nodeValue=B||H&&H.nodeValue;break;case 5:j=new apf.AmlNode();j.nodeType=u;break;case 6:j=new apf.AmlNode();j.nodeType=u;break;case 8:j=new apf.AmlComment();j.nodeValue=B||H&&H.nodeValue;break;case 9:j=new apf.AmlDocument();j.$domParser=this;break;case 10:j=new apf.AmlNode();j.nodeType=u;break;case 11:j=new apf.AmlDocumentFragment();break;}j.$aml=H;j.ownerDocument=G;return j;};})();apf.AmlNamespace=function(){this.elements={};this.processingInstructions={};};apf.AmlNamespace.prototype={setElement:function(c,d){return this.elements[c]=d;},setProcessingInstruction:function(d,c){this.processingInstructions[d]=c;}};apf.aml=new apf.AmlNamespace();apf.setNamespace("http://ajax.org/2005/aml",apf.aml);apf.__AMLNODE__=1<<14;apf.AmlNode=function(){this.$init(function(){this.childNodes=[];});};(function(){this.$regbase=this.$regbase|apf.__AMLNODE__;this.NODE_ELEMENT=1;this.NODE_ATTRIBUTE=2;this.NODE_TEXT=3;this.NODE_CDATA_SECTION=4;this.NODE_ENTITY_REFERENCE=5;this.NODE_ENTITY=6;this.NODE_PROCESSING_INSTRUCTION=7;this.NODE_COMMENT=8;this.NODE_DOCUMENT=9;this.NODE_DOCUMENT_TYPE=10;this.NODE_DOCUMENT_FRAGMENT=11;this.NODE_NOTATION=12;this.ownerDocument=null;this.nodeValue="";this.namespaceURI="";this.appendChild=this.insertBefore=function(j,u,g){if(!j||!j.hasFeature||!j.hasFeature(apf.__AMLNODE__)){throw new Error(apf.formatErrorString(1072,this,"Insertbefore DOM operation","Invalid argument passed. Expecting an AmlElement."));}if(this.nodeType==this.NODE_DOCUMENT){if(this.childNodes.length){throw new Error(apf.formatErrorString(0,this,"Insertbefore DOM operation","Only one top level element is allowed in an AML document."));}else{this.documentElement=j;}}if(j.nodeType==this.NODE_DOCUMENT_FRAGMENT){var c=j.childNodes.slice(0);for(var n=0,k=c.length;n<k;n++){this.insertBefore(c[n],u);}return j;}var d=j.parentNode==this,s=j.$pHtmlNode,A=j.parentNode,q=-1,t=this;if(u){q=this.childNodes.indexOf(u);if(q<0){if(u==this){throw new Error(apf.formatErrorString(1072,this,"Insertbefore DOM operation","Before node is the same node as inserted node"));}else{throw new Error(apf.formatErrorString(1072,this,"Insertbefore DOM operation","Before node is not a child of the parent node specified"));}return false;}}if(!j.ownerDocument){j.ownerDocument=this.ownerDocument||apf.ownerDocument;}if(j.parentNode){j.removeNode(d,g);}j.parentNode=this;if(u){q=this.childNodes.indexOf(u);}if(u){j.nextSibling=u;j.previousSibling=u.previousSibling;u.previousSibling=j;if(j.previousSibling){j.previousSibling.nextSibling=j;}}if(q>=0){this.childNodes=this.childNodes.slice(0,q).concat(j,this.childNodes.slice(q));}else{q=this.childNodes.push(j)-1;j.nextSibling=null;if(q>0){j.previousSibling=this.childNodes[q-1];j.previousSibling.nextSibling=j;}else{j.previousSibling=null;}}this.firstChild=this.childNodes[0];this.lastChild=this.childNodes[this.childNodes.length-1];function B(){j.$pHtmlNode=t.canHaveChildren?t.$int:document.body;j.dispatchEvent("DOMNodeInserted",{$beforeNode:u,relatedNode:t,$isMoveWithinParent:d,$oldParentHtmlNode:s,$oldParent:A,bubbles:true});var i;var C=(j.$ext&&j.$ext.nodeType==1&&(i=j.$ext.getElementsByTagName("iframe")).length>0&&apf.findHost(i[0].parentNode)==j);if(!g&&j.$ext){if(!j.$altExt||j.$altExt.parentNode==j.$pHtmlNode){j.$pHtmlNode.insertBefore(d&&j.$altExt||j.$ext,u&&(u.$altExt||u.$ext)||null);}}}var w=this.nodeType==this.NODE_DOCUMENT?this:this.ownerDocument;if(!w||w.$domParser.$shouldWait){return j;}if(this.nodeType==this.NODE_DOCUMENT_FRAGMENT){return;}if(!j.$amlLoaded){(this.ownerDocument||this).$domParser.$continueParsing(j,{delay:true});}B();return j;};this.removeNode=function(d,c){if(d&&typeof d!="boolean"){throw new Error(apf.formatErrorString(0,this,"Removing node from parent","Invalid DOM Call. removeNode() does not take any arguments."));}if(!this.parentNode||!this.parentNode.childNodes){return this;}if(!this.parentNode.childNodes.contains(this)){return false;}if(this.$amlLoaded&&!apf.isDestroying){this.dispatchEvent("DOMNodeRemoved",{relatedNode:this.parentNode,bubbles:true,$doOnlyAdmin:d});if(!c&&!d&&this.$ext&&this.$ext.parentNode){this.$ext.parentNode.removeChild(this.$ext);}}this.parentNode.childNodes.remove(this);if(this.parentNode.firstChild==this){this.parentNode.firstChild=this.nextSibling;}if(this.parentNode.lastChild==this){this.parentNode.lastChild=this.previousSibling;}if(this.nextSibling){this.nextSibling.previousSibling=this.previousSibling;}if(this.previousSibling){this.previousSibling.nextSibling=this.nextSibling;}this.$pHtmlNode=this.parentNode=this.previousSibling=this.nextSibling=null;return this;};this.removeChild=function(c){if(!c||!c.hasFeature||!c.hasFeature(apf.__AMLNODE__)){throw new Error(apf.formatErrorString(0,this,"Removing a child node","Invalid Argument. removeChild() requires one argument of type AMLElement."));}c.removeNode();return this;};this.replaceChild=function(){};this.cloneNode=function(c){if(c&&this.nodeType==1){return this.ownerDocument.$domParser.parseFromXml(this,{doc:this.ownerDocument,delay:true}).childNodes[0];}else{return this.ownerDocument.$domParser.$createNode(this.ownerDocument,this.nodeType,this);}};this.canDispatch=function(c,d){};this.compareDocumentPosition=function(c){};this.hasAttributes=function(){return this.attributes&&this.attributes.length;};this.hasChildNodes=function(){return this.childNodes&&this.childNodes.length;};this.isDefaultNamespace=function(c){if(d.nodeType==1){if(!this.prefix){return this.namespaceURI==c;}}var d=this.parentNode||this.ownerElement;return d&&d.isDefaultNamespace(c);};this.lookupNamespaceURI=function(d){if(c.nodeType==1){if(this.namespaceURI&&d==this.prefix){return this.namespaceURI;}}var c=this.parentNode||this.ownerElement;return c&&c.lookupNamespaceURI(d);};this.lookupPrefix=function(c){if(this.nodeType==1){if(c==this.namespaceURI&&this.prefix){return this.prefix;}}var d=this.parentNode||this.ownerElement;return d&&d.lookupPrefix(c);};this.normalize=function(){};this.selectNodes=function(d,c){if(!apf){return;}if(!apf.XPath){apf.runXpath();}return apf.XPath.selectNodes(d,c||(this.nodeType==9?this.documentElement:this));};this.selectSingleNode=function(d,c){if(!apf){return;}if(!apf.XPath){apf.runXpath();}return apf.XPath.selectNodes(d,c||(this.nodeType==9?this.documentElement:this))[0];};}).call(apf.AmlNode.prototype=new apf.Class());apf.AmlElement=function(g,c){var d=this.$init;this.$init=function(j,i,s){this.$supportedProperties=this.$supportedProperties.slice();var t,n,k;n=this.$propHandlers;k=this.$propHandlers={};for(t in n){k[t]=n[t];}n=this.$booleanProperties;k=this.$booleanProperties={};for(t in n){k[t]=n[t];}d.call(this,j,i,s);};this.$init(function(s,n,t){this.$events={};this.$inheritProperties={};this.attributes=new apf.AmlNamedNodeMap(this);this.nodeFunc=n;this.localName=s;if(t){var k,u,q,j;if(t.childNodes){k=t.childNodes;delete t.childNodes;}for(u in t){if(u=="htmlNode"){continue;}this.attributes.push(new apf.AmlAttr(this,u,t[u]));}if(!this.ownerDocument){this.ownerDocument=apf.document;this.prefix="";this.namespaceURI=null;this.tagName=s;}if(k){this.childNodes=k;for(q=0,j=k.length;q<j;q++){k[q].nextSibling=k[q+1]||null;k[q].previousSibling=k[q-1]||null;k[q].parentNode=this;}this.firstChild=k[0]||null;this.lastChild=k[k.length-1]||null;}this.$aml=apf.$emptyNode||(apf.$emptyNode=apf.getXml("<empty />"));}});if(c){d.call(this,c,apf.NODE_HIDDEN,g);}};(function(){this.nodeType=this.NODE_ELEMENT;this.canHaveChildren=true;this.$propHandlers={id:function(g){if(g=="apf"){throw new Error(apf.formatErrorString(0,this,"Setting Name of Element","Cannot set name of element to 'apf'"));}if(this.name==g){return;}if(self[this.name]==this){self[this.name]=null;}if(!self[g]||!self[g].hasFeature){try{self[g]=this;}catch(d){var c=true;}}if(c&&g in self){apf.console.warn("trying to set a value in the global scope with a reserved name '"+g+"'.\nNothing wrong with that, except that you will not be able to reference\nthe object from the global scope in JS.");}apf.nameserver.register(this.localName,g,this);this.name=g;}};this.$booleanProperties={};this.$inheritProperties={};this.$supportedProperties=[];this.getElementsByTagName=function(k,q){k=k.toLowerCase();var n,j,d,g=this.childNodes,c=[];for(j=0,d=g.length;j<d;j++){if((n=g[j]).nodeType!=1){continue;}if(n.tagName==k||k=="*"){c.push(n);}if(!q&&n.nodeType==1){c=c.concat(n.getElementsByTagName(k));}}return c;};this.getElementsByTagNameNS=function(k,j,s){j=j.toLowerCase();var q,n,d,g=this.childNodes,c=[];for(n=0,d=g.length;n<d;n++){if((q=g[n]).nodeType!=1){continue;}if(q.namespaceURI==k&&(q.localName==j||j=="*")){c.push(q);}if(!s&&q.nodeType==1){c=c.concat(q.getElementsByTagNameNS(k,j));}}return c;};this.setAttribute=function(g,j,i){g=g.toLowerCase();var c=this.attributes.getNamedItem(g);if(!c){this.attributes.push(c=new apf.AmlAttr(this,g,j));if(!this.$amlLoaded){return;}if(i){c.$setValue(j);}else{c.dispatchEvent("DOMNodeInsertedIntoDocument",{relatedNode:this});c.dispatchEvent("DOMNodeInserted",{relatedNode:this,bubbles:true});}return;}var d=c.nodeValue;c.$setValue(j);if(i||!this.$amlLoaded){return;}c.$triggerUpdate(null,d);};this.setAttributeNode=function(c){this.attributes.setNamedItem(c);};this.setAttributeNS=function(d,c,g){return this.setAttribute(c,g);};this.hasAttribute=function(c){return this.getAttributeNode(c)?true:false;};this.hasAttributeNS=function(d,c){return this.hasAttribute(c);};this.removeAttribute=function(c){this.attributes.removeNamedItem(c);return this;};this.removeAttributeNS=function(d,c){return this.removeAttribute(c);};this.removeAttributeNode=function(c){this.attributes.removeNamedItem(c.name);};this.getAttribute=function(d,c){var g=this.attributes.getNamedItem(d);return g?(c?g.inheritedValue||g.nodeValue:g.nodeValue):null;};this.getAttributeNode=function(c){return this.attributes.getNamedItem(c);};this.getBoundingClientRect=function(){return new apf.AmlTextRectangle(this);};this.querySelector=function(){};this.querySelectorAll=function(){};this.scrollIntoView=function(){};this.replaceMarkup=function(c,d){apf.console.info("Remove all children from element");if(!d){d={};}if(!d.$intAML){d.$intAML=this.$aml;}if(!d.$int){d.$int=this.$int;}d.clear=true;for(var g=this.childNodes.length-1;g>=0;g--){var j=this.childNodes[g];if(j.destroy){j.destroy(true);}if(j.$ext!=this.$int){apf.destroyHtmlNode(j.$ext);}}this.childNodes.length=0;this.$int.innerHTML="<div class='loading'>loading...</div>";this.insertMarkup(c,d);};this.insertMarkup=function(d,g){apf.console.info("Loading sub markup from external source");var c=new apf.XiInclude();c.setAttribute("href",d);if(g&&g.clear){c.setAttribute("clear",true);}c.options=g;c.callback=g&&g.callback;this.appendChild(c);};this.serialize=function(d){if(d||!this.firstChild){return"<"+(this.prefix?this.prefix+":"+this.localName+" xmlns:"+this.prefix+'="'+this.namespaceURI+'"':this.localName)+(this.attributes.length?" ":"")+this.attributes.join(" ")+"/>";}else{var g=["<"+(this.prefix?this.prefix+":"+this.localName+" xmlns:"+this.prefix+'="'+this.namespaceURI+'"':this.localName)+(this.attributes.length?" ":"")+this.attributes.join(" ")+">"];for(var c=this.firstChild;c;c=c.nextSibling){g.push(c.serialize());}return g.join("")+"</"+(this.prefix?this.prefix+":"+this.localName:this.localName)+">";}};this.$setInheritedAttribute=function(g){var d,c=this;d=c.getAttribute(g);if(!d){c=c.parentNode;while(c&&c.nodeType==1&&!(d=c.getAttribute(g,true))){c=c.parentNode;}}if(!d&&apf.config&&g){d=apf.config[g];}if(d){this.$clearDynamicProperty(g);if(typeof d=="string"&&(d.indexOf("{")>-1||d.indexOf("[")>-1)){this.$setDynamicProperty(g,d);this.$inheritProperties[g]=2;}else{this.setProperty(g,d,false,false,2);}}return d;};this.$handlePropSet=function(i,g,d){if(g&&this.$booleanProperties[i]){g=apf.isTrue(g);}if(typeof this[i]=="function"){throw new Error("Could not set property/attribute '"+i+"' which has the same name as a method on this object: '"+this.toString()+"'");}this[i]=g;var c;return(c=this.$propHandlers&&this.$propHandlers[i]||this.nodeFunc==apf.NODE_VISIBLE&&apf.GuiElement&&apf.GuiElement.propHandlers[i]||null)&&c.call(this,g,i,d);};this.addEventListener("DOMNodeInsertedIntoDocument",function(k){var g,j,d,c=this.attributes;for(j=0,d=c.length;j<d;j++){c[j].dispatchEvent("DOMNodeInsertedIntoDocument");}this.$amlLoaded=true;},true);}).call(apf.AmlElement.prototype=new apf.AmlNode());apf.AmlCharacterData=function(){this.data="";this.length=0;this.$init(true);this.appendData=function(c){this.dispatchEvent("DOMCharacterDataModified",{value:c});};this.deleteData=function(d,c){this.dispatchEvent("DOMCharacterDataModified",{offset:d,count:c});};this.insertData=function(d,c){this.dispatchEvent("DOMCharacterDataModified",{offset:d,count:c});};this.replaceData=function(g,c,d){this.dispatchEvent("DOMCharacterDataModified",{offset:g,count:c,value:d});};this.substringData=function(d,c){};};apf.AmlCharacterData.prototype=new apf.AmlNode();apf.AmlText=function(c){this.$init(c);};(function(){this.nodeType=this.NODE_TEXT;this.nodeName="#text";this.serialize=function(){return apf.xmlentities(this.nodeValue).replace(/</g,"&lt;").replace(/>/g,"&gt;");};this.$setValue=function(c){this.dispatchEvent("DOMCharacterDataModified",{bubbles:true,prevValue:this.nodeValue,newValue:this.nodeValue=c});if(this.$amlLoaded&&this.$ext){this.$ext.nodeValue=c;}};this.addEventListener("DOMNodeInsertedIntoDocument",function(d){var g;if(!(g=this.parentNode.$int)||this.parentNode.hasFeature(apf.__CHILDVALUE__)){return;}this.$amlLoaded=true;var c=this.nodeValue;if(apf.config.liveText&&!this.parentNode.hasFeature(apf.__CHILDVALUE__)&&(c.indexOf("{")>-1||c.indexOf("[")>-1)){this.$supportedProperties=[];this.$propHandlers={};this.$booleanProperties={};this.$inheritProperties={};this.$propHandlers.calcdata=apf.LiveMarkupPi.prototype.$propHandlers.calcdata;this.$setInheritedAttribute=apf.AmlElement.prototype.$setInheritedAttribute;this.implement(apf.StandardBinding);g.appendChild(this.$ext=document.createElement("span"));this.$setDynamicProperty("calcdata",this.nodeValue);return;}if(apf.hasTextNodeWhiteSpaceBug){var c=c.replace(/[\t\n\r ]+/g," ");if(c&&c!=" "){this.$ext=g.appendChild(g.ownerDocument.createTextNode(c));}}else{this.$ext=g.appendChild(g.ownerDocument.createTextNode(c));}},true);}).call(apf.AmlText.prototype=new apf.AmlCharacterData());apf.AmlTextRectangle=function(g){var c=this;function d(){var i=c.getAbsolutePosition(c.$ext);c.setProperty("left",i[0]);c.setProperty("top",i[1]);c.setProperty("right",document.documentElement.offsetWidth-i[0]);c.setProperty("bottom",document.documentElement.offsetWidth-i[1]);}g.addEventListener("prop.width",d);g.addEventListener("prop.height",d);g.addEventListener("prop.left",d);g.addEventListener("prop.top",d);d.call(g);};apf.AmlTextRectangle.prototype=new apf.Class();apf.AmlProcessingInstruction=function(c){this.$init(c);this.$supportedProperties=[];this.$propHandlers={};this.$booleanProperties={};this.$inheritProperties={};};(function(){this.nodeType=this.NODE_PROCESSING_INSTRUCTION;this.data=null;this.target=null;this.serialize=function(){return"<?"+this.target+"\n"+apf.xmlentities(this.nodeValue)+"\n?>";};this.reload=function(){this.$handlePropSet("data",this.data);};this.$attrExcludePropBind=apf.extend({calcdata:0},this.$attrExcludePropBind);this.getAttribute=function(){};this.$setInheritedAttribute=apf.AmlElement.prototype.$setInheritedAttribute;this.$setValue=function(c){this.setProperty("data",c);};this.$handlePropSet=function(g,d,c){this[g]=d;if(g=="data"){this.$clearDynamicProperty("calcdata");this.$setDynamicProperty("calcdata",d);}else{if(g=="target"){}else{if(this.$propHandlers[g]){this.$propHandlers[g].call(this,d,g);}}}};this.addEventListener("DOMNodeInsertedIntoDocument",function(c){var d=c.pHtmlNode;if(!d&&(this.parentNode.$bindingRule||!(d=this.parentNode.$int))){return;}d.appendChild(this.$ext=document.createElement("span"));this.$ext.host=this;this.$setDynamicProperty("calcdata",this.data);if(this.target.match(/\-debug$/)){apf.console.info(this.$lastFParsed.toString());}},true);this.$destroy=function(){this.$clearDynamicProperty("calcdata");this.$propHandlers.calcdata.call(this,"");};}).call(apf.AmlProcessingInstruction.prototype=new apf.AmlNode());apf.AmlDocument=function(){this.$prefixes={};this.$namespaceURIs={};this.domConfig=new apf.AmlConfiguration();this.$init();};(function(){this.nodeType=this.NODE_DOCUMENT;this.nodeFunc=apf.NODE_HIDDEN;this.nodeName="#document";this.$amlLoaded=true;this.activeElement=null;this.doctype=null;this.domConfig=null;this.implementation=null;this.characterSet=apf.characterSet;this.documentElement=null;this.getElementById=function(c){return self[c];};this.getElementsByTagName=function(d){var g,c=(g=this.documentElement).getElementsByTagName(d);if(d=="*"||g.tagName==d){c.unshift(g);}return c;};this.getElementsByTagNameNS=function(g,d){var i,c=(i=this.documentElement).getElementsByTagNameNS(g,d);if(d=="*"||i.tagName==d&&i.namespaceURI==g){c.unshift(i);}return c;};this.createElement=function(c){return this.$domParser.$createNode(this,this.NODE_ELEMENT,null,this.namespaceURI,c);};this.createElementNS=function(c,d){return this.$domParser.$createNode(this,this.NODE_ELEMENT,null,c,d);};this.importNode=function(d,c){if(c&&d.nodeType==1){return this.$domParser.parseFromXml(d,{doc:this,delay:true}).childNodes[0];}else{return this.$domParser.$createNode(this,d.nodeType,d);}};this.createAttribute=function(c){return this.$domParser.$createNode(this,this.NODE_ATTRIBUTE,null,this.nameSpaceURI,c);};this.createAttributeNS=function(c,d){return this.$domParser.$createNode(this,this.NODE_ATTRIBUTE,null,c,d);};this.createEvent=function(){return new apf.AmlEvent();};this.createComment=function(c){return this.$domParser.$createNode(this,this.NODE_COMMENT,null,null,null,c);};this.createProcessingInstruction=function(d,c){return this.$domParser.$createNode(this,this.NODE_PROCESSING_INSTRUCTION,null,null,d,c);};this.createCDATASection=function(c){return this.$domParser.$createNode(this,this.NODE_CDATA_SECTION,null,null,null,c);};this.createTextNode=function(c){return this.$domParser.$createNode(this,this.NODE_TEXT,null,null,null,c);};this.createDocumentFragment=function(){return this.$domParser.$createNode(this,this.NODE_DOCUMENT_FRAGMENT);};this.querySelector=function(){};this.querySelectorAll=function(){};this.evaluate=function(j,i,g,k,d){var c=apf.XPath.selectNodes(j,i||this.documentElement);return{snapshotLength:c.length,snapshotItem:function(n){return c[n];}};};this.createNSResolver=function(c){return{};};this.hasFocus=function(){};}).call(apf.AmlDocument.prototype=new apf.AmlNode());apf.AmlComment=function(c){this.nodeType=this.NODE_COMMENT;this.nodeName="#comment";this.$init(c);};(function(){this.serialize=function(){return"<!--"+this.nodeValue+"-->";};this.$setValue=function(c){this.dispatchEvent("DOMCharacterDataModified",{bubbles:true,newValue:c,prevValue:this.nodeValue});};}).call(apf.AmlComment.prototype=new apf.AmlCharacterData());apf.AmlNamedNodeMap=function(c){this.$host=c;};(function(){this.getNamedItem=function(c){for(var d=0;d<this.length;d++){if(this[d].name==c){return this[d];}}return false;};this.setNamedItem=function(j){var c=j.name;for(var g,d=this.length-1;d>=0;d--){if(this[d].name==c){this[d].ownerElement=null;this.splice(d,1);break;}}this.push(j);j.ownerElement=this.$host;j.ownerDocument=this.$host.ownerDocument;j.$triggerUpdate();};this.removeNamedItem=function(d){for(var j,g=this.length-1;g>=0;g--){if(this[g].name==d){j=this[g];this.splice(g,1);break;}}if(!j){return false;}var c=j.nodeValue;j.nodeValue=j.value="";j.$triggerUpdate(null,c);j.ownerElement=null;j.nodeValue=j.value=c;return j;};this.item=function(c){return this[c];};this.length=0;this.splice=function(j,g){for(var d=j,c=this.length-g;d<c;d++){this[d]=this[d+1];}delete this[d];this.length-=g;};this.push=function(c){this[this.length++]=c;return this.length;};this.join=function(k){var c=[];for(var n,g,j=0,d=this.length;j<d;j++){if((n=(g=this[j]).ownerElement)&&!n.$inheritProperties[g.nodeName]){c.push(this[j]);}}return c.join(k);};}).call(apf.AmlNamedNodeMap.prototype={});apf.AmlEvent=function(c,d){this.name=c;var g;for(g in d){this[g]=d[g];}};apf.AmlEvent.prototype={bubbles:false,cancelBubble:false,preventDefault:function(){this.returnValue=false;},stopPropagation:function(){this.cancelBubble=true;},stop:function(){this.returnValue=false;this.cancelBubble=true;}};apf.AmlAttr=function(g,c,d){this.$init();if(g){this.ownerElement=g;this.ownerDocument=g.ownerDocument;}this.nodeName=this.name=c;this.nodeValue=this.value=d;};(function(){this.nodeType=this.NODE_ATTRIBUTE;this.MODIFICATION=1;this.ADDITION=2;this.REMOVAL=3;this.serialize=this.toString=function(){return this.name+'="'+apf.xmlentities(String(this.value)).replace(/</g,"&lt;").replace(/>/g,"&gt;")+'"';};this.$setValue=function(c){this.nodeValue=this.value=c;this.specified=true;this.ownerElement.dispatchEvent("DOMAttrModified",{relatedNode:this,attrChange:this.MODIFICATION,attrName:this.name,newValue:c,prevValue:this.$lastValue||"",bubbles:true});this.$lastValue=c;};this.$triggerUpdate=function(j,d){var c=this.name,i=this.value||this.nodeValue,g=this.ownerElement;if(c=="id"&&!this.specified&&g.id){this.specified=true;return;}if(c.substr(0,2)=="on"){if(g.$events[c]){g.removeEventListener(c.replace(/^on/,""),g.$events[c]);}if(i){g.addEventListener(c,(g.$events[c]=(typeof i=="string"?apf.lm.compile(i,{event:true,parsecode:true}):i)));}return;}else{if(this.specified){g.$clearDynamicProperty(c);}if(typeof i=="string"&&(g.$attrExcludePropBind[c]||(i.indexOf("{")>-1||i.indexOf("[")>-1))){g.$setDynamicProperty(c,i);this.specified=true;return;}}g.setProperty(c,i);if(this.specified){g.dispatchEvent("DOMAttrModified",{relatedNode:this,attrChange:this.MODIFICATION,attrName:c,newValue:i,prevValue:this.$lastValue||"",bubbles:true});}else{this.specified=true;}this.$lastValue=i;};this.addEventListener("DOMNodeInsertedIntoDocument",this.$triggerUpdate);}).call(apf.AmlAttr.prototype=new apf.AmlNode());apf.AmlCDATASection=function(c){this.nodeType=this.NODE_CDATA_SECTION;this.nodeName="#cdata-section";this.$init(c);};apf.AmlCDATASection.prototype=new apf.AmlText(true);apf.AmlCDATASection.prototype.serialize=function(){return"<![CDATA["+this.nodeValue+"]]>";};apf.AmlConfiguration=function(c){this.parameterNames=[];this.$init(c);};(function(){this.setParameter=this.setProperty;this.getParameter=this.getProperty;this.canSetParameter=function(c,d){return this.parameterNames.indexOf(c)>-1;};}).call(apf.AmlConfiguration.prototype=new apf.Class());apf.AmlDocumentFragment=function(c){this.$init(c);};apf.AmlDocumentFragment.prototype=new apf.AmlNode();apf.AmlDocumentFragment.prototype.nodeName="#document-fragment";apf.AmlDocumentFragment.prototype.nodeType=apf.AmlDocumentFragment.prototype.NODE_DOCUMENT_FRAGMENT;apf.xhtml=new apf.AmlNamespace();apf.setNamespace("http://www.w3.org/1999/xhtml",apf.xhtml);apf.XhtmlElement=function(g,d){this.$init(d||true,apf.NODE_VISIBLE,g);this.$xoe=this.addEventListener;this.addEventListener=this.$xae;this.removeEventListener=this.$xre;var c=this;this.$de=function(i){c.dispatchEvent(i.type,i);};};(function(){this.$xae=function(d,c){this.$xoe.apply(this,arguments);if(this.$ext){apf.addListener(this.$ext,d,this.$de);}};this.$xre=function(d,c){apf.AmlElement.prototype.removeEventListener.apply(this,arguments);if(this.$ext){apf.removeListener(this.$ext,d,this.$de);}};this.$handlePropSet=function(c,i,g){if(this.$booleanProperties[c]){i=apf.isTrue(i);}this[c]=i;var d=this.$propHandlers&&this.$propHandlers[c]||apf.GuiElement.propHandlers[c];if(d){d.call(this,i,null,c);}else{if(this.$int){this.$int.setAttribute(apf.isIE&&c=="class"?"className":c,i);}}};this.addEventListener("DOMNodeInsertedIntoDocument",function(c){var d;if(!(d=this.parentNode.$int)){return;}if(this.$aml){this.$ext=this.$int=apf.insertHtmlNode(this.$aml.serialize?this.$aml:this.$aml.cloneNode(false),d);}else{this.$ext=this.$int=d.appendChild(document.createElement(this.localName));}},true);}).call(apf.XhtmlElement.prototype=new apf.AmlElement());apf.xhtml.setElement("@default",apf.XhtmlElement);apf.XhtmlOptionElement=function(d,c){this.$init(c||"option",apf.NODE_VISIBLE,d);};(function(){this.addEventListener("DOMNodeInsertedIntoDocument",function(c){this.$ext=this.$int=this.parentNode.$int.appendChild(this.parentNode.$int.ownerDocument.createElement("option"));if(this.value){this.$int.setAttribute("value",this.value);}},true);}).call(apf.XhtmlOptionElement.prototype=new apf.AmlElement());apf.xhtml.setElement("option",apf.XhtmlOptionElement);apf.XhtmlInputElement=function(d,c){this.$init(c||"input",apf.NODE_VISIBLE,d);};(function(){this.$xae=apf.XhtmlElement.prototype.$xae;this.$xre=apf.XhtmlElement.prototype.$xre;this.$handlePropSet=function(c,g,d){if(c=="type"){return;}return apf.XhtmlElement.prototype.$handlePropSet.call(this,c,g,d);};this.addEventListener("DOMNodeInsertedIntoDocument",function(c){var d;if(!(d=this.parentNode.$int)){return;}if(this.$aml){this.$ext=this.$int=apf.insertHtmlNode(this.$aml.serialize?this.$aml:this.$aml.cloneNode(false),d);}else{this.$ext=this.$int=document.createElement(this.localName);if(this.getAttribute("type")){this.$int.setAttribute("type",this.getAttribute("type"));}d.appendChild(this.$int);}},true);}).call(apf.XhtmlInputElement.prototype=new apf.AmlElement());apf.xhtml.setElement("input",apf.XhtmlInputElement);apf.XhtmlHtmlElement=function(d,c){this.$init(c||"html",apf.NODE_VISIBLE,d);this.$int=document.body;this.$tabList=[];this.$focussable=apf.KEYBOARD;this.focussable=true;this.visible=true;this.$isWindowContainer=true;this.focus=function(){this.dispatchEvent("focus");};this.blur=function(){this.dispatchEvent("blur");};apf.window.$addFocus(this);this.addEventListener("DOMNodeInsertedIntoDocument",function(t){var q,k,w,j,u,g=this.attributes,s=this.ownerDocument;for(q=0,k=g.length;q<k;q++){w=(j=g[q]).nodeName.split(":");if(w[0]=="xmlns"){if(u=w[1]){s.$prefixes[u]=j.nodeValue;s.$namespaceURIs[j.nodeValue]=u;}else{s.namespaceURI=j.nodeValue;}}}if(!s.namespaceURI){s.namespaceURI=apf.ns.xhtml;}});};apf.XhtmlHtmlElement.prototype=new apf.XhtmlElement();apf.xhtml.setElement("html",apf.XhtmlHtmlElement);apf.XhtmlSkipChildrenElement=function(d,c){this.$init(c,apf.NODE_VISIBLE,d);};(function(){this.canHaveChildren=false;this.$redraw=function(){var c=this;apf.queue.add("redraw"+this.$uniqueId,function(){var g=c.$ext.parentNode;var d=c.$ext.nextSibling;g.removeChild(c.$ext);c.$ext=apf.insertHtmlNode(null,g,d,c.$aml?(c.$aml.serialize?c.$aml.serialize():c.$aml.xml):c.serialize());});};this.addEventListener("DOMNodeInsertedIntoDocument",function(c){var d;if(!(d=this.parentNode.$int)){return;}this.$ext=apf.insertHtmlNode(null,d,null,this.$aml?(this.$aml.serialize?this.$aml.serialize():this.$aml.xml):this.serialize());},true);}).call(apf.XhtmlSkipChildrenElement.prototype=new apf.AmlElement());apf.xhtml.setElement("object",apf.XhtmlSkipChildrenElement);apf.xhtml.setElement("embed",apf.XhtmlSkipChildrenElement);apf.xhtml.setElement("table",apf.XhtmlSkipChildrenElement);apf.xhtml.setElement("pre",apf.XhtmlSkipChildrenElement);apf.XhtmlBodyElement=function(d,c){this.$init(c||"body",apf.NODE_VISIBLE,d);};(function(){this.addEventListener("DOMNodeInsertedIntoDocument",function(c){if(!this.ownerDocument.body){this.ownerDocument.body=this;}this.$ext=this.$int=document.body;},true);}).call(apf.XhtmlBodyElement.prototype=new apf.AmlElement());apf.xhtml.setElement("body",apf.XhtmlBodyElement);apf.XhtmlIgnoreElement=function(d,c){this.$init(c,apf.NODE_VISIBLE,d);};apf.XhtmlIgnoreElement.prototype=new apf.AmlElement();apf.xhtml.setElement("script",apf.XhtmlIgnoreElement);apf.xhtml.setElement("noscript",apf.XhtmlIgnoreElement);apf.xhtml.setElement("head",apf.XhtmlIgnoreElement);apf.xhtml.setElement("meta",apf.XhtmlIgnoreElement);apf.xinclude=new apf.AmlNamespace();apf.setNamespace("http://www.w3.org/2001/XInclude",apf.xinclude);apf.XiInclude=function(d,c){this.$init(c||"include",apf.NODE_HIDDEN,d);};apf.xinclude.setElement("include",apf.XiInclude);apf.aml.setElement("include",apf.XiInclude);(function(){this.$parsePrio="002";this.$propHandlers.href=this.$propHandlers.src=function(i){if(typeof i!="string"){return d.call(this,i);}this.$path=i.charAt(0)=="{"?i:apf.getAbsolutePath(apf.hostPath,i);var j=this.ownerDocument.$domParser;if(!this.defer){j.$shouldWait++;this.$parseContext=j.$parseContext||[this.parentNode];}g.call(this,this.$path);};function c(i){if(this.callback){this.callback({xmlNode:i,amlNode:this.parentNode});}this.parentNode.removeChild(this);}function d(k){var q=this.ownerDocument.$domParser;if(this.clear){this.parentNode.$int.innerHTML="";}if(k){q.parseFromXml(k,{doc:this.ownerDocument,amlNode:this.parentNode,beforeNode:this,include:true});if(!this.defer){var n=(this.$parseContext[1]||(this.$parseContext[1]={})),j=n.callback,i=this;n.callback=function(){c.call(i,k);if(j){j.call(i.ownerDocument);}};q.$continueParsing.apply(q,this.$parseContext);}else{c.call(this,k);}}else{if(!this.defer){q.$continueParsing.apply(q,this.$parseContext);}c.call(this,k);}}function g(j){apf.console.info("Loading include file: "+j);var i=this;apf.getData(j,apf.extend(this.options||{},{type:"markup",callback:function(s,q,k){if(q!=apf.SUCCESS){var t=new Error(apf.formatErrorString(1007,i,"Loading Includes","Could not load Include file '"+(j||i.src)+"'\nReason: "+k.message));if(k.tpModule.retryTimeout(k,q,null,t)===true){return true;}apf.console.error(t.message);d.call(i,null);return;}s=s.replace(/\<\!DOCTYPE[^>]*>/,"").replace(/^[\r\n\s]*/,"");if(!apf.supportNamespaces){s=s.replace(/xmlns\=\"[^"]*\"/g,"");}if(s.indexOf("<a:application")==-1){s="<a:application xmlns:a='"+apf.ns.aml+"'>"+s+"</a:application>";}var n=apf.getXml(s,null,true);if(!n){throw new Error(apf.formatErrorString(0,null,"Loading include","Could not parse include file. Maybe the file does not exist?",n));}n.setAttribute("filename",k.url);apf.console.info("Loading of "+n[apf.TAGNAME].toLowerCase()+" include done from file: "+k.url);d.call(i,n);},async:true,ignoreOffline:true}));}}).call(apf.XiInclude.prototype=new apf.AmlElement());apf.__ANCHORING__=1<<13;apf.Anchoring=function(){this.$regbase=this.$regbase|apf.__ANCHORING__;this.$anchors=[];var k=1;var g=2;this.$updateQueue=0;this.$inited=this.$parsed=this.$anchoringEnabled=false;this.$hordiff=this.$verdiff=0;this.$rule_v=this.$rule_h=this.$rule_header="";var i=apf.layout;this.$supportedProperties.push("anchors");var d={right:function(t,u){if(!this.$anchoringEnabled&&!this.$setLayout("anchoring")){return;}if(!t&&t!==0){this.$ext.style[u]="";}if(!this.$updateQueue){i.queue(this.$pHtmlNode,this);}this.$updateQueue=this.$updateQueue|g;},bottom:function(t,u){if(!this.$anchoringEnabled&&!this.$setLayout("anchoring")){return;}if(!t&&t!==0){this.$ext.style[u]="";}if(!this.$updateQueue){i.queue(this.$pHtmlNode,this);}this.$updateQueue=this.$updateQueue|k;}};d.left=d.width=d.right;d.top=d.height=d.bottom;this.$propHandlers.anchors=function(t){this.$anchors=t?t.splitSafe("(?:, *| )"):[];if(!this.$anchoringEnabled&&!this.$setLayout("anchoring")){return;}if(!this.$updateQueue&&apf.loaded){i.queue(this.$pHtmlNode,this);}this.$updateQueue=this.$updateQueue|g|k;};this.$disableAnchoring=function(t){if(!this.$inited||!this.$anchoringEnabled||!this.$pHtmlNode){return;}i.removeRule(this.$pHtmlNode,this.$uniqueId+"_anchors");if(i.queue){i.queue(this.$pHtmlNode);}for(var u in d){delete this.$propHandlers[u];}this.removeEventListener("DOMNodeRemoved",n);this.removeEventListener("DOMNodeInserted",c);if(this.right){this.$ext.style.left=apf.getHtmlLeft(this.$ext);}if(this.bottom){this.$ext.style.top=apf.getHtmlTop(this.$ext);}this.removeEventListener("prop.visible",j);this.$inited=false;this.$anchoringEnabled=false;};this.$enableAnchoring=function(){if(this.$inited){return;}apf.extend(this.$propHandlers,d);this.addEventListener("DOMNodeRemoved",n);this.addEventListener("DOMNodeInserted",c);this.addEventListener("prop.visible",j);this.$updateQueue=0|((this.left||this.width||this.right||this.anchors)&&g)|((this.top||this.height||this.bottom||this.anchors)&&k);if(this.$updateQueue){i.queue(this.$pHtmlNode,this);}this.$inited=true;this.$anchoringEnabled=true;};function j(t){if(!(this.$rule_header||this.$rule_v||this.$rule_h)){return;}if(t.value){if(this.$rule_v||this.$rule_h){var u=this.$rule_header+"\n"+this.$rule_v+"\n"+this.$rule_h;i.setRules(this.$pHtmlNode,this.$uniqueId+"_anchors",u);i.queue(this.$pHtmlNode,this);}i.processQueue();}else{i.removeRule(this.$pHtmlNode,this.$uniqueId+"_anchors");i.queue(this.$pHtmlNode);}}function n(t){if(t&&(t.$doOnlyAdmin||t.currentTarget!=this)){return;}if(i.queue&&this.$pHtmlNode){i.removeRule(this.$pHtmlNode,this.$uniqueId+"_anchors");i.queue(this.$pHtmlNode);}}function c(t){if(!this.$amlLoaded||t.currentTarget!=this){return;}if(!t.$isMoveWithinParent&&this.$parsed){this.$moveAnchoringRules(t.$oldParentHtmlNode);}}this.$moveAnchoringRules=function(t,u){var w=t&&i.removeRule(t,this.$uniqueId+"_anchors");if(w){i.queue(t);}if(!this.$rule_v&&!this.$rule_h){return;}this.$rule_header=s.call(this);w=this.$rule_header+"\n"+this.$rule_v+"\n"+this.$rule_h;i.setRules(this.$pHtmlNode,this.$uniqueId+"_anchors",w);i.queue(this.$pHtmlNode,this);};this.$hasAnchorRules=function(){return this.$rule_v||this.$rule_h?true:false;};function s(){return"try{            var oHtml = "+(apf.hasHtmlIdsInJs?this.$ext.getAttribute("id"):"document.getElementById('"+this.$ext.getAttribute("id")+"')")+";                        var pWidth = "+(this.$pHtmlNode==this.$pHtmlDoc.body?"apf.getWindowWidth()":"apf.getHtmlInnerWidth(oHtml.parentNode)")+";                        var pHeight = "+(this.$pHtmlNode==this.$pHtmlDoc.body?"apf.getWindowHeight()":"apf.getHtmlInnerHeight(oHtml.parentNode)")+";            }catch(e){            }";}function q(u,t){return String(u).replace(apf.percentageMatch,"(("+t+" * $1)/100)");}this.$updateLayout=function(){if(!this.$ext.offsetHeight&&!this.$ext.offsetWidth){var F=this;var B=function(O,N,P){if(F.$updateQueue&&apf.isTrue(P)&&(F.$ext.offsetWidth||F.$ext.offsetHeight)){F.$updateLayout();apf.layout.activateRules(F.$ext.parentNode);var Q=F;while(Q){Q.unwatch("visible",B);Q=Q.parentNode;}F.$isWaitingOnDisplay=false;}};this.$isWaitingOnDisplay=true;this.watch("visible",B);var w=this.parentNode;while(w){w.watch("visible",B);w=w.parentNode;}return;}if(!this.$parsed){if(!this.$ext.getAttribute("id")){apf.setUniqueHtmlId(this.$ext);}this.$rule_header=s.call(this);this.$parsed=true;}if(!this.$updateQueue){if(this.visible){this.$ext.style.display="";}return;}if(this.draggable=="relative"){if("absolute|fixed|relative".indexOf(apf.getStyle(this.$ext,"position"))==-1){this.$ext.style.position="absolute";}}else{if(this.left||this.left===0||this.top||this.top===0||this.right||this.right===0||this.bottom||this.bottom===0||this.$anchors.length){if("absolute|fixed".indexOf(apf.getStyle(this.$ext,"position"))==-1){this.$ext.style.position="absolute";}}}var K;if(this.$updateQueue&g){K=[];this.$hordiff=apf.getWidthDiff(this.$ext);var E=this.$anchors[3]||this.left,I=this.$anchors[1]||this.right,A=this.width,H=E||E===0,M=I||I===0,D=A||A===0;if(I&&typeof I=="string"){I=q(I,"pWidth");}if(H){if(parseInt(E)!=E){E=q(E,"pWidth");K.push("oHtml.style.left = ("+E+") + 'px'");}else{this.$ext.style.left=E+"px";}}if(!H&&M){if(parseInt(I)!=I){I=q(I,"pWidth");K.push("oHtml.style.right = ("+I+") + 'px'");}else{this.$ext.style.right=I+"px";}}if(D){if(parseInt(A)!=A){A=q(A,"pWidth");K.push("oHtml.style.width = Math.max("+(this.minwidth-this.$hordiff)+", Math.min("+(this.maxwidth-this.$hordiff)+", "+A+" - "+this.$hordiff+")) + 'px'");}else{this.$ext.style.width=((A>this.minwidth?(A<this.maxwidth?A:this.maxwidth):this.minwidth)-this.$hordiff)+"px";}}if(H&&M){K.push("oHtml.style.width = (pWidth - ("+I+") - ("+E+") - "+this.$hordiff+") + 'px'");}this.$rule_h=(K.length?"try{"+K.join(";}catch(e){};try{")+";}catch(e){};":"");}if(this.$updateQueue&k){K=[];this.$verdiff=apf.getHeightDiff(this.$ext);var G=this.$anchors[0]||this.top,t=this.$anchors[2]||this.bottom,J=this.height,C=G||G===0,u=t||t===0,L=J||J===0;if(t&&typeof t=="string"){t=q(t,"pHeight");}if(C){if(parseInt(G)!=G){G=q(G,"pHeight");K.push("oHtml.style.top = ("+G+") + 'px'");}else{this.$ext.style.top=G+"px";}}if(!C&&u){if(parseInt(t)!=t){K.push("oHtml.style.bottom = ("+t+") + 'px'");}else{this.$ext.style.bottom=t+"px";}}if(L){if(parseInt(J)!=J){J=q(J,"pHeight");K.push("oHtml.style.height = Math.max("+(this.minheight-this.$verdiff)+", Math.min("+(this.maxheight-this.$verdiff)+", "+J+" - "+this.$verdiff+")) + 'px'");}else{this.$ext.style.height=((J>this.minheight?(J<this.maxheight?J:this.maxheight):this.minheight)-this.$verdiff)+"px";}}if(C&&u){K.push("oHtml.style.height = (pHeight - ("+t+") - ("+G+") - "+this.$verdiff+") + 'px'");}this.$rule_v=(K.length?"try{"+K.join(";}catch(e){};try{")+";}catch(e){};":"");}if(this.$rule_v||this.$rule_h){i.setRules(this.$pHtmlNode,this.$uniqueId+"_anchors",this.$rule_header+"\n"+this.$rule_v+"\n"+this.$rule_h,true);}else{i.removeRule(this.$pHtmlNode,this.$uniqueId+"_anchors");}this.$updateQueue=0;};this.addEventListener("DOMNodeInsertedIntoDocument",function(t){});this.addEventListener("DOMNodeRemovedFromDocument",function(t){this.$disableAnchoring();});};apf.__ALIGNMENT__=1<<12;apf.Alignment=function(){this.$regbase=this.$regbase|apf.__ALIGNMENT__;var l=apf.layout;if(typeof this.dock=="undefined"){this.dock=false;}if(typeof this.dockable=="undefined"){this.dockable=false;}this.$booleanProperties.dock=true;this.$booleanProperties.dockable=true;this.$supportedProperties.push("dock","dockable","align","lean","edge","weight","splitter","minwidth","minheight");this.$disableAlignment=function(purge){if(!this.aData||!this.$alignmentEnabled){return;}for(var prop in propHandlers){delete this.$propHandlers[prop];}this.removeEventListener("DOMNodeRemoved",remove);this.removeEventListener("DOMNodeInserted",reparent);this.removeEventListener("prop.visible",visibleHandler);remove.call(this);this.$alignmentEnabled=false;};this.$enableAlignment=function(purge){this.$alignmentEnabled=true;var buildParent="vbox|hbox".indexOf(this.parentNode.tagName)==-1&&!this.parentNode.pData;apf.extend(this.$propHandlers,propHandlers);this.addEventListener("DOMNodeRemoved",remove);this.addEventListener("DOMNodeInserted",reparent);this.addEventListener("prop.visible",visibleHandler);var layout=l.get(this.$pHtmlNode,buildParent?apf.getBox(this.parentNode.margin||this.$pHtmlNode.getAttribute("margin")||""):null);if(buildParent){this.parentNode.pData=l.parseXml(this.parentNode||apf.getXml("<vbox />"),layout,"vbox",true);layout.root=this.parentNode.pData;}if(!this.aData){this.aData=l.parseXml(this,layout,this,true);}if(this.align){l.addAlignNode(this,layout.root);if(this.aData.hidden||this.visible===false){this.aData.prehide(true);}this.$purgeAlignment();}else{var pData=this.parentNode.aData||this.parentNode.pData;this.aData.stackId=pData.children.push(this.aData)-1;this.aData.parent=pData;}};function visibleHandler(e){if(!this.aData){return;}if(!this.aData.hidden==e.value){return;}if(e.value){if(this.aData.preshow()!==false){this.$ext.style.display="none";}this.$purgeAlignment();}else{this.$ext.style.display="block";this.aData.prehide();this.$purgeAlignment();}apf.layout.processQueue();}this.$purgeAlignment=function(){var layout=l.get(this.$pHtmlNode);if(this.$ext&&this.$ext.style.display=="block"&&!this.$ext.offsetHeight&&!this.$ext.offsetWidth){var _self=this;var propChange=function(name,old,value){if(_self.$ext.offsetWidth||_self.$ext.offsetHeight){l.queue(_self.$pHtmlNode,null,layout.root);var p=_self;while(p){p.unwatch("visible",propChange);p=p.parentNode;}_self.$isWaitingOnDisplay=false;}};this.$isWaitingOnDisplay=true;this.watch("visible",propChange);var p=this.parentNode;while(p){p.watch("visible",propChange);p=p.parentNode;}return;}l.queue(this.$pHtmlNode,null,layout.root);};function remove(e){if(e&&(e.$doOnlyAdmin||e.currentTarget!=this)){return;}if(this.aData){this.aData.remove();this.$purgeAlignment();if(this.parentNode.pData&&!this.parentNode.pData.children.length){l.removeAll(this.parentNode.pData);this.parentNode.pData=null;}if(this.$ext){this.$ext.style.display="none";}}}function reparent(e){if(!this.$amlLoaded||e.currentTarget!=this){return;}if(!e.$isMoveWithinParent&&this.aData&&this.aData.pHtml!=this.$pHtmlNode){this.aData.pHtml=this.$pHtmlNode;this.$enableAlignment();}}var propHandlers={align:function(value){if(value){this.$setLayout("alignment");}else{this.$setLayout("anchoring");this.$ext.style.display="block";}},lean:function(value){this.aData.isBottom=(value||"").indexOf("bottom")>-1;this.aData.isRight=(value||"").indexOf("right")>-1;this.$purgeAlignment();},edge:function(value){this.aData.edgeMargin=Math.max(this.aData.splitter||0,value!="splitter"?value:0);this.aData.splitter=value=="splitter"?5:false;this.$purgeAlignment();},weight:function(value){this.aData.weight=parseFloat(value);this.$purgeAlignment();},splitter:function(value){this.aData.splitter=value?5:false;this.aData.edgeMargin=Math.max(this.aData.splitter||0,this.edge||0);if(!value&&this.align&&this.align.indexOf("-splitter")){this.align=this.aData.template=this.align.replace("-splitter","");}this.$purgeAlignment();},width:function(value){this.width=null;this.aData.fwidth=value||false;if(this.aData.fwidth&&this.aData.fwidth.indexOf("/")>-1){this.aData.fwidth=eval(this.aData.fwidth);if(this.aData.fwidth<=1){this.aData.fwidth=(this.aData.fwidth*100)+"%";}}this.$purgeAlignment();},height:function(value){this.height=null;this.aData.fheight=String(value)||false;if(this.aData.fheight&&this.aData.fheight.indexOf("/")>-1){this.aData.fheight=eval(this.aData.fheight);if(this.aData.fheight<=1){this.aData.fheight=(this.aData.fheight*100)+"%";}}this.$purgeAlignment();},minwidth:function(value){this.aData.minwidth=value;this.$purgeAlignment();},minheight:function(value){this.aData.minheight=value;this.$purgeAlignment();}};this.addEventListener("DOMNodeRemovedFromDocument",function(e){this.$disableAlignment();this.aData=null;});};apf.__CONTENTEDITABLE__=1<<24;apf.__GUIELEMENT__=1<<15;apf.__VALIDATION__=1<<6;apf.GuiElement=function(){this.$init(true);};(function(){this.$regbase=this.$regbase|apf.__GUIELEMENT__;this.$focussable=apf.KEYBOARD_MOUSE;this.visible=true;this.$booleanProperties["disable-keyboard"]=true;this.$booleanProperties.visible=true;this.$booleanProperties.focussable=true;this.$supportedProperties.push("draggable","resizable");this.$supportedProperties.push("focussable","zindex","disabled","tabindex","disable-keyboard","contextmenu","visible","autosize","loadaml","actiontracker","alias","width","left","top","height","tooltip");this.$setLayout=function(d){if(!this.$drawn||!this.$pHtmlNode){return false;}if(this.parentNode){if(this.parentNode.localName=="table"){this.parentNode.register(this);this.$disableCurrentLayout=null;return d=="table";}else{if("vbox|hbox".indexOf(this.parentNode.localName)>-1){this.parentNode.register(this);this.$disableCurrentLayout=null;return d==this.parentNode.localName;}else{if(this.align){if(!this.$alignmentEnabled){if(this.$disableCurrentLayout){this.$disableCurrentLayout();}this.$enableAlignment();this.$disableCurrentLayout=this.$disableAlignment;}return d=="alignment";}}}}if(!this.$anchoringEnabled){if(this.$disableCurrentLayout){this.$disableCurrentLayout();}this.$enableAnchoring();this.$disableCurrentLayout=this.$disableAnchoring;}return d=="anchoring";};this.addEventListener("DOMNodeInserted",function(d){if(d.currentTarget==this&&"vbox|hbox|table".indexOf(this.parentNode.localName)==-1){this.$setLayout();}});this.implement(apf.Anchoring,apf.Alignment);this.setWidth=function(d){this.setProperty("width",d,false,true);return this;};this.setHeight=function(d){this.setProperty("height",d,false,true);return this;};this.setLeft=function(d){this.setProperty("left",d,false,true);return this;};this.setTop=function(d){this.setProperty("top",d,false,true);return this;};if(!this.show){this.show=function(){this.setProperty("visible",true,false,true);return this;};}if(!this.hide){this.hide=function(){this.setProperty("visible",false,false,true);return this;};}this.getWidth=function(){return(this.$ext||{}).offsetWidth;};this.getHeight=function(){return(this.$ext||{}).offsetHeight;};this.getLeft=function(){return(this.$ext||{}).offsetLeft;};this.getTop=function(){return(this.$ext||{}).offsetTop;};this.enable=function(){this.setProperty("disabled",false,false,true);return this;};this.disable=function(){this.setProperty("disabled",true,false,true);return this;};this.sendToBack=function(){this.setProperty("zindex",0,false,true);return this;};this.bringToFront=function(){this.setProperty("zindex",apf.all.length+1,false,true);return this;};this.sendBackwards=function(){this.setProperty("zindex",this.zindex-1,false,true);return this;};this.bringForward=function(){this.setProperty("zindex",this.zindex+1,false,true);return this;};this.hasFocus=function(){};this.addEventListener("DOMNodeInsertedIntoDocument",function(g){var d=this.$aml;if(this.parentNode){if(this.localName=="item"&&this.parentNode.hasFeature(apf.__MULTISELECT__)){this.$pHtmlNode=this.parentNode.$container;}else{this.$pHtmlNode=this.parentNode.$int;}}if(!this.$pHtmlNode){return;}this.$pHtmlDoc=this.$pHtmlNode.ownerDocument||document;if(this.$initSkin){this.$initSkin(d);}if(this.$draw){this.$draw();}if(g.id){this.$ext.setAttribute("id",g.id);}if(typeof this.visible=="undefined"){this.visible=true;}if(apf.debug&&this.$ext&&this.$ext.nodeType){this.$ext.setAttribute("uniqueId",this.$uniqueId);}if(this.$focussable&&typeof this.focussable=="undefined"){apf.GuiElement.propHandlers.focussable.call(this);}this.$drawn=true;},true);this.addEventListener("DOMNodeInsertedIntoDocument",function(d){if(!this.$pHtmlNode){return;}this.$setLayout();if(this.$loadAml){this.$loadAml(this.$aml);}});var c;this.addEventListener("$event.resize",c=function(d){apf.layout.setRules(this.$ext,"resize","var o = apf.all["+this.$uniqueId+"];            if (o) o.dispatchEvent('resize');",true);apf.layout.queue(this.$ext);this.removeEventListener("$event.resize",c);});this.addEventListener("contextmenu",function(s){if(!this.contextmenus){return;}if(this.hasFeature(apf.__DATABINDING__)){var d;var w=this.hasFeature(apf.__MULTISELECT__)?this.selected:this.xmlRoot;var q,n,k,g,j,t,u,A;for(q=0,n=this.contextmenus.length;q<n;q++){g=(typeof(u=this.contextmenus[q])=="string");A=null;if(!g&&u.match&&w){A=(u.cmatch||(u.cmatch=apf.lm.compile(u.match,{xpathmode:3,injectself:true})))(w);}if(g||w&&A||!u.match){t=g?u:u.menu;if(!self[t]){throw new Error(apf.formatErrorString(0,this,"Showing contextmenu","Could not find contextmenu by name: '"+t+"'"),this.$aml);return;}self[t].display(s.x,s.y,null,this,w);s.returnValue=false;s.cancelBubble=true;break;}}}else{t=typeof this.contextmenus[0]=="string"?this.contextmenus[0]:this.contextmenus[0].getAttribute("menu");if(!self[t]){throw new Error(apf.formatErrorString(0,this,"Showing contextmenu","Could not find contextmenu by name: '"+t+"'",this.$aml));return;}self[t].display(s.x,s.y,null,this);s.returnValue=false;s.cancelBubble=true;}});}).call(apf.GuiElement.prototype=new apf.AmlElement());apf.GuiElement.propHandlers={focussable:function(c){this.focussable=typeof c=="undefined"||c;if(!this.hasFeature(apf.__FOCUSSABLE__)){this.implement(apf.Focussable);}if(this.focussable){apf.window.$addFocus(this,this.tabindex);}else{apf.window.$removeFocus(this);}},zindex:function(c){this.$ext.style.zIndex=c;},visible:function(c){if(apf.isFalse(c)||typeof c=="undefined"){this.$ext.style.display="none";if(apf.document.activeElement==this||this.canHaveChildren&&apf.isChildOf(this,apf.document.activeElement,false)){if(apf.config.allowBlur&&this.hasFeature(apf.__FOCUSSABLE__)){this.blur();}else{apf.window.moveNext();}}this.visible=false;}else{this.$ext.style.display="block";if(apf.layout&&this.$int){apf.layout.forceResize(this.$int);}this.visible=true;}},disabled:function(n){if(!this.$drawn){var c=this;this.disabled=false;apf.queue.add("disable"+this.$uniqueId,function(i){c.disabled=n;apf.GuiElement.propHandlers.disabled.call(c,n);});return;}if(this.canHaveChildren){if(n!=-1){n=this.disabled=apf.isTrue(n);}var g=this.childNodes;for(var k,j=0,d=g.length;j<d;j++){k=g[j];if(k.nodeFunc==apf.NODE_VISIBLE){if(n&&k.disabled!=-1){k.$disabled=k.disabled||false;}k.setProperty("disabled",n?-1:false);}}if(this.$isWindowContainer){return;}}if(n==-1||n==false){}else{if(typeof this.$disabled=="boolean"){if(n===null){n=this.$disabled;this.$disabled=null;}else{this.$disabled=n||false;return;}}}if(apf.isTrue(n)||n==-1){this.disabled=false;if(apf.document.activeElement==this){apf.window.moveNext(true);if(apf.document.activeElement==this){this.$blur();}}if(this.hasFeature(apf.__PRESENTATION__)){this.$setStyleClass(this.$ext,this.$baseCSSname+"Disabled");}if(this.$disable){this.$disable();}this.disabled=n;}else{if(this.hasFeature(apf.__DATABINDING__)&&apf.config.autoDisable&&!(!this.$bindings||this.xmlRoot)){return false;}this.disabled=false;if(apf.document.activeElement==this){this.$focus();}if(this.hasFeature(apf.__PRESENTATION__)){this.$setStyleClass(this.$ext,null,[this.$baseCSSname+"Disabled"]);}if(this.$enable){this.$enable();}}},enabled:function(c){this.setProperty("disabled",!c);},"disable-keyboard":function(c){this.disableKeyboard=apf.isTrue(c);},tooltip:function(c){this.$ext.setAttribute("title",c);},align:function(c){if(c){this.$setLayout("alignment");}},contextmenu:function(c){this.contextmenus=[c];},actiontracker:function(c){if(!c){this.$at=null;}else{if(c.tagName=="actiontracker"){this.$at=c;}else{this.$at=typeof c=="string"&&self[c]?apf.nameserver.get("actiontracker",c)||self[c].getActionTracker():apf.setReference(c,apf.nameserver.register("actiontracker",c,new apf.actiontracker()));if(!this.$at.name){this.$at.name=c;}}}},aml:function(c){this.insertMarkup(c);}};apf.__PRESENTATION__=1<<9;apf.Presentation=function(){this.$init(true);};(function(){this.$regbase=this.$regbase|apf.__PRESENTATION__;this.$supportedProperties.push("skin");this.$propHandlers.skinset=this.$propHandlers.style=function(g){if(!this.styleAttrIsObj&&this.$amlLoaded){this.$ext.setAttribute("style",g);}};this.$propHandlers.border=function(g){if(!g){this.$ext.style.borderWidth="";}else{this.$ext.style.borderWidth=apf.getBox(g).join("px ")+"px";}};var c;this.$propHandlers["class"]=function(g){this.$setStyleClass(this.$ext,g,[c||""]);};this.$setStyleClass=apf.setStyleClass;function d(q){if(!this.$amlLoaded||q&&(q.$isMoveWithinParent||q.currentTarget!=this)){return;}this.$setInheritedAttribute(this,"skinset");if(this.attributes.getNamedItem("skin")){return;}var g,j=this.parentNode,i;if((g=this.$canLeechSkin.dataType==apf.STRING?this.$canLeechSkin:this.localName)&&j.$originalNodes&&(i=j.$originalNodes[g])&&i.getAttribute("inherit")){var k=i.getAttribute("link");this.$isLeechingSkin=true;if(k){this.$forceSkinChange(k);}else{var n=j.skinName.split(":");this.$forceSkinChange(n[1],n[0]);}}else{if(this.$isLeechingSkin){delete this.kin;this.$forceSkinChange();}}}this.$initSkin=function(g){if(this.$canLeechSkin){this.addEventListener("DOMNodeInserted",d);}if(!this.skin){this.skin=this.getAttribute("skin");}var i,k=this.parentNode,j;if(this.$canLeechSkin&&!this.skin&&(i=this.$canLeechSkin.dataType==apf.STRING?this.$canLeechSkin:this.localName)&&k.$originalNodes&&(j=k.$originalNodes[i])&&j.getAttribute("inherit")){var n=j.getAttribute("link");this.$isLeechingSkin=true;if(n){this.skin=n;this.$loadSkin();}else{this.$loadSkin(k.skinName);}}else{if(!this.skinset){this.skinset=this.getAttribute("skinset");}this.$loadSkin(null,this.$canLeechSkin);}};this.$loadSkin=function(j,i){this.baseSkin=j||(this.skinset||this.$setInheritedAttribute("skinset"))+":"+(this.skin||this.localName);clearTimeout(this.$skinTimer);if(this.skinName){this.$blur();this.$baseCSSname=null;}this.skinName=this.baseSkin;this.$pNodes={};this.$originalNodes=apf.skins.getTemplate(this.skinName,true);if(!this.$originalNodes){var k=this.skin;if(k){var g=this.skinName.split(":")[0];this.baseName=this.skinName="default:"+k;this.$originalNodes=apf.skins.getTemplate(this.skinName);if(!this.$originalNodes&&g!="default"){this.baseName=this.skinName=g+":"+this.localName;this.$originalNodes=apf.skins.getTemplate(this.skinName,true);}}if(!this.$originalNodes){this.baseName=this.skinName="default:"+this.localName;this.$originalNodes=apf.skins.getTemplate(this.skinName);}if(!this.$originalNodes){if(i){return(this.baseName=this.skinName=this.originalNode=null);}throw new Error(apf.formatErrorString(1077,this,"Presentation","Could not load skin: "+this.baseSkin));}}if(this.$originalNodes){apf.skins.setSkinPaths(this.skinName,this);}};this.$getNewContext=function(i,g){if(i!=i.toLowerCase()){throw new Error("Invalid layout node name ('"+i+"'). lowercase required");}if(!this.$originalNodes[i]){throw new Error(apf.formatErrorString(0,this,"Getting new skin item","Missing node in skin description '"+i+"'"));}this.$pNodes[i]=this.$originalNodes[i].cloneNode(true);};this.$hasLayoutNode=function(g){if(g!=g.toLowerCase()){throw new Error("Invalid layout node name ('"+g+"'). lowercase required");}return this.$originalNodes[g]?true:false;};this.$getLayoutNode=function(g,k,j){if(g!=g.toLowerCase()){throw new Error("Invalid layout node name ('"+g+"'). lowercase required");}if(!this.$pNodes){throw new Error("Skin not loaded for :"+this.serialize(true));}var i=this.$pNodes[g]||this.$originalNodes[g];if(!i){if(!this.$dcache){this.$dcache={};}if(!this.$dcache[g+"."+this.skinName]){this.$dcache[g+"."+this.skinName]=true;apf.console.info("Could not find node '"+g+"' in '"+this.skinName+"'","skin");}return false;}if(!k){return apf.getFirstElement(i);}var n=i.selectSingleNode("@"+k);if(!n){return null;}return(j?apf.queryNode(n.nodeValue,j):apf.getFirstElement(i).selectSingleNode(n.nodeValue));};this.$getOption=function(i,k){i=i.toLowerCase();var j=this.$pNodes[i]||this.$originalNodes[i];if(!k||!j){return j;}var g=j.selectSingleNode("@"+k);return g?g.nodeValue:"";};this.$getExternal=function(g,i,k,n){if(!i){i=this.$pHtmlNode;}if(!g){g="main";}g=g.toLowerCase();this.$getNewContext(g);var q=this.$getLayoutNode(g);var j;if(j=(n||this).getAttributeNode("style")){q.setAttribute("style",j.nodeValue);}if(j=(n||this).getAttributeNode("class")){this.$setStyleClass(q,(c=j.nodeValue));}if(k){k.call(this,q);}q=apf.insertHtmlNode(q,i);q.host=this;if(j=(n||this).getAttributeNode("bgimage")){q.style.backgroundImage="url("+apf.getAbsolutePath(this.mediaPath,j.nodeValue)+")";}if(!this.$baseCSSname){this.$baseCSSname=q.className.trim().split(" ")[0];}this.minwidth=apf.getCoord(parseInt(this.$getOption("main","minwidth")),5);this.minheight=apf.getCoord(parseInt(this.$getOption("main","minheight")),5);this.maxwidth=apf.getCoord(parseInt(this.$getOption("main","maxwidth")),10000);this.maxheight=apf.getCoord(parseInt(this.$getOption("main","maxheight")),10000);return q;};this.$focus=function(){if(!this.$ext){return;}this.$setStyleClass(this.oFocus||this.$ext,this.$baseCSSname+"Focus");};this.$blur=function(){if(this.renaming){this.stopRename(null,true);}if(!this.$ext){return;}this.$setStyleClass(this.oFocus||this.$ext,"",[this.$baseCSSname+"Focus"]);};this.$fixScrollBug=function(){if(this.$int!=this.$ext){this.oFocus=this.$int;}else{this.oFocus=this.$int=this.$ext.appendChild(document.createElement("div"));this.$int.style.height="100%";this.$int.className="focusbug";}};}).call(apf.Presentation.prototype=new apf.GuiElement());apf.config.$inheritProperties.skinset=1;apf.__VALIDATION__=1<<6;apf.validator={macro:{pattern:"value.match(",pattern_:")",custom:"(",custom_:")",min:"parseInt(value) >= ",max:"parseInt(value) <= ",maxlength:"value.toString().length <= ",minlength:"value.toString().length >= ",notnull:"value.toString().length > 0",checkequal:"!(temp = ",checkequal_:").isValid() || temp.getValue() == value"},compile:function(d){var c=this.macro,g=["var temp, valid = true;             if (!validityState)                 validityState = new apf.validator.validityState(); "];if(d.required){g.push("if (checkRequired && (!value || value.toString().trim().length == 0)) {                validityState.$reset();                validityState.valueMissing = true;                valid = false;            }");}g.push("validityState.$reset();            if (value) {");for(prop in d){if(!c[prop]){continue;}g.push("if (!(",c[prop],d[prop],c[prop+"_"]||"",")){                validityState.$set('",prop,"');                valid = false;            }");}g.push("};validityState.valid = valid; return validityState;");return new Function("value","checkRequired","validityState",g.join(""));}};apf.validator.validityState=function(){this.valueMissing=false,this.typeMismatch=false,this.patternMismatch=false,this.tooLong=false,this.rangeUnderflow=false,this.rangeOverflow=false,this.stepMismatch=false,this.customError=false,this.valid=true,this.$reset=function(){for(var c in this){if(c.substr(0,1)=="$"){continue;}this[c]=false;}this.valid=true;},this.$set=function(c){switch(c){case"min":this.rangeUnderflow=true;break;case"max":this.rangeOverflow=true;break;case"minlength":this.tooShort=true;break;case"maxlength":this.tooLong=true;break;case"pattern":this.patternMismatch=true;break;case"datatype":this.typeMismatch=true;break;case"notnull":this.typeMismatch=true;break;case"checkequal":this.typeMismatch=true;break;}};};apf.Validation=function(){this.$regbase=this.$regbase|apf.__VALIDATION__;this.isValid=function(d){if(!this.$vOptions){return true;}(this.$vOptions.isValid||(this.$vOptions.isValid=apf.validator.compile(this.$vOptions))).call(this,typeof this.getValue=="function"?this.getValue(null,true):null,d,this.validityState||(this.validityState=new apf.validator.validityState()));var c=this.validityState.valid;if(!c){this.dispatchEvent("invalid",this.validityState);}return c;};this.setCustomValidity=function(c){};this.showMe=function(){var c=this.parentNode;while(c){if(c.show){c.show();}c=c.parentNode;}};this.validate=function(c,g,d){if(d||!this.isValid(!c)&&!g){this.setError();return false;}else{this.clearError();return true;}};this.setError=function(d){if(!this.$validgroup){this.$propHandlers.validgroup.call(this,"vg"+this.parentNode.$uniqueId);}var c=this.$validgroup.getErrorBox(this);if(!this.$validgroup.allowMultipleErrors){this.$validgroup.hideAllErrors();}c.setMessage(this.invalidmsg);apf.setStyleClass(this.$ext,this.$baseCSSname+"Error");this.showMe();c.display(this);if(apf.document.activeElement&&apf.document.activeElement!=this){this.focus(null,{mouse:true});}};this.clearError=function(d){if(this.$setStyleClass){this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Error"]);}if(this.$validgroup){var c=this.$validgroup.getErrorBox(null,true);if(!c||c.host!=this){return;}c.hide();}};this.addEventListener("DOMNodeRemovedFromDocument",function(c){if(this.$validgroup){this.$validgroup.unregister(this);}});this.addEventListener("DOMNodeInsertedIntoDocument",function(c){if(!this.validgroup){this.$setInheritedAttribute("validgroup");}});this.$attrExcludePropBind=apf.extend({pattern:1,validtest:3},this.$attrExcludePropBind);this.$booleanProperties.required=true;this.$supportedProperties.push("validgroup","required","datatype","pattern","min","max","maxlength","minlength","validtest","notnull","checkequal","invalidmsg","requiredmsg");this.$fValidate=function(){if(this.contenteditable){return;}if(!this.$validgroup){this.validate(true);}else{var c=this.$validgroup.getErrorBox(this);if(!c.visible||c.host!=this){this.validate(true);}}};this.addEventListener("blur",this.$fValidate);this.$propHandlers.validgroup=function(d){if(d){var c;if(typeof d!="string"){this.$validgroup=d.name;c=d;}else{c=apf.nameserver.get("validgroup",d);}this.$validgroup=c||new apf.ValidationGroup(d);this.$validgroup.register(this);}else{this.$validgroup.unregister(this);this.$validgroup=null;}};this.$propHandlers.pattern=function(c,d){if(c.substr(0,1)!="/"){c="/"+c+"/";}(this.$vOptions||(this.$vOptions={}))[d]=c;delete this.$vOptions.isValid;};this.$propHandlers.required=this.$propHandlers.custom=this.$propHandlers.min=this.$propHandlers.max=this.$propHandlers.maxlength=this.$propHandlers.minlength=this.$propHandlers.notnull=this.$propHandlers.checkequal=function(c,d){(this.$vOptions||(this.$vOptions={}))[d]=c;delete this.$vOptions.isValid;};this.$propHandlers.validtest=function(g){var c=this,d={};this.removeValidationCache=function(){d={};};this.$checkRemoteValidation=function(){var i=this.getValue();if(typeof d[i]=="boolean"){return d[i];}if(d[i]==-1){return true;}d[i]=-1;apf.getData(this.validtest,{xmlNode:this.xmlRoot,value:this.getValue(),callback:function(q,n,j){if(n!=apf.SUCCESS){if(n==apf.TIMEOUT&&j.retries<apf.maxHttpRetries){return j.tpModule.retry(j.id);}else{var k=new Error(apf.formatErrorString(0,c,"Validating entry at remote source","Communication error: \n\n"+j.message));if(c.dispatchEvent("error",apf.extend({error:k,state:status},j))!==false){throw k;}return;}}d[i]=apf.isTrue(q);if(!d[i]){if(!c.hasFocus()){c.setError();}}else{c.clearError();}}});return true;};(this.$vOptions||(this.$vOptions={})).custom="apf.lookup("+this.$uniqueId+").$checkRemoteValidation()";delete this.$vOptions.isValid;};};apf.GuiElement.propHandlers.required=apf.GuiElement.propHandlers.pattern=apf.GuiElement.propHandlers.min=apf.GuiElement.propHandlers.max=apf.GuiElement.propHandlers.maxlength=apf.GuiElement.propHandlers.minlength=apf.GuiElement.propHandlers.notnull=apf.GuiElement.propHandlers.checkequal=apf.GuiElement.propHandlers.validtest=function(c,d){this.implement(apf.Validation);this.$propHandlers[d].call(this,c,d);};apf.ValidationGroup=function(c){this.$init();this.childNodes=[];if(c){apf.setReference(c,this);}this.name=c||"validgroup"+this.$uniqueId;apf.nameserver.register("validgroup",this.name,this);};(function(){this.validateVisibleOnly=false;this.allowMultipleErrors=false;this.register=function(o){if(o.hasFeature(apf.__VALIDATION__)){this.childNodes.push(o);}};this.unregister=function(o){this.childNodes.remove(o);};this.toString=function(){return"[APF Validation Group]";};var errbox;this.getErrorBox=function(o,no_create){if(this.allowMultipleErrors||!errbox&&!no_create){errbox=new apf.errorbox();errbox.$pHtmlNode=o.$ext.parentNode;errbox.skinset=apf.getInheritedAttribute(o.parentNode,"skinset");errbox.dispatchEvent("DOMNodeInsertedIntoDocument");}return errbox;};this.hideAllErrors=function(){if(errbox&&errbox.host){errbox.host.clearError();}};function checkValidChildren(oParent,ignoreReq,nosetError){var found;for(var v,i=0;i<oParent.childNodes.length;i++){var oEl=oParent.childNodes[i];if(!oEl){continue;}if(!oEl.disabled&&(!this.validateVisibleOnly&&oEl.visible||!oEl.$ext||oEl.$ext.offsetHeight)&&(oEl.hasFeature(apf.__VALIDATION__)&&oEl.isValid&&!oEl.isValid(!ignoreReq))){if(!nosetError){if(!found){oEl.validate(true,null,true);found=true;if(!this.allowMultipleErrors){return true;}}else{if(oEl.errBox&&oEl.errBox.host==oEl){oEl.errBox.hide();}}}else{if(!this.allowMultipleErrors){return true;}}}if(oEl.canHaveChildren&&oEl.childNodes.length){found=checkValidChildren.call(this,oEl,ignoreReq,nosetError)||found;if(found&&!this.allowMultipleErrors){return true;}}}return found;}this.validate=this.isValid=function(ignoreReq,nosetError,page){var found=checkValidChildren.call(this,page||this,ignoreReq,nosetError);if(page){try{if(page.validation&&!eval(page.validation)){alert(page.invalidmsg);found=true;}}catch(e){throw new Error(apf.formatErrorString(0,this,"Validating Page","Error in javascript validation string of page: '"+page.validation+"'",page.$aml));}}return !found;};}).call(apf.ValidationGroup.prototype=new apf.Class());apf.config.$inheritProperties.validgroup=1;apf.__DATABINDING__=1<<1;apf.DataBinding=function(){this.$init(true);this.$loadqueue=this.$dbTimer=null;this.$regbase=this.$regbase|apf.__DATABINDING__;this.$mainBind="value";this.$bindings=this.$cbindings=this.$attrBindings=false;this.$attrExcludePropBind=apf.extend({model:1,each:1},this.$attrExcludePropBind);this.setQueryValue=function(j,q,k){var n=apf.createNodeFromXpath(this[k||"xmlRoot"],j);if(!n){return null;}apf.setNodeValue(n,q,true);return n;};this.queryValue=function(j,k){return apf.queryValue(this[k||"xmlRoot"],j);};this.queryValues=function(j,k){return apf.queryValues(this[k||"xmlRoot"],j);};this.queryNode=function(j,k){var q=this[k||"xmlRoot"];return q?q.selectSingleNode(j):null;};this.queryNodes=function(j,k){var q=this[k||"xmlRoot"];return q?q.selectNodes(j):[];};this.$checkLoadQueue=function(){if(this.$loadqueue){this.xmlRoot=null;var j=this.load(this.$loadqueue[0],{cacheId:this.$loadqueue[1]});if(!j||j.dataType!=apf.ARRAY||j!=this.$loadqueue){this.$loadqueue=null;}}};this.$execProperty=function(s,n){var k=this.$attrBindings[s];if(k.cvalue.asyncs){var j=this;return k.cvalue.call(this,n,function(t){j.setProperty(s,t,true);});}else{var q=k.cvalue.call(this,n);}this.setProperty(s,q,true);};this.$applyBindRule=function(k,n,j,t,s){var q=this.$attrBindings[k]&&this.$attrBindings[k].cvalue||this.$cbindings[k];return q?q.call(this,n,t):j||"";};var g;this.addEventListener("afterload",g=function(){var j;if(!this.$cbindings.queue||!this.$cbindings.queue.caption||!(j=this.$cbindings.queue.caption)){return;}var t,s=this.ownerDocument;for(var q,n=0,k=j.length;n<k;n++){t=document.getElementById("placeholder_"+this.$uniqueId+"_"+n);q=s.createProcessingInstruction("lm",this.$cbindings.caption);q.$model=this.$model;q.xmlRoot=j[n];q.$noInitModel=true;q.$useXmlDiff=true;q.$focusParent=this;q.parentNode=this;q.dispatchEvent("DOMNodeInsertedIntoDocument",{pHtmlNode:t});delete j[n];j[q.xmlRoot.getAttribute(apf.xmldb.xmlIdTag)]=q;}});this.addEventListener("xmlupdate",function(n){if("insert|add|synchronize|move".indexOf(n.action)>-1){g.call(this,n);}else{if("remove|move-away".indexOf(n.action)>-1){var j;if(!this.$cbindings.queue||!this.$cbindings.queue.caption||!(j=this.$cbindings.queue.caption)){return;}var k=j[n.xmlNode.getAttribute(apf.xmldb.xmlIdTag)];k.parentNode=k.$focusParent=k.$model=k.xmlRoot=null;k.destroy();}}});this.$hasBindRule=function(j){return this.$attrBindings[j]||this.$bindings&&this.$bindings[j];};this.$getBindRule=function(j,k){return this.$attrBindings[j]||this.$bindings&&this.$bindings.getRule(j,k);};var d={drag:1,drop:1,dragcopy:1};this.$getDataNode=function(n,q,w,k,j){var t,u=this.$attrBindings[n];if(u){if(u.cvalue.type!=3){return false;}var s=u.cvalue2||u.compile("value",{xpathmode:j?4:3,parsecode:1,injectself:d[n]});if(s&&(t=s(q,w))){if(k){k.push(u);}return t;}return false;}return this.$bindings&&this.$bindings.getDataNode(n,q,w,k,j);};this.setModel=function(j){this.setAttribute("model",j,false,true);};this.getModel=function(j){if(j&&!this.$model){return this.dataParent?this.dataParent.parent.getModel(true):null;}return this.$model;};this.reload=this.reload||function(){this.load(this.xmlRoot,{cacheId:this.cacheId,force:true});};this.load=function(k,j){if(j){var s=j.cacheId,q=j.force,t=j.noClearMsg;}if(s&&s==this.cacheId&&!q){return;}if(apf.popup.isShowing(this.$uniqueId)){apf.popup.forceHide();}if(k){if(typeof k=="string"){if(k.charAt(0)=="<"){k=apf.getXmlDom(k).documentElement;}else{return apf.model.prototype.$loadFrom.call(this,k,j);}}else{if(k.nodeType==9){k=k.documentElement;}else{if(k.nodeType==3||k.nodeType==4){k=k.parentNode;}else{if(k.nodeType==2){k=k.ownerElement||k.parentNode||k.selectSingleNode("..");}}}}}if(this.$preventDataLoad||!this.$canLoadData&&((!this.$bindings&&!this.$canLoadDataAttr)||!this.$amlLoaded)&&(!this.hasFeature(apf.__MULTISELECT__)||!(this.each||this.$template))||this.$canLoadData&&!this.$canLoadData()){this.xmlRoot=k;if(this.$amlLoaded&&!this.$attrBindings){apf.console.warn("Could not load data yet in "+(this.localName?this.localName+"["+(this.name||"")+"]":this.nodeName)+". The loaded data is queued until smartbinding rules are loaded or set manually.");}return this.$loadqueue=[k,s];}if(this.dataParent&&this.dataParent.xpath){this.dataParent.parent.signalXmlUpdate[this.$uniqueId]=!k;}if(!k&&(!s||!this.$isCached||!this.$isCached(s))){apf.console.warn("No xml root node was given to load in "+this.localName+"["+(this.name||"")+"]. Clearing any loaded xml in this component");this.clear(t);if(apf.config.autoDisable&&this.$createModel===false){this.setProperty("disabled",true);}return;}var n=this.disabled;this.disabled=false;if(this.dispatchEvent("beforeload",{xmlNode:k})===false){return false;}apf.console.info("Loading XML data in "+(this.localName?this.localName+"["+(this.name||"")+"]":this.nodeName));if(this.caching&&!q&&k&&k==this.xmlRoot){return;}this.clear(true,true);this.cacheId=s;if(this.dispatchEvent("$load",{forceNoCache:q,xmlNode:k})===false){delete this.cacheId;return;}this.documentId=apf.xmldb.getXmlDocId(k);this.xmlRoot=k;this.setProperty("root",this.xmlRoot);this.$load(k);this.$loadSubData(k);if(this.$createModel===false){this.disabled=true;this.setProperty("disabled",false);}else{this.disabled=n;}this.dispatchEvent("afterload",{xmlNode:k});};this.$loadSubData=function(j){if(this.$hasLoadStatus(j)){return;}var s,q=this.$getBindRule("load",j);if(q&&(!q[1]||q[1](j))){this.$setLoadStatus(j,"loading");if(this.$setClearMessage){this.$setClearMessage(this["loading-message"],"loading");}var n=this.getModel(true);if(!n){throw new Error("Could not find model");}var k=this;if(n.$insertFrom(q.getAttribute("get"),{xmlNode:s,insertPoint:j,amlNode:this,callback:function(){k.setProperty(k.hasFeature(apf.__MULTISELECT__)?"selected":"root",j);}})===false){this.clear(true);if(apf.config.autoDisable){this.setProperty("disabled",true);}}}};this.clear=function(n,s,k){if(!this.$container){return;}if(this.clearSelection){this.clearSelection(true);}var q=this.$container.offsetHeight;if(this.dispatchEvent("$clear")!==false){this.$container.innerHTML="";}if(typeof n=="string"){var j=n;n=false;if(!this[j+"-message"]){this.$setInheritedAttribute(j+"-message");}}this.$lastClearType=j||null;if(!n&&this.$setClearMessage){this.$setClearMessage(j?this[j+"-message"]:this["empty-message"],j||"empty",q);}else{if(this.$removeClearMessage){this.$removeClearMessage();}}if(!k){this.documentId=this.xmlRoot=this.cacheId=null;}if(!n){if(this.hasFeature(apf.__MULTISELECT__)){this.setProperty("length",0);}}};this.clearMessage=function(j){this.customMsg=j;this.clear("custom");};this.$setLoadStatus=function(k,q,j){var n=k.getAttribute("a_loaded");n=n?n.replace(new RegExp("\\|\\w+\\:"+this.$uniqueId+"\\|","g"),""):"";if(!j){n+="|"+q+":"+this.$uniqueId+"|";}k.setAttribute("a_loaded",n);};this.$removeLoadStatus=function(j){this.$setLoadStatus(j,null,true);};this.$hasLoadStatus=function(j,n){var k=j.getAttribute("a_loaded");if(!k){return false;}return(k.indexOf((n||"")+":"+this.$uniqueId+"|")!=-1);};this.insert=function(n,j){if(typeof n=="string"){if(n.charAt(0)=="<"){n=apf.getXmlDom(n).documentElement;}else{if(!j.insertPoint){j.insertPoint=this.xmlRoot;}return apf.model.prototype.$insertFrom.call(this,n,j);}}var q=j.insertPoint||this.xmlRoot;if(this.dispatchEvent("beforeinsert",{xmlParentNode:q})===false){return false;}if(typeof j.copyAttributes=="undefined"){j.copyAttributes=true;}var k=apf.mergeXml(n,q,j);apf.xmldb.applyChanges("insert",q);if(this.selectable&&this.autoselect){if(this.xmlNode==k){this.$selectDefault(this.xmlNode);}}else{if(this.xmlNode==k){this.setProperty("root",this.xmlNode);}}if(this.$hasLoadStatus(q,"loading")){this.$setLoadStatus(q,"loaded");}this.dispatchEvent("afterinsert");};this.$booleanProperties["render-root"]=true;this.$supportedProperties.push("empty-message","loading-message","offline-message","render-root","smartbinding","bindings","actions");this.$propHandlers["render-root"]=function(j){this.renderRoot=j;};this.$propHandlers["empty-message"]=function(j){this["empty-message"]=j;if(this.$updateClearMessage){this.$updateClearMessage(this["empty-message"],"empty");}};this.$propHandlers["loading-message"]=function(j){this["loading-message"]=j;if(this.$updateClearMessage){this.$updateClearMessage(this["loading-message"],"loading");}};this.$propHandlers["offline-message"]=function(j){this["offline-message"]=j;if(this.$updateClearMessage){this.$updateClearMessage(this["offline-message"],"offline");}};this.$propHandlers.smartbinding=this.$propHandlers.actions=this.$propHandlers.bindings=function(k,n){var j="$"+n;if(this[j]){this[j].unregister(this);}if(!k){return;}if(!apf.nameserver.get(n,k)){throw new Error(apf.formatErrorString(1064,this,"Setting "+n,"Could not find "+n+" by name '"+k+"'"));}apf.nameserver.get(n,k).register(this);if(n!="actions"){this.$checkLoadQueue();}};var i={caption:1,icon:1,select:1,css:1,sort:1,drop:2,drag:2,dragcopy:2,eachvalue:1};this.$addAttrBind=function(j,n,w){if(n.models){if(this.hasFeature(apf.__MULTISELECT__)){if(i[j]){throw new Error("Cannot use external model inside "+j+" rule");}}}var q,t,B,s,C=n.xpaths,u={};for(q=0;q<C.length;q+=2){if(!u[(B=C[q])]){u[B]=1;}else{u[B]++;}}if(!this.$propsUsingMainModel){this.$propsUsingMainModel={};}var A=(this.$attrBindings||(this.$attrBindings={}))[j]={cvalue:n,value:w,compile:apf.BindingRule.prototype.$compile,models:[]};delete this.$propsUsingMainModel[j];for(t,q=0;q<C.length;q+=2){B=C[q];if(u[B]==-1){continue;}t=C[q+1];if(B=="#"||t=="#"){var k=(A.cvalue3||(A.cvalue3=apf.lm.compile(A.value,{xpathmode:5})))(this.xmlRoot);if(typeof k!="string"){s=k.model&&k.model.$isModel&&k.model;if(s){t=k.xpath;}else{if(k.model){s=apf.xmldb.findModel(k.model);t=apf.xmlToXpath(k.model,s.data)+(k.xpath?"/"+k.xpath:"");}else{this.addEventListener("prop."+j,function(F){var E=(A.cvalue3||(A.cvalue3=apf.lm.compile(A.value,{xpathmode:5})))(this.xmlRoot);if(E.model){this.removeEventListener("prop."+j,arguments.callee);var D=this;setTimeout(function(){D.$clearDynamicProperty(j);D.$setDynamicProperty(j,w);},10);}});continue;}}}else{s=null;}}else{s=null;}if(!s){if(B){s=apf.nameserver.get("model",B)||apf.setReference(B,apf.nameserver.register("model",B,new apf.model()));}else{if(!this.$model&&!this.$initingModel){c.call(this);}s=this.$model;if(!this.hasFeature(apf.__MULTISELECT__)&&i[j]!=2||!i[j]){this.$propsUsingMainModel[j]={xpath:t,optimize:u[B]==1};}}}if(s&&(!this.hasFeature(apf.__MULTISELECT__)&&i[j]!=2||!i[j])){s.$bindXmlProperty(this,j,t,u[B]==1,w.indexOf("*[")>-1);A.models.push(s);}u[B]=-1;}A.xpath=t;this.$canLoadDataAttr=i[j]==1;this.$checkLoadQueue();};this.$removeAttrBind=function(q){var k=this.$attrBindings[q];if(!k){return;}delete this.$attrBindings[q];delete this.$propsUsingMainModel[q];var n=k.models;for(var j=0;j<n.length;j++){n[j].$unbindXmlProperty(this,q);}};this.$initingModel;function c(){this.$initingModel=true;this.$setInheritedAttribute("model");}this.addEventListener("DOMNodeInsertedIntoDocument",function(j){if(!this.model&&this.$setClearMessage&&!this.value){this.$setClearMessage(this["empty-message"],"empty");}this.$amlLoaded=true;this.$checkLoadQueue();});this.$propHandlers.model=function(u){if(!u&&!this.$modelParsed){if(this.$model){this.clear();this.$model.unregister(this);this.$model=null;this.lastModelId="";}else{if(this.dataParent){this.dataParent.parent=null;}}return;}this.$initingModel=true;var q;if((q=this.$modelParsed)&&q.type!=2){var t,s=q.props;if(this.dataParent){this.dataParent=null;}for(var w in s){this.dataParent={parent:self[w.split(".")[0]],xpath:null,model:this.$modelParsed.instruction};t=true;break;}if(t){if(this.dataParent&&!this.dataParent.signalXmlUpdate){this.dataParent.signalXmlUpdate={};}}this.$modelParsed=null;}var n;if(typeof u=="object"){if(u.dataType==apf.ARRAY){n=apf.nameserver.get("model",u[0]);n.register(this,u[1]);return;}else{if(u.$isModel){n=u;u=this.model=n.name;if(!u){n.setProperty("id",u=this.model="model"+n.$uniqueId);}}else{if(this.dataParent){this.model=this.dataParent.model;n=apf.xmldb.findModel(u);var k=apf.xmlToXpath(u,n.data,true)||".";if(n.queryNode(k)!=u){throw new Error("xml data node is not attached to model");}n.register(this,k);return;}else{}}}}clearTimeout(this.$dbTimer);if(!this.$amlLoaded&&this.nodeType==1){var j=this;this.$dbTimer=$setTimeout(function(){if(!j.$amlDestroyed){apf.setModel(u,j);}});}else{apf.setModel(u,this);}};};apf.DataBinding.prototype=new apf.Presentation();apf.config.$inheritProperties.model=1;apf.config.$inheritProperties["empty-message"]=1;apf.config.$inheritProperties["loading-message"]=1;apf.config.$inheritProperties["offline-message"]=1;apf.config.$inheritProperties.noloading=1;apf.Init.run("databinding");apf.MultiselectBinding=function(){if(!this.setQueryValue){this.implement(apf.DataBinding);}this.$init(function(){this.$selectTimer={};});};(function(){this.length=0;this.$attrExcludePropBind=apf.extend({caption:2,icon:2,eachvalue:2,select:2,css:2,sort:2,drag:2,drop:2,dragcopy:2,selected:2,each:1,selection:3,"selection-unique":3,"selection-constructor":3},this.$attrExcludePropBind);this.resort=function(j,g,i){if(!this.$sort){this.$sort=new apf.Sort();}this.$sort.set(j,g);if(this.clearAllCache){this.clearAllCache();}if(i){return;}var d=this;(function k(s,w){var t=d.$sort.apply(apf.getArrayFromNodelist(s.selectNodes(d.each)));for(var q=0;q<t.length;q++){if(d.$isTreeArch||d.$withContainer){var u=apf.xmldb.findHtmlNode(t[q],d);if(!d.$findContainer){throw new Error(apf.formatErrorString(d,"Sorting Nodes","This component does not                              implement _self.$findContainer"));}var n=d.$findContainer(u);w.appendChild(u);if(!apf.isChildOf(u,n,true)){w.appendChild(n);}k(t[q],n);}else{w.appendChild(apf.xmldb.findHtmlNode(t[q],d));}}})(this.xmlRoot,this.$container);return j;};this.toggleSortOrder=function(){return this.resort({ascending:!this.$sort.get().ascending}).ascending;};this.getSortSettings=function(){return this.$sort.get();};this.getTraverseNodes=function(g){if(!this.each){throw new Error("Could not render bound data. Missing 'each' rule for "+this.localName+(this.id&&"["+this.id+"]"||""));}if(this.$sort){var d=apf.getArrayFromNodelist((g||this.xmlRoot).selectNodes(this.each));return this.$sort.apply(d);}return(g||this.xmlRoot).selectNodes(this.each);};this.getFirstTraverseNode=function(g){if(this.$sort){var d=(g||this.xmlRoot).selectNodes(this.each);return this.$sort.apply(d)[0];}return(g||this.xmlRoot).selectSingleNode(this.each);};this.getLastTraverseNode=function(g){var d=this.getTraverseNodes(g||this.xmlRoot);return d[d.length-1];};this.isTraverseNode=function(j){var d=this.getTraverseNodes(this.getTraverseParent(j)||this.xmlRoot);for(var g=0;g<d.length;g++){if(d[g]==j){return true;}}return false;};this.getNextTraverseSelected=function(k,d,q){if(!k){k=this.selected;}if(!q){q=1;}var j=0;var g=this.getTraverseNodes(this.getTraverseParent(k)||this.xmlRoot);while(g[j]&&g[j]!=k){j++;}var n=(d==null)?g[j+q]||g[j-q]:(d?g[j+q]:g[j-q]);return n||q&&(j<q||(j+1)>Math.floor(g.length/q)*q)?n:(d?g[g.length-1]:g[0]);};this.getNextTraverse=function(k,d,n){if(!n){n=1;}if(!k){k=this.selected;}var j=0;var g=this.getTraverseNodes(this.getTraverseParent(k)||this.xmlRoot);while(g[j]&&g[j]!=k){j++;}return g[j+(d?-1*n:n)];};this.getTraverseParent=function(g){if(!g.parentNode||g==this.xmlRoot){return false;}if(g.$regbase){return g.parentNode;}var d,i=g.getAttribute(apf.xmldb.xmlIdTag);if(!i){g.setAttribute(apf.xmldb.xmlIdTag,"temp");i="temp";}d=g.selectSingleNode("ancestor::node()[(("+this.each+")/@"+apf.xmldb.xmlIdTag+")='"+i+"']");if(i=="temp"){g.removeAttribute(apf.xmldb.xmlIdTag);}return d;};if(!this.$findHtmlNode){this.$findHtmlNode=function(d){return this.$pHtmlDoc.getElementById(d);};}this.$setClearMessage=function(n,i,k){if(!this.$empty){if(!this.$hasLayoutNode("empty")){return;}this.$getNewContext("empty");var g=this.$getLayoutNode("empty");if(!g){return;}this.$empty=apf.insertHtmlNode(g,this.$container);}else{this.$container.appendChild(this.$empty);}var j=this.$getLayoutNode("empty","caption",this.$empty);if(j){apf.setNodeValue(j,n||"");}this.$empty.setAttribute("id","empty"+this.$uniqueId);apf.setStyleClass(this.$empty,i,["loading","empty","offline"]);var d=apf.getStyle(this.$ext,"height");this.$empty.style.height=(k&&(!d||d=="auto")&&i!="empty")?(Math.max(10,(k-apf.getHeightDiff(this.$empty)-apf.getHeightDiff(this.$ext)))+"px"):"";};this.$updateClearMessage=function(i,d){if(!this.$empty||this.$empty.parentNode!=this.$container||this.$empty.className.indexOf(d)==-1){return;}var g=this.$getLayoutNode("empty","caption",this.$empty);if(g){apf.setNodeValue(g,i||"");}};this.$removeClearMessage=function(){if(!this.$empty){this.$empty=document.getElementById("empty"+this.$uniqueId);}if(this.$empty&&this.$empty.parentNode){this.$empty.parentNode.removeChild(this.$empty);}};this.$load=function(d){apf.xmldb.addNodeListener(d,this);var j=this.getTraverseNodes(d).length;if(!this.renderRoot&&!j){return this.clear(null,null,true);}var g=this.$addNodes(d,null,null,this.renderRoot);this.$fill(g);if(this.selectable){if(this.autoselect){if(!this.selected){if(this.renderRoot){this.select(d,null,null,null,true);}else{if(g.length){this.$selectDefault(d);}}}}else{this.clearSelection(true);var i=this.renderRoot?this.xmlRoot:this.getFirstTraverseNode();if(i){this.setCaret(i);}if(this.selected){this.setProperty("selected",null);}if(this.choosen){this.setProperty("choosen",null);}}}if(this.focussable){apf.document.activeElement==this?this.$focus():this.$blur();}if(j!=this.length){this.setProperty("length",j);}};var c={insert:127,add:123,remove:46,"redo-remove":79,synchronize:127,"move-away":105,move:77};this.$xmlUpdate=function(G,j,t,C,F){if(!this.xmlRoot){return;}var A,n,d,u,J=j;if(!t){t=this.xmlRoot;}if(G=="redo-remove"){F.appendChild(j);var I=this.isTraverseNode(j);F.removeChild(j);if(!I){j=F;}}do{if(G=="add"&&this.isTraverseNode(j)&&J==j){break;}if(j.getAttribute(apf.xmldb.xmlIdTag)){u=this.$findHtmlNode(j.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId);if(u&&(J!=j||j==this.xmlRoot)&&c[G]&1){G="update";}if(j==t&&!this.renderRoot){if(j==this.xmlRoot&&G!="insert"){this.dispatchEvent("xmlupdate",{action:G,xmlNode:j,UndoObj:C});return;}break;}if(u&&c[G]&2&&!this.isTraverseNode(j)){G="remove";}if(!u&&c[G]&4&&this.isTraverseNode(j)){G="add";break;}if(u||G=="move"){break;}}else{if(c[G]&8&&this.isTraverseNode(j)){G="add";break;}}if(j==t){break;}j=j.parentNode;}while(j&&j.nodeType!=9);var i=j;if(j&&j.nodeType==9){j=J;}if(G=="replacechild"&&(C?C.args[0]==this.xmlRoot:!this.xmlRoot.parentNode)){return this.load(C?C.args[1]:t);}if(C&&j&&!C.xmlNode){C.xmlNode=j;}if(G=="move"&&i==J){var B=apf.isChildOf(this.xmlRoot,j.parentNode,true);var s=apf.isChildOf(this.xmlRoot,C.extra.parent,true);if(B&&s){this.$moveNode(j,u);}else{if(B){G="add";}else{if(s){G="remove";}}}}else{if(G=="move-away"){var D=apf.isChildOf(this.xmlRoot,C.extra.parent,true);if(!D){G="remove";}}}if(this.$removeClearMessage&&this.$setClearMessage){if(this.getFirstTraverseNode()){this.$removeClearMessage();}else{this.$setClearMessage(this["empty-message"],"empty");}}if(G=="insert"&&(this.$isTreeArch||j==this.xmlRoot)){if(!j){return;}if(this.$hasLoadStatus(j)&&this.$removeLoading){this.$removeLoading(u);}if(this.$container.firstChild&&!apf.xmldb.getNode(this.$container.firstChild)){this.$container.innerHTML="";if(!this.renderRoot){n=this.getTraverseNodes().length;if(!n){this.clear();}}}A=this.$addNodes(j,(this.$getParentNode?this.$getParentNode(u):u),true,false);this.$fill(A);if(this.selectable&&!this.xmlRoot.selectSingleNode(this.each)){apf.console.warn("No traversable nodes were found for "+this.name+" ["+this.localName+"]\n                                  Traverse Rule : "+this.$getBindRule("each")[4].getAttribute("match"));}if(this.selectable&&(n===0||!this.xmlRoot.selectSingleNode(this.each))){return;}}else{if(G=="add"){var H;d=this.getTraverseParent(j);if(d==this.xmlRoot){H=this.$container;}if(!H&&this.$isTreeArch){H=this.$findHtmlNode(d.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId);}if(H||this.$isTreeArch&&apf.isChildOf(this.xmlRoot,j)){H=(this.$findContainer&&H?this.$findContainer(H):H)||this.$container;A=this.$addNodes(j,H,true,true,apf.xmldb.getHtmlNode(this.getNextTraverse(j),this));if(H){this.$fill(A);}}}else{if(G=="remove"){if(!j||J!=j){return;}if(u){this.$deInitNode(j,u);}else{if(j==this.xmlRoot){return this.load({noClearMsg:!this.dataParent||!this.dataParent.autoselect});}}}else{if(u){this.$updateNode(j,u);if(G=="replacechild"&&this.hasFeature(apf.__MULTISELECT__)&&this.selected&&j.getAttribute(apf.xmldb.xmlIdTag)==this.selected.getAttribute(apf.xmldb.xmlIdTag)){this.selected=j;}}else{if(G=="redo-remove"){var g=this.xmlRoot;while(g&&g.nodeType!=9){g=g.parentNode;}if(!g){var k=this.getModel(true);if(!k){throw new Error(apf.formatErrorString(0,this,"Setting change notifier on component","Component without a model is listening for changes",this.$aml));}return k.$waitForXml(this);}}}}}}d=j?j.parentNode:F;if(this.$isTreeArch&&!this.$preventRecursiveUpdate&&d&&d.nodeType==1){do{u=this.$findHtmlNode(d.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId);if(u){this.$updateNode(d,u);}}while((d=this.getTraverseParent(d))&&d.nodeType==1);}if(c[G]&32&&this.selectable&&J==j&&(G!="insert"||j==this.xmlRoot)){clearTimeout(this.$selectTimer.timer);if(G=="remove"&&apf.isChildOf(j,this.selected,true)||j==this.$selectTimer.nextNode){this.$selectTimer.nextNode=this.getDefaultNext(j,this.$isTreeArch);}var q=this;this.$selectTimer.timer=$setTimeout(function(){q.$checkSelection(q.$selectTimer.nextNode);q.$selectTimer.nextNode=null;});}if(c[G]&64){if(!n){n=this.xmlRoot.selectNodes(this.each).length;}if(n!=this.length){this.setProperty("length",n);}}if(this.signalXmlUpdate&&c[G]&16){var w;for(w in this.signalXmlUpdate){if(parseInt(w)!=w){continue;}var E=apf.lookup(w);if(!this.selected){continue;}j=this.selected.selectSingleNode(E.dataParent.xpath);if(!j){continue;}E.load(j);}}this.dispatchEvent("xmlupdate",{action:G,xmlNode:j,result:A,UndoObj:C});};this.$addNodes=function(C,B,k,j,t,q){if(!this.each){throw new Error(apf.formatErrorString(1060,this,"adding Nodes for load","No each SmartBinding rule was specified. This rule is                  required for a "+this.localName+" component.",this.$aml));}var A,g;j=(j&&(this.renderRoot&&C==this.xmlRoot||this.isTraverseNode(C)));var d=j?[C]:this.getTraverseNodes(C);for(var n=0;n<d.length;n++){if(d[n].nodeType!=1){continue;}if(k){A=this.$findHtmlNode(d[n].getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId);}if(!A){var u=apf.xmldb.nodeConnect(this.documentId,d[n],null,this);var w=j?t:(g?g.nextSibling:null),s=this.$add(d[n],u,j?C.parentNode:C,w?B||this.$container:B,w,(!w&&n==d.length-1),q);if(s===false){break;}}if(k){g=A;}}return d;};this.$handleBindingRule=function(g,i){if(!g){this[i]=null;}if(i=="each"){if(g.indexOf("::")>-1){g=g.replace(/^\[|\]$/g,"").split("::");this.setProperty("model",g[0]);this.each=g[1];}else{this.each=g.replace(/^\[|\]$/g,"");}}if(this.xmlRoot&&!this.$bindRuleTimer&&this.$amlLoaded){var d=this;apf.queue.add("reload"+this.$uniqueId,function(){apf.console.log("Reloading multiselect based on                                  attribute bind change: "+d.serialize(true));d.reload();});}};this.$select=function(d){if(this.renaming){this.stopRename(null,true);}if(!d||!d.style){return;}return this.$setStyleClass(d,"selected");};this.$deselect=function(d){if(this.renaming){this.stopRename(null,true);if(this.ctrlselect){return false;}}if(!d){return;}return this.$setStyleClass(d,"",["selected","indicate"]);};this.$indicate=function(d){if(this.renaming){this.stopRename(null,true);}if(!d){return;}return this.$setStyleClass(d,"indicate");};this.$deindicate=function(d){if(this.renaming){this.stopRename(null,true);}if(!d){return;}return this.$setStyleClass(d,"",["indicate"]);};this.$propHandlers.each=this.$propHandlers.caption=this.$propHandlers.eachvalue=this.$propHandlers.icon=this.$propHandlers.tooltip=this.$handleBindingRule;this.$propHandlers.sort=function(d){if(d){this.$sort=new apf.Sort();this.$sort.set({getValue:apf.lm.compile(d)});}else{this.$sort=null;}};}).call(apf.MultiselectBinding.prototype=new apf.DataBinding());apf.StandardBinding=function(){this.$init(true);if(apf.Validation){this.implement(apf.Validation);}if(!this.setQueryValue){this.implement(apf.DataBinding);}if(!this.defaultValue){this.defaultValue="";}this.$load=function(d){apf.xmldb.addNodeListener(d,this);var c,j,k,i,n,g;if(c=this.$bindings){for(k in c){j=k.toLowerCase();if(this.$supportedProperties.indexOf(j)>-1){n=(i=c[j]).length==1?i[0]:this.$getBindRule(j,d);g=n.value||n.match;this.$clearDynamicProperty(j);if(g.indexOf("{")>-1||g.indexOf("[")>-1){this.$setDynamicProperty(j,g);}else{if(this.setProperty){this.setProperty(j,g,true);}}}}}if(this.errBox&&this.isValid&&this.isValid()){this.clearError();}};this.$xmlUpdate=function(i,A,c,q){if(i=="redo-remove"){var d=false,j=this.getModel(true);if(j){var n=j.getXpathByAmlNode(this);if(n){A=j.data.selectSingleNode(n);if(A!=this.xmlRoot){d=true;}}}if(d||this.xmlRoot==A){if(!j){throw new Error(apf.formatErrorString(0,this,"Setting change notifier on component","Component without a model is listening for changes",this.$aml));}return j.$waitForXml(this);}}if(q&&!q.xmlNode){q.xmlNode=this.xmlRoot;}var t,g,s,u,k,w;if(t=this.$bindings){for(s in t){g=s.toLowerCase();if(this.$supportedProperties.indexOf(g)>-1){k=(u=t[g]).length==1?u[0]:this.$getBindRule(g,A);w=k.value||k.match;this.$clearDynamicProperty(g);if(w.indexOf("{")>-1||w.indexOf("[")>-1){this.$setDynamicProperty(g,w);}else{if(this.setProperty){this.setProperty(g,w);}}}}}if(this.errBox&&this.isValid&&this.isValid()){this.clearError();}this.dispatchEvent("xmlupdate",{action:i,xmlNode:A,UndoObj:q});};this.addEventListener("$clear",function(d,c){if(this.$propHandlers&&this.$propHandlers.value){this.value=-99999;this.$propHandlers.value.call(this,"");}});};apf.StandardBinding.prototype=new apf.DataBinding();apf.Init.run("standardbinding");apf.__MULTISELECT__=1<<8;apf.MultiSelect=function(){this.$init(function(){this.$valueList=[];this.$selectedList=[];});};(function(){this.$regbase=this.$regbase|apf.__MULTISELECT__;this.sellength=0;this.selected=null;this.$selected=null;this.caret=null;this.$caret=null;this.useindicator=true;this.remove=function(d){if(!d){d=this.$valueList;}if(d.nodeType){d=[d];}if(!d||!d.length){return;}if(d.contains(this.xmlRoot)){throw new Error(apf.formatErrorString(0,"Removing nodes","You are trying to delete the xml root of this                  element. This is not allowed."));}var j=[];for(var g=0;g<d.length;g++){j.push({action:"removeNode",args:[d[g]]});}if(this.$actions.removegroup){return this.$executeAction("multicall",j,"removegroup",d[0]);}else{return this.$executeAction("multicall",j,"remove",d[0],null,null,d.length>1?d:null);}};this.add=function(t,u,s,d){var q;if(this.$actions){if(t&&t.nodeType){q=this.$actions.getRule("add",t);}else{if(typeof t=="string"){if(t.trim().charAt(0)=="<"){t=apf.getXml(t);q=this.$actions.getRule("add",t);}else{var A=this.$actions.add;for(var k=0,j=A.length;k<j;k++){if(A[k].getAttribute("type")==t){t=null;q=A[k];break;}}}}}if(!q){q=(this.$actions.add||{})[0];}}else{q=null;}var n=this.$isTreeArch?this.selected||this.xmlRoot:this.xmlRoot,g=this,w=function(C,D,i){if(D!=apf.SUCCESS){var E;E=new Error(apf.formatErrorString(1032,g,"Loading xml data","Could not add data for control "+g.name+"["+g.tagName+"] \nUrl: "+i.url+"\nInfo: "+i.message+"\n\n"+t));if(i.tpModule.retryTimeout(i,D,g,E)===true){return true;}throw E;}if(typeof C!="object"){C=apf.getXmlDom(C).documentElement;}if(C.getAttribute(apf.xmldb.xmlIdTag)){C.setAttribute(apf.xmldb.xmlIdTag,"");}var B=g.$actions&&g.$actions.getRule("add",g.$isTreeArch?g.selected:g.xmlRoot);if(!u){if(B&&B.parent){u=(B.cparent||B.compile("parent",{xpathmode:2,injectself:true}))(g.$isTreeArch?g.selected||g.xmlRoot:g.xmlRoot);}else{u=g.$isTreeArch?g.selected||g.xmlRoot:g.xmlRoot;}}if(!u){u=g.xmlRoot;}if(apf.isWebkit&&u.ownerDocument!=C.ownerDocument){C=u.ownerDocument.importNode(C,true);}if(!u){throw new Error(apf.formatErrorString(0,g,"Executing add action","Missing parent node. You can only add nodes to a list if it                     has data loaded. Unable to perform action."));}if(g.$executeAction("appendChild",[u,C,s],"add",C)!==false&&g.autoselect){g.select(C);}if(d){d.call(g,C);}return C;};if(t){return w(t,apf.SUCCESS);}else{if(q.get){return apf.getData(q.get,{xmlNode:n,callback:w});}else{throw new Error(apf.formatErrorString(0,this,"Executing add action","Missing add action defined in action rules. Unable to                      perform action."));}}return addXmlNode;};if(!this.setValue){this.setValue=function(g,d){noEvent=d;this.setProperty("value",g,false,true);noEvent=false;};}this.findXmlNodeByValue=function(k){var g=this.getTraverseNodes(),d=this.$attrBindings.eachvalue&&"eachvalue"||this.$bindings.value&&"value"||this.$hasBindRule("caption")&&"caption";if(!d){return false;}for(var j=0;j<g.length;j++){if(this.$applyBindRule(d,g[j])==k){return g[j];}}};if(!this.getValue){this.getValue=function(g,d){return this.value;};}this.reselect=function(){if(this.selected){this.select(this.selected,null,this.ctrlselect,null,true);}};this.select=function(B,g,w,k,i,q,C){if(!this.selectable||C&&this.disabled||this.editable){return;}if(k==-1){k=false;C=true;}if(this.$skipSelect){this.$skipSelect=false;return;}if(this.ctrlselect&&!w){g=true;}if(!this.multiselect){g=w=false;}if(!this.xmlRoot){if(!this.$buffered){var s;this.addEventListener("afterload",s=function(){this.select.apply(this,this.$buffered);this.removeEventListener("afterload",s);delete this.$buffered;});}this.$buffered=Array.prototype.slice.call(arguments);return;}var A;if(!B){throw new Error(apf.formatErrorString(1075,this,"Making a selection","No selection was specified"));return false;}if(typeof B!="object"){var u=B;B=null;if(typeof B=="string"){B=apf.xmldb.getNodeById(u);}if(!B){B=this.findXmlNodeByValue(u);if(!B){this.clearSelection(q);return;}}}if(!B.style){A=this.$findHtmlNode(B.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId);}else{var d=(A=B).getAttribute(apf.xmldb.htmlIdTag);while(!d&&A.parentNode){d=(A=A.parentNode).getAttribute(apf.xmldb.htmlIdTag);}B=apf.xmldb.getNodeById(d);}if(!w&&!g&&!i&&!this.reselectable&&this.$valueList.length<=1&&this.$valueList.indexOf(B)>-1){return;}if(this.dispatchEvent("beforeselect",{selected:B,htmlNode:A,ctrlKey:g,shiftKey:w,force:i,captureOnly:q})===false){return false;}var j=this.caret;this.caret=B;if(w){var n=this.$calcSelectRange(this.$valueList[0]||j,B);if(this.$caret){this.$deindicate(this.$caret);}this.selectList(n);this.$selected=this.$caret=this.$indicate(A);}else{if(g){if(this.$valueList.contains(B)){if(this.selected==B){this.$deselect(this.$findHtmlNode(this.selected.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId));this.$deindicate(this.$caret);if(this.$valueList.length&&!k){this.selected=this.$valueList[0];}}else{this.$deselect(A,B);}if(!k){this.$selectedList.remove(A);this.$valueList.remove(B);}if(A!=this.$caret){this.$deindicate(this.$caret);}this.$selected=this.$caret=this.$indicate(A);}else{if(this.$caret){this.$deindicate(this.$caret);}this.$caret=this.$indicate(A,B);this.$selected=this.$select(A,B);this.selected=B;if(!k){this.$selectedList.push(A);this.$valueList.push(B);}}}else{if(k&&A&&this.$selectedList.contains(A)){return;}else{if(this.$selected){this.$deselect(this.$selected);}if(this.$caret){this.$deindicate(this.$caret);}if(this.selected){this.clearSelection(true);}this.$caret=this.$indicate(A,B);this.$selected=this.$select(A,B);this.selected=B;this.$selectedList.push(A);this.$valueList.push(B);}}}if(this.delayedselect&&(typeof g=="boolean")){var t=this;$setTimeout(function(){t.dispatchEvent("afterselect",{selection:t.$valueList,selected:B,caret:t.caret,captureOnly:q});},10);}else{this.dispatchEvent("afterselect",{selection:this.$valueList,selected:B,caret:this.caret,captureOnly:q});}return true;};this.choose=function(d,g){if(!this.selectable||g&&this.disabled){return;}if(this.dispatchEvent("beforechoose",{xmlNode:d})===false){return false;}if(d&&!d.style){this.select(d);}if(this.hasFeature(apf.__DATABINDING__)&&this.dispatchEvent("afterchoose",{xmlNode:this.selected})!==false){this.setProperty("chosen",this.selected);}};this.clearSelection=function(g,k){if(!this.selectable||k&&this.disabled||!this.$valueList.length){return;}if(!g){if(this.dispatchEvent("beforeselect",{selection:[],selected:null,caret:this.caret})===false){return false;}}var j;for(var d=this.$valueList.length-1;d>=0;d--){j=this.$findHtmlNode(this.$valueList[d].getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId);this.$deselect(j);}this.$selectedList.length=0;this.$valueList.length=0;this.$selected=this.selected=null;if(this.caret){j=this.$findHtmlNode(this.caret.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId);this.$caret=this.$indicate(j);}if(!g){this.dispatchEvent("afterselect",{selection:this.$valueList,selected:null,caret:this.caret});}};this.selectList=function(d,k,n,t){if(!this.selectable||t&&this.disabled){return;}if(this.dispatchEvent("beforeselect",{selection:d,selected:n||d[0],caret:this.caret,captureOnly:k})===false){return false;}this.clearSelection(true);for(var s,j=0;j<d.length;j++){if(!d[j]||d[j].nodeType!=1){continue;}var q,g=d[j];if(typeof g!="object"){g=apf.xmldb.getNodeById(g);}if(!g.style){q=this.$pHtmlDoc.getElementById(g.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId);}else{q=g;g=apf.xmldb.getNodeById(q.getAttribute(apf.xmldb.htmlIdTag));}if(!g){apf.console.warn("Component : "+this.name+" ["+this.localName+"]\nMessage : xmlNode whilst selecting a list of xmlNodes could not be found. Ignoring.");continue;}if(q){if(!s&&n==q){s=q;}this.$select(q,g);this.$selectedList.push(q);}this.$valueList.push(g);}this.$selected=s||this.$selectedList[0];this.selected=n||this.$valueList[0];this.dispatchEvent("afterselect",{selection:this.$valueList,selected:this.selected,caret:this.caret,captureOnly:k});};this.setCaret=function(d){if(!d){if(this.$caret){this.$deindicate(this.$caret);}this.caret=this.$caret=null;return;}var g;if(typeof d!="object"){d=apf.xmldb.getNodeById(d);}if(!d.style){g=this.$findHtmlNode(d.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId);}else{var i=(g=d).getAttribute(apf.xmldb.htmlIdTag);while(!i&&g.parentNode){i=(g=g.parentNode).getAttribute(apf.xmldb.htmlIdTag);}d=apf.xmldb.getNodeById(i);}if(this.$caret){this.$deindicate(this.$caret);}this.$caret=this.$indicate(g);this.setProperty("caret",this.caret=d);};this.$setTempSelected=function(i,j,g,n){clearTimeout(this.timer);if(this.$bindings.selectable){while(i&&!this.$getDataNode("selectable",i)){i=this.getNextTraverseSelected(i,!n);}if(!i){return;}}if(!this.multiselect){j=g=false;}if(j||this.ctrlselect){if(this.$tempsel){this.select(this.$tempsel);this.$tempsel=null;}this.setCaret(i);}else{if(g){if(this.$tempsel){this.$selectTemp();this.$deselect(this.$tempsel);this.$tempsel=null;}this.select(i,null,g);}else{if(!this.bufferselect||this.$valueList.length>1){this.select(i);}else{var k=apf.xmldb.getID(i,this);this.$deselect(this.$tempsel||this.$selected);this.$deindicate(this.$tempsel||this.$caret);this.$tempsel=this.$indicate(document.getElementById(k));this.$select(this.$tempsel);var d=this;this.timer=$setTimeout(function(){d.$selectTemp();},400);}}}};this.$selectTemp=function(){if(!this.$tempsel){return;}clearTimeout(this.timer);this.select(this.$tempsel);this.$tempsel=null;this.timer=null;};this.selectAll=function(g){if(!this.multiselect||!this.selectable||g&&this.disabled||!this.xmlRoot){return;}var d=this.$isTreeArch?this.xmlRoot.selectNodes(".//"+this.each.split("|").join("|.//")):this.xmlRoot.selectNodes(this.each);this.selectList(d);};this.getSelection=function(d){var g,j;if(d){j=this.xmlRoot?this.xmlRoot.ownerDocument.createDocumentFragment():apf.getXmlDom().createDocumentFragment();for(g=0;g<this.$valueList.length;g++){apf.xmldb.cleanNode(j.appendChild(this.$valueList[g].cloneNode(true)));}}else{for(j=[],g=0;g<this.$valueList.length;g++){j.push(this.$valueList[g]);}}return j;};this.$getSelection=function(d){return d?this.$selectedList:this.$valueList;};this.defaultSelectNext=function(g,d){var i=this.getNextTraverseSelected(g);if(i||!d){this.select(i?i:this.getTraverseParent(g));}else{this.clearSelection(true);}};this.selectNext=function(){var d=this.getNextTraverse();if(d){this.select(d);}};this.selectPrevious=function(){var d=this.getNextTraverse(null,-1);if(d){this.select(d);}};this.getDefaultNext=function(g,d){var i=this.getNextTraverseSelected(g);return(i&&i!=g)?i:(d?this.getTraverseParent(g):null);};this.isSelected=function(g){if(!g){return false;}for(var d=0;d<this.$valueList.length;d++){if(this.$valueList[d]==g){return this.$valueList.length;}}return false;};this.$checkSelection=function(g){if(this.$valueList.length>1){for(var d=[],k=0,j=this.$valueList.length;k<j;k++){if(apf.isChildOf(this.xmlRoot,this.$valueList[k])){d.push(this.$valueList[k]);}}if(d.length>1){this.selectList(d);if(this.caret&&!apf.isChildOf(this.xmlRoot,this.caret)){this.setCaret(g||this.selected);}return;}else{if(d.length){g=d[0];}}}if(!g){if(this.selected&&!apf.isChildOf(this.xmlRoot,this.selected)){g=this.getFirstTraverseNode();}else{if(this.selected&&this.caret&&!apf.isChildOf(this.xmlRoot,this.caret)){this.setCaret(this.selected);}else{if(!this.selected){g=this.xmlRoot?this.getFirstTraverseNode():null;}else{return;}}}}if(g){if(this.autoselect){this.select(g);}else{if(!this.multiselect){this.clearSelection();}this.setCaret(g);}}else{this.clearSelection();}};this.selectable=true;if(typeof this.ctrlselect=="undefined"){this.ctrlselect=false;}if(typeof this.multiselect=="undefined"){this.multiselect=true;}if(typeof this.autoselect=="undefined"){this.autoselect=true;}if(typeof this.delayedselect=="undefined"){this.delayedselect=true;}if(typeof this.allowdeselect=="undefined"){this.allowdeselect=true;}this.reselectable=false;this.$booleanProperties.selectable=true;this.$booleanProperties.multiselect=true;this.$booleanProperties.autoselect=true;this.$booleanProperties.delayedselect=true;this.$booleanProperties.allowdeselect=true;this.$booleanProperties.reselectable=true;this.$supportedProperties.push("selectable","ctrlselect","multiselect","autoselect","delayedselect","allowdeselect","reselectable","selection","selected","default","value","caret");this.$propHandlers.value=function(g){if(this.$lastValue==g){delete this.$lastValue;return;}if(!this.$attrBindings.eachvalue&&!this.$amlLoaded&&this.getAttribute("eachvalue")){var d=this;return apf.queue.add("value"+this.$uniqueId,function(){d.$propHandlers.value.call(d,g);});}var i=this.$getBindRule("value",this.xmlRoot);if(i){if(i.models[0]==this.$model){throw new Error(apf.formatErrorString(0,this,"Setting value attribute",'Value should not point to the same model where the items                     are loaded from. Please use value="[mdlName::xpath]" to                     specify the value. Use selected="[xpath]" to just select                     a node without making a databinding to it.'));}}if(g||g===0||this["default"]){this.select(String(g)||this["default"]);}else{this.clearSelection();}};this.$propHandlers["default"]=function(d,g){if(!this.value||!this.$amlLoaded&&!(this.getAttribute("value")||this.getAttribute("selected")||this.getAttribute("selection"))){this.$propHandlers.value.call(this,"");}};this.$propHandlers.caret=function(d,g){if(d){this.setCaret(d);}};this.$propHandlers.selection=this.$propHandlers.selected=function(C,s){if(!C){C=this[s]=null;}if(s=="selected"&&typeof C!="string"&&C==this.selected){this.selected=null;return;}if(s=="selection"&&(this.getAttribute("selection")||"*").substr(0,1)!="*"){apf.console.warn("Selection attribute ("+this.getAttributeNode("selection")+") should select multiple nodes. Please prefix xpath query with a * (ex.: *[item]).");}if(this.$isSelecting){this.selection=this.$valueList;return false;}var B,q,n,G,F,J,I;if(s=="selection"){if(typeof C=="object"&&C==this.$valueList){var g;if((J=this.$attrBindings[s])&&J.cvalue.models){this.$isSelecting=true;q=this.$attrBindings.eachvalue&&"eachvalue"||this.$bindings.value&&"value"||this.$hasBindRule("caption")&&"caption";if(!q){throw new Error("Missing bind rule set: eachvalue, value or caption");}var k=this.$getDataNode(s,this.xmlRoot);B=C;n=(I=this.$attrBindings["selection-unique"])&&I.cvalue;if(k.length){g=k[0].parentNode;}else{var w,A;if(J.cvalue.xpaths[0]=="#"||J.cvalue.xpaths[1]=="#"){var D=(J.cvalue3||(J.cvalue3=apf.lm.compile(J.value,{xpathmode:5})))(this.xmlRoot);w=D.model&&D.model.$isModel&&D.model;if(w){A=D.xpath;}else{if(D.model){w=apf.xmldb.findModel(D.model);A=apf.xmlToXpath(D.model,w.data)+(D.xpath?"/"+D.xpath:"");}else{}}}else{w=apf.nameserver.get("model",J.cvalue.xpaths[0]);A=J.cvalue.xpaths[1];}if(!w||!w.data){this.$isSelecting=false;return false;}g=w.queryNode(A.replace(/\/[^\/]+$|^[^\/]*$/,"")||".");if(!g){throw new Error("Missing parent node");}}remove_loop:for(G=0;G<k.length;G++){C=n?n(k[G]):this.$applyBindRule(q,k[G]);for(F=0;F<B.length;F++){if(this.$applyBindRule(q,B[F])==C){continue remove_loop;}}apf.xmldb.removeNode(k[G]);}add_loop:for(G=0;G<B.length;G++){C=this.$applyBindRule(q,B[G]);for(F=0;F<k.length;F++){if(n?n(k[F]):this.$applyBindRule(q,k[F])==C){continue add_loop;}}var E=this.$attrBindings["selection-constructor"]&&this.$getDataNode("selection-constructor",B[G])||apf.getCleanCopy(B[G]);apf.xmldb.appendChild(g,E);}this.$isSelecting=false;}return;}this.selection=this.$valueList;}else{this.selected=null;}if(!this.xmlRoot){if(!this.$buffered){var H;this.addEventListener("afterload",H=function(){this.removeEventListener("afterload",H);this.$propHandlers.selected.call(this,C,s);delete this.$buffered;});this.$buffered=true;}this[s]=null;return false;}if(!C||typeof C!="object"){if(this.$attrBindings[s]){B=this.$getDataNode(s,this.xmlRoot);if(B){this.setProperty("selection",B);}}else{if(!C){this.clearSelection();}else{this.select(C);}}return false;}else{if(typeof C.length=="number"){B=C;if(!B.length){this.selected=null;if(this.$valueList.length){this.clearSelection();return false;}else{return;}}if(this.isTraverseNode(B[0])&&apf.isChildOf(this.xmlRoot,B[0])){if(!this.multiselect){this.select(B[0]);}else{this.selectList(B);}return false;}if(this.$attrBindings[s]){q=this.$attrBindings.eachvalue&&"eachvalue"||this.$bindings.value&&"value"||this.$hasBindRule("caption")&&"caption";if(!q){throw new Error("Missing bind rule set: eachvalue, value or caption");}var u=!this.each?this.getTraverseNodes():this.xmlRoot.selectNodes("//"+this.each.split("|").join("|//"));n=(J=this.$attrBindings["selection-unique"])&&J.cvalue;var t=[];for(G=0;G<B.length;G++){C=n?n(B[G]):this.$applyBindRule(q,B[G]);for(F=0;F<u.length;F++){if(this.$applyBindRule(q,u[F])==C){t.push(u[F]);}}}this.selectList(t,true);return false;}throw new Error("Show me which case this is");}else{if(this.$valueList.indexOf(C)==-1){this.select(C);}}}};this.$propHandlers.allowdeselect=function(g){if(g){var d=this;this.$container.onmousedown=function(j){if(!j){j=event;}if(j.ctrlKey||j.shiftKey){return;}var i=j.srcElement||j.target;if(d.allowdeselect&&(i==this||i.getAttribute(apf.xmldb.htmlIdTag))){d.clearSelection();}};}else{this.$container.onmousedown=null;}};this.$propHandlers.ctrlselect=function(d){if(d!="enter"){this.ctrlselect=apf.isTrue(d);}};function c(){this.selectAll();}this.$propHandlers.autoselect=function(d){if(d=="all"&&this.multiselect){this.addEventListener("afterload",c);}else{this.removeEventListener("afterload",c);}};this.$propHandlers.multiselect=function(d){if(!d&&this.$valueList.length>1){this.select(this.selected);}};this.addEventListener("beforeselect",function(d){if(this.$bindings.selectable&&!this.$getDataNode("selectable",d.selected)){return false;}},true);this.addEventListener("afterselect",function(j){var i=null;this.setProperty("caret",j.caret);if(this.sellength!=j.selection.length){this.setProperty("sellength",j.selection.length);}delete this.selection;this.setProperty("selection",j.selection);if(!j.selection.length){this.setProperty("selected",j.selected);if(this.value){this.setProperty("value","");}}else{this.$chained=true;if(!j.force&&(!this.dataParent||!this.dataParent.parent.$chained)){var d=this;$setTimeout(function(){d.setProperty("selected",i||j.selected);delete d.$chained;},10);}else{this.setProperty("selected",i||j.selected);delete this.$chained;}var g=this.$attrBindings.eachvalue&&"eachvalue"||this.$bindings.value&&"value"||this.$hasBindRule("caption")&&"caption";if(g){this.$lastValue=this.$applyBindRule(g,j.selected);if(this.$lastValue!=(g!="value"&&(this.xmlRoot&&this.$applyBindRule("value",this.xmlRoot,null,true))||this.value)){if(g=="eachvalue"||this.xmlRoot!=this){this.change(this.$lastValue);}else{this.setProperty("value",this.$lastValue);}}delete this.$lastValue;}}},true);}).call(apf.MultiSelect.prototype=new apf.MultiselectBinding());apf.__CONTENTEDITABLE__=1<<23;apf.__CHILDVALUE__=1<<27;apf.ChildValue=function(){if(!this.$childProperty){this.$childProperty="value";}this.$regbase=this.$regbase|apf.__CHILDVALUE__;var c;this.addEventListener("DOMCharacterDataModified",c=function(i){if(i&&(i.currentTarget==this||i.currentTarget.nodeType==2&&i.relatedNode==this)){return;}if(this.getAttribute(this.$childProperty)){return;}var d=this.serialize().match(/^[\s\S]*?>([\s\S]*)<[\s\S]*?$/),g=d&&d[1]||"";if(g.indexOf("{")>-1||g.indexOf("[")>-1){this.$setDynamicProperty(this.$childProperty,g);}else{if(this[this.$childProperty]!=g){this.setProperty(this.$childProperty,g);}}});this.addEventListener("DOMAttrModified",c);this.addEventListener("DOMNodeInserted",c);this.addEventListener("DOMNodeRemoved",c);this.$init(function(){this.addEventListener("prop."+this.$childProperty,function(d){if(!d.value){c.call(this);}});});this.addEventListener("DOMNodeInsertedIntoDocument",function(i){var j=typeof this[this.$childProperty]=="undefined";if(j&&!this.getElementsByTagNameNS(this.namespaceURI,"*",true).length&&(this.childNodes.length>1||this.firstChild&&(this.firstChild.nodeType==1||this.firstChild.nodeType!=7&&this.firstChild.nodeValue.trim().length))){var d=(this.$aml&&this.$aml.xml||this.serialize()).match(/^[\s\S]*?>([\s\S]*)<[\s\S]*?$/),g=d&&d[1]||"";if(g.indexOf("{")>-1||g.indexOf("[")>-1){this.$setDynamicProperty(this.$childProperty,g);}else{this.setProperty(this.$childProperty,g);}}else{if(j){this.$propHandlers[this.$childProperty].call(this,"");}}});};apf.__DATAACTION__=1<<25;apf.DataAction=function(){this.$regbase=this.$regbase|apf.__DATAACTION__;this.getActionTracker=function(i){if(!apf.AmlNode){return apf.window.$at;}var d=this,g=i?null:this.$at;if(!g&&this.dataParent){g=this.dataParent.parent.$at;}while(!g){if(!d.parentNode){var c;return(c=this.getModel&&this.getModel(true))&&c.$at||apf.window.$at;}g=(d=d.parentNode).$at;}return g;};this.$actionsLog={};this.$actions=false;this.$startAction=function(d,i,j){if(this.disabled||this.contenteditable&&d!="edit"){return false;}var g=this.$actions&&this.$actions.getRule(d,i);if(!g&&apf.config.autoDisableActions&&this.$actions){if(!i){apf.console.warn("Tried starting new action but no xml                     context was specified.");}else{apf.console.warn("Tried starting new action but no '"+d+"' action rule was found.");}return false;}var c=typeof apf.offline!="undefined";if(this.dispatchEvent(d+"start",{xmlContext:i})===false){return false;}this.$actionsLog[d]=i;return true;};this.$stopAction=function(d,g,c){delete this.$actionsLog[d];};this.$executeAction=function(w,j,d,u,n,g,A){if(this.disabled||this.contenteditable&&d!="edit"){return;}apf.console.info("Executing action '"+d+"' for "+(this.name||"")+" ["+(this.localName||"")+"]");var s=this.$actions&&this.$actions.getRule(d,u);if(!s&&this.$actions&&apf.config.autoDisableActions&&"action|change".indexOf(d)==-1){apf.console.warn("Could not execute action '"+d+"'.               No valid action rule was found and auto-disable-actions is enabled");return false;}var t;if(A){t=[];for(var c=A.length-1;c>=0;c--){t.unshift({xmlActionNode:s&&s[4],amlNode:this,selNode:A[c],xmlNode:A[c]});}}var q=new apf.AmlEvent("before"+d.toLowerCase(),{action:w,args:j,xmlActionNode:s,amlNode:this,selNode:g,multiple:t||false});if(!n){if(this.dispatchEvent(q.name,null,q)===false){return false;}delete q.currentTarget;}var i=this.getActionTracker().execute(q);q.xmlNode=i.xmlNode;q.undoObj=i;if(!n){q.name="after"+d.toLowerCase();q.cancelBubble=false;delete q.returnValue;delete q.currentTarget;this.dispatchEvent(q.name,null,q);}return i;};this.$executeSingleValue=function(c,s,B,A,n){var q,t,w=this.$getBindRule(s,B);if(!w){if(this.$getBindRule(s)){throw new Error("There is no rule that matches the xml node for this operation.                                 Please make sure you are matching a node and using the value to                                  specify it's value <a:"+s+" match='person'                                  value='[@name]' /> : "+B.xml);}else{return false;}}var u=w.value?w.cvalue:w.cmatch;if(!u){if(w.value){u=w.compile("value");}else{return false;}}if(u.type!=3){throw new Error("Cannot create from rule that isn't a single xpath");}var C,d=u.xpaths,j=false;if(d[0]=="#"||d[1]=="#"){var i=(w.cvalue3||(w.cvalue3=apf.lm.compile(w.value,{xpathmode:5})))(B);var k=i.model&&i.model.$isModel&&i.model;if(k){var g=k.queryNode(i.xpath);B=k.data;}else{k=apf.xmldb.findModel(i.model);var g=i.model.selectSingleNode(i.xpath);B=i.model;}d[1]=i.xpath;}else{var k=d[0]&&apf.nameserver.get("model",d[0])||this.$model,g=k?k.queryNode(d[1]):(B||this.xmlRoot).selectSingleNode(d[1]);}if(g){if(apf.queryValue(g)==A){return;}C=(g.nodeType==1||g.nodeType==3||g.nodeType==4)?"setTextNode":"setAttribute";t=(g.nodeType==1)?[g,A]:(g.nodeType==3||g.nodeType==4?[g.parentNode,A]:[g.ownerElement||g.selectSingleNode(".."),g.nodeName,A]);}else{if(!this.$createModel){return false;}C="setValueByXpath";q=d[1];if(!B){if(!k){k=this.getModel();}if(k){if(!k.data){k.load("<data />");}q=(k.getXpathByAmlNode(this)||".")+(q&&q!="."?"/"+q:"");B=k.data;}else{if(!this.dataParent){return false;}B=this.dataParent.parent.selected||this.dataParent.parent.xmlRoot;if(!B){return false;}q=(this.dataParent.xpath||".")+(q&&q!="."?"/"+q:"");j=true;}}t=[B,A,q];}if(n){return{func:C,args:t};}this.$executeAction(C,t,c,B);if(j){this.load(B.selectSingleNode(q));}};this.change=function(g,d){if(this.errBox&&this.errBox.visible&&this.isValid&&this.isValid()){this.clearError();}if(!this.xmlRoot&&!this.$createModel||!(this.$mainBind=="value"&&this.hasFeature(apf.__MULTISELECT__)?this.$attrBindings.value:this.$hasBindRule(this.$mainBind))){if(!d&&g===this.value||this.dispatchEvent("beforechange",{value:g})===false){return false;}this.setProperty("value",g);return this.dispatchEvent("afterchange",{value:g});}var c=this.$attrBindings.eachvalue&&"eachvalue"||this.$bindings.value&&"value"||this.$hasBindRule("caption")&&"caption";if(g==(c!="value"&&(this.xmlRoot&&this.$applyBindRule("value",this.xmlRoot,null,true))||this.value)){return false;}this.$executeSingleValue("change",this.$mainBind,this.xmlRoot,g);};this.$booleanProperties["render-root"]=true;this.$supportedProperties.push("create-model","actions");this.$propHandlers["create-model"]=function(c){this.$createModel=c;};this.addEventListener("DOMNodeInsertedIntoDocument",function(c){if(typeof this["create-model"]=="undefined"&&!this.$setInheritedAttribute("create-model")){this.$createModel=true;}});};apf.config.$inheritProperties["create-model"]=1;apf.__CACHE__=1<<2;apf.__RENAME__=1<<10;apf.Rename=function(){this.$regbase=this.$regbase|apf.__RENAME__;this.canrename=true;this.$renameSubject=this.renameTimer=this.lastCursor=null;this.$booleanProperties.canrename=true;this.$booleanProperties.autorename=true;this.$supportedProperties.push("canrename","autorename");this.rename=function(c,d){if(!c){c=this.caret||this.selected;}if(!c){return;}this.$executeSingleValue("rename","caption",c,d);};this.startDelayedRename=function(d,c,g){if(d&&(d.button==2||d.ctrlKey||d.shiftKey)||g&&this.disabled){return;}clearTimeout(this.renameTimer);this.renameTimer=$setTimeout("apf.lookup("+this.$uniqueId+").startRename()",c||400);};this.startRename=function(i,c,n){if(!i&&(this.renaming||!this.canrename||!this.$startAction("rename",this.caret||this.selected,this.stopRename))||n&&this.disabled){return false;}if(!this.hasFocus()){this.focus(null,null,true);}clearTimeout(this.renameTimer);var q=this.$getCaptionElement?this.$getCaptionElement():this.$caret||this.$selected;if(!q){return this.stopRename();}this.renaming=true;this.$renameSubject=this.caret||this.selected;var d=q.offsetWidth;this.lastCursor=q.style.cursor;q.style.cursor="text";q.parentNode.replaceChild(this.$txt,q);q.host=this;if(apf.isTrue(this.$getOption("main","scalerename"))){var k=apf.getWidthDiff(this.$txt);this.$txt.style.width=(d-k-3)+"px";}this.$replacedNode=q;var g=this.$getCaptionXml?this.$getCaptionXml(this.$renameSubject):this.$getDataNode("caption",this.$renameSubject);value=c||!g?"":(g.nodeType!=1?unescape(g.nodeValue):(apf.isOnlyChild(g.firstChild,[3,4])?apf.queryValue(g):this.$applyBindRule("caption",this.$renameSubject)))||"";if(apf.hasContentEditable){if(this.$multiLineRename){this.$txt.innerHTML=apf.htmlCleaner.prepare(value.trim().replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br />"));}else{this.$txt.innerHTML=value.replace(/</g,"&lt;");}}else{this.$txt.value=value;}this.$txt.unselectable="Off";this.$txt.host=this;try{this.$txt.focus();this.$txt.select();}catch(j){}};this.stopRename=function(c,g){clearTimeout(this.renameTimer);if(!this.renaming||c&&c!=this.$renameSubject||!this.$replacedNode){return false;}if(this.$txt.parentNode&&this.$txt.parentNode.nodeType==1){if(apf.isIE8||apf.isIE7Emulate){this.$txt.blur();}this.$txt.parentNode.replaceChild(this.$replacedNode,this.$txt);}this.renaming=false;if(this.$replacedNode){this.$replacedNode.style.cursor=this.lastCursor||"";this.$replacedNode.host=null;}if(this.$multiLineRename){var d=apf.html_entity_decode(apf.htmlCleaner.parse(this.$txt.innerHTML,true).replace(/<br \/>/g,"").replace(/<\/?p>/g,""));}else{var d=this.$txt[apf.hasContentEditable?"innerText":"value"].replace(/<.*?nobr>/gi,"");}if(!g||(this.$validateRename&&!this.$validateRename(d))){this.dispatchEvent("stoprename");this.$stopAction("rename");}else{if(this.$replacedNode){this.$replacedNode.innerHTML=d.replace(/</g,"&lt;").replace(/\r?\n/g,"<br />");}this.rename(this.$renameSubject,d);}if(!this.renaming){this.$renameSubject=null;this.$replacedNode=null;this.$txt.style.width="";}return true;};this.addEventListener("keydown",function(d){var c=d.keyCode;if(this.renaming){if(c==27||this.$multiLineRename&&d.ctrlKey&&c==13||!this.$multiLineRename&&c==13){this.stopRename(null,c==13&&!this.$autocomplete);d.cancelBubble=true;return false;}return;}if(c==113){if(this.$tempsel){this.$selectTemp();}if(this.caret!=this.selected){if(this.multiselect||this.isSelected(this.caret)){this.selected=this.caret;this.$selected=this.$caret;}else{this.select(this.caret,true);}}this.startRename();return false;}},true);this.addEventListener("DOMNodeRemovedFromDocument",function(c){this.$txt.refCount--;if(!this.$txt.refCount){this.$txt.host=this.$txt.onmouseover=this.$txt.onmousedown=this.$txt.select=this.$txt.onfocus=this.$txt.onblur=null;}this.$txt=null;});this.$init(apf.Rename.initEditableArea);};apf.Rename.initEditableArea=function(){if(!(this.$txt=document.getElementById("txt_rename"))){if(apf.hasContentEditable){this.$txt=document.createElement("DIV");this.$txt.contentEditable=true;if(apf.isIE6){this.$txt.style.width="1px";}}else{this.$txt=document.createElement("input");this.$txt.id="txt_rename";this.$txt.autocomplete=false;}if(apf.hasFocusBug){apf.sanitizeTextbox(this.$txt);}this.$txt.refCount=0;this.$txt.id="txt_rename";apf.importCssString("#txt_rename{white-space:nowrap}");this.$txt.onselectstart=function(c){(c||event).cancelBubble=true;};apf.sanitizeTextbox(this.$txt);this.$txt.onmouseover=this.$txt.onmouseout=this.$txt.oncontextmenu=this.$txt.onmousedown=function(c){(c||event).cancelBubble=true;};this.$txt.onkeyup=function(c){if(!this.host.$autocomplete){return;}this.host.$lookup(this[apf.hasContentEditable?"innerHTML":"value"]);};this.$txt.select=function(){if(!apf.hasMsRangeObject){return this.focus();}var c=document.selection.createRange();try{c.moveToElementText(this);if(apf.isFalse(this.host.$getOption("main","selectrename"))||typeof this.host.$renameStartCollapse!="undefined"){c.collapse(this.host.$renameStartCollapse);}}catch(d){}c.select();};if(apf.hasFocusBug){this.$txt.onfocus=function(){if(apf.window){apf.window.$focusfix2();}};}this.$txt.onblur=function(){if(apf.isGecko){return;}if(apf.hasFocusBug){apf.window.$blurfix();}if(this.host.$autocomplete){return;}this.host.stopRename(null,true);};}this.$txt.refCount++;};apf.__DOCKING__=1<<18;apf.BaseButton=function(){this.$init(true);};(function(){this.implement(apf.ChildValue);this.refKeyDown=this.refMouseDown=0;this.mouseOver=this.mouseLeft=false;this.$propHandlers.background=function(d){var g=this.$getLayoutNode("main","background",this.$ext);if(!g){return apf.console.warn("No background defined in the Button skin","button");}if(d){var c=d.split("|");this.$background=c.concat(["vertical",2,16].slice(c.length-1));g.style.backgroundImage="url("+this.mediaPath+c[0]+")";g.style.backgroundRepeat="no-repeat";}else{g.style.backgroundImage="";g.style.backgroundRepeat="";this.$background=null;}};this.addEventListener("keydown",function(d){var c=d.keyCode;switch(c){case 13:if(this.localName!="checkbox"){this.$ext.onmouseup(d.htmlEvent,true);}break;case 32:if(!d.htmlEvent.repeat){this.refKeyDown++;this.$updateState(d.htmlEvent);}return false;}},true);this.addEventListener("keyup",function(d){var c=d.keyCode;switch(c){case 32:this.refKeyDown--;if(this.refKeyDown<0){this.refKeyDown=0;return false;}if(this.refKeyDown+this.refMouseDown==0&&!this.disabled){this.$ext.onmouseup(d,true);}this.$updateState(d);return false;}},true);this.states={Out:1,Over:2,Down:3};this.$updateState=function(d,c){if(d.reset){this.refKeyDown=0;this.refMouseDown=0;this.mouseOver=false;return false;}if(this.refKeyDown>0||(this.refMouseDown>0&&this.mouseOver)||(this.isBoolean&&this.value)){this.$setState("Down",d,c);}else{if(this.mouseOver){this.$setState("Over",d,c);}else{this.$setState("Out",d,c);}}};this.$setupEvents=function(){if(this.editable){return;}var c=this;this.$ext.onmousedown=function(d){d=d||window.event;if(c.disabled||c.$notfromext&&(d.srcElement||d.target)==this){return;}c.refMouseDown=1;c.mouseLeft=false;c.$updateState(d,"mousedown");};this.$ext.onmouseup=function(g,d){g=g||window.event;if(c.disabled||!d&&(!c.mouseOver||!c.refMouseDown)){return;}c.refMouseDown=0;c.$updateState(g,"mouseup");if(c.disabled||(g&&g.type=="click"&&c.mouseLeft==true)){return false;}if(c.refMouseDown+c.refKeyDown){return false;}if(c.$clickHandler&&c.$clickHandler()){c.$updateState(g||event,"click");}else{c.dispatchEvent("click",{htmlEvent:g});}return false;};this.$ext.onmousemove=function(d){if(!c.mouseOver&&!c.disabled){d=d||window.event;if(c.$notfromext&&(d.srcElement||d.target)==this){return;}c.mouseOver=true;c.$updateState(d,"mouseover");}};this.$ext.onmouseout=function(g){g=g||window.event;var d=g.explicitOriginalTarget||g.toElement;if(c.disabled||this==d||apf.isChildOf(this,d)){return;}c.mouseOver=false;c.refMouseDown=0;c.mouseLeft=true;c.$updateState(g,"mouseout");};if(apf.isIphone){apf.iphone.linkEvents(this.$ext,true);}if(apf.hasClickFastBug){this.$ext.ondblclick=this.$ext.onmouseup;}};this.$doBgSwitch=function(d){if(this.background&&(this.$background[2]>=d||d==4)){if(d==4){d=this.$background[2]+1;}var c=this.$background[1]=="vertical"?"0 -"+(parseInt(this.$background[3])*(d-1))+"px":"-"+(parseInt(this.$background[3])*(d-1))+"px 0";this.$getLayoutNode("main","background",this.$ext).style.backgroundPosition=c;}};this.$focus=function(){if(!this.$ext){return;}this.$setStyleClass(this.$ext,this.$baseCSSname+"Focus");};this.$blur=function(c){if(!this.$ext){return;}this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Focus"]);if(c){this.$updateState({});}};this.$destroy=function(c){if(!c&&this.$ext){this.$ext.onmousedown=this.$ext.onmouseup=this.$ext.onmouseover=this.$ext.onmouseout=this.$ext.onclick=this.$ext.ondblclick=null;}};}).call(apf.BaseButton.prototype=new apf.StandardBinding());apf.BaseTab=function(){this.$init(true);};(function(){this.isPaged=true;this.$focussable=apf.KEYBOARD;this.length=0;this.isLoading={};this.inited=this.ready=false;this.set=function(d,g,c){if(c||this.src&&!this.$findPage(d,{})){return this.$propHandlers.activepage.call(this,d,null,null,g,c);}if(g&&this.activepage==d){return g();}this.$lastCallback=g;this.setProperty("activepage",d);};this.$supportedProperties.push("activepage","activepagenr","length","src","loading");this.$propHandlers.activepagenr=this.$propHandlers.activepage=function(i,c,d,s,j){if(!this.inited||apf.isNot(i)){return;}if(!s){s=this.$lastCallback;delete this.$lastCallback;}var k,g={};k=this.$findPage(i,g);if(!k){if(this.src){if(this.isLoading[i]){return;}if(this.$findPage("loading",{})){this.$propHandlers.activepage.call(this,"loading");}this.setProperty("loading",true);this.isLoading[i]=true;k=this.ownerDocument.createElementNS(apf.ns.apf,"page");k.setAttribute("id",i);this.appendChild(k);var n=this;k.insertMarkup(this.src,{page:i,callback:function(t){if(!t.xmlNode){var u=new Error(apf.formatErrorString(0,null,"Loading new page","Could not load new page: "+n.src));n.setProperty("loading",false);if(this.dispatchEvent("error",apf.extend({error:u,bubbles:true},t))===false){return true;}throw u;}else{n.setProperty("activepage",i);if(s){s();}n.setProperty("loading",false);}}});return;}apf.console.warn("Setting tab page which doesn't exist,                               referenced by name: '"+i+"'");return false;}if(k.parentNode!=this){apf.console.warn("Setting active page on page component which                               isn't a child of this tab component. Cancelling.");return false;}if(!k.visible||k.disabled){apf.console.warn("Setting active page on page component which                               is not visible or disabled. Cancelling.");return false;}if(i.tagName){i=g.position;this.activepage=k.name||i;}if(!j){var q={previous:this.activepage,previousId:this.activepagenr,previousPage:this.$activepage,next:i,nextId:g.position,nextpage:k};if(this.dispatchEvent("beforeswitch",q)===false){if(this.hideLoader){this.hideLoader();}return false;}}this.activepagenr=g.position;this.setProperty("activepagenr",g.position);if(this.$activepage){this.$activepage.$deactivate();}k.$activate();this.$activepage=k;if(this.hideLoader){if(k.$rendered!==false){this.hideLoader();}else{k.addEventListener("afterrender",function(){this.parentNode.hideLoader();});}}if(!j){if(k.$rendered!==false){this.dispatchEvent("afterswitch",q);}else{k.addEventListener("afterrender",function(){this.parentNode.dispatchEvent("afterswitch",q);});}}if(typeof s=="function"){s();}return true;};this.getPages=function(){var j=[],d=this.childNodes;for(var g=0,c=d.length;g<c;g++){if("page|case".indexOf(d[g].localName)>-1){j.push(d[g]);}}return j;};this.getPage=function(c){if(apf.isNot(c)){return this.$activepage;}else{return this.$findPage(c);}};this.add=function(c,d,g){var i=apf.document.createElement(g||"page");if(d){i.setAttribute("id",d);}if(c){i.setAttribute("caption",c);}this.appendChild(i);return i;};this.remove=function(c){var d=this.$findPage(c);if(!d){return false;}d.removeNode();return d;};this.addEventListener("DOMNodeRemoved",function(d){var c=d.currentTarget;if(d.$doOnlyAdmin||d.relatedNode!=this||c.localName!="page"){return;}if(this.firstChild==c&&c.nextSibling){c.nextSibling.$first();}if(this.lastChild==c&&c.previousSibling){c.previousSibling.$last();}if(this.$activepage==c){if(c.nextSibling||c.previousSibling){this.set(c.nextSibling||c.previousSibling);}else{this.$activepage=this.activepage=this.activepagenr=null;}}this.setProperty("length",this.childNodes.length);});this.addEventListener("DOMNodeInserted",function(i){var c=i.currentTarget;if(c.localName!="page"||i.relatedNode!=this||c.nodeType!=1){return;}if(!i.$beforeNode){var d;if(d=this.lastChild){if(d.nodeType!=1){d=d.previousSibling;}if(d){d.$last(true);}}c.$last();}if(!this.firstChild||i.$beforeNode==this.firstChild){if(this.firstChild){this.firstChild.$first(true);}c.$first();}if(this.$activepage){var g={};this.$findPage(this.$activepage,g);if(this.activepagenr!=g.position){if(parseInt(this.activepage)==this.activepage){this.activepage=g.position;this.setProperty("activepage",g.position);}this.activepagenr=g.position;this.setProperty("activepagenr",g.position);}}else{if(!this.$activepage){this.set(c);}}this.setProperty("length",this.childNodes.length);});this.$findPage=function(n,q){var k,d=this.childNodes;for(var j=0,g=0,c=d.length;g<c;g++){k=d[g];if("page|case".indexOf(k.localName)>-1&&(j++==n||(n.localName&&k||k.name)==n)){if(q){q.position=j-1;}return k;}}return null;};this.$enable=function(){var d=this.childNodes;for(var g=0,c=d.length;g<c;g++){if(d[g].enable){d[g].enable();}}};this.$disable=function(){var d=this.childNodes;for(var g=0,c=d.length;g<c;g++){if(d[g].disable){d[g].disable();}}};this.addEventListener("keydown",function(g){if(!this.$hasButtons){return;}var d,c=g.keyCode;switch(c){case 9:break;case 13:break;case 32:break;case 37:d=this.getPage().previousSibling;while(d&&(d.nodeType!=1||"page|case".indexOf(d.localName)==-1||!d.visible)){d=d.previousSibling;}if(d){this.setProperty("activepage",d);}break;case 39:d=this.getPage().nextSibling;while(d&&(d.nodeType!=1||"page|case".indexOf(d.localName)==-1||!d.visible)){d=d.nextSibling;}if(d){this.setProperty("activepage",d);}break;default:return;}},true);this.$loadChildren=function(t){var s=false,c=this,n,k,d,q,g;this.inited=true;if(this.$hasButtons){this.$buttons=this.$getLayoutNode("main","buttons",this.$ext);this.$buttons.setAttribute("id",this.$uniqueId+"_buttons");}this.oPages=this.$getLayoutNode("main","pages",this.$ext);if(this.$int){this.$int=this.oPages;s=true;g=this.childNodes;for(n=0;n<g.length;n++){q=g[n];if(q.nodeType!=1){continue;}q.$draw(true);if(q.$skinchange){q.$skinchange();}q.$loadAml();}}else{this.$int=this.oPages;g=this.childNodes;for(k=0,n=0,d=g.length;n<d;n++){if("page|case".indexOf((q=g[n]).localName)>-1){if(k++==0){q.$first();}if(k==d){q.$last();}}}}if(q){this.activepage=(typeof this.activepage!="undefined"?this.activepage:this.activepagenr)||0;s=this.getPage(this.activepage);if(s.render!="runtime"||s.$rendered){this.$propHandlers.activepage.call(this,this.activepage);}}else{this.isPages=false;}this.setProperty("length",k);this.ready=true;if(!this.activepage&&this.getAttribute("src")){this.src=this.getAttribute("src");this.$propHandlers.activepage.call(this);}};this.$destroy=function(c){if(c||!this.oScroller){return;}};}).call(apf.BaseTab.prototype=new apf.Presentation());apf.__XFORMS__=1<<17;apf.__FOCUSSABLE__=1<<26;apf.Focussable=function(){this.$regbase=this.$regbase|apf.__FOCUSSABLE__;this.setTabIndex=function(c){apf.window.$removeFocus(this);apf.window.$addFocus(this,c);return this;};this.focus=function(c,g,d){if(!c){if(this.$isWindowContainer>-1){apf.window.$focusLast(this,g,true);}else{apf.window.$focus(this,g);if(!d&&apf.hasFocusBug){apf.window.$focusfix();}}return this;}if(this.$focus&&!this.editable){this.$focus(g);}this.dispatchEvent("focus",apf.extend({bubbles:true},g));return this;};this.blur=function(c,d){if(apf.popup.isShowing(this.$uniqueId)){apf.popup.forceHide();}if(this.$blur){this.$blur(d);}if(!c){apf.window.$blur(this);}this.dispatchEvent("blur",apf.extend({bubbles:!d||!d.cancelBubble},d));return this;};this.hasFocus=function(){return apf.document.activeElement==this||this.$isWindowContainer&&(apf.document.activeElement||{}).$focusParent==this;};};apf.__MEDIA__=1<<20;apf.BaseSimple=function(){this.$init(true);};(function(){this.implement(apf.DataAction);this.getValue=function(){return this.value;};}).call(apf.BaseSimple.prototype=new apf.StandardBinding());apf.__ALIGNMENT__=1<<29;apf.BaseTree=function(){this.$init(true);this.$dynCssClasses=[];this.$nodes=[];};(function(){this.implement(apf.Rename,apf.DataAction,apf.K);this.$isTreeArch=true;this.$focussable=true;this.multiselect=false;this.bufferselect=true;this.startcollapsed=true;this.$animType=apf.tween.NORMAL;this.$animOpenStep=3;this.$animCloseStep=1;this.$animSpeed=10;var c=1<<1,g=1<<2,i=1<<3,n=1<<4;var d=this.$treeState={};this.$treeState[0]="";this.$treeState[c]="min";this.$treeState[c|g]="plus";this.$treeState[i]="last";this.$treeState[i|c]="minlast";this.$treeState[i|c|g]="pluslast";this.$treeState[n]="root";this.$booleanProperties.openadd=true;this.$booleanProperties.startcollapsed=true;this.$booleanProperties.nocollapse=true;this.$booleanProperties.singleopen=true;this.$booleanProperties.prerender=true;this.$booleanProperties.removecontainer=true;this.$supportedProperties.push("openadd","startcollapsed","nocollapse","singleopen","prerender","removecontainer");this.openadd=true;this.startcollapsed=1;this.prerender=true;this.expandAll=function(){if(!this.xmlRoot){return;}var s=this.each.split("|").join("["+this.each.replace(/\|/g," or ")+"]|.//"),q=this;(function(w){var t=w.selectNodes(s);for(var u=0;u<t.length;u++){q.slideToggle(apf.xmldb.getHtmlNode(t[u],q),1,true);arguments.callee(t[u]);}})(this.xmlRoot);};this.collapseAll=function(){if(!this.xmlRoot){return;}var s=this.xmlRoot.selectNodes(".//"+this.each.split("|").join("["+this.each.replace(/\|/g," or ")+"]|.//"));for(var q=s.length-1;q>=0;q--){this.slideToggle(apf.xmldb.getHtmlNode(s[q],this),2,true);}};this.expandAndSelect=function(t){if(!this.xmlRoot){return;}var s=this;(function q(w){var u=s.getTraverseParent(w);if(u!=s.xmlRoot){q(u);}s.slideToggle(apf.xmldb.getHtmlNode(u,s),1,true);})(t);this.select(t);};this.selectPath=function(q){};this.slideToggle=function(u,t,s,w){if(this.nocollapse||w&&this.disabled){return;}if(!u){u=this.$selected;}var A=u.getAttribute(apf.xmldb.htmlIdTag);while(!A&&u.parentNode){A=(u=u.parentNode).getAttribute(apf.xmldb.htmlIdTag);}var q=this.$getLayoutNode("item","container",u);if(!q){return;}if(apf.getStyle(q,"display")=="block"){if(t==1){return;}u.className=u.className.replace(/min/,"plus");this.slideClose(q,apf.xmldb.getNode(u),s);}else{if(t==2){return;}u.className=u.className.replace(/plus/,"min");this.slideOpen(q,apf.xmldb.getNode(u),s);}};this.isCollapsed=function(q){return(apf.getStyle(this.$getLayoutNode("item","container",apf.xmldb.getHtmlNode(q,this)),"display")=="none");};var j={};this.slideOpen=function(s,w,t){if(!w){w=this.selected;}var A=apf.xmldb.findHtmlNode(w,this);if(!s){s=this.$findContainer(A);}if(!s.innerHTML&&!this.getTraverseNodes(w).length){return;}if(this.singleopen){var u=this.getTraverseParent(w),B=(u||this.xmlRoot).getAttribute(apf.xmldb.xmlIdTag);if(j[B]&&j[B][1]!=w&&this.getTraverseParent(j[B][1])==u){this.slideToggle(j[B][0],2);}j[B]=[A,w];}s.style.display="block";if(!this.prerender&&this.$hasLoadStatus(w,"potential")&&!s.innerHTML){this.$extend(w,s,t);return;}if(t||s.scrollHeight>1000){s.style.height="auto";s.style.overflow="visible";return;}var q=this;apf.tween.single(s,{type:"scrollheight",from:0,to:s.scrollHeight,anim:this.$animType,steps:this.$animOpenStep,interval:this.$animSpeed,onfinish:function(C){if(w&&q.$hasLoadStatus(w,"potential")){$setTimeout(function(){C.style.height=C.scrollHeight+"px";C.style.overflow="hidden";q.$extend(w,C);});C.style.height="auto";C.style.overflow="visible";}else{C.style.overflow="visible";C.style.height="auto";}}});};this.slideClose=function(q,t,s){if(this.nocollapse){return;}if(!t){t=this.selected;}if(this.singleopen){var w=(this.getTraverseParent(t)||this.xmlRoot).getAttribute(apf.xmldb.xmlIdTag);j[w]=null;}if(!q){var u=apf.xmldb.findHtmlNode(t,this);q=this.$findContainer(u);}q.style.height=q.offsetHeight;q.style.overflow="hidden";if(s){q.style.height=0;q.style.display="none";return;}apf.tween.single(q,{type:"scrollheight",from:q.scrollHeight,to:0,anim:this.$animType,steps:this.$animCloseStep,interval:this.$animSpeed,onfinish:function(A,B){A.style.display="none";}});};this.$add=function(s,H,q,D,G,C,N){if(this.$isTreeArch&&this.$needsDepth&&typeof N=="undefined"){var A=q;N=0;while(A!=this.xmlRoot){N++;A=A.parentNode;}}var w=this.$getBindRule("insert",s)?true:false,M=this.getTraverseNodes(s),L=M.length?true:false,I=w||L,F=this.$hasBindRule("collapsed")?(this.$getDataNode("collapsed",s)?true:false):(this.$hasBindRule("expanded")?(this.$getDataNode("expanded",s)?false:true):this.startcollapsed),t=(I?c:0)|(F&&I||w?g:0)|(C?i:0),B=this.$initNode(s,t,H,N),E=this.$getLayoutNode("item","container"),K;if(!F&&!this.nocollapse){E.setAttribute("style","overflow:visible;height:auto;display:block;");}var u,J=(!this.removecontainer||I);if(!I||w){E.setAttribute("style","display:none;");}if(!this.prerender){K=M.length;}if(I&&!this.prerender&&K>2&&F||w&&(!this.$hasLoadStatus(s)||this.$hasLoadStatus(s,"potential"))){this.$setLoading(s,E);}else{if(!L&&(u=this.$applyBindRule("empty",s))){this.$setEmptyMessage(E,u);}}if((!D||D==this.$container)&&q==this.xmlRoot&&!G){this.$nodes.push(B);if(!apf.isChildOf(B,E,true)&&J){this.$nodes.push(E);}this.$setStyleClass(B,"root");this.$setStyleClass(E,"root");}else{if(!D){D=apf.xmldb.findHtmlNode(s.parentNode,this);D=D?this.$getLayoutNode("item","container",D):this.$container;}if(D==this.$container){this.$setStyleClass(B,"root");this.$setStyleClass(E,"root");}if(!G&&this.getNextTraverse(s)){G=apf.xmldb.findHtmlNode(this.getNextTraverse(s),this);}if(G&&G.parentNode!=D){G=null;}if(D.style&&this.getTraverseNodes(s.parentNode).length==1){this.$removeEmptyMessage(D);}if(D.style){apf.insertHtmlNode(B,D,G);if(!apf.isChildOf(B,E,true)&&J){var E=apf.insertHtmlNode(E,D,G);}}else{D.insertBefore(B,G);if(!apf.isChildOf(D,E,true)&&J){D.insertBefore(E,G);}}if(D.style){if(!F&&this.openadd&&D!=this.$container&&D.style.display!="block"){this.slideOpen(D,q,true);}this.$fixItem(q,apf.xmldb.findHtmlNode(q,this));if(this.getNextTraverse(s,true)){this.$fixItem(this.getNextTraverse(s,true),apf.xmldb.findHtmlNode(this.getNextTraverse(s,true),this));}}}if((this.prerender||K<3||!F)&&(s.namespaceURI!=apf.ns.apf||s.localName!="item")){this.$addNodes(s,E,false,null,null,(N||0)+1);}return E;};this.$fill=function(){if(this.$useiframe){this.$pHtmlDoc=this.oDoc;}if(this.$useTable){apf.insertHtmlNodes(this.$nodes,this.$container,null,"<table class='records' cellpadding='0' cellspacing='0'><tbody>","</tbody></table>");}else{apf.insertHtmlNodes(this.$nodes,this.$container);}this.$nodes.length=0;};this.$getParentNode=function(q){return q?this.$getLayoutNode("item","container",q):this.$container;};this.$fixItem=function(F,D,C,E,u){if(!D){return;}if(C){var w;if(w=this.getNextTraverse(F,true)){this.$fixItem(w,this.$findHtmlNode(w.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId),null,true);}if(!this.emptyMessage&&F.parentNode.selectNodes(this.each).length==1){this.$fixItem(F.parentNode,this.$findHtmlNode(F.parentNode.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId),null,false,true);}}else{var s=this.$getLayoutNode("item","container",D),B=false;if(u){B=false;}else{if(this.getTraverseNodes(F).length>0){B=true;}else{if(this.$hasLoadStatus(F,"potential")){B=true;}else{B=false;}}}var t=B&&s.style.display!="block",A=this.getNextTraverse(F,null,E?2:1)?false:true,q=(B?c:0)|(t?g:0)|(A?i:0);this.$setStyleClass(this.$getLayoutNode("item","class",D),d[q],["min","plus","last","minlast","pluslast"]);this.$setStyleClass(this.$getLayoutNode("item","container",D),d[q],["min","plus","last","minlast","pluslast"]);if(this.$getLayoutNode("item","openclose",D)){this.$getLayoutNode("item","openclose",D).setAttribute("children",B);}if(!B&&s){s.style.display="none";}}};this.$deInitNode=function(s,u){var q=this.$getLayoutNode("item","container",u),t=u.parentNode;q.parentNode.removeChild(q);t.removeChild(u);if(this.$withContainer){u.parentNode.removeChild(u.nextSibling);}if(s.parentNode!=this.xmlRoot){this.$fixItem(s,u,true);}var w;if(!t.childNodes.length&&(w=this.$applyBindRule("empty",s))){this.$setEmptyMessage(t,w);}this.$fixItem(s,u,true);};this.$moveNode=function(C,B){if(!self.apf.debug&&!B){return;}var t;if(this.$hasLoadStatus(C.parentNode,"potential")){t=this.$getLayoutNode("item","container",B);B.parentNode.removeChild(B);t.parentNode.removeChild(t);this.$extend(C.parentNode);return;}var D=B.parentNode,s=apf.xmldb.findHtmlNode(C.parentNode,this),E=this.getNextTraverse(C),A=E?apf.xmldb.findHtmlNode(E,this):null,w=s?this.$getLayoutNode("item","container",s):this.$container;t=this.$getLayoutNode("item","container",B);if(w!=D&&this.getTraverseNodes(C.parentNode).length==1){this.$removeEmptyMessage(w);}w.insertBefore(B,A);if(t){w.insertBefore(t,A);}var u;if(!D.childNodes.length&&(u=this.$applyBindRule("empty",C))){this.$setEmptyMessage(D,u);}if(this.openadd&&s!=this.$container&&w.style.display!="block"){this.slideOpen(w,s,true);}this.$fixItem(C,B);var q=this.getTraverseParent(C);this.$fixItem(q,apf.xmldb.findHtmlNode(q,this));if(this.getNextTraverse(C,true)){this.$fixItem(this.getNextTraverse(C,true),apf.xmldb.findHtmlNode(this.getNextTraverse(C,true),this));}};this.$setLoading=function(t,s){this.$setLoadStatus(t,"potential");var q=this.getTraverseNodes(t).length;if(!q||q>20){this.$getNewContext("loading");apf.insertHtmlNode(this.$getLayoutNode("loading"),s);}};this.$removeLoading=function(q){if(!q){return;}this.$getLayoutNode("item","container",q).innerHTML="";};this.$extend=function(t,q,s){var w=this.$getBindRule("insert",t),u=w&&w.match?(w.cmatch||w.compile("match"))(t):t;if(w&&u){this.$setLoadStatus(t,"loading");if(w.get){this.getModel().$insertFrom(w.getAttribute("get"),{xmlNode:u,insertPoint:u,amlNode:this});}else{if(this.$applyBindRule("insert",t)){this.insert(data,{insertPoint:u});}}}else{if(!this.prerender){this.$setLoadStatus(t,"loading");this.$removeLoading(apf.xmldb.findHtmlNode(t,this));k.call(this,{action:"insert",xmlNode:t,result:this.$addNodes(t,q,true),anim:!s});}}};function k(t){if(t.action=="move-away"){this.$fixItem(t.xmlNode,apf.xmldb.findHtmlNode(t.xmlNode,this),true);}if(t.action!="insert"){return;}var s=this.$findHtmlNode(t.xmlNode.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId);if(!s){return;}if(t.action=="insert"&&t.result.length>0){var q=this.$getLayoutNode("item","container",s);this.slideOpen(q,t.xmlNode);}else{this.$fixItem(t.xmlNode,s);}}this.addEventListener("xmlupdate",k);this.addEventListener("beforerename",function(){if(this.$tempsel){clearTimeout(this.timer);this.select(this.$tempsel);this.$tempsel=null;this.timer=null;}});this.addEventListener("keydown",function(L){var N=L.keyCode,w=L.ctrlKey,F=L.shiftKey,K=this.$caret||this.$selected,B,E,u,H,G,M,q,D;if(!K||this.renaming){return;}var s=this.caret||this.selected,t=this.$ext;switch(N){case 13:if(this.$tempsel){this.$selectTemp();}if(this.ctrlselect=="enter"){this.select(this.caret,true);}this.choose(K);break;case 32:if(this.$tempsel){this.$selectTemp();}if(this.$mode&&!w){var I=this.getSelection();if(!I.length||!this.multiselect){this.checkToggle(this.caret);}else{this.checkList(I,this.isChecked(this.selected),true);}}else{if(w||!this.isSelected(this.caret)){this.select(this.caret,true);}}return false;case 46:if(this.$tempsel){this.$selectTemp();}this.remove(this.caret);break;case 36:this.$setTempSelected(this.getFirstTraverseNode(),false,F);t.scrollTop=0;return false;case 35:var A=this.getLastTraverseNode();while(!this.isCollapsed(A)){A=this.getLastTraverseNode(A);}this.$setTempSelected(A,false,F,true);t.scrollTop=t.scrollHeight;return false;case 37:if(this.$tempsel){this.$selectTemp();}if(this.caret.selectSingleNode(this.each)&&!this.isCollapsed(this.caret)){this.slideToggle(this.$caret||this.$selected,2);}else{if(q=this.getTraverseParent(this.caret)){this.select(q);}}return false;case 107:case 187:case 39:if(this.$tempsel){this.$selectTemp();}if(this.$hasLoadStatus(this.caret,"potential")||this.getFirstTraverseNode(this.caret)){this.slideToggle(this.$caret||this.$selected,1);}break;case 109:case 189:if(this.getFirstTraverseNode(this.caret)){this.slideToggle(this.$caret||this.$selected,2);}break;case 38:if(!s&&!this.$tempsel){return;}H=this.$tempsel?apf.xmldb.getNode(this.$tempsel):s;M=this.getNextTraverse(H,true);if(M){G=this.getTraverseNodes(M);do{D=this.$getLayoutNode("item","container",this.$findHtmlNode(apf.xmldb.getID(M,this)));if(D&&apf.getStyle(D,"display")=="block"&&G.length){M=G[G.length-1];}else{break;}}while(M&&(G=this.getTraverseNodes(M)).length);}else{if(this.getTraverseParent(H)==this.xmlRoot){this.dispatchEvent("selecttop");return;}else{M=this.getTraverseParent(H);}}if(M&&M.nodeType==1){this.$setTempSelected(M,w,F,true);}else{return false;}K=apf.xmldb.findHtmlNode(M,this);E=apf.getAbsolutePosition(K,this.$container)[1]-(K.offsetHeight/2);if(E<=t.scrollTop){t.scrollTop=E;}return false;case 40:if(!s&&!this.$tempsel){return;}H=this.$tempsel?apf.xmldb.getNode(this.$tempsel):s;M=this.getFirstTraverseNode(H);if(M){D=this.$getLayoutNode("item","container",this.$findHtmlNode(apf.xmldb.getID(H,this)));if(D&&apf.getStyle(D,"display")!="block"){M=null;}}while(!M){q=this.getTraverseParent(H);if(!q){break;}var J=0;G=this.getTraverseNodes(q);while(G[J]&&G[J]!=H){J++;}M=G[J+1];H=q;}if(M&&M.nodeType==1){this.$setTempSelected(M,w,F);}else{return false;}K=apf.xmldb.findHtmlNode(M,this);E=apf.getAbsolutePosition(K,this.$container)[1]+(K.offsetHeight/2);if(E>t.scrollTop+t.offsetHeight){t.scrollTop=E-t.offsetHeight;}return false;case 33:B=apf.getAbsolutePosition(this.$container);u=document.elementFromPoint(B[0]+this.$container.offsetWidth-2,B[1]+2);M=apf.xmldb.findXmlNode(u);if(M==this.selected){t.scrollTop-=t.offsetHeight-apf.getHeightDiff(t);u=document.elementFromPoint(B[0]+this.$container.offsetWidth-2,B[1]+2);M=apf.xmldb.findXmlNode(u);}this.select(M);K=apf.xmldb.findHtmlNode(M,this);E=apf.getAbsolutePosition(K,this.$container)[1]-(K.offsetHeight/2);if(E<=t.scrollTop){t.scrollTop=E;}break;case 34:B=apf.getAbsolutePosition(this.$container);u=document.elementFromPoint(B[0]+this.$container.offsetWidth-2,B[1]+this.$ext.offsetHeight-4);M=apf.xmldb.findXmlNode(u);if(M==this.selected){t.scrollTop+=t.offsetHeight-apf.getHeightDiff(t);u=document.elementFromPoint(B[0]+this.$container.offsetWidth-2,B[1]+this.$ext.offsetHeight-4);M=apf.xmldb.findXmlNode(u);}this.select(M);K=apf.xmldb.findHtmlNode(M,this);E=apf.getAbsolutePosition(K,this.$container)[1]+(K.offsetHeight/2);if(E>t.scrollTop+t.offsetHeight){t.scrollTop=E-t.offsetHeight;}break;default:if(this.celledit){if(!w&&!L.altKey&&(N>46&&N<112||N>123)){this.startRename(null,true);}return;}else{if(N==65&&w){this.selectAll();return false;}else{if(this.caption||(this.bindingRules||{})["caption"]){if(!this.xmlRoot){return;}if(!this.lookup||new Date().getTime()-this.lookup.date.getTime()>300){this.lookup={str:"",date:new Date()};}this.lookup.str+=String.fromCharCode(N);var G=this.getTraverseNodes();for(var C,J=0;J<G.length;J++){C=this.$applyBindRule("caption",G[J]);if(C&&C.substr(0,this.lookup.str.length).toUpperCase()==this.lookup.str){if(!this.isSelected(G[J])){if(this.mode=="check"){this.setCaret(G[J]);}else{this.select(G[J]);}}if(K){this.$container.scrollTop=K.offsetTop-(this.$container.offsetHeight-K.offsetHeight)/2;}return;}}return;}}}break;}},true);this.$getCaptionElement=function(){if(!this.$selected){return false;}var q=this.$getLayoutNode("item","caption",this.$selected);return q.nodeType==1?q:q.parentNode;};this.$calcSelectRange=function(t,q){var w=[],A=false,u=0,s=this.hasFeature(apf.__VIRTUALVIEWPORT__)?this.xmlRoot.selectNodes(this.$isTreeArch?this.each:".//"+this.each.split("|").join("|.//")):this.getTraverseNodes();for(;u<s.length;u++){if(s[u]==t){A=true;}if(A){w.push(s[u]);}if(s[u]==q){A=false;}}if(!w.length||A){w=[];for(A=false,u=s.length-1;u>=0;u--){if(s[u]==t){A=true;}if(A){w.push(s[u]);}if(s[u]==q){A=false;}}}return w;};this.$findContainer=function(q){return this.$getLayoutNode("item","container",q);};this.$selectDefault=function(t){if(this.select(this.getFirstTraverseNode(t),null,null,null,true)){return true;}else{var q=this.getTraverseNodes(t);for(var s=0;s<q.length;s++){if(this.$selectDefault(q[s])){return true;}}}};this.$setEmptyMessage=function(u,w){this.$getNewContext("empty");var s=this.$getLayoutNode("empty");if(!s){return;}var t=apf.insertHtmlNode(s,u);var q=this.$getLayoutNode("empty","caption",t);if(q){apf.setNodeValue(q,w||"");}if(u.style){this.slideOpen(u,null,true);}else{u.setAttribute("style","overflow:visible;height:auto;display:block;");}};this.$removeEmptyMessage=function(s){var q=s.firstChild;if(!q){return;}do{if(q.className=="message"){s.removeChild(q);return;}q=q.nextSibling;}while(q);};this.$drawBase=function(){this.$ext=this.$getExternal();this.$container=this.$getLayoutNode("main","container",this.$ext);this.opencloseaction=this.$getOption("main","openclose");if(apf.hasCssUpdateScrollbarBug&&!this.mode){this.$fixScrollBug();}var q=this;this.$ext.onclick=function(s){q.dispatchEvent("click",{htmlEvent:s||event});};};this.addEventListener("DOMNodeInsertedIntoDocument",function(){if(this.nocollapse){this.startcollapsed=false;}else{if(this.startcollapsed===1){this.startcollapsed=!apf.isFalse(this.$getOption("main","startcollapsed"));}}});this.addEventListener("DOMNodeRemovedFromDocument",function(){this.$ext.onclick=null;apf.destroyHtmlNode(this.oDrag);this.oDrag=null;});}).call(apf.BaseTree.prototype=new apf.MultiSelect());apf.__TRANSACTION__=1<<3;apf.BaseList=function(){this.$init(true);this.$dynCssClasses=[];this.listNodes=[];};(function(){this.implement(apf.DataAction,apf.K);this.$focussable=true;this.$isWindowContainer=-1;this.multiselect=true;this.mode="normal";this.$propHandlers.fill=function(c){if(c){this.loadFillData(this.getAttribute("fill"));}else{this.clear();}};this.$keyHandler=function(t){var E=t.keyCode,d=t.ctrlKey,A=t.shiftKey,w=this.$selected||this.$caret;if(t.returnValue==-1||!w||this.renaming){return;}var C=this.caret||this.selected,g=this.$ext,j,k,u,F,B,s,q;switch(E){case 13:if(this.$tempsel){this.$selectTemp();}if(this.ctrlselect=="enter"){this.select(this.caret,true);}this.choose(this.selected);break;case 32:if(d||this.mode!="normal"||!this.isSelected(this.caret)){this.select(this.caret,d);}break;case 109:case 46:if(this.disableremove){return;}if(this.$tempsel){this.$selectTemp();}this.remove(this.mode!="normal"?this.caret:null);break;case 36:if(this.hasFeature(apf.__VIRTUALVIEWPORT__)){this.viewport.change(0,null,true,true);}this.select(this.getFirstTraverseNode(),false,A);this.$container.scrollTop=0;break;case 35:if(this.hasFeature(apf.__VIRTUALVIEWPORT__)){this.viewport.change(this.viewport.length,null,true,true);}this.select(this.getLastTraverseNode(),false,A);this.$container.scrollTop=this.$container.scrollHeight;break;case 107:if(this.more){this.startMore();}break;case 37:if(!C&&!this.$tempsel){return;}j=this.$tempsel?apf.xmldb.getNode(this.$tempsel):C;k=apf.getBox(apf.getStyle(w,"margin"));u=w.offsetWidth?Math.floor((g.offsetWidth-(B?15:0))/(w.offsetWidth+k[1]+k[3])):1;k=apf.getBox(apf.getStyle(w,"margin"));j=this.getNextTraverseSelected(j,false);if(j){this.$setTempSelected(j,d,A,true);}else{return;}w=apf.xmldb.findHtmlNode(j,this);if(w.offsetTop<g.scrollTop){g.scrollTop=Array.prototype.indexOf.call(this.getTraverseNodes(),j)<u?0:w.offsetTop-k[0];}break;case 38:if(!C&&!this.$tempsel){return;}j=this.$tempsel?apf.xmldb.getNode(this.$tempsel):C;k=apf.getBox(apf.getStyle(w,"margin"));B=g.scrollHeight>g.offsetHeight;u=w.offsetWidth?Math.floor((g.offsetWidth-(B?15:0))/(w.offsetWidth+k[1]+k[3])):1;j=this.getNextTraverseSelected(j,false,u);if(j){this.$setTempSelected(j,d,A,true);}else{return;}w=apf.xmldb.findHtmlNode(j,this);if(w.offsetTop<g.scrollTop){g.scrollTop=Array.prototype.indexOf.call(this.getTraverseNodes(),j)<u?0:w.offsetTop-k[0];}break;case 39:if(!C&&!this.$tempsel){return;}j=this.$tempsel?apf.xmldb.getNode(this.$tempsel):C;k=apf.getBox(apf.getStyle(w,"margin"));j=this.getNextTraverseSelected(j,true);if(j){this.$setTempSelected(j,d,A);}else{return;}w=apf.xmldb.findHtmlNode(j,this);if(w.offsetTop+w.offsetHeight>g.scrollTop+g.offsetHeight){g.scrollTop=w.offsetTop-g.offsetHeight+w.offsetHeight+k[0];}break;case 40:if(!C&&!this.$tempsel){return;}j=this.$tempsel?apf.xmldb.getNode(this.$tempsel):C;k=apf.getBox(apf.getStyle(w,"margin"));B=g.scrollHeight>g.offsetHeight;u=w.offsetWidth?Math.floor((g.offsetWidth-(B?15:0))/(w.offsetWidth+k[1]+k[3])):1;j=this.getNextTraverseSelected(j,true,u);if(j){this.$setTempSelected(j,d,A);}else{return;}w=apf.xmldb.findHtmlNode(j,this);if(w.offsetTop+w.offsetHeight>g.scrollTop+g.offsetHeight){g.scrollTop=w.offsetTop-g.offsetHeight+w.offsetHeight+k[0];}break;case 33:if(!C&&!this.$tempsel){return;}j=this.$tempsel?apf.xmldb.getNode(this.$tempsel):C;k=apf.getBox(apf.getStyle(w,"margin"));q=g.scrollHeight>g.offsetHeight;s=g.scrollWidth>g.offsetWidth;u=Math.floor((g.offsetWidth-(q?15:0))/(w.offsetWidth+k[1]+k[3]));F=Math.floor((g.offsetHeight-(s?15:0))/(w.offsetHeight+k[0]+k[2]));j=this.getNextTraverseSelected(j,false,u*F);if(!j){j=this.getFirstTraverseNode();}if(j){this.$setTempSelected(j,d,A,true);}else{return;}w=apf.xmldb.findHtmlNode(j,this);if(w.offsetTop<g.scrollTop){g.scrollTop=Array.prototype.indexOf.call(this.getTraverseNodes(),j)<u?0:w.offsetTop-k[0];}break;case 34:if(!C&&!this.$tempsel){return;}j=this.$tempsel?apf.xmldb.getNode(this.$tempsel):C;k=apf.getBox(apf.getStyle(w,"margin"));q=g.scrollHeight>g.offsetHeight;s=g.scrollWidth>g.offsetWidth;u=Math.floor((g.offsetWidth-(q?15:0))/(w.offsetWidth+k[1]+k[3]));F=Math.floor((g.offsetHeight-(s?15:0))/(w.offsetHeight+k[0]+k[2]));j=this.getNextTraverseSelected(C,true,u*F);if(!j){j=this.getLastTraverseNode();}if(j){this.$setTempSelected(j,d,A);}else{return;}w=apf.xmldb.findHtmlNode(j,this);if(w.offsetTop+w.offsetHeight>g.scrollTop+g.offsetHeight){g.scrollTop=w.offsetTop-g.offsetHeight+w.offsetHeight+k[0];}break;default:if(E==65&&d){this.selectAll();}else{if(this.$hasBindRule("caption")){if(!this.xmlRoot||this.autorename){return;}if(!this.lookup||new Date().getTime()-this.lookup.date.getTime()>300){this.lookup={str:"",date:new Date()};}this.lookup.str+=String.fromCharCode(E);var c=this.getTraverseNodes();for(var D,n=0;n<c.length;n++){D=this.$applyBindRule("caption",c[n]);if(D&&D.substr(0,this.lookup.str.length).toUpperCase()==this.lookup.str){if(!this.isSelected(c[n])){if(this.mode=="check"){this.setCaret(c[n]);}else{this.select(c[n]);}}if(w){this.$container.scrollTop=w.offsetTop-(this.$container.offsetHeight-w.offsetHeight)/2;}return;}}return;}}break;}this.lookup=null;return false;};this.$deInitNode=function(c,d){if(!d){return;}d.parentNode.removeChild(d);};this.$updateNode=function(g,k,i){var d=this.$getLayoutNode("item","icon",k);if(d){if(d.nodeType==1){d.style.backgroundImage="url("+apf.getAbsolutePath(this.iconPath,this.$applyBindRule("icon",g))+")";}else{d.nodeValue=apf.getAbsolutePath(this.iconPath,this.$applyBindRule("icon",g));}}else{var j=this.$getLayoutNode("item","image",k);if(j){if(j.nodeType==1){j.style.backgroundImage="url("+apf.getAbsolutePath(apf.hostPath,this.$applyBindRule("image",g))+")";}else{j.nodeValue=apf.getAbsolutePath(apf.hostPath,this.$applyBindRule("image",g));}}}var n=this.$getLayoutNode("item","caption",k);if(n){if(n.nodeType==1){if(!this.$cbindings.caption||!this.$cbindings.caption.hasAml){n.innerHTML=this.$applyBindRule("caption",g);}}else{n.nodeValue=this.$applyBindRule("caption",g);}}k.title=this.$applyBindRule("title",g)||"";var c=this.$applyBindRule("css",g);if(c||this.$dynCssClasses.length){this.$setStyleClass(k,c,this.$dynCssClasses);if(c&&!this.$dynCssClasses.contains(c)){this.$dynCssClasses.push(c);}}if(!i&&this.$updateModifier){this.$updateModifier(g,k);}};this.$moveNode=function(i,j){if(!j){return;}var c=j.parentNode;var g=this.getNextTraverse(i);var d=g?apf.xmldb.findHtmlNode(g,this):null;c.insertBefore(j,d);};this.$add=function(A,n,t,B,u){this.$getNewContext("item");var k=this.$getLayoutNode("item"),i=this.$getLayoutNode("item","select"),s=this.$getLayoutNode("item","icon"),d=this.$getLayoutNode("item","image"),w=this.$getLayoutNode("item","caption");k.setAttribute("id",n);i.setAttribute("onmouseover","var o = apf.lookup("+this.$uniqueId+"); o.$setStyleClass(this, 'hover', null, true);");i.setAttribute("onselectstart","return false;");i.setAttribute("style",(i.getAttribute("style")||"")+";user-select:none;-moz-user-select:none;-webkit-user-select:none;");if(this.hasFeature(apf.__RENAME__)||this.hasFeature(apf.__DRAGDROP__)){i.setAttribute("ondblclick","var o = apf.lookup("+this.$uniqueId+"); o.stopRename(); o.choose()");i.setAttribute("onmouseout","var o = apf.lookup("+this.$uniqueId+");            	  o.$setStyleClass(this, '', ['hover'], true);                this.hasPassedDown = false;");i.setAttribute(this.itemSelectEvent||"onmousedown","var o = apf.lookup("+this.$uniqueId+');                 var xmlNode = apf.xmldb.findXmlNode(this);                 var isSelected = o.isSelected(xmlNode);                 this.hasPassedDown = true;                 if (!o.renaming && o.hasFocus() && isSelected == 1)                     this.dorename = true;                 if (!o.hasFeature(apf.__DRAGDROP__) || o.mode != "normal" || !isSelected && !event.ctrlKey)                     o.select(this, event.ctrlKey, event.shiftKey, -1)');i.setAttribute("onmouseup","if (!this.hasPassedDown) return;                var o = apf.lookup("+this.$uniqueId+');if (o.hasFeature(apf.__RENAME__) && this.dorename && o.mode == "normal")                    o.startDelayedRename(event, null, true);this.dorename = false;                 var xmlNode = apf.xmldb.findXmlNode(this);                 var isSelected = o.isSelected(xmlNode);                 if (o.mode == "normal" && o.hasFeature(apf.__DRAGDROP__))                     o.select(this, event.ctrlKey, event.shiftKey, -1)');}else{i.setAttribute("onmouseout","apf.setStyleClass(this, '', ['hover']);");i.setAttribute("ondblclick","var o = apf.lookup("+this.$uniqueId+"); o.choose(null, true)");i.setAttribute(this.itemSelectEvent||"onmousedown","var o = apf.lookup("+this.$uniqueId+"); o.select(this, event.ctrlKey, event.shiftKey, -1)");}this.$listGrid=this.$getOption("main","list-mode")=="grid";if(this.$listGrid){k.setAttribute("onmouseover",k.getAttribute("onmouseover")+"var o = apf.lookup("+this.$uniqueId+");o.$selectSeries(event);");}if(s){if(s.nodeType==1){s.setAttribute("style","background-image:url("+apf.getAbsolutePath(this.iconPath,this.$applyBindRule("icon",A))+")");}else{s.nodeValue=apf.getAbsolutePath(this.iconPath,this.$applyBindRule("icon",A));}}else{if(d){if(d.nodeType==1){if((d.tagName||"").toLowerCase()=="img"){d.setAttribute("src",apf.getAbsolutePath(apf.hostPath,this.$applyBindRule("image",A)));}else{d.setAttribute("style","background-image:url("+apf.getAbsolutePath(apf.hostPath,this.$applyBindRule("image",A))+")");}}else{if(apf.isSafariOld){var g=d.ownerElement.parentNode,j=g.appendChild(g.ownerDocument.createElement("img"));j.setAttribute("src",apf.getAbsolutePath(apf.hostPath,this.$applyBindRule("image",A)));}else{d.nodeValue=apf.getAbsolutePath(apf.hostPath,this.$applyBindRule("image",A));}}}}if(w){if(w.nodeType==1&&this.$cbindings.caption&&this.$cbindings.caption.hasAml){var c=(this.$cbindings.queue||(this.$cbindings.queue={}));w.setAttribute("id","placeholder_"+this.$uniqueId+"_"+((c.caption||(c.caption=[])).push(A)-1));apf.setNodeValue(w,"");}else{apf.setNodeValue(w,this.$applyBindRule("caption",A));}}k.setAttribute("title",this.$applyBindRule("tooltip",A)||"");var C=this.$applyBindRule("css",A);if(C){this.$setStyleClass(k,C);if(C){this.$dynCssClasses.push(C);}}if(this.$addModifier){this.$addModifier(A,k);}if(B){apf.insertHtmlNode(k,B,u);}else{this.listNodes.push(k);}};this.$fill=function(){if(this.more&&!this.moreItem){this.$getNewContext("item");var d=this.$getLayoutNode("item"),g=this.$getLayoutNode("item","caption"),c=this.$getLayoutNode("item","select");d.setAttribute("class","more");c.setAttribute("onmousedown","var o = apf.lookup("+this.$uniqueId+');o.clearSelection();o.$setStyleClass(this, "more_down", null, true);');c.setAttribute("onmouseout","apf.lookup("+this.$uniqueId+').$setStyleClass(this, "", ["more_down"], true);');c.setAttribute("onmouseup","apf.lookup("+this.$uniqueId+").startMore(this, true)");if(g){apf.setNodeValue(g,this.more.match(/caption:(.*)(;|$)/i)[1]);}this.listNodes.push(d);}apf.insertHtmlNodes(this.listNodes,this.$container);this.listNodes.length=0;if(this.more&&!this.moreItem){this.moreItem=this.$container.lastChild;}};this.startMore=function(g,d){if(d&&this.disabled){return;}this.$setStyleClass(g,"",["more_down"]);var c;if(!this.$actions.add){if(this.each&&!this.each.match(/[\/\[]/)){c="<"+this.each+(this.each.match(/^a:/)?" xmlns:a='"+apf.ns.aml+"'":"")+" custom='1' />";}else{throw new Error(apf.formatErrorString(0,this,"Could not start more","No add action rule is defined for this component",this.$aml));return false;}}this.add(c,null,null,function(i){this.select(i,null,null,null,null,true);this.$container.appendChild(this.moreItem);var j=function(){this.getActionTracker().undo(this.autoselect?2:1);this.removeEventListener("stoprename",j);this.removeEventListener("beforerename",n);this.removeEventListener("afterrename",k);};var k=function(){this.removeEventListener("afterrename",k);};var n=function(s){this.removeEventListener("stoprename",j);this.removeEventListener("beforerename",n);var q=this.findXmlNodeByValue(s.args[1]);if(q||!s.args[1]){if(s.args[1]&&this.dispatchEvent("notunique",{value:s.args[1]})===false){this.startRename();this.addEventListener("stoprename",j);this.addEventListener("beforerename",n);}else{this.removeEventListener("afterrename",k);this.getActionTracker().undo();if(!this.isSelected(q)){this.select(q);}}return false;}};this.addEventListener("stoprename",j);this.addEventListener("beforerename",n);this.addEventListener("afterrename",k);this.startDelayedRename({},1);});};this.$calcSelectRange=function(g,c){var k=[],d=this.hasFeature(apf.__VIRTUALVIEWPORT__)?this.xmlRoot.selectNodes(this.each):this.getTraverseNodes(),n,j;for(n=false,j=0;j<d.length;j++){if(d[j]==g){n=true;}if(n){k.push(d[j]);}if(d[j]==c){n=false;}}if(!k.length||n){k=[];for(n=false,j=d.length-1;j>=0;j--){if(d[j]==g){n=true;}if(n){k.push(d[j]);}if(d[j]==c){n=false;}}}return k;};this.$selectDefault=function(c){this.select(this.getTraverseNodes()[0],null,null,null,true);};this.loadFillData=function(w){var u,c,k,q=w.splitSafe(","),t=[];for(var d,g,s=0;s<q.length;s++){if((g=q[s]).match(/^\d+-\d+$/)){d=g.split("-");c=parseInt(d[0]);k=parseInt(d[1]);if(d[0].length==d[1].length){u=Math.max(d[0].length,d[1].length);for(var n=c;n<k+1;n++){t.push("<item>"+(n+"").pad(u,"0")+"</item>");}}else{for(var n=c;n<k+1;n++){t.push("<item>"+n+"</item>");}}}else{t.push("<item>"+g+"</item>");}}this.$initingModel=true;this.each="item";this.$setDynamicProperty("caption","[label/text()|@caption|text()]");this.$setDynamicProperty("eachvalue","[value/text()|@value|text()]");this.$canLoadDataAttr=false;this.load("<data>"+t.join("")+"</data>");};}).call(apf.BaseList.prototype=new apf.MultiSelect());apf.__VIRTUALVIEWPORT__=1<<19;apf.BaseStateButtons=function(){this.state="normal";this.edit=false;this.animate=true;var k={min:["minimized","minimize","restore"],max:["maximized","maximize","restore"],edit:["edit","edit","closeedit"],close:["closed","close","show"]};this.$lastheight=null;this.$lastpos=null;this.$lastzindex=null;this.$lastState={normal:true};this.$booleanProperties.animate=true;this.$supportedProperties.push("buttons","animate","state");this.close=function(){this.setProperty("state",this.state.split("|").pushUnique("closed").join("|"),false,true);return this;};this.minimize=function(){this.setProperty("state",this.state.split("|").remove("maximized").remove("normal").pushUnique("minimized").join("|"),false,true);return this;};this.maximize=function(){this.setProperty("state",this.state.split("|").remove("minimized").remove("normal").pushUnique("maximized").join("|"),false,true);return this;};this.restore=function(){this.setProperty("state",this.state.split("|").remove("minimized").remove("maximized").pushUnique("normal").join("|"),false,true);return this;};this.edit=function(n){this.setProperty("state",this.state.split("|").pushUnique("edit").join("|"),false,true);return this;};this.closeedit=function(n){this.setProperty("state",this.state.split("|").remove("edit").join("|"),false,true);return this;};this.$toggle=function(n){var q=k[n][0];this[k[n][this.state.indexOf(q)>-1?2:1]]();};this.$propHandlers.refparent=function(n){if(typeof n=="string"){this.$refParent=self[n]&&self[n].$ext||document.getElementById(n);}else{this.$refParent=n;}};this.$propHandlers.state=function(F,G,M,w){var q=this;if(!this.$amlLoaded){apf.queue.add("state"+this.$uniqueId,function(){q.$propHandlers.state.call(q,F,G);});return;}var K,n,O,H,C,E={},D=F.split("|"),J=this.$lastState,B=[];for(K=0;K<D.length;K++){E[D[K]]=true;}E.value=F;if(!E.maximized&&!E.minimized){E.normal=true;}if(!w&&this.dispatchEvent("beforestatechange",{from:J,to:E})===false){this.state=J.value;return false;}if(E.closed==this.visible){this.setProperty("visible",!E.closed);}if(E.normal!=J.normal||!E.normal&&(E.minimized!=J.minimized||E.maximized!=J.maximized)){if(this.$lastheight){this.$ext.style.height=this.$lastheight;}if(this.$lastpos){if(this.animate&&!G){var A=this.$ext;O=apf.getStyle(A,"position");if(O!="absolute"){H=parseInt(apf.getStyle(A,"left"))||0;C=parseInt(apf.getStyle(A,"top"))||0;}else{H=A.offsetLeft;C=A.offsetTop;}this.animstate=1;apf.tween.multi(A,{steps:5,interval:10,tweens:[{type:"left",from:H,to:this.$lastpos.px[0]},{type:"top",from:C,to:this.$lastpos.px[1]},{type:"width",from:this.$ext.offsetWidth-j,to:this.$lastpos.px[2]},{type:"height",from:this.$ext.offsetHeight-d,to:this.$lastpos.px[3]}],oneach:function(){if(apf.hasSingleRszEvent){apf.layout.forceResize(q.$int);}},onfinish:function(){q.$propHandlers.state.call(q,F,true,null,true);}});return;}this.$ext.style.left=this.$lastpos.css[0];this.$ext.style.top=this.$lastpos.css[1];this.$ext.style.width=this.$lastpos.css[2];this.$ext.style.height=this.$lastpos.css[3];n=this.$lastpos.parentNode;n.style.width=this.$lastpos.parent[0];n.style.height=this.$lastpos.parent[1];n.style.overflow=this.$lastpos.parent[2];}if(this.aData&&this.aData.restore){this.aData.restore();}if(apf.layout){apf.layout.play(this.$pHtmlNode);}if(this.$lastzindex){this.$ext.style.zIndex=this.$lastzindex[0];if(this.oCover){this.oCover.style.zIndex=this.$lastzindex[1];}}this.$lastheight=this.$lastpos=this.$lastzindex=null;if(E.normal){B.push("",this.$baseCSSname+"Max",this.$baseCSSname+"Min");}}if(E.minimized!=J.minimized){if(E.minimized){B.unshift(this.$baseCSSname+"Min",this.$baseCSSname+"Max",this.$baseCSSname+"Edit");if(this.aData&&this.aData.minimize){this.aData.minimize(this.collapsedHeight);}if(!this.aData||!this.aData.minimize){this.$lastheight=apf.getStyle(this.$ext,"height");this.$ext.style.height=Math.max(0,this.collapsedHeight-apf.getHeightDiff(this.$ext))+"px";}if(this.hasFocus()){apf.window.moveNext(null,this,true);}}else{B.push(this.$baseCSSname+"Min");$setTimeout(function(){apf.window.$focusLast(q);});}}if(E.maximized!=J.maximized){if(E.maximized){B.unshift(this.$baseCSSname+"Max",this.$baseCSSname+"Min",this.$baseCSSname+"Edit");n=this.$refParent;if(!n){n=(this.$ext.offsetParent==document.body?document.documentElement:this.$ext.parentNode);}q.animstate=0;var N=false,A=this.$ext;var O=apf.getStyle(A,"position");if(O=="absolute"){n.style.overflow="hidden";H=A.offsetLeft;C=A.offsetTop;}else{var u=apf.getAbsolutePosition(A,n);H=u[0];C=u[1];}this.$lastpos={css:[this.$ext.style.left,this.$ext.style.top,this.$ext.style.width,this.$ext.style.height],px:[H,C,this.$ext.offsetWidth-j,this.$ext.offsetHeight-d],parent:[n.style.width,n.style.height,n.style.overflow],parentNode:n};var I=[A.offsetWidth,A.offsetHeight];function L(){var s=!apf.isIE&&n==document.documentElement?window.innerWidth:n.offsetWidth,t=!apf.isIE&&n==document.documentElement?window.innerHeight:n.offsetHeight;if(O!="absolute"){var R=apf.getDiff(n);s-=R[0]+(!q.$refParent&&apf.isIE8?4:0);t-=R[0]+(!q.$refParent&&apf.isIE8?4:0);}else{if(!q.$refParent&&apf.isIE8){s-=4;t-=4;}}var Q=q.$refParent?[0,0,0,0]:i,S=n!=A.offsetParent?apf.getAbsolutePosition(n,A.offsetParent):[0,0],P=apf.getDiff(n);n.style.width=(n.offsetWidth-P[0])+"px";n.style.height=(n.offsetHeight-P[1])+"px";if(q.animate&&!N){q.animstate=1;N=true;apf.tween.multi(A,{steps:5,interval:10,tweens:[{type:"left",from:H,to:S[0]-Q[3]},{type:"top",from:C,to:S[1]-Q[0]},{type:"width",from:I[0]-j,to:(s-j+Q[1]+Q[3])},{type:"height",from:I[1]-d,to:(t-d+Q[0]+Q[2])}],oneach:function(){if(apf.hasSingleRszEvent){apf.layout.forceResize(q.$int);}},onfinish:function(){q.animstate=0;q.dispatchEvent("afterstatechange",{from:J,to:E});}});}else{if(!q.animstate){A.style.left=(S[0]-Q[3])+"px";A.style.top=(S[1]-Q[0])+"px";A.style.width=(s-j+Q[1]+Q[3])+"px";A.style.height=(t-d+Q[0]+Q[2])+"px";}}}if(apf.layout){apf.layout.pause(this.$pHtmlNode,L);}this.$lastzindex=[this.$ext.style.zIndex||1,this.oCover&&this.oCover.style.zIndex||1];if(this.oCover){this.oCover.style.zIndex=apf.WinServer.count+1;}this.$ext.style.zIndex=apf.WinServer.count+2;}else{B.push(this.$baseCSSname+"Max");}}if(E.edit!=J.edit){if(E.edit){B.unshift(this.$baseCSSname+"Edit",this.$baseCSSname+"Max",this.$baseCSSname+"Min");if(this.btnedit){g.edit.innerHTML="close";}this.dispatchEvent("editstart");}else{if(this.dispatchEvent("editstop")===false){return false;}B.push(this.$baseCSSname+"Edit");if(B.length==1){B.unshift("");}if(this.btnedit){g.edit.innerHTML="edit";}}}if(B.length||E.closed!=J.closed){if(B.length){this.$setStyleClass(this.$ext,B.shift(),B);}if(E.edit){this.dispatchEvent("prop.visible",{value:true});if(q.oSettings){apf.layout.forceResize(q.oSettings);}}if(!E.maximized||J.maximized&&q.animate){q.dispatchEvent("afterstatechange",{from:J,to:E});}this.$lastState=E;if(this.aData&&!E.maximized){this.$purgeAlignment();}if(!this.animate&&apf.hasSingleRszEvent&&apf.layout){apf.layout.forceResize(q.$int);}}};var i,j,d,g={};this.$propHandlers.buttons=function(w){if(apf.isIphone){return;}if(!this.$hasLayoutNode("button")){return;}var t=w&&(w=w.replace(/(\|)\||\|$/,"$1")).split("|")||[],n=this.$buttons.childNodes,B=w&&new RegExp("("+w+")"),C={},A=[];for(var s=0;s<n.length;s++){if(n[s].nodeType!=1||n[s].tagName!="DIV"){continue;}if(n[s].getAttribute("button")&&(!w||!n[s].className||!n[s].className.match(B))){n[s].style.display="none";this.$setStyleClass(n[s],"",["min","max","close","edit"]);A.push(n[s]);}else{C[RegExp.$1]=n[s];}}for(s=0;s<t.length;s++){if(!t[s]){continue;}if(C[t[s]]){this.$buttons.insertBefore(C[t[s]],this.$buttons.firstChild);continue;}var q=A.pop();if(!q){this.$getNewContext("button");q=this.$getLayoutNode("button");q.setAttribute("button","button");c.call(this,q);q=apf.insertHtmlNode(q,this.$buttons);}this.$setStyleClass(q,t[s],["min","max","close","edit"]);q.onclick=new Function("apf.lookup("+this.$uniqueId+").$toggle('"+t[s]+"')");q.style.display="block";g[t[s]]=q;this.$buttons.insertBefore(q,this.$buttons.firstChild);}var u=apf.getDiff(this.$ext);j=u[0];d=u[1];i=apf.getBox(apf.getStyle(this.$ext,"borderWidth"));};function c(n){n.setAttribute("onmousedown","var o = apf.all["+this.$uniqueId+"]             o.$setStyleClass(this, 'down', null, true);             event.cancelBubble = true;              var o = apf.findHost(this).$ext;             if (o.onmousedown) o.onmousedown(event);             event.cancelBubble = true;             apf.window.$mousedown(event);");n.setAttribute("onmouseup","var o = apf.all["+this.$uniqueId+"]             o.$setStyleClass(this, '', ['down'], true)");n.setAttribute("onmouseover","var o = apf.all["+this.$uniqueId+"]             o.$setStyleClass(this, 'hover', null, true)");n.setAttribute("onmouseout","var o = apf.all["+this.$uniqueId+"]             o.$setStyleClass(this, '', ['hover', 'down'], true)");}this.$initButtons=function(u){this.collapsedHeight=this.$getOption("Main","collapsed-height");var t=this.$getLayoutNode("main","buttons",u);if(!t||apf.isIphone||!this.getAttribute("buttons")||!this.$hasLayoutNode("button")){return;}var n=(this.getAttribute("buttons")||"").split("|").length;for(var s,q=0;q<n;q++){this.$getNewContext("button");s=t.appendChild(this.$getLayoutNode("button"));s.setAttribute("button","button");c.call(this,s);}};this.addEventListener("DOMNodeRemovedFromDocument",function(q){for(var n in g){g[n].onclick=null;}});};apf.Teleport=function(){this.$init(true);};apf.__TELEPORT__=1<<28;(function(){this.$parsePrio="002";this.$regbase=this.$regbase|apf.__TELEPORT__;this.$booleanProperties.autoroute=true;this.$supportedProperties.push("url","timeout","protocol","route-server","autoroute");this.$propHandlers.url=function(d){var c=new apf.url(d);if(!c.protocol){throw new Error(apf.formatErrorString(0,this,"Communication (Teleport) initialization error","Invalid server url provided."));}this.$domain=c.host;this.$rootPath=c.path;this.$server=d.replace(new RegExp(this.$rootPath+"$"),"");};this.$propHandlers.timeout=function(c){this.timeout=parseInt(c)||10000;};this.$propHandlers.protocol=function(d){var c=d.toLowerCase();if(!apf[c]){throw new Error(apf.formatErrorString(1025,null,"Teleport baseclass","Could not find Ajax.org Teleport RPC Component '"+c+"'",this));}this.implement(apf[c]);};this.toString=function(){return"[Ajax.org Teleport Component : "+(this.name||"")+" ("+this.type+")]";};this.addEventListener("DOMNodeInsertedIntoDocument",function(){if(!apf.http){throw new Error(apf.formatErrorString(1024,null,"Teleport baseclass","Could not find Ajax.org Teleport HTTP Component",this.$aml));}this.implement(apf.http);if(this.id){apf.$asyncObjects[this.id]=1;}});}).call(apf.Teleport.prototype=new apf.AmlElement());apf.Init.run("teleport");apf.__INTERACTIVE__=1<<21;apf.Interactive=function(){var s,q,Z,X,d,M=null,Y,R,H,S,ah,A,N,ab,g,ad,c,C,j,G,Q,P,aa,u=this,ac,W,V,K,T,B,i;this.$regbase=this.$regbase|apf.__INTERACTIVE__;this.$propHandlers.draggable=function(w){if(apf.isFalse(w)){this.draggable=w=false;}else{if(apf.isTrue(w)){this.draggable=w=true;}}var ai=this.oDrag||this.$ext;if(ai.interactive&1){return;}var t=ai.onmousedown;ai.onmousedown=function(ak,aj){if(!u.editable&&t&&t.apply(this,arguments)===false){return;}if(!aj&&(ak||event).button==2){return;}k.apply(this,arguments);};ai.interactive=(ai.interactive||0)+1;};this.$propHandlers.resizable=function(ai){if(apf.isFalse(ai)){this.resizable=ai=false;}else{if(apf.isTrue(ai)){this.resizable=ai=true;}}var aj=this.oResize||this.$ext;if(aj.interactive&2){return;}if(!u.editable){var t=aj.onmousedown;var w=aj.onmousemove;aj.onmousedown=function(){if(t&&t.apply(this,arguments)===false){return;}L.apply(this,arguments);};aj.onmousemove=function(){if(w&&w.apply(this,arguments)===false){return;}F.apply(this,arguments);};}aj.interactive=(aj.interactive||0)+2;j=this.$getOption&&parseInt(this.$getOption("Main","resize-border"))||3;G=this.$getOption&&parseInt(this.$getOption("Main","resize-corner"))||12;Q=apf.getBox(apf.getStyle(this.$ext,apf.isIE?"borderWidth":"border-width"));};this.$cancelInteractive=function(){document.onmouseup(null,true);};function k(w,t){if(!w){w=event;}if(!t&&(!u.draggable||apf.dragMode)){return;}T=false;apf.dragMode=true;K=false;apf.popup.forceHide();ac="absolute|fixed".indexOf(apf.getStyle(u.$ext,"position"))>-1;if(!ac){u.$ext.style.position=ac?"absolute":"relative";}if(u.editable){ac=true;}if(ac&&!u.aData){apf.plane.show(T?oOutline:u.$ext);}var ai=ac?apf.getAbsolutePosition(u.$ext,u.$ext.offsetParent,true):[parseInt(apf.getStyle(u.$ext,"left"))||0,parseInt(apf.getStyle(u.$ext,"top"))||0];s=ai[0]-(W=w.clientX);q=ai[1]-(V=w.clientY);if(u.$ext.style.right){u.$ext.style.left=ai[0]+"px";u.$ext.style.right="";}if(u.$ext.style.bottom){u.$ext.style.top=ai[1]+"px";u.$ext.style.bottom="";}document.onmousemove=n;document.onmouseup=function(al,aj){document.onmousemove=document.onmouseup=null;if(ac&&!u.aData){apf.plane.hide();}var ak=T?oOutline:u.$ext;if(K){if(aj){Y=u.left;R=u.top;r=u.right;b=u.bottom;N=u.width;ab=u.height;}if(u.setProperty){U();}else{if(T){u.$ext.style.left=Y+"px";u.$ext.style.top=R+"px";}}}Y=R=N=ab=null;if(!ac){u.$ext.style.position="relative";}if(u.showdragging){apf.setStyleClass(u.$ext,"",["dragging"]);}if(ac&&T){oOutline.style.display="none";}apf.dragMode=false;if(u.dispatchEvent){u.dispatchEvent("afterdrag",{htmlNode:ak});}};if(t){document.onmousemove(w);}else{if(apf.isIE){apf.window.$mousedown(w);}}return false;}function n(aj){if(!aj){aj=event;}if(!K&&u.showdragging){apf.setStyleClass(u.$ext,"dragging");}var w=aj.clientX-W,t=aj.clientY-V,al;if(!K&&(al=w*w>t*t?w:t)*al<2){return;}else{if(!K){if(T&&oOutline.style.display!="block"){oOutline.style.display="block";}if(u.dispatchEvent&&u.dispatchEvent("beforedrag")===false){document.onmouseup();return;}}}var ai=T?oOutline:u.$ext;ai.style.left=(Y=aj.clientX+s)+"px";ai.style.top=(R=aj.clientY+q)+"px";if(u.realtime){var ak=u.$stick={};u.$showDrag(Y,R,ai,aj,ak);if(typeof ak.l!="undefined"){Y=ak.l,ai.style.left=Y+"px";}if(typeof ak.t!="undefined"){R=ak.t,ai.style.top=R+"px";}}K=true;}this.$resizeStart=L;function L(am,aj){if(!am){am=event;}if(!u.resizable||String(u.height).indexOf("%")>-1&&u.parentNode.localName=="vbox"||String(u.width).indexOf("%")>-1&&u.parentNode.localName=="hbox"){return;}B=false;if(!B){var al=apf.getDiff(u.$ext);aa=al[0];P=al[1];}d=apf.getAbsolutePosition(u.$ext);d.push(u.$ext.offsetWidth);d.push(u.$ext.offsetHeight);i=apf.getAbsolutePosition(u.$ext,u.$ext.offsetParent,true);var ai=0,w=0,t=(W=am.clientX)-d[0]+ai+document.documentElement.scrollLeft,an=(V=am.clientY)-d[1]+w+document.documentElement.scrollTop,ak;if(aj&&aj.resizeType){ac="absolute|fixed".indexOf(apf.getStyle(u.$ext,"position"))>-1;ak=aj.resizeType;}else{ak=O.call(u.$ext,t,an);}Z=t;X=an;if(!ak){return;}if(u.dispatchEvent&&u.dispatchEvent("beforeresize",{type:ak,setType:function(ao){ak=ao;}})===false){if(apf.isIE){apf.window.$mousedown(am);}return;}apf.popup.forceHide();apf.dragMode=true;K=false;g=ak.indexOf("w")>-1;ad=ak.indexOf("n")>-1;c=ak.indexOf("e")>-1;C=ak.indexOf("s")>-1;if(!u.minwidth){u.minwidth=0;}if(!u.minheight){u.minheight=0;}if(!u.maxwidth){u.maxwidth=10000;}if(!u.maxheight){u.maxheight=10000;}if(ac){H=i[0]+d[2];S=i[1]+d[3];ah=i[0]+d[2];A=i[1]+d[3];document.title=S+":"+A;}if(ac){apf.plane.show(B?oOutline:u.$ext);}if(u.$ext.style.right){u.$ext.style.left=i[0]+"px";}if(u.$ext.style.bottom){u.$ext.style.top=i[1]+"px";}if(!aj||!aj.nocursor){if(M===null){M=document.body.style.cursor;}document.body.style.cursor=ak+"-resize";}document.onmousemove=D;document.onmouseup=function(aq,ao){document.onmousemove=document.onmouseup=null;if(ac){apf.plane.hide();}clearTimeout(J);if(B){var ap=apf.getDiff(u.$ext);aa=ap[0];P=ap[1];}if(ao){Y=u.left;R=u.top;r=u.right;b=u.bottom;N=u.width;ab=u.height;}else{af(aq||event,true);}if(u.setProperty){U();}Y=R=N=ab=null;document.body.style.cursor=M;M=null;if(B){oOutline.style.display="none";}apf.dragMode=false;if(u.dispatchEvent){u.dispatchEvent("afterresize");}};if(apf.isIE){apf.window.$mousedown(am);}return false;}function U(aj,al,w,ap,am,ak){if(typeof aj=="undefined"){aj=Y,al=R,w=N,ap=ab,ak=P,am=aa;}var ao=u.left||u.left===0;var aq=u.right||u.right===0;var t=u.bottom||u.bottom===0;var ai=u.top||u.top===0;if(ac){var an=oOutline.style.display=="block"?oOutline:u.$ext;if(aq){u.setProperty("right",apf.getHtmlRight(an),0,u.editable);if(!u.left){an.style.left="";}}if(t){u.setProperty("bottom",apf.getHtmlBottom(an),0,u.editable);if(!u.top){an.style.top="";}}if((aj||aj===0)&&(!aq||ao)){u.setProperty("left",aj,0,u.editable);}if((al||al===0)&&(!t||ai)){u.setProperty("top",al,0,u.editable);}}if(w&&(!ao||!aq)){u.setProperty("width",w+am,0,u.editable);}if(ap&&(!u.top||!t)){u.setProperty("height",ap+ak,0,u.editable);}}this.$updateProperties=U;var ae=Math.min,E=Math.max,ag,J;function D(t){if(!t){t=event;}clearTimeout(J);if(ag&&new Date().getTime()-ag<(B?6:apf.mouseEventBuffer)){var w={clientX:t.clientX,clientY:t.clientY};J=setTimeout(function(){af(w);},10);return;}ag=new Date().getTime();af(t);}function af(ak,aj){var ai=B&&!aj?oOutline:u.$ext;var w=document.documentElement.scrollLeft,t=document.documentElement.scrollTop;if(g){if(ac){ai.style.left=(Y=E((ah-u.maxwidth),ae((H-u.minwidth),i[0]+ak.clientX-W+w)))+"px";}ai.style.width=(N=ae(u.maxwidth-aa,E(aa,u.minwidth,d[2]-(ak.clientX-W)+w)-aa))+"px";}if(ad){if(ac){ai.style.top=(R=E((A-u.maxheight),ae((S-u.minheight),i[1]+ak.clientY-V+t)))+"px";}ai.style.height=(ab=ae(u.maxheight-P,E(P,u.minheight,d[3]-(ak.clientY-V)+t)-P))+"px";}if(c){ai.style.width=(N=ae(u.maxwidth-aa,E(aa,u.minwidth,ak.clientX-d[0]+(d[2]-Z)+w)-aa))+"px";}if(C){ai.style.height=(ab=ae(u.maxheight-P,E(P,u.minheight,ak.clientY-d[1]+(d[3]-X)+t)-P))+"px";}if(u.parentNode&&u.parentNode.localName=="table"){U();apf.layout.processQueue();}if(u.realtime){var al=u.$stick={};u.$showResize(Y||apf.getHtmlLeft(ai),R||apf.getHtmlTop(ai),N&&N+aa||ai.offsetWidth,ab&&ab+P||ai.offsetHeight,ak,al,g,ad,c,C);if(g&&typeof al.l!="undefined"){ai.style.left=(Y=E((ah-u.maxwidth),ae((H-u.minwidth),al.l)))+"px";}if(ad&&typeof al.t!="undefined"){ai.style.top=(R=E((A-u.maxheight),ae((S-u.minheight),al.t)))+"px";}if(typeof al.w!="undefined"){ai.style.width=(N=ae(u.maxwidth-aa,E(aa,u.minwidth,al.w)-aa))+"px";}if(typeof al.h!="undefined"){ai.style.height=(ab=ae(u.maxheight-P,E(P,u.minheight,al.h)-P))+"px";}}if(apf.hasSingleRszEvent){apf.layout.forceResize(u.$int);}}function O(t,aj){var ai="",w="";ac="absolute|fixed".indexOf(apf.getStyle(u.$ext,"position"))>-1;if(u.resizable==true||u.resizable=="vertical"){if(aj<j+Q[0]){ai=ac?"n":"";}else{if(aj>this.offsetHeight-j){ai="s";}else{if(aj>this.offsetHeight-G){w="s";}}}}if(u.resizable==true||u.resizable=="horizontal"){if(t<(ai?G:j)+Q[0]){ai+=w+(ac?"w":"");}else{if(t>this.offsetWidth-(ai||w?G:j)){ai+=w+"e";}}}return ai;}var I;function F(aj){if(!aj){aj=event;}if(!u.resizable||u.editable||document.onmousemove){return;}var am=apf.getAbsolutePosition(u.$ext),ai=0,w=0,t=aj.clientX-am[0]+ai+document.documentElement.scrollLeft,al=aj.clientY-am[1]+w+document.documentElement.scrollTop;if(!I){I=apf.getStyle(this,"cursor");}var ak=O.call(u.$ext,t,al);this.style.cursor=ak?ak+"-resize":I||"default";}};apf.GuiElement.propHandlers.resizable=function(c){this.implement(apf.Interactive);this.$propHandlers.resizable.apply(this,arguments);};apf.GuiElement.propHandlers.draggable=function(c){this.implement(apf.Interactive);this.$propHandlers.draggable.apply(this,arguments);};apf.__DELAYEDRENDER__=1<<11;apf.DelayedRender=function(){this.$regbase=this.$regbase|apf.__DELAYEDRENDER__;this.$rendered=false;this.$render=function(d){if(this.$rendered){return;}if(this.dispatchEvent("beforerender")===false){return;}if(this["render-delay"]||d){$setTimeout("apf.lookup("+this.$uniqueId+").$renderparse()",10);}else{this.$renderparse();}};this.$renderparse=function(){if(this.$rendered){return;}var d=this.ownerDocument.$domParser;d.parseFromXml(this.$aml,{amlNode:this,doc:this.ownerDocument,delayedRender:true});d.$continueParsing(this);this.$rendered=true;this.dispatchEvent("afterrender");};var c;this.addEventListener("prop.visible",c=function(){if(arguments[0].value){this.$render();this.removeEventListener("prop.visible",c);}});};apf.GuiElement.propHandlers.render=function(c){if(!this.hasFeature(apf.__DELAYEDRENDER__)&&c=="runtime"){this.implement(apf.DelayedRender);if(this.localName!="page"){this.visible=false;this.$ext.style.display="none";}if(typeof this["render-delay"]=="undefined"){this.$setInheritedAttribute("render-delay");}}};apf.config.$inheritProperties["render-delay"]=1;apf.__DRAGDROP__=1<<5;apf.DragDrop=function(){this.$regbase=this.$regbase|apf.__DRAGDROP__;this.$dragInited=false;this.copy=function(n,s,k,j){if(n.nodeType){n=[n];}var g,t=[],q=0,d=n.length;for(;q<d;q++){t.push({action:j?"moveNode":"appendChild",args:[s,j?n[q]:n[q]=n[q].cloneNode(true),k]});}if(this.$actions[(j?"movegroup":"copygroup")]){g=this.$executeAction("multicall",t,(j?"movegroup":"copygroup"),n[0]);}else{g=this.$executeAction("multicall",t,(j?"move":"copy"),n[0],null,null,n.length>1?n:null);}if(g!==false){return n;}return false;};this.move=function(g,i,d){return this.copy(g,i,d,true);};this.isDragAllowed=function(i,q){if(this.disabled||!i||!i.length||!i[0]){return false;}if(this.drag||this.dragcopy){if(q){q.merge(i);}return true;}var s,g=[],n=0,k=i.length;for(;n<k;n++){s=this.$getDataNode("drag",i[n],null,g);if(!s){return false;}if(q){q.push(s);}}return g.length?g:false;};this.isDropAllowed=function(A,t){if(this.disabled||!A||!A.length||!t){return false;}var q,g,s=this.$attrBindings&&this.$attrBindings.drop;if(this.drop&&(!s||s.value=="true")){this.$setDynamicProperty("drop",this.hasFeature(apf.__MULTISELECT__)?"["+this.each+"]":"[node()]");s=true;}if(s){for(var k=0,d=A.length;k<d;k++){q=this.$getDataNode("drop",A[k]);if(!q){break;}}if(k==d&&t&&!apf.isChildOf(q,t,true)){return[t,null];}}var C=this.$bindings.drop;if(!C||!C.length){return false;}var w,B,n=0,u=C.length;for(;n<u;n++){w=this.$bindings.getRuleIndex("drop",n);for(var k=0,d=A.length;k<d;k++){q=w.cvalue?w.cvalue(A[k]):w.cmatch(A[k]);if(!q){break;}}if(k!=d){continue;}B=w.target;if(!B||B=="."){g=t;}else{g=(w.ctarget||w.compile("target"))(t);}if(g&&!apf.isChildOf(q,g,true)){return[g,w];}}return false;};this.$dragDrop=function(E,j,B,C,w,D,d){if(s=="tree-append"&&w){return false;}var s=B&&B.action;if(s){s=(B.caction||B.compile("action"))(j[0]);}else{s=C;}var g={internal:apf.DragServer.dragdata.host==this,ctrlKey:d.ctrlKey,keyCode:d.keyCode},u=B&&B.copy;if(u){u=!apf.isFalse((B.ccopy||B.compile("copy"))(j[0],g));}else{if(typeof this.dragcopy=="boolean"||typeof this.dropcopy=="boolean"){if(this.dropcopy){u=this.dropcopy;}else{if(this.dragcopy){u=d.ctrlKey;}else{var n=this.$attrBindings&&this.$attrBindings.dragcopy;if(n){u=!apf.isFalse((n.cvalue2||n.compile("value",{withopt:true}))(j[0],g));}}}}}if(!u){for(var t=0,k=D.length;t<k;t++){u=typeof D[t]=="object"&&D[t].copy?!apf.isFalse((D[t].ccopy||D[t].compile("copy"))(j[0],g)):d.ctrlKey;if(u){break;}}}var A,F=u?"copy":"move",q=B?B.getAttribute("parent"):null;switch(s){case"list-append":E=(w?E:this.getTraverseParent(E));if(q){if(E.selectSingleNode(q)){E=E.selectSingleNode(q);}else{E.appendChild(E.ownerDocument.createElement(q));E=E.selectSingleNode(q);}}A=this[F](j,E);break;case"insert-before":A=w?this[F](j,E):this[F](j,E.parentNode,E);break;case"tree-append":if(q){if(E.selectSingleNode(q)){E=E.selectSingleNode(q);}else{E.appendChild(E.ownerDocument.createElement(q));E=E.selectSingleNode(q);}}A=this[F](j,E);break;}if(this.selectable&&A){this.selectList(A);this.setCaret(A[0]);this.focus();}return A;};this.enableDragDrop=function(){apf.console.info("Initializing Drag&Drop for "+this.localName+"["+(this.name||"")+"]");this.icoAllowed="";this.icoDenied="";this.$ext.dragdrop=false;var d=this;this.$ext[apf.isIphone?"ontouchstart":"onmousedown"]=function(q){if(d.disabled){return;}q=q||window.event;if(apf.isIphone){if(q.touches.length==1){return;}var n=q;q=q.touches[0];var s=apf.getAbsolutePosition(q.target,this);q.offsetX=s[0];q.offsetY=s[1];}var k,i=q.originalTarget||q.srcElement||q.target,g=d.hasFeature(apf.__MULTISELECT__);if(g&&i==d.$container){return;}d.dragging=0;if(!apf.isIphone&&d.allowdeselect&&(i==this||i.getAttribute(apf.xmldb.htmlIdTag)&&d.$getLayoutNode("item","select",this)!=this)){return d.clearSelection();}if(d.$findValueNode){k=d.$findValueNode(i);}var j=(k?apf.xmldb.getNode(k):apf.xmldb.findXmlNode(i));if(g&&(!d.selected||!j||j==d.xmlRoot)){return;}if(d.isDragAllowed(g?d.$getSelection():j)){if(apf.isIphone){n.preventDefault();}apf.DragServer.start(d,i,q);}};this.$ext[apf.isIphone?"ontouchmove":"onmousemove"]=function(g){if(this.host.dragging!=1||d.disabled){return;}};if(apf.isIphone){this.$ext.ontouchend=this.$ext.ontouchcancel=function(){if(d.disabled){return;}this.host.dragging=0;};}else{this.$ext.onmouseup=function(){if(d.disabled){return;}this.host.dragging=0;};this.$ext.ondragcopy=this.$ext.ondragstart=function(){return false;};}if(document.elementFromPointAdd){document.elementFromPointAdd(this.$ext);}if(this.$initDragDrop&&!this.$dragInited){this.$initDragDrop();this.$dragInited=2;}else{this.$dragInited=true;}};function c(){this.$dragInited=false;if(apf.isIphone){this.$ext.ontouchstart=this.$ext.ontouchmove=this.$ext.ontouchend=this.$ext.ontouchcancel=null;}else{this.$ext.onmousedown=this.$ext.onmousemove=this.$ext.onmouseup=null;}if(document.elementFromPointRemove){document.elementFromPointRemove(this.$ext);}}this.implement(this.hasFeature(apf.__MULTISELECT__)?apf.MultiselectDragDrop:apf.StandardDragDrop);this.$supportedProperties.push("drop","drag","dragcopy");this.$propHandlers.dragcopy=this.$propHandlers.dropcopy=this.$propHandlers.drag=this.$propHandlers.drop=function(d,g){this[g]=apf.isTrue(d);if(this.$dragInited&&g=="drag"&&d&&this.$dragInited!=2){this.$initDragDrop();this.$dragInited=2;return;}if(g=="dragcopy"||g=="dropcopy"){return;}if(!d&&!this.drag&&!this.drop&&!this.$bindings&&(this.$attrBindings&&(!this.$attrBindings.drag||!this.$attrBindings.drop))){c.call(this);}else{if(d&&!this.$dragInited){this.enableDragDrop();}}};this.addEventListener("DOMNodeRemovedFromDocument",function(d){c.call(this);if(this.oDrag){apf.destroyHtmlNode(this.oDrag);this.oDrag=null;}});};apf.GuiElement.propHandlers.dragcopy=apf.GuiElement.propHandlers.dropcopy=apf.GuiElement.propHandlers.drop=apf.GuiElement.propHandlers.drag=function(c,d){if(!apf.isFalse(c)){if(!this.hasFeature(apf.__DRAGDROP__)){this.implement(apf.DragDrop);this.enableDragDrop();}this[d]=apf.isTrue(c);}};apf.DragServer={Init:function(){if(apf.isIphone){this.ontouchmove=this.onmousemove;this.ontouchend=this.ontouchcancel=this.onmouseup;}apf.addEventListener("hotkey",function(c){if(apf.window.dragging&&c.keyCode==27){if(document.body.lastHost&&document.body.lastHost.dragOut){document.body.lastHost.dragOut(apf.dragHost);}return apf.DragServer.stopdrag();}});},start:function(n,g,s){if(document.elementFromPointReset){document.elementFromPointReset();}n.dragging=1;var t=window.document;t=(!t.compatMode||t.compatMode=="CSS1Compat")?t.html||t.documentElement:t.body;var B=(apf.isIE?t.scrollLeft:window.pageXOffset),A=(apf.isIE?t.scrollTop:window.pageYOffset),c=n.$ext.offsetParent,u;while(c&&c!=t&&c.tagName!="BODY"){B-=c.scrollLeft;A-=c.scrollTop;c=c.offsetParent;}var k=g,j;while(k&&k.nodeType==1&&!(j=k.getAttribute(apf.xmldb.htmlIdTag))){k=k.parentNode;}if(!j){return;}u=apf.getAbsolutePosition(k);apf.DragServer.coordinates={srcElement:g,doc:t,scrollX:B,scrollY:A,offsetX:s.clientX-u[0],offsetY:s.clientY-u[1],clientX:s.pageX?s.pageX-window.pageXOffset:s.clientX,clientY:s.pageY?s.pageY-window.pageYOffset:s.clientY};var w=n.hasFeature(apf.__MULTISELECT__)?n.getSelection():[n.xmlRoot],q=[],i=n.isDragAllowed(w,q);if(!i){return;}if(n.hasEventListener("dragdata")){q=n.dispatchEvent("dragdata",{data:q});}this.dragdata={rules:i,selection:w,data:q,indicator:n.$showDragIndicator(w,this.coordinates),host:n};if(n.dispatchEvent("dragstart",this.dragdata)===false){return false;}n.dragging=2;apf.dragMode=true;document.onmousemove=this.onmousemove;document.onmouseup=this.onmouseup;},stop:function(c,d){if(this.last){this.dragout();}this.dragdata.host.dragging=0;this.dragdata.host.$hideDragIndicator(d);apf.dragMode=false;document.onmousemove=document.onmouseup=null;this.dragdata=null;},dragover:function(k,g,j){j=j||window.event;var i;if(k.$findValueNode){i=k.$findValueNode(g);}if(this.lastFel&&this.lastFel==i||!this.lastFel&&this.last==k){return;}var n=(i?apf.xmldb.getNode(i):apf.xmldb.findXmlNode(g)),c=k.isDropAllowed&&k.xmlRoot?k.isDropAllowed(this.dragdata.data,n||k.xmlRoot):apf.isTrue(apf.getInheritedAttribute(k,"",function(q){if(q.drop){k=q;if(k==apf.DragServer.last){return false;}return true;}}));if(this.last&&this.last!=k){this.dragout(this.last,j);}this.last=k;this.lastFel=i;if(!c){return;}if(k.dispatchEvent("dragover",this.dragdata)===false){c=false;}var d=j.originalTarget||j.srcElement||j.target;if(k&&k.$dragover){k.$dragover(g,this.dragdata,c);}},dragout:function(d,c){this.lastFel=null;if(d){this.dragdata.htmlEvent=c;d.dispatchEvent("dragout",this.dragdata);}if(this.last&&this.last.$dragout){this.last.$dragout(null,this.dragdata);}this.last=null;},dragdrop:function(c,d,u,q){var n,t,j=(c.$findValueNode?apf.xmldb.getNode(c.$findValueNode(d)):apf.xmldb.findXmlNode(d)),g=(c.isDropAllowed&&c.xmlRoot)?c.isDropAllowed(this.dragdata.data,j||c.xmlRoot):false;if(this.dragdata.indicator){t=this.dragdata.indicator.style.top;this.dragdata.indicator.style.top="10000px";}if(!g){g=apf.isTrue(apf.getInheritedAttribute(c,"",function(w){if(w.drop){c=w;return true;}}));}if(g){if(c.dispatchEvent("dragdrop",apf.extend({candrop:g,htmlEvent:q,top:t},this.dragdata))===false){g=false;}else{if(!c.xmlRoot){var i=c.getModel?c.getModel(true):apf.nameserver.get("model",c.model);if(i){i.load(this.dragdata.data[0]);}return true;}else{var k=g[1]&&g[1].action||(c.$isTreeArch?"tree-append":"list-append");if(k=="list-append"&&(!c.$isTreeArch&&c==this.dragdata.host)){g=false;}}}}if(this.dragdata.indicator){this.dragdata.indicator.style.top=t;}if(!g){this.dragout(c,q);return false;}if(c.$dragDrop){var s=c.$dragDrop(g[0],this.dragdata.data,g[1],k,n||g[0]==c.xmlRoot,this.dragdata.rules,q);this.dragdata.resultNode=s;}if(c.$dragdrop){c.$dragdrop(d,apf.extend({htmlEvent:q,xmlNode:s},this.dragdata),g);}this.last=null;this.lastFel=null;return true;},onmousemove:function(k){if(!apf.DragServer.dragdata){return;}k=k||window.event;if(apf.isIphone){k.preventDefault();if(!k.touches){return apf.DragServer.stop(true);}k=k.touches[0];}var g=apf.DragServer.dragdata,n={clientX:k.pageX?k.pageX-window.pageXOffset:k.clientX,clientY:k.pageY?k.pageY-window.pageYOffset:k.clientY};if(!g.started&&Math.abs(apf.DragServer.coordinates.clientX-n.clientX)<6&&Math.abs(apf.DragServer.coordinates.clientY-n.clientY)<6){return;}if(!g.started){if(g.host.$dragstart){g.host.$dragstart(null,g);}g.started=true;}var d=g.indicator.style.top;g.indicator.style.display="block";if(g.indicator){g.indicator.style.top="10000px";}apf.DragServer.dragdata.x=k.pageX?k.pageX-(apf.isGecko?window.pageXOffset:0):n.clientX;apf.DragServer.dragdata.y=k.pageY?k.pageY-(apf.isGecko?window.pageYOffset:0):n.clientY;var i=document.elementFromPoint(apf.DragServer.dragdata.x,apf.DragServer.dragdata.y);if(!i){i=document.elementFromPoint(apf.DragServer.dragdata.x,apf.DragServer.dragdata.y);}g.indicator.style.top=d;g.host.$moveDragIndicator(n);var j=apf.findHost(i);if(j){apf.DragServer.dragover(j,i,k);}else{if(apf.DragServer.last){apf.DragServer.dragout(apf.DragServer.last,k);}}apf.DragServer.lastTime=new Date().getTime();},onmouseup:function(k){k=k||window.event;if(apf.isIphone){k.preventDefault();if(!k.changedTouches){return apf.DragServer.stop(true);}k=k.changedTouches[0];}var q={clientX:k.pageX?k.pageX-window.pageXOffset:k.clientX,clientY:k.pageY?k.pageY-window.pageYOffset:k.clientY};if(!apf.DragServer.dragdata.started&&Math.abs(apf.DragServer.coordinates.clientX-q.clientX)<6&&Math.abs(apf.DragServer.coordinates.clientY-q.clientY)<6){apf.DragServer.stop(true);return;}var g=apf.DragServer.dragdata.indicator,d=g.style.top;if(g){g.style.top="10000px";}apf.DragServer.dragdata.x=k.pageX?k.pageX-(apf.isGecko?window.pageXOffset:0):q.clientX;apf.DragServer.dragdata.y=k.pageY?k.pageY-(apf.isGecko?window.pageYOffset:0):q.clientY;var i=document.elementFromPoint(apf.DragServer.dragdata.x,apf.DragServer.dragdata.y);if(!i){i=document.elementFromPoint(apf.DragServer.dragdata.x,apf.DragServer.dragdata.y);}g.style.top=d;var j=apf.findHost(i);if(apf.DragServer.host&&j!=apf.DragServer.host){apf.DragServer.dragout(apf.DragServer.host,k);}var n=apf.DragServer.dragdrop(j,i,apf.DragServer.dragdata.host,k);apf.DragServer.stop(true,n);}};apf.MultiselectDragDrop=function(){this.diffX=this.diffY=0;this.multiple=false;this.lastDragNode=null;this.lastel=null;this.$showDragIndicator=function(j,q){this.multiple=j.length>1;if(this.multiple){this.diffX=q.scrollX;this.diffY=q.scrollY;}else{this.diffX=-1*q.offsetX;this.diffY=-1*q.offsetY;}var g=this.oDrag.className.split(" ")[0];this.$setStyleClass(this.oDrag,this.multiple?g+"_multiple":"",[g+"_multiple"]);if(this.multiple){document.body.appendChild(this.oDrag);return this.oDrag;}else{if(this.localName=="datagrid"){if(this.lastDragNode){apf.destroyHtmlNode(this.lastDragNode);}j=this.$selected||this.$caret;var n=j.cloneNode(true);n.removeAttribute("onmousedown");n.onmousedown=null;n.removeAttribute("onmouseup");n.onmouseup=null;n.removeAttribute("onmouseout");n.onmouseout=null;n.removeAttribute("ondblclick");n.ondblclick=null;document.body.appendChild(n);n.style.position="absolute";n.style.width=j.offsetWidth+"px";n.style.display="none";n.style.zIndex=10000000;n.removeAttribute("id");this.$setStyleClass(n,"draggrid");var c=j.childNodes;var k=n.childNodes;for(var d=c.length-1;d>=0;d--){if(k[d].nodeType==1){k[d].style.width=apf.getStyle(c[d],"width");}}return(this.lastDragNode=n);}else{var j=this.$selected||this.$caret;this.oDrag.style.width=(j.offsetWidth-apf.getWidthDiff(this.oDrag))+"px";this.$updateNode(this.selected,this.oDrag);}}return this.oDrag;};this.$hideDragIndicator=function(g){var d=this.lastDragNode||this.oDrag,c=this;if(!this.multiple&&!g&&d.style.display=="block"){var i=apf.getAbsolutePosition(this.$selected||this.$caret);apf.tween.multi(d,{anim:apf.tween.EASEIN,steps:15,interval:10,tweens:[{type:"left",from:d.offsetLeft,to:i[0]},{type:"top",from:d.offsetTop,to:i[1]}],onfinish:function(){if(c.lastDragNode){apf.destroyHtmlNode(c.lastDragNode);c.lastDragNode=null;}else{c.oDrag.style.display="none";}}});}else{if(this.lastDragNode){apf.destroyHtmlNode(this.lastDragNode);this.lastDragNode=null;}else{this.oDrag.style.display="none";}}};this.$moveDragIndicator=function(d){var c=this.lastDragNode||this.oDrag;c.style.left=(d.clientX+this.diffX)+"px";c.style.top=(d.clientY+this.diffY+(this.multiple?15:0))+"px";};this.$initDragDrop=function(){if(!this.$hasLayoutNode("dragindicator")){return;}this.oDrag=apf.insertHtmlNode(this.$getLayoutNode("dragindicator"),document.body);this.oDrag.style.zIndex=10000000;this.oDrag.style.position="absolute";this.oDrag.style.cursor="default";this.oDrag.style.display="none";};this.$findValueNode=function(c){if(!c){return null;}while(c&&c.nodeType==1&&!c.getAttribute(apf.xmldb.htmlIdTag)){if(this.$isTreeArch&&c.previousSibling&&c.previousSibling.nodeType==1){c=c.previousSibling;}else{c=c.parentNode;}}return(c&&c.nodeType==1&&c.getAttribute(apf.xmldb.htmlIdTag))?c:null;};this.$dragout=function(k,d,c){if(this.lastel){this.$setStyleClass(this.lastel,"",["dragDenied","dragInsert","dragAppend","selected","indicate"]);}var n=this.$getSelection(true);for(var j=0,g=n.length;j<g;j++){this.$setStyleClass(n[j],"selected",["dragDenied","dragInsert","dragAppend","indicate"]);}this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Drop"]);this.lastel=null;};if(!this.$dragdrop){this.$dragdrop=this.$dragout;}this.$dragover=function(k,d,c){this.$setStyleClass(this.$ext,this.$baseCSSname+"Drop");var s=this.$getSelection(true);for(var j=0,g=s.length;j<g;j++){this.$setStyleClass(s[j],"",["dragDenied","dragInsert","dragAppend","selected","indicate"]);}if(this.lastel){this.$setStyleClass(this.lastel,"",["dragDenied","dragInsert","dragAppend","selected","indicate"]);}var q=c[1]&&c[1].action;this.lastel=this.$findValueNode(k);if(this.$isTreeArch&&q=="list-append"){var n=apf.xmldb.findHtmlNode(this.getTraverseParent(apf.xmldb.getNode(this.lastel)),this);this.lastel=n?this.$getLayoutNode("item","container",n):this.$container;this.$setStyleClass(this.lastel,"dragInsert");}else{this.$setStyleClass(this.lastel,c?(q=="insert-before"?"dragInsert":"dragAppend"):"dragDenied");}};};apf.StandardDragDrop=function(){this.$showDragIndicator=function(g,i){var c=i.offsetX+22,j=i.offsetY;this.oDrag.startX=c;this.oDrag.startY=j;document.body.appendChild(this.oDrag);var d=this.$getLayoutNode("main","caption",this.oDrag);if(d.nodeType!=1){d=d.parentNode;}d.innerHTML=this.$applyBindRule("caption",this.xmlRoot)||"";return this.oDrag;};this.$hideDragIndicator=function(){this.oDrag.style.display="none";};this.$moveDragIndicator=function(c){this.oDrag.style.left=(c.clientX-this.oDrag.startX+document.documentElement.scrollLeft)+"px";this.oDrag.style.top=(c.clientY-this.oDrag.startY+document.documentElement.scrollTop)+"px";};this.$initDragDrop=function(){if(!this.getAttribute("drag")){return;}this.oDrag=document.body.appendChild(this.$ext.cloneNode(true));this.oDrag.style.zIndex=1000000;this.oDrag.style.position="absolute";this.oDrag.style.cursor="default";this.oDrag.style.filter="progid:DXImageTransform.Microsoft.Alpha(opacity=50)";this.oDrag.style.MozOpacity=0.5;this.oDrag.style.opacity=0.5;this.oDrag.style.display="none";};};apf.DragServer.Init();apf.__MULTICHECK__=1<<22;apf.window=function(){this.$uniqueId=apf.all.push(this);this.apf=apf;this.toString=function(){return"[apf.window]";};this.getActionTracker=function(){return this.$at;};this.loadCodeFile=function(E){if(self[E]){apf.importClass(self[E],true,this.win);}else{apf.include(E);}};this.show=function(){if(apf.isDeskrun){k.Show();}};this.hide=function(){if(apf.isDeskrun){k.Hide();}else{this.loaded=false;if(this.win){this.win.close();}}};this.focus=function(){if(apf.isDeskrun){k.SetFocus();}else{window.focus();}};this.setIcon=function(E){if(apf.isDeskrun){k.icon=parseInt(E)==E?parseInt(E):E;}};this.setTitle=function(E){this.title=E||"";if(apf.isDeskrun){k.caption=E;}else{document.title=(E||"");}};this.loadAml=function(E){if(E[apf.TAGNAME]=="deskrun"){this.loadDeskRun(E);}};var k=apf.isDeskrun?window.external:null,u=apf.isDeskrun?k.shell:null;this.loadDeskRun=function(J){k.style=J.getAttribute("style")||"ismain|taskbar|btn-close|btn-max|btn-min|resizable";apf.config.drRegName=J.getAttribute("record");if(J.getAttribute("minwidth")){k.setMin(J.getAttribute("minwidth"),J.getAttribute("minheight"));}if(J.getAttribute("record")&&u.RegGet(apf.config.drRegName+"/window")){var I=u.RegGet(apf.config.drRegName+"/window");if(I){I=I.split(",");window.external.width=Math.max(J.getAttribute("minwidth"),Math.min(parseInt(I[2]),window.external.shell.GetSysValue("deskwidth")));window.external.height=Math.max(J.getAttribute("minheight"),Math.min(parseInt(I[3]),window.external.shell.GetSysValue("deskheight")));window.external.left=Math.max(0,Math.min(parseInt(I[0]),screen.width-window.external.width));window.external.top=Math.max(0,Math.min(parseInt(I[1]),screen.height-window.external.height));}}else{k.left=J.getAttribute("left")||200;k.top=J.getAttribute("top")||200;k.width=J.getAttribute("width")||800;k.height=J.getAttribute("height")||600;}k.caption=J.getAttribute("caption")||"DeskRun";k.icon=J.getAttribute("icon")||100;var G=$xmlns(J,"context",apf.ns.aml);if(G.length){G=G[0];if(!apf.config.tray){apf.config.tray=window.external.CreateWidget("trayicon");}var H=apf.config.tray;H.icon=J.getAttribute("tray")||100;H.tip=J.getAttribute("tooltip")||"DeskRun";H.PopupClear();H.PopupItemAdd("Exit",3);H.PopupItemAdd("SEP",function(){});var E=G.childNodes;for(var F=E.length-1;F>=0;F--){if(E[F].nodeType!=1){continue;}if(E[F][apf.TAGNAME]=="divider"){H.PopupItemAdd("SEP",function(){});}else{H.PopupItemAdd(apf.queryValue(E[F],"."),E[F].getAttribute("href")?new Function("window.open('"+E[F].getAttribute("href")+"')"):new Function(E[F].getAttribute("onclick")));}}}k.shell.debug=apf.debug?7:0;k.Show();k.SetFocus();};this.$tabList=[];this.$addFocus=function(F,G,E){if(!E){F.addEventListener("DOMNodeInserted",D);F.addEventListener("DOMNodeRemoved",s);if(F.$isWindowContainer>-2){F.addEventListener("focus",C);F.addEventListener("blur",C);F.$focusParent=F;if(F.$isWindowContainer>-1){if(!F.$tabList){F.$tabList=[F];}this.$tabList.push(F);return;}else{F.$tabList=[F];}}}var H=A(F),I=H.$tabList;if(I[G]){apf.console.warn("Aml node already exist for tabindex "+G+". Will insert "+F.tagName+" ["+(F.name||"")+"] before existing one");}if(!F.$isWindowContainer){F.$focusParent=H;}if(I[G]){I.insertIndex(F,G);}else{I.push(F);}};this.$removeFocus=function(E){if(!E.$focusParent){return;}E.$focusParent.$tabList.remove(E);if(!E.$isWindowContainer){E.removeEventListener("DOMNodeInserted",D);E.removeEventListener("DOMNodeRemoved",s);}if(E.$isWindowContainer>-2){E.removeEventListener("focus",C);E.removeEventListener("blur",C);}};var c;this.$focus=function(F,I,H){var E=this.document.activeElement;if(E==F&&!H){return;}var G=E==F;this.$settingFocus=F;if(!I){I={};}if(E&&E!=F&&c!=E){c=E;I.toElement=F;I.fromElement=E;E.blur(true,I);if(c!=E){return false;}}(apf.activeElement=this.document.activeElement=F).focus(true,I);this.$settingFocus=null;apf.dispatchEvent("movefocus",{toElement:F});if(!G){apf.console.info("Focus given to "+F.localName+" ["+(F.name||"")+"]");}};this.$blur=function(F){var E=this.document.activeElement;if(E!=F){return false;}apf.console.info(E.localName+" ["+(E.name||"")+"] was blurred.");E.$focusParent.$lastFocussed=null;apf.activeElement=this.document.activeElement=null;apf.dispatchEvent("movefocus",{fromElement:F});};var q;this.$focusDefault=function(E,G){var F=A(E);this.$focusLast(F,G);};this.$focusRoot=function(E){var F=apf.document.documentElement;if(this.$focusLast(F,E)===false){}};this.$focusLast=function(G,K,F){var E=G.$lastFocussed;if(E&&E.parentNode&&E.$focussable===true&&(F||E.$ext.offsetHeight)){this.$focus(E,K,true);}else{var H,J=G,I;while(J){if(!I&&J.focussable!==false&&J.$focussable===true&&!J.$tabList&&(F||J.$ext&&J.$ext.offsetHeight)&&!J.disabled){this.$focus(J,K,true);break;}if((H=!I&&J.firstChild||!(I=false)&&J.nextSibling)){J=H;if(J.$isWindowContainer>0){I=true;}}else{if(J==G){if(J.$isWindowContainer){this.$focus(J,K,true);}return;}else{do{J=J.parentNode;}while(J&&!J.nextSibling&&J!=G&&!J.$isWindowContainer);if(J==G){if(J.$isWindowContainer){this.$focus(J,K,true);}return;}if(J){if(J.$isWindowContainer){this.$focus(J,K,true);break;}J=J.nextSibling;}}}}if(!J){this.$focus(apf.document.documentElement);}}};function C(E){if(E.name=="blur"){if(E.srcElement!=this&&this.$blur){this.$blur();}return;}if(E.srcElement!=this&&this.$focus){this.$focus();}if(E.srcElement==this||E.trackedChild){E.trackedChild=true;return;}this.$lastFocussed=E.srcElement;if(this.localName.indexOf("window")>-1){E.trackedChild=true;}}function A(E){var F=E;do{F=F.parentNode;}while(F&&!F.$isWindowContainer);return F||apf.document.documentElement;}function D(E){if(E&&E.currentTarget!=this){return;}if(this.$isWindowContainer){apf.window.$tabList.pushUnique(this);}else{apf.window.$addFocus(this,this.tabindex,true);}}function s(E){if(E&&(E.currentTarget!=this||E.$doOnlyAdmin)){return;}if(apf.document.activeElement==this){apf.window.moveNext();}if(this.$isWindowContainer){apf.window.$tabList.remove(this);return;}if(!this.$focusParent){return;}this.$focusParent.$tabList.remove(this);}this.hasFocus=function(E){return this.document.activeElement==E;};this.moveNext=function(O,H,E,N){if(E&&apf.document.activeElement){var G=apf.document.activeElement.$focusParent;if(G.visible&&G.modal){return false;}}var J,F,L,I=H||apf.document.activeElement,K=I?(E&&I.$isWindowContainer>0?apf.window:I.$focusParent):apf.document.documentElement,M=K.$tabList;if(I&&(E||I!=apf.document.documentElement)){F=(M||[]).indexOf(I);if(F==-1){apf.console.warn("Moving focus from element which isn't in the list                                  of it's parent. This should never happen.");return;}}else{F=-1;}if(this.document.activeElement&&this.document.activeElement==I&&M.length==1||M.length==0){return false;}J=(O?-1:1);L=F;if(F<0){F=0;}do{L+=J;if(L>=M.length){L=0;}else{if(L<0){L=M.length-1;}}if(F==L&&I){if(M[0].$isWindowContainer){this.$focus(M[0],N);}return false;}I=M[L];}while(!I||I.disabled||I==apf.document.activeElement||(E?!I.visible:I.$ext&&!I.$ext.offsetHeight)||I.focussable===false||E&&!I.$tabList.length);if(K==apf.window){this.$focusLast(I,{mouse:true},E);}else{(N||(N={})).shiftKey=O;this.$focus(I,N);}};this.focusDefault=function(){if(this.moveNext()===false){this.moveNext(null,apf.document.documentElement,true);}};apf.addListener(window,"beforeunload",function(){return apf.dispatchEvent("exit");});apf.addListener(window,"unload",function(){if(!apf){return;}apf.window.isExiting=true;apf.window.destroy();});var i,g="",w="";this.$focusfix=function(){if(apf.isIphone){return;}g+="a";clearTimeout(i);$setTimeout("window.focus();");i=$setTimeout(d);};this.$focusfix2=function(){if(apf.isIphone){return;}g+="b";clearTimeout(i);i=$setTimeout(d);};this.$blurfix=function(){if(apf.isIphone){return;}g+="c";clearTimeout(i);i=$setTimeout(d);};function d(){clearTimeout(i);if(g=="e"||g=="c"||g.charAt(0)=="x"&&!g.match(/eb$/)||g=="ce"||g=="de"){if(w!="blur"){w="blur";apf.window.dispatchEvent("blur");}}else{if(w!="focus"){w="focus";apf.window.dispatchEvent("focus");}}g="";i=null;}apf.addListener(window,"focus",this.$focusevent=function(){if(apf.isIphone){return apf.window.dispatchEvent("focus");}if(apf.hasFocusBug){g+="d";clearTimeout(i);i=$setTimeout(d);}else{clearTimeout(B);j.newState="focus";B=$setTimeout(j,10);}});apf.addListener(window,"blur",this.$blurevent=function(){if(!apf){return;}if(apf.isIphone){return apf.window.dispatchEvent("blur");}if(apf.hasFocusBug){g+="e";clearTimeout(i);i=$setTimeout(d);}else{clearTimeout(B);j.newState="blur";B=$setTimeout(j,10);}});var B;function j(){clearTimeout(B);var E=j.newState;if(w==E){return;}w=E;apf.dispatchEvent(w);}this.hasFocus=function(){return(w=="focus");};apf.addListener(document,"contextmenu",function(G){if(!G){G=event;}var H,F,E=apf.findHost(G.srcElement||G.target)||apf.document.activeElement||apf.document&&apf.document.documentElement;if(E&&E.localName=="menu"){return false;}if(apf.contextMenuKeyboard){if(E){H=E.selected?apf.getAbsolutePosition(E.$selected):apf.getAbsolutePosition(E.$ext||E.$pHtmlNode);}else{H=[0,0];}F={x:H[0]+10+document.documentElement.scrollLeft,y:H[1]+10+document.documentElement.scrollTop,htmlEvent:G};}else{if(G.htmlEvent){F=G;}else{F={x:G.clientX+document.documentElement.scrollLeft,y:G.clientY+document.documentElement.scrollTop,htmlEvent:G};}}F.bubbles=true;apf.contextMenuKeyboard=null;if((E||apf).dispatchEvent("contextmenu",F)===false||F.returnValue===false){if(G.preventDefault){G.preventDefault();}return false;}if(apf.config.disableRightClick){if(G.preventDefault){G.preventDefault();}return false;}});var n={INPUT:1,TEXTAREA:1,SELECT:1};apf.addListener(document,"mousedown",this.$mousedown=function(J){J=J||window.event;var I,G=apf.findHost(J.srcElement||J.target),F=G&&G.$editable;if(apf.popup.last&&(!G||apf.popup.last!=G.$uniqueId)){apf.popup.forceHide();}if((!G||!G.$focussable||G.focussable===false)&&apf.config.allowBlur&&G.canHaveChildren!=2&&!G.$focusParent){q=null;if(apf.document.activeElement){apf.document.activeElement.blur();}}else{if(G){if((I=apf.document.activeElement&&apf.document.activeElement.$focusParent||q)&&I.visible&&I.modal&&G.$focusParent!=I){apf.window.$focusLast(I,{mouse:true,ctrlKey:J.ctrlKey});}else{if(!G&&apf.document.activeElement){apf.window.$focusRoot();}else{if(G.$isWindowContainer==-1){if(G.$tabList.length){apf.window.moveNext(null,G.$tabList[0],null,{mouse:true});}else{apf.window.$focus(G);}}else{if(!G.disabled&&G.focussable!==false){if(G.$focussable===apf.KEYBOARD_MOUSE){apf.window.$focus(G,{mouse:true,ctrlKey:J.ctrlKey});}else{if(G.canHaveChildren==2){if(!apf.config.allowBlur||!apf.document.activeElement||apf.document.activeElement.$focusParent!=G){apf.window.$focusLast(G,{mouse:true,ctrlKey:J.ctrlKey});}}else{apf.window.$focusDefault(G,{mouse:true,ctrlKey:J.ctrlKey});}}}else{apf.window.$focusDefault(G,{mouse:true,ctrlKey:J.ctrlKey});}}}}if(apf.hasFocusBug){var E=n[(J.srcElement||J.target).tagName]&&!(J.srcElement||J.target).disabled||(J.srcElement&&J.srcElement.isContentEditable)||G.$isContentEditable&&G.$isContentEditable(J)&&!G.disabled;if(!G||!E){apf.window.$focusfix();}}else{if(!w){apf.window.$focusevent();}}}}apf.dispatchEvent("mousedown",{htmlEvent:J,amlNode:G||apf.document.documentElement});if(apf.isIE||apf.isIphone){return;}var H=!((!apf.document&&(!apf.isParsingPartial||G)||apf.dragMode)&&!n[J.target.tagName]);if(H&&G){var E=n[(J.srcElement||J.target).tagName]&&!(J.srcElement||J.target).disabled||(J.srcElement&&J.srcElement.isContentEditable)||G.$isContentEditable&&G.$isContentEditable(J)&&!G.disabled;if(!E&&!apf.config.allowSelect&&G.nodeType!=G.NODE_PROCESSING_INSTRUCTION&&!G.$allowSelect&&(!G.$int||G.$focussable)){H=false;}}if(!H&&!F){if(J.preventDefault){J.preventDefault();}return false;}});apf.addListener(document,"selectstart",function(G){if(!G){G=event;}var F=!(!apf.document||apf.dragMode);var E=apf.findHost(G.srcElement);if(F){if(!apf.config.allowSelect&&E&&E.nodeType!=E.NODE_PROCESSING_INSTRUCTION&&!E.$allowSelect&&!E.$int){F=false;}}if(!F){G.returnValue=false;return false;}});apf.addListener(document,"keyup",this.$keyup=function(E){if(!E){E=event;}if(apf.document&&apf.document.activeElement&&!apf.document.activeElement.disableKeyboard&&apf.document.activeElement.dispatchEvent("keyup",{keyCode:E.keyCode,ctrlKey:E.ctrlKey,shiftKey:E.shiftKey,altKey:E.altkey,htmlEvent:E})===false){E.returnValue=false;return false;}apf.dispatchEvent("keyup",null,E);});function t(I){if(!I){I=event;}var K=null;if(I.wheelDelta){K=I.wheelDelta/120;if(apf.isOpera){K*=-1;}}else{if(I.detail){K=-I.detail/3;}}if(K!==null){if(apf.isIE){var G=I.srcElement||I.target;while(G&&G.scrollHeight<=G.offsetHeight){G=G.parentNode;}if(!G){return;}if(G.nodeType==9){G=G.documentElement;}if(G&&G.tagName=="BODY"&&"auto|scroll".indexOf(apf.getStyle(G,"overflowY"))==-1){G=document.documentElement;}if(G&&"auto|scroll".indexOf(apf.getStyle(G,"overflowY"))>-1){var E,J=0.35*G.offsetHeight*K;if(K<0){if(G&&G.scrollTop>=(E=G.scrollHeight-G.offsetHeight+apf.getVerBorders(G))+J){G.scrollTop=E;I.returnValue=false;}}else{if(G&&G.scrollTop<=J){G.scrollTop=0;I.returnValue=false;}}}}var H={delta:K,target:I.target||I.srcElement,button:I.button,ctrlKey:I.ctrlKey,shiftKey:I.shiftKey,altKey:I.altKey},F=apf.dispatchEvent("mousescroll",H);if(F===false||H.returnValue===false){if(I.preventDefault){I.preventDefault();}I.returnValue=false;}}}if(document.addEventListener){document.addEventListener("DOMMouseScroll",t,false);}window.onmousewheel=document.onmousewheel=t;apf.addListener(document,"keydown",this.$keydown=function(J){J=J||event;if(J.keyCode==120||J.ctrlKey&&J.altKey&&J.keyCode==68){apf.$debugwin.activate();}if(J.keyCode==93){apf.contextMenuKeyboard=true;}var G=apf.findHost(J.srcElement||J.target),F=n[(J.explicitOriginalTarget||J.srcElement||J.target).tagName]||(J.srcElement&&J.srcElement.isContentEditable);var L,K=apf.isMac?J.metaKey:J.ctrlKey;if(!F&&apf.config.undokeys&&K){if(J.keyCode==90){L=apf.document.activeElement;while(L&&!L.getActionTracker&&!L.$at){L=L.parentNode;}if(!L){L=apf.window;}(L.$at||L.getActionTracker()).undo();}else{if(J.keyCode==89){L=apf.document.activeElement;while(L&&!L.getActionTracker&&!L.$at){L=L.parentNode;}if(!L){L=apf.window;}(L.$at||L.getActionTracker()).redo();}}}var H={ctrlKey:J.ctrlKey,metaKey:J.metaKey,shiftKey:J.shiftKey,altKey:J.altKey,keyCode:J.keyCode,htmlEvent:J,bubbles:true};if(!F&&apf.dispatchEvent("hotkey",H)===false||H.returnValue===false){J.returnValue=false;J.cancelBubble=true;if(J.stopPropagation){J.stopPropagation();}if(apf.canDisableKeyCodes){try{J.keyCode=0;}catch(J){}}if(J.preventDefault){J.preventDefault();}return false;}delete H.currentTarget;if((apf.document.activeElement&&!apf.document.activeElement.disableKeyboard&&!apf.document.activeElement.editable&&apf.document.activeElement.dispatchEvent("keydown",H)||apf.dispatchEvent("keydown",H))===false){J.returnValue=false;J.cancelBubble=true;if(apf.canDisableKeyCodes){try{J.keyCode=0;}catch(J){}}if(J.preventDefault){J.preventDefault();}return false;}else{if((!apf.config.disableTabbing||apf.document.activeElement)&&J.keyCode==9){if(J.ctrlKey&&apf.document.activeElement){var E=apf.document.activeElement.$focusParent;if(E.modal){if(J.preventDefault){J.preventDefault();}return false;}apf.window.moveNext(J.shiftKey,apf.document.activeElement.$focusParent,true);E=apf.document.activeElement.$focusParent;if(E&&E.bringToFront){E.bringToFront();}}else{if(!apf.document.activeElement||apf.document.activeElement.tagName!="menu"){apf.window.moveNext(J.shiftKey);}}if(J.preventDefault){J.preventDefault();}return false;}}var I=apf.isMac?J.metaKey:J.altKey;if(apf.config.disableBackspace&&J.keyCode==8&&!F){if(apf.canDisableKeyCodes){try{J.keyCode=0;}catch(J){}}J.returnValue=false;}if(apf.config.disableF5&&(J.keyCode==116||J.keyCode==117)){if(apf.canDisableKeyCodes){try{J.keyCode=0;}catch(J){}}else{J.preventDefault();J.stopPropagation();}}if(J.keyCode==27){J.returnValue=false;}if(!apf.config.allowSelect&&J.shiftKey&&(J.keyCode>32&&J.keyCode<41)&&!F){J.returnValue=false;}if(J.returnValue===false&&J.preventDefault){J.preventDefault();}return J.returnValue;});apf.document={};this.init=function(E){if(apf.actiontracker){this.$at=new apf.actiontracker();this.$at.name="default";apf.nameserver.register("actiontracker","default",this.$at);}apf.console.info("Start parsing main application");apf.Latometer.start();this.$domParser=new apf.DOMParser();this.document=apf.document=this.$domParser.parseFromString(E,"text/xml",{timeout:apf.config.initdelay,callback:function(G){if(apf.parsed!=2){var F=apf.parsed;apf.parsed=2;apf.dispatchEvent("parse",{initial:F});apf.parsed=true;}if(!apf.loaded){if(apf.isDeskrun){apf.window.deskrun.Show();}if(!apf.document.activeElement&&!apf.config.allowBlur){apf.window.focusDefault();}apf.loaded=true;$setTimeout(function(){apf.dispatchEvent("load");});}apf.console.info("Initialization finished");apf.Latometer.end();apf.Latometer.addPoint("Total load time");apf.Latometer.start(true);}});this.addEventListener("focus",function(F){if(!apf.document.activeElement&&q&&!apf.isIphone){if(q.$isWindowContainer==-1){if(q.$tabList.length){apf.window.moveNext(null,q.$tabList[0]);}else{apf.window.$focus(q);}}else{apf.window.$focusLast(q);}}});this.addEventListener("blur",function(F){if(!apf.document.activeElement||apf.isIphone){return;}apf.document.activeElement.blur(true,{srcElement:this});q=apf.document.activeElement.$focusParent;apf.activeElement=apf.document.activeElement=null;});};this.destroy=function(){this.$at=null;apf.unload(this);apf=this.win=this.window=this.document=null;window.onfocus=window.onerror=window.onunload=window.onbeforeunload=window.onbeforeprint=window.onafterprint=window.onmousewheel=window.onblur=null;document.oncontextmenu=document.onmousedown=document.onmousemove=document.onmouseup=document.onselectstart=document.onmousewheel=document.onkeyup=document.onkeydown=null;if(document.body){document.body.onmousedown=document.body.onmousemove=document.body.onmouseup=null;document.body.innerHTML="";}};};apf.window.prototype=new apf.Class().$init();apf.window=new apf.window();apf.sanitizeTextbox=function(c){c.onfocus=function(){if(apf.window){apf.window.$focusfix2();}};c.onblur=function(){if(apf.window){apf.window.$blurfix();}};};apf.runGecko=function(){if(apf.runNonIe){apf.runNonIe();}HTMLDocument.prototype.selectNodes=XMLDocument.prototype.selectNodes=function(j,g){try{var s=this.evaluate(j,(g||this),this.createNSResolver(this.documentElement),7,null);}catch(q){var t=q.message;if(q.code==q.INVALID_EXPRESSION_ERR){t=t.replace(/the expression/i,"'"+j+"'");}throw new d(q.lineNumber,"XPath error: "+t);}var k=new Array(s.snapshotLength);k.expr=j;for(var n=k.length-1;n>=0;n--){k[n]=s.snapshotItem(n);}return k;};Text.prototype.selectNodes=Element.prototype.selectNodes=function(g){return this.ownerDocument.selectNodes(g,this);};HTMLDocument.prototype.selectSingleNode=XMLDocument.prototype.selectSingleNode=function(i,g){var j=this.selectNodes(i+"[1]",g||null);return j[0]||null;};Text.prototype.selectSingleNode=Element.prototype.selectSingleNode=function(g){return this.ownerDocument.selectSingleNode(g,this);};var c=new XMLSerializer();apf.insertHtmlNodes=function(k,s,j){var t=document.createElement("div"),u=document.createDocumentFragment(),n=k.length-1,g,q;for(;n>=0;n--){q=k[n];u.insertBefore(q,u.firstChild);}t.innerHTML=apf.html_entity_decode(c.serializeToString(u)).replace(/<([^>]+)\/>/g,"<$1></$1>");u=document.createDocumentFragment();for(n=0,g=t.childNodes.length;n<g;n++){q=t.childNodes[0];u.appendChild(q);}if(j){s.insertBefore(u,j);}s.appendChild(u);};apf.insertHtmlNode=function(i,k,g,j){if(k.nodeType!=11&&!k.style){return k.appendChild(i);}var n=document.createElement("div");if(!j){j=apf.html_entity_decode(i.serialize?i.serialize(true):((i.nodeType==3||i.nodeType==4||i.nodeType==2)?i.nodeValue:c.serializeToString(i)));}n.innerHTML=j.replace(/<([^>]+)\/>/g,"<$1></$1>");if(g){k.insertBefore(n.firstChild,g);}k.appendChild(n.firstChild);return g?g.previousSibling:k.lastChild;};function d(g,i){if(!apf.$debugwin.nativedebug){apf.$debugwin.errorHandler(i,"",0);}this.message=i;this.nr=g;}apf.getHtmlLeft=function(g){return(g.offsetLeft+(parseInt(apf.getStyle(g.parentNode,"border-left-width"))||0));};apf.getHtmlRight=function(g){var i;return(((i=g.offsetParent).tagName=="BODY"?apf.getWindowWidth():i.offsetWidth)-g.offsetLeft-g.offsetWidth-(2*(parseInt(apf.getStyle(i,"border-left-width"))||0))-(parseInt(apf.getStyle(i,"border-right-width"))||0));};apf.getHtmlTop=function(g){return(g.offsetTop+(parseInt(apf.getStyle(g.parentNode,"border-top-width"))||0));};apf.getHtmlBottom=function(g){var i;return(((i=g.offsetParent).tagName=="BODY"?apf.getWindowHeight():i.offsetHeight)-g.offsetTop-g.offsetHeight-(2*(parseInt(apf.getStyle(i,"border-top-width"))||0))-(parseInt(apf.getStyle(i,"border-bottom-width"))||0));};apf.getBorderOffset=function(g){return[-1*(parseInt(apf.getStyle(g,"border-left-width"))||0),-1*(parseInt(apf.getStyle(g,"border-top-width"))||0)];};};apf.initGears=function(){var c,d;var i=apf.nameserver.get("google","gears");if(i){return i;}if(typeof GearsFactory!="undefined"){c=new GearsFactory();}else{if(apf.isIE){try{c=new ActiveXObject("Gears.Factory");}catch(g){}}else{if(navigator.mimeTypes["application/x-googlegears"]){c=document.createElement("object");c.setAttribute("type","application/x-googlegears");c.setAttribute("width",0);c.setAttribute("height",0);c.style.display="none";document.documentElement.appendChild(c);}}}if(!c){return null;}return apf.nameserver.register("google","gears",c);};apf.runIphone=function(){if(!apf.isIphone){return;}$setTimeout(function(){apf.importCssString('html, body {                margin: 0;                font-family: Helvetica;                background: #fff;                color: #000000;                overflow-x: hidden;                -webkit-user-select: none;                -webkit-text-size-adjust: none;                -webkit-touch-callout: none;            }            body > *:not(.toolbar) {                min-height: 372px;            }            body[orient="landscape"] > *:not(.toolbar) {                min-height: 268px;            }            body > *[selected="true"] {                display: block;            }',"screen");var s=document.getElementsByTagName("head")[0];if(apf.config.iphoneIcon){var t=document.createElement("link");t.setAttribute("rel","apple-touch-icon"+(apf.config.iphoneIconIsGlossy?"":"-precomposed"));t.setAttribute("href","apf.config.iphoneIcon");s.appendChild(t);}function u(w,A){var B=document.createElement("meta");B.setAttribute("name",w);B.setAttribute("content",A);s.appendChild(B);}if(apf.config.iphoneFixedViewport){u("viewport","width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0;");}if(apf.config.iphoneFullScreen){u("apple-mobile-web-app-capable","yes");if(apf.config.iphoneStatusBar){u("apple-mobile-web-app-status-bar-style","apf.config.iphoneStatusBar");}}});var c=false,g=0,k="portrait",i="landscape",j=null;apf.addDomLoadEvent(function(){$setTimeout(d,0);j=setInterval(d,300);});function q(){switch(window.orientation){case 0:n(k);break;case 90:case -90:n(i);break;}}if(typeof window.onorientationchange=="object"){window.onorientationchange=q;c=true;$setTimeout(q,0);}function d(){if(!c){if(window.innerWidth!=g){g=window.innerWidth;var s=g==320?k:i;n(s);}}}function n(s){document.body.setAttribute("orient",s);$setTimeout("scrollTo(0,1)",100);}["gesturestart","gesturechange","gestureend","orientationchange"].forEach(function(s){document["on"+s]=function(t){if(apf.dispatchEvent){apf.dispatchEvent(s,t);}};});apf.iphone={titleNode:null,linkEvents:function(u,t){return;u[t?"onclick":"ontouchstart"]=function(w){if(!w.touches||w.touches.length!=1){return;}var A=w.touches[0];if(typeof this.onmousedown=="function"){this.onmousedown(A);if(this!=document){return false;}}};u.ontouchmove=function(w){if(!w.touches||w.touches.length!=1){return;}var A=w.touches[0];if(typeof this.onmousemove=="function"){this.onmousemove(A);if(this!=document){return false;}}};var s=false;u.ontouchend=u.ontouchcancel=function(w){if(s){return;}var A=w.touches&&w.touches.length?w.touches[0]:w.changedTouches[0];if(!A){return;}s=true;$setTimeout(function(){s=false;});if(typeof this.onmouseup=="function"){this.onmouseup(A);if(this!=document){return false;}}};return this;},nav:{sections:null,active:null,def:"home",divideChar:"/",levelTwoChar:"-",go:function(C,A){var B,t,D=apf.iphone.nav;D.update();if(!(t=D.sections[C.page])){return;}scrollTo(0,1);apf.dispatchEvent("pagechange",C);var F=t.getAttribute("title");if(apf.iphone.titleNode&&F){apf.iphone.titleNode.innerHTML=F;}if(A){for(B in D.sections){D.sections[B].hide();}t.show();}else{for(B in D.sections){if(!D.sections[B].visible||B==C.page){continue;}var E=D.sections[B];E.setProperty("zindex",0);apf.tween.single(E.$ext,{steps:5,interval:10,from:E.$ext.offsetLeft,to:(C.index<0)?1000:-1000,type:"left",anim:apf.tween.EASEOUT,onfinish:function(){E.setProperty("visible",false);}});}var w=10,u=t.$ext,s=(C.index<0)?-(u.offsetWidth)-w:window.innerWidth+u.offsetLeft+w;t.setProperty("visible",true);t.setProperty("zindex",apf.all.length+1);apf.tween.single(u,{steps:5,interval:10,from:s,to:0,type:"left",anim:apf.tween.EASEIN});}},update:function(t){if(this.sections&&!t){return;}this.sections={};for(var s in window){if(window[s]&&window[s]["tagName"]&&window[s].tagName=="section"){this.sections[s]=window[s];}}}}};$setTimeout(function(){apf.addEventListener("hashchange",apf.iphone.nav.go);if(location.href.match(/#(.*)$/)){apf.history.init(decodeURI(RegExp.$1));}else{if(apf._GET.page){apf.history.init(apf._GET.page);}else{apf.history.init();}}});document.ontouchstart=function(s){if(!s.touches||s.touches.length!=1){return;}var w=s.touches[0],u=w.target,t=apf.findHost(w.target);if(!t){return;}while(typeof u.onmousedown!="function"&&u!=document.body){u=u.parentNode;}if(typeof u.onmousedown=="function"){if(typeof u.onmouseover=="function"){u.onmouseover(w);}else{if(typeof u.onmousemove=="function"){u.onmousemove(w);}}u.onmousedown(w);return false;}};document.ontouchmove=function(s){if(!s.touches||s.touches.length!=1){return;}var w=s.touches[0],u=w.target,t=apf.findHost(w.target);if(!t){return;}while(typeof u.onmousemove!="function"&&u!=document.body){u=u.parentNode;}if(typeof u.onmousemove=="function"){u.onmousemove(w);return false;}else{if(typeof document.onmousemove=="function"){return document.onmousemove(w);}}};document.ontouchend=document.ontouchcancel=function(s){var w=s.touches&&s.touches.length?s.touches[0]:s.changedTouches[0];if(!w){return;}var u=w.target,t=apf.findHost(w.target);if(!t){return;}while(typeof u.onmouseup!="function"&&u!=document.body){u=u.parentNode;}if(typeof u.onmouseup=="function"){if(typeof u.onmouseout=="function"){u.onmouseout(w);}u.onmouseup(w,true);return false;}else{if(typeof document.onmouseup=="function"){return document.onmouseup(w);}}};};apf.runIE=function(){var c=false,g=false;if(self.XMLHttpRequest){try{new XMLHttpRequest();}catch(d){c=true;}}try{new ActiveXObject("microsoft.XMLHTTP");}catch(d){g=true;}if(g){apf.importClass(runTpIframe,true,self);}apf.getHttpReq=g?function(){if(apf.availHTTP.length){return apf.availHTTP.pop();}return new XMLHttpRequest();}:function(){if(apf.availHTTP.length){return apf.availHTTP.pop();}return new ActiveXObject("microsoft.XMLHTTP");};apf.getXmlDom=g?function(k,i){var j=getDOMParser(k,i);return j;}:function(n,i,k){var j=new ActiveXObject("microsoft.XMLDOM");j.setProperty("SelectionLanguage","XPath");if(k){j.preserveWhiteSpace=true;}if(n){if(apf.cantParseXmlDefinition){n=n.replace(/\] \]/g,"] ]").replace(/^<\?[^>]*\?>/,"");}j.loadXML(n);if(!i){this.xmlParseError(j);}}return j;};apf.xmlParseError=function(j){var i=j.parseError;if(i!=0){throw new Error(apf.formatErrorString(1050,null,"XML Parse error on line "+i.line,i.reason+"Source Text:\n"+i.srcText.replace(/\t/gi," ")));}return j;};apf.getStyle=function(i,j){return i.currentStyle[j];};apf.insertHtmlNodes=function(q,t,n){for(var w=[],s=0,k=q.length;s<k;s++){w[s]=q[s].xml;}w=apf.html_entity_decode(w.join(""));if(apf.isIE<7){w=w.replace(/style="background-image:([^"]*)"/g,"find='$1' style='background-image:$1'");}try{(n||t).insertAdjacentHTML(n?"beforebegin":"beforeend",w);}catch(u){document.body.insertAdjacentHTML("beforeend","<table><tr>"+w+"</tr></table>");var j=document.body.lastChild.firstChild.firstChild;for(s=j.childNodes.length-1;s>=0;s--){t.appendChild(j.childNodes[apf.hasDynamicItemList?0:s]);}}if(apf.isIE<7){$setTimeout(function(){var B=t.getElementsByTagName("*");for(var D,C=0,A=B.length;C<A;C++){if(D=B[C].getAttribute("find")){B[C].style.backgroundImage=D.trim();}}});}};apf.insertHtmlNode=function(k,n,i,s){if(n.nodeType!=11&&!n.style){return n.appendChild(k);}var j=i||n;if(!s){s=apf.html_entity_decode(k.serialize?k.serialize(true):k.xml||k.outerHTML||k.nodeValue);}try{j.insertAdjacentHTML(i?"beforeBegin":"beforeEnd",s);}catch(q){apf.console.warn("Warning found block element inside a "+j.tagName+" element. Rendering will give unexpected results");j.insertAdjacentHTML("afterEnd",s);return j.nextSibling;}if(i){return i.previousSibling;}else{return n.lastChild.nodeType==1?n.lastChild:n.lastChild.previousSibling;}};apf.getHorBorders=function(i){return((parseInt(i.currentStyle.borderLeftWidth)||0)+(parseInt(i.currentStyle.borderRightWidth)||0));};apf.getVerBorders=function(i){return(0,(parseInt(i.currentStyle.borderTopWidth)||0)+(parseInt(i.currentStyle.borderBottomWidth)||0));};apf.getWidthDiff=function(i){return Math.max(0,(parseInt(i.currentStyle.paddingLeft)||0)+(parseInt(i.currentStyle.paddingRight)||0)+(parseInt(i.currentStyle.borderLeftWidth)||0)+(parseInt(i.currentStyle.borderRightWidth)||0));};apf.getHeightDiff=function(i){return Math.max(0,(parseInt(i.currentStyle.paddingTop)||0)+(parseInt(i.currentStyle.paddingBottom)||0)+(parseInt(i.currentStyle.borderTopWidth)||0)+(parseInt(i.currentStyle.borderBottomWidth)||0));};apf.getDiff=function(i){return[Math.max(0,(parseInt(i.currentStyle.paddingLeft)||0)+(parseInt(i.currentStyle.paddingRight)||0)+(parseInt(i.currentStyle.borderLeftWidth)||0)+(parseInt(i.currentStyle.borderRightWidth)||0)),Math.max(0,(parseInt(i.currentStyle.paddingTop)||0)+(parseInt(i.currentStyle.paddingBottom)||0)+(parseInt(i.currentStyle.borderTopWidth)||0)+(parseInt(i.currentStyle.borderBottomWidth)||0))];};apf.getMargin=function(i){return[Math.max(0,(parseInt(i.currentStyle.marginLeft)||0)+(parseInt(i.currentStyle.marginRight)||0)),Math.max(0,(parseInt(i.currentStyle.marginTop)||0)+(parseInt(i.currentStyle.marginBottom)||0))];};apf.getHtmlLeft=function(i){return(i.offsetLeft-(apf.isIE>7&&parseInt(i.parentNode.currentStyle.borderLeftWidth)||0));};apf.getHtmlRight=function(i){var j;return(((j=i.offsetParent).tagName=="BODY"?apf.getWindowWidth():j.offsetWidth)-i.offsetLeft-i.offsetWidth-(apf.isIE<8&&parseInt(j.currentStyle.borderLeftWidth)||0)-(parseInt(j.currentStyle.borderRightWidth)||0));};apf.getHtmlTop=function(i){return(i.offsetTop-(apf.isIE>7&&parseInt(i.offsetParent.currentStyle.borderTopWidth)||0));};apf.getHtmlBottom=function(i){var j;return(((j=i.offsetParent).tagName=="BODY"?apf.getWindowHeight():j.offsetHeight)-i.offsetTop-i.offsetHeight-(apf.isIE<8&&parseInt(j.currentStyle.borderTopWidth)||0)-(parseInt(j.currentStyle.borderBottomidth)||0));};apf.getBorderOffset=function(i){return apf.isIE<8&&[0,0]||[parseInt(i.currentStyle.borderLeftWidth)||0,parseInt(i.currentStyle.borderTopWidth)||0];};apf.getHtmlInnerWidth=function(i){return(i.offsetWidth-(parseInt(i.currentStyle.borderLeftWidth)||0)-(parseInt(i.currentStyle.borderRightWidth)||0));};apf.getHtmlInnerHeight=function(i){return(i.offsetHeight-(parseInt(i.currentStyle.borderTopWidth)||0)-(parseInt(i.currentStyle.borderBottomWidth)||0));};apf.getOpacity=function(i){return parseInt(((i.currentStyle.filter||"").match(/alpha\(opacity=(\d*)\)/)||[0,0])[1])/100;};apf.setOpacity=function(j,i){j.style.filter="alpha(opacity="+Math.round(i*100)+")";};apf.popup2={cache:{},setContent:function(q,n,k,j,i){if(!this.popup){this.init();}this.cache[q]={content:n,style:k,width:j,height:i};if(n.parentNode){n.parentNode.removeChild(n);}if(k){apf.importCssString(k,this.popup.document);}return this.popup.document;},removeContent:function(i){this.cache[i]=null;delete this.cache[i];},init:function(){this.popup=window.createPopup();this.popup.document.write('<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">                <html xmlns="http://www.w3.org/1999/xhtml" xmlns:a='+apf.ns.aml+' xmlns:xsl="http://www.w3.org/1999/XSL/Transform">                <head>                    <script>                    var apf = {                        all: [],                        lookup:function(uniqueId){                            return this.all[uniqueId] || {                                $setStyleClass:function(){}                            };                        }                    };                    function destroy(){                        apf.all=null;                    }                    <\/script>                    <style>                    HTML{border:0;overflow:hidden;margin:0}                    BODY{margin:0}                    </style>                </head>                <body onmouseover="if(!self.apf) return;if(this.c){apf.all = this.c.all;this.c.Popup.parentDoc=self;}"></body>                </html>');var i=apf;this.popup.document.body.onmousemove=function(){this.c=i;};},show:function(E,A,w,n,s,k,D,C){if(!this.popup){this.init();}var q=this.cache[E];this.popup.document.body.innerHTML=q.content.outerHTML;if(n){var B,u=7,t=0,j=this.popup;B=setInterval(function(){var i=++t*((D||q.height)/u);j.show(A,w,k||q.width,i,s);j.document.body.firstChild.style.marginTop=(t-u-1)*((D||q.height)/u);if(t>u){clearInterval(B);C(j.document.body.firstChild);}},10);}else{this.popup.show(A,w,k||q.width,D||q.height,s);}this.last=E;},hide:function(){if(this.popup){this.popup.hide();}},forceHide:function(){if(this.last){apf.lookup(this.last).dispatchEvent("popuphide");}},destroy:function(){if(!this.popup){return;}this.popup.document.body.c=null;this.popup.document.body.onmouseover=null;}};apf.importClass(apf.runXpath,true,self);};apf.runNonIe=function(){DocumentFragment.prototype.getElementById=function(g){return this.childNodes.length?this.childNodes[0].ownerDocument.getElementById(g):null;};if(XMLDocument.prototype.__defineGetter__){XMLDocument.prototype.__defineGetter__("xml",function(){return(new XMLSerializer()).serializeToString(this);});XMLDocument.prototype.__defineSetter__("xml",function(){throw new Error(apf.formatErrorString(1042,null,"XML serializer","Invalid assignment on read-only property 'xml'."));});Node.prototype.__defineGetter__("xml",function(){if(this.nodeType==3||this.nodeType==4||this.nodeType==2){return this.nodeValue;}return(new XMLSerializer()).serializeToString(this);});Element.prototype.__defineGetter__("xml",function(){return(new XMLSerializer()).serializeToString(this);});}if(typeof HTMLElement!="undefined"){if(!HTMLElement.prototype.insertAdjacentElement){Text.prototype.insertAdjacentElement=HTMLElement.prototype.insertAdjacentElement=function(g,i){switch(g.toLowerCase()){case"beforebegin":this.parentNode.insertBefore(i,this);break;case"afterbegin":this.insertBefore(i,this.firstChild);break;case"beforeend":this.appendChild(i);break;case"afterend":if(this.nextSibling){this.parentNode.insertBefore(i,this.nextSibling);}else{this.parentNode.appendChild(i);}break;}};}if(!HTMLElement.prototype.insertAdjacentHTML){Text.prototype.insertAdjacentHTML=HTMLElement.prototype.insertAdjacentHTML=function(i,k){var j=this.ownerDocument.createRange();j.setStartBefore(apf.isWebkit?document.body:(self.document?document.body:this));var g=j.createContextualFragment(k);this.insertAdjacentElement(i,g);};}if(!HTMLBodyElement.prototype.insertAdjacentHTML){HTMLBodyElement.prototype.insertAdjacentHTML=HTMLElement.prototype.insertAdjacentHTML;}if(!HTMLElement.prototype.insertAdjacentText){Text.prototype.insertAdjacentText=HTMLElement.prototype.insertAdjacentText=function(i,j){var g=document.createTextNode(j);this.insertAdjacentElement(i,g);};}HTMLElement.prototype.removeNode=function(){if(!this.parentNode){return;}this.parentNode.removeChild(this);};if(HTMLElement.prototype.__defineSetter__){HTMLElement.prototype.__defineSetter__("innerText",function(g){var i=""+g;this.innerHTML=i.replace(/\&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");});HTMLElement.prototype.__defineGetter__("innerText",function(){return this.innerHTML.replace(/<[^>]+>/g,"").replace(/\s\s+/g," ").replace(/^\s*|\s*$/g," ");});HTMLElement.prototype.__defineGetter__("outerHTML",function(){return(new XMLSerializer()).serializeToString(this);});}}var c=false;try{XMLDocument.prototype.async=true;c=true;}catch(d){}Document.prototype.onreadystatechange=null;Document.prototype.parseError=0;Array.prototype.item=function(g){return this[g];};Array.prototype.expr="";try{XMLDocument.prototype.readyState=0;}catch(d){}XMLDocument.prototype.$clearDOM=function(){while(this.hasChildNodes()){this.removeChild(this.firstChild);}};XMLDocument.prototype.$copyDOM=function(g){this.$clearDOM();if(g.nodeType==9||g.nodeType==11){var k=g.childNodes;for(var j=0;j<k.length;j++){this.appendChild(this.importNode(k[j],true));}}else{if(g.nodeType==1){this.appendChild(this.importNode(g,true));}}};XMLDocument.prototype.loadXML=function(j){apf.xmldb.setReadyState(this,1);var i=this.xml||this.serialize();var g=(new DOMParser()).parseFromString(j,"text/xml");apf.xmldb.setReadyState(this,2);this.$copyDOM(g);apf.xmldb.setReadyState(this,3);apf.xmldb.loadHandler(this);return i;};Node.prototype.getElementById=function(g){};HTMLElement.prototype.replaceNode=Element.prototype.replaceNode=function(g){if(!this.parentNode){return;}this.parentNode.insertBefore(g,this);this.parentNode.removeChild(this);};XMLDocument.prototype.$load=XMLDocument.prototype.load;XMLDocument.prototype.load=function(k){var g=document.implementation.createDocument("","",null);g.$copyDOM(this);this.parseError=0;apf.xmldb.setReadyState(this,1);try{if(this.async==false&&c){var i=new XMLHttpRequest();i.open("GET",k,false);i.overrideMimeType("text/xml");i.send(null);apf.xmldb.setReadyState(this,2);this.$copyDOM(i.responseXML);apf.xmldb.setReadyState(this,3);}else{this.$load(k);}}catch(j){this.parseError=-1;}finally{apf.xmldb.loadHandler(this);}return g;};apf.getStyle=function(g,i){return window.getComputedStyle(g,"").getPropertyValue(i);};HTMLDocument.prototype.setProperty=XMLDocument.prototype.setProperty=function(g,i){};apf.getHttpReq=function(){if(apf.availHTTP.length){return apf.availHTTP.pop();}return new XMLHttpRequest();};apf.getXmlDom=function(j,g){var i;if(j){i=new DOMParser();i=i.parseFromString(j,"text/xml");if(!g){this.xmlParseError(i);}}else{i=document.implementation.createDocument("","",null);}return i;};apf.xmlParseError=function(i){if(i.getElementsByTagName("parsererror").length){var n=i.documentElement.firstChild.nodeValue.split("\n"),j=n[2].match(/\w+ (\d+)/)[1],k=n[0].replace(/\w+ \w+ \w+: (.*)/,"$1"),g=i.documentElement.lastChild.firstChild.nodeValue.split("\n")[0];throw new Error(apf.formatErrorString(1050,null,"XML Parse Error on line "+j,k+"\nSource Text : "+g.replace(/\t/gi," ")));}return i;};apf.xmldb.setReadyState=function(g,i){g.readyState=i;if(g.onreadystatechange!=null&&typeof g.onreadystatechange=="function"){g.onreadystatechange();}};apf.xmldb.loadHandler=function(g){if(!g.documentElement||g.documentElement.tagName=="parsererror"){g.parseError=-1;}apf.xmldb.setReadyState(g,4);};apf.Init.add(function(){var j,g=document.getElementsByTagName("form");for(j=0;j<g.length;j++){g[j].removeNode();}g=document.getElementsByTagName("xml");for(j=0;j<g.length;j++){g[j].removeNode();}g=null;});if(document.body){document.body.focus=function(){};}apf.getHorBorders=function(g){return Math.max(0,(parseInt(apf.getStyle(g,"border-left-width"))||0)+(parseInt(apf.getStyle(g,"border-right-width"))||0));};apf.getVerBorders=function(g){return Math.max(0,(parseInt(apf.getStyle(g,"border-top-width"))||0)+(parseInt(apf.getStyle(g,"border-bottom-width"))||0));};apf.getWidthDiff=function(g){return Math.max(0,(parseInt(apf.getStyle(g,"padding-left"))||0)+(parseInt(apf.getStyle(g,"padding-right"))||0)+(parseInt(apf.getStyle(g,"border-left-width"))||0)+(parseInt(apf.getStyle(g,"border-right-width"))||0));};apf.getHeightDiff=function(g){return Math.max(0,(parseInt(apf.getStyle(g,"padding-top"))||0)+(parseInt(apf.getStyle(g,"padding-bottom"))||0)+(parseInt(apf.getStyle(g,"border-top-width"))||0)+(parseInt(apf.getStyle(g,"border-bottom-width"))||0));};apf.getDiff=function(g){return[Math.max(0,parseInt(apf.getStyle(g,"padding-left"))+parseInt(apf.getStyle(g,"padding-right"))+parseInt(apf.getStyle(g,"border-left-width"))+parseInt(apf.getStyle(g,"border-right-width"))||0),Math.max(0,parseInt(apf.getStyle(g,"padding-top"))+parseInt(apf.getStyle(g,"padding-bottom"))+parseInt(apf.getStyle(g,"border-top-width"))+parseInt(apf.getStyle(g,"border-bottom-width"))||0)];};apf.getMargin=function(g){return[Math.max(0,(parseInt(apf.getStyle(g,"margin-left"))||0)+(parseInt(apf.getStyle(g,"margin-right"))||0)),Math.max(0,(parseInt(apf.getStyle(g,"margin-top"))||0)+(parseInt(apf.getStyle(g,"margin-bottom"))||0))];};apf.getHtmlInnerWidth=function(g){return(g.offsetWidth-(parseInt(apf.getStyle(g,"border-left-width"))||0)-(parseInt(apf.getStyle(g,"border-right-width"))||0));};apf.getHtmlInnerHeight=function(g){return(g.offsetHeight-(parseInt(apf.getStyle(g,"border-top-width"))||0)-(parseInt(apf.getStyle(g,"border-bottom-width"))||0));};apf.getOpacity=function(g){return apf.getStyle(g,"opacity");};apf.setOpacity=function(i,g){i.style.opacity=g;};};apf.runOpera=function(){if(apf.runNonIe){apf.runNonIe();}Document.prototype.selectNodes=XMLDocument.prototype.selectNodes=HTMLDocument.prototype.selectNodes=function(g,d){var n=this.evaluate(g,(d?d:this),this.createNSResolver(this.documentElement),XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);var j=new Array(n.snapshotLength);j.expr=g;for(var k=0;k<j.length;k++){j[k]=n.snapshotItem(k);}return j;};Text.prototype.selectNodes=Element.prototype.selectNodes=function(d){var g=this.ownerDocument;if(!g.selectSingleNode){g.selectSingleNode=HTMLDocument.prototype.selectSingleNode;g.selectNodes=HTMLDocument.prototype.selectNodes;}if(g.selectNodes){return g.selectNodes(d,this);}else{throw new Error(apf.formatErrorString(1047,null,"XPath Selection","Method selectNodes is only supported by XML Nodes"));}};Document.prototype.selectSingleNode=XMLDocument.prototype.selectSingleNode=HTMLDocument.prototype.selectSingleNode=function(g,d){var i=this.selectNodes(g+"[1]",d?d:null);return i.length>0?i[0]:null;};Text.prototype.selectSingleNode=Element.prototype.selectSingleNode=function(d){var g=this.ownerDocument;if(!g.selectSingleNode){g.selectSingleNode=HTMLDocument.prototype.selectSingleNode;g.selectNodes=HTMLDocument.prototype.selectNodes;}if(g.selectSingleNode){return g.selectSingleNode(d,this);}else{throw new Error(apf.formatErrorString(1048,null,"XPath Selection","Method selectSingleNode is only supported by XML Nodes. \nInfo : "+e));}};var c=new XMLSerializer();apf.insertHtmlNodes=function(j,q,g){var n,s=document.createDocumentFragment(),k=0,d=j.length;for(;k<d;k++){if(!(n=j[k])){continue;}s.appendChild(n);}(g||q).insertAdjacentHTML(g?"beforebegin":"beforeend",apf.html_entity_decode(c.serializeToString(s)).replace(/<([^>]+)\/>/g,"<$1></$1>"));};apf.insertHtmlNode=function(g,j,d,i){if(j.nodeType!=11&&!j.style){return j.appendChild(g);}if(!i){i=apf.html_entity_decode(g.serialize?g.serialize(true):((g.nodeType==3||g.nodeType==4||g.nodeType==2)?g.nodeValue:c.serializeToString(g)));}(d||j).insertAdjacentHTML(d?"beforebegin":"beforeend",i.replace(/<([^>]+)\/>/g,"<$1></$1>"));return d?d.previousSibling:j.lastChild;};apf.getHtmlLeft=function(d){return(d.offsetLeft-(parseInt(apf.getStyle(d.parentNode,"border-left-width"))||0));};apf.getHtmlRight=function(d){var g;return(((g=d.offsetParent).tagName=="BODY"?apf.getWindowWidth():g.offsetWidth)-d.offsetLeft-d.offsetWidth-(parseInt(apf.getStyle(g,"border-right-width"))||0));};apf.getHtmlTop=function(d){return(d.offsetTop-(parseInt(apf.getStyle(d.offsetParent,"border-top-width"))||0));};apf.getHtmlBottom=function(d){var g;return(((g=d.offsetParent).tagName=="BODY"?apf.getWindowHeight():g.offsetHeight)-d.offsetTop-d.offsetHeight-(parseInt(apf.getStyle(g,"border-bottom-width"))||0));};apf.getBorderOffset=function(d){return[parseInt(apf.getStyle(d,"border-left-width"))||0,parseInt(apf.getStyle(d,"border-top-width"))||0];};};apf.runWebkit=function(){HTMLDocument.prototype.selectNodes=XMLDocument.prototype.selectNodes=function(g,d){if(g.substr(0,2)=="//"){g="."+g;}try{var q=this.evaluate(g,(d||this),this.createNSResolver(this.documentElement),7,null);}catch(n){try{var q=this.evaluate("child::"+g,(d||this),this.createNSResolver(this.documentElement),7,null);}catch(n){throw new Error("XPath error: "+n.message+"\nLine: "+n.lineNumber+"\nExpression: '"+g+"'");}}var j=new Array(q.snapshotLength);j.expr=g;for(var k=j.length-1;k>=0;k--){j[k]=q.snapshotItem(k);}return j;};Text.prototype.selectNodes=Element.prototype.selectNodes=function(d){return this.ownerDocument.selectNodes(d,this);};HTMLDocument.prototype.selectSingleNode=XMLDocument.prototype.selectSingleNode=function(g,d){var i=this.selectNodes(g,d||null);return i[0]||null;};Text.prototype.selectSingleNode=Element.prototype.selectSingleNode=function(d){return this.ownerDocument.selectSingleNode(d,this);};var c=new XMLSerializer();apf.insertHtmlNodes=function(k,s,j){var q,t=document.createDocumentFragment(),g=[],n=0,d=k.length;for(;n<d;n++){if(!(q=k[n])){continue;}t.appendChild(q);}(j||s).insertAdjacentHTML(j?"beforebegin":"beforeend",apf.html_entity_decode(c.serializeToString(t)).replace(/<([^>]+)\/>/g,"<$1></$1>"));};apf.insertHtmlNode=function(g,j,d,i){if(j.nodeType!=11&&!j.style){return j.appendChild(g);}if(!i){i=apf.html_entity_decode(g.serialize?g.serialize(true):((g.nodeType==3||g.nodeType==4||g.nodeType==2)?g.nodeValue:c.serializeToString(g)));}(d||j).insertAdjacentHTML(d?"beforebegin":"beforeend",i.replace(/<([^>]+)\/>/g,"<$1></$1>"));return d?d.previousSibling:j.lastChild;};apf.getHtmlLeft=function(d){return d.offsetLeft;};apf.getHtmlRight=function(d){var g;return(((g=d.offsetParent).tagName=="BODY"?apf.getWindowWidth():g.offsetWidth)-d.offsetLeft-d.offsetWidth-(parseInt(apf.getStyle(g,"border-left-width"))||0)-(parseInt(apf.getStyle(g,"border-right-width"))||0));};apf.getHtmlTop=function(d){return d.offsetTop;};apf.getHtmlBottom=function(d){var g;return(((g=d.offsetParent).tagName=="BODY"?apf.getWindowHeight():g.offsetHeight)-d.offsetTop-d.offsetHeight-(parseInt(apf.getStyle(g,"border-top-width"))||0)-(parseInt(apf.getStyle(g,"border-bottom-width"))||0));};apf.getBorderOffset=function(d){return[0,0];};if(apf.runNonIe){apf.runNonIe();}};apf.lm=new (function(){var bF={"var":1,"for":1,"while":1,"do":1,"if":1,"else":1,"switch":1,"case":1,"break":1,"continue":1,"default":1,"function":2,"return":1,"try":1,"catch":1,"throw":1,"debugger":1,alert:1,confirm:1,setTimeout:1,setInterval:1,"delete":1,"export":1,"import":1,label:1,foreach:1,each:1,node:1,local:1,yield:1,let:1,"finally":1,"delete":1},aE={"\n":1,"\r\n":1,"==":2,"++":2,"--":2,'"':5,"'":5,"<!--":6,"-->":6,"/*":6,"//":6,"*/":6,"{":7,"}":8,"[":9,"]":10,"(":11,")":12,"<":13,">":14,"+=":2,"-=":2,"/=":2,"*=":2,"!=":2},aW={"{":"}","[":"]","(":")","{{":"}"},aZ={ancestor:1,"ancestor-or-self":1,attribute:1,child:1,descendant:1,"descendant-or-self":1,following:1,"following-sibling":1,namespace:1,parent:1,preceding:1,self:1},a7={";":1,",":2,"^":3,"=":4,"+=":4,"-=":4,"/=":4,"*=":4,"/":5,":":6},aY={"~":"_val(_n,","%":"_nod(_n,","*":"_nods(_n,","#":"_cnt(_n,","$":"_lng("},t={"~":"_val(_n,","%":"_xml(_n,","*":"_xmls(_n,","#":"_cnt(_n,","$":"_lng("},bk={"~":"_val(_n,","%":"_val(_n,","*":"_val(_n,","#":"_cnt(_n,","$":"_lng("},bM,K={"~":"_val(_n,","%":"_xml(_n,","*":"_xmls(_n,","#":"_cnt(_n,","$":"_lng("},at={"~":"_val(_n,","%":"_xml(_n,","*":"_xmls(_n,","#":"_cnt(_n,","$":"_lnged("},q={"[":1,"(":1,",":1,"=":1,"return":1,"throw":1},ai={"else":1,"return":1,"delete":1},aI={"do":1,"else":1,"try":1},bc={"=":"_asn(","+=":"_add(","-=":"_sub(","/=":"_div(","*=":"_mul("},aK={"+":1,"%":1,"-":1,"/":1,"=":1,"(":1,"?":1,"|":1,"^":1,"[":1,"&":1,"*":1,"!":1,":":1,"<":1,",":1},a0={"{":1,"} ":1,")":1,")   ":1,";":1,"\n":1,"else":1},T={"{":1,";":1,"\n":1,"else":1},D={"} ":1,")   ":1,"(":1,";":1,"&":1,"^":1,"|":1,",":1,'"':1,"'":1,"=":1,"!=":2,"+=":2,"-=":2,"/=":2,"*=":2,"?":1,"{":1,"}":1,">":1,"[":1,"+":1,":":1,"else":1,"return":1},N={'"':1,"'":1,">":1,"]":1,"}":1},bC={'\\"':'"',"\\'":"'","\\{":"{","\\}":"}","\\[":"[","\\]":"]","\\(":"(","\\)":")","\\\\":"\\"},bI={alert:1,confirm:1,setTimeout:1,setInterval:1,"switch":1,call:1,"return":1,"throw":1,"case":1,"catch":1,abs:1,acos:1,asin:1,atan:1,atan2:1,ceil:1,cos:1,exp:1,floor:1,log:1,max:1,min:1,pow:1,random:1,round:1,sin:1,sqrt:1,tan:1,lin:1,linear:1,idx:1},A={" ":1,"\n":1},ba={"{":1,";":1,"(":1,"\n":1},br={"\\{":"{","\\}":"}","\\[":"[","\\]":"]","\\(":"(","\\)":")"},J={"\\{":"{","\\}":"}","\\[":"[","\\]":"]","\\(":"(","\\)":")","\\\\":"\\\\\\\\","\\":"\\\\","\\<":"<","\\>":">"},aA={lte:"<=",gte:">=",lt:"<",gt:">",and:"&&",or:"||",andbin:"&",orbin:"|",LTE:"<=",GTE:">=",LT:"<",GT:">",AND:"&&",OR:"||",ANDBIN:"&",ORBIN:"|"},W={0:"_val(_n,",1:"_valcr(_n,_cr,",2:"_nod(_n,",3:"_nodcr(_n,_cr,",4:"_nods(_n,",5:"_xpt(_n,",6:"_valst(_n,",7:"_valed(_n,",8:"_valattr(_n,",foreach:"_nods(_n,",each:"_nods(_n,",local:"_nod(_n,",tagName:"_nod(_n,",localName:"_nod(_n,",xml:"_xmlq(",_call:"_val(_n,"},a8={"_val(_n,":"_valm(","_valcr(_n,_cr,":"_valcr(0,_cr,","_nod(_n,":"_nodm(","_nodcr(_n,_cr,":"_nodcr(0,_cr,","_nods(_n,":"_nodsm(","_xml(_n,":"_xml(0,","_xmls(_n,":"_xmls(0,","_cnt(_n,":"_cntm(","_xpt(_n,":"_xptm(","_valst(_n,":"_valm(","_valed(_n,":"_valed(0,","_lng(":"_lng(","_lnged(":"_lnged(","_nod_del(_n,":"_nod_del(0,","_nods_del(_n,":"_nods_del(0,"},aj={"=":{"_val(_n,":"_nod_asn(_n,","_valm(":"_nod_asn(0,","_valcr(_n,_cr,":"_nod_asn(_n,","_valcr(0,_cr,":"_nod_asn(0,","_nod(_n,":"_nod_asn(_n,","_nodm(":"_nod_asn(0,","_nodcr(_n,_cr,":"_nod_asn(_n,","_nodcr(0,_cr,":"_nod_asn(0,","_nods(_n,":"_nods_asn(_n,","_nodsm(":"_nods_asn(0,"},"+=":{"_val(_n,":"_nod_add(_n,","_valm(":"_nod_add(0,","_valcr(_n,_cr,":"_nod_add(_n,","_valcr(0,_cr,":"_nod_add(0,","_nod(_n,":"_nod_add(_n,","_nodm(":"_nod_add(0,","_nodcr(_n,_cr,":"_nod_add(_n,","_nodcr(0,_cr,":"_nod_add(0,","_nods(_n,":"_nods_add(_n,","_nodsm(":"_nods_add(0,"}},B={"_cnt(_n,":"_nod_del(_n,","_xpt(_n,":"_nod_del(_n,","_val(_n,":"_nod_del(_n,","_valcr(_n,":"_nod_del(_n,","_nod(_n,":"_nod_del(_n,","_nodcr(_n,_cr,":"_nod_del(_n,","_nods(_n,":"_nods_del(_n,"},am=/(\r?[\n]|\/\*|\*\/|\/\/|\<\!\-\-|\-\-\>|[=\!+\/\*-]=|\+\+|\-\-|["'{(\[\])}\]\<\>]|$)|([ \t]+)|([a-zA-Z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF.$_][\w.$_]*)|(\d[x\d.]*)|(\\?[\w._?,:;!=+-\\\/^&|*"'[\]{}()%$#@~`<>]?)/g,ao=/(^|\|)(?!\@|text\(\)|\.\.|[\w\-\:]+?\:\:)/g,aG={},aL={},aH={},bD=apf.$asyncObjects||{comm:1,rpc:1,http:1,"apf.ajax":1},aN,bK,aO,n,aT,bv,av,aw,al,bn,aP,bN,bL,aa,an=[],bm,aC=[],aD=[],bx,be,C,by,bP,O,aJ,bw,au,H,bA,aR,ag,a1,ar,aQ,bj,bu,S;aG["if"]="if(",aL["if"]=")",aG["while"]="while(",aL["while"]=")",aG["for"]="for(",aL["for"]=")",aG["switch"]="switch(",aL["switch"]=")",aG["catch"]="catch(",aL["catch"]=")",aL["function"]=")  ";aG.foreach=aG.each="\nfor(var _t=_t||[],_t=(_t.push(_n,0,(";aL.foreach=aL.each=")||[]),_t);(_n=_t[_t.length-1][_t[_t.length-2]++])||(_t.length-=2,_n=_t.pop(),0);)";aG.local="\nfor(var _t=_t||[],_t=(_t.push(_n,((_n=_local(";aL.local=")),1)),_t);(_t[_t.length-1]--&&_n)||(_t.length--,_n=_t.pop(),0);)";aG.localName="_localName(_n",aL.localName=")";aG.output="_o.join(''",aL.output=")";aG.reset="(_o=[],l=0",aL.reset=")";aG.index="apf.getChildNumber(_n",aL.index=")",aG.item="(_t[_t.length-1][_t[_t.length-2]-1]",aL.item=")",aG.first="(_t[_t.length-2]==1",aL.first=")",aG.last="(_t[_t.length-2]==_t[_t.length-1].length",aL.last=")",aG.total="(_t[_t.length-1].length",aL.total=")",aG.pos="(_t[_t.length-2]-1",aL.pos=")",aG.tagName="_tagName(_n",aL.tagName=")";aG._nodeValue="_nodeValue(_n",aL._nodeValue=")";aL.async="])";aL.precall="])";aL._call=")";var V={_call:".call(_n",localName:aG.localName,tagName:aG.tagName,nodeValue:aG.nodeValue,index:aG.index},G="(function(){var _o=[],_l=0;\n",R=";return _l==1?_o[0]:_o.join('');})()",F="_async(_n,_c,_a,_w,_f,this,",I="',_a[++_a.i]||[",M="_r=",ak,az="_o[_l++]=",bH="",aX="{var _o=[],_l=0,_n=this;\n",a9=";\nreturn _l==1?_o[0]:_o.join('');}",a6="(_a=_a||{}).i=0;try{\n",bh="}catch(_e){if(_e.x)return;throw(_e);}\n",a5="(_a=_a||{}).i=0;try{_pc(_w);",bg="}catch(_e){if(_e.x)return;throw(_e);}",bi="with(_w){",bq="}",bE="var _o=[],_l=0;_o[_l++]=",ab="var _o=[],_l=0;\n",bO=";\nreturn _ret(_l==1?_o[0]:_o.join(''));",Y=";\n_c(_ret(_l==1?_o[0]:_o.join('')),apf.SUCCESS,apf.$lmx);apf.$lmx=null;",aq="return _ret(",aB=");",bb="_c(_ret(",bl="),apf.SUCCESS,apf.$lmx);apf.$lmx=null;\n",L="var _r=",w="var _r;",U=";\nreturn _r;",g=";\n_c(_r,apf.SUCCESS,apf.$lmx);apf.$lmx=null;",d=";\n_c(0,apf.SUCCESS,apf.$lmx);apf.$lmx=null;;",a4="return ",bf="",aV="_c(",a3=",apf.SUCCESS);",bd="var _f=function(_n,_c,_w,_a){",i="var _f=function(_n,_w){",k="var _f=function(_n){",af="var _f=function(_n,_c,_w,_cr,_a){",j="var _f=function(_n,_w,_cr,){",ap="var _f=function(_n,_cr){",ac="var _f=function(event,_c,_w,_a,_n){",bo="var _f=function(event,_w,_n){",ae="var _f=function(event,_n){",E="}",X="var _f=function(_m){",Q=";\nif(_n=_r){if(!_n.nodeType)_n=_m;",ay=";\nif(_n=",aF="){if(!_n.nodeType)_n=_m;",bp="\nreturn ",aU="\nreturn _ret(",a2=");",c="\nreturn _n;",bz="\nreturn (_r = (",bJ="))?(_r.nodeType?_r:_n):(_r===null?null:_n);",bs="var _r, _n = _m;",P=";\n_n = _m;",u="\nreturn _ret(_nodeValue(_n));",aS="\nreturn _n;",bG="\n}";function ad(s){var bQ,bt;if(av[be-1]=="{{"){bQ=be-1;}else{for(bt=bm-2,bQ=0;bt>=0&&av[bQ=(an[bt]&268435455)-1]!="{{";bt-=2){}}if(!s&&aw>bQ+1){av[bQ]=G+az;}else{av[bQ]=G;}bx=1;}function aM(bY,bS,bt,bR,s,bQ,bU){var bX,bW,bV,bT=bS?aE[bS]:(bt?0:(bR?3:(s?4:(bY?2:15))));switch(bx){case 0:case 1:switch(bT){case 0:if((H==3&&au!="$")||H==4){av[aw++]=" ";}else{if(aY[au]){H=0;}}break;case 1:aJ++,bj=bU;if(av[aw-1]!="\n"&&!ba[au]){av[aw++]="\n";}if(aY[au]){H=0;}break;case 2:if(bW=a7[bY]){switch(bW){case 1:if(!an[bm-1]){av[aw++]=")",bm-=2;}if(!bx){if(av[aw-1]!="\n"&&au!="{"&&au!=";"){av[aw++]="\n";}}else{if(!bm||an[bm-1]){av[aw++]=";";}}break;case 2:if(!an[bm-1]){av[aw++]=")",bm-=2;}av[aw++]=",";break;case 3:if(av[aw-1]=="\n"||av[aw-1]==";"||au=="{"||au=="} "||aw==be){if(!bx){ad();}av[aw++]="  ";}else{av[aw++]="^";}break;case 4:if(au!="<"&&au!=">"){if(!bx&&av[be-1]!="("){ad(true);}av[aw++]=bY;for(bW=aw;bW>=be&&!bF[av[bW]]&&!((av[bW]=="  "||av[bW]==(bw?az:ak))&&(av[bW]="",1));bW--){}if(H==3&&bA>0&&au.charAt(0)!="."){if(aT){aw-=2;while(A[av[aw]]){aw--;}bV=au;av[aw++]=bc[bY],av[aw++]=bV.slice(0,bA),av[aw++]=",'",av[aw++]=bV.slice(bA+1),av[aw++]="',",an[bm++]=be|(bx<<28),an[bm++]="";}}else{if(av[bW=aw-2]==") "){if(!(bX=aj[bY])||!(bX=bX[av[bV=an[bm]&268435455]])){throw {t:"Invalid xpath assign",p:bU};}av[bV]=bX,av[bW]=",",av[bW+1]="",av[bW+2]="";an[bm++]=be|(bx<<28),an[bm++]="";}}}else{av[aw++]=bY;}break;case 5:if(q[au]){an[bm++]=be|(bx<<28);an[bm++]=av[aw++]=bY;be=C=aw-1;bw++,bx=5,by=bY;}else{av[aw++]="/";}break;case 6:if(bm>2&&an[bm-1]=="{{"&&(aw<be+4&&H==5)||(aw<be+3&&(H==3||H==4))){av[be-1]=an[bm-1]="{";bx=(bW=an[bm-2])>>28;an[bm-2]=bW&268435455,bw--;}else{if(av[aw-3]=="case"||(H==5&&S=="case")){bY=";";}}av[aw++]=":";break;default:av[aw++]=bY;break;}}else{av[aw++]=bC[bY]||bY;}break;case 3:case 4:bW=bX=bV=0;bA=(S=bY).lastIndexOf(".");if(bY.charAt(0)!="."&&((bW=(bX=((a0[au]||av[aw-1]=="\n")&&!aK[au]))&&!an[bm-1].indexOf("{")&&aw>be)||(bV=bF[bY]))&&!bx){if(bV==2&&an[bm-1].indexOf("{")){bV=0;}ad(bV);}if(bX&&!an[bm-1]){av[aw-1]=="\n"&&(av[aw-1]=""),av[aw++]=")",av[aw++]="\n",bW=1,bm-=2;}if(bW&&bx&&!bF[bY]&&!bI[bY]){av[aw++]=(bw?az:ak);}if(bA>0&&bY.charAt(0)!="."){aP[av[aw++]=ag=bY]=1;}else{av[aw++]=aA[bY]||bY;}break;case 5:if((bW=(bX=((a0[au]||av[aw-1]=="\n")&&!aK[au]))&&!an[bm-1].indexOf("{")&&aw>be)&&!bx){ad();}if(bX&&!an[bm-1]){av[aw-1]=="\n"&&(av[aw-1]=""),av[aw++]=")",av[aw++]="\n",bW=1,bm-=2;}if(bW){av[aw++]=(av[aw-2]!="\n"&&N[au])?"+":(bw?az:ak);}else{if(N[au]){av[aw++]="+";}}an[bm++]=be|(bx<<28),an[bm++]=av[aw++]=bY;be=C=aw-1,bw++,bx=5,by=bY;break;case 6:if(bY=="*/"||bY=="-->"){throw {t:"Unmatched comment "+bY,p:bU};}a1=bx,ar=au,aQ=H,bx=6,by=bY;break;case 7:if(av[aw-1]==")  "||(av[aw-2]==")  "&&aw--)){if(an[bm-1]!="("&&an[bm-1]!="["){an[bm++]=be|(bx<<28),an[bm++]="{{",av[aw++]=aX,be=aw,bx=1,bw++,av[aw++]="";}else{an[bm++]=be,an[bm++]=av[aw++]=bY,be=aw;bx=1;}}else{if((aG[an[bm+1]]&&au==")   ")||aI[au]){an[bm++]=be,an[bm++]=av[aw++]=bY,be=aw;av[aw++]="";}else{if((bW=(bX=((a0[au]||av[aw-1]=="\n")&&!aK[au]))&&!an[bm-1].indexOf("{")&&aw>be)&&!bx){ad();}if(bX&&!an[bm-1]){av[aw-1]=="\n"&&(av[aw-1]=""),av[aw++]=")",av[aw++]="\n",bW=1,bm-=2;}if(bW){av[aw++]=(av[aw-2]!="\n"&&N[au])?"+''+":(bw?az:ak);}else{if(N[au]){av[aw++]=(au=="}")?"+''+":"+";}}an[bm++]=be|(bx<<28),an[bm++]=av[aw++]="{{";if(!bw&&be!=aw){bN++;}bw++,C=be=aw,bx=0;}}break;case 8:if(!an[bm-1]){av[aw++]=")",av[aw++]="\n",bm-=2;}if(aW[bW=an[--bm]]!=(av[aw++]=bY)){throw {t:"Cannot close "+bW+" with "+bY,p:bU};}if(bW=="{{"){if(be==aw-1){if((an[bm-1]>>28)<=1){av[be-1]="{",av[aw-1]="}";}else{av[be-1]=av[aw-1]="'";}}else{if(!bx){av[be-1]="(",av[aw-1]=")";}else{if(av[be-1]==aX){if(be==aw-2){av[be-1]="{",av[aw-1]="}";}else{av[aw-1]=a9;}}else{av[aw-1]=R;}}}bx=(bW=an[--bm])>>28,be=bW&268435455;C=aw,bw--;if(!bw){bN++;}if(bx==7){av[aw++]='+"\\"',bx=4;}}else{be=an[--bm];}break;case 9:if(((H==3&&!ai[au]&&au!="$")||au==")"||au=="]")&&av[aw-1]!="\n"){av[aw++]="[",an[bm++]=be|(bx<<28),an[bm++]=bY,C=be=aw;}else{aR=null;if((bV=aY[au])){aw--,au=av[aw-1];if(av[aw-1]=="delete"||(av[aw-2]=="delete"&&aw--)){bV=B[bV],aw--;}}else{bV=W[an[bm-1]]||W[bw?0:aN];if(au=="delete"){bV=B[bV],aw-=2;}}if((bW=(bX=((a0[au]||av[aw-1]=="\n")&&!aK[au]))&&!an[bm-1].indexOf("{")&&(aw>be||an[bm-1].length==1))&&!bx){ad();}if(bX&&!an[bm-1]){av[aw-1]=="\n"&&(av[aw-1]=""),av[aw++]=")",av[aw++]="\n",bW=1,bm-=2;}if(bW){av[aw++]=(av[aw-2]!="\n"&&N[au])?"+":(bw?az:ak);}else{if(N[au]){av[aw++]="+";}}if(!bw&&aw!=be){bN++;}bw++,an[bm++]=be|(bx<<28),an[bm++]=av[aw++]=bV,C=be=aw,aC[be]=bU,bx=3;}break;case 10:if(!an[bm-1]){av[aw++]=")",bm-=2;}if(aW[bW=an[--bm]]!=(av[aw++]=bY)){throw {t:"Cannot close "+bW+" with "+bY,p:bU};}be=an[--bm]&268435455;break;case 11:if(((bW=(bX=((T[au]||av[aw-1]=="\n")&&!aK[au]))&&!an[bm-1].indexOf("{")&&aw>be))&&!bx){ad();}if(bX&&!an[bm-1]){av[aw-1]=="\n"&&(av[aw-1]=""),av[aw++]=")",av[aw++]="\n",bW=1,bm-=2;}if(bW&&bx){av[aw++]=(bw?az:ak),H=0;}if(bV=aG[au]){if(av[aw-1]==" "){aw--;}av[aw-1]=bV,an[bm++]=be,an[bm++]=au,be=C=aw;}else{if(H==3){if(bA<0){bW=0;if(au=="function"||av[aw-3]=="function"||av[aw-4]=="function"){an[bm++]=be,an[bm++]="function",av[aw++]="(",be=C=aw;if(au!="function"&&bv&&bm==4){av[bW=(av[aw-4]=="function")?(aw-4):(aw-5)]="var "+au+" = self."+au+" = function";av[bW+2]="";}}else{if(!bI[au]&&av[aw-3]!="new"){av[aw++]=".call(_n",an[bm++]=be,an[bm++]="_call",be=C=aw;}else{an[bm++]=be,an[bm++]=av[aw++]=bY,be=C=aw;}}}else{if(bA>1&&(bD[bW=au.substring(0,bA)]||bD[bW=au])){if(av[--aw]==" "){aw--;}av[aw++]=F,av[aw++]=bW,av[aw++]=",'";av[aw++]=au.slice(bA+1);av[aw++]=I,an[bm++]=be,an[bm++]="async",be=C=aw,al++;}else{if(au.indexOf(".")!=bA){aP[au.slice(0,bA)]=1;}an[bm++]=be,an[bm++]=av[aw++]=bY,be=C=aw;}}}else{an[bm++]=be,an[bm++]=av[aw++]=bY,be=C=aw;}if(au==ag){delete aP[au];}}break;case 12:if(!an[bm-1]){av[aw-1]=="\n"&&(av[aw-1]=""),av[aw++]=")",av[aw++]="\n",bW=1,bm-=2;}if(bV=aL[bW=an[--bm]]){if(bW!="_call"){bY=")   ";}if((bX=V[bW])&&bX!=av[aw-1]){av[be-1]=bX+",";}av[aw++]=bV;}else{if(aW[bW]!=(av[aw++]=bY)){throw {t:"Cannot close "+bW+" with "+bY,p:bU};}}be=an[--bm]&268435455;break;case 13:if(aw==be||D[au]||av[aw-1]=="\n"){if((bW=(bX=((a0[au]||av[aw-1]=="\n")&&!aK[au]))&&!an[bm-1].indexOf("{")&&aw>be)&&!bx){ad();}if(bX&&!an[bm-1]){av[aw-1]=="\n"&&(av[aw-1]=""),av[aw++]=")",av[aw++]="\n",bW=1,bm-=2;}if(bW){av[aw++]=(av[aw-2]!="\n"&&N[au])?"+''+":(bw?az:ak);}else{if(N[au]){av[aw++]="+";}}bu=null,av[aw++]='"',av[aw++]="<",bw++,an[bm++]=be|(bx<<28),bm+=3,an[bm-2]=an[bm-1]=0;C=be=aw-1,bx=4;}else{av[aw++]="<";}break;case 14:av[aw++]=">";break;case 15:if(bm&&!an[bm-1]){av[aw-1]=="\n"&&(av[aw-1]=""),av[aw++]=")",av[aw++]="\n",bW=1,bm-=2;}break;}break;case 2:switch(bT){case 1:aJ++,bj=bU;if(aw!=be&&aw!=C){av[aw++]="\\n";}break;case 2:if(aw==C){av[aw]=(aw++==be)?'"':'+"';}av[aw++]=J[bY]||bY;break;case 3:if(aw==C){av[aw]=(aw++==be)?'"':'+"';}if(bY.charAt(bY.length-1)=="$"){av[aw++]=bY.slice(0,-1);av[aw++]=bY="$";}else{av[aw++]=bY;}break;case 5:if(aw==C){av[aw]=(aw++==be)?'"':'+"';}av[aw++]=(bY=='"')?'\\"':"'";break;case 7:if(aw==C){if(aw!=be){av[aw++]="+";}}else{av[aw++]='"+',bw||bN++;}an[bm++]=be|536870912,an[bm++]=av[aw++]="{{",bw++,C=be=aw,bx=0;break;case 9:aR=null;if((bV=t[au])&&av[aw-1]==au){if(--aw-1==be){aw--;}}else{bV=W[(bw||be!=aw)?0:aN];}if(aw!=be){av[aw]=(aw++==C)?"+":(bw||bN++,'"+');if(!bw){bN++;}}an[bm++]=be|536870912,an[bm++]=av[aw++]=bV,C=be=aw,bw++,bx=3;break;case 15:if(bm){throw {t:"Unclosed "+an[bm-1]+" found at end in textmode",p:bU};}if(aw!=be&&aw!=C){av[aw++]='"',bw||bN++;}break;default:if(aw==C){av[aw]=(aw++==be)?'"':'+"';}av[aw++]=bY;}break;case 3:switch(bT){case 0:if(aw!=be){if(aw==C){av[aw++]='+"';}av[aw++]=bY;}break;case 1:aJ++,bj=bU;break;case 2:if(bY==":"&&au==":"&&!aZ[bV=av[aw-2]]&&((bW=an[bm-2])>>28)!=6){if(av[aw-2]=='+"'){av[aw-2]=av[aw-1]="",aR="#";}else{av[aw-1]='"';if(C==be){aR=av.slice(C+1,aw-1).join("");}else{aR="#";}}if(!(bV=a8[av[be-1]])){throw {t:"Invalid model found for: "+av[be-1],p:bU};}av[be-1]=bV,av[aw++]=",",C=be=aw;}else{if(bY==","&&(bW=(an[bm-2]>>28))<=1){aw=be-1,bX=bP.slice(aC[be]+1,bU+1);H=9,bx=bW,av[aw++]=au="[";an[bm-2]=(an[bm-2]&268435455)|(bx<<28),an[bm-1]=au,C=be=aw,bw--;if(!bw){bL--;}if(bX.length>1){aD.push(bP);(bP=bX).replace(am,aM);bP=aD.pop();}}else{if(aw==C){av[aw]=(aw++==be)?'"':'+"';}av[aw++]=bC[bY]||bY;}}break;case 3:if(aw==C){av[aw]=(aw++==be)?'"':'+"';}if(bY.charAt(bY.length-1)=="$"){av[aw++]=bY.slice(0,-1);av[aw++]=bY="$";}else{av[aw++]=bY;}break;case 5:if(aw==C){av[aw]=(aw++==be)?'"':'+"';}if(an[bm-1]=="["){an[bm-1]=bY;}else{if(an[bm-1]==bY){an[bm-1]="[";}}if(bY=='"'){av[aw++]="\\";}av[aw++]=bY;break;case 7:if(aw==C){if(aw!=be){av[aw++]="+''+";}}else{av[aw++]='"+';}an[bm++]=be|805306368,an[bm++]=av[aw++]="{{",bw++,C=be=aw,bx=0;if(aR&&an[bm-3]!=t["$"]){bn.push(aR,"#");aR=null,aa++;}break;case 9:if(an[bm-1]=="'"||an[bm-1]=='"'||((H!=3||au=="$")&&au!=")"&&au!="]")){if(aR){bn.push(aR,"#"),aa++;}aR=null;if((bV=t[au])&&av[aw-1]==au){aw--;}else{bV=W[0];}if(aw==C){if(aw!=be){av[aw++]="+";}}else{av[aw++]='"+';}an[bm++]=be|805306368,an[bm++]=av[aw++]=bV,bw++,C=be=aw,bx=3;}else{if(aw==C){av[aw]=(aw++==be)?'"':'+"';}an[bm++]=be|1610612736,an[bm++]=av[aw++]="[";}break;case 10:bm--,bx=(bV=an[--bm])>>28,bV=bV&268435455;if(bx==6){if(an[bm+1]!="["){throw {t:"In xpath, cannot close "+an[bm+1]+" with "+bY,p:bU};}if(aw==C){av[aw]=(aw++==be)?'"':'+"';}av[aw++]="]";bx=3;}else{if(aw==be){if((an[bm]>>28)<=1){av[be-1]="[",av[aw++]="]";}else{av[be-1]=av[aw++]='"';}C=aw;}else{if(aw!=C){av[aw++]='"';}if(C==be){bW=av.slice(C+1,aw-1).join("");if(n&&av[be-1]!=","&&bW!=(bX=bW.replace(ao,"$1self::"))&&an[bm+1]!=t["$"]){av[be+1]=bW=bX;for(bX=be+2;bX<aw-1;bX++){av[bX]="";}}}else{if((bX=av[be-1])!=","){bW="#";if(n){av[be-1]=bX+"_injself(",av[aw++]=")";}}else{bW="";}}if(an[bm+1]!=t["$"]&&bW){bn.push(aR,bW);if(aR){aa++;}}av[aw++]=") ",C=aw;if(bx==7){av[aw++]='+"\\"',bx=4;}}bw--,aR=null;if(!bw){bN++,bL++;}}be=bV;break;case 11:if(aw==C){av[aw]=(aw++==be)?'"':'+"';}an[bm++]=be|805306368,an[bm++]=av[aw++]="(";break;case 12:if(aw==C){av[aw]=(aw++==be)?'"':'+"';}if(aW[bW=an[--bm]]!=(av[aw++]=bY)){throw {t:"Cannot close "+bW+" with "+bY,p:bU};}be=an[--bm]&268435455;break;case 15:throw {t:"Unexpected end whilst parsing xpath",p:bU};break;default:if(aw==C){av[aw]=(aw++==be)?'"':'+"';}av[aw++]=bY;break;}break;case 4:switch(bT){case 0:if(aw==C){av[aw++]='+"';}av[aw++]=" ",H=0;break;case 1:if(aw==C){av[aw++]='+"';}aJ++,bj=bU,av[aw++]="\\n",H=1;break;case 2:if(aw==C){av[aw++]='+"';}if(bY=="/"&&au=="<"){bm-=4;if(an[bm]||an[bm+2]){throw {t:"Unexpected closing tag whilst parsing xml",p:bU};}}else{if(bY==":"&&H==3&&av[aw-2]=="<"){bu=au;}}av[aw++]=J[bY]||bY;break;case 3:if(aw==C){av[aw++]='+"';}if(bY.charAt(bY.length-1)=="$"){av[aw++]=bY.slice(0,-1);av[aw++]=bY="$";}else{av[aw++]=bY;}break;case 5:if(aw==C){av[aw++]='+"';}if(bY=='"'){av[aw++]="\\";}av[aw++]=bY;break;case 6:if(bY=="//"&&!an[bm-1]){if(aw==C){av[aw++]='+"';}av[aw++]=bY;}else{if(bY=="*/"){throw {t:"Unmatched comment "+bY,p:bU};}a1=bx,ar=au,aQ=H,bx=6,by=bY;}break;case 13:bu=null;if(aw==C){av[aw++]='+"';}av[aw++]=bY,an[bm]=an[bm+2]=0,bm+=4,an[bm-1]=0;break;case 14:if(aw==C){av[aw++]='+"';}av[aw++]=bY;if(au!="<"){if(au=="/"){bm-=4;if(an[bm+2]){throw {t:"Unexpected / whilst parsing xml",p:bU};}if(av[aw-3]=="<"){aw-=2,av[aw-1]="";}}else{bm-=2;}if(an[bm]){bw--,av[aw++]='"',be=an[bm],C=aw,bx=be>>28,be=be&268435455;}else{an[bm-1]=1;}}else{aw--,av[aw-1]="";}break;case 9:aR=null;if(au=="!"&&av[aw-2]=="<"&&!an[bm-1]){av[aw++]=bY,an[bm++]=be|(bx<<28);an[bm++]="]]>",be=C=aw-1;bw++,bx=5;}else{if(an[bm-1]){if((bW=bM[au])){aw--;}else{bW=W[bu?bK:0];}an[bm++]=be|1073741824;}else{an[bm++]=be|1073741824;if((bW=bk[au])){aw--;if(av[aw-1]=="="){au="=";}}else{bW=W[bu?aO:8];}if(au=="="){av[aw++]='\\"',an[bm-1]=be|1879048192;}}av[aw]=(aw++==C)?"+''+":'"+';bw++,an[bm++]=av[aw++]=bW,C=be=aw,bx=3;}break;case 7:if(!an[bm-1]&&au=="="){av[aw++]='\\"',an[bm++]=be|1879048192;}else{an[bm++]=be|1073741824;}av[aw]=(aw++==C)?"+''+":'"+';an[bm++]=av[aw++]="{{",bw++;C=be=aw,bx=0;break;default:if(aw==C){av[aw++]='+"';}av[aw++]=bY;break;case 15:throw {t:"Unexpected end whilst parsing xml",p:bU};break;}break;case 5:switch(bT){case 1:aJ++,bj=bU;if(aw==C){av[aw]=(aw++==be)?'"':'+"';}av[aw++]="\\n";break;case 2:if(bY=="/"&&an[bm-1]=="/"){av[aw++]="/",be=an[bm-=2],C=aw,bx=be>>28,be=be&268435455,bw--;}else{if(aw==C){av[aw]=(aw++==be)?'"':'+"';}av[aw++]=(an[bm-1]!="/"&&br[bY])||bY;}break;case 3:if(aw==C){av[aw]=(aw++==be)?"":'+"';}if(bY.charAt(bY.length-1)=="$"){av[aw++]=bY.slice(0,-1);av[aw++]=bY="$";}else{av[aw++]=bY;}break;case 5:if(an[bm-1]==bY){if(be!=C){av[aw]=(aw++!=C)?(bY+")"):")";}else{av[aw++]=bY;}be=an[bm-=2],C=aw,bx=be>>28;be=be&268435455,bw--;}else{if(aw==C){av[aw]=(aw++==be)?'"':'+"';}av[aw++]=bY=='"'?'\\"':bY;}break;case 6:if(an[bm-1]=="/"&&bY=="*/"){av[aw++]="*/",be=an[bm-=2],C=aw,bx=be>>28,be=be&268435455,bw--;}else{if(aw==C){av[aw]=(aw++==be)?"":'+"';}av[aw++]=bY;}break;case 7:if(an[bm-1]!="'"&&an[bm-1]!="/"){if(an[bm-1]=='"'){av[be]='("';}if(aw==C){if(aw!=be){av[aw++]="+";}}else{av[aw++]='"+';}an[bm++]=be|1342177280,av[aw++]=an[bm++]="{{",bw++,C=be=aw,bx=0;}else{av[aw++]=bY;}break;case 9:if(an[bm-1]!="'"&&an[bm-1]!="/"&&(an[bm-1]=='"'&&(av[be]='("')||aw!=be+2||au!="CDATA")){aR=null;if((bV=t[au])&&av[aw-1]==au){aw--;}else{bV=W[0];}if(aw!=be){av[aw]=(aw++==C)?"+":'"+';}an[bm++]=be|1342177280,an[bm++]=av[aw++]=bV,C=be=aw,bw++,bx=3;}else{av[aw++]=bY;}break;case 14:if(aw==C){av[aw]=(aw++==be)?"":'+"';}av[aw++]=bY;if(an[bm-1]=="]]>"&&au=="]"&&av[aw-3]=="]"){be=an[bm-=2],bx=be>>28;be=be&268435455,bw--;bm-=4;if(an[bm]){bw--,av[aw++]='"',be=an[bm],C=aw,bx=be>>28,be=be&268435455;}else{an[bm-1]=1;}}break;case 15:throw {t:"Unexpected end whilst parsing string",p:bU};break;default:if(aw==C){av[aw]=(aw++==be)?"":'+"';}av[aw++]=bY;break;}break;case 6:switch(bT){case 1:aJ++,bj=bU;if(by=="//"){bx=a1,bY=au=ar,bT=H=aQ;}break;case 6:if((by=="/*"&&bY=="*/")||(by=="<!--"&&bY=="-->")){bx=a1,bY=au=ar,bT=H=aQ;}break;case 15:if(by!="//"){throw {t:"Unexpected end whilst parsing comment",p:bU};}else{bx=a1,bY=au=ar,bT=H=aQ;if(bm&&!an[bm-1]){av[aw-1]=="\n"&&(av[aw-1]=""),av[aw++]=")",av[aw++]="\n",bW=1,bm-=2;}}break;}break;}if(bT>1){au=bY,H=bT;}}this.lastCode=function(){if(typeof(av)=="object"){return av.join("");}return av;};function bB(bQ,s,bt){if(bQ.t){throw new Error(apf.formatErrorString(0,null,"Parsing live markup source","Error whilst parsing: "+bQ.t+" on line:"+aJ+" col:"+(bQ.p-s-2)+(bt?(" part: "+bt):"")+"\n"+bP));}else{throw new Error(apf.formatErrorString(0,null,"Compiling live markup function","Error whilst compiling: "+bQ.message+"\nInput:\n"+bP+"\nGenerated:\n"+apf.lm.lastCode()));}}var ah={},Z={};this.resetCache=function(){ah={};};var ax=/^\s*~~(c\d+)~~/;this.compile=function(bt,s){if(!s){s=Z;}if(bt==null||!bt.length){return s.nostring?function(){return bt;}:{type:2,str:bt};}var bT,bR;if(bt.charAt(0)=="~"&&(bT=bt.match(ax))){if(bT=apf.lm_exec[bT[1]]){return bT;}alert("ERROR, undefined live markup cache marker found:"+bt);return{type:2,str:bt};}var bQ=(s.xpathmode|(s.withopt&&16)|(s.precall&&32)|(s.alwayscb&&64)|(s.nostring&&128)|(s.parsecode&&256)|(s.nostate&&512)|(s.editable&&1024)|(s.langedit&&2048)|(s.injectself&&4096)|(s.event&&8192)|(s.funcglobal&&16384))+bt;if(bT=ah[bQ]){return bT;}n=s.injectself,aN=s.xpathmode||0,aO=s.nostate?0:6,bK=s.editable?7:0;bv=s.funcglobal;bM=s.langedit?at:K;aP={},bn=[],an=[],av=["","","",""],bP=bt,O=bP.length;aw=be=C=av.length,bN=bL=al=aa=bw=aJ=H=bj=0;if(s.parsecode){bx=0,bm=2,an[0]=aw,an[1]="{{",au="{",ak=s.event?"":(aN<=1?az:M);}else{bx=2,bm=au=0,ak=az;}if(s.nothrow){bP.replace(am,aM);}else{try{bP.replace(am,aM);}catch(bS){bB(bS,bj);return null;}}if(s.parsecode){if(bw||an[bm-1].length==1){bB({t:"Unclosed "+an[bm-1]+" found at end in codemode",p:O},bj);}if(C!=aw){bN++;}}if(!s.nostring&&(bx==2&&C==4||aw==4)){return{type:2,str:av.slice(5,-1).join("").replace(/\\n/g,"\n").replace(/\\"/g,'"')};}if(al||s.alwayscb){if(s.event){if(bx==1){av[3]="";}av[aw++]=d;}else{if(aN){if(bx==1){av[3]=(av[3]!=G)?L:w,av[aw++]=g;}else{av[3]=aV,av[aw++]=a3;}}else{if(bx==1){av[3]=(av[3]!=G)?bE:ab,av[aw++]=Y;}else{av[3]=bb,av[aw++]=bl;}}}if(al){if(bx==1){if(s.precall){av[2]=a5,av[aw-1]=bg+av[aw-1];}else{av[2]=a6,av[aw-1]=bh+av[aw-1];}}else{av[aw++]=av[3]+"_r"+av[aw-2];if(s.precall){av[2]=a5,av[3]=L,av[aw-2]=bg;}else{av[2]=a6,av[3]=L,av[aw-2]=bh;}}}if(s.withopt){av[1]=bi,av[aw++]=bq;}av[0]=s.event?ac:((aN==1||aN==3)?af:bd);av[aw++]=E;}else{if(s.event){if(bx==1){av[3]="";}}else{if(aN){if(bx==1){av[3]=(av[3]!=G)?L:w,av[aw++]=U;}else{av[3]=a4,av[aw++]=bf;}}else{if(bx==1){av[3]=(av[3]!=G)?bE:ab,av[aw++]=bO;}else{av[3]=aq,av[aw++]=aB;}}}if(s.withopt){av[2]=bi,av[aw++]=bq;}av[0]=s.event?(s.withopt?bo:ae):(s.withopt?((aN==1||aN==3)?j:i):((aN==1||aN==3)?ap:k));av[aw++]=E;}if(s.nothrow){bR=apf.lm_exec.compile(av.join(""));}else{try{bR=apf.lm_exec.compile(av.join(""));}catch(bS){bB(bS,bj);return null;}}bR.type=(bN==1&&bL==1)?3:1;bR.xpaths=bn,bR.models=aa,bR.props=aP,bR.asyncs=al;ah[bQ]=bR;return bR;};this.compileMatch=function(bT,s){if(!s){s=Z;}aP={},bn=[],av=[X,bs],an=[],bw=0,aw=av.length,bM=K;for(var bR,bt,bS=0,bQ=bT.length;bS<bQ;bS+=2){if(bP=bT[bS]){O=an.length,aN=2;if(bS){av[aw++]=P;}av[aw++]="";an[0]=bt=aw=be=C=av.length,ak=M;aJ=H=bN=bL=al=bx=bj=0;bm=2,an[1]="{{",au="{";n=1;if(s.nothrow){bP.replace(am,aM);}else{try{bP.replace(am,aM);}catch(bV){bB(bV,bj);return null;}}if(bw||an[bm-1].length==1){bB({t:"Unclosed "+an[bm-1]+" found at end in codemode",p:O});}if(al){bB({t:"Asynchronous calls not supported in match/value"});}if(bx==1){av[bt-1]=(av[bt-1]!=G)?ak:"",av[aw++]=Q;}else{av[bt-1]=ay,av[aw++]=aF;}}if(bP=bT[bS+1]){O=an.length;if(!bT[bS]&&bS){av[aw++]=P;}av[aw++]="";bt=aw=be=C=av.length,ak=az;aN=n=au=bm=aJ=bN=bL=H=al=bj=0;if(s.node){aN=2;}bx=2,n=0;if(s.nothrow){bP.replace(am,aM);}else{try{bP.replace(am,aM);}catch(bV){bB(bV,bj);return null;}}if(al){bB({t:"Asynchronous calls not supported in match/value"});}if(s.node){if(bx==2&&C==bt||aw==bt){av[bt-1]=c;}else{av[bt-1]=bz,av[aw++]=bJ;}}else{if(bx==2&&C==bt||aw==bt){av[bt-1]=bp;}else{av[bt-1]=aU,av[aw++]=a2;}}if(bT[bS]){av[aw++]=bG;}else{break;}}else{if(!bT[bS]){bB({t:"Both match and value are empty"});}if(s.node){av[aw++]=aS;}else{av[aw++]=u;}aN=2;av[aw++]=bG;}}av[aw++]=E;var bU;if(s.nothrow){bU=apf.lm_exec.compile(av.join(""));}else{try{bU=apf.lm_exec.compile(av.join(""));}catch(bV){bB(bV,bj);return null;}}bU.type=1,bU.xpaths=bn,bU.props=aP,bU.asyncs=al;return bU;};this.setWarnLevel=function(s){apf.lm_exec.setWarnLevel(s);};this.parseExpression=function(bt,s){if(!s){s=Z;}aP={},bn=[],av=[],an=[],bw=0,bM=K;bP=bt,O=bP.length;ob=aw=be=C=av.length,ak=az;aN=n=au=bm=aJ=bN=bL=H=al=bj=0;bx=2;if(s.nothrow){bP.replace(am,aM);}else{try{bP.replace(am,aM);}catch(bQ){bB(bQ,bj);return null;}}return av.join("");};})();apf.lm_exec=new (function(){var wlvl=1;this.setWarnLevel=function(lvl){wlvl=lvl;};function wxpath(x,t){apf.console.warn("Live Markup warning in "+t+", no results for xpath: '"+x+"'");}function wnode(x,t){apf.console.warn("Live Markup warning in "+t+", xpath on null node: '"+x+"'");}function wmodel(m,x,t){apf.console.log("Live Markup warning in "+t+", xpath on empty model: '"+m+"' xpath: '"+x+"'");}function wlang(x,t){apf.console.log("Live Markup warning in "+t+", language symbol not found: '"+x+"'");}function xmlParse(str){var n=apf.getXmlDom("<_apflmlist_>"+str+"</_apflmlist_>");if(!n||!(n=n.documentElement)){return null;}return(n.firstChild==n.lastChild)?n.firstChild:n;}function __val(n,x){if(!n){return(wlvl>1&&wnode(x),"");}return(n=(n.nodeType!=1&&n||(n=n.selectSingleNode(x))&&(n.nodeType!=1&&n||(n=n.firstChild)&&n.nodeType!=1&&n)))&&n.nodeValue||(wlvl>2&&wxpath(x,"_val"),"");}var __valattrrx=/(["'])/g;function __valattrrp(m,a){return m=='"'?"&quot;":"&apos;";}function __valattr(n,x){if(!n){return(wlvl>1&&wnode(x),"");}return(n=(n.nodeType!=1&&n||(n=n.selectSingleNode(x))&&(n.nodeType!=1&&n||(n=n.firstChild)&&n.nodeType!=1&&n)))&&n.nodeValue.replace(__valattrrx,__valattrrp)||(wlvl>2&&wxpath(x,"_val"),"");}function __valm(m,x){var n;if(!m||!(n=(m.charAt&&((m.charAt(0)=="<"&&xmlParse(m))||((n=apf.nameserver.lookup.model[m])&&n.data)))||(m.$isModel?m.data:(m.charAt?0:m)))){return(wlvl>0&&wmodel(m,x,"_valm"),"");}return(n=(n.nodeType!=1&&n||(n=n.selectSingleNode(x))&&(n.nodeType!=1&&n||(n=n.firstChild)&&n.nodeType!=1&&n)))&&n.nodeValue||(wlvl>2&&wxpath(x),"");}function __nod(n,x){return n?n.selectSingleNode(x):(wlvl>1&&wnode(x,"_nod"),null);}function _nods(n,x){return n?n.selectNodes(x):(wlvl>1&&wnode(x,"_nods"),[]);}function __nodm(m,x){var n;if(!m||!(n=(m.charAt&&((m.charAt(0)=="<"&&xmlParse(m))||((n=apf.nameserver.lookup.model[m])&&n.data)))||(m.$isModel?m.data:(m.charAt?0:m)))){return(wlvl>0&&wmodel(m,x,"_nodm"),null);}return n.selectSingleNode(x);}function _nodsm(m,x){var n;if(!m||!(n=(m.charAt&&((m.charAt(0)=="<"&&xmlParse(m))||((n=apf.nameserver.lookup.model[m])&&n.data)))||(m.$isModel?m.data:(m.charAt?0:m)))){return(wlvl>0&&wmodel(m,x,"_nodsm"),[]);}return n.selectNodes(x);}function __cnt(n,x){return n?n.selectNodes(x).length:(wlvl>1&&wnode(x,"_cnt"),0);}function __cntm(m,x){var n;if(!m||!(n=(m.charAt&&((m.charAt(0)=="<"&&xmlParse(m))||((n=apf.nameserver.lookup.model[m])&&n.data)))||(m.$isModel?m.data:(m.charAt?0:m)))){return(wlvl>0&&wmodel(m,x,"_cntm"),0);}return n.selectNodes(x).length;}function _xpt(n,x){return{xpath:x,toString:function(){return"LM Xpath object: "+this.x;}};}function _xptm(m,x){return{model:m,xpath:x,toString:function(){return"LM Xpath object with model: "+this.x;}};}function _xml(n,m,x){if(n){x=m;}else{if(!m||!(n=(m.charAt&&((m.charAt(0)=="<"&&xmlParse(m))||((n=apf.nameserver.lookup.model[m])&&n.data)))||(m.$isModel?m.data:(m.charAt?0:m)))){return(wlvl>0&&wmodel(m,x,"_xml"),"");}}return(n&&(n=n.selectSingleNode(x)))&&n.xml||(wlvl>0&&!n&&wnode(x,"_xml"),"");}function _xmls(n,m,x){if(n){x=m;}else{if(!m||!(n=(m.charAt&&((m.charAt(0)=="<"&&xmlParse(m))||((n=apf.nameserver.lookup.model[m])&&n.data)))||(m.$isModel?m.data:(m.charAt?0:m)))){return(wlvl>0&&wmodel(m,x,"_xmls"),"");}}for(var i=0,j=((n=n.selectNodes(x))).length,o=[];i<j;i++){o[i]=n[i].xml;}return o.join("");}function _valcr(n,cr,m,x){if(n){x=m;}else{if(!m||!(n=(m.charAt&&((m.charAt(0)=="<"&&xmlParse(m))||((n=apf.nameserver.lookup.model[m])&&n.data)))||(m.$isModel?m.data:(m.charAt?0:m)))){return(wlvl>0&&wmodel(m,x,"_valcr"),"");}}if(cr){apf.createNodeFromXpath(ni,x);}else{if(n=ni.selectSingleNode(x)){return(n=(n.nodeType!=1&&n||(n=n.selectSingleNode(x))&&(n.nodeType!=1&&n||(n=n.firstChild)&&n.nodeType!=1&&n)))&&n.nodeValue||"";}}return(wlvl>2&&wxpath(x,"_valcr"),"");}function _nodcr(n,cr,m,x){if(n){x=m;}else{if(!m||!(n=(m.charAt&&((m.charAt(0)=="<"&&xmlParse(m))||((n=apf.nameserver.lookup.model[m])&&n.data)))||(m.$isModel?m.data:(m.charAt?0:m)))){return(wlvl>0&&wmodel(m,x,"_nodcr"),null);}}return n.selectSingleNode(x)||(cr&&apf.createNodeFromXpath(n,x));}function _valst(n,x){var m=apf.xmldb.findModel(n);if(!m){return(wlvl>0&&wmodel(m,x,"_valst"),"");}return"["+m.id+"::"+apf.xmlToXpath(n,m.data,true)+"/"+x+"]";}function _valed(n,m,x){if(n){x=m;}return"<div contenteditable='true' class='contenteditable'>CONTENT_EDITABLE_TODO</div>";}function _nod_del(n,m,x){if(n){x=m;}else{if(!m||!(n=(m.charAt&&((m.charAt(0)=="<"&&xmlParse(m))||((n=apf.nameserver.lookup.model[m])&&n.data)))||(m.$isModel?m.data:(m.charAt?0:m)))){return(wlvl>0&&wmodel(m,x,"_nod_del"),null);}}if(!(n=n.selectSingleNode(x))){return(wlvl>2&&wxpath(m,x,"_nod_del"),null);}apf.xmldb.removeNode(n);}function _nods_del(n,m,x){if(n){x=m;}else{if(!m||!(n=(m.charAt&&((m.charAt(0)=="<"&&xmlParse(m))||((n=apf.nameserver.lookup.model[m])&&n.data)))||(m.$isModel?m.data:(m.charAt?0:m)))){return(wlvl>0&&wmodel(m,x,"_nods_del"),null);}}if(!(n=n.selectNodes(x))){return;}apf.xmldb.removeNodeList(n);}function _nod_asn(n,m,x,v){if(n){v=x,x=m;}else{if(!m||!(n=(m.charAt&&((m.charAt(0)=="<"&&xmlParse(m))||((n=apf.nameserver.lookup.model[m])&&n.data)))||(m.$isModel?m.data:(m.charAt?0:m)))){throw new Error(apf.formatErrorString(0,0,"LM Xpath Assign","Cannot assign to nonresolving model:"+m+"\nxpath:"+x+"\nvalue:"+v));}}if(!n||(x&&!(n=apf.createNodeFromXpath(n,x)))){throw new Error(apf.formatErrorString(0,0,"LM Xpath Assign","Cannot assign could not resolve \nxpath:"+x+"\nvalue:"+v));}var c;if(!v||(v.charAt&&(c=v.charAt(0)!="<"))||typeof(v)=="number"){apf.setNodeValue(n,v,true);return v;}if(!c){if(n.nodeType!=1){throw new Error(apf.formatErrorString(0,0,"LM Xpath Assign","Cannot assign to a non-element node\nxpath:"+x+"\nvalue:"+v));}if(!(c=xmlParse(v))){throw new Error(apf.formatErrorString(0,0,"LM Xpath append","Cannot append broken XML.\nxpath:"+x+"\nvalue:"+v));}if(c.tagName!="_apflmlist_"){return apf.xmldb.replaceNode(c,n);}else{c=c.childNodes;apf.xmldb.replaceNode(n=c[0],n);for(var i=0,j=c.length;i<j;i++){n=apf.xmldb.appendChild(n.parentNode,c[0],n.nextSibling);}return n;}}else{if(v.length){throw new Error(apf.formatErrorString(0,0,"LM Xpath Assign","Assign of xpath nodelists not yet supported\nxpath:"+x+"\nvalue:"+v));}else{if(!v.selectNodes){throw new Error(apf.formatErrorString(0,0,"LM Xpath Assign","Cannot assign non-element node\nxpath:"+x+"\nvalue:"+v));}if(v.nodeType==2){if(n.nodeType!=2){throw new Error(apf.formatErrorString(0,0,"LM Xpath Assign","Cannot assign attribute node to replace non attribute, use += xpath:"+x+"\nvalue:"+v));}apf.xmldb.removeAttribute(c=n.ownerElement||n.selectSingleNode(".."),n.nodeName);apf.xmldb.setAttribute(c,v.nodeName,v.nodeValue);c.getAttributeNode(v.nodeName);}else{apf.xmldb.replaceNode(v,n);}}}return v;}function _nods_asn(n,m,x,v){if(n){v=x,x=m;}else{if(!m||!(n=(m.charAt&&((m.charAt(0)=="<"&&xmlParse(m))||((n=apf.nameserver.lookup.model[m])&&n.data)))||(m.$isModel?m.data:(m.charAt?0:m)))){throw new Error(apf.formatErrorString(0,0,"LM Xpath Assign","Cannot assign to nonresolving model:"+m+"\nxpath:"+x+"\nvalue:"+v));}}for(var i=0,j=(n=n.selectNodes(x)).length;i<j;i++){_nod_asn(n[i],null,v);}return v;}function _nod_add(n,m,x,v){if(n){v=x,x=m;}else{if(!m||!(n=(m.charAt&&((m.charAt(0)=="<"&&xmlParse(m))||((n=apf.nameserver.lookup.model[m])&&n.data)))||(m.$isModel?m.data:(m.charAt?0:m)))){throw new Error(apf.formatErrorString(0,0,"LM Xpath append","Cannot append to nonresolving model:"+m+"\nxpath:"+x+"\nvalue:"+v));}}if(!n||(x&&!(n=n.selectSingleNode(x)))){return _nod_asn(n,0,x,v);}var c;if(!v||(v.charAt&&(c=v.charAt(0)!="<"))||typeof(v)=="number"){apf.setNodeValue(n,v=((n=(n.nodeType!=1&&n||(n=n.selectSingleNode(x))&&(n.nodeType!=1&&n||(n=n.firstChild)&&n.nodeType!=1&&n)))&&n.nodeValue||"")+v,true);return v;}if(!c){if(n.nodeType!=1){throw new Error(apf.formatErrorString(0,0,"LM Xpath append","Cannot append to a non-element node\nxpath:"+x+"\nvalue:"+v));}if(!(c=xmlParse(v))){throw new Error(apf.formatErrorString(0,0,"LM Xpath append","Cannot append broken XML.\nxpath:"+x+"\nvalue:"+v));}if(c.tagName!="_apflmlist_"){return apf.xmldb.appendChild(n.parentNode,xmlParse(v),n.nextSibling);}else{c=c.childNodes;for(var i=0,j=c.length;i<j;i++){n=apf.xmldb.appendChild(n.parentNode,c[0],n.nextSibling);}return n;}}else{if(v.length){throw new Error(apf.formatErrorString(0,0,"LM Xpath append","Nodelists not yet supported\nxpath:"+x+"\nvalue:"+v));}else{if(!v.selectNodes){throw new Error(apf.formatErrorString(0,0,"LM Xpath append","Cannot assign non-element node\nxpath:"+x+"\nvalue:"+v));}if(v.nodeType==2){if(n.nodeType!=1){throw new Error(apf.formatErrorString(0,0,"LM Xpath append","Cannot append attribute to anything but element node"));}apf.xmldb.setAttribute(c=n.ownerElement||n.selectSingleNode(".."),v.nodeName,v.nodeValue);apf.xmldb.removeAttribute(v.ownerElement||v.selectSingleNode(".."),v.nodeName);return c.getAttributeNode(v.nodeName);}else{return apf.xmldb.appendChild(n.parentNode,v,n.nextSibling);}}}}function _nods_add(n,m,x,v){if(n){v=x,x=m;}else{if(!m||!(n=(m.charAt&&((m.charAt(0)=="<"&&xmlParse(m))||((n=apf.nameserver.lookup.model[m])&&n.data)))||(m.$isModel?m.data:(m.charAt?0:m)))){throw new Error(apf.formatErrorString(0,0,"LM Xpath Assign","Cannot append to nonresolving model:"+m+"\nxpath:"+x+"\nvalue:"+v));}}for(var i=0,j=(n=n.selectNodes(x)).length;i<j;i++){_nod_add(n[i],null,v);}return v;}function _asn(o,p,v){if(!o||typeof(o)!="object"){throw new Error(apf.formatErrorString(0,0,"LM Property Assign","Cannot assign property on non object, property:"+p));}if(o.setAttribute){o.setAttribute(p,v);}else{o[p]=v;}return v;}function _add(o,p,v){return _asn(o,p,o&&o[p]+v);}function _sub(o,p,v){return _asn(o,p,o&&o[p]-v);}function _div(o,p,v){return _asn(o,p,o&&o[p]/v);}function _mul(o,p,v){return _asn(o,p,o&&o[p]*v);}function _local(n){if(n&&n.charAt&&n.charAt(0)=="<"){return apf.getXmlDom(n).documentElement;}if(!n&&wlvl>1){wnode("-","_local");}return n;}function _tagName(n1,n2){return(n2&&n2.tagName)||(n1&&n1.tagName);}function _localName(n1,n2){return(n2&&n2[apf.TAGNAME])||(n1&&n1[apf.TAGNAME]);}function _nodeValue(n,n2){if(n2){n=n2;}return(n=(n.nodeType!=1&&n||(n.nodeType!=1&&n||(n=n.firstChild)&&n.nodeType!=1&&n)))&&n.nodeValue||"";}function __ret(r){return r;}function __lng(x,x2){return"$["+x+"]";}function _lnged(x,x2){return"$["+x+"]";}function _injself(s){return s.charAt?s.replace(selfrx,"$1self::"):s;}apf.$lmx=null;function _async(_n,_c,_a,_w,_f,_this,obj,func,args){var i=_a.i,v;if(!_a.ret){_a.ret=[];}if(_a[i]){return _a.ret[i];}_a[i]=true;if(!obj.exec){return _a.ret[i]=(func)?obj[func].apply(obj,args):obj.apply(obj,args);}var cb=function(data,state,extra){if(_w){delete _w._pc;}if(state!=apf.SUCCESS){_c(null,state,extra);}else{apf.$lmx=extra;_a.ret[i]=data;if(_w){_f.call(_this,_n,_c,_w,_a);}else{_f.call(_this,_n,_c,_a);}}};if(_w&&_w._pc){_w._pc={obj:obj,func:func,args:args,message:obj.createMessage&&obj.createMessage(func,args),_c:_c,cb:cb};}else{obj.exec(func,args,cb);}throw ({x:1});}function _pc(_w){var o;if(typeof(o=_w._pc)!="object"||!o){return;}o.obj.exec(o.func,o.args,o.cb,{message:o.message});throw ({x:1});}var _clut=apf.color?apf.color.colorshex:{},_cparse=/^(rgb|hsv|hsb)\(\s+(\d+)\s+,\s+(\d+)\s+,\s+(\d+)\)/;function _cthex(c){var t;if((t=typeof(c))=="string"){if(c.indexOf("#")==0){if(c.length==7){return parseInt(c.slice(-1),16);}return parseInt(c.slice(-1),16);}if(t=_clut[a]){return t;}if(c=c.match(_cparse)){if((t=c[1])=="rgb"){return(((t=c[2])<0?0:(t>255?255:parseInt(t)))<<16)+(((t=c[3])<0?0:(t>255?255:parseInt(t)))<<8)+(((t=c[4])<0?0:(t>255?255:parseInt(t))));}else{var h=parseFloat(c[2]),s=parseFloat(c[3]),v=parseFloat(c[4]),i,m=v*(1-s),n=v*(1-s*((i=floor(((h<0?-h:h)%1)*6))?h-i:1-(h-i)));switch(i){case 6:case 0:return((v&255)<<16)+((n&255)<<8)+(m&255);case 1:return((n&255)<<16)+((v&255)<<8)+(m&255);case 2:return((m&255)<<16)+((v&255)<<8)+(n&255);case 3:return((m&255)<<16)+((n&255)<<8)+(v&255);case 4:return((n&255)<<16)+((m&255)<<8)+(v&255);default:case 5:return((v&255)<<16)+((m&255)<<8)+(n&255);}}}}else{if(t=="number"){return t;}}return null;}function lin(f,a,b){var fa=parseFloat(a),fb=parseFloat(b),fm=1-(f=f<0?0:(f>1?1:f));if(fa!=a||fb!=b){return(((fa=_cthex(a))&16711680)*f+((fb=_cthex(b))&16711680)*fm)&16711680|((fa&65280)*f+(fb&65280)*fm)&65280|((fa&255)*f+(fb&255)*fm)&255;}return f*fa+fm*fb;}var abs=Math.abs,acos=Math.acos,asin=Math.asin,atan=Math.atan,atan2=Math.atan2,ceil=Math.ceil,cos=Math.cos,exp=Math.exp,floor=Math.floor,log=Math.log,max=Math.max,min=Math.min,pow=Math.pow,random=Math.random,round=Math.round,sin=Math.sin,sqrt=Math.sqrt,tan=Math.tan,linear=lin;function tsin(x){return 0.5*sin(x)+0.5;}function tcos(x){return 0.5*cos(x)+0.5;}function usin(x){return 0.5-0.5*sin(x);}function ucos(x){return 0.5-0.5*cos(x);}function snap(a,b){return round(a/b)*b;}function clamp(a,b,c){return a<b?b:(a>c?c:a);}this.compile=function(code){var _ret=__ret,_val=__val,_valm=__valm,_nod=__nod,_nodm=__nodm,_cnt=__cnt,_cntm=__cntm,_lng=__lng,_valattr=__valattr;eval(code);return _f;};var LMBEGINCACHE;var LMENDCACHE;})();apf.url=function(n){var j;if(n.indexOf(":")==-1&&(j=location.toString()).indexOf(":")!=-1){j=new apf.url(j);n=apf.getAbsolutePath(j.protocol+"://"+j.host+"/"+(j.directory.charAt(j.directory.length-1)=="/"?j.directory:j.directory+"/"),n).replace(/\/\/\/\//,"///");}var k=apf.url.options,d=k.parser[k.strictMode?"strict":"loose"].exec(n),g=14;this.uri=n.toString();while(g--){this[k.key[g]]=d[g]||"";}this[k.q.name]={};var c=this;this[k.key[12]].replace(k.q.parser,function(q,i,s){if(i){c[k.q.name][i]=s;}});this.isSameLocation=function(){if(this.uri.length&&this.uri.charAt(0)=="#"){return false;}if(!this.protocol&&!this.port&&!this.host){return true;}if(!this.protocol&&this.host&&this.port&&window.location.hostname==this.host&&window.location.port==this.port){return true;}if(!this.protocol&&this.host&&!this.port&&window.location.hostname==this.host&&window.location.port==80){return true;}return window.location.protocol==(this.protocol+":")&&window.location.hostname==this.host&&(window.location.port==this.port||!window.location.port&&!this.port);};};apf.url.options={strictMode:false,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}};apf.runXpath=function(){apf.XPath={cache:{},getSelf:function(htmlNode,tagName,info,count,num,sResult){var numfound=0,result=null,data=info[count];if(data){data[0](htmlNode,data[1],info,count+1,numfound++,sResult);}else{sResult.push(htmlNode);}},getChildNode:function(htmlNode,tagName,info,count,num,sResult){var numfound=0,result=null,data=info[count];var nodes=htmlNode.childNodes;if(!nodes){return;}for(var i=0;i<nodes.length;i++){if(tagName&&(tagName!=nodes[i].tagName)&&(nodes[i].style?nodes[i].tagName.toLowerCase():nodes[i].tagName)!=tagName){continue;}htmlNode=nodes[i];if(data){data[0](nodes[i],data[1],info,count+1,numfound++,sResult);}else{sResult.push(nodes[i]);}}},doQuery:function(htmlNode,qData,info,count,num,sResult){var result=null,data=info[count];var query=qData[0];var returnResult=qData[1];try{var qResult=eval(query);}catch(e){apf.console.error(e.name+" "+e.type+":"+apf.XPath.lastExpr+"\n\n"+query);return;}if(returnResult){return sResult.push(qResult);}if(!qResult||qResult.dataType==apf.ARRAY&&!qResult.length){return;}if(data){data[0](htmlNode,data[1],info,count+1,0,sResult);}else{sResult.push(htmlNode);}},getTextNode:function(htmlNode,empty,info,count,num,sResult){var data=info[count],nodes=htmlNode.childNodes;for(var i=0;i<nodes.length;i++){if(nodes[i].nodeType!=3&&nodes[i].nodeType!=4){continue;}if(data){data[0](nodes[i],data[1],info,count+1,i,sResult);}else{sResult.push(nodes[i]);}}},getAnyNode:function(htmlNode,empty,info,count,num,sResult){var data=info[count],nodes=htmlNode.getElementsByTagName("*");for(var i=0;i<nodes.length;i++){if(data){data[0](nodes[i],data[1],info,count+1,i,sResult);}else{sResult.push(nodes[i]);}}},getAttributeNode:function(htmlNode,attrName,info,count,num,sResult){if(!htmlNode||htmlNode.nodeType!=1){return;}if(attrName=="*"){var nodes=htmlNode.attributes;for(var i=0;i<nodes.length;i++){arguments.callee.call(this,htmlNode,nodes[i].nodeName,info,count,i,sResult);}return;}var data=info[count],value=htmlNode.getAttributeNode(attrName);if(data){data[0](value,data[1],info,count+1,0,sResult);}else{if(value){sResult.push(value);}}},getAllNodes:function(htmlNode,x,info,count,num,sResult){var data=info[count],tagName=x[0],inclSelf=x[1],prefix=x[2],nodes,i,l;if(inclSelf&&(htmlNode.tagName==tagName||tagName=="*"||tagName=="node()")){if(data){data[0](htmlNode,data[1],info,count+1,0,sResult);}else{sResult.push(htmlNode);}}if(tagName=="node()"){tagName="*";prefix="";if(apf.isIE){nodes=htmlNode.getElementsByTagName("*");}else{nodes=[];(function recur(x){for(var n,i=0;i<x.childNodes.length;i++){n=x.childNodes[i];if(n.nodeType!=1){continue;}nodes.push(n);recur(n);}})(htmlNode);}}else{nodes=htmlNode.getElementsByTagName((prefix&&(apf.isGecko||apf.isOpera||htmlNode.nodeFunc)?prefix+":":"")+tagName);}for(i=0,l=nodes.length;i<l;i++){if(data){data[0](nodes[i],data[1],info,count+1,i,sResult);}else{sResult.push(nodes[i]);}}},getAllAncestorNodes:function(htmlNode,x,info,count,num,sResult){var data=info[count],tagName=x[0],inclSelf=x[1],i=0,s=inclSelf?htmlNode:htmlNode.parentNode;while(s&&s.nodeType==1){if(s.tagName==tagName||tagName=="*"||tagName=="node()"){if(data){data[0](s,data[1],info,count+1,++i,sResult);}else{sResult.push(s);}}s=s.parentNode;}},getParentNode:function(htmlNode,empty,info,count,num,sResult){var data=info[count],node=htmlNode.parentNode;if(data){data[0](node,data[1],info,count+1,0,sResult);}else{if(node){sResult.push(node);}}},getPrecedingSibling:function(htmlNode,tagName,info,count,num,sResult){var data=info[count],node=htmlNode.previousSibling;while(node){if(tagName!="node()"&&(node.style?node.tagName.toLowerCase():node.tagName)!=tagName){node=node.previousSibling;continue;}if(data){data[0](node,data[1],info,count+1,0,sResult);}else{if(node){sResult.push(node);break;}}}},getFollowingSibling:function(htmlNode,tagName,info,count,num,sResult){var result=null,data=info[count];var node=htmlNode.nextSibling;while(node){if(tagName!="node()"&&(node.style?node.tagName.toLowerCase():node.tagName)!=tagName){node=node.nextSibling;continue;}if(data){data[0](node,data[1],info,count+1,0,sResult);}else{if(node){sResult.push(node);break;}}}},multiXpaths:function(contextNode,list,info,count,num,sResult){for(var i=0;i<list.length;i++){info=list[i][0];var rootNode=(info[3]?contextNode.ownerDocument.documentElement:contextNode);info[0](rootNode,info[1],list[i],1,0,sResult);}sResult.makeUnique();},compile:function(sExpr){var isAbsolute=sExpr.match(/^\//);sExpr=sExpr.replace(/\[(\d+)\]/g,"/##$1").replace(/\|\|(\d+)\|\|\d+/g,"##$1").replace(/\.\|\|\d+/g,".").replace(/\[([^\]]*)\]/g,function(match,m1){return"/##"+m1.replace(/\|/g,"_@_");});if(sExpr=="/"||sExpr=="."){return sExpr;}return this.processXpath(sExpr.replace(/\/\//g,"descendant::"),isAbsolute);},processXpath:function(sExpr,isAbsolute){var results=[],i,l,m,query;sExpr=sExpr.replace(/'[^']*'/g,function(m){return m.replace("|","_@_");});sExpr=sExpr.split("|");for(i=0,l=sExpr.length;i<l;i++){sExpr[i]=sExpr[i].replace(/_\@\_/g,"|");}if(sExpr.length==1){sExpr=sExpr[0];}else{for(i=0,l=sExpr.length;i<l;i++){sExpr[i]=this.processXpath(sExpr[i]);}results.push([this.multiXpaths,sExpr]);return results;}var sections=sExpr.split("/");for(i=0,l=sections.length;i<l;i++){if(sections[i]=="."||sections[i]==""){continue;}else{if(sections[i]==".."){results.push([this.getParentNode,null]);}else{if(sections[i].match(/^[\w-_\.]+(?:\:[\w-_\.]+){0,1}$/)){results.push([this.getChildNode,sections[i]]);}else{if(sections[i].match(/^\#\#(\d+)$/)){results.push([this.doQuery,["num+1 == "+parseInt(RegExp.$1)]]);}else{if(sections[i].match(/^\#\#(.*)$/)){query=RegExp.$1;m=[query.match(/\(/g),query.match(/\)/g)];if(m[0]||m[1]){while(!m[0]&&m[1]||m[0]&&!m[1]||m[0].length!=m[1].length){if(!sections[++i]){break;}query+="/"+sections[i];m=[query.match(/\(/g),query.match(/\)/g)];}}results.push([this.doQuery,[this.compileQuery(query)]]);}else{if(sections[i]=="*"){results.push([this.getChildNode,null]);}else{if(sections[i].substr(0,2)=="[]"){results.push([this.getAllNodes,["*",false]]);}else{if(sections[i].match(/descendant-or-self::node\(\)$/)){results.push([this.getAllNodes,["*",true]]);}else{if(sections[i].match(/descendant-or-self::([^\:]*)(?:\:(.*)){0,1}$/)){results.push([this.getAllNodes,[RegExp.$2||RegExp.$1,true,RegExp.$1]]);}else{if(sections[i].match(/descendant::([^\:]*)(?:\:(.*)){0,1}$/)){results.push([this.getAllNodes,[RegExp.$2||RegExp.$1,false,RegExp.$1]]);}else{if(sections[i].match(/ancestor-or-self::([^\:]*)(?:\:(.*)){0,1}$/)){results.push([this.getAllAncestorNodes,[RegExp.$2||RegExp.$1,true,RegExp.$1]]);}else{if(sections[i].match(/ancestor::([^\:]*)(?:\:(.*)){0,1}$/)){results.push([this.getAllAncestorNodes,[RegExp.$2||RegExp.$1,false,RegExp.$1]]);}else{if(sections[i].match(/^\@(.*)$/)){results.push([this.getAttributeNode,RegExp.$1]);}else{if(sections[i]=="text()"){results.push([this.getTextNode,null]);}else{if(sections[i]=="node()"){results.push([this.getChildNode,null]);}else{if(sections[i].match(/following-sibling::(.*)$/)){results.push([this.getFollowingSibling,RegExp.$1.toLowerCase()]);}else{if(sections[i].match(/preceding-sibling::(.*)$/)){results.push([this.getPrecedingSibling,RegExp.$1.toLowerCase()]);}else{if(sections[i]=="self::node()"){results.push([this.getSelf,null]);}else{if(sections[i].match(/self::(.*)$/)){results.push([this.doQuery,["apf.XPath.doXpathFunc(htmlNode, 'local-name') == '"+RegExp.$1+"'"]]);}else{query=sections[i];m=[query.match(/\(/g),query.match(/\)/g)];if(m[0]||m[1]){while(!m[0]&&m[1]||m[0]&&!m[1]||m[0].length!=m[1].length){if(!sections[++i]){break;}query+="/"+sections[i];m=[query.match(/\(/g),query.match(/\)/g)];}}results.push([this.doQuery,[this.compileQuery(query),true]]);}}}}}}}}}}}}}}}}}}}}results[0][3]=isAbsolute;return results;},compileQuery:function(code){return new apf.CodeCompilation(code).compile();},doXpathFunc:function(contextNode,type,nodelist,arg2,arg3,xmlNode,force){if(!nodelist||nodelist.length==0){nodelist="";}if(type=="not"){return !nodelist;}if(!force){var arg1,i,l;if(typeof nodelist=="object"||nodelist.dataType==apf.ARRAY){if(nodelist&&!nodelist.length){nodelist=[nodelist];}var res=false,value;for(i=0,l=nodelist.length;i<l;i++){xmlNode=nodelist[i];if(!xmlNode||typeof xmlNode=="string"||"position|last|count|local-name|name".indexOf(type)>-1){value=xmlNode;}else{if(xmlNode.nodeType==1&&xmlNode.firstChild&&xmlNode.firstChild.nodeType!=1){xmlNode=xmlNode.firstChild;}value=xmlNode.nodeValue;}if(res=arguments.callee.call(this,contextNode,type,value,arg2,arg3,xmlNode,true)){return res;}}return res;}else{arg1=nodelist;}}switch(type){case"position":return apf.getChildNumber(contextNode)+1;case"format-number":return apf.formatNumber(arg1);case"floor":return Math.floor(arg1);case"ceiling":return Math.ceil(arg1);case"starts-with":return arg1?arg1.substr(0,arg2.length)==arg2:false;case"string-length":return arg1?arg1.length:0;case"count":return arg1?arg1.length:0;case"last":return arg1?arg1[arg1.length-1]:null;case"name":var c=xmlNode||contextNode;return c.nodeName||c.tagName;case"local-name":var c=xmlNode||contextNode;if(c.nodeType!=1){return false;}return c.tagName.split(":").pop();case"substring":return arg1&&arg2?arg1.substring(arg2,arg3||0):"";case"contains":return arg1&&arg2?arg1.indexOf(arg2)>-1:false;case"concat":var str="";for(i=1,l=arguments.length;i<l;i++){if(typeof arguments[i]=="object"){str+=getNodeValue(arguments[i][0]);continue;}str+=arguments[i];}return str;case"translate":for(i=0,l=arg2.length;i<l;i++){arg1=arg1.replace(arg2.substr(i,1),arg3.substr(i,1));}return arg1;}},selectNodeExtended:function(sExpr,contextNode,match){var sResult=this.selectNodes(sExpr,contextNode);if(sResult.length==0){return null;}if(!match){return sResult;}for(var i=0,l=sResult.length;i<l;i++){if(getNodeValue(sResult[i])==match){return[sResult[i]];}}return null;},getRoot:function(xmlNode){while(xmlNode.parentNode&&xmlNode.parentNode.nodeType==1){xmlNode=xmlNode.parentNode;}return xmlNode.parentNode;},selectNodes:function(sExpr,contextNode){if(!this.cache[sExpr]){this.cache[sExpr]=this.compile(sExpr);}if(sExpr.length>20){this.lastExpr=sExpr;this.lastCompile=this.cache[sExpr];}if(typeof this.cache[sExpr]=="string"){if(this.cache[sExpr]=="."){return[contextNode];}if(this.cache[sExpr]=="/"){return[(contextNode.nodeType==9?contextNode.documentElement:this.getRoot(contextNode))];}}if(typeof this.cache[sExpr]=="string"&&this.cache[sExpr]=="."){return[contextNode];}var info=this.cache[sExpr][0],rootNode=(info[3]?(contextNode.nodeType==9?contextNode.documentElement:this.getRoot(contextNode)):contextNode),sResult=[];if(rootNode){info[0](rootNode,info[1],this.cache[sExpr],1,0,sResult);}return sResult;}};function getNodeValue(sResult){if(sResult.nodeType==1){return sResult.firstChild?sResult.firstChild.nodeValue:"";}if(sResult.nodeType>1||sResult.nodeType<5){return sResult.nodeValue;}return sResult;}apf.CodeCompilation=function(code){this.data={F:[],S:[],I:[],X:[]};this.compile=function(){code=code.replace(/ or /g," || ").replace(/ and /g," && ").replace(/!=/g,"{}").replace(/=/g,"==").replace(/\{\}/g,"!=");this.tokenize();this.insert();code=code.replace(/, \)/g,", htmlNode)");return code;};this.tokenize=function(){var data=this.data.F;code=code.replace(/(translate|format-number|contains|substring|local-name|last|position|round|starts-with|string|string-length|sum|floor|ceiling|concat|count|not)\s*\(/g,function(d,match){return(data.push(match)-1)+"F_";});data=this.data.S;code=code.replace(/'([^']*)'/g,function(d,match){return(data.push(match)-1)+"S_";}).replace(/"([^"]*)"/g,function(d,match){return(data.push(match)-1)+"S_";});data=this.data.X;code=code.replace(/(^|\W|\_)([\@\.\/A-Za-z\*][\*\.\@\/\w\-]*(?:\(\)){0,1})/g,function(d,m1,m2){return m1+(data.push(m2)-1)+"X_";}).replace(/(\.[\.\@\/\w]*)/g,function(d,m1,m2){return(data.push(m1)-1)+"X_";});data=this.data.I;code=code.replace(/(\d+)(\W)/g,function(d,m1,m2){return(data.push(m1)-1)+"I_"+m2;});};this.insert=function(){var data=this.data;code=code.replace(/(\d+)X_\s*==\s*(\d+S_)/g,function(d,nr,str){return"apf.XPath.selectNodeExtended('"+data.X[nr].replace(/'/g,"\\'")+"', htmlNode, "+str+")";}).replace(/(\d+)([FISX])_/g,function(d,nr,type){var value=data[type][nr];if(type=="F"){return"apf.XPath.doXpathFunc(htmlNode, '"+value+"', ";}else{if(type=="S"){return"'"+value+"'";}else{if(type=="I"){return value;}else{if(type=="X"){return"apf.XPath.selectNodeExtended('"+value.replace(/'/g,"\\'")+"', htmlNode)";}}}}}).replace(/, \)/g,")");};};};apf.dump2=apf.vardump2=function(n,k,j,u){if(apf.isWebkit){return"";}if(!n){return n+"";}if(!u){u="";}if(!k){k=0;}var t;switch(n.dataType){case apf.STRING:return'"'+n+'"';case apf.NUMBER:return n;case apf.BOOLEAN:return(n?"true":"false");case apf.DATE:return'Date("'+n+")";case apf.ARRAY:if(n[n.length-2]=="$__vardump"){return"this"+n[n.length-1];}n.push("$__vardump",u);t=["[ "];for(var q=0;q<n.length-2;q++){t.push(t.length>1?",":"",(j&&k>0?"{/*"+typeof(n[q])+"*/}":apf.vardump2(n[q],k+1,j,u+"["+q+"]")));}t.push(" ]");n.pop();n.pop();return t.join("");default:if(typeof n=="function"){return"{/*function*/}";}if(n.nodeType!==undefined&&n.style&&k!=0){return"{/*HTML Element: "+n.tagName+"*/}";}if(n.nodeType!==undefined){return"{/*XML Element : "+n.tagName+"*/}";}if(j&&k>0){return"{/*object/*}";}if(n["$__vardump"]){return"this"+n["$__vardump"]+"";}n["$__vardump"]=u;t=["{\n"];for(var c in n){if(c!="$__vardump"){try{var g=(parseInt(c)==c)?"0x"+("00000000"+parseInt(c).toString(16)).slice(-8):c;if(t.length>1){t.push(",\n");}t.push("\t".repeat(k+1),g,": ",(j&&k>0?"{/*"+typeof(n[c])+"*/}":apf.vardump2(n[c],k+1,j,u+"."+c)));}catch(s){t.push("\t".repeat(k+1),c,": null /*ERROR*/");}}}t.push("\n",("\t".repeat(k)),"}");function d(w){if(!w["$__vardump"]){return;}delete w["$__vardump"];for(var A in w){var i=w[A];if(typeof(i)=="object"){d(w);}}}d(n);return t.join("");}};if(apf.isOpera){window.console={};["log","debug","info","warn","error"].forEach(function(c){window.console[c]=function(){if(typeof arguments==="undefined"){return null;}if(arguments.length===1){opera.postError(c+": "+arguments[0]);return c+": "+arguments[0];}var k=arguments[0],n=/%([sdifo])/g,j=0,g=null;while(g=n.exec(k)){k=k.replace(g[0],String(arguments[++j]));}var d=arguments.length;while(d>j++){if(arguments[j]){k+=" ";k+=String(arguments[j]);}}opera.postError(c+": "+k);};});}apf.dump=apf.vardump=function(k,q,g,c){if(!k){return k+"";}if(!q){q=0;}switch(k.dataType){case"string":return'"'+k+'"';case"number":return k;case"boolean":return k?"true":"false";case"date":return"Date["+new Date()+"]";case"array":var n="{\n";for(var d=0;d<k.length;d++){n+="     ".repeat(q+1)+d+" => "+(!g&&q>0?typeof k[d]:apf.vardump(k[d],q+1,!g))+"\n";}n+="     ".repeat(q)+"}";return n;default:if(typeof k=="function"){return"function";}if(k.xml||k.serialize){return q==0?"[ "+(k.xml||k.serialize())+" ]":"XML Element";}if(!g&&q>0){return"object";}var n="{\n";for(prop in k){try{n+="     ".repeat(q+1)+prop+" => "+(!g&&q>0?typeof k[prop]:apf.vardump(k[prop],q+1,!g))+"\n";}catch(j){n+="     ".repeat(q+1)+prop+" => [ERROR]\n";}}n+="     ".repeat(q)+"}";return n;}};String.prototype.s=function(){return this.replace(/[\r\n]/g,"");};apf.alert_r=function(d,c){alert(apf.vardump(d,null,c));};apf.alert_r2=function(d,c){alert(apf.vardump2(d,null,!c));};apf.ProfilerClass=function(c){this.totalTime=0;this.start=function(d){if(d){this.totalTime=0;}this.startTime=new Date().getTime();this.isStarted=true;};this.stop=this.end=function(){if(!this.startTime){return;}this.totalTime+=new Date().getTime()-this.startTime;this.isStarted=false;};this.addPoint=function(d){this.end();apf.console.time("[TIME] "+(d||"Profiled Section")+": "+this.totalTime+"ms");this.start(true);};if(!c){this.start();}};apf.Latometer=new apf.ProfilerClass(true);if(self.navigator&&navigator.userAgent.indexOf("Opera")!=-1){window.console={};["log","debug","info","warn","error"].forEach(function(c){window.console[c]=function(){if(typeof arguments==="undefined"){return null;}if(arguments.length===1){opera.postError(c+": "+arguments[0]);return c+": "+arguments[0];}var k=arguments[0],n=/%([sdifo])/g,j=0,g=null;while(g=n.exec(k)){k=k.replace(g[0],String(arguments[++j]));}var d=arguments.length;while(d>j++){if(arguments[j]){k+=" ";k+=String(arguments[j]);}}opera.postError(c+": "+k);};});}function prettySize(c){if(c<1024){return c+" Bytes";}else{if(c<1024*1024){return Math.round(c/1024)+" KB";}else{if(c<1024*1024*1024){return Math.round(c/(1024*1024))+" MB";}}}}apf.$debugwin={resPath:"",showtime:true,nativedebug:false,highlighthover:true,cache:(function(){apf.isDebugWindow=self.frameElement&&self.frameElement.isDebugWin>-1;return apf.isDebugWindow?self.parent.apf.$debugwin.cache:[];})(),apf:(function(){if(apf.isDebugWindow){var c=self.parent.apf;apf.xmldb.$xmlDocLut=c.xmldb.$xmlDocLut;apf.xmldb.$listeners=c.xmldb.$listeners;apf.xmldb.$nodeCount=c.xmldb.$nodeCount;(apf.$asyncObjects||(apf.$asyncObjects={}))["$apf_ide_mdlProps"]=1;return c;}return apf;})(),init:function(){this.updateLog();this.apf.addEventListener("debug",this.debugHandler);apf.importCssString(".console_date{display:inline}");apf.storage.init();this.showtime=apf.storage.get("apfdebug_console_date")!==false;this.nativedebug=apf.storage.get("apfdebug_debugger")==true;this.highlighthover=apf.storage.get("apfdebug_highlight_hover")!==false;txtCode.setValue(apf.storage.get("jsexec")||"");codetype.setProperty("value",apf.storage.get("scriptype")||"Javascript");txtModel.setValue(apf.storage.get("mdlvalue")||"");this.apf.$debugwin.setNativeDebug(this.nativedebug);itmShowtime.setAttribute("checked",this.showtime);itmDebug.setAttribute("checked",this.nativedebug);cbHighlightHover.setAttribute("checked",this.highlighthover);$apf_ide_mdl.load(this.apf.document.documentElement);var _self=this,excl={DIV:1,BLOCKQUOTE:1,SPAN:1,I:1};this.$mmouseover=function(e){if(!cbHighlightHover.checked||mnuData.visible){return;}var oHtml=e.htmlEvent.srcElement||e.htmlEvent.target;var xmlNode=excl[oHtml.tagName]?null:apf.xmldb.findXmlNode(oHtml);_self.apf.$debugwin.highlightAmlNode(xmlNode,!xmlNode);e.cancelBubble=true;};this.$mmouseout=function(e){self.apf.$debugwin.highlightAmlNode(null,true);(e||event).cancelBubble=true;};$apf_ide_mdlProps.exec=function(method,args,callback,options){if(method=="getProperty"&&args[0]){var xml,tag=args[0];if(xml=$apf_ide_mdlProps.queryNode(tag)){return callback(xml,apf.SUCCESS);}if(!options){options={};}if(!options.callback){options.callback=function(data,state,extra){if(state!=apf.SUCCESS){$apf_ide_mdlProps.exec(method,["empty"],callback,options);tag="empty";return false;}else{callback($apf_ide_mdlProps.queryNode(tag),state,extra);}};}this.insert("props/"+tag+".xml",options);}};apf.addEventListener("mousedown",function(){errBox.hide();});tabDebug.$ext.onmousemove=function(e){if(!e){e=event;}document.body.style.cursor=e.clientY<5?"s-resize":"";};tabDebug.$ext.onmousedown=function(e){if(!e){e=event;}if(e.clientY<5){apf.$debugwin.apf.$debugwin.$startResize(e.clientY);}};browse.addEventListener("afterrender",function(){trTools.hide();});mnuData.onitemclick=function(e){if(this.$lastObj){switch(e.value){case"doc":apf.$debugwin.showDocs(this.$lastObj);break;case"aml":apf.$debugwin.showAmlNode(this.$lastObj);break;case"data":apf.$debugwin.showCmlNode(this.$lastObj);break;case"obj":apf.$debugwin.showObject(this.$lastObj);break;case"root-data":apf.$debugwin.showXmlNode(this.$lastObj.xmlRoot);break;case"sel-data":apf.$debugwin.showXmlNode(this.$lastObj.selected);break;}return;}switch(e.value){case"doc":eval(mnuData.$lastCl.replace(/showObject|showXmlNode|showAmlNode/,"showDocs"));break;case"aml":eval(mnuData.$lastCl.replace(/showObject|showXmlNode|showAmlNode/,"showAmlNode"));break;case"data":eval(mnuData.$lastCl.replace(/showObject|showXmlNode|showAmlNode/,"showXmlNode"));break;case"obj":eval(mnuData.$lastCl.replace(/showObject|showXmlNode|showAmlNode/,"showObject"));break;case"root-data":var hasData=eval(mnuData.$lastCl.replace(/showAmlNode/,"$hasAmlData"));apf.$debugwin.showXmlNode(hasData[0]);break;case"sel-data":var hasData=eval(mnuData.$lastCl.replace(/showAmlNode/,"$hasAmlData"));apf.$debugwin.showXmlNode(hasData[1]);break;}};},start:function(){if(!apf.isDebugWindow){window.onerror=this.nativedebug?null:this.errorHandler;}},errorHandler:function(i,c,g,d){if(!i){i="";}if(!d){apf.$debugwin.apf.console.error((apf.$debugwin.apf!=apf?"[Debug Window Error]: ":"")+"Error on line "+g+" of "+apf.removePathContext(apf.hostPath,c)+"\n"+i);}if(apf.$debugwin.apf==apf){apf.$debugwin.show();}return true;},updateLog:function(){apf_console.clear();apf_console.setValue(this.apf.console.getAll(btnError.value,btnWarn.value,btnLog.value));},updateTeleportFilter:function(c){var d=tlist.each.split("|");if(c.value){d.push(c.firstChild.nodeValue.toLowerCase());}else{d=d.remove(c.firstChild.nodeValue.toLowerCase());}tlist.setAttribute("each",d.join("|")||"none");},debugHandler:function(c){if((self["btn"+c.type.uCaseFirst()]||btnLog).value||c.type=="custom"){apf_console.setValue(c.message);}if(c.type=="error"&&tabDebug.activepagenr!=0){errBox.setMessage(";<a href='javascript:void(0)' onclick='tabDebug.set(0);errBox.hide()'>"+c.message+"</a>");errBox.show();}},showDocs:function(c){tabDebug.set("docs");},showAmlNode:function(c){tabDebug.set(1);pgBrowse.set(0);if(!mrkAml.xmlRoot){mrkAml.addEventListener("afterload",function(){apf.$debugwin.showAmlNode(c);mrkAml.removeEventListener("afterload",arguments.callee);});}else{mrkAml.expandAndSelect(c);if(mrkAml.selected!=c){this.showObject(c,c.getAttribute("id")||"");}}},toggleHighlight:function(c,d){if(document.onmousemove){document.onmousemove=document.onmousedown=null;return;}var g;document.onmousemove=function(n){if(apf.$debugwin.$hdiv){apf.$debugwin.$hdiv.style.top="10000px";}var i=(n||(n=event)).clientX;var q=n.clientY;var k=document.elementFromPoint(i,q);var j=apf.findHost(k);if(g!=j){apf.$debugwin.highlightAmlNode(null,true);}if(g=j){apf.$debugwin.highlightAmlNode(j,false,true);}};document.onmousedown=function(j){var i=g||apf.findHost((j||(j=event)).srcElement||j.target);if(i){c.showAmlNode(i);apf.$debugwin.highlightAmlNode(null,true);d.setValue(false);document.onmousemove=document.onmousedown=null;}};},highlightAmlNode:function(g,c,d){if(c){if(this.$hdiv){this.$hdiv.style.display="none";}return;}if(!g){return;}if(!this.$hdiv){apf.importCssString(".apf_highlight_div{                    background : #004eff;                    position   : absolute;                    z-index    : 1000000;                    opacity    : 0.3;                }                .apf_border_div{                    background : url(images/spacer.gif);                    position   : absolute;                    z-index    : 1000000;                    border     : 1px solid blue;                }");this.$hdiv=document.body.appendChild(document.createElement("div"));this.$hdiv.style.display="none";}apf.setStyleClass(this.$hdiv,d?"apf_border_div":"apf_highlight_div",["apf_border_div","apf_highlight_div"]);if(false&&g.tagName=="html"){this.$hdiv.style.left="0px";this.$hdiv.style.top="0px";this.$hdiv.style.width="100%";this.$hdiv.style.height="100%";this.$hdiv.style.display="block";}else{if(g.$ext&&(g.$ext.offsetHeight||g.$ext.offsetWidth)){var j=apf.getAbsolutePosition(g.$ext);this.$hdiv.style.left=j[0]+"px";this.$hdiv.style.top=j[1]+"px";var i=apf.getDiff(this.$hdiv);this.$hdiv.style.width=(g.$ext.offsetWidth-i[0])+"px";this.$hdiv.style.height=(g.$ext.offsetHeight-i[1])+"px";this.$hdiv.style.display="block";}else{this.$hdiv.style.display="none";}}},showObject:function(g,i,d){tabDebug.set(1);pgBrowse.set(2);if(!d&&g&&g.$regbase){d=g.getAttribute("id")||"Aml Node";i=this.apf.$debugwin.cache.push(g)-1;}txtCurObject.setValue(d);trObject.clear("loading");var c=this;setTimeout(function(){if(!i&&i!==0){$apf_ide_mdlObject.load(c.analyze(g,d,d));}else{$apf_ide_mdlObject.load(c.analyze(c.apf.$debugwin.cache[i],"apf.$debugwin.cache["+i+"]",d));}},10);},types:["Object","Number","Boolean","String","Array","Date","RegExp","Function","Object"],domtypes:[null,"Element","Attr","Text","CDataSection","EntityReference","Entity","ProcessingInstruction","Comment","Document","DocumentType","DocumentFragment","Notation"],calcName:function(g,j){var c,d=g.tagName=="method"?g.parentNode:g,i=[];do{c=j?d.getAttribute("display")||d.getAttribute("name"):d.getAttribute("name");if(!c){break;}i.unshift(!c.match(/^[a-z_\$][\w_\$]*$/i)?(parseInt(c)==c?"["+c+"]":'["'+c.replace(/'/g,"\\'")+'"]'):c);d=d.parentNode;}while(d&&d.nodeType==1);if(i[0].charAt(0)=="["){i[0]=i[0].substr(2,i[0].length-4);}return i.join(".").replace(/\.\[/g,"[");},analyze:function(pNode,ref,displayName){var item,prop;if(pNode&&!pNode.dataType&&pNode.nodeType&&"item|method".indexOf(pNode.tagName)>-1){var name,loopNode=pNode.tagName=="method"?pNode.parentNode:pNode,path=[];do{name=loopNode.getAttribute("name");if(!name){break;}path.unshift("['"+name.replace(/'/g,"\\'")+"']");loopNode=loopNode.parentNode;}while(loopNode&&loopNode.nodeType==1);path[0]=path[0].substr(2,path[0].length-4);o=self.parent.eval(path.join(""));}else{o=pNode;pNode=null;}if(pNode&&pNode.tagName=="method"){var xml=apf.getXml("<method />");var doc=xml.ownerDocument;for(prop in o){if(typeof o[prop]=="function"&&prop.charAt(0)!="$"){item=xml.appendChild(doc.createElement("method"));item.setAttribute("name",prop);item.setAttribute("type","Function");item.setAttribute("value",prop+o[prop].toString().match(/function\s*[\w-]*(\([\s\S]*?\))/)[1]);}}return xml;}if(!pNode){var xml=apf.getXml("<obj />");var n={};n[displayName]=o;if(typeof o=="object"||o&&o.dataType==apf.ARRAY){n.$isSingleValue=true;}o=n;}else{var xml=apf.getXml("<item "+(ref?"name='"+ref+"'":"")+(displayName?' display="'+displayName.replace(/"/g,"&quot;")+'"':"")+" expand='true' />");}var doc=xml.ownerDocument;try{prop in o;}catch(e){return xml;}for(prop in o){obj=o[prop];if(prop.charAt(0)=="$"||prop.substr(0,2)=="a_"){continue;}if(typeof obj=="function"&&(o.dataType!=apf.ARRAY||prop!=parseInt(prop))){hasMethods=true;continue;}item=xml.appendChild(doc.createElement("item"));item.setAttribute("name",prop);if(typeof obj=="undefined"||obj==null){item.setAttribute("value",String(obj));item.setAttribute("type",String(obj));item.setAttribute("numtype",0);continue;}if(this.types[obj.dataType]){item.setAttribute("type",this.types[obj.dataType]);}var hasProperties=null;try{for(hasProperties in obj){break;}}catch(e){hasProperties=true;}item.setAttribute("numtype",obj.dataType||(hasProperties?8:0));var str,hasMethods;switch(obj.dataType){case apf.STRING:if(obj.length>10000){item.setAttribute("value","String of "+obj.length+" bytes (too large to display)");}else{item.setAttribute("value",'"'+obj.replace(/"/g,'\\"').replace(/</g,"&lt;").replace(/\n/g,"\\n").replace(/\r/g,"\\r")+'"');}break;case apf.NUMBER:item.setAttribute("value",obj);break;case apf.BOOLEAN:item.setAttribute("value",obj?"true":"false");break;case apf.DATE:item.setAttribute("value","["+obj.toString()+"]");break;case apf.FUNCTION:item.setAttribute("value",prop+o[prop].toString().match(/function\s*[\w-]*(\([\s\S]*?\))/)[1]);break;case apf.ARRAY:item.setAttribute("value","("+obj.length+" items)");break;default:item.setAttribute("value","{"+(obj.nodeType==2?"@"+obj.nodeName:(obj.nodeType!=1&&obj.nodeName?obj.nodeName+" Node":(obj.tagName?obj.tagName+" Element":"...")))+"}");if(obj.nodeType!==undefined&&typeof obj.style=="object"){item.setAttribute("type",obj.nodeType==1?"HTML"+obj.tagName.toLowerCase().uCaseFirst()+"Element":"HTML"+this.domtypes[obj.nodeType]);}else{if(obj.nodeType!==undefined){var s;if(obj.$regbase&apf.__AMLNODE__){if(obj.nodeType==1){if(obj.namespaceURI==apf.ns.xhtml){item.setAttribute("type","apf.Xhtml"+obj.localName.uCaseFirst()+"Element");break;}else{if(obj.namespaceURI==apf.ns.xsd){item.setAttribute("type","apf.Xsd"+obj.localName.uCaseFirst()+"Element");break;}}}item.setAttribute("type",obj.nodeType==1?"apf."+obj.localName:"apf.Aml"+this.domtypes[obj.nodeType]);break;}item.setAttribute("type","XML"+this.domtypes[obj.nodeType]);}else{item.setAttribute("type","Object");}}break;}}if(!pNode&&displayName){xml.firstChild.setAttribute("display",displayName);xml.firstChild.setAttribute("name",ref);xml.firstChild.setAttribute("expand","true");if(o.$isSingleValue){apf.mergeXml(this.analyze(xml.firstChild,name),xml.firstChild);}}if(hasMethods){xml.insertBefore(doc.createElement("method"),xml.firstChild).setAttribute("name","[Methods]");}return doc.documentElement;},checkChange:function(c){var d=c.getAttribute("value");if(c.tagName=="method"||"Boolean|String|undefined|null|Number".indexOf(c.getAttribute("type"))==-1){return false;}},applyChange:function(xmlNode){var value=xmlNode.getAttribute("value");var name=this.calcName(xmlNode);try{if(name.indexOf(".")>-1){var prop,obj=self.parent.eval(name.replace(/\.([^\.\s]+)$/,""));if(obj&&obj.$supportedProperties&&obj.$supportedProperties.contains(prop=RegExp.$1)){obj.setProperty(prop,self.parent.eval(value));return;}}self.parent.eval(name+" = "+value);}catch(e){trObject.getActionTracker().undo();alert("Invalid Action: "+e.message);}},showXmlNode:function(c){tabDebug.set(1);pgBrowse.set(1);var g=apf.xmldb.$xmlDocLut;var i=c.ownerDocument.documentElement;var n=c.getAttribute(apf.xmldb.xmlIdTag);if(!n){n=apf.xmldb.nodeConnect(apf.xmldb.getXmlDocId(c),c);}var d=n.split("|")[0];if(!g[d]){g[d]=i;}else{if(g[d]!=i){var k=this.apf.nameserver.get("model",d);g[d]=i;var j=apf.nameserver.get("model",d);apf.xmldb.getXmlDocId(i,j);if(k){apf.nameserver.register("model",d,k);}}}mrkData.load(c);},$handleDataContext:function(ev,obj){if(obj){this.apf.$debugwin.highlightAmlNode(null,true);if(obj.$regbase){itInspAml.hide();itInspData.hide();itInspObj.show();var hasData=[obj.xmlRoot,obj.selected];itInspRoot.setProperty("visible",hasData[0]?1:0);itInspSel.setProperty("visible",hasData[1]?1:0);div2.setProperty("visible",hasData[0]||hasData[1]?1:0);}else{itInspAml.hide();itInspData.hide();itInspObj.show();itInspRoot.hide();itInspSel.hide();div2.hide();}mnuData.$lastObj=obj;mnuData.display(ev.x,ev.y);return false;}e=ev&&ev.htmlEvent;if(!e){return;}var el=e.srcElement||e.target;while(el.tagName!="A"&&el.tagName!="DIV"){el=el.parentNode;}if(el.tagName=="A"){var cl=el.getAttribute("onclick");if(cl.indexOf("showObject")>-1){itInspAml.hide();itInspData.hide();itInspObj.show();itInspRoot.hide();itInspSel.hide();div2.hide();}else{if(cl.indexOf("showXmlNode")>-1){itInspAml.hide();itInspData.show();itInspObj.show();itInspRoot.hide();itInspSel.hide();div2.hide();}else{if(cl.indexOf("showAmlNode")>-1){itInspAml.show();itInspData.hide();itInspObj.show();var hasData=eval(cl.replace(/showAmlNode/,"$hasAmlData"));itInspRoot.setProperty("visible",hasData[0]?1:0);itInspSel.setProperty("visible",hasData[1]?1:0);div2.setProperty("visible",hasData[0]||hasData[1]?1:0);}}}mnuData.$lastCl=cl;mnuData.display(ev.x,ev.y);return false;}},$hasAmlData:function(c){return[c.xmlRoot,c.selected];},jRunCode:function(code,scripttype,model){apf.storage.put("jsexec",code);apf.storage.put("scriptype",scripttype);apf.storage.put("mdlvalue",model);var islm=scripttype=="Live Markup";this.apf.console.write("<span style='color:blue'><span style='float:left'>&gt;&gt;&gt;</span><div style='margin:0 0 0 30px'>"+code.replace(/ /g,"&nbsp;").replace(/\t/g,"&nbsp;&nbsp;&nbsp;").replace(/</g,"&lt;").replace(/\n/g,"\n<br />")+"</div></span>","custom",null,null,null,true);var _self=this;var doIt=function(data,loaded){if(islm){var func=apf.$debugwin.apf.lm.compile(code,{parsecode:true});if(model&&!loaded){if(data=apf.$debugwin.apf.nameserver.get("model",model)){data=data.data;}if(!data){var data=_self.apf.getData(model,{useXML:true,callback:function(data,state,extra){if(state==apf.SUCCESS){doIt(data,true);}else{_self.apf.console.error("Could not find resource '"+model+"'\nMessage:"+extra.message);}}});return;}}var x=func(data);}else{var x=self.parent.eval(code);}var s=_self.$serializeObject(x,code);if(typeof s=="string"){_self.apf.console.write(s,"custom",null,null,null,true);}else{_self.apf.console.write(x?"Could not serialize object: "+s.message:x,"error",null,null,null,true);}};if(apf.$debugwin.nativedebug){doIt();}else{try{doIt();}catch(e){this.apf.console.write(e.message,"error",null,null,null,true);}}},$serializeObject:function(c,g){if(c===null){c="null";}else{if(c===undefined){c="undefined";}}try{var j;if(c.nodeType&&!c.style&&(!c.$regbase||c.nodeType==1||c.nodeType==7)){if(c.nodeType==1||c.nodeType==7){if(c.serialize){j="<a class='xmlhl' href='javascript:void(0)' onmouseout='if (cbHighlightHover.checked) apf.$debugwin.apf.$debugwin.highlightAmlNode(null, true)' onmouseover='if(!mnuData.visible) apf.$debugwin.apf.$debugwin.highlightAmlNode(apf.$debugwin.apf.all["+c.$uniqueId+"])' onclick='apf.$debugwin.showAmlNode(apf.$debugwin.apf.all["+c.$uniqueId+"])'>"+apf.highlightXml(c.serialize().split(">")[0]+">").replace(/<\/?a(?:>| [^>]*>)/g,"")+"</a>";}else{j="<a class='xmlhl' href='javascript:void(0)' onclick='apf.$debugwin.showXmlNode(apf.$debugwin.cache["+(apf.$debugwin.cache.push(c)-1)+"])'>"+apf.highlightXml(apf.getCleanCopy(c).xml.split(">")[0]+">")+"</a>";}}else{j=c.xml||c.serialize();}return j;}else{if(typeof c=="object"){if(c.dataType==apf.ARRAY){var d=["Array { length: "+c.length];}else{var d=[c.toString(),"{"];for(prop in c){if(d.length==5){d.push("more...");break;}if(typeof c[prop]!="function"&&typeof c[prop]!="object"&&c[prop]&&prop.substr(0,1)!="$"){d.push(prop+"="+c[prop]+", ");}}}return"<a class='xmlhl' href='javascript:void(0)' style='font-weight:bold;font-size:7pt;color:green' onclick='apf.$debugwin.showObject(null, "+(this.apf.$debugwin.cache.push(c)-1)+', "'+g.split(";").pop().replace(/"/g,"\\&quot;")+"\")'>"+d.join(" ")+" }</a>";}else{j=c.toString();return j.replace(/</g,"&lt;").replace(/\n/g,"\n<br />");}}}catch(i){return i;}},consoleTextHandler:function(c){if(c.keyCode==9&&c.currentTarget==txtCode){txtCode.focus();c.cancelBubble=true;return false;}else{if(c.keyCode==13&&c.ctrlKey){apf.$debugwin.jRunCode(txtCode.value,codetype.value,txtModel.value);return false;}}},setShowTime:function(d){apf.storage.put("apfdebug_console_date",d);apf.setStyleRule(".console_date","display",d?"inline":"none");this.showtime=d;},setNativeDebug:function(g,d){if(!d){apf.storage.put("apfdebug_debugger",g);this.apf.$debugwin.setNativeDebug(g,true);}else{window.onerror=this.nativedebug?null:this.errorHandler;}this.nativedebug=g;},setHighlightHover:function(d){apf.storage.put("apfdebug_highlight_hover",d);this.highlighthover=d;},firstEdit:true,$setEditable:function(c){if(c){if(this.firstEdit){apf.getData(apf.basePath+"/debugwin/editable.css",{callback:function(d){apf.importCssString(d);}});apf.document.documentElement.insertMarkup(apf.basePath+"/debugwin/editable.inc");this.firstEdit=false;}alert(1);apf.document.documentElement.setAttribute("editable","true");}else{apf.document.documentElement.removeAttribute("editable");}},setEditable:function(c){this.apf.$debugwin.$setEditable(c);if(c){pgBrowse.setAttribute("anchors","61 0 0 0");mrkAml.setAttribute("border","1 1 0 1");tbEdit.show();trTools.show();}else{pgBrowse.setAttribute("anchors","25 0 0 0");mrkAml.setAttribute("border","1 1 0 0");tbEdit.hide();trTools.hide();}},first:true,show:function(){if(apf.isDebugWindow){return;}if(apf.loadScreen){apf.loadScreen.hide();}if(this.first){if(apf.isIE){apf.setStyleRule("BODY","overflow","",0);p=apf.getBox(apf.getStyle(document.body,"padding"));m=apf.getBox(apf.getStyle(document.body,"margin"));o=[apf.getStyle(document.documentElement,"overflow"),apf.getStyle(document.documentElement,"overflowX"),apf.getStyle(document.documentElement,"overflowY")];}else{p=[parseInt(apf.getStyle(document.body,"padding-top")),parseInt(apf.getStyle(document.body,"padding-right")),parseInt(apf.getStyle(document.body,"padding-bottom")),parseInt(apf.getStyle(document.body,"padding-left"))];m=[parseInt(apf.getStyle(document.body,"margin-top")),parseInt(apf.getStyle(document.body,"margin-right")),parseInt(apf.getStyle(document.body,"margin-bottom")),parseInt(apf.getStyle(document.body,"margin-left"))];o=[apf.getStyleRule("html","overflow")||"auto",apf.getStyleRule("html","overflow-x")||"auto",apf.getStyleRule("html","overflow-y")||"auto"];}this.resPath=(apf.config.resourcePath||apf.basePath)+"resources/";apf.importCssString("                html{                    height : 100%;                    overflow : hidden;                    overflow-x : hidden;                    overflow-y : hidden;                    margin-bottom : "+(p[0]+m[0]+p[2]+m[2])+"px;                }                body{                    position : absolute;                    left : 0;                    top : 0;                    right : 0;                    bottom : 350px;                    margin:0;                    overflow  : "+o[0]+";                    overflow-x : "+o[1]+";                    overflow-y : "+o[2]+";                    padding : "+(p[0]+m[0])+"px "+(p[1]+m[1])+"px "+(p[2]+m[2])+"px "+(p[3]+m[3])+"px;                    width : auto;                }                #apf_debugwin {                    position: fixed;                    bottom: 0px;                    text-align: left;                    height: 350px;                    background: #fff url("+this.resPath+"splitter_handle_vertical.gif) no-repeat 1px 50%;                    width : 100%;                    left: 0px;                    z-index: 100000000;                }            ");document.documentElement.style.overflow="hidden";this.first=false;document.body.insertAdjacentHTML("beforeend","<div id='apf_debugwin'><iframe frameborder='0' width='100%' height='100%' /></div>");this.$iframe=(this.$ext=document.getElementById("apf_debugwin")).firstChild;this.$iframe.isDebugWin=true;apf.getWindowWidth=function(){return document.body.offsetWidth;};apf.getWindowHeight=function(){return document.body.offsetHeight;};setTimeout(function(){apf.$debugwin.$iframe.src=apf.basePath+"debugwin/debugwin.html";});}this.$ext.style.display="block";document.body.style.bottom="300px";},hide:function(){this.$ext.style.display="none";document.body.style.bottom="0";document.body.focus();},$startResize:function(j){var d=this.$ext;apf.plane.show(null,null,null,true);apf.dragMode=true;document.body.style.cursor="s-resize";var i,n,c;var k=d.offsetHeight;var g=document.documentElement.offsetHeight-k+((apf.isIE?0:1)*j);document.onmousemove=c=function(q){if(!q){q=event;}var t=q.offsetY;clearTimeout(n);if(i&&new Date().getTime()-i<apf.mouseEventBuffer){var s={clientX:q.clientX,clientY:q.clientY};n=setTimeout(function(){d.style.height=(k+(g-t))+"px";},10);return;}i=new Date().getTime();d.style.height=(k+(g-t))+"px";};document.onmouseup=function(q){if(!q){q=event;}document.body.style.cursor="";document.onmousemove=document.onmouseup=null;apf.dragMode=false;apf.plane.hide();};},activate:function(){this.show();}};apf.BindingRule=function(d,c){this.$init(c||true,apf.NODE_HIDDEN,d);};(function(){this.$bindingRule=true;this.compile=function(c){return(this["c"+c]=apf.lm.compile(this[c],{xpathmode:3,injectself:true}));};this.$compile=function(d,c){return(this["c"+d+"2"]=apf.lm.compile(this[d],c));};this.$attrExcludePropBind=apf.extend({value:1,match:1},this.$attrExcludePropBind);this.$propHandlers.value=this.$propHandlers.match=function(d,g){delete this["c"+g];if(this.$amlLoaded){var c=this;while(c&&c.$bindingRule){c=c.parentNode;}if(!c){return;}apf.queue.add("reload"+c.$uniqueId,function(){c.reload();});if(c.$bindings.$isCompiled){c.$bindings.$compiled=c.$bindings.compile(this.localName!="each"&&this.localName);}}};this.addEventListener("DOMNodeInserted",function(d){var c=this;while(c.$bindingRule){c=c.parentNode;}apf.queue.add("reload"+c.$uniqueId,function(){c.reload();});if(d.currentTarget==this){(c.$bindings[this.localName]||(c.$bindings[this.localName]=[])).push(this);}else{if(!this.attributes.getNamedItem("value")){this.value=apf.serializeChildren(this);}else{return;}}if(c.$bindings.$isCompiled){c.$bindings.$compiled=c.$bindings.compile(this.localName!="each"&&this.localName);}});this.addEventListener("DOMNodeRemoved",function(d){var g,c=this;while(c&&c.$bindingRule){c=c.parentNode;}if(!c){return;}if(d.currentTarget==this){if(c.$bindings&&c.$bindings[this.localName]){c.$bindings[this.localName].remove(this);}else{return;}}else{if(!this.attributes.getNamedItem("value")&&(g=this.firstChild)){if(g.nodeType==this.NODE_PROCESSING_INSTRUCTION){if(g.target=="lm"){this.value="{"+g.nodeValue+"}";}else{this.value=g.nodeValue;}}else{this.value=apf.serializeChildren(this).trim();}}else{return;}}apf.queue.add("reload"+c.$uniqueId,function(){if(!c.$amlDestroyed){c.reload();}});if(c.$bindings.$isCompiled){c.$bindings.$compiled=c.$bindings.compile(this.localName!="each"&&this.localName);}});this.addEventListener("DOMNodeInsertedIntoDocument",function(g){if(!this.match&&(!this.value&&!this.childNodes.length&&!this.get||this.localName=="each")||this.select){throw new Error(apf.formatErrorString(0,this,"Bindingrule","Missing attribute 'match'"));}var i;if(!this.value&&(i=this.$aml&&this.$aml.firstChild||this.firstChild)){if(i.nodeType==this.NODE_PROCESSING_INSTRUCTION){if(i.target=="lm"){this.value="{"+i.nodeValue+"}";}else{this.value=i.nodeValue;}}else{this.value=apf.serializeChildren(this.$aml).trim();}}var c=this.parentNode;while(c.$bindingRule){c=c.parentNode;}var j=c.$bindings||(c.$bindings=new apf.ruleList());(j[this.localName]||(j[this.localName]=[])).push(this);if(c.localName!="bindings"&&(this.localName!="each"||!this.childNodes.length)){var d=this;while((d=d.nextSibling)&&d.nodeType!=1){}if(!d||!d.$bindingRule){c.$cbindings=c.$bindings.compile(c.$bindings.$isCompiled?this.localName:null);c.dispatchEvent("bindingsload",{bindings:c.$bindings,compiled:c.$cbindings});c.$checkLoadQueue();}}});}).call(apf.BindingRule.prototype=new apf.AmlElement());apf.aml.setElement("icon",apf.BindingRule);apf.aml.setElement("image",apf.BindingRule);apf.aml.setElement("caption",apf.BindingRule);apf.aml.setElement("css",apf.BindingRule);apf.aml.setElement("selectable",apf.BindingRule);apf.aml.setElement("value",apf.BindingRule);apf.aml.setElement("src",apf.BindingRule);apf.aml.setElement("collapsed",apf.BindingRule);apf.aml.setElement("expanded",apf.BindingRule);apf.aml.setElement("empty",apf.BindingRule);apf.ActionRule=function(d,c){this.$init(c||true,apf.NODE_HIDDEN,d);};(function(){this.$actionRule=true;this.compile=function(d,c){return(this["c"+d]=apf.lm.compile(this[d],c||{xpathmode:2}));};this.$attrExcludePropBind=apf.extend({set:1,get:1,undo:1,lock:1,match:1,parent:1},this.$attrExcludePropBind);this.$propHandlers.set=this.$propHandlers.get=this.$propHandlers.parent=this.$propHandlers.match=function(c,d){delete this["c"+d];};this.addEventListener("DOMNodeInserted",function(d){if(d.currentTarget==this){var c=this.parentNode;if(!c.$actions){c.$actions=new apf.ruleList();}(c.$actions[this.localName]||(c.$actions[this.localName]=[])).push(this);}else{if(this.attributes.getNamedItem("value")){return;}this.value=apf.serializeChildren(this);}});this.addEventListener("DOMNodeRemoved",function(c){if(c.currentTarget==this){this.parentNode.$actions[this.localName].remove(this);}else{if(this.attributes.getNamedItem("value")){return;}this.value=apf.serializeChildren(this);}});this.addEventListener("DOMNodeInsertedIntoDocument",function(c){if(!this.get){this.get=apf.serializeChildren(this.$aml).trim();}var d=this.parentNode.$actions||(this.parentNode.$actions=new apf.ruleList());(d[this.localName]||(d[this.localName]=[])).push(this);});}).call(apf.ActionRule.prototype=new apf.AmlElement());apf.aml.setElement("rename",apf.ActionRule);apf.aml.setElement("remove",apf.ActionRule);apf.aml.setElement("add",apf.ActionRule);apf.aml.setElement("update",apf.ActionRule);apf.aml.setElement("copy",apf.ActionRule);apf.aml.setElement("move",apf.ActionRule);apf.aml.setElement("check",apf.ActionRule);apf.item=function(d,c){this.$init(c||"item",apf.NODE_VISIBLE,d);};(function(){this.$focussable=false;this.$childProperty="caption";this.$canLeechSkin="item";this.implement(apf.ChildValue);this.$attrExcludePropBind=apf.extend({match:1},this.$attrExcludePropBind);this.$supportedProperties.push("submenu","value","match","group","icon","checked","selected","disabled","caption","type");this.$propHandlers.submenu=function(d){apf.setStyleClass(this.$ext,"submenu");};this.$propHandlers.select=function(d){this.select=d?"self::"+d.split("|").join("|self::"):d;};this.$propHandlers.hotkey=function(g){if(this.$hotkey){apf.setNodeValue(this.$hotkey,g);}if(this.$lastHotkey){apf.removeHotkey(this.$lastHotkey);}if(g){this.$lastHotkey=g;var d=this;apf.registerHotkey(g,function(){if(d.disabled||!d.visible){return;}var n=apf.document.getElementsByTagNameNS(apf.ns.aml,"button");for(var k=0;k<n.length;k++){if(n[k].submenu==d.parentNode.name){var j=n[k];j.$setState("Over",{});$setTimeout(function(){j.$setState("Out",{});},200);break;}}d.$down();d.$up();d.$click();});}};this.$propHandlers.icon=function(d){if(this.$icon){apf.skins.setIcon(this.$icon,d,this.parentNode.iconPath);}};this.$propHandlers.caption=function(d){if(this.$caption){apf.setNodeValue(this.$caption,d);}};this.$propHandlers.type=function(d){apf.setStyleClass(this.$ext,d,["item","check","radio"]);};this.$propHandlers.checked=function(d){if(this.type!="check"){return;}if(apf.isTrue(d)){apf.setStyleClass(this.$ext,"checked");}else{apf.setStyleClass(this.$ext,"",["checked"]);}};this.$propHandlers.selected=function(d){if(this.type!="radio"){return;}if(apf.isTrue(d)){apf.setStyleClass(this.$ext,"selected");}else{apf.setStyleClass(this.$ext,"",["selected"]);}};this.$propHandlers.disabled=function(d){if(apf.isTrue(d)){apf.setStyleClass(this.$ext,"disabled");}else{apf.setStyleClass(this.$ext,"",["disabled"]);}};this.enable=function(d){apf.setStyleClass(this.$ext,this.parentNode.$baseCSSname+"Disabled");};this.disable=function(d){apf.setStyleClass(this.$ext,null,[this.parentNode.$baseCSSname+"Disabled"]);};this.addEventListener("AMLReparent",function(d,i,g){if(!this.$amlLoaded){return;}if(!g&&this.skinName!=i.skinName){this.loadAml();}});this.$down=function(){};this.$up=function(){if(this.type=="radio"){this.parentNode.select(this.group,this.value||this.caption);}else{if(this.type=="check"){this.$handlePropSet("checked",!this.checked);}}if(this.submenu){this.$over(null,true);return;}this.parentNode.$hideTree=true;this.parentNode.hide();this.parentNode.dispatchEvent("itemclick",{value:this.value||this.caption,relatedNode:this});};this.$click=function(){this.dispatchEvent("click",{xmlContext:this.parentNode.xmlReference,opener:this.parentNode.opener});};var c;this.$out=function(g){if(apf.isChildOf(this.$ext,g.toElement||g.explicitOriginalTarget)||apf.isChildOf(this.$ext,g.srcElement||g.target)){return;}clearTimeout(c);if(!this.submenu||this.$submenu(true)){apf.setStyleClass(this.$ext,"",["hover"]);var d=this.parentNode.$selected;if(d&&d!=this){apf.setStyleClass(d.$ext,"",["hover"]);}this.parentNode.$selected=null;}};this.$over=function(i,g){if(this.parentNode.$selected==this){return;}if(this.parentNode.$selected){apf.setStyleClass(this.parentNode.$selected.$ext,"",["hover"]);}apf.setStyleClass(this.$ext,"hover");this.parentNode.$selected=this;if(!g&&(apf.isChildOf(this.$ext,i.toElement||i.explicitOriginalTarget)||apf.isChildOf(this.$ext,i.fromElement||i.target))){return;}var j=this.parentNode.$showingSubMenu;if(j){if(j.name==this.submenu){return;}j.hide();this.parentNode.$showingSubMenu=null;}if(this.submenu){if(g){this.$submenu();}else{var d=this;clearTimeout(c);c=$setTimeout(function(){d.$submenu();c=null;},200);}}};this.$submenu=function(d,g){if(!this.submenu){return true;}var i=self[this.submenu];if(!i){throw new Error(apf.formatErrorString(0,this,"Displaying submenu","Could not find submenu '"+this.submenu+"'",this.$aml));return;}if(!d){this.parentNode.$showingSubMenu=i;var j=apf.getAbsolutePosition(this.$ext,this.parentNode.$ext.offsetParent);i.display(j[0]+this.$ext.offsetWidth-3,j[1]+3,false,this,this.parentNode.xmlReference,this.parentNode.$uniqueId);i.setAttribute("zindex",(this.parentNode.zindex||1)+1);}else{if(i.visible&&!g){return false;}if(this.parentNode.$showingSubMenu){this.parentNode.$showingSubMenu=null;}apf.setStyleClass(this.$ext,"",["hover"]);i.hide();return true;}};this.$draw=function(g){var j=this.parentNode;while(j.$canLeechSkin=="item"){j=j.parentNode;}if(j.hasFeature(apf.__MULTISELECT__)){var d=this;if(!this.$hasSetSkinListener){var i;this.parentNode.addEventListener("$skinchange",i=function(){if(d.$amlDestroyed){return;}if(d.$ext.parentNode){this.$deInitNode(d,d.$ext);}var q=j==d.parentNode?j.$container:d.parentNode.$container;var n=q.lastChild;j.$add(d,d.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId,d.parentNode,q!=j.$container&&q,null);j.$fill();if(j.$isTreeArch){d.$container=j.$getLayoutNode("item","container",d.$ext=n&&n.nextSibling||q.firstChild);}else{d.$ext=n&&n.nextSibling||q.firstChild;}var k=d;while((k=k.nextSibling)&&k.nodeType!=1){}if(!k||k.$canLeechSkin!="item"){j.dispatchEvent("afterload");}});this.addEventListener("DOMNodeRemoved",function(k){this.parentNode.removeEventListener("$skinchange",i);});this.$hasSetSkinListener=true;}if(!j.$itemInited){j.canrename=false;j.$removeClearMessage();j.$itemInited=[j.getTraverseNodes,j.getFirstTraverseNode,j.getTraverseParent];j.getTraverseNodes=function(k){return(k||j).getElementsByTagNameNS(apf.ns.apf,"item");};j.getFirstTraverseNode=function(k){return(k||j).getElementsByTagNameNS(apf.ns.apf,"item")[0];};j.getTraverseParent=function(k){return k&&k.parentNode;};j.each=(this.prefix?this.prefix+":":"")+"item";j.$preventDataLoad=true;j.$initingModel=true;j.$setDynamicProperty("icon","[@icon]");j.$setDynamicProperty("image","[@image]");j.$setDynamicProperty("caption","[label/text()|@caption|text()]");j.$setDynamicProperty("eachvalue","[value/text()|@value|text()]");j.$canLoadDataAttr=false;if(!j.xmlRoot){j.xmlRoot=j;}}this.$loadAml=function(){if(!this.getAttribute("caption")){this.setAttribute("caption",this.caption);}var q=j==this.parentNode?j.$container:this.parentNode.$container;var n=q.lastChild;if(!j.documentId){j.documentId=apf.xmldb.getXmlDocId(this);}j.$add(this,apf.xmldb.nodeConnect(j.documentId,this,null,j),this.parentNode,q!=j.$container&&q,null);j.$fill();if(j.$isTreeArch){this.$container=j.$getLayoutNode("item","container",this.$ext=n&&n.nextSibling||q.firstChild);}else{this.$ext=n&&n.nextSibling||q.firstChild;}var k=this;while((k=k.nextSibling)&&k.nodeType!=1){}if(!k||k.$canLeechSkin!="item"){j.dispatchEvent("afterload");if(j.autoselect){j.$selectDefault(this.parentNode);}}};return;}this.$ext=this.$getExternal(this.$isLeechingSkin?"item":"main",null,function(k){var n="var o = apf.lookup("+this.$uniqueId+"); if (o.disabled) return; o";k.setAttribute("onmouseup",n+".$up(event)");k.setAttribute("onmousemove",n+".$over(event)");k.setAttribute("onmouseout",n+".$out(event)");k.setAttribute("onmousedown",n+".$down()");k.setAttribute("onclick",n+".$click()");});this.$caption=this.$getLayoutNode("item","caption",this.$ext);this.$icon=this.$getLayoutNode("item","icon",this.$ext);this.$hotkey=this.$getLayoutNode("item","hotkey",this.$ext);if(!g&&this.nextSibling&&this.nextSibling.$ext){this.$ext.parentNode.insertBefore(this.$ext,this.nextSibling.$ext);}};this.addEventListener("DOMNodeInsertedIntoDocument",function(g){var d=this.$ext?true:false;if(d){if(typeof this.checked!=="undefined"){this.$handlePropSet("checked",this.checked);}else{if(typeof this.selected!=="undefined"){this.$handlePropSet("selected",this.selected);}}if(this.disabled){this.$handlePropSet("disabled",this.disabled);}if(this.caption){this.$handlePropSet("caption",this.caption);}}});}).call(apf.item.prototype=new apf.Presentation());apf.aml.setElement("item",apf.item);apf.WinServer={count:9000,wins:[],setTop:function(g,d){if(g.zindex){return;}if(g.$opened){if(g.$opened.visible){return;}else{delete g.$opened;}}var c;if(!d&&this.wins.length){var c=this.wins[this.wins.length-1];if(c==g){return;}if(!c.modal||!c.visible){c=null;}else{if(c&&g.modal){g.$opener=c;c.$opened=g;c=null;}}}this.count+=2;g.setProperty("zindex",this.count);this.wins.remove(g);this.wins.push(g);if(c){this.setTop(c,true);}return g;},setNext:function(){if(this.wins.length<2){return;}var c,d=this.wins.shift();do{if(this.setTop(c||d).visible){break;}c=this.wins.shift();}while(d!=c);},setPrevious:function(){if(this.wins.length<2){return;}this.wins.unshift(this.wins.pop());var c,d=this.wins.pop();do{if(this.setTop(c||d).visible){break;}c=this.wins.pop();}while(d!=c);},remove:function(c){this.wins.remove(c);}};apf.toolwindow=function(d,c){this.$init(c||"toolwindow",apf.NODE_VISIBLE,d);};apf.modalwindow=function(d,c){this.$init(c||"modalwindow",apf.NODE_VISIBLE,d);};apf.AmlWindow=function(d,c){this.$init(c||"window",apf.NODE_VISIBLE,d);};(function(){this.implement(apf.BaseStateButtons);this.$isWindowContainer=true;this.collapsedHeight=30;this.canHaveChildren=2;this.visible=false;this.showdragging=false;this.kbclose=false;this.$focussable=apf.KEYBOARD;this.$editableCaption=["title"];this.setTitle=function(g){this.setProperty("title",g,false,true);return this;};this.setIcon=function(g){this.setProperty("icon",g,false,true);return this;};this.show=function(g){this.execAction=g;this.setProperty("visible",true,false,true);return this;};this.slideIn=function(n,j){if(!n){n="bottom";}var t=this.center;this.center=false;this.setProperty("visible",true);this.center=t;var i=0,A=0,s=(apf.isIE?this.$ext.offsetParent.offsetWidth:window.innerWidth),k=(apf.isIE?this.$ext.offsetParent.offsetHeight:window.innerHeight),w=Math.max(0,((s-this.$ext.offsetWidth)/2)),u=Math.max(0,((k-this.$ext.offsetHeight)/3)),g="top",q=10;switch(n){case"top":i=-(this.$ext.offsetHeight)-q;A=j?0:u;break;case"left":i=-(this.$ext.offsetWidth)-q;A=j?0:w;g="left";break;case"bottom":i=k+this.$ext.offsetHeight+q;A=j?k-this.$ext.offsetHeight:u;break;case"right":i=s+this.$ext.offsetLeft+q;A=j?s-this.$ext.offsetWidth:w;g="left";break;}apf.tween.single(this.$ext,{steps:apf.isIphone?5:30,interval:10,from:i,to:A,type:g,anim:apf.tween.EASEIN});return this;};this.slideOut=function(i){if(!i){i="bottom";}var q=0,n=0,k="top",j=10;switch(i){case"top":q=this.$ext.offsetTop;n=-(this.$ext.offsetHeight)-j;break;case"left":q=this.$ext.offsetLeft;n=-(this.$ext.offsetWidth)-j;k="left";break;case"bottom":q=this.$ext.offsetTop;n=(apf.isIE?this.$ext.offsetParent.offsetHeight:window.innerHeight)+this.$ext.offsetHeight+j;break;case"right":q=this.$ext.offsetLeft;n=(apf.isIE?this.$ext.offsetParent.offsetWidth:window.innerWidth)+this.$ext.offsetLeft+j;k="left";break;}var g=this;apf.tween.single(this.$ext,{steps:apf.isIphone?5:30,interval:10,from:q,to:n,type:k,anim:apf.tween.EASEOUT,onfinish:function(){g.setProperty("visible",false);}});return this;};this.bringToFront=function(){apf.WinServer.setTop(this);return this;};this.syncAlignment=function(g){if(g.hidden==3){apf.WinServer.setTop(this);}if(g.state>0){this.$setStyleClass(this.$ext,this.$baseCSSname+"Min",[this.$baseCSSname+"Edit",this.$baseCSSname+"Max"]);}else{this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Min",this.$baseCSSname+"Edit",this.$baseCSSname+"Max"]);}};this.$booleanProperties.modal=true;this.$booleanProperties.center=true;this.$booleanProperties.transaction=true;this.$booleanProperties.hideselects=true;this.$booleanProperties.showdragging=true;this.$booleanProperties.kbclose=true;this.$supportedProperties.push("title","icon","modal","minwidth","minheight","hideselects","center","kbclose","maxwidth","maxheight","showdragging","transaction");this.$propHandlers.modal=function(i){if(i&&!this.oCover){var g=this.$getLayoutNode("cover");if(g){this.oCover=apf.insertHtmlNode(g,this.$pHtmlNode);if(!this.visible){this.oCover.style.display="none";}if(this.zindex){this.oCover.style.zIndex=this.zindex;}}}if(!i&&this.oCover){this.oCover.style.display="none";}};this.$propHandlers.center=function(g){this.$ext.style.position="absolute";};this.$propHandlers.title=function(g){if(this.oTitle){this.oTitle.nodeValue=g;}};this.$propHandlers.icon=function(g){if(!this.oIcon){return;}this.oIcon.style.display=g?"block":"none";apf.skins.setIcon(this.oIcon,g,this.iconPath);};var d=[],c;this.$propHandlers.visible=function(t){if(apf.isTrue(t)){if(this.oCover){if(this.oCover.offsetParent){this.oCover.style.height=Math.max(this.oCover.offsetParent.scrollHeight,document.documentElement.offsetHeight)+"px";this.oCover.style.width=this.oCover.offsetParent.scrollWidth+"px";}this.oCover.style.display="block";}this.state=this.state.split("|").remove("closed").join("|");this.$ext.style.display="block";if(apf.layout&&this.$int){apf.layout.forceResize(this.$int);}if(this.center){var s=!this.$ext.offsetParent||this.$ext.offsetParent.tagName=="BODY"?[apf.getWindowWidth(),apf.getWindowHeight()]:[this.$ext.offsetParent.offsetWidth,this.$ext.offsetParent.offsetHeight,0,0];if(s.length==2){s.push(document.documentElement.scrollLeft,document.documentElement.scrollTop);}this.$ext.style.left=(Math.max(0,((s[0]-parseInt(this.width))/2))+s[2])+"px";this.$ext.style.top=(Math.max(0,((s[1]-parseInt(this.height))/3))+s[3])+"px";}if(!apf.canHaveHtmlOverSelects&&this.hideselects){d=[];var n=document.getElementsByTagName("select");for(var q=0;q<n.length;q++){var k=apf.getStyle(n[q],"display");d.push([n[q],k]);n[q].style.display="none";}}if(this.modal){this.bringToFront();}if(!this.$rendered){this.addEventListener("afterrender",function(){if(this.$amlLoaded&&(this.model||(!this.dockable||!this.aData)&&!this.$isWidget&&this.localName!="toolwindow")){this.focus(false,{mouse:true});}});}else{if(this.$amlLoaded&&(this.model||(!this.dockable||!this.aData)&&!this.$isWidget&&this.localName!="toolwindow")){this.focus(false,{mouse:true});}}if(apf.isIE){var j=this.$ext.className;this.$ext.className="rnd"+Math.random();this.$ext.className=j;}var g=this;$setTimeout(function(){g.dispatchEvent("show");});}else{if(this.oCover){this.oCover.style.display="none";}this.$ext.style.display="none";if(!apf.canHaveHtmlOverSelects&&this.hideselects){for(var q=0;q<d.length;q++){d[q][0].style.display=d[q][1];}}if(this.hasFocus()){apf.window.moveNext(true,this,true);}this.dispatchEvent("close");this.visible=false;}c=t;};this.$propHandlers.zindex=function(g){this.$ext.style.zIndex=g+1;if(this.oCover){this.oCover.style.zIndex=g;}};if(!apf.isIphone){this.addEventListener("keydown",function(j){var i=j.keyCode;var n=j.ctrlKey;var g=j.shiftKey;var k=false;switch(i){case 38:if(g&&this.resizable){this.setProperty("height",Math.max(this.minheight||0,this.$ext.offsetHeight-(n?50:10)));}else{if(this.draggable){this.setProperty("top",this.$ext.offsetTop-(n?50:10));}}break;case 37:if(g&&this.resizable){this.setProperty("width",Math.max(this.minwidth||0,this.$ext.offsetWidth-(n?50:10)));}else{if(this.draggable){this.setProperty("left",this.$ext.offsetLeft-(n?50:10));}}break;case 39:if(g&&this.resizable){this.setProperty("width",Math.min(this.maxwidth||10000,this.$ext.offsetWidth+(n?50:10)));}else{if(this.draggable){this.setProperty("left",this.$ext.offsetLeft+(n?50:10));}}break;case 40:if(g&&this.resizable){this.setProperty("height",Math.min(this.maxheight||10000,this.$ext.offsetHeight+(n?50:10)));}else{if(this.draggable){this.setProperty("top",this.$ext.offsetTop+(n?50:10));}}break;default:k=null;return;}if(apf.hasSingleRszEvent){apf.layout.forceResize(this.$int);}return k;},true);this.addEventListener("keydown",function(g){if(g.keyCode==27&&this.buttons.indexOf("close")>-1&&(!this.dockable||!this.aData)&&this.kbclose){this.close();}});}this.$draw=function(){this.popout=apf.isTrue(this.getAttribute("popout"));if(this.popout){this.$pHtmlNode=document.body;}this.$ext=this.$getExternal(null,null,function(i){this.$initButtons(i);});this.oTitle=this.$getLayoutNode("main","title",this.$ext);this.oIcon=this.$getLayoutNode("main","icon",this.$ext);this.oDrag=this.$getLayoutNode("main","drag",this.$ext);this.$buttons=this.$getLayoutNode("main","buttons",this.$ext);this.oDrag.host=this;if(this.popout){this.$ext.style.position="absolute";}if(this.oIcon){this.oIcon.style.display="none";}if(!apf.isIphone){var g=this;this.oDrag.onmousedown=function(i){if(!i){i=event;}if(!g.$isWidget&&(!g.aData||!g.dockable||g.aData.hidden==3)){apf.WinServer.setTop(g);}if(g.$lastState.maximized){return false;}if(g.aData&&g.dockable){if(g.$lastState.normal){g.startDocking(i);}return false;}};this.$ext.onmousedown=function(){var i=apf.document.activeElement;if(i&&i.$focusParent!=g&&i.$focusParent.modal){return false;}if(!g.$isWidget&&(!g.aData||!g.dockable||g.aData.hidden==3)){apf.WinServer.setTop(g);}if(!g.$lastState.normal){return false;}};this.$ext.onmousemove=function(){if(!g.$lastState.normal){return false;}};}};this.$loadAml=function(i){apf.WinServer.setTop(this);this.$int=this.$getLayoutNode("main","container",this.$ext);if(!apf.isIphone){if(this.oTitle){var g=this;(this.oTitle.nodeType!=1?this.oTitle.parentNode:this.oTitle).ondblclick=function(j){if(g.state.indexOf("normal")==-1){g.restore();}else{if(g.buttons.indexOf("max")>-1){g.maximize();}else{if(g.buttons.indexOf("min")>-1){g.minimize();}}}};}if(typeof this.draggable=="undefined"){(this.$propHandlers.draggable||apf.GuiElement.propHandlers.draggable).call(this,true);this.draggable=true;}if(typeof this.buttons=="undefined"){this.buttons="";}}if(this.modal===undefined&&this.oCover){this.$propHandlers.modal.call(this,true);this.modal=true;}if(!this.visible){this.$ext.style.display="none";if(this.oCover){this.oCover.style.display="none";}}else{if(this.modal){var g=this;apf.queue.add("focus",function(){g.focus(false,{mouse:true});});}}if(this.minwidth===undefined){this.minwidth=this.$getOption("Main","min-width");}if(this.minheight===undefined){this.minheight=this.$getOption("Main","min-height");}if(this.maxwidth===undefined){this.maxwidth=this.$getOption("Main","max-width");}if(this.maxheight===undefined){this.maxheight=this.$getOption("Main","max-height");}if(this.center&&this.visible){this.visible=false;this.$ext.style.display="none";var g=this;$setTimeout(function(){g.setProperty("visible",true);});}};this.$destroy=function(g){if(this.oDrag){this.oDrag.host=null;this.oDrag.onmousedown=null;apf.destroyHtmlNode(this.oDrag);this.oDrag=null;}this.oTitle=this.oIcon=this.oCover=null;if(this.$ext&&!g){this.$ext.onmousedown=null;this.$ext.onmousemove=null;}};}).call(apf.modalwindow.prototype=new apf.Presentation());apf.AmlWindow.prototype=apf.toolwindow.prototype=apf.modalwindow.prototype;apf.aml.setElement("toolwindow",apf.toolwindow);apf.aml.setElement("modalwindow",apf.modalwindow);apf.aml.setElement("window",apf.modalwindow);apf.actiontracker=function(d,c){this.$init(c||"actiontracker",apf.NODE_HIDDEN,d);this.$undostack=[];this.$redostack=[];this.$execstack=[];};(function(){this.$lastExecStackItem=null;this.realtime=true;this.undolength=0;this.redolength=0;this.$booleanProperties={};this.$booleanProperties.realtime=true;this.$supportedProperties=["realtime","undolength","redolength","alias","length","position"];this.$handlePropSet=function(i,g,d){switch(i){case"undolength":this.undolength=this.$undostack.length;break;case"redolength":this.redolength=this.$redostack.length;break;default:this[i]=g;}};this.addEventListener("DOMNodeInsertedIntoDocument",function(d){if(this.parentNode){this.parentNode.$at=this;}});this.define=function(g,d){apf.actiontracker.actions[g]=d;};this.getParent=function(){return this.parentNode&&this.parentNode.getActionTracker?this.parentNode.getActionTracker(true):(apf.window.$at!=this?apf.window.$at:null);};this.getDone=function(j){if(typeof j!="number"){return[];}for(var k,d,g=d=this.$stackDone.length;g>=0;--g){if(!(k=this.$stackDone[g])||!k.timestamp){continue;}if(k.timestamp>=j){return this.$stackDone.slice(g);}}return[];};this.getUndone=function(j){if(typeof j!="number"){return[];}for(var k,g=0,d=this.$stackDone.length;g<d;++g){if(!(k=this.$stackUndone[g])||!k.timestamp){continue;}if(k.timestamp<=j){return this.$stackUndone.slice(0,g+1);}}return[];};this.execute=function(d){if(this.dispatchEvent("beforechange",d)===false){return false;}var g=new apf.UndoData(d,this);if(d.action&&!d.transaction){apf.actiontracker.actions[d.action](g,false,this);}g.id=this.$undostack.push(g)-1;this.setProperty("undolength",this.$undostack.length);if(g.multiple){this.$addToQueue(g.multiple,false,true);}else{this.$addToQueue(g,false);}this.$redostack.length=0;this.setProperty("redolength",this.$redostack.length);this.dispatchEvent("afterchange",{action:"do"});return g;};this.purge=function(g,d){if(true){if(this.$execstack.length){this.$execstack[0].undoObj.saveChange(this.$execstack[0].undo,this);this.$lastExecStackItem=this.$execstack[this.$execstack.length-1];}}else{if(parent){this.reset();}}};this.reset=function(){this.$undostack.length=this.$redostack.length=0;this.setProperty("undolength",0);this.setProperty("redolength",0);this.dispatchEvent("afterchange",{action:"reset"});};this.undo=function(i,g,d){c.call(this,i,g,true,d);};this.redo=function(i,g,d){c.call(this,i,g,false,d);};function c(t,s,g,d){var j=g?this.$undostack:this.$redostack,q=g?this.$redostack:this.$undostack;if(!j.length){return;}if(s){var n=j[t];if(!n){return;}if(t!=j.length-1){throw new Error("callstack got corrupted");}j.length--;q.push(n);if(n.action){apf.actiontracker.actions[n.action](n,g,this);}if(!d){if(n.multiple){this.$addToQueue(n.multiple,g,true);}else{this.$addToQueue(n,g);}}this.setProperty("undolength",this.$undostack.length);this.setProperty("redolength",this.$redostack.length);return n;}if(this.dispatchEvent("beforechange")===false){return;}apf.console.info("Executing "+(g?"undo":"redo"));if(t==-1){t=j.length;}if(!t){t=1;}var k=0;while(k<t&&j.length>0){if(!j[j.length-1]){j.length--;apf.console.error("The actiontracker is in an invalid                                    state. The entire undo and redo stack will                                    be cleared to prevent further corruption                                   This is a serious error, please contact                                    the system administrator.");this.$undostack=[];this.$redostack=[];return false;}else{c.call(this,j.length-1,true,g,d);k++;}}this.dispatchEvent("afterchange",{action:g?"undo":"redo",rollback:d});}this.$receive=function(j,i,d,g,n){if(i==apf.TIMEOUT&&d.tpModule.retryTimeout(d,i,this)===true){return true;}if(i!=apf.SUCCESS){if(this.dispatchEvent("actionfail",apf.extend(d,{state:i,message:"Could not sent Action RPC request for control "+this.name+"["+this.localName+"] \n\n"+d.message,bubbles:true}))===false){apf.console.warn("You have cancelled the automatic undo                     process! Please be aware that if you don't retry this call                     the queue will fill up and none of the other actions will                     be sent through.");return true;}if(typeof apf.offline!="undefined"&&!apf.offline.reloading){this.undo(g.id,d.userdata,true);}if(n){n(!d.userdata);}if(!d.userdata){this.$execstack=[];var k=new Error(apf.formatErrorString(0,this,"Executing action","Error sending action to the server:\n"+(d.url?"Url:"+d.url+"\n\n":"")+d.message));if((g&&g.xmlActionNode||d.amlNode||apf).dispatchEvent("error",apf.extend({error:k,state:i,bubbles:true},d))===false){return;}throw k;}}else{this.dispatchEvent("actionsuccess",apf.extend(d,{state:i,bubbles:true},d));if(n){n();}}this.$queueNext(g,n);};this.$addToQueue=function(k,g,s){if(!s&&this.$execstack.length&&!k.state&&this.$execstack[this.$execstack.length-1].undoObj==k){this.$execstack.length--;return;}var d,n,q;if(s){var n,q=this.$execstack.shift();for(var j=0;j<k.length;j++){n=k[j];this.$execstack.unshift({undoObj:(n.tagName?n:new apf.UndoData(n,this)).preparse(g,this),undo:g});}if(q){this.$execstack.unshift(q);}return;}q={undoObj:k.preparse(g,this),undo:g};this.$execstack.push(q)-1;if(this.$execstack.length==1&&this.realtime){k.saveChange(g,this);}};this.$queueNext=function(g,i){if(!this.$execstack[0]||this.$execstack[0].undoObj!=g){throw new Error(apf.formatErrorString(0,this,"Executing Next                 action in queue","The execution stack was corrupted. This is                 a fatal error. The application should be restarted. You will                 lose all your changes. Please contact the administrator."));}g.state=null;var d=this.$execstack.shift();if(!this.$execstack[0]||d==this.$lastExecStackItem){return;}this.$execstack[0].undoObj.saveChange(this.$execstack[0].undo,this,i);};}).call(apf.actiontracker.prototype=new apf.AmlElement());apf.aml.setElement("actiontracker",apf.actiontracker);apf.param=function(d,c){this.$init(c||"param",apf.NODE_HIDDEN,d);};apf.param.prototype=new apf.AmlElement();apf.param.prototype.$parsePrio="002";apf.aml.setElement("variable",apf.param);apf.aml.setElement("param",apf.param);apf.datagrid=function(d,c){this.$init(c||"datagrid",apf.NODE_VISIBLE,d);this.$headings=[],this.$cssRules=[];this.$lastOpened={};this.$editors={};this.$dynCssClasses=[];};(function(){var d=1<<1,i=1<<2,j=1<<3,k=1<<4,g=this.$treeState;this.bufferselect=false;this.$useTable=false;this.$focussable=true;this.$isWindowContainer=-1;this.$widthdiff=0;this.$defaultwidth=0;this.$useiframe=0;this.$needsDepth=true;this.canrename=false;this.$booleanProperties.iframe=true;function c(t,u){for(var s=0;s<t.length;s++){if(!t[s][1]){continue;}if(apf.isIE){(u||window).document.styleSheets[0].addRule(t[s][0],t[s][1]);}else{(u||window).document.styleSheets[0].insertRule(t[s][0]+" {"+t[s][1]+"}",0);}}}function q(){var s=(this.current||this.$selected),t=this.$container;t.scrollTop=(s.offsetTop)-21;}this.$focus=function(){if(!this.$ext||(apf.isIE&&this.$useiframe&&this.cssfix)){return;}this.$setStyleClass(this.$ext,this.$baseCSSname+"Focus");if(this.oDoc){this.$setStyleClass(this.oDoc.documentElement,this.$baseCSSname+"Focus");}};this.$blur=function(){if(!this.$ext||(apf.isIE&&this.$useiframe&&this.cssfix)){return;}this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Focus"]);if(this.oDoc){this.$setStyleClass(this.oDoc.documentElement,"",[this.$baseCSSname+"Focus"]);}n.call(this);};this.addEventListener("bindingsload",this.$loaddatabinding=function(B){var D=B.bindings.column;if(!D||!D.length){return;}this.$headings=D;var w=0,A=false;for(var u,t=0,s=D.length;t<s;t++){u=D[t];if(!u.$width){throw new Error("missing width");}if(!u.$isPercentage){w+=parseFloat(u.$width)||0;}else{A=true;}}if(!A){this.$isFixedGrid=true;this.$setStyleClass(this.$ext,"fixed");if(this.$useiframe){this.$setStyleClass(this.oDoc.documentElement,"fixed");}}else{}if(w>0&&!this.$isFixedGrid){var C=w;this.$cssRules.push(["."+this.$baseCSSname+" .row"+this.$uniqueId,"padding-right:"+C+"px;margin-right:-"+C+"px"]);this.$container.style.paddingRight=this.$head.style.paddingRight=C+"px";}this.$fixed=w;this.$first=0;this.$withContainer=B.bindings.description?true:false;c(this.$cssRules,window);if(this.$useiframe){c(this.$cssRules,this.oWin);}});this.$initNode=function(F,t,E,A){this.$getNewContext("item");var u=this.$getLayoutNode("item");u.setAttribute("id",E);u.setAttribute("class",u.getAttribute("class")+" "+g[t]+" item"+this.$uniqueId);this.$setStyleClass(this.$getLayoutNode("item","container"),g[t]);u.setAttribute("ondblclick","var o = apf.lookup("+this.$uniqueId+");o.choose(null, true);"+(this.$withContainer?"o.slideToggle(this, null, true);":"")+(this.celledit&&!this.namevalue?"o.startRename(null, null, true);":""));if(this.hasFeature(apf.__DRAGDROP__)){u.setAttribute("onmouseout","this.hasPassedDown = false;");u.setAttribute("onmousedown","var o = apf.lookup("+this.$uniqueId+");                var xmlNode = apf.xmldb.findXmlNode(this);                 var isSelected = o.isSelected(xmlNode);                 this.hasPassedDown = true;                 if (!o.hasFeature(apf.__DRAGDROP__) || !isSelected && !event.ctrlKey)                     o.select(this, event.ctrlKey, event.shiftKey, -1);"+(this.cellselect||this.namevalue?"o.selectCell(event, this, isSelected);":""));u.setAttribute("onmouseup","if (!this.hasPassedDown) return;                var o = apf.lookup("+this.$uniqueId+");                 var xmlNode = apf.xmldb.findXmlNode(this);                 var isSelected = o.isSelected(xmlNode);                 if (o.hasFeature(apf.__DRAGDROP__))                     o.select(this, event.ctrlKey, event.shiftKey, -1);");}else{u.setAttribute("onmousedown","var o = apf.lookup("+this.$uniqueId+");                var wasSelected = o.$selected == this;                o.select(this, event.ctrlKey, event.shiftKey, -1);"+(this.cellselect||this.namevalue?"o.selectCell(event, this, wasSelected);":""));}for(var G,C,B=0;B<this.$headings.length;B++){C=this.$headings[B];if(C.tree){this.$getNewContext("treecell");G=this.$getLayoutNode("treecell");var s=this.$getLayoutNode("treecell","openclose");s.setAttribute("style","margin-left:"+(((A||0))*15+4)+"px;");s.setAttribute("onmousedown","var o = apf.lookup("+this.$uniqueId+");                    o.slideToggle(this, null, null, true);                    event.cancelBubble = true;                    apf.window.$mousedown(event);");s.setAttribute("ondblclick","event.cancelBubble = true");}else{this.$getNewContext("cell");G=this.$getLayoutNode("cell");}apf.setStyleClass(G,C.$className);if(C.css){apf.setStyleClass(G,(apf.lm.compile(C.css))(F));}if(C.icon){var w=this.$getLayoutNode(C.tree?"treecell":"cell","caption",u.appendChild(G));(w.nodeType==1&&w||w.parentNode).setAttribute("style","padding-left:19px;background:url("+apf.getAbsolutePath(this.iconPath,((C.cicon||C.$compile("icon",{nostring:true}))(F)||""))+") no-repeat 0 0;");}if(C.value){apf.setNodeValue(this.$getLayoutNode(C.tree?"treecell":"cell","caption",u.appendChild(G)),(C.cvalue2||C.$compile("value",{nostring:true}))(F)||"");}}if(this.$bindings&&this.$bindings.color){var D=this.$getDataNode("color",F);this.$setStyleClass(u,D?"highlight":null,D?["highlight"]:null);}var H=this.$applyBindRule("css",F);if(H){this.$setStyleClass(u,H);if(H){this.$dynCssClasses.push(H);}}return u;};this.$updateNode=function(E,D){if(!D){return;}var s=this.$head.childNodes,u=D.childNodes,F,t;if(!this.namevalue&&this.$curBtn){t=this.$curBtn.parentNode;}var A,B,w=0;A=u[0];while(A){if(A.nodeType!=1){A=A.nextSibling;continue;}B=apf.all[s[w].getAttribute("hid")];F=this.$getLayoutNode(B.tree?"treecell":"cell","caption",A)||A;if(B.css){apf.setStyleClass(F,(apf.lm.compile(B.css))(E));}if(B.tree){}if(B.value){F.innerHTML=(B.cvalue2||B.$compile("value",{nostring:true}))(E)||"";}if(B.icon){(F.nodeType==1&&F||F.parentNode).style.backgroundImage="url("+apf.getAbsolutePath(this.iconPath,((B.cicon||B.$compile("icon",{nostring:true}))(E)||""))+")";}w++;A=A.nextSibling;}if(this.$bindings&&this.$bindings.color){var C=this.$getDataNode("color",E);this.$setStyleClass(D,C?"highlight":null,C?["highlight"]:null);}var G=this.$applyBindRule("css",E);if(G||this.$dynCssClasses.length){this.$setStyleClass(D,G,this.$dynCssClasses);if(G&&!this.$dynCssClasses.contains(G)){this.$dynCssClasses.push(G);}}};this.$dblclick=function(C){var w=this,G,s;while(!(G=C.getAttribute(apf.xmldb.htmlIdTag))||G.indexOf("|")==-1){C=(s=C).parentNode;}if(this.$lastEditor&&this.$lastEditor[3]==C){return;}var M,t=s.className.match(/(col\d+)/)[1];for(var L=0;L<this.$headings.length;L++){if(this.$headings[L].$className==t){M=this.$headings[L];break;}}if(!M.editor){return;}var u=apf.xmldb.getNode(C);var K=M.tree?this.$getLayoutNode("cell","caption",s):s;var F,A=M.editor;var B=apf.lm.compile(A,{xpathmode:2});var I=K.childNodes;for(var L=0,J=I.length;L<J;L++){if(!I[L].host){if(I[L].nodeType==1){I[L].style.display="none";}else{this.$lastTextValue=I[L].nodeValue;I[L].nodeValue="";}}}if(B.type==2){if(!this.$editors[A]){var H=apf.namespaces[apf.ns.aml].elements[A];var N={htmlNode:K,style:"position:relative;z-index:10000",value:"[{"+this.id+".selected}::"+(v=M.value).substr(1,v.length-2)+"]",focussable:false};if(!M.tree){N.width="100%-3";}F=this.$editors[A]=new H(N);var D=apf.getBox(apf.getStyle(F.$ext,"margin"));if(D[1]||D[3]){F.setAttribute("width","100%+2-"+(D[1]+D[3]));}F.addEventListener("blur",function(){n.call(w);});F.parentNode=this;F.realtime=false;F.$focusParent=this;F.setAttribute("focussable","true");F.addEventListener("beforechange",function(O){return w.dispatchEvent("beforechange",O);});F.addEventListener("afterchange",function(O){return w.dispatchEvent("afterchange",O);});F.addEventListener("keydown",function(O){if(O.keyCode==13){n.call(w);w.$focus();}else{if(O.keyCode==27){F.removeAttribute("value");n.call(w);}}});}else{F=this.$editors[A];if(F.hasFeature(apf.__MULTISELECT__)){F.setAttribute("model","{apf.xmldb.getElementById('"+prop.getAttribute(apf.xmldb.xmlIdTag)+"')}");}F.setAttribute("value","[{"+this.id+".selected}::"+(v=M.value).substr(1,v.length-2)+"]");F.setProperty("visible",true);K.appendChild(F.$ext);F.setAttribute("width",M.tree?"":"100%-3");}}else{var E=B.call(this,this.xmlRoot);if(E.localName=="template"){}else{}}if(F.localName=="textbox"){F.select();}F.focus();F.$focus();this.$setStyleClass(C,"editing");this.$lastEditor=[F,K,u,C,this.getActionTracker().undolength];};this.addEventListener("mousedown",function(s){if(this.$lastEditor&&!apf.isChildOf(this.$lastEditor[1],s.htmlEvent.srcElement||s.htmlEvent.target,true)){n.call(this);}});this.addEventListener("beforeselect",function n(A){if(this.$lastEditor){var u=this.$lastEditor;this.$lastEditor=null;u[0].setProperty("visible",false);var t=u[1].childNodes;for(var w=0,s=t.length;w<s;w++){if(!t[w].host){if(t[w].nodeType==1){t[w].style.display="";}else{if(!u[0].value){t[w].nodeValue=this.$lastTextValue;}}}}this.$setStyleClass(u[3],"",["editing"]);this.focus();}});this.getColumn=function(s){return this.$headings[s||this.$lastcol||0];};this.resizeColumn=function(u,t){var s=this.$headings[u];s.resize(t);};this.hideColumn=function(t){var s=this.$headings[t];s.hide();};this.showColumn=function(t){var s=this.$headings[t];s.show();};this.sortColumn=function(s){var t=this.$headings[nr];t.sort();};this.moveColumn=function(u,t){var s=this.$headings[nr];s.move(t);};this.$draw=function(){this.$drawBase();var s=this;this.$ext.onmousedown=function(w){s.dispatchEvent("mousedown",{htmlEvent:w||event});};this.$head=this.$getLayoutNode("main","head",this.$ext);this.$pointer=this.$getLayoutNode("main","pointer",this.$ext);if(this.$head.firstChild){this.$head.removeChild(this.$head.firstChild);}if(this.$container.firstChild){this.$container.removeChild(this.$container.firstChild);}var t=this.$widthdiff=this.$getOption("main","widthdiff")||0;this.$defaultwidth=this.$getOption("main","defaultwidth")||"100";this.$useiframe=apf.isIE&&(apf.isTrue(this.$getOption("main","iframe"))||this.iframe);if(this.$useiframe&&!this.oIframe){var u=this.$container.className;this.oIframe=this.$container.appendChild(document.createElement(apf.isIE?"<iframe frameborder='0'></iframe>":"iframe"));this.oIframe.frameBorder=0;this.oWin=this.oIframe.contentWindow;this.oDoc=this.oWin.document;this.oDoc.write('<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">                <html xmlns="http://www.w3.org/1999/xhtml">                    <head><script>                        apf = {                            lookup : function(uid){                                return window.parent.apf.lookup(uid);                            },                            Init : {add:function(){},run:function(){}}                        };<\/script>                    </head>                    <body></body>                </html>');this.$container=this.oDoc.body;this.$container.className=u;this.oDoc.documentElement.className=this.$ext.className;apf.skins.loadCssInWindow(this.skinName,this.oWin,this.mediaPath,this.iconPath);if(apf.isIE){this.$setStyleClass(this.oDoc.documentElement,this.$baseCSSname+"Focus");}apf.convertIframe(this.oIframe,true);if(apf.getStyle(this.oDoc.documentElement,apf.isIE?"overflowY":"overflow-y")=="auto"){this.oIframe.onresize=function(){s.$head.style.marginRight=s.oDoc.documentElement.scrollHeight>s.oDoc.documentElement.offsetHeight?"16px":"0";};this.addEventListener("afterload",this.oIframe.onresize);this.addEventListener("xmlupdate",this.oIframe.onresize);}this.oDoc.documentElement.onscroll=function(){if(s.$isFixedGrid){s.$head.scrollLeft=s.oDoc.documentElement.scrollLeft;}};}else{if(apf.getStyle(this.$container,apf.isIE?"overflowY":"overflow-y")=="auto"){this.$resize=function(){s.$head.style.marginRight=s.$container.scrollHeight>s.$container.offsetHeight?"16px":"0";};apf.layout.setRules(this.$ext,this.$uniqueId+"_datagrid","var o = apf.all["+this.$uniqueId+"];                     if (o) o.$resize()");apf.layout.queue(this.$ext);this.addEventListener("afterload",this.$resize);this.addEventListener("xmlupdate",this.$resize);}this.$container.onscroll=function(){if(s.$isFixedGrid){s.$head.scrollLeft=s.$container.scrollLeft;}};}this.$container.ondblclick=function(w){if(!w){w=event;}s.$dblclick(w.srcElement||w.target);};};this.$destroy=function(){this.$ext.onclick=this.$container.onresize=null;apf.layout.removeRule(this.$container,"dg"+this.$uniqueId);apf.layout.activateRules(this.$container);};}).call(apf.datagrid.prototype=new apf.BaseTree());apf.aml.setElement("datagrid",apf.datagrid);apf.aml.setElement("description",apf.BindingRule);apf.aml.setElement("color",apf.BindingRule);apf.aml.setElement("contents",apf.BindingRule);apf.skin=function(d,c){this.$init(c||"skin",apf.NODE_HIDDEN,d);};apf.aml.setElement("skin",apf.skin);(function(){this.$parsePrio="002";this.$includesRemaining=0;this.$propHandlers.src=function(j){this.$path=apf.getAbsolutePath(apf.hostPath,j);c.call(this,this.$path);};this.$propHandlers.name=function(j){if(!this.attributes.getNamedItem("src")){this.$path=apf.getAbsolutePath(apf.hostPath,j)+"/index.xml";c.call(this,this.$path);}};function i(n){if(!n.ownerDocument.documentElement){return false;}var j=n.ownerDocument.documentElement.attributes;for(var q=false,k=0;k<j.length;k++){if(j[k].nodeValue==apf.ns.aml){q=true;break;}}if(!q){throw new Error(apf.formatErrorString(0,null,"Checking for the aml namespace","The Ajax.org Platform xml namespace was not found in "+(n.getAttribute("filename")?"in '"+n.getAttribute("filename")+"'":"")));}return q;}function c(j){var n=this.ownerDocument.$domParser;if(!apf.skins.$first){apf.skins.$first=this;}var k=this.attributes.getNamedItem("defer");if(!k||!apf.isTrue(k.nodeValue)){n.$shouldWait++;this.$parseContext=n.$parseContext||[this.ownerDocument.documentElement];}d.call(this,j);}function g(j){if(j){apf.skins.Init(j,this,this.$path);}if(!this.defer){var k=this.ownerDocument.$domParser;k.$continueParsing.apply(k,this.$parseContext);}}function d(k){apf.console.info("Loading include file: "+k);var j=this;apf.getData(k,{type:"skin",callback:function(t,s,n){if(s!=apf.SUCCESS){var u=new Error(apf.formatErrorString(1007,j,"Loading skin file","Could not load skin file '"+(k||j.src)+"'\nReason: "+n.message));if(n.tpModule.retryTimeout(n,s,null,u)===true){return true;}throw u;}t=t.replace(/\<\!DOCTYPE[^>]*>/,"").replace(/^[\r\n\s]*/,"").replace(/xmlns\=\"[^"]*\"/g,"");if(!t){throw new Error(apf.formatErrorString(0,j,"Loading skin","Empty skin file. Maybe the file does not exist?",j));}var q=apf.getXml(t);i(q);if(!q){throw new Error(apf.formatErrorString(0,j,"Loading skin","Could not parse skin. Maybe the file does not exist?",j));}q.setAttribute("filename",n.url);apf.console.info("Loading of "+q[apf.TAGNAME].toLowerCase()+" skin done from file: "+n.url);g.call(j,q);},async:true,ignoreOffline:true});}this.addEventListener("DOMNodeInsertedIntoDocument",function(j){if(this.src||this.name){return;}apf.skins.Init(this);});}).call(apf.skin.prototype=new apf.AmlElement());apf.model=function(d,c){this.$init(c||"model",apf.NODE_HIDDEN,d);this.$amlNodes={};this.$propBinds={};this.$listeners={};this.$proplisteners={};if(!apf.globalModel){apf.globalModel=this;apf.nameserver.register("model","@default",this);}};(function(){this.$parsePrio="020";this.$isModel=true;this.canHaveChildren=false;this["save-original"]=true;this.$state=0;this.$attrExcludePropBind=apf.extend({submission:1,src:1,session:1},this.$attrExcludePropBind);this.$booleanProperties.autoinit=true;this.$booleanProperties["save-original"]=true;this.$supportedProperties=["submission","src","session","autoinit","save-original","remote"];this.$propHandlers.src=this.$propHandlers.get=function(c,d){if(this.$amlLoaded){this.$loadFrom(c);}};this.$propHandlers.validation=function(c,d){apf.nameserver.get("validation",c).register(this);};this.register=function(d,c){if(!d||!d.load){return this;}if(d.$model&&d.$model!=this){d.$model.unregister(d);}var i=this.$amlNodes[d.$uniqueId]={amlNode:d,xpath:c};d.$model=this;if(typeof d.noloading=="undefined"&&d.$setInheritedAttribute&&!d.$setInheritedAttribute("noloading")){d.noloading=false;}if(this.$state==1){if(d.clear&&!d.noloading){d.clear("loading");}}else{if(this.data){this.$loadInAmlNode(i);}else{if(d.clear){d.clear("empty");}}}var k,g,j=d.$propsUsingMainModel;for(var n in j){k=this.$bindXmlProperty(d,n,j[n].xpath,j[n].optimize);if(this.data){if(g=k.root||k.listen?this.data.selectSingleNode(k.root||k.listen):this.data){d.$execProperty(n,g);}else{this.$waitForXml(d,n);}}}return this;};this.$register=function(d,c){this.$amlNodes[d.$uniqueId].xpath=c;};this.unregister=function(c){delete this.$amlNodes[c.$uniqueId];var d=c.$propsUsingMainModel;for(var g in d){this.$unbindXmlProperty(c,g);}};this.getXpathByAmlNode=function(c){var d=this.$amlNodes[c.$uniqueId];if(!d){return false;}return d.xpath;};this.$loadInAmlNode=function(i){var g;var c=i.xpath;var d=i.amlNode;if(this.data&&c){g=this.data.selectSingleNode(c);}else{g=this.data||null;}if(g){delete this.$listeners[d.$uniqueId];d.load(g);}else{this.$waitForXml(d);}};this.$loadInAmlProp=function(k,d){var j,g,i=this.$propBinds[k],c=apf.all[k];if(!c){delete this.$propBinds[k];return;}if(c.$noInitModel){delete c.$noInitModel;return;}for(j in i){if(g=i[j].root?d.selectSingleNode(i[j].root):d){apf.xmldb.addNodeListener(d,c,"p|"+k+"|"+j+"|"+this.$uniqueId);delete this.$proplisteners[k];c.$execProperty(j,g);}else{this.$waitForXml(c,j);}}};this.$bindXmlProperty=function(j,c,n,u,s){var d,i,g=j.$uniqueId;if(!this.$propBinds[g]){this.$propBinds[g]={};}i=this.$propBinds[g][c]={bind:n};if(u){if((d=this.$amlNodes[g])&&d.xpath){n=(i.root=d.xpath)+"/"+n;}var k=n.split("/"),t=k.pop();if(t.indexOf("@")==0||t.indexOf("text()")>-1||t.indexOf("node()")>-1){i.listen=k.join("/");}else{i.listen=n;}}else{if((d=this.$amlNodes[g])&&d.xpath){i.listen=d.xpath;}}if(s){i.listen=".";}if(this.data){var w=j.$noInitModel?j.xmlRoot:(i.listen?this.data.selectSingleNode(i.listen):this.data);if(w){apf.xmldb.addNodeListener(w,j,"p|"+j.$uniqueId+"|"+c+"|"+this.$uniqueId);return i;}}this.$waitForXml(j,c);return i;};this.$unbindXmlProperty=function(d,j){var i=d.$uniqueId;var g=this.$propBinds[i]&&this.$propBinds[i][j];if(!g){return;}if(this.data){var c=g.listen?this.data.selectSingleNode(g.listen):this.data;if(c){apf.xmldb.removeNodeListener(c,d,"p|"+i+"|"+j+"|"+this.$uniqueId);}}delete this.$proplisteners[i+j];delete this.$propBinds[i][j];return g;};this.getXml=function(){return this.data?apf.xmldb.cleanNode(this.data.cloneNode(true)):false;};this.setQueryValue=function(c,g){if(!this.data){return false;}var d=apf.createNodeFromXpath(this.data,c);if(!d){return null;}apf.setNodeValue(d,g,true);return d;};this.queryValue=function(c){if(!this.data){return false;}return apf.queryValue(this.data,c);};this.queryValues=function(c){if(!this.data){return false;}return apf.queryValue(this.data,c);};this.queryNode=function(c){if(!this.data){return null;}return this.data.selectSingleNode(c);};this.queryNodes=function(c){if(!this.data){return null;}return this.data.selectNodes(c);};this.appendXml=function(g,c){var d=c?apf.createNodeFromXpath(this.data,c):this.data;if(!d){return null;}if(typeof g=="string"){g=apf.getXml(g);}else{g=!g.nodeType?g.getXml():apf.xmldb.getCleanCopy(g);}if(!g){return;}apf.xmldb.appendChild(d,g);};this.removeXml=function(c){if(typeof c=="string"){c=this.data.selectNodes(c);}else{if(!c.length){c=[c];}}if(c){apf.xmldb.removeNodeList(c);}};this.clear=function(){this.load(null);doc=null;};this.reset=function(){this.load(this.$copy);};this.savePoint=function(){this.$copy=apf.xmldb.getCleanCopy(this.data);};this.reloadAmlNode=function(g){if(!this.data){return;}var d=this.$amlNodes[g];var c=d.xpath?this.data.selectSingleNode(d.xpath):this.data;d.amlNode.load(c);};this.addEventListener("DOMNodeInsertedIntoDocument",function(g){var c=this.$aml;if(this.parentNode.hasFeature(apf.__DATABINDING__)){if(!this.name){this.setProperty("id","model"+this.parentNode.$uniqueId);}this.register(this.parentNode);}if(!this.src){var i,d=c;if(d.childNodes.length){if(apf.getNode(d,[0])){if((i=d.xml||d.serialize()).match(/^[\s\S]*?>([\s\S]*)<[\s\S]*?$/)){i=RegExp.$1;if(!apf.supportNamespaces){i=i.replace(/xmlns=\"[^"]*\"/g,"");}}return this.load(apf.getXmlDom(i).documentElement);}else{if(apf.isJson(d.childNodes[0].nodeValue)){return this.load(apf.getXmlDom(d.childNodes[0].nodeValue).documentElement);}}}if(this.submission){this.load("<data />");}}if(!apf.isFalse(this.autoinit)){this.init();}return this;});this.init=function(c){if(this.session){this.$loadFrom(this.session,{isSession:true});}else{if(this.src){this.$loadFrom(this.src,{callback:c});}}};this.$loadFrom=function(d,g){var j=d.split(":");if(!g){g={};}if(!g.isSession){this.src=d;this.$srcOptions=[d,g];}this.dispatchEvent("beforeretrieve");var q,i;for(q in this.$amlNodes){if(!(i=this.$amlNodes[q])||!i.amlNode){continue;}if(!i.amlNode.noloading){i.amlNode.clear("loading");}}this.$state=1;if(!this.$callCount){this.$callCount=1;}else{this.$callCount++;}var c=this,k=this.$callCount,n=g.callback;g.callback=function(u,t,s){if(k!=c.$callCount){return;}c.dispatchEvent("afterretrieve");if(t!=apf.SUCCESS){var w;w=new Error(apf.formatErrorString(1032,c,"Inserting xml data","Could not load data\nInstruction: "+d+"\nUrl: "+s.url+"\nInfo: "+s.message+"\n\n"+u));if(n&&n.apply(this,arguments)===true){return true;}if(s.tpModule&&s.tpModule.retryTimeout(s,t,c,w)===true){return true;}c.$state=0;throw w;}if(g&&g.isSession&&!u){if(this.src){return c.$loadFrom(this.src);}}else{if(g&&g.cancel){return;}c.load(u);c.dispatchEvent("receive",{data:u});if(n){n.apply(this,arguments);}}};return apf.getData(d,g);};this.reload=function(){if(!this.data){return;}if(this.$srcOptions){this.$loadFrom.apply(this,this.$srcOptions);}else{if(this.src){this.$loadFrom(this.src);}}};this.load=function(s,t){if(typeof s=="string"){if(s.charAt(0)=="<"){if(s.substr(0,5).toUpperCase()=="<!DOC"){s=s.substr(s.indexOf(">")+1);}if(!apf.supportNamespaces){s=s.replace(/xmlns\=\"[^"]*\"/g,"");}s=apf.getXmlDom(s,null,true).documentElement;}else{return this.$loadFrom(s,t);}}if(this.ownerDocument&&this.ownerDocument.$domParser.$shouldWait){var n=this;this.data=this.$copy=s;this.$queueLoading=true;apf.queue.add("modelload"+this.$uniqueId,function(){n.load(s,t);n.$queueLoading=false;});return;}else{if(this.$queueLoading){apf.queue.remove("modelload"+this.$uniqueId);}}this.$state=0;if(this.dispatchEvent("beforeload",{xmlNode:s})===false){return false;}var q=s?s.ownerDocument:null;if(s){if(!apf.supportNamespaces){var g=[],k=s.attributes;for(var j=0,d=k.length;j<d;j++){if(k[j].nodeName.substr(0,5)=="xmlns"){g.push(k[j].xml);}}if(g.length){q.setProperty("SelectionNamespaces",g.join(" "));}}apf.xmldb.addNodeListener(s,this);apf.xmldb.nodeConnect(apf.xmldb.getXmlDocId(s,this),s,null,this);if((!t||!t.nocopy)&&this["save-original"]){this.$copy=apf.xmldb.getCleanCopy(s);}}this.data=s;this.dispatchEvent("afterload",{xmlNode:s});for(var c in this.$amlNodes){this.$loadInAmlNode(this.$amlNodes[c]);}for(c in this.$propBinds){this.$loadInAmlProp(c,s);}return this;};this.$waitForXml=function(c,d){if(d){this.$proplisteners[c.$uniqueId+d]={id:c.$uniqueId,amlNode:c,prop:d};}else{this.$listeners[c.$uniqueId]=c;}};this.$xmlUpdate=function(j,d,i,g){var k,c;for(var n in this.$listeners){if(d=this.data.selectSingleNode(this.$amlNodes[n].xpath||".")){this.$listeners[n].load(d);delete this.$listeners[n];}}for(n in this.$proplisteners){k=this.$proplisteners[n];c=this.$propBinds[k.id][k.prop];if(d=c.listen?this.data.selectSingleNode(c.listen):this.data){apf.xmldb.addNodeListener(d,k.amlNode,"p|"+k.id+"|"+k.prop+"|"+this.$uniqueId);delete this.$proplisteners[n];k.amlNode.$execProperty(k.prop,c.root?this.data.selectSingleNode(c.root):this.data);}}this.dispatchEvent("update",{xmlNode:d,action:j});};this.$insertFrom=function(d,g){if(!d){return false;}this.dispatchEvent("beforeretrieve");var i=g.amlNode;var j=g.callback,c=this;g.callback=function(q,n,k){c.dispatchEvent("afterretrieve");if(!k){k={};}if(n!=apf.SUCCESS){var s;s=new Error(apf.formatErrorString(0,c,"Inserting xml data","Could not insert data\nInstruction:"+d+"\nUrl: "+k.url+"\nInfo: "+k.message+"\n\n"+q));if(k.tpModule.retryTimeout(k,n,g.amlNode||c,s)===true){return true;}if(j&&j.call(this,k.data,n,k)===false){return;}throw s;}if(typeof g.insertPoint=="string"){g.insertPoint=c.data.selectSingleNode(g.insertPoint);}if(typeof g.clearContents=="undefined"&&k.userdata){g.clearContents=apf.isTrue(k.userdata[1]);}(g.amlNode||c).insert(q,g);if(j){j.call(this,k.data,n,k);}};apf.getData(d,g);};this.insert=function(g,c){if(typeof g=="string"){if(g.charAt(0)=="<"){if(g.substr(0,5).toUpperCase()=="<!DOC"){g=g.substr(g.indexOf(">")+1);}if(!apf.supportNamespaces){g=g.replace(/xmlns\=\"[^"]*\"/g,"");}g=apf.getXmlDom(g).documentElement;}else{return this.$insertFrom(g,c);}}if(!c.insertPoint){c.insertPoint=this.data;}if(!c.insertPoint){throw new Error(apf.formatErrorString(0,amlNode||_self,"Inserting data","Could not determine insertion point for instruction: "+instruction));}if(typeof c.copyAttributes=="undefined"){c.copyAttributes=true;}var d=apf.mergeXml(g,c.insertPoint,c);apf.xmldb.applyChanges("insert",c.insertPoint);return g;};this.convertXml=function(c){if(!c){return this.data.xml;}return apf.convertXml(this.data,c);};this.submit=function(c,j,i,g){if(!c){c=this.submission;}if(!i){i=this.data;}if(!i){throw new Error(apf.formatErrorString(0,this,"Submitting model","Could not submit data, because no data was passed and the model does not have data loaded."));}if(!j){j="form";}if(this.dispatchEvent("beforesubmit",{instruction:c})===false){return false;}var d=this;function n(t,s,q){if((s==apf.TIMEOUT||(d.retryOnError&&s==apf.ERROR))&&q.retries<apf.maxHttpRetries){return q.tpModule.retry(q.id);}else{if(s!=apf.SUCCESS){d.dispatchEvent("submiterror",q);}else{d.dispatchEvent("submitsuccess",apf.extend({data:t},q));}}}var k;if(j.indexOf("xml")>-1){k=apf.getXmlString(i);}else{if(j.indexOf("form")>-1){k=apf.convertXml(apf.xmldb.getCleanCopy(i),"cgiobjects");}else{if(j.indexOf("json")>-1){k=apf.convertXml(i,"json");}}}apf.saveData(c,apf.extend({xmlNode:i,data:k,callback:n},g));this.dispatchEvent("aftersubmit");};this.$destroy=function(){if(this.session&&this.data){apf.saveData(this.session,{xmlNode:this.getXml()});}};}).call(apf.model.prototype=new apf.AmlElement());apf.aml.setElement("model",apf.model);apf.list=function(d,c){this.$init(c||"list",apf.NODE_VISIBLE,d);};apf.thumbnail=function(d,c){this.$init(c||"thumbnail",apf.NODE_VISIBLE,d);};apf.select=function(d,c){this.$init(c||"select",apf.NODE_VISIBLE,d);};apf.select1=function(d,c){this.$init(c||"selectl",apf.NODE_VISIBLE,d);};(function(){if(!apf.isIphone){this.implement(apf.Rename);}this.$getCaptionElement=function(){if(!(this.$caret||this.$selected)){return;}var g=this.$getLayoutNode("item","caption",this.$caret||this.$selected);if(!g){return;}return g.nodeType==1?g:g.parentNode;};this.$supportedProperties.push("appearance","mode","more","thumbsize");this.$propHandlers.thumbsize=function(k){var j=this.thumbclass;if(apf.isIE){j=j.splitSafe(",");for(var g=0;g<j.length;g++){apf.setStyleRule(j[g],"width",k+"px");apf.setStyleRule(j[g],"height",k+"px");}return;}apf.setStyleRule(j,"width",k+"px");apf.setStyleRule(j,"height",k+"px");};this.$propHandlers.appearance=function(g){};this.mode="normal";this.$propHandlers.mode=function(g){this.mode=g||"normal";if("check|radio".indexOf(this.mode)>-1){this.allowdeselect=false;this.addEventListener("afterrename",c);if(this.mode=="check"){this.autoselect=false;this.ctrlselect=true;}else{if(this.mode=="radio"){this.multiselect=false;}}}else{this.ctrlselect=false;this.removeEventListener("afterrename",c);}};function c(){}this.$propHandlers.more=function(g){if(g){this.delayedselect=false;this.addEventListener("xmlupdate",d);this.addEventListener("afterload",d);this.$setClearMessage=function(i){if(!this.moreItem){this.$fill();}this.$container.appendChild(this.moreItem);};this.$updateClearMessage=function(){};this.$removeClearMessage=function(){};}else{this.removeEventListener("xmlupdate",d);this.removeEventListener("afterload",d);}};function d(g){if((!g.action||"insert|add|synchronize|move".indexOf(g.action)>-1)&&this.moreItem){this.$container.appendChild(this.moreItem);}}this.addEventListener("keydown",this.$keyHandler,true);this.$draw=function(){this.appearance=this.getAttribute("appearance")||"compact";var i=this.getAttribute("mode");this.$ext=this.$getExternal();this.$container=this.$getLayoutNode("main","container",this.$ext);if(apf.hasCssUpdateScrollbarBug&&!this.mode){this.$fixScrollBug();}var g=this;this.$ext.onclick=function(j){g.dispatchEvent("click",{htmlEvent:j||event});};this.$ext.setAttribute("onmouseout",this.$ext.getAttribute("onmouseout")+";var o = apf.lookup("+this.$uniqueId+");o.$selectSeries(event);");this.listtype=parseInt(this.$getOption("main","type"))||1;this.behaviour=parseInt(this.$getOption("main","behaviour"))||1;this.thumbsize=this.$getOption("main","thumbsize");this.thumbclass=this.$getOption("main","thumbclass");};this.$selectSeries=function(i){i=i||event;var g=i.target||i.srcElement;if(i.type=="mouseover"){var g=(g.className||"").indexOf("item")!=-1?g:g.parentNode;this.highlight(g);}else{g=i.toElement?i.toElement:(i.relatedTarget?i.relatedTarget:null);if(!apf.isChildOf(this.$ext,g,true)){this.highlight(this.$selected);}}};this.highlight=function(q){var g=this.$ext.childNodes;var n=g.length;var k=false;for(var j=0;j<n;j++){if((g[j].className||"").indexOf("item")!=-1){if(!k){this.$setStyleClass(g[j],"selected");}else{this.$setStyleClass(g[j],"",["selected"]);}if(g[j]==q){k=true;}}}};this.$loadAml=function(g){};this.$destroy=function(){if(this.$ext){this.$ext.onclick=null;}apf.destroyHtmlNode(this.oDrag);this.oDrag=null;};}).call(apf.list.prototype=new apf.BaseList());apf.thumbnail.prototype=apf.select.prototype=apf.select1.prototype=apf.list.prototype;apf.aml.setElement("thumbnail",apf.thumbnail);apf.aml.setElement("select",apf.select);apf.aml.setElement("select1",apf.select1);apf.aml.setElement("list",apf.list);apf.errorbox=function(d,c){this.$init(c||"errorbox",apf.NODE_VISIBLE,d);};(function(){this.$positioning="basic";this.display=function(g){this.host=g;var d=g.$ext;document.body.appendChild(this.$ext);var c=(parseFloat(g.$getOption&&g.$getOption("main","erroffsetx")||0)),i=(parseFloat(g.$getOption&&g.$getOption("main","erroffsety")||0));this.show();apf.popup.show(this.$uniqueId,{x:c,y:i,animate:false,ref:d});this.$setStyleClass(this.$ext,c+this.$ext.offsetWidth>this.$ext.offsetParent.offsetWidth?"rightbox":"leftbox",["leftbox","rightbox"]);};this.setMessage=function(c){if(c&&c.indexOf(";")>-1){c=c.split(";");c="<strong>"+c.shift()+"</strong>"+c.join(";");}this.$int.innerHTML=c||"";};this.$draw=function(){this.$ext=this.$getExternal();this.$int=this.$getLayoutNode("main","container",this.$ext);this.oClose=this.$getLayoutNode("main","close",this.$ext);if(this.oClose){var c=this;this.oClose.onclick=function(){c.hide();if(apf.document.activeElement){apf.document.activeElement.focus(true,{mouse:true});}};}this.$ext.onmousedown=function(d){(d||event).cancelBubble=true;if(apf.hasFocusBug){apf.window.$focusfix();}};apf.popup.setContent(this.$uniqueId,this.$ext,"",null,null);};this.$loadAml=function(c){if(!apf.isTrue(this.getAttribute("visible"))){this.hide();}};this.$destroy=function(){if(this.oClose){this.oClose.onclick=null;}this.$ext.onmousedown=null;apf.popup.removeContent(this.$uniqueId);};}).call(apf.errorbox.prototype=new apf.Presentation());apf.aml.setElement("errorbox",apf.errorbox);apf.BindingQuicksandRule=function(d,c){this.$init(c,apf.NODE_HIDDEN,d);};(function(){function getFilteredNodes(pNode){pNode=pNode||this.$parent;var attr,tmp,res=[],dataIDs=[],xmlNodes=pNode.$getDataNode("quicksand",pNode.xmlRoot,false,null,true),domNodes=pNode.$ext.childNodes,i=0,l=xmlNodes.length;if(!domNodes.length||!l){return res;}for(;i<l;++i){dataIDs.push(xmlNodes[i].getAttribute("a_id"));}for(i=0,l=domNodes.length;i<l;++i){if(!domNodes[i]||!(attr=domNodes[i].getAttribute("id"))){continue;}tmp=attr.split("|");tmp.pop();if(dataIDs.indexOf(tmp.join("|"))>-1){res.push(domNodes[i]);}}return res;}function nodeInFilter(node,filtered){var i=0,l=filtered.length,s=node.getAttribute("id");for(;i<l;++i){if(filtered[i].getAttribute("id")==s){return filtered[i];}}return null;}function quicksand(parent,customOptions){parent=this.$parent.$ext;var i,l,dest,src,offset,_self=this,coll=getFilteredNodes.call(this),parentOffset=apf.getAbsolutePosition(parent),offsets=[],callbackFunction=typeof(arguments[1])=="function"?arguments[1]:typeof arguments[2]=="function"?arguments[2]:apf.K,postCallback=function(){_self.dispatchEvent("afterquicksand");callbackFunction.call(_self);},options={steps:60,anim:apf.tween.easeInOutQuad,onfinish:postCallback,adjustHeight:true};apf.extend(options,customOptions);if(apf.isIE&&apf.isIE<7){parent.innerHTML="";for(i=0,l=coll.length;i<l;i++){parent.appendChild(coll[i]);}return;}var $source=parent.childNodes;var correctionOffset=[0,0];parent.style.height=parent.offsetHeight+"px";apf.tween.clearQueue(parent,true);for(i=0,l=$source.length;i<l;++i){src=$source[i];offsets[i]=apf.getAbsolutePosition(src,parent,false);}for(i=0,l=$source.length;i<l;++i){src=$source[i];with(src.style){position="absolute";margin="0";top=(offsets[i][1]-parentOffset[1])+"px";left=(offsets[i][0]-parentOffset[0])+"px";}}var $dest=parent.cloneNode(false);$dest.setAttribute("id","");for(i=0,l=coll.length;i<l;++i){$dest.appendChild(coll[i].cloneNode(true));coll[i].$offset=apf.getAbsolutePosition(coll[i]);}parent.parentNode.insertBefore($dest,parent);with($dest.style){zIndex=1;opacity=0;margin=0;position="absolute";top=parentOffset[1]-correctionOffset[1]+"px";left=parentOffset[0]-correctionOffset[0]+"px";}if(false){apf.tween.single(parent,{steps:options.steps,anim:options.anim,type:"height",from:parent.offsetHeight,to:$dest.offsetHeight});}var insets=[];for(i=0,l=$source.length;i<l;++i){src=$source[i];if(dest=nodeInFilter(src,coll)){offset=insets.shift()||offsets[i];options.tweens=[{type:"top",from:dest.$offset[1]-parentOffset[1],to:offset[1]-parentOffset[1]},{type:"left",from:dest.$offset[0]-parentOffset[0],to:offset[0]-parentOffset[0]},{type:"opacity",from:apf.getStyle(src,"opacity"),to:1}];if(apf.supportCSSAnim){options.tweens.push({type:"transform",subType:"scale",from:0,to:1});}apf.tween.multi(src,options);}else{options.tweens=[{type:"opacity",from:apf.getStyle(src,"opacity"),to:0}];if(apf.supportCSSAnim){options.tweens.push({type:"transform",subType:"scale",from:1,to:0});}insets.push(offsets[i]);apf.tween.multi(src,options);}}for(i=0,l=coll.length;i<l;++i){var item=coll[i];if(!nodeInFilter(item,$source)){dest=nodeInFilter(item,coll);options.tweens=[{type:"opacity",from:0,to:1}];if(!apf.isIE){}offset=apf.getAbsolutePosition(dest);dest=dest.cloneNode(true);with(dest.style){position="absolute";margin="0";top=(offset[1]-parentOffset[1])+"px";left=(offset[0]-parentOffset[0])+"px";opacity="0";transform="scale(.0)";}parent.appendChild(dest);apf.tween.multi(dest,options);}}}this.addEventListener("DOMNodeInsertedIntoDocument",function(e){var pNode=this;while(pNode&&pNode.$bindingRule){pNode=pNode.parentNode;}this.$parent=pNode;if(!pNode){return;}var _self=this;setTimeout(function(){quicksand.call(_self);});});}).call(apf.BindingQuicksandRule.prototype=new apf.BindingRule());apf.aml.setElement("quicksand",apf.BindingQuicksandRule);apf.validation=function(d,c){this.$init(c||"validation",apf.NODE_HIDDEN,d);};(function(){this.$rules=[];var c={};this.register=function(d){if(d.tagName!="model"){return;}c[d.$uniqueId]=d;d.$validation=this;};this.unregister=function(){c[amlNode.$uniqueId]=null;delete c[amlNode.$uniqueId];amlNode.$validation=null;};this.getRule=function(j){var k=apf.xmldb.nodeConnect(apf.xmldb.getXmlDocId(j),j.nodeType==1?j:j.parentNode);for(var g=0,d=this.$rules.length;g<d;g++){if(j.ownerDocument.selectSingleNode("(.//"+this.$rules[g][0].split("|").join("|.//")+")[@"+apf.xmldb.xmlIdTag+"='"+k+"']")){return this.$rules[g][1];}}};this.validate=function(g,i,d){var j=this.getRule(g);if(!j){return d;}return(j.isValid||(j.isValid=apf.validator.compile(j)))(apf.queryValue(g),i,d);};this.addEventListener("DOMNodeInsertedIntoDocument",function(s){var w=this.$aml;var u,t,g,d=w.childNodes;for(var q=0,k=d.length;q<k;q++){if((g=d[q]).nodeType!=1){continue;}this.$rules.push([g.getAttribute("match"),(u={})]);t=g.attributes;for(var n=0;n<t.length;n++){u[t[n].nodeName]=t[n].nodeValue;}u.node=g;}this.register(this.parentNode);});}).call(apf.validation.prototype=new apf.AmlElement());apf.aml.setElement("validation",apf.validation);apf.splitter=function(d,c){this.$init(c||"splitter",apf.NODE_VISIBLE,d);apf.plane.init();};(function(){this.$focussable=true;this.update=function(){var G=(this.type=="vertical")?{fsize:"fwidth",size:"width",offsetPos:"offsetLeft",offsetSize:"offsetWidth",pos:"left"}:{fsize:"fheight",size:"height",offsetPos:"offsetTop",offsetSize:"offsetHeight",pos:"top"};this.$ext.offsetTop;this.$amlNode=this.refNode;var n=this.refHtml;var s=apf.layout.vars;var A=this.oItem;var F=false;var E=n?n[G.offsetPos]:s[G.pos+"_"+A.id];var k=n?n[G.offsetSize]:s[G.size+"_"+A.id];var g=A.parent.children;for(var q=0,C=0;C<g.length;C++){if(!g[C][G.fsize]){q++;}}if(!A[G.fsize]&&q>1){for(var d=0,c=0,C=A.stackId+1;C<g.length;C++){if(!g[C][G.fsize]){d+=g[C].weight||1;c+=(g[C].node?g[C].oHtml[G.offsetSize]:s[G.size+"_"+g[C].id]);}}var t=this.$ext[G.offsetPos]-E-k;var D=(c-t)/d;for(var C=0;C<A.stackId;C++){if(!g[C][G.fsize]){g[C].original.weight=(g[C].node?g[C].oHtml[G.offsetSize]:s[G.size+"_"+g[C].id])/D;}}A.original.weight=(k+t)/D;F=true;}else{var u=A[G.fsize]?A[G.fsize].match(/^\d+$/):false;var I=A[G.fsize]?A[G.fsize].match(/^([\d\.]+)\%$/):false;if(u||I||!A[G.fsize]){var t=this.$ext[G.offsetPos]-E-k;var B=this.$ext[G.offsetPos]-E;for(var J=0,w=0,C=A.stackId+1;C<g.length;C++){if(!g[C][G.fsize]){J+=g[C].weight||1;w+=(g[C].node?g[C].oHtml[G.offsetSize]:s[G.size+"_"+g[C].id]);}}if(J>0){var j=((w-t)/J)/(w/J);for(var C=A.stackId+1;C<g.length;C++){g[C].original.weight=j*(g[C].weight||1);}}else{for(var C=A.stackId+1;C<g.length;C++){if(g[C][G.fsize].match(/^\d+$/)){var H=(g[C].node?g[C].oHtml[G.offsetSize]:s[G.size+"_"+g[C].id])-t;g[C].original[G.fsize]=""+Math.max(0,H,g[C].minheight||0);if(g[C][G.fsize]-H!=0){t=g[C][G.fsize]-H;}else{break;}}else{if(g[C][G.fsize].match(/^([\d\.]+)\%$/)){var H=(g[C].node?g[C].oHtml[G.offsetSize]:s[G.size+"_"+g[C].id])-t;g[C].original[G.fsize]=Math.max(0,((parseFloat(RegExp.$1)/(g[C].node?g[C].oHtml[G.offsetSize]:s[G.size+"_"+g[C].id]))*H))+"%";break;}}}}if(A.original[G.fsize]){A.original[G.fsize]=I?((parseFloat(I[1])/k)*B)+"%":""+B;}F=true;}}if(F){apf.layout.compile(this.$ext.parentNode);apf.layout.activateRules(this.$ext.parentNode);if(apf.hasSingleRszEvent){apf.layout.forceResize();}return;}apf.layout.forceResize(this.$ext.parentNode);};this.init=function(B,t,C){this.min=0;this.max=1000000;this.size=parseInt(B)||3;this.refNode=null;this.refHtml=null;var g;if(t){if(typeof t!="object"){t=apf.lookup(t);}this.refNode=t;this.refHtml=this.refNode.$ext;g=this.refHtml.parentNode;C=t.aData.calcData;}else{g=C.pHtml;}this.oItem=C;if(g&&g!=this.$ext.parentNode){g.appendChild(this.$ext);}var A=apf.getDiff(this.$ext);this.$verdiff=A[0];this.$hordiff=A[1];this.$sizeArr=[];this.type=C.parent.vbox?"horizontal":"vertical";var G=apf.layout.get(this.$ext.parentNode).layout;var H="splitter"+this.$uniqueId;G.addRule("var "+H+" = apf.lookup("+this.$uniqueId+").$ext");var c=[H+".style.left = "];var k=[H+".style.top = "];var n=[H+".style.width = -"+this.$hordiff+" + "];var w=[H+".style.height = -"+this.$verdiff+" + "];var u=C.parent.children[C.stackId+1];if(this.type=="horizontal"){n.push("Math.max(");if(C.node){c.push(C.id+".offsetLeft");k.push(C.id+".offsetTop + "+C.id+".offsetHeight");n.push(C.id+".offsetWidth");}else{c.push("v.left_"+C.id);k.push("v.top_"+C.id+" + v.height_"+C.id);n.push("v.width_"+C.id);}n.push(",",u?(u.node?u.id+".offsetWidth":"v.width_"+u.id):0,")");G.addRule(n.join(""));this.$ext.style.height=(C.splitter-this.$hordiff)+"px";}else{w.push("Math.max(");if(C.node){c.push(C.id+".offsetLeft + "+C.id+".offsetWidth");k.push(C.id+".offsetTop");w.push(C.id+".offsetHeight");}else{c.push("v.left_"+C.id+" + v.width_"+C.id);k.push("v.top_"+C.id);w.push("v.height_"+C.id);}w.push(",",u?(u.node?u.id+".offsetHeight":"v.height_"+u.id):0,")");G.addRule(w.join(""));this.$ext.style.width=(C.splitter-this.$hordiff)+"px";}G.addRule(c.join(""));G.addRule(k.join(""));var q=C.parent.children;if(this.type=="vertical"){G.addRule(H+".host.min = "+(C.node?"document.getElementById('"+C.id+"').offsetLeft":"v.left_"+C.id)+" + "+parseInt(C.minwidth||C.childminwidth||10));var D=[],j=[];for(var s=false,E=C.stackId+1;E<q.length;E++){if(!q[E].fwidth){s=true;}}for(var F,E=C.stackId+1;E<q.length;E++){F=q[E];if(F.minwidth||F.childminheight){D.push(parseInt(F.minwidth||F.childminheight));}else{if(F.fwidth){if(!s&&E==C.stackId+1){D.push(10);}else{if(F.fwidth.indexOf("%")!=-1){D.push("("+F.parent.innerspace+") * "+(parseFloat(F.fwidth)/100));}else{D.push(F.fwidth);}}}else{D.push(10);}}D.push(F.edgeMargin);}G.addRule(H+".host.max = v.left_"+C.parent.id+" + v.width_"+C.parent.id+" - ("+(D.join("+")||0)+")");}else{G.addRule(H+".host.min = "+(C.node?"document.getElementById('"+C.id+"').offsetTop":"v.top_"+C.id)+" + "+parseInt(C.minheight||C.childminheight||10));var D=[],j=[];for(var s=false,E=C.stackId+1;E<q.length;E++){if(!q[E].fheight){s=true;}}if(!s&&u&&u.state>0){return this.$ext.parentNode.removeChild(this.$ext);}for(var F,E=C.stackId+1;E<q.length;E++){F=q[E];if(F.minheight||F.childminheight){D.push(parseInt(F.minheight||F.childminheight));}else{if(F.fheight){if(!s&&E==C.stackId+1){D.push(10);}else{if(F.fheight.indexOf("%")!=-1){D.push("("+F.parent.innerspace+") * "+(parseFloat(F.fheight)/100));}else{D.push(F.fheight);}}}else{D.push(10);}}if(F.edgeMargin){D.push(F.edgeMargin);}}G.addRule(H+".host.max = v.top_"+C.parent.id+" + v.height_"+C.parent.id+" - ("+(D.join("+")||0)+")");}this.$setStyleClass(this.$ext,this.type,[this.type=="horizontal"?"vertical":"horizontal"]);if(this.type=="vertical"){this.$setStyleClass(this.$ext,"w-resize",["n-resize"]);}else{this.$setStyleClass(this.$ext,"n-resize",["w-resize"]);}return this;};this.$draw=function(){this.$ext=this.$getExternal();var c=this;this.$ext.onmousedown=function(g){if(!g){g=event;}var d=c;var i=apf.getAbsolutePosition(this);if(d.type=="vertical"){d.tx=g.clientX-i[0];}else{d.ty=g.clientY-i[1];}d.startPos=d.type=="vertical"?this.offsetLeft:this.offsetTop;g.returnValue=false;g.cancelBubble=true;apf.plane.show(this);d.$setStyleClass(this,"moving");d.$setStyleClass(document.body,d.type=="vertical"?"w-resize":"n-resize",[d.type=="vertical"?"n-resize":"w-resize"]);document.onmouseup=function(){d.$setStyleClass(d.$ext,"",["moving"]);apf.plane.hide();d.update();d.$setStyleClass(document.body,"",["n-resize","w-resize"]);document.onmouseup=document.onmousemove=null;};document.onmousemove=function(j){if(!j){j=event;}if(d.type=="vertical"){if(j.clientX>=0){var k=apf.getAbsolutePosition(d.$ext.offsetParent);d.$ext.style.left=(Math.min(d.max,Math.max(d.min,(j.clientX-k[0])-d.tx)))+"px";}}else{if(j.clientY>=0){var k=apf.getAbsolutePosition(d.$ext.offsetParent);d.$ext.style.top=(Math.min(d.max,Math.max(d.min,(j.clientY-k[1])-d.ty)))+"px";}}j.returnValue=false;j.cancelBubble=true;};};};this.$loadAml=function(d){if(this.left||this.top){var k=this.left||this.top;var j=this.right||this.bottom;k=k.split(/\s*,\s*/);j=j.split(/\s*,\s*/);for(var g=0;g<k.length;g++){k[g]=k[g];}for(var g=0;g<j.length;g++){j[g]=j[g];}var c=this;$setTimeout(function(){this.$amlNode.init(c.type,c.size,c.min,c.max,c.change,k,j);});}};}).call(apf.splitter.prototype=new apf.Presentation());apf.aml.setElement("splitter",apf.splitter);apf.comment=function(){this.$init("comment",apf.NODE_HIDDEN);};apf.comment.prototype=new apf.AmlComment();apf.aml.setElement("comment",apf.comment);apf.dropdown=function(d,c){this.$init(c||"dropdown",apf.NODE_VISIBLE,d);};(function(){this.$animType=1;this.$animSteps=5;this.$animSpeed=20;this.$itemSelectEvent="onmouseup";this.dragdrop=false;this.reselectable=true;this.$focussable=true;this.autoselect=false;this.multiselect=false;this.disableremove=true;this.delayedselect=false;this.maxitems=5;this.$booleanProperties.disableremove=true;this.$supportedProperties.push("maxitems","disableremove","initial-message","fill");this.$propHandlers.maxitems=function(d){this.sliderHeight=d?(Math.min(this.maxitems||100,d)*this.itemHeight):10;this.containerHeight=d?(Math.min(this.maxitems||100,d)*this.itemHeight):10;};this.slideToggle=function(d,g){if(!d){d=event;}if(g&&this.disabled){return;}if(this.isOpen){this.slideUp();}else{this.slideDown(d);}};this.slideDown=function(g){if(this.dispatchEvent("slidedown")===false){return false;}this.isOpen=true;this.$propHandlers.maxitems.call(this,this.xmlRoot&&this.each?this.getTraverseNodes().length:this.childNodes.length);this.oSlider.style.display="block";if(!this.ignoreOverflow){this.oSlider.style[apf.supportOverflowComponent?"overflowY":"overflow"]="visible";this.$container.style.overflowY="hidden";}this.oSlider.style.display="";this.$setStyleClass(this.$ext,this.$baseCSSname+"Down");this.oSlider.style.height=(this.sliderHeight-1)+"px";this.oSlider.style.width=(this.$ext.offsetWidth-2-this.widthdiff)+"px";var d=this;apf.popup.show(this.$uniqueId,{x:0,y:this.$ext.offsetHeight,animate:true,ref:this.$ext,width:this.$ext.offsetWidth-this.widthdiff,height:this.containerHeight,callback:function(i){if(!d.ignoreOverflow){d.$container.style.overflowY="auto";}}});};this.slideUp=function(){if(this.isOpen==2){return false;}if(this.dispatchEvent("slideup")===false){return false;}this.isOpen=false;if(this.selected){var d=apf.xmldb.findHtmlNode(this.selected,this);if(d){this.$setStyleClass(d,"",["hover"]);}}this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Down"]);apf.popup.hide();return false;};this.$setLabel=function(d){this.oLabel.innerHTML=d||this["initial-message"]||"";this.$setStyleClass(this.$ext,d?"":this.$baseCSSname+"Initial",!d?[]:[this.$baseCSSname+"Initial"]);};this.addEventListener("afterselect",function(d){if(!d){d=event;}this.slideUp();if(!this.isOpen){this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Over"]);}this.$setLabel(d.selection.length?this.$applyBindRule("caption",this.selected):"");});function c(){if(this.isOpen==2){this.slideDown();}}this.addEventListener("afterload",c);this.addEventListener("xmlupdate",function(){c.call(this);this.$setLabel(this.$applyBindRule("caption",this.selected));});this.$blur=function(){this.slideUp();if(!this.isOpen){this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Over"]);}this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Focus"]);};this.$setClearMessage=function(d){this.$setLabel(d);};this.$removeClearMessage=function(){this.$setLabel("");};this.addEventListener("popuphide",this.slideUp);this.addEventListener("keydown",function(q){var k=q.keyCode;if(!this.xmlRoot){return;}var n;switch(k){case 38:if(q.altKey){this.slideToggle(q.htmlEvent);return;}if(!this.selected){return;}n=this.getNextTraverseSelected(this.caret||this.selected,false);if(n){this.select(n);}break;case 40:if(q.altKey){this.slideToggle(q.htmlEvent);return;}if(!this.selected){n=this.getFirstTraverseNode();if(!n){return;}}else{n=this.getNextTraverseSelected(this.selected,true);}if(n){this.select(n);}break;default:if(k==9||!this.xmlRoot){return;}if(!this.lookup||new Date().getTime()-this.lookup.date.getTime()>1000){this.lookup={str:"",date:new Date()};}this.lookup.str+=String.fromCharCode(k);var g,d=this.getTraverseNodes();for(var j=0;j<d.length;j++){g=this.$applyBindRule("caption",d[j]);if(g&&g.indexOf(this.lookup.str)>-1){this.select(d[j]);return;}}return;}return false;},true);this.$draw=function(){this.$getNewContext("main");this.$getNewContext("container");this.$animType=this.$getOption("main","animtype")||1;this.clickOpen=this.$getOption("main","clickopen")||"button";this.$ext=this.$getExternal(null,null,function(g){g.setAttribute("onmouseover","var o = apf.lookup("+this.$uniqueId+');o.$setStyleClass(o.$ext, o.$baseCSSname + "Over", null, true);');g.setAttribute("onmouseout","var o = apf.lookup("+this.$uniqueId+');if(o.isOpen) return;o.$setStyleClass(o.$ext, "", [o.$baseCSSname + "Over"], true);');var d=this.$getLayoutNode("main","button",g);if(d){d.setAttribute("onmousedown","apf.lookup("+this.$uniqueId+").slideToggle(event, true);");}var i=this.$getLayoutNode("main","label",g);if(this.clickOpen=="both"){i.parentNode.setAttribute("onmousedown","apf.lookup("+this.$uniqueId+").slideToggle(event, true);");}});this.oLabel=this.$getLayoutNode("main","label",this.$ext);if(this.oLabel.nodeType==3){this.oLabel=this.oLabel.parentNode;}this.oIcon=this.$getLayoutNode("main","icon",this.$ext);if(this.$button){this.$button=this.$getLayoutNode("main","button",this.$ext);}this.oSlider=apf.insertHtmlNode(this.$getLayoutNode("container"),document.body);this.$container=this.$getLayoutNode("container","contents",this.oSlider);this.$container.host=this;this.$pHtmlDoc=apf.popup.setContent(this.$uniqueId,this.oSlider,apf.skins.getCssString(this.skinName));this.listtype=parseInt(this.$getLayoutNode("main","type"))||1;this.itemHeight=this.$getOption("main","item-height")||18.5;this.widthdiff=this.$getOption("main","width-diff")||0;this.ignoreOverflow=apf.isTrue(this.$getOption("main","ignore-overflow"))||false;};this.addEventListener("DOMNodeInsertedIntoDocument",function(){if(typeof this["initial-message"]=="undefined"){this.$setInheritedAttribute("initial-message");}if(!this.selected&&this["initial-message"]){this.$setLabel();}});this.$destroy=function(){apf.popup.removeContent(this.$uniqueId);apf.destroyHtmlNode(this.oSlider);this.oSlider=null;};}).call(apf.dropdown.prototype=new apf.BaseList());apf.config.$inheritProperties["initial-message"]=1;apf.aml.setElement("dropdown",apf.dropdown);apf.contextmenu=function(){this.$init("contextmenu",apf.NODE_HIDDEN);};(function(){this.$amlNodes=[];this.$attrExcludePropBind=apf.extend({match:1},this.$attrExcludePropBind);this.register=function(c){if(!c.contextmenus){c.contextmenus=[];}c.contextmenus.push(this);};this.unregister=function(c){c.contextmenus.remove(this);};this.addEventListener("DOMNodeInsertedIntoDocument",function(c){this.register(this.parentNode);});}).call(apf.contextmenu.prototype=new apf.AmlElement());apf.aml.setElement("contextmenu",apf.contextmenu);apf.menu=function(d,c){this.$init(c||"menu",apf.NODE_VISIBLE,d);};(function(){this.$focussable=apf.KEYBOARD;this.$positioning="basic";this.anim=true;this.zindex=10000000;this.visible=false;this.$booleanProperties.anim=true;this.$propHandlers.visible=function(n,s,k,j,g){if(n){this.$ext.style.display="block";if(this.opener&&this.opener.localName.indexOf("item")>-1){this.opener.parentNode.$showingSubMenu=this;}}else{this.$ext.style.display="none";var q=apf.menu.lastFocus;if(q!=this.opener&&this.opener&&this.opener.$blur){this.opener.$blur();}if(this.opener&&this.opener.parentNode.localName=="menu"){if(!this.$hideTree){this.$hideTree=-1;}this.opener.parentNode.focus();}else{if(q){if(apf.window.$settingFocus){if(apf.window.$settingFocus!=q&&q.$blur){q.$blur();}this.$blur();if(apf.window.$settingFocus.localName!="menu"){apf.menu.lastFocus=null;}}else{if(!apf.window.hasFocus()){if(q.$blur){q.$blur();}this.$blur();apf.document.activeElement=q;if(q.$focusParent){q.$focusParent.$lastFocussed=q;}apf.menu.lastFocus=null;}else{if(this.$hideTree){if(!this.$hideTree){this.$hideTree=-1;}var i=(q.disabled||!q.visible)&&q!=apf.document.documentElement;if(j||i){if(q.$blur){q.$blur();}this.$blur();apf.document.activeElement=null;if(i&&apf.window.moveNext()===false){apf.window.$focusRoot();}}else{q.focus(null,null,true);}apf.menu.lastFocus=null;}}}}}if(this.$showingSubMenu){this.$showingSubMenu.hide();this.$showingSubMenu=null;}if(this.opener&&this.opener.$submenu){this.opener.$submenu(true,true);if(this.$hideTree===true&&this.opener.parentNode.localName=="menu"){this.opener.parentNode.$hideTree=true;this.opener.parentNode.hide();}this.opener=null;}this.$hideTree=null;if(this.$selected){apf.setStyleClass(this.$selected.$ext,"",["hover"]);this.$selected=null;}}};var d;this.display=function(A,u,q,w,E,s,C){this.opener=w;this.dispatchEvent("display");if(E){var D,n,j,g=this.childNodes,t=0,k=g.length,G;for(n=0;n<k;n++){j=g[n];if(j.nodeType!=1){continue;}G=!E||!j.match||(j.cmatch||(j.cmatch=apf.lm.compile(j.match,{xpathmode:3,injectself:true})))(E);if(G){j.show();if(j.localName=="divider"){D=j;if(t==0){j.hide();}t=0;}else{t++;}}else{j.hide();if(!j.nextSibling&&t==0){D.hide();}}}}if(this.oOverlay){if(C){this.oOverlay.style.display="block";this.oOverlay.style.width=C+"px";}else{this.oOverlay.style.display="none";}}this.visible=false;this.show();if(A===null){apf.popup.show(this.$uniqueId,{x:0,y:w.$ext.offsetHeight,animate:q||!this.anim?false:"fade",ref:w.$ext,allowTogether:s});}else{var B=apf.getAbsolutePosition(document.body);apf.popup.show(this.$uniqueId,{x:A-B[0],y:u-B[1]-(apf.isIE&&apf.isIE<8?1:0),animate:q||!this.anim?false:"fade",ref:this.$ext.offsetParent,allowTogether:s,autoCorrect:false});}var F=apf.menu.lastFocus=w&&w.$focussable===true?w:apf.menu.lastFocus||apf.document.activeElement;apf.popup.last=null;this.focus();if(F&&F!=this&&F.$focus){F.$focus();}this.xmlReference=E;};this.getValue=function(g){return this.getSelected(g).value||"";};this.getSelected=function(n){var j=this.childNodes;var k,g=j.length;for(k=0;k<g;k++){if(j[k].group!=n){continue;}if(j[k].selected){return j[k];}}return false;};this.select=function(q,n){var j=this.childNodes;var k,g=j.length;for(k=0;k<g;k++){if(j[k].group!=q){continue;}if(j[k].value==n||!j[k].value&&j[k].caption==n){j[k].$handlePropSet("selected",true);}else{if(j[k].selected){j[k].$handlePropSet("selected",false);}}}};this.addEventListener("keydown",function(k){var j,g=k.keyCode;switch(g){case 13:if(!this.$selected){return;}j=this.$selected;j.$down();j.$up();j.$click();break;case 38:j=this.$selected&&this.$selected.previousSibling||this.lastChild;if(j&&j.localName=="divider"){j=j.previousSibling;}if(!j){return;}if(this.$selected){apf.setStyleClass(this.$selected.$ext,"",["hover"]);}apf.setStyleClass(j.$ext,"hover");this.$selected=j;break;case 40:j=this.$selected&&this.$selected.nextSibling||this.firstChild;if(j&&j.localName=="divider"){j=j.nextSibling;}if(!j){return;}if(this.$selected){apf.setStyleClass(this.$selected.$ext,"",["hover"]);}apf.setStyleClass(j.$ext,"hover");this.$selected=j;break;case 37:if(!this.opener){return;}if(this.opener.localName=="button"){j=this.opener.previousSibling;while(j&&!j.submenu){j=j.previousSibling;}if(j){j.dispatchEvent("mouseover");var i=j.parentNode.menuIsPressed;if(i){self[i.submenu].dispatchEvent("keydown",{keyCode:40});}}}else{if(this.opener.parentNode.localName=="menu"){var n=this.opener;this.hide();apf.setStyleClass(n.$ext,"hover");n.parentNode.$showingSubMenu=null;}}break;case 39:if(this.$selected&&this.$selected.submenu){this.$selected.$submenu(null,true);this.$showingSubMenu.dispatchEvent("keydown",{keyCode:40});return;}if(this.opener){var n=this.opener;while(n&&n.parentNode&&n.parentNode.localName=="menu"){n=n.parentNode.opener;}if(n&&n.localName=="button"){j=n.nextSibling;while(j&&!j.submenu){j=j.nextSibling;}if(j){j.dispatchEvent("mouseover");var i=j.parentNode.menuIsPressed;if(i){self[i.submenu].dispatchEvent("keydown",{keyCode:40});}return;}}}if(!this.$selected){arguments.callee.call(this,{keyCode:40});}break;default:return;}return false;},true);function c(){if(this.$showingSubMenu){return;}if(this.$hideTree!=-1){this.$hideTree=true;this.hide();}return false;}this.addEventListener("focus",function(){apf.popup.last=this.$uniqueId;});this.addEventListener("blur",c);this.addEventListener("popuphide",c);this.$draw=function(){this.$pHtmlNode=document.body;this.$ext=this.$getExternal();this.oOverlay=this.$getLayoutNode("main","overlay",this.$ext);apf.popup.setContent(this.$uniqueId,this.$ext,"",null,null);};this.$loadAml=function(g){this.$int=this.$getLayoutNode("main","container",this.$ext);};this.$destroy=function(){apf.popup.removeContent(this.$uniqueId);};}).call(apf.menu.prototype=new apf.Presentation());apf.aml.setElement("menu",apf.menu);apf.input=function(d,c){this.$init(c||"input",apf.NODE_VISIBLE,d);};apf.secret=function(d,c){this.$init(c||"secret",apf.NODE_VISIBLE,d);};apf.password=function(d,c){this.$init(c||"password",apf.NODE_VISIBLE,d);};apf.textarea=function(d,c){this.$init(c||"textarea",apf.NODE_VISIBLE,d);this.multiline=true;};apf.email=function(d,c){this.$init(c||"email",apf.NODE_VISIBLE,d);};apf.textbox=function(d,c){this.$init(c||"textbox",apf.NODE_VISIBLE,d);};(function(){this.implement(apf.DataAction);this.$focussable=true;this.$masking=false;this.$childProperty="value";this.value="";this.isContentEditable=true;this.multiline=false;this.$booleanProperties.focusselect=true;this.$booleanProperties.realtime=true;this.$supportedProperties.push("value","mask","initial-message","focusselect","realtime","type");this.$propHandlers.value=function(g,i,d){if(!this.$input||!d&&this.getValue()==g){return;}if(!d&&!g){this.clear();}else{if(this.isHTMLBox){if(this.$input.innerHTML!=g){this.$input.innerHTML=g;}}else{if(this.$input.value!=g){this.$input.value=g;}}}if(this.$button){this.$button.style.display=g&&!d?"block":"none";}};this.addEventListener("prop.maxlength",function(d){if(this.$input.tagName.toLowerCase().match(/input|textarea/)){this.$input.maxLength=parseInt(d.value)||null;}});this.$propHandlers.mask=function(d){if(this.mask.toLowerCase()=="password"){return;}if(!d){throw new Error("Not Implemented");}if(!this.$masking){this.$masking=true;this.implement(apf.textbox.masking);this.focusselect=false;}this.setMask(this.mask);};this.$propHandlers["initial-message"]=function(d){if(d){if(apf.hasFocusBug){this.$input.onblur();}}if(!this.value){this.clear();}};this.$propHandlers.focusselect=function(g){var d=this;this.$input.onmousedown=function(){d.focusselect=false;};this.$input.onmouseup=this.$input.onmouseout=function(){d.focusselect=g;};};this.$propHandlers.type=function(d){if(d&&"password|username".indexOf(d)>-1&&typeof this.focusselect=="undefined"){this.focusselect=true;this.$propHandlers.focusselect.call(this,true);}};this.setValue=function(d){return this.setProperty("value",d,false,true);};this.clear=function(){if(this["initial-message"]){this.$propHandlers.value.call(this,this["initial-message"],null,true);apf.setStyleClass(this.$ext,this.$baseCSSname+"Initial");}else{this.$propHandlers.value.call(this,"",null,true);}this.dispatchEvent("clear");};this.getValue=function(){var d=this.isHTMLBox?this.$input.innerHTML:this.$input.value;return d==this["initial-message"]?"":d.replace(/\r/g,"");};this.select=function(){try{this.$input.select();}catch(d){}};this.deselect=function(){this.$input.deselect();};this.$enable=function(){this.$input.disabled=false;};this.$disable=function(){this.$input.disabled=true;};this.$insertData=function(d){return this.setValue(d);};this.insert=function(i){if(apf.hasMsRangeObject){try{this.$input.focus();}catch(g){}var d=document.selection.createRange();if(this.oninsert){i=this.oninsert(i);}d.pasteHTML(i);d.collapse(true);d.select();}else{this.$input.value+=i;}};this.addEventListener("$clear",function(){this.value="";if(this["initial-message"]&&apf.document.activeElement!=this){this.$propHandlers.value.call(this,this["initial-message"],null,true);apf.setStyleClass(this.$ext,this.$baseCSSname+"Initial");}else{this.$propHandlers.value.call(this,"");}if(!this.$input.tagName.toLowerCase().match(/input|textarea/i)){if(apf.hasMsRangeObject){try{var d=document.selection.createRange();d.moveStart("sentence",-1);d.select();}catch(g){}}}this.dispatchEvent("clear");});this.$keyHandler=function(g,k,d,i,j){if(this.$button&&g==27){this.clear();this.blur();}};var c;this.$focus=function(i){if(!this.$ext||this.$ext.disabled){return;}this.$setStyleClass(this.$ext,this.$baseCSSname+"Focus");if(this["initial-message"]&&this.$input.value==this["initial-message"]){this.$propHandlers.value.call(this,"",null,true);apf.setStyleClass(this.$ext,"",[this.$baseCSSname+"Initial"]);}var d=this;function g(){try{if(!c||document.activeElement!=d.$input){d.$input.focus();}else{clearInterval(c);return;}}catch(j){}if(d.$masking){d.setPosition();}if(d.focusselect){d.select();}}if((!i||i.mouse)&&apf.isIE){clearInterval(c);c=setInterval(g,1);}else{g();}};this.$blur=function(d){if(!this.$ext){return;}if(!this.realtime){this.change(this.getValue());}this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Focus"]);if(this["initial-message"]&&this.$input.value==""){this.$propHandlers.value.call(this,this["initial-message"],null,true);apf.setStyleClass(this.$ext,this.$baseCSSname+"Initial");}try{if(apf.isIE||!d||d.srcElement!=apf.window){this.$input.blur();}}catch(d){}if(this.oContainer){$setTimeout("var o = apf.lookup("+this.$uniqueId+");                o.oContainer.style.display = 'none'",100);}clearInterval(c);};this.$draw=function(){var d=this;this.$ext=this.$getExternal(null,null,function(j){var i=this.getAttribute("mask");if((typeof i=="string"&&i.toLowerCase()=="password")||"secret|password".indexOf(this.localName)>-1){this.type=="password";this.$getLayoutNode("main","input").setAttribute("type","password");}j.setAttribute("onmousedown","if (!this.host.disabled)                 this.host.dispatchEvent('mousedown', {htmlEvent : event});");j.setAttribute("onmouseup","if (!this.host.disabled)                 this.host.dispatchEvent('mouseup', {htmlEvent : event});");j.setAttribute("onclick","if (!this.host.disabled)                 this.host.dispatchEvent('click', {htmlEvent : event});");});this.$input=this.$getLayoutNode("main","input",this.$ext);this.$button=this.$getLayoutNode("main","button",this.$ext);if(this.type=="password"){this.$propHandlers.type.call(this,"password");}if(!apf.hasContentEditable&&"input|textarea".indexOf(this.$input.tagName.toLowerCase())==-1){var g=this.$input;this.$input=g.parentNode.insertBefore(document.createElement("textarea"),g);g.parentNode.removeChild(g);this.$input.className=g.className;if(this.$ext==g){this.$ext=this.$input;}}if(this.$button){this.$button.onmousedown=function(){d.clear();d.focus({mouse:true});};}if(this.$input.tagName.toLowerCase()=="textarea"){this.addEventListener("focus",function(i){});}this.$input.onselectstart=function(i){if(!i){i=event;}i.cancelBubble=true;};this.$input.host=this;this.$input.onkeydown=function(n){n=n||window.event;if(this.host.disabled){n.returnValue=false;return false;}if(!d.realtime){var j=d.getValue();if(n.keyCode==13&&j!=this.value){d.change(j);}}else{if(apf.isWebkit&&d.xmlRoot&&d.getValue()!=this.value){$setTimeout("var o = apf.lookup("+d.$uniqueId+");                    o.change(o.getValue())");}}if(d.multiline=="optional"&&n.keyCode==13&&!n.shiftKey||n.ctrlKey&&(n.keyCode==66||n.keyCode==73||n.keyCode==85)){n.returnValue=false;return false;}if(d.oContainer){var i=d;var k=n.keyCode;$setTimeout(function(){i.fillAutocomplete(k);});}if(!d.mask){return d.$keyHandler(n.keyCode,n.ctrlKey,n.shiftKey,n.altKey,n);}};this.$input.onkeyup=function(j){if(!j){j=event;}if(this.host.disabled){return false;}var i=j.keyCode;if(d.$button){d.$button.style.display=this.value?"block":"none";}if(d.realtime){$setTimeout(function(){var k;if(!d.mask&&(k=d.getValue())!=d.value){d.change(k);}d.dispatchEvent("keyup",{keyCode:i});});}else{d.dispatchEvent("keyup",{keyCode:i});}if(d.isValid&&d.isValid()&&j.keyCode!=13&&j.keyCode!=17){d.clearError();}};if(apf.hasFocusBug){apf.sanitizeTextbox(this.$input);}if(apf.hasAutocompleteXulBug){this.$input.setAttribute("autocomplete","off");}if(!this.$input.tagName.toLowerCase().match(/input|textarea/)){this.isHTMLBox=true;this.$input.unselectable="Off";this.$input.contentEditable=true;this.$input.style.width="1px";this.$input.select=function(){var i=document.selection.createRange();i.moveToElementText(this);i.select();};}this.$input.deselect=function(){if(!document.selection){return;}var i=document.selection.createRange();i.collapse();i.select();};};this.$loadAml=function(){if(typeof this["initial-message"]=="undefined"){this.$setInheritedAttribute("initial-message");}if(typeof this.realtime=="undefined"){this.$setInheritedAttribute("realtime");}};this.addEventListener("DOMNodeRemovedFromDocument",function(){if(this.$button){this.$button.onmousedown=null;}if(this.$input){this.$input.onkeypress=this.$input.onmouseup=this.$input.onmouseout=this.$input.onmousedown=this.$input.onkeydown=this.$input.onkeyup=this.$input.onselectstart=null;}});}).call(apf.textbox.prototype=new apf.StandardBinding());apf.config.$inheritProperties["initial-message"]=1;apf.config.$inheritProperties.realtime=1;apf.input.prototype=apf.secret.prototype=apf.password.prototype=apf.textarea.prototype=apf.email.prototype=apf.textbox.prototype;apf.aml.setElement("input",apf.input);apf.aml.setElement("secret",apf.secret);apf.aml.setElement("password",apf.password);apf.aml.setElement("textarea",apf.textarea);apf.aml.setElement("textbox",apf.textbox);apf.script=function(){this.$init("script",apf.NODE_HIDDEN);};(function(){this.$propHandlers.src=function(c){if(apf.isOpera){$setTimeout(function(){apf.window.loadCodeFile(apf.hostPath+c);},1000);}else{apf.window.loadCodeFile(apf.getAbsolutePath(apf.hostPath,c));}};this.addEventListener("DOMNodeInserted",function(g){if(g.currentTarget.nodeType==3||g.currentTarget.nodeType==4){var d=g.currentTarget.nodeValue;if(!this.type||this.type=="text/javascript"){apf.jsexec(d);}else{if(this.type=="application/livemarkup"||this.type=="application/lm"){var c=apf.lm.compile(d,{event:true,parsecode:true,funcglobal:true});c(window.event);}}}});this.addEventListener("DOMNodeInsertedIntoDocument",function(q){var d=this.childNodes,j=[];for(var g=0,c=d.length;g<c;g++){j[j.length]=d[g].nodeValue;}var n=j.join("\n");if(!this.type||this.type=="text/javascript"){apf.jsexec(n);}else{if(this.type=="application/livemarkup"||this.type=="application/lm"){var k=apf.lm.compile(n,{event:true,parsecode:true,funcglobal:true});k(window.event);}}});}).call(apf.script.prototype=new apf.AmlElement());apf.aml.setElement("script",apf.script);apf.tree=function(d,c){this.$init(c||"tree",apf.NODE_VISIBLE,d);};(function(){var c=1<<1,g=1<<2,j=1<<3,k=1<<4,d=this.$treeState;this.$mode=0;this.$propHandlers.mode=function(n){if("check|radio".indexOf(n)>-1){this.implement(apf.MultiCheck);this.addEventListener("afterrename",i);this.multicheck=n=="check";this.$mode=this.multicheck?1:2;}else{this.removeEventListener("afterrename",i);this.$mode=0;}};function i(){}this.$initNode=function(I,s,E){this.$getNewContext("item");var A=s&c||this.emptyMessage&&this.$applyBindRule("empty",I),D=this.$getLayoutNode("item");D.setAttribute("onmouseover","var o = apf.lookup("+this.$uniqueId+");            o.$setStyleClass(this, 'hover', null, true);");D.setAttribute("onmouseout","var o = apf.lookup("+this.$uniqueId+");            o.$setStyleClass(this, '', ['hover'], true);");this.$setStyleClass(this.$getLayoutNode("item","class"),d[s]).setAttribute(apf.xmldb.htmlIdTag,E);this.$setStyleClass(this.$getLayoutNode("item","container"),d[s]);var w=this.$getLayoutNode("item","openclose");if(w){w.setAttribute("children",A);w.setAttribute("onmousedown","if (this.getAttribute('children') == false) return;                var o = apf.lookup("+this.$uniqueId+");                o.slideToggle(this, null, null, true);                apf.cancelBubble(event, o);");w.setAttribute("ondblclick","event.cancelBubble = true");}var t=this.opencloseaction||"ondblclick";var F=this.$getLayoutNode("item","icon");if(F&&F!=w){if(t!="ondblclick"){F.setAttribute(t,"var o = apf.lookup("+this.$uniqueId+");"+(t=="onmousedown"?"o.select(this, event.ctrlKey, event.shiftKey, -1);":"")+(true?"o.slideToggle(this, null, null, true);":""));}if(t!="onmousedown"){F.setAttribute("onmousedown","apf.lookup("+this.$uniqueId+").select(this, event.ctrlKey, event.shiftKey, -1);");}F.setAttribute("ondblclick","var o = apf.lookup("+this.$uniqueId+");              o.choose();o.stopRename();"+(true&&!t=="ondblclick"?"o.slideToggle(this, null, null, true);":"")+"apf.cancelBubble(event,o);");}var u=this.$getLayoutNode("item","select"),H;if(this.hasFeature(apf.__RENAME__)||this.hasFeature(apf.__DRAGDROP__)){H="var o = apf.lookup("+this.$uniqueId+");                 var xmlNode = apf.xmldb.findXmlNode(this);                 var isSelected = o.isSelected(xmlNode);                 this.hasPassedDown = true;                 if (!o.renaming && o.hasFocus() && isSelected == 1)                     this.dorename = true;                 if (!o.hasFeature(apf.__DRAGDROP__) || !isSelected && !event.ctrlKey)                     o.select(this, event.ctrlKey, event.shiftKey, -1);";u.setAttribute("onmouseout","this.hasPassedDown = false;"+(u.getAttribute("onmouseout")||""));u.setAttribute("onmouseup","if (!this.hasPassedDown) return;                var o = apf.lookup("+this.$uniqueId+");if (this.dorename && !o.mode)                    o.startDelayedRename(event, null, true);this.dorename = false;                 var xmlNode = apf.xmldb.findXmlNode(this);                 var isSelected = o.isSelected(xmlNode);                 if (o.hasFeature(apf.__DRAGDROP__))                     o.select(this, event.ctrlKey, event.shiftKey, -1);");}else{H="o.select(this, event.ctrlKey, event.shiftKey, -1);";}if(t!="ondblclick"){u.setAttribute(t,"var o = apf.lookup("+this.$uniqueId+");"+(t=="onmousedown"?H:"")+(true?"o.slideToggle(this, null, null, true);":""));}if(t!="onmousedown"){u.setAttribute("onmousedown","var o = apf.lookup("+this.$uniqueId+");"+H);}u.setAttribute("ondblclick","var o = apf.lookup("+this.$uniqueId+");          o.choose();o.stopRename();this.dorename=false;"+(t=="ondblclick"?"o.slideToggle(this, null, null, true);":"")+"apf.cancelBubble(event,o);");if(F){var C=this.$applyBindRule("icon",I);if(C){if(F.tagName.match(/^img$/i)){F.setAttribute("src",apf.getAbsolutePath(this.iconPath,C));}else{F.setAttribute("style","background-image:url("+apf.getAbsolutePath(this.iconPath,C)+")");}}}var G=this.$getLayoutNode("item","caption");if(G){if(G.nodeType==1&&this.$cbindings.caption&&this.$cbindings.caption.hasAml){var n=(this.$cbindings.queue||(this.$cbindings.queue={}));G.setAttribute("id","placeholder_"+this.$uniqueId+"_"+((n.caption||(n.caption=[])).push(I)-1));apf.setNodeValue(G,"");}else{apf.setNodeValue(G,this.$applyBindRule("caption",I));}}var B=this.$applyBindRule("tooltip",I);if(B){D.setAttribute("title",B);}var J=this.$applyBindRule("css",I);if(J){this.$setStyleClass(this.$getLayoutNode("item",null,D),J);this.$setStyleClass(this.$getLayoutNode("item","container",D),J);this.$dynCssClasses.push(J);}return D;};this.$updateNode=function(s,u){var q=this.$getLayoutNode("item","icon",u),t=this.$applyBindRule("icon",s);if(q&&t){if(q.tagName&&q.tagName.match(/^img$/i)){q.src=apf.getAbsolutePath(this.iconPath,t);}else{q.style.backgroundImage="url("+apf.getAbsolutePath(this.iconPath,t)+")";}}var A=this.$getLayoutNode("item","caption",u);var A=this.$getLayoutNode("item","caption",u);if(A){if(A.nodeType==1){if(!this.$cbindings.caption||!this.$cbindings.caption.hasAml){A.innerHTML=this.$applyBindRule("caption",s);}}else{A.nodeValue=this.$applyBindRule("caption",s);}}var w=this.$applyBindRule("tooltip",s);if(w){u.setAttribute("title",w);}var n=this.$applyBindRule("css",s);if(n||this.$dynCssClasses.length){this.$setStyleClass(u,n,this.$dynCssClasses);if(n&&!this.$dynCssClasses.contains(n)){this.$dynCssClasses.push(n);}}};this.$draw=function(){this.$drawBase();};}).call(apf.tree.prototype=new apf.BaseTree());apf.aml.setElement("tree",apf.tree);apf.aml.setElement("checked",apf.BindingRule);apf.section=function(d,c){this.$init(c||"section",apf.NODE_VISIBLE,d);};apf.menubar=function(d,c){this.$init(c||"menubar",apf.NODE_VISIBLE,d);};apf.bar=function(d,c){this.$init(c||"bar",apf.NODE_VISIBLE,d);};(function(){this.$focussable=false;this.$canLeechSkin=true;this.$isLeechingSkin=false;this.$propHandlers.caption=function(c){this.$int.innerHTML=c;};this.addEventListener("AMLReparent",function(c,g,d){if(!this.$amlLoaded){return;}if(this.$isLeechingSkin&&!d&&this.skinName!=g.skinName||!this.$isLeechingSkin&&this.parentNode.$hasLayoutNode&&this.parentNode.$hasLayoutNode(this.localName)){this.$isLeechingSkin=true;this.$forceSkinChange(this.parentNode.skinName.split(":")[0]+":"+skinName);}});this.$draw=function(){this.$ext=this.$getExternal(this.$isLeechingSkin?this.localName:"main");if(this.oDrag){this.oDrag.parentNode.removeChild(this.oDrag);}this.oDrag=this.$getLayoutNode(this.$isLeechingSkin?this.localName:"main","dragger",this.$ext);this.$int=this.$getLayoutNode(this.$isLeechingSkin?this.localName:"main","container",this.$ext);};this.$loadAml=function(c){};}).call(apf.bar.prototype=new apf.Presentation());apf.menubar.prototype=apf.section.prototype=apf.bar.prototype;apf.aml.setElement("bar",apf.bar);apf.aml.setElement("menubar",apf.menubar);apf.aml.setElement("section",apf.section);apf.actions=function(d,c){this.$init(c||"actions",apf.NODE_HIDDEN,d);this.$actions=new apf.ruleList();this.$amlNodes={};};(function(){this.$smartbinding=null;this.register=function(c){if(c.localName=="smartbinding"){this.$smartbinding=c;this.$smartbinding.add(this);return;}this.$amlNodes[c.$uniqueId]=c;c.$actions=this.$actions;c.dispatchEvent("actionsload",{bindings:this});};this.unregister=function(c){this.$amlNodes[c.$uniqueId]=null;delete this.$amlNodes[c.$uniqueId];delete c.$actions;c.dispatchEvent("actionsunload",{bindings:this});};this.addEventListener("DOMNodeInsertedIntoDocument",function(k){var d=this.childNodes;for(var j,g=0,c=d.length;g<c;g++){if((j=d[g]).nodeType!=1){continue;}j.dispatchEvent("DOMNodeInsertedIntoDocument");}this.register(this.parentNode);});}).call(apf.actions.prototype=new apf.AmlElement());apf.aml.setElement("actions",apf.actions);apf.radiobutton=function(g,c){this.$init(c||"radiobutton",apf.NODE_VISIBLE,g);this.$constructor=apf.radiobutton;var d=apf.aml.setElement("radiobutton",function(){this.$init(c||"radiobutton",apf.NODE_VISIBLE,g);});d.prototype=apf.radiobutton.prototype;apf.radiobutton=d;};(function(){this.implement(apf.ChildValue);this.$childProperty="label";this.$focussable=true;this.$booleanProperties.checked=true;this.$supportedProperties.push("value","background","group","label","checked","tooltip","icon");this.$propHandlers.group=function(c){if(!this.$amlLoaded){return;}if(this.$group&&this.$group.$removeRadio){this.$group.$removeRadio(this);}if(!c){this.$group=null;return;}var d=typeof c=="string"?apf.nameserver.get("radiogroup",c):c;if(!d){d=apf.nameserver.register("radiogroup",c,new apf.$group());d.setAttribute("id",c);d.dispatchEvent("DOMNodeInsertedIntoDocument");d.parentNode=this;}this.$group=d;if(this.oInput){this.oInput.setAttribute("name",c);}this.$group.$addRadio(this);};this.$propHandlers.tooltip=function(c){this.$ext.setAttribute("title",c);};this.$propHandlers.icon=function(c){if(!this.oIcon){return apf.console.warn("No icon defined in the Button skin","button");}if(c){this.$setStyleClass(this.$ext,this.$baseCSSname+"Icon");}else{this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Icon"]);}apf.skins.setIcon(this.oIcon,c,this.iconPath);};this.$propHandlers.label=function(c){if(c){this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Empty"]);}else{this.$setStyleClass(this.$ext,this.$baseCSSname+"Empty");}if(this.oLabel){this.oLabel.innerHTML=c;}};this.$propHandlers.checked=function(c){if(!this.$group){return;}if(c){this.$group.setProperty("value",this.value);}};this.addEventListener("prop.model",function(c){if(this.$group){this.$group.setProperty("model",c.value);}});this.$propHandlers.background=function(d){var g=this.$getLayoutNode("main","background",this.$ext);if(d){var c=d.split("|");this.$background=c.concat(["vertical",2,16].slice(c.length-1));g.style.backgroundImage="url("+this.mediaPath+c[0]+")";g.style.backgroundRepeat="no-repeat";}else{g.style.backgroundImage="";g.style.backgroundRepeat="";this.$background=null;}};this.setValue=function(c){this.setProperty("value",c,false,true);};this.getValue=function(){return this.value;};this.check=function(){this.setProperty("checked",true,false,true);};this.uncheck=function(){this.setProperty("checked",false,false,true);};this.getGroup=function(){return this.$group;};this.$check=function(c){this.$setStyleClass(this.$ext,this.$baseCSSname+"Checked");this.checked=true;if(this.oInput){this.oInput.checked=true;}this.doBgSwitch(2);};this.$uncheck=function(){this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Checked"]);this.checked=false;if(this.oInput){this.oInput.checked=false;}this.doBgSwitch(1);};this.$enable=function(){if(this.oInput){this.oInput.disabled=false;}var c=this;this.$ext.onclick=function(d){if(!d){d=event;}if((d.srcElement||d.target)==this){return;}c.dispatchEvent("click",{htmlEvent:d});c.$group.change(c.value);};this.$ext.onmousedown=function(d){if(!d){d=event;}if((d.srcElement||d.target)==this){return;}apf.setStyleClass(this,c.$baseCSSname+"Down");};this.$ext.onmouseover=function(d){if(!d){d=event;}if((d.srcElement||d.target)==this){return;}apf.setStyleClass(this,c.$baseCSSname+"Over");};this.$ext.onmouseout=this.$ext.onmouseup=function(){apf.setStyleClass(this,"",[c.$baseCSSname+"Down",c.$baseCSSname+"Over"]);};};this.$disable=function(){if(this.oInput){this.oInput.disabled=true;}this.$ext.onclick=null;this.$ext.onmousedown=null;};this.doBgSwitch=function(d){if(this.bgswitch&&(this.bgoptions[1]>=d||d==4)){if(d==4){d=this.bgoptions[1]+1;}var c=this.bgoptions[0]=="vertical"?"0 -"+(parseInt(this.bgoptions[2])*(d-1))+"px":"-"+(parseInt(this.bgoptions[2])*(d-1))+"px 0";this.$getLayoutNode("main","background",this.$ext).style.backgroundPosition=c;}};this.$focus=function(){if(!this.$ext){return;}if(this.oInput&&this.oInput.disabled){return false;}this.$setStyleClass(this.$ext,this.$baseCSSname+"Focus");};this.$blur=function(){if(!this.$ext){return;}this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Focus"]);};this.addEventListener("keydown",function(g){var c=g.keyCode;if(c==13||c==32){this.$group.change(this.value);return false;}else{if(c==38){var d=this;while(d&&d.previousSibling){d=d.previousSibling;if(d.localName=="radiobutton"&&!d.disabled&&d.$group==this.$group){d.check();d.focus();return;}}}else{if(c==40){var d=this;while(d&&d.nextSibling){d=d.nextSibling;if(d.localName=="radiobutton"&&!d.disabled&&d.$group==this.$group){d.check();d.focus();return;}}}}}},true);this.$draw=function(){this.$ext=this.$getExternal();this.oInput=this.$getLayoutNode("main","input",this.$ext);this.oLabel=this.$getLayoutNode("main","label",this.$ext);this.oIcon=this.$getLayoutNode("main","icon",this.$ext);if(this.oLabel&&this.oLabel.nodeType!=1){this.oLabel=this.oLabel.parentNode;}this.enable();};this.$childProperty="label";this.$loadAml=function(c){if(this.group){this.$propHandlers.group.call(this,this.group);}else{if(this.parentNode.localName=="group"){this.$propHandlers.group.call(this,this.parentNode);}}if(!this.$group){this.$propHandlers.group.call(this,"radiogroup"+this.parentNode.$uniqueId);}};this.$destroy=function(){if(this.$group){this.$group.$removeRadio(this);}};}).call(apf.radiobutton.prototype=new apf.Presentation());apf.aml.setElement("radiobutton",apf.radiobutton);apf.$group=function(i,c){this.$init(c||"radiogroup",apf.NODE_VISIBLE,i);this.implement(apf.StandardBinding,apf.DataAction);var g=[];this.$supportedProperties.push("value","selectedItem");this.$propHandlers.value=function(k){for(var j=0;j<g.length;j++){if(g[j].value==k){return this.setProperty("selectedItem",g[j]);}}return this.setProperty("selectedItem",null);};var d;this.$propHandlers.selectedItem=function(k){if(d){d.$uncheck();}if(!k){return;}k.$check();d=k;for(var j=0;j<g.length;j++){g[j].setProperty("selectedItem",k);}};this.$addRadio=function(j){var k=g.push(j)-1;if(!j.value){j.setProperty("value",k);}if(this.value&&j.value==this.value){this.setProperty("selectedItem",j);}else{if(j.checked){this.setProperty("value",j.value);}}};this.$removeRadio=function(j){g.remove(j);if(j.value===j.id){j.setProperty("value","");}if(j.selectedItem==j){this.setProperty("value",null);}};this.setValue=function(j){this.setProperty("value",j);};this.getValue=function(){return this.value;};this.$draw=function(){this.$ext=this.$int=this.$pHtmlNode;};};apf.$group.prototype=new apf.GuiElement();apf.aml.setElement("group",apf.$group);apf.style=function(d,c){this.$init(c||"style",apf.NODE_HIDDEN,d);};(function(){this.$focussable=false;this.$propHandlers.src=function(c){apf.getData(c,{callback:function(g,d){if(d==apf.SUCCESS){apf.importCssString(g);}}});};this.addEventListener("DOMNodeInsertedIntoDocument",function(c){if(this.type!="text/chartcss"&&this.firstChild){apf.importCssString(this.firstChild.nodeValue);}});}).call(apf.style.prototype=new apf.AmlElement());apf.aml.setElement("style",apf.style);apf.xhtml.setElement("style",apf.style);apf.page=function(d,c){this.$init(c||"page",apf.NODE_VISIBLE,d);};(function(){this.canHaveChildren=true;this.$focussable=false;this.buttons=false;this.closebtn=false;this.setCaption=function(c){this.setProperty("caption",c,false,true);};this.setIcon=function(c){this.setProperty("icon",c,false,true);};this.addEventListener("beforerender",function(){this.parentNode.dispatchEvent("beforerender",{page:this});});this.addEventListener("afterrender",function(){this.parentNode.dispatchEvent("afterrender",{page:this});});this.$booleanProperties.visible=true;this.$booleanProperties.fake=true;this.$booleanProperties.closebtn=true;this.$supportedProperties.push("fake","caption","icon","type","buttons","closebtn");this.$propHandlers.buttons=function(c){this.buttons=c;};this.$propHandlers.closebtn=function(c){this.closebtn=c;};this.$propHandlers.caption=function(d){if(!this.parentNode){return;}var c=this.parentNode.$getLayoutNode("button","caption",this.$button);if(c.nodeType==1){c.innerHTML=d;}else{c.nodeValue=d;}};this.$propHandlers.icon=function(d){if(!this.parentNode){return;}var c=this.parentNode.$getLayoutNode("button","icon",this.$button);if(c&&c.nodeType==1){apf.skins.setIcon(c,d,this.parentNode.iconPath);}};this.$propHandlers.visible=function(i){if(!this.parentNode){return;}if(i){this.$ext.style.display="";if(this.parentNode.$hasButtons){this.$button.style.display="block";}if(!this.parentNode.$activepage){this.parentNode.set(this);}}else{if(this.$active){this.$deactivate();var g=this.parentNode.activepagenr+1;var d=this.parentNode.getPages();var c=d.length;while(g<c&&!d[g].visible){g++;}if(g==c){g=this.parentNode.activepagenr-1;while(g>=0&&c&&!d[g].visible){g--;}}if(g>=0){this.parentNode.set(g);}else{this.parentNode.activepage=this.parentNode.activepagenr=this.parentNode.$activepage=null;}}this.$ext.style.display="none";if(this.parentNode.$hasButtons){this.$button.style.display="none";}}};this.$propHandlers.fake=function(c){if(this.$ext){apf.destroyHtmlNode(this.$ext);this.$int=this.$ext=null;}};this.$propHandlers.type=function(c){this.setProperty("fake",true);this.relPage=this.parentNode.getPage(c);if(this.$active){this.$activate();}};this.addEventListener("DOMNodeRemoved",function(c){if(c&&c.currentTarget!=this){return;}if(this.$button){if(this.$position&1){this.parentNode.$setStyleClass(this.$button,"",["firstbtn","firstcurbtn"]);}if(this.$position&2){this.parentNode.$setStyleClass(this.$button,"",["lastbtn"]);}}if(!c.$doOnlyAdmin){if(this.$button){this.$button.parentNode.removeChild(this.$button);}if(this.parentNode.$activepage==this){if(this.$button){this.parentNode.$setStyleClass(this.$button,"",["curbtn"]);}this.parentNode.$setStyleClass(this.$ext,"",["curpage"]);}}});this.addEventListener("DOMNodeInserted",function(c){if(c&&c.currentTarget!=this||!this.$amlLoaded||!c.$oldParent){return;}if(!c.$isMoveWithinParent&&this.skinName!=this.parentNode.skinName){this.$destroy();}else{if(this.$button&&c.$oldParent.$hasButtons){this.parentNode.$buttons.insertBefore(this.$button,c.$beforeNode&&c.$beforeNode.$button||null);}}},true);this.$position=0;this.$first=function(c){if(c){this.$position-=1;this.parentNode.$setStyleClass(this.$button,"",["firstbtn","firstcurbtn"]);}else{this.$position=this.$position|1;this.parentNode.$setStyleClass(this.$button,"firstbtn"+(this.parentNode.$activepage==this?" firstcurbtn":""));}};this.$last=function(c){if(c){this.$position-=2;this.parentNode.$setStyleClass(this.$button,"",["lastbtn"]);}else{this.$position=this.$position|2;this.parentNode.$setStyleClass(this.$button,"lastbtn");}};this.$deactivate=function(c){this.$active=false;if(this.parentNode.$hasButtons){if(this.$position>0){this.parentNode.$setStyleClass(this.$button,"",["firstcurbtn"]);}this.parentNode.$setStyleClass(this.$button,"",["curbtn"]);}if((!this.fake||this.relPage)&&!c){this.parentNode.$setStyleClass(this.fake?this.relPage.$ext:this.$ext,"",["curpage"]);this.dispatchEvent("prop.visible",{value:false});}};this.$activate=function(){this.$active=true;if(!this.$drawn){var d;this.addEventListener("DOMNodeInsertedIntoDocument",d=function(g){this.removeEventListener("DOMNodeInsertedIntoDocument",d);if(!this.$active){return;}this.$activate();});return;}if(this.parentNode.$hasButtons){if(this.$position>0){this.parentNode.$setStyleClass(this.$button,"firstcurbtn");}this.parentNode.$setStyleClass(this.$button,"curbtn");}if(!this.fake||this.relPage){this.parentNode.$setStyleClass(this.fake?this.relPage.$ext:this.$ext,"curpage");if(apf.layout){apf.layout.forceResize(this.fake?this.relPage.$int:this.$int);}}if(this.$render){this.$render();}if(!this.fake){if(apf.isIE){var c=this.$ext.className;this.$ext.className="rnd"+Math.random();this.$ext.className=c;}this.dispatchEvent("prop.visible",{value:true});}};this.addEventListener("$skinchange",function(){if(this.caption){this.$propHandlers.caption.call(this,this.caption);}if(this.icon){this.$propHandlers.icon.call(this,this.icon);}});this.$canLeechSkin=true;this.$draw=function(g){this.skinName=this.parentNode.skinName;var n=this.getAttribute("type");if(n){this.fake=true;this.relPage=this.parentNode.getPage(n)||null;}if(this.parentNode.$hasButtons){this.parentNode.$getNewContext("button");var j=this.parentNode.$getLayoutNode("button");j.setAttribute(this.parentNode.$getOption("main","select")||"onmousedown","var page = apf.lookup("+this.$uniqueId+");                 if (page.disabled) return;                 page.parentNode.set(page);                 page.canHaveChildren = 2;");j.setAttribute("onmouseover","var o = apf.lookup("+this.parentNode.$uniqueId+");if(apf.lookup("+this.$uniqueId+') != o.$activepage) o.$setStyleClass(this, "over", null, true);');j.setAttribute("onmouseout","var o = apf.lookup("+this.parentNode.$uniqueId+');                  o.$setStyleClass(this, "", ["over"], true);                  var page = apf.lookup('+this.$uniqueId+");                  page.canHaveChildren = true;");var i=this.getAttribute("id")||this.getAttribute("name"),c=this.getAttribute("closebtn");if((c=="true"||(this.parentNode.buttons=="close"&&c==null))&&i){var d=this.parentNode.$getLayoutNode("button","btncontainer");this.parentNode.$getNewContext("btnclose");var k=this.parentNode.$getLayoutNode("btnclose");if(!k){return;}k.setAttribute("onclick","var page = apf.lookup("+this.$uniqueId+");                     page.parentNode.remove("+i+");");d.appendChild(k);}this.$button=apf.insertHtmlNode(j,this.parentNode.$buttons);if(!g&&this.nextSibling&&this.nextSibling.$button){this.$button.parentNode.insertBefore(this.$button,this.nextSibling.$button);}this.$button.host=this;}if(this.fake){return;}if(this.$ext){this.$ext.parentNode.removeChild(this.$ext);}this.$ext=this.parentNode.$getExternal("page",this.parentNode.oPages,null,this);this.$ext.host=this;this.$int=this.parentNode.$getLayoutNode("page","container",this.$ext);};this.$loadAml=function(c){};this.$destroy=function(){if(this.$button){this.$button.host=null;this.$button=null;}};}).call(apf.page.prototype=new apf.Presentation());apf.aml.setElement("page",apf.page);apf.BindingDndRule=function(d,c){this.$init(c,apf.NODE_HIDDEN,d);};(function(){this.compile=function(d){if(!this[d]){return;}var c;if(d=="value"){c=apf.lm.compile(this[d],{xpathmode:3});}else{if(d=="match"){c=apf.lm.compile(this[d],{xpathmode:3,injectself:true});}else{if(d=="target"){c=apf.lm.compile(this[d],{xpathmode:2,injectself:true});}else{if(d=="action"){c=apf.lm.compile(this[d],{nostring:true});}else{if(d=="copy"){c=apf.lm.compile(this[d],{withopt:true,nostring:true});}else{throw new Error("Missing property handler for compile");}}}}}return(this["c"+d]=c);};this.$attrExcludePropBind=apf.extend({target:1,parent:1,action:1,dragcopy:1},this.$attrExcludePropBind);this.$propHandlers.target=this.$propHandlers.parent=this.$propHandlers.action=this.$propHandlers.dragcopy=function(c,d){delete this["c"+d];};this.$noderegister=function(c){apf.GuiElement.propHandlers.drop.call(c.amlNode,true);};this.addEventListener("DOMNodeInsertedIntoDocument",function(j){var g=this;while(g&&g.$bindingRule){g=g.parentNode;}if(!g){return;}if(g.localName=="bindings"){g.addEventListener("noderegister",this.$noderegister);var c=g.$amlNodes;for(var d=0;d<c.length;d++){apf.GuiElement.propHandlers.drop.call(c[d],true);}}else{apf.GuiElement.propHandlers.drop.call(g,true);}});}).call(apf.BindingDndRule.prototype=new apf.BindingRule());apf.aml.setElement("drag",apf.BindingDndRule);apf.aml.setElement("drop",apf.BindingDndRule);apf.toolbar=function(d,c){this.$init(c||"toolbar",apf.NODE_VISIBLE,d);};(function(){this.$focussable=false;this.$draw=function(){this.$ext=this.$getExternal();this.$int=this.$getLayoutNode("main","container",this.$ext);};}).call(apf.toolbar.prototype=new apf.Presentation());apf.aml.setElement("toolbar",apf.toolbar);apf.divider=function(d,c){this.$init(c||"divider",apf.NODE_VISIBLE,d);};(function(){this.$focussable=false;this.implement(apf.ChildValue);this.$childProperty="caption";this.addEventListener("AMLReparent",function(c,g,d){if(!this.$amlLoaded){return;}if(!d&&this.skinName!=g.skinName){this.loadAml();}});this.$supportedProperties.push("caption","value","for","textalign");this.$propHandlers.caption=function(c){if(this.$caption){this.$caption.style.display=c?"inline":"";this.$caption.innerHTML=c;}};this.show=function(){this.setProperty("visible",true);};this.hide=function(){this.setProperty("visible",false);};this.$canLeechSkin=true;this.$draw=function(){if(this.parentNode.isPaged&&this.parentNode.$buttons){this.$pHtmlNode=this.parentNode.$buttons;}if(this.$isLeechingSkin){this.$ext=apf.insertHtmlNode(this.parentNode.$getLayoutNode("divider"),this.$pHtmlNode);}else{this.$ext=this.$getExternal("main");this.$caption=this.$getLayoutNode("main","caption",this.$ext);}};}).call(apf.divider.prototype=new apf.Presentation);apf.aml.setElement("divider",apf.divider);apf.hbox=function(d,c){this.$init(c||"hbox",apf.NODE_VISIBLE,d);this.$lastRules=[];};apf.vbox=function(d,c){this.$init(c||"vbox",apf.NODE_VISIBLE,d);this.$lastRules=[];};(function(){var c=apf.layout;this.$focussable=false;this.$update=false;this.padding=2;this.edge="5 5 5 5";this.pack="start";this.stretch=true;var g=apf.isIE?"styleFloat":"cssFloat";this.$supportedProperties.push("padding","margin","flex","pack","stretch");this.$booleanProperties.stretch=true;this.$propHandlers.padding=this.$propHandlers.edge=this.$propHandlers.pack=this.$propHandlers.stretch=function(j){if(!this.$update&&apf.loaded){c.queue(this.$ext,this.$updateObj);}this.$update=true;};function d(){var j=this.parentNode;if(!j.$update&&apf.loaded){c.queue(j.$ext,j.$updateObj);}j.$update=true;}this.register=function(j){j.$propHandlers.left=j.$propHandlers.top=j.$propHandlers.right=j.$propHandlers.bottom=apf.K;j.$propHandlers.align=j.$propHandlers.flex=j.$propHandlers.width=j.$propHandlers.height=j.$propHandlers.margin=this.$updateObj.updateTrigger;j.addEventListener("prop.visible",d);c.queue(this.$ext,this.$updateObj);this.$update=true;};this.unregister=function(j){j.$propHandlers.left=j.$propHandlers.top=j.$propHandlers.right=j.$propHandlers.bottom=j.$propHandlers.align=j.$propHandlers.flex=j.$propHandlers.width=j.$propHandlers.height=j.$propHandlers.margin=null;j.removeEventListener("prop.visible",d);j.$altExt=null;c.queue(this.$ext,this.$updateObj);this.$update=true;};this.addEventListener("DOMNodeRemoved",function(k){if(this.$isWaitingOnDisplay||!this.$updateObj||k.$doOnlyAdmin){return;}if(k.currentTarget==this){var j=this;while(j){j.unwatch("visible",this.$updateObj.propChange);j=j.parentNode;}}else{if(k.relatedNode==this){this.unregister(k.currentTarget);if(k.currentTarget.nodeFunc==apf.NODE_VISIBLE){k.currentTarget.$ext.style.display=k.currentTarget.visible?"block":"none";k.currentTarget.$ext.style.verticalAlign="";k.currentTarget.$ext.style[g]="";}}}});this.addEventListener("DOMNodeInserted",function(k){if(this.$isWaitingOnDisplay||k.currentTarget.nodeType!=1){return;}if(k.currentTarget==this){var j=this;while(j){j.watch("visible",this.$updateObj.propChange);j=j.parentNode;}}else{if(k.relatedNode==this){if(k.$isMoveWithinParent){c.queue(this.$ext,this.$updateObj);this.$update=true;}else{k.currentTarget.$setLayout(this.localName);}}}});function i(k,j){return typeof k=="string"?k.replace(apf.percentageMatch,"(("+j+" * $1)/100)"):k;}this.addEventListener("prop.height",function(j){if(!this.$update){this.$update=true;c.queue(this.$ext,this.$updateObj);}});this.addEventListener("prop.width",function(j){if(!this.$update){this.$update=true;c.queue(this.$ext,this.$updateObj);}});this.$isWaitingOnDisplay=false;this.$updateBox=function(){if(!this.$update){return;}if(this.$lastRules.length){for(var ad=0,P=this.$lastRules.length;ad<P;ad++){c.removeRule(this.$lastRules[ad][0],this.$lastRules[ad][1]);c.queue(this.$lastRules[ad][0]);}this.$lastRules=[];}if(!this.$ext.offsetWidth){this.$isWaitingOnDisplay=true;this.watch("visible",this.$updateObj.propChange);var Y=this.parentNode;while(Y){Y.watch("visible",this.$updateObj.propChange);Y=Y.parentNode;}return;}this.padding=parseInt(this.padding);var R;var N="pWidth",Z="pHeight",C=apf.getBox(String(this.edge)),t=this.childNodes,U={total:0,count:[],html:[]},L=[],B,M,ac,aa,W,af,I,H,J;this.ids=[this.$ext];var G=t.length,Q=this.localName=="vbox",ab=!Q;this.$hasPerc=false;this.$totalPerc=0;this.$totalFixed=(Q?C[2]:C[1])+((G-1)*this.padding);var K=this.$ext.style.width;var T=this.$ext.style.height;var u=this.height||this.top&&this.bottom||this.anchors;var ae=0;var A=Q?"height":"width";var V=Q?"offsetHeight":"offsetWidth";for(var S=[],ad=0,P=t.length;ad<P;ad++){H=t[ad];if(H.nodeType!=1&&H.nodeType!=7||H.nodeFunc==apf.NODE_HIDDEN||H.visible===false){continue;}aa=apf.getBox(String(H.margin));M=apf.getDiff(B=H.$ext);I=H.span;af={m:aa,weight:parseInt(H.weight)||1,align:H.align,width:H.width,height:H.height,minwidth:H.minwidth||0,minheight:H.minheight||0,oHtml:B};af.isPerc=String(af[A]).indexOf("%")>-1;if(af.width&&!String(af.width).match(/^\d+%?$/)){throw new Error("Invalid width specified:"+af.width);}if(af.height&&!String(af.height).match(/^\d+%?$/)){throw new Error("Invalid height specified:"+af.height);}S.push(af);B.style.display=ab?"inline-block":"block";if(ab){B.style.verticalAlign="top";}var D=false;if(!T&&!u&&af.isPerc){delete af[A];af.isPerc=false;}if(af.isPerc){this.$createInt();if(!H.$altExt){H.$altExt=this.$int.insertBefore(document.createElement("div"),B);H.$altExt.appendChild(B);H.$altExt.style.position="relative";if(ab){H.$altExt.style.display="inline-block";H.$altExt.style.verticalAlign="top";}D=true;}if((H.width||Q&&(this.stretch||!B.style.width))&&(H.height||ab&&this.stretch)){B.style.position="absolute";B.style.left=0;B.style.top=0;B.style.right=0;B.style.bottom=0;B.style.height="";B.style.width="";}else{B.style.position="relative";B.style.display="block";B.style.width="auto";}B.style.margin="";B=af.oHtml=H.$altExt;H.$altExt.style[A]=af[A];this.$hasPerc=true;this.$totalPerc++;if(D&&apf.isIE){apf.layout.forceResize(H.$ext);}if(ab){B.style[g]="";}}else{if(H.$altExt){if(H.$altExt.parentNode==this.$int){this.$int.insertBefore(B,H.$altExt);}H.$altExt.parentNode.removeChild(H.$altExt);H.$altExt=null;D=true;B.style.position="";B.style.display="";}if(af[A]||af[A]===0){if(parseInt(af[A])==NaN){apf.console.warn("Invalid "+A+" specific. Only                             numbers or percentage is allowed:"+af[A]);af[A]=null;}else{this.$totalFixed+=parseInt(af[A]);}B.style[A]=Math.max(0,af[A]-M[Q?1:0])+"px";}else{B.style[A]="";this.$totalFixed+=B[V];if(!B.getAttribute("id")){J="document.getElementById('"+apf.setUniqueHtmlId(B)+"')";}else{J="document.getElementById('"+B.getAttribute("id")+"')";}U.html.push(B);U.count.push(J+"."+V);U.total+=B[V];}B.style.position="relative";if(D&&apf.isIE){apf.layout.forceResize(H.$ext);}if(ab){B.style[g]=af.align&&af.align!=this.pack?(af.align=="start"?"left":"right"):"";}}if(Q){if((af.width||af.width===0)&&String(af.width).indexOf("%")==-1){ae=Math.max(ae,af.width);B.style.width=(af.width-M[0])+"px";}else{if(this.stretch){ae=Math.max(ae,af.minwidth||5);B.style.width="auto";}else{B.style.width="";ae=Math.max(ae,af.minwidth);}}ae+=aa[1]+aa[3];}else{if(ab){if((af.height||af.height===0)&&String(af.height).indexOf("%")==-1){ae=Math.max(ae,af.height);B.style.height=(af.height-M[1])+"px";}else{if(u&&this.stretch){ae=Math.max(ae,af.minheight||5);L.push([B,M[1],af.m]);}else{B.style.height="";ae=Math.max(ae,af.minheight);}}ae+=aa[0]+aa[2];}}this.$totalFixed+=(Q?aa[0]+aa[2]:aa[1]+aa[3]);}if(S.length==0){this.$update=false;return;}var E,aa,q;for(ad=0,P=S.length;ad<P;ad++){af=S[ad];aa=af.m;q=S[ad+1]&&S[ad+1].m;af.oHtml.style.margin=Q?(aa[0]+(E&&E[2]||0))+"px "+aa[1]+"px "+(aa[2]+(q&&q[0]||0)+(ad<P-1?this.padding:0))+"px "+aa[3]+"px":aa[0]+"px "+(aa[1]+(q&&q[3]||0)+(ad<P-1?this.padding:0))+"px "+aa[2]+"px "+(aa[3]+(E&&E[1]||0))+"px";E=af.m;}var O=apf.getBox(this.$ext.style.padding);if(this.$hasPerc){this.$ext.style.padding=Q?C[0]+"px "+C[1]+"px "+this.$totalFixed+"px "+C[3]+"px":C[0]+"px "+this.$totalFixed+"px "+C[2]+"px "+C[3]+"px";}else{this.$ext.style.padding=C.join("px ")+"px";}if(U.count){var F="apf.all["+this.$uniqueId+"]";U.count=U.count.join(" + ");for(var ad=0;ad<U.html.length;ad++){html=U.html[ad];if(this.$hasPerc){c.setRules(html,"boxp",F+".$ext.style.padding"+(Q?"Bottom":"Right")+" = ("+(this.$totalFixed-U.total)+" + "+U.count+") + 'px';",true);}else{c.setRules(html,"boxp",F+".$ext.style.min"+(Q?"Height":"Width")+" = -"+(Q?C[2]:C[1])+" + ("+F+"['min"+A+"'] = "+(this.$totalFixed-U.total)+" + "+U.count+") + 'px';",true);}c.queue(html);this.$lastRules.push([html,"boxp"]);}this.$totalFixed+=Q?C[0]:C[3];}var X=apf.getBox(this.$ext.style.padding);var k=parseInt(apf.getStyle(this.$ext,"width"));var n=parseInt(apf.getStyle(this.$ext,"height"));if(K&&(k||k===0)){if(this.width){this.$propHandlers.width.call(this,this.width);}else{if(this.left&&this.right){this.$propHandlers.right.call(this,this.right);}else{this.$ext.style.width=Math.max(0,k+O[1]-X[1]+O[3]-X[3])+"px";}}}if(T&&(n||n===0)){if(this.height){this.$propHandlers.height.call(this,this.height);}else{if(this.top&&this.bottom){this.$propHandlers.bottom.call(this,this.bottom);}else{this.$ext.style.height=Math.max(0,n+O[0]-X[0]+O[2]-X[2])+"px";}}}if(u&&L.length){var w=["var height = apf.all["+this.$uniqueId+"].$ext.offsetHeight"];for(ad=0;ad<L.length;ad++){html=L[ad][0];if(!html.getAttribute("id")){J="document.getElementById('"+apf.setUniqueHtmlId(html)+"')";}else{J="document.getElementById('"+html.getAttribute("id")+"')";}w.push(J+".style.height = (height - apf.getHeightDiff("+J+") - "+ +(C[0]+C[2]+L[ad][2][0]+L[ad][2][2])+") + 'px'");}c.setRules(this.$ext,"boxh",(w.length?"try{"+w.join(";}catch(e){};\ntry{")+";}catch(e){};":""),true);c.queue(this.$ext);this.$lastRules.push([this.$ext,"boxh"]);}if(ab){this.$int.style.textAlign=this.$hasPerc||!this.pack||this.pack=="start"?"left":(this.pack=="middle"?"center":"right");}else{if(this.pack||this.$ext!=this.$int){this.$createInt();if(this.$hasPerc||!this.pack||this.pack=="start"){this.$int.style.position="static";if(Q){this.$int.style.height="100%";}this.$int.style.top="";this.$int.style.marginTop="";}else{if(this.pack=="middle"){this.$int.style.position="relative";this.$int.style.top="50%";this.$int.style.height="auto";this.$int.style.marginTop="-"+(this.$int.offsetHeight/2)+"px";}else{if(this.pack=="end"){this.$int.style.position="relative";this.$int.style.top="100%";this.$int.style.height="auto";this.$int.style.marginTop="-"+this.$int.offsetHeight+"px";}}}}}this["min"+A]=this.$totalFixed+(Q?C[0]:C[3])-3+(this.$totalPerc*5);this.$ext.style["min"+A.uCaseFirst()]=((this.$hasPerc?(this.$totalPerc*5):this.$totalFixed-(Q?C[2]:C[1])-3))+"px";this["min"+(Q?"width":"height")]=ae+(Q?C[1]+C[3]:C[0]+C[2]);this.$ext.style["min"+(Q?"Width":"Height")]=(ae)+"px";this.$update=false;};this.$createInt=function(){if(this.$ext==this.$int){this.$int=this.$ext.appendChild(document.createElement("div"));this.$int.style.whiteSpace="nowrap";this.$int.className="int";var n=this.$ext.childNodes;for(var k=n.length-2;k>=0;k--){this.$int.insertBefore(n[k],this.$int.firstChild);}if(this.localName=="vbox"){this.$int.style.height="100%";}}};this.$draw=function(){var j=this;this.$updateObj={$updateLayout:function(){j.$updateBox();},updateTrigger:function(k){if(!j.$update&&j.$amlLoaded){c.queue(j.$ext,j.$updateObj);}j.$update=true;},propChange:function(n,k,q){if(j.$update&&apf.isTrue(q)&&j.$ext.offsetWidth){j.$updateBox();c.activateRules(j.$ext);var s=j;while(s){s.unwatch("visible",j.$updateObj.propChange);s=s.parentNode;}j.$isWaitingOnDisplay=false;}}};this.$ext=this.$pHtmlNode.appendChild(document.createElement("div"));this.$ext.className=this.localName+" "+(this.getAttribute("class")||"");this.$ext.style.whiteSpace="nowrap";this.$int=this.$ext;this.$ext.host=this;this.$ext.style.position="relative";this.$ext.style.minHeight="10px";if(!apf.vbox.$initedcss){apf.importCssString(".vbox>*{white-space:normal;} .hbox>*{white-space:normal;} .vbox>.int>*{white-space:normal;} .hbox>.int>*{white-space:normal;}");apf.vbox.$initedcss=true;}c.queue(this.$ext,this.$updateObj);this.$update=true;};this.$loadAml=function(j){if(!this.width&&(apf.getStyle(this.$ext,"position")=="absolute"||this.left||this.top||this.right||this.bottom||this.anchors)){this.$ext.style.width="100%";}};}).call(apf.vbox.prototype=new apf.GuiElement());apf.hbox.prototype=apf.vbox.prototype;apf.aml.setElement("hbox",apf.hbox);apf.aml.setElement("vbox",apf.vbox);apf.event=function(d,c){this.$init(c||"event",apf.NODE_HIDDEN,d);};(function(){this.$hasInitedWhen=false;this.$booleanProperties.repeat=true;this.$supportedProperties.push("when","message","icon","repeat");this.$propHandlers.when=function(d){if(this.$hasInitedWhen&&d&&this.parentNode&&this.parentNode.popup){var c=this;$setTimeout(function(){c.parentNode.popup(c.message,c.icon,c);});}this.$hasInitedWhen=true;if(this.repeat){delete this.when;}};this.$loadAml=function(c){};}).call(apf.event.prototype=new apf.AmlElement());apf.aml.setElement("event",apf.event);apf.BindingSeriesRule=function(d,c){this.$init(c||"series",apf.NODE_HIDDEN,d);};(function(){this.$attrExcludePropBind=apf.extend({formula:1},this.$attrExcludePropBind);this.$propHandlers.formula=function(c,d){delete this["c"+d];};}).call(apf.BindingSeriesRule.prototype=new apf.BindingRule());apf.aml.setElement("series",apf.BindingSeriesRule);apf.iconmap=function(){this.$init("iconmap",apf.NODE_HIDDEN);};(function(){this.$parsePrio="050";this.addEventListener("DOMNodeInsertedIntoDocument",function(c){if(!this.id){throw new Error(apf.formatErrorString(0,this,"Creating icon map","Could not create iconmap. Missing id attribute",this.$aml));}apf.skins.addIconMap({name:this.id,src:this.src,type:this.type,size:parseInt(this.size),width:parseInt(this.width),height:parseInt(this.height),offset:(this.offset||"0,0").splitSafe(",")});});}).call(apf.iconmap.prototype=new apf.AmlElement());apf.aml.setElement("iconmap",apf.iconmap);apf.BindingColumnRule=function(d,c){this.$init(c,apf.NODE_HIDDEN,d);this.$className="col"+this.$uniqueId;};(function(){this.$defaultwidth="100";this.$width=100;this.$sortable=true;this.$resizable=true;this.$movable=true;this.$cssInit=false;this.$attrExcludePropBind=apf.extend({css:1,icon:1,caption:1},this.$attrExcludePropBind);this.$supportedProperties.push("tree","icon","caption","width","options","editor","colspan","align","css");this.$booleanProperties.tree=true;this.$propHandlers.icon=function(c,d){};this.$propHandlers.caption=function(c,d){};this.$propHandlers.width=function(c,d){if(!c){c=this.$defaultwidth;}this.$isPercentage=c&&String(c).indexOf("%")>-1;this.$width=parseFloat(c);};this.$propHandlers.options=function(c,d){this.$sortable=c.indexOf("sort")>-1;this.$resizable=c.indexOf("size")>-1;this.$movable=c.indexOf("move")>-1;};this.$propHandlers.editor=function(c,d){};this.$propHandlers.colspan=function(c,d){};this.$propHandlers.align=function(c,d){};this.$propHandlers.css=function(c,d){};this.resize=function(d,F){var w;if(this.$isPercentage){var C=(this.$ext.offsetWidth-(F.$widthdiff-3)),B=d/C,A=[],q=[],D=0,g=this.$ext.nextSibling;while(g&&g.getAttribute("hid")){w=apf.all[g.getAttribute("hid")];if(w.$isPercentage){A.push(w);D+=w.$width;}else{q.push(w);}g=g.nextSibling;}if(q.length&&!A.length){return q[0].resize(q[0].$width+(C-d),F);}var k=B*this.$width,u=k-this.$width,t=(D-u)/D;if(t<0.01){if(d<20){return;}return this.resize(d-10,F);}for(var c,s=0;s<A.length;s++){c=A[s];c.$width*=t;apf.setStyleRule("."+c.$className,"width",c.$width+"%");}this.$width=k;apf.setStyleRule("."+this.$className,"width",this.$width+"%");}else{var E=d-this.$width;this.$width=d;if(apf.isIE&&F.oIframe){this.$ext.style.width=d+"px";}else{}apf.setStyleRule("."+this.$className,"width",d+"px",null,F.oWin);F.$fixed+=E;var j=(F.$fixed)+"px";if(!this.$isFixedGrid){apf.setStyleRule("."+F.$baseCSSname+" .row"+F.$uniqueId,"paddingRight",j,null,this.oWin);apf.setStyleRule("."+F.$baseCSSname+" .row"+F.$uniqueId,"marginRight","-"+j,null,F.oWin);F.$container.style.paddingRight=F.$head.style.paddingRight=j;}}};this.hide=function(){apf.setStyleRule("."+this.$baseCSSname+" .records ."+h.$className,"visibility","hidden",null,this.oWin);};this.show=function(){apf.setStyleRule("."+this.$baseCSSname+" .records ."+h.$className,"visibility","visible",null,this.oWin);};this.sort=function(c){if(c.$lastSorted==this){apf.setStyleClass(this.$int,c.toggleSortOrder()?"ascending":"descending",["descending","ascending"]);return;}var d;if(d=c.$lastSorted){apf.setStyleRule("."+d.$className,"background","white");apf.setStyleClass(d.$int,"",["descending","ascending"]);}apf.setStyleRule("."+this.$className,"background","#f3f3f3");apf.setStyleClass(this.$int,"ascending",["descending","ascending"]);if(!c.length){return;}c.resort({order:"ascending",xpath:this.cvalue2.xpaths[1]});c.$lastSorted=this;};this.move=function(g,j){if(g&&this==g){return;}var i=this,d=apf.getChildNumber(i.$int),k=g&&apf.getChildNumber(g.$int);j.$head.insertBefore(i.$int,g&&g.$int||null);if(!j.length){return;}(function c(n){for(var s,q=0;q<n.length;q++){s=n[q];if(j.$isTreeArch&&s.tagName=="BLOCKQUOTE"){c(s.childNodes);}else{s.insertBefore(s.childNodes[d],typeof k!="undefined"&&s.childNodes[k]||null);}}})(j.$container.childNodes);};this.$draw=function(j,g,n,k){var j=j||this.parentNode;while(j.$bindingRule){j=j.parentNode;}if(!j.hasFeature(apf.__PRESENTATION__)){return;}if(n){this.$propHandlers.width.call(this,n);}apf.importStylesheet([["."+this.$className,"width:"+this.$width+(this.$isPercentage?"%;":"px;")+"text-align:"+this.align]]);j.$getNewContext("headitem");var d=j.$getLayoutNode("headitem");d.setAttribute("class",this.$className+(k?" "+k:""));d.setAttribute("hid",this.$uniqueId);var i=j.$getLayoutNode("headitem","caption");i.nodeValue=this.caption||g||"";this.$ext=this.$int=apf.insertHtmlNode(d,j.$head||j.$container);var q=false;var c=this;this.$int.onmouseover=function(s){if(!s){s=event;}if(j.disabled){return;}apf.setStyleClass(this,"hover",["down"]);};this.$int.onmouseup=function(s){if(!s){s=event;}if(j.disabled||!apf.isChildOf(q,this,true)){return;}apf.setStyleClass(this,"hover",["down"]);if(c.$sortable){c.sort(j);}j.dispatchEvent("sortcolumn",c);};this.$int.onmousedown=function(A){if(!A){A=event;}q=target=this;if(j.disabled){return;}var D=apf.getAbsolutePosition(target),B=j.$head.scrollLeft;var C=A.clientX-D[0]+B;if(C<4||target.offsetWidth-C-8<3&&apf.getChildNumber(c.$int)<j.$headings.length-1){var G=C<4&&target.previousSibling||target;if(c.$resizable){D=apf.getAbsolutePosition(G);apf.setStyleClass(j.$pointer,"size_pointer",["move_pointer"]);j.$pointer.style.display="block";j.$pointer.style.left=(G.offsetLeft-B-1)+"px";j.$pointer.style.width=(G.offsetWidth-j.$widthdiff+1)+"px";apf.plane.show(j.$pointer,null,true);q=true;document.onmouseup=function(){if(!A){A=event;}document.onmouseup=document.onmousemove=null;apf.all[G.getAttribute("hid")].resize(j.$pointer.offsetWidth,j);q=false;j.$pointer.style.display="none";apf.plane.hide();};document.onmousemove=function(t){if(!t){t=event;}j.$pointer.style.width=Math.max(10,Math.min(j.$container.offsetWidth-j.$pointer.offsetLeft-20,t.clientX-D[0]-1+B))+"px";};return;}}apf.setStyleClass(target,"down",["hover"]);if(!c.$movable){document.onmouseup=function(t){document.onmouseup=null;q=false;};return;}apf.setStyleClass(j.$pointer,"move_pointer",["size_pointer"]);var F=A.clientX-target.offsetLeft,w=A.clientX,E=A.clientY-target.offsetTop,u=A.clientY,s;document.onmouseup=function(I){if(!I){I=event;}document.onmouseup=document.onmousemove=null;q=false;j.$pointer.style.display="none";if(!s){return;}s.style.top="-100px";var H=document.elementFromPoint(I.clientX,I.clientY);if(H.parentNode==s.parentNode){var J=apf.getAbsolutePosition(H);var t=(I.clientX-J[0]>H.offsetWidth/2?H.nextSibling:H);c.move(t?apf.all[t.getAttribute("hid")]:null,j);}apf.destroyHtmlNode(s);};document.onmousemove=function(I){if(!I){I=event;}if(!s){if(Math.abs(I.clientX-w)<3&&Math.abs(I.clientY-u)<3){return;}s=target.cloneNode(true);s.style.position="absolute";var H=apf.getWidthDiff(target);s.style.width=(target.offsetWidth-H-j.$widthdiff+2)+"px";s.style.left=target.offsetLeft;s.style.top=target.offsetTop;s.style.margin=0;s.removeAttribute("hid");apf.setStyleClass(s,"drag",["ascending","descending"]);target.parentNode.appendChild(s);}s.style.top="-100px";j.$pointer.style.display="none";var t=document.elementFromPoint(I.clientX,I.clientY);if(t.parentNode==s.parentNode){var J=apf.getAbsolutePosition(t);j.$pointer.style.left=(t.offsetLeft+((I.clientX-J[0]>t.offsetWidth/2)?t.offsetWidth-8:0))+"px";j.$pointer.style.display="block";}s.style.left=(I.clientX-F)+"px";s.style.top=(I.clientY-E)+"px";};};this.$int.onmouseout=function(s){if(!s){s=event;}if(j.disabled){return;}j.$ext.style.cursor="";apf.setStyleClass(this,"",["hover","down"]);};this.$int.onmousemove=function(w){if(q||j.disabled){return;}if(!w){w=event;}var B=apf.getAbsolutePosition(this),s=j.$head.scrollLeft;var A=w.clientX-B[0]+s;if(A<4||this.offsetWidth-A-j.$widthdiff<3&&apf.getChildNumber(c.$int)<j.$headings.length-1){var u=A<4?this.previousSibling:this;j.$ext.style.cursor=u&&c.$resizable?"w-resize":"default";}else{j.$ext.style.cursor="default";}};return this;};this.addEventListener("DOMNodeInsertedIntoDocument",function(c){this.$draw();});this.addEventListener("DOMNodeRemovedFromDocument",function(c){if(!this.$int){return;}this.$int.onmouseover=this.$int.onmouseup=this.$int.onmousedown=this.$int.onmousemove=this.$int.onmouseout=null;});}).call(apf.BindingColumnRule.prototype=new apf.BindingRule());apf.aml.setElement("column",apf.BindingColumnRule);apf.table=function(d,c){this.$init(c||"table",apf.NODE_VISIBLE,d);};(function(){this.$focussable=false;this.$update=false;this.columns="150,200";this.padding=2;this.$edge=[5,5,5,5];this.cellheight=19;this.$supportedProperties.push("columns","padding","edge","cellheight","span");this.$propHandlers.columns=function(A){if(!A.match(/^(\d+\%?\s*(?:,\s*|\s*$))+$/)){apf.console.warn("Invalid column string found for table: "+A);return;}var j,n=this.$columns=A.splitSafe(",");var w=0,u=this.$table.getElementsByTagName("col");if(u.length){for(var t,q=0,k=Math.min(u.length,n.length);q<k;q++){u[q].style.width=(t=n[q]).indexOf("%")>-1?t:t+"px";w+=parseInt(t);}}var g=u.length-n.length;if(g>0){for(var q=u.length-g;q<u.length;q++){u[q].parentNode.removeChild(u[q]);}}else{if(g<0){for(var q=n.length+g;q<n.length;q++){j=this.$table.appendChild(document.createElement("col"));j.style.width=(t=n[q]).indexOf("%")>-1?t:t+"px";j.setAttribute("valign","top");w+=parseInt(t);}}}this.$table.style.width=String(A).indexOf("%")>-1?"auto":(w+((n.length-1)*this.padding)+this.$edge[0]+this.$edge[2])+"px";var B=this.$tbody.firstChild.getElementsByTagName("td");for(var q=B.length-1;q>=0;q--){B[q].parentNode.removeChild(B[q]);}for(var s,q=0;q<n.length;q++){s=this.$tbody.firstChild.appendChild(document.createElement("td"));if(n[q].indexOf("%")>-1){s.appendChild(document.createElement("div")).style.width="50px";}}if(g&&this.$amlLoaded){c({sync:true,parentNode:this});}};this.$propHandlers.padding=function(u){var q=this.$table.getElementsByTagName("td");var k,t,j,g=this.$tbody.lastChild;for(var s=this.$columns.length,n=q.length;s<n;s++){k=(j=q[s]).parentNode.lastChild==j;t=j.parentNode==g;j.style.padding="0px "+(k?0:u)+"px "+(t?0:u)+"px 0px";}};this.$propHandlers.edge=function(g){this.$table.style.padding=(this.$edge=apf.getBox(g)).join("px ")+"px";};function c(K){var J=K.parentNode||this.parentNode;if(K.sync||K.value&&!this.$altExt||!K.value&&this.$altExt){var C=J.childNodes;var g=apf.getArrayFromNodelist(J.$tbody.getElementsByTagName("td"));var A=J.$tbody.getElementsByTagName("tr");var w=[],n=1,j,q,B=J.$columns.length;var t=J.$columns.length,E,H;for(var D,s,u,F=C.length,I=0;I<F;I++){if((D=C[I]).visible===false){continue;}s=D.$altExt=u=g[t++];if(!A[n]){J.$tbody.appendChild(document.createElement("tr"));}A[n].appendChild(s);s.appendChild(D.$ext);s.setAttribute("colspan",j=Math.min(B-(w[0]||0),parseInt(D.colspan||D.span||1)));s.setAttribute("rowspan",q=parseInt(D.rowspan||1));if(!w[0]){w[0]=0;}w[0]+=j;if(q>1){for(var G=1;G<q;G++){if(!w[G]){w[G]=0;}w[G]+=j;}}if(w[0]>=B){E=true;w.shift();n++;}else{E=false;}s.style.padding="0px "+(E?0:J.padding)+"px "+(I==F-1?0:J.padding)+"px 0px";}for(;t<g.length;t++){g[t].parentNode.removeChild(g[t]);}if(K.sync){return;}if(K.value){J.$addTd(C[F-1]);}else{this.$altExt=null;}}}this.$addTd=function(n){var j=this.$table.getElementsByTagName("td");var s=0;for(var g,k=0;k<j.length;k++){s+=1+(parseInt((g=j[k]).getAttribute("colspan")||1)-1)+(parseInt((g=j[k]).getAttribute("rowspan")||1)-1);}if(s%this.$columns.length==0){var t=this.$tbody.appendChild(document.createElement("tr"));}else{t=j[j.length-1].parentNode;}var q=t.appendChild(document.createElement("td"));q.style.position="relative";if(n.colspan||n.span){q.setAttribute("colspan",n.colspan||n.span);}if(n.rowspan){q.setAttribute("rowspan",n.rowspan);}q.appendChild(n.$ext);n.$altExt=q;};var d={width:function(g){this.$ext.style.width="";},height:function(g){this.$ext.style.height=g?Math.max(0,g-apf.getHeightDiff(this.$ext))+"px":"";},margin:function(g){this.$ext.style.margin=apf.getBox(g).join("px ")+"px";},colspan:function(g){if(!g){this.$altExt.removeAttribute("colspan");}else{this.$altExt.setAttribute("colspan",g);}c.call(this,{sync:true});},rowspan:function(g){if(!g){this.$altExt.removeAttribute("rowspan");}else{this.$altExt.setAttribute("rowspan",g);}c.call(this,{sync:true});},valign:function(g){this.$altExt.valign=g;},align:function(g){this.$altExt.align=g;}};d.span=d.colspan;this.register=function(g){if(g.$altExt){return;}g.$propHandlers.left=g.$propHandlers.top=g.$propHandlers.right=g.$propHandlers.bottom=apf.K;for(var i in d){g.$propHandlers[i]=d[i];}g.addEventListener("prop.visible",c);this.$addTd(g);if(g.margin){d.margin.call(g,g.margin);}if(g.$ext.tagName=="INPUT"){}else{g.$ext.style.width="auto";}if(this.lastChild==g){this.$propHandlers.padding.call(this,this.padding);}};this.unregister=function(g){g.$propHandlers.left=g.$propHandlers.top=g.$propHandlers.right=g.$propHandlers.bottom=null;for(var i in d){delete g.$propHandlers[i];}g.removeEventListener("prop.visible",c);c.call(g,{value:false});if(g.margin){g.$ext.style.margin="";}if(g.width){g.$ext.style.width="";}};this.addEventListener("DOMNodeRemoved",function(g){if(g.$doOnlyAdmin||g.currentTarget==this){return;}if(g.relatedNode==this){this.unregister(g.currentTarget);g.currentTarget.$setLayout();}});this.addEventListener("DOMNodeInserted",function(g){if(g.currentTarget==this||g.currentTarget.nodeType!=1){return;}if(g.relatedNode==this){if(g.$isMoveWithinParent){c.call(g.currentTarget,{sync:true});}else{g.currentTarget.$setLayout("table");if(g.currentTarget.nextSibling){c.call(g.currentTarget,{sync:true});}}}});this.$draw=function(){this.$pHtmlNode.insertAdjacentHTML("beforeend","<div><table cellSpacing='0' cellPadding='0'><tbody><tr class='first'></tr></tbody></table></div>");this.$ext=this.$pHtmlNode.lastChild;this.$table=this.$ext.firstChild;this.$tbody=this.$table.firstChild;this.$ext.className="table "+(this.getAttribute("class")||"");this.$int=this.$ext;this.$ext.host=this;if(this.getAttribute("class")){apf.setStyleClass(this.$ext,this.getAttribute("class"));}apf.layout.setRules(this.$ext,"table","apf.all["+this.$uniqueId+"].$resize()",true);apf.layout.queue(this.$ext);this.$originalMin=[this.minwidth||0,this.minheight||0];};this.$resize=function(){if(this.$table.offsetWidth>=this.$ext.offsetWidth){this.$ext.style.minWidth=(this.minwidth=Math.max(0,this.$table.offsetWidth-apf.getWidthDiff(this.$ext)))+"px";}else{this.$ext.style.minWidth="";this.minwidth=this.$originalMin[0];}if(this.$table.offsetHeight>=this.$ext.offsetHeight){this.$ext.style.minHeight=(this.minheight=Math.max(0,this.$table.offsetHeight-apf.getHeightDiff(this.$ext)))+"px";}else{this.$ext.style.minHeight="";this.minheight=this.$originalMin[1];}};this.$loadAml=function(g){this.$amlLoaded=false;if(!this.$columns){this.$propHandlers.columns.call(this,this.columns);}this.$amlLoaded=true;};}).call(apf.table.prototype=new apf.GuiElement());apf.aml.setElement("table",apf.table);apf["switch"]=function(d,c){this.$hasButtons=false;this.$init(c||"switch",apf.NODE_VISIBLE,d);};apf.pages=function(d,c){this.$hasButtons=false;this.$init(c||"pages",apf.NODE_VISIBLE,d);};apf.tab=function(d,c){this.$hasButtons=true;this.$init(c||"tab",apf.NODE_VISIBLE,d);};(function(){this.$focussable=apf.KEYBOARD;this.$draw=function(c){this.$ext=this.$getExternal();this.$loadChildren();};}).call(apf.tab.prototype=new apf.BaseTab());apf["switch"].prototype=apf.pages.prototype=apf.tab.prototype;apf.aml.setElement("switch",apf["switch"]);apf.aml.setElement("pages",apf.pages);apf.aml.setElement("tab",apf.tab);apf.aml.setElement("teleport",apf.AmlElement);apf.label=function(d,c){this.$init(c||"label",apf.NODE_VISIBLE,d);};(function(){this.implement(apf.DataAction,apf.ChildValue);var c=this;this.$focussable=false;var d;this.setValue=function(g){this.setProperty("value",g,false,true);};this.getValue=function(){return this.value;};this.$supportedProperties.push("caption","for","textalign");this.$propHandlers.caption=function(g){this.$caption.innerHTML=g;};this.$propHandlers["for"]=function(g){d=typeof g=="string"?self[g]:g;};this.$propHandlers.textalign=function(g){this.$caption.style.textAlign=g||"";};this.$draw=function(){this.$ext=this.$getExternal();this.$caption=this.$getLayoutNode("main","caption",this.$ext);if(this.$caption.nodeType!=1){this.$caption=this.$caption.parentNode;}this.$ext.onmousedown=function(){if(d&&d.$focussable&&d.focussable){d.focus();}};};this.$childProperty="caption";}).call(apf.label.prototype=new apf.BaseSimple());apf.aml.setElement("label",apf.label);apf.BindingLoadRule=function(d,c){this.$init(c,apf.NODE_HIDDEN,d);};(function(){this.$attrExcludePropBind=apf.extend({get:1},this.$attrExcludePropBind);this.$propHandlers.get=function(c,d){delete this["c"+d];};}).call(apf.BindingLoadRule.prototype=new apf.BindingRule());apf.aml.setElement("load",apf.BindingLoadRule);apf.aml.setElement("insert",apf.BindingLoadRule);apf.submit=function(d,c){this.$init(c||"submit",apf.NODE_VISIBLE,d);};apf.trigger=function(d,c){this.$init(c||"trigger",apf.NODE_VISIBLE,d);};apf.reset=function(d,c){this.$init(c||"reset",apf.NODE_VISIBLE,d);};apf.button=function(d,c){this.$init(c||"button",apf.NODE_VISIBLE,d);};(function(){this.$useExtraDiv;this.$childProperty="caption";this.$inited=false;this.$isLeechingSkin=false;this.$canLeechSkin=true;this.$focussable=true;this.value=null;this.$init(function(){var q,i=this;this.$propHandlers["default"]=function(s){if(!this.focussable&&s||q){this.setAttribute("focussable",q=s);}this.parentNode.removeEventListener("focus",n);this.parentNode.removeEventListener("blur",j);if(!s){return;}this.parentNode.addEventListener("focus",n);this.parentNode.addEventListener("blur",j);};function n(s){if(s.defaultButtonSet||s.returnValue===false){return;}s.defaultButtonSet=true;if(this.$useExtraDiv){i.$ext.appendChild(apf.button.$extradiv);}i.$setStyleClass(i.$ext,i.$baseCSSname+"Default");if(s.srcElement!=i&&i.$focusParent){i.$focusParent.addEventListener("keydown",k);}}function j(s){if(this.$useExtraDiv&&apf.button.$extradiv.parentNode==i.$ext){i.$ext.removeChild(apf.button.$extradiv);}i.$setStyleClass(i.$ext,"",[i.$baseCSSname+"Default"]);if(s.srcElement!=i&&i.$focusParent){i.$focusParent.removeEventListener("keydown",k);}}function k(t){var u;var s=apf.document.activeElement;if(s){if(s.hasFeature(apf.__MULTISELECT__)){return;}u=s.multiline;}if(!i.$ext.onmouseup){return;}if(u&&u!="optional"&&t.keyCode==13&&t.ctrlKey||(!u||u=="optional")&&t.keyCode==13&&!t.ctrlKey&&!t.shiftKey&&!t.altKey){i.$ext.onmouseup(t.htmlEvent,true);}}this.addEventListener("focus",n);this.addEventListener("blur",j);this.$enable=function(){if(this["default"]){n({});if(apf.document.activeElement){apf.document.activeElement.focus(true);}}if(this.state&&this.value){this.$setState("Down",{});}this.$doBgSwitch(1);};this.$disable=function(){if(this["default"]){j({});}this.$doBgSwitch(4);this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Over",this.$baseCSSname+"Down"]);};});this.$booleanProperties["default"]=true;this.$supportedProperties.push("icon","value","tooltip","state","color","caption","action","target","default","submenu","hotkye");this.$propHandlers.icon=function(i){if(!this.oIcon){return apf.console.warn("No icon defined in the Button skin","button");}if(i){this.$setStyleClass(this.$ext,this.$baseCSSname+"Icon");}else{this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Icon"]);}apf.skins.setIcon(this.oIcon,i,this.iconPath);};this.$propHandlers.value=function(i){if(!this.state&&!this.submenu){return;}if(i===undefined){i=!this.value;}this.value=i;if(this.value){this.$setState("Down",{});}else{this.$setState("Out",{});}};this.$propHandlers.state=function(i){this.$setStateBehaviour(i==1);};this.$propHandlers.color=function(i){if(this.oCaption){this.oCaption.parentNode.style.color=i;}};this.$propHandlers.caption=function(i){if(!this.oCaption){return;}if(i){this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Empty"]);}else{this.$setStyleClass(this.$ext,this.$baseCSSname+"Empty");}if(this.oCaption.nodeType==1){this.oCaption.innerHTML=String(i||"").trim();}else{this.oCaption.nodeValue=String(i||"").trim();}};this.$propHandlers.hotkey=function(j){if(this.$hotkey){apf.setNodeValue(this.$hotkey,j);}if(this.$lastHotkey){apf.removeHotkey(this.$lastHotkey);}if(j){this.$lastHotkey=j;var i=this;apf.registerHotkey(j,function(){i.$setState("Over",{});$setTimeout(function(){i.$setState("Out",{});},200);if(i.$clickHandler&&i.$clickHandler()){i.$updateState(e||event,"click");}else{i.dispatchEvent("click");}});}};function c(n){return;var i=n.keyCode;var j,k=apf.getChildNumber(this);if(i==37){j=k==0?this.parentNode.childNodes.length-1:k-1;this.parentNode.childNodes[j].dispatchEvent("mouseover");}else{if(i==39){j=(k>=this.parentNode.childNodes.length-1)?0:k+1;this.parentNode.childNodes[j].dispatchEvent("mouseover");}}}function g(i){var j=self[this.submenu];this.value=!this.value;if(this.value){this.$setState("Down",{});}if(!j){throw new Error(apf.formatErrorString(0,this,"Showing submenu","Could not find submenu '"+this.submenu+"'"));}if(!this.value){j.hide();this.$setState("Over",{},"toolbarover");this.parentNode.menuIsPressed=false;if(this.parentNode.hasMoved){this.value=false;}if(apf.hasFocusBug){apf.window.$focusfix();}return false;}this.parentNode.menuIsPressed=this;j.display(null,null,false,this,null,null,this.$ext.offsetWidth-2);this.parentNode.hasMoved=false;i.htmlEvent.cancelBubble=true;return false;}function d(){var j=this.parentNode.menuIsPressed;if(!j||j==this){return;}j.setValue(false);var i=self[j.submenu];i.$propHandlers.visible.call(i,false,true);this.setValue(true);this.parentNode.menuIsPressed=this;var k=self[this.submenu];if(!k){throw new Error(apf.formatErrorString(0,this,"Showing submenu","Could not find submenu '"+this.submenu+"'"));}var n=apf.getAbsolutePosition(this.$ext,k.$ext.offsetParent);k.display(n[0],n[1]+this.$ext.offsetHeight,true,this,null,null,this.$ext.offsetWidth-2);this.$focus();this.parentNode.hasMoved=true;return false;}this.$propHandlers.submenu=function(i){if(!i){if(this.value&&this.parentNode){g.call(this);}this.$focussable=true;this.$setNormalBehaviour();this.removeEventListener("mousedown",g);this.removeEventListener("mouseover",d);this.removeEventListener("keydown",c,true);return;}this.$focussable=false;this.$setStateBehaviour();this.addEventListener("mousedown",g);this.addEventListener("mouseover",d);this.addEventListener("keydown",c,true);};this.setValue=function(i){this.setProperty("value",i,false,true);};this.setCaption=function(i){this.setProperty("caption",i,false,true);};this.setIcon=function(i){this.setProperty("icon",i,false,true);};this.$setStateBehaviour=function(i){this.value=i||false;this.isBoolean=true;this.$setStyleClass(this.$ext,this.$baseCSSname+"Bool");if(this.value){this.$setStyleClass(this.$ext,this.$baseCSSname+"Down");this.$doBgSwitch(this.states.Down);}};this.$setNormalBehaviour=function(){this.value=null;this.isBoolean=false;this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Bool"]);};this.$setState=function(j,n,k){if(k&&this.dispatchEvent(k,{htmlEvent:n})===false){return;}this.$doBgSwitch(this.states[j]);var i=this.$baseCSSname;this.$setStyleClass(this.$ext,(j!="Out"?i+j:""),[(this.value?"":i+"Down"),i+"Over"]);if(this.submenu){i=this.$baseCSSname+"menu";this.$setStyleClass(this.$ext,(j!="Out"?i+j:""),[(this.value?"":i+"Down"),i+"Over"]);}};this.$clickHandler=function(){if(this.isBoolean&&!this.submenu){this.setProperty("value",!this.value);return true;}};this.$submenu=function(i,j){if(i){this.setValue(false);this.$setState("Out",{},"mouseout");this.parentNode.menuIsPressed=false;}};this.$draw=function(){var j,i=(j=this.parentNode).localName=="toolbar"||j.parentNode&&j.parentNode.localName=="toolbar";if(i){if(typeof this.focussable=="undefined"){this.focussable=false;}this.$focussable=apf.KEYBOARD;}this.$ext=this.$getExternal();this.oIcon=this.$getLayoutNode("main","icon",this.$ext);this.oCaption=this.$getLayoutNode("main","caption",this.$ext);this.$useExtraDiv=apf.isTrue(this.$getOption("main","extradiv"));if(!apf.button.$extradiv&&this.$useExtraDiv){(apf.button.$extradiv=document.createElement("div")).className="extradiv";}if(this.localName=="submit"){this.action="submit";}else{if(this.localName=="reset"){this.action="reset";}}this.$setupEvents();};}).call(apf.button.prototype=new apf.BaseButton());apf.submit.prototype=apf.trigger.prototype=apf.reset.prototype=apf.button.prototype;apf.aml.setElement("submit",apf.submit);apf.aml.setElement("trigger",apf.trigger);apf.aml.setElement("reset",apf.reset);apf.aml.setElement("button",apf.button);apf.smartbinding=function(d,c){this.$init(c||"smartbinding",apf.NODE_HIDDEN,d);this.$bindNodes={};};(function(){this.$supportedProperties=["bindings","actions","model"];this.$handlePropSet=function(j,g,d){switch(j){case"model":if(typeof g=="string"){g=apf.nameserver.get("model",g);}this.model=apf.nameserver.register("model",this.name,g);var c;for(var i in this.$bindNodes){c=this.$bindNodes[i];this.model.unregister(c);this.model.register(c,this.$modelXpath[c.getHost?c.getHost().$uniqueId:c.$uniqueId]||this.modelBaseXpath);}break;case"bindings":if(this.$bindings){this.remove(this.$bindings);}this.$bindings=typeof g=="object"?g:apf.nameserver.lookup("bindings",g);this.add(this.$bindings);break;case"actions":if(this.$actions){this.remove(this.$actions);}this.$actions=typeof g=="object"?g:apf.nameserver.lookup("actions",g);this.add(this.$actions);break;}this[j]=g;};this.add=function(d){for(var c in this.$bindNodes){d.register(this.$bindNodes[c]);}this["$"+d.localName]=d;};this.remove=function(d){for(var c in this.$bindNodes){d.unregister(this.$bindNodes[c]);}};this.register=function(c){this.$bindNodes[c.$uniqueId]=c;if(this.$bindings){this.$bindings.register(c);}if(this.$actions){this.$actions.register(c);}if(this.$model){this.$model.register(c);}};this.unregister=function(c){this.$bindNodes[c.$uniqueId]=null;delete this.$bindNodes[c.$uniqueId];if(this.$bindings){this.$bindings.unregister(c);}if(this.$actions){this.$actions.unregister(c);}if(this.$model){this.$model.unregister(c);}};this.load=function(c){new apf.model().register(this).load(c);};this.clear=function(c){};this.addEventListener("DOMNodeInsertedIntoDocument",function(c){if(this.parentNode.hasFeature(apf.__DATABINDING__)){this.register(this.parentNode);}apf.console.info(this.name?"Creating SmartBinding ["+this.name+"]":"Creating implicitly assigned SmartBinding");});}).call(apf.smartbinding.prototype=new apf.AmlElement());apf.aml.setElement("smartbinding",apf.smartbinding);var HAS_CHILD=1<<1,IS_CLOSED=1<<2,IS_LAST=1<<3,IS_ROOT=1<<4;apf.markupedit=function(d,c){this.$init(c||"markupedit",apf.NODE_VISIBLE,d);};(function(){this.implement(apf.DataAction,apf.Rename);this.$isTreeArch=true;this.$focussable=true;this.$preventRecursiveUpdate=true;this.$enableTextNodeHack=true;this.startcollapsed=true;this.$animType=0;this.$animSteps=3;this.$animSpeed=20;this.reselectable=true;this.prerender=false;this.each="node()[local-name(.) and not(@nomk = 'true')]";this.$dynCssClasses=[];this.expandAndSelect=function(w){var u=this;(function t(B){var A=u.getTraverseParent(B);if(A!=u.xmlRoot){t(A);}u.slideToggle(apf.xmldb.getHtmlNode(A,u),1,true);})(w);this.select(w);};this.setAttributeValue=function(u,t,w){if(!u){u=this.caret||this.selected;}if(!u||u.getAttribute(t)==w){return;}this.$executeAction("setAttribute",[u,t,w],"setAttributeValue",u);};this.removeAttribute=function(u,t,w){if(!u){u=this.caret||this.selected;}if(!u||u.getAttribute(t)==w){return;}this.$executeAction("removeAttribute",[u,t],"removeAttribute",u);};this.renameAttribute=function(w,u,t){if(!w){w=this.caret||this.selected;}if(!w||u==t){return;}this.$executeAction("multicall",[{func:"removeAttribute",args:[w,u]},{func:"setAttribute",args:[w,t,w.getAttribute(u)]}],"renameAttribute",w);};this.setTextNode=function(t,u){if(!t){t=this.caret||this.selected;}if(!t||apf.queryValue(t,"text()")==u){return;}this.$executeAction("setTextNode",[t,u],"setTextNode",t);};this.slideToggle=function(B,A,u){if(this.nocollapse){return;}if(!B){B=this.$selected;}var C=B.getAttribute(apf.xmldb.htmlIdTag);while(!C&&B.parentNode){var C=(B=B.parentNode).getAttribute(apf.xmldb.htmlIdTag);}var w,t=this.$getLayoutNode("item","container",B);if(apf.getStyle(t,"display")=="block"){if(A==1){return;}w=this.$getLayoutNode("item","openclose",B);w.className=w.className.replace(/min/,"plus");B.className=B.className.replace(/min/,"plus");this.slideClose(t,apf.xmldb.getNode(B),u);}else{if(A==2){return;}w=this.$getLayoutNode("item","openclose",B);w.className=w.className.replace(/plus/,"min");B.className=B.className.replace(/plus/,"min");this.slideOpen(t,apf.xmldb.getNode(B),u);}};this.isCollapsed=function(t){return(apf.getStyle(this.$getLayoutNode("item","container",apf.xmldb.getHtmlNode(t,this)),"display")=="none");};var g={};this.slideOpen=function(u,B,w){if(!B){B=this.selected;}var C=apf.xmldb.findHtmlNode(B,this);if(!u){u=this.$findContainer(C);}if(!u.innerHTML&&!this.getTraverseNodes(B).length){return;}if(this.singleopen){var A=this.getTraverseParent(B),D=(A||this.xmlRoot).getAttribute(apf.xmldb.xmlIdTag);if(g[D]&&g[D][1]!=B&&this.getTraverseParent(g[D][1])==A){this.slideToggle(g[D][0],2);}g[D]=[C,B];}u.style.display="block";if(!this.prerender&&this.$hasLoadStatus(B,"potential")){this.$extend(B,u,w);return;}if(w){u.style.height="auto";return;}var t=this;apf.tween.single(u,{type:"scrollheight",from:0,to:u.scrollHeight,anim:this.$animType,steps:this.$animOpenStep,interval:this.$animSpeed,onfinish:function(E){if(B&&t.$hasLoadStatus(B,"potential")){$setTimeout(function(){t.$extend(B,E);});E.style.height="auto";}else{E.style.height="auto";}}});};this.slideClose=function(t,u){if(this.nocollapse){return;}if(!u){u=this.selected;}if(this.singleopen){var w=(this.getTraverseParent(u)||this.xmlRoot).getAttribute(apf.xmldb.xmlIdTag);g[w]=null;}t.style.height=t.offsetHeight;t.style.overflow="hidden";apf.tween.single(t,{type:"scrollheight",from:t.scrollHeight,to:0,anim:this.$animType,steps:this.$animCloseStep,interval:this.$animSpeed,onfinish:function(A,B){A.style.display="none";}});};this.doUpdate=function(w,u){var C=this.$getBindRule("insert",w);var B=C&&C[1]?C[1](w):null;if(C&&B){this.$setLoadStatus(w,"loading");if(C.getAttribute("get")){this.getModel().$insertFrom(C.getAttribute("get"),{xmlNode:B,insertPoint:B,amlNode:this});}else{var A=this.$applyBindRule("Insert",w);if(A){this.insert(A,{insertPoint:B});}}}else{if(!this.prerender){this.$setLoadStatus(w,"loading");var t=this.$addNodes(w,u,true);d.call(this,"insert",w,t);}}};var k={};k[0]="";k[HAS_CHILD]="min";k[HAS_CHILD|IS_CLOSED]="plus";k[IS_LAST]="last";k[IS_LAST|HAS_CHILD]="minlast";k[IS_LAST|HAS_CHILD|IS_CLOSED]="pluslast";k[IS_ROOT]="root";this.fixItem=function(H,F,E,G,A){if(!F){return;}if(E){var B;if(B=this.getNextTraverse(H,true)){this.fixItem(B,this.$findHtmlNode(B.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId),null,true);}if(!this.emptyMessage&&H.parentNode.selectNodes(this.each).length==1){this.fixItem(H.parentNode,this.$findHtmlNode(H.parentNode.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId),null,false,true);}}else{var D,u=this.$getLayoutNode("item","container",F);if(A){D=false;}else{if(H.selectNodes(this.each).length>0){D=true;}else{if(this.$getBindRule("insert",H)){D=true;}else{D=false;}}}var w=D&&u.style.display!="block";var C=this.getNextTraverse(H,null,G?2:1)?false:true;var t=(D?HAS_CHILD:0)|(w?IS_CLOSED:0)|(C?IS_LAST:0);this.$setStyleClass(this.$getLayoutNode("item","openclose",F),k[t],["min","plus","last","minlast","pluslast"]);this.$setStyleClass(this.$getLayoutNode("item",null,F),k[t],["min","plus","last","minlast","pluslast"]);if(!D){u.style.display="none";}if(t&HAS_CHILD){}}};this.startRenameThis=function(C,u,B,D){if(this.renaming){this.stopRename(null,true);var t=this;return setTimeout(function(){t.startRenameThis(C,u,B);});}this.$getCaptionElement=function(){return C;};var A=C.getAttribute("aname");var w=D?c[D]:apf.xmldb.getNodeById(u);if(!w){throw new Error();}this.$multiLineRename=D&&w.nodeType!=3?true:false;this.$getCaptionXml=function(){return w.nodeType!=1?w:(A?w.getAttributeNode(A):w.firstChild);};this.getSelectFromRule=function(E,F){return[null,w.nodeType!=1?w:(A?w.getAttributeNode(A):w.firstChild)];};this.$validateRename=function(E){return !B||!E||E.match(/^[a-z]/i);};this.rename=function(E,F){this.$noanim=true;if(A){if(B){if(F==""){this.removeAttribute(w,A);}else{this.renameAttribute(w,A,F);}}else{this.setAttributeValue(w,A,F);}}else{this.setTextNode(w,F);}this.$noanim=false;};this.startRename();if(B){this.$txt[apf.hasContentEditable?"innerHTML":"value"]=A;this.$txt.className="";}else{this.$txt.className="attrvalue";}apf.selectTextHtml(this.$txt);};function s(w,u,C,B,t){this.$getNewContext("attribute");var D=this.$getLayoutNode("attribute","name");var A=this.$getLayoutNode("attribute","value");apf.setNodeValue(D,u);apf.setNodeValue(A,(C.length>50?"...":C));if(C.length>50){A.setAttribute("title",C);}D.setAttribute("aname",u);D.setAttribute("onmousedown","if ((event.which || event.button) == 1)            apf.lookup("+this.$uniqueId+").startRenameThis(this, '"+t+"', true);            event.cancelBubble=true;");D.setAttribute("onmouseup","            event.cancelBubble=true;            return false;");D.setAttribute("onkeydown","if (event.keyCode==13) {              this.blur();              return false;            };            event.cancelBubble=true;");D.setAttribute("onselectstart","event.cancelBubble = true;");D.setAttribute("ondblclick","event.cancelBubble = true;");A.setAttribute("aname",u);A.setAttribute("onmousedown","if ((event.which || event.button) == 1)            apf.lookup("+this.$uniqueId+").startRenameThis(this, '"+t+"');            event.cancelBubble=true;");A.setAttribute("onmouseup","            event.cancelBubble=true;            return false;");A.setAttribute("onkeydown","if (event.keyCode==13) {              this.blur();              return false;            };            event.cancelBubble=true;");A.setAttribute("onselectstart","event.cancelBubble = true;");A.setAttribute("ondblclick","event.cancelBubble = true;");if(w.style){this.$setStyleClass(this.$getLayoutNode("attribute"),"generated");B=apf.insertHtmlNode(this.$getLayoutNode("attribute"),w,this.$getLayoutNode("item","begintag",B).nextSibling);if(!this.$noanim){j(B);j(this.$getLayoutNode("attribute","name",B));j(this.$getLayoutNode("attribute","value",B));}}else{w.appendChild(this.$getLayoutNode("attribute"));}}function n(w,B,u){this.$getNewContext("textnode");var C=this.$getLayoutNode("textnode","text");var t=this.$getLayoutNode("textnode","tag");apf.setNodeValue(C,(B.length>50?"...":B));if(B.length>50){C.setAttribute("title",B);}C.setAttribute("onmousedown","if ((event.which || event.button) == 1)            apf.lookup("+this.$uniqueId+").startRenameThis(this, '"+u+"');");C.setAttribute("onmouseup","            event.cancelBubble=true;            return false;");C.setAttribute("onkeydown","if (event.keyCode==13) {              this.blur();              return false;            };            event.cancelBubble=true;");C.setAttribute("onselectstart","event.cancelBubble = true;");C.setAttribute("ondblclick","event.cancelBubble = true;");apf.setNodeValue(t,"&gt;");if(w.style){var A=apf.insertHtmlNode(this.$getLayoutNode("textnode"),w,w.lastChild);if(!this.$noanim){j(this.$getLayoutNode("textnode","text",A));}}else{w.appendChild(this.$getLayoutNode("textnode"));}}this.$initNode=function(H,t,G){this.$getNewContext("item");var D=(t&HAS_CHILD||this.emptyMessage&&this.$applyBindRule("empty",H));var J=this.$getLayoutNode("item");J.setAttribute(apf.xmldb.htmlIdTag,G);this.$setStyleClass(this.$getLayoutNode("item","openclose"),k[t]);this.$setStyleClass(this.$getLayoutNode("item"),k[t]);var w=this.$getLayoutNode("item","openclose");if(D){w.setAttribute(this.opencloseaction||"onmousedown","var o = apf.lookup("+this.$uniqueId+");                o.slideToggle(this);                apf.cancelBubble(event,o);");}var A=this.$getLayoutNode("item","select");if(D){var I="var o = apf.lookup("+this.$uniqueId+");                o.slideToggle(this, true);";}A.setAttribute("onmousedown","var o = apf.lookup("+this.$uniqueId+");            apf.cancelBubble(event, o);            if (o.hasFocus())                 o.select(this);"+(I&&this.opencloseaction=="onmousedown"?I:""));var M=this.$getLayoutNode("item","begintag");apf.setNodeValue(M,"&lt;"+H.tagName);var u=this.$getLayoutNode("item","attributes");var E=H.attributes.length;if(typeof E=="function"){E=H.attributes.length();}for(var C=0;C<E;C++){var F=H.attributes.item(C);if(F.nodeName.match(/a_id|a_listen|a_doc|a_loaded/)){continue;}s.call(this,u,F.nodeName,F.nodeValue,null,G);}var K=this.$getLayoutNode("item","begintail");var B=this.$getLayoutNode("item","endtag");if(!(t&HAS_CHILD)){B.setAttribute("style","display:none");if(this.$enableTextNodeHack&&(H.childNodes.length>1||H.childNodes.length==1&&H.firstChild.nodeValue.trim())){n.call(this,u,H.childNodes[0].nodeValue,G);apf.setNodeValue(K,"&lt;/"+H.tagName+"&gt;");}else{apf.setNodeValue(K," /&gt;");}}else{apf.setNodeValue(B,"&lt;/"+H.tagName+"&gt;");apf.setNodeValue(K,"&gt;");}K.parentNode.appendChild(K);B.setAttribute("onmousedown","var o = apf.lookup("+this.$uniqueId+");apf.cancelBubble(event, o);");var L=this.$applyBindRule("css",H);if(L){this.$setStyleClass(this.$getLayoutNode("item",null,this.$getLayoutNode("item")),L);if(L){this.$dynCssClasses.push(L);}}return this.$getLayoutNode("item");};this.$deInitNode=function(u,A){var t=this.$getLayoutNode("item","container",A);var w=A.parentNode;t.parentNode.removeChild(t);w.removeChild(A);if(u.parentNode!=this.xmlRoot){this.fixItem(u,A,true);}if(this.emptyMessage&&!w.childNodes.length){this.setEmpty(w);}this.fixItem(u,A,true);if(u==this.selected){this.clearSelection();}};function j(t){if(!t.offsetHeight){return;}apf.setStyleClass(t,"highlight");$setTimeout(function(){apf.setStyleClass(t,"",["highlight"]);},1000);}this.$updateNode=function(t,A){var L,K,D={};var N=this.$getLayoutNode("item","attributes",A);var M=this.$getLayoutNode("item","endtag",A);var O=this.$getLayoutNode("item","begintail",A);L=t.attributes.length;for(var K=0;K<L;K++){var H=t.attributes.item(K);if(H.nodeName.match(/a_id|a_listen|a_doc|a_loaded/)){continue;}D[H.nodeName]=H.nodeValue;}var F=false;var w=[];var G=[],J=N.childNodes;for(K=0;K<J.length;K++){G.push(J[K]);}for(K=0;K<G.length;K++){if(G[K].nodeType!=1){continue;}if(G[K].className.indexOf("textnode")>-1){if(t.childNodes.length==1&&t.childNodes[0].nodeType==3){var I=this.$getLayoutNode("textnode","text",G[K]);if(t.firstChild.nodeValue!=I.innerHTML){I.innerHTML=t.firstChild.nodeValue;j(I);}}else{G[K].parentNode.removeChild(G[K]);apf.setNodeValue(O," /&gt;");}F=true;}if(G[K].className.indexOf("attribute")==-1){continue;}var u=this.$getLayoutNode("attribute","name",G[K]);var E=this.$getLayoutNode("attribute","value",G[K]);var P=u.innerHTML;if(!D[P]){w.push(G[K]);}else{if(D[P]!=E.innerHTML){E.innerHTML=D[P];j(E);delete D[P];}else{if(D[P]){delete D[P];}}}u.setAttribute("aname",P);E.setAttribute("aname",P);}for(var H in D){if(w.length){var C=w.pop();var u=this.$getLayoutNode("attribute","name",C);var E=this.$getLayoutNode("attribute","value",C);u.setAttribute("aname",H);E.setAttribute("aname",H);u.innerHTML=H;E.innerHTML=D[H];j(u);}else{s.call(this,N,H,D[H],A,t.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId);}}for(var K=0;K<w.length;K++){w[K].parentNode.removeChild(w[K]);}if(this.$enableTextNodeHack&&!F&&t.childNodes.length==1&&t.childNodes[0].nodeType==3){n.call(this,N,t.childNodes[0].nodeValue);apf.setNodeValue(O,"</"+t.tagName+">");}var B=this.$applyBindRule("css",t);if(B||this.$dynCssClasses.length){this.$setStyleClass(A,B,this.$dynCssClasses);if(B&&!this.$dynCssClasses.contains(B)){this.$dynCssClasses.push(B);}}};this.clearEmpty=function(t){t.innerHTML="";};this.setEmpty=function(t){this.$getNewContext("empty");var u=this.$getLayoutNode("empty");this.$getLayoutNode("empty","caption").nodeValue=this.emptyMessage;apf.insertHtmlNode(u,t);if(!this.startcollapsed){if(t.style){}}};this.$setLoading=function(u,t){this.$getNewContext("loading");this.$setLoadStatus(u,"potential");apf.insertHtmlNode(this.$getLayoutNode("loading"),t);};this.$removeLoading=function(t){if(!t){return;}this.$getLayoutNode("item","container",t).innerHTML="";};this.$extend=function(w,t,u){var B=this.$getBindRule("insert",w),A=B&&B.match?(B.cmatch||B.compile("match"))(w):w;if(B&&A){this.$setLoadStatus(w,"loading");if(B.get){this.getModel().$insertFrom(B.getAttribute("get"),{xmlNode:A,insertPoint:A,amlNode:this});}else{if(this.$applyBindRule("insert",w)){this.insert(data,{insertPoint:A});}}}else{if(!this.prerender){this.$setLoadStatus(w,"loading");this.$removeLoading(apf.xmldb.findHtmlNode(w,this));this.$noanim=true;d.call(this,{action:"insert",xmlNode:w,result:this.$addNodes(w,t,true),anim:!u});delete this.$noanim;}}};function d(w){if(w.action=="move-away"){this.fixItem(w.xmlNode,apf.xmldb.findHtmlNode(w.xmlNode,this),true);}if(w.action!="insert"){return;}var u=this.$findHtmlNode(w.xmlNode.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId);if(!u){return;}if(this.$hasLoadStatus(w.xmlNode,"loading")&&w.result.length>0){var t=this.$getLayoutNode("item","container",u);this.slideOpen(t,w.xmlNode);}else{this.fixItem(w.xmlNode,u);}if(this.$hasLoadStatus(w.xmlNode,"loading")){this.$setLoadStatus(w.xmlNode,"loaded");}}this.addEventListener("xmlupdate",d);this.addEventListener("beforeload",function(t){this.$enableTextNodeHack=!t.xmlNode.$regbase;this.each=t.xmlNode.$regbase?"node()[not(@nomk = 'true')]":"node()[local-name(.) and not(@nomk = 'true')]";});this.addEventListener("keydown",function(E){var J=E.keyCode;var w=E.ctrlKey;var G=E.shiftKey;var F=this.$caret||this.$selected;if(!F||this.renaming){return;}var H=this.caret||this.selected;var A=this.$ext;switch(J){case 13:if(this.$tempsel){this.$selectTemp();}if(this.ctrlselect=="enter"){this.select(this.caret,true);}this.choose(F);break;case 32:if(w){this.select(this.caret,true);}break;case 46:if(this.$tempsel){this.$selectTemp();}this.remove(this.mode?this.caret:null);break;case 109:case 37:if(this.$tempsel){this.$selectTemp();}if(this.caret.selectSingleNode(this.each)){this.slideToggle(this.$caret||this.$selected,2);}break;case 107:case 39:if(this.$tempsel){this.$selectTemp();}if(this.caret.selectSingleNode(this.each)){this.slideToggle(this.$caret||this.$selected,1);}break;case 187:if(G){arguments.callee(39);}break;case 189:if(!G){arguments.callee(37);}break;case 38:if(!H&&!this.$tempsel){return;}var B=this.$tempsel?apf.xmldb.getNode(this.$tempsel):H;var D=this.getNextTraverse(B,true);if(D){var u=this.getTraverseNodes(D);do{var t=this.$getLayoutNode("item","container",this.$findHtmlNode(apf.xmldb.getID(D,this)));if(t&&apf.getStyle(t,"display")=="block"&&u.length){D=u[u.length-1];}else{break;}}while(D&&(u=this.getTraverseNodes(D)).length);}else{if(this.getTraverseParent(B)==this.xmlRoot){this.dispatchEvent("selecttop");return;}else{D=this.getTraverseParent(B);}}if(D&&D.nodeType==1){this.$setTempSelected(D,w,G);}if(this.$tempsel&&this.$tempsel.offsetTop<A.scrollTop){A.scrollTop=this.$tempsel.offsetTop;}return false;break;case 40:if(!H&&!this.$tempsel){return;}var B=this.$tempsel?apf.xmldb.getNode(this.$tempsel):H;var D=this.getFirstTraverseNode(B);if(D){var t=this.$getLayoutNode("item","container",this.$findHtmlNode(apf.xmldb.getID(B,this)));if(t&&apf.getStyle(t,"display")!="block"){D=null;}}while(!D){var I=this.getTraverseParent(B);if(!I){break;}var C=0;var u=this.getTraverseNodes(I);while(u[C]&&u[C]!=B){C++;}D=u[C+1];B=I;}if(D&&D.nodeType==1){this.$setTempSelected(D,w,G);}if(this.$tempsel&&this.$tempsel.offsetTop+this.$tempsel.offsetHeight>A.scrollTop+A.offsetHeight){A.scrollTop=this.$tempsel.offsetTop-A.offsetHeight+this.$tempsel.offsetHeight+10;}return false;break;case 33:break;case 34:break;case 36:break;case 35:break;}},true);var i=[];this.$add=function(M,F,H,N,I,D){var G=this.$getBindRule("insert",M)?true:false,L=this.getTraverseNodes(M),C=L.length?true:false,E=G||C,A=this.$hasBindRule("collapsed")?(this.$getDataNode("collapsed",M)?true:false):(this.$hasBindRule("expanded")?(this.$getDataNode("expanded",M)?false:true):this.startcollapsed),w=(E?HAS_CHILD:0)|(A&&E||G?IS_CLOSED:0)|(D?IS_LAST:0),K=this.$initNode(M,w,F),u=this.$getLayoutNode("item","container"),B;if(!A&&!this.nocollapse){u.setAttribute("style","overflow:visible;height:auto;display:block;");}if(!E||G){u.setAttribute("style","display:none;");}if(!this.prerender){B=L.length;}if(E&&!this.prerender&&B>0&&A||G&&(!this.$hasLoadStatus(M)||this.$hasLoadStatus(M,"potential"))){this.$setLoading(M,u);}else{if(!C&&(msg=this.$applyBindRule("empty",M))){this.setEmpty(u);}}if(!N&&(H==this.xmlRoot||M==this.xmlRoot)){i.push(K);if(!apf.isChildOf(K,u,true)){i.push(u);}this.$setStyleClass(K,"root");this.$setStyleClass(u,"root");}else{if(!N){N=apf.xmldb.findHtmlNode(M.parentNode,this);N=N?this.$getLayoutNode("item","container",N):this.$container;}if(N==this.$container){this.$setStyleClass(K,"root");this.$setStyleClass(u,"root");if(this.renderRoot){var J=apf.xmldb.findHtmlNode(this.xmlRoot,this);N=this.$getLayoutNode("item","container",J);}}if(!I&&this.getNextTraverse(M)){I=apf.xmldb.findHtmlNode(this.getNextTraverse(M),this);}if(I&&I.parentNode!=N){I=null;}if(N.style&&this.getTraverseNodes(M.parentNode).length==1){this.clearEmpty(N);}if(N.style){var t=apf.insertHtmlNode(K,N,I);if(!this.$noanim){j(this.$getLayoutNode("item","select",t));}if(!apf.isChildOf(K,u,true)){var u=apf.insertHtmlNode(u,N,I);}}else{N.insertBefore(K,I);if(!apf.isChildOf(N,u,true)){N.insertBefore(u,I);}}if(N.style){if(!A&&this.openOnAdd&&N!=this.$container&&N.style.display!="block"){this.slideOpen(N,H);}this.fixItem(H,apf.xmldb.findHtmlNode(H,this));if(this.getNextTraverse(M,true)){this.fixItem(this.getNextTraverse(M,true),apf.xmldb.findHtmlNode(this.getNextTraverse(M,true),this));}}}if(this.prerender||B<1||!A){this.$addNodes(M,u,false);}return u;};this.$fill=function(){var t;apf.insertHtmlNodes(i,t||this.$container);i.length=0;};var q={};q[3]="textnode";q[4]="cdata";q[7]="procinstr";q[8]="comment";var c=[null];this.$addNonElement=function(H,I,w,C,A){if(!H.$regbase){return;}if(w){F=false;}if(F){return;}if(H.nodeType==3){this.$getNewContext("textnode");var u=this.$getLayoutNode("textnode");var t=this.$getLayoutNode("textnode","text");}else{this.$getNewContext("anynode");var u=this.$getLayoutNode("anynode");var B=this.$getLayoutNode("anynode","tagstart");var D=this.$getLayoutNode("anynode","tagend");switch(H.nodeType){case 4:apf.setNodeValue(B,"&lt;![CDATA[");apf.setNodeValue(D,"]]&gt;");break;case 7:apf.setNodeValue(B,"&lt;?"+H.target);apf.setNodeValue(D,"?&gt;");break;case 8:apf.setNodeValue(B,"&lt;!--");apf.setNodeValue(D,"--&gt;");break;default:return;}this.$getLayoutNode("anynode","openclose").setAttribute("onmousedown","var o = this.parentNode;                 apf.setStyleClass(o, o.className.indexOf('open') > -1 ? '' : 'open', ['open']);");var t=this.$getLayoutNode("anynode","text");}var G=H.nodeValue;if(G.trim().indexOf("\n")>-1){G=(H.nodeValue=apf.removeStartWhitespaces(G.replace(/^ *\n/,"").replace(/\n *$/,""))).replace(/</g,"&lt;").replace(/\n/g,"<br />");}else{G=G.trim().replace(/</g,"&lt;");}apf.setNodeValue(t,G);this.$setStyleClass(u,q[H.nodeType],"");var E=H.parentNode.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId;t.setAttribute("onmousedown","apf.lookup("+this.$uniqueId+").startRenameThis(this, '"+E+"', false, "+(c.push(H)-1)+");");t.setAttribute("onmouseup","            event.cancelBubble=true;            return false;");t.setAttribute("onkeydown","if (event.keyCode==13) {              this.blur();              return false;            };            event.cancelBubble=true;");t.setAttribute("onselectstart","event.cancelBubble = true;");t.setAttribute("ondblclick","event.cancelBubble = true;");if(I.style){var F=apf.insertHtmlNode(u,I);}else{I.appendChild(u);}};this.$getParentNode=function(t){return t?this.$getLayoutNode("item","container",t):this.$container;};this.$calcSelectRange=function(u,t){return[u,t];};this.$findContainer=function(t){return this.$getLayoutNode("item","container",t);};this.multiselect=false;this.$selectDefault=function(w){if(this.select(this.getFirstTraverseNode(w),null,null,null,true)){return true;}else{var t=this.getTraverseNodes(w);for(var u=0;u<t.length;u++){if(this.$selectDefault(t[u])){return true;}}}};this.$select=function(t){if(!t||!t.style){return;}this.$setStyleClass(this.$getLayoutNode("item","class",t),"selected");return t;};this.$deselect=function(t){if(!t){return;}this.$setStyleClass(this.$getLayoutNode("item","class",t),"",["selected","indicate"]);return t;};this.$indicate=function(t){if(!t){return;}this.$setStyleClass(this.$getLayoutNode("item","class",t),"indicate");return t;};this.$deindicate=function(t){if(!t){return;}this.$setStyleClass(this.$getLayoutNode("item","class",t),"",["indicate"]);return t;};this.$draw=function(){this.$ext=this.$getExternal();this.$container=this.$getLayoutNode("main","container",this.$ext);this.opencloseaction=this.$getOption("Main","openclose");this.$ext.onclick=function(u){this.host.dispatchEvent("click",{htmlEvent:u||event});};var t=this;this.$ext.onmouseover=function(u){t.dispatchEvent("mouseover",{htmlEvent:u||event});};this.$ext.onmouseout=function(u){t.dispatchEvent("mouseover",{htmlEvent:u||event});};};this.$loadAml=function(t){this.openOnAdd=!apf.isFalse(t.getAttribute("openonadd"));this.startcollapsed=!apf.isFalse(this.getAttribute("startcollapsed")||this.$getOption("Main","startcollapsed"));this.nocollapse=apf.isTrue(this.getAttribute("nocollapse"));if(this.nocollapse){this.startcollapsed=false;}this.singleopen=apf.isTrue(this.getAttribute("singleopen"));};this.$destroy=function(){if(!this.$ext){apf.console.error("destroy is called more than once for markupedit");return;}this.$ext.onclick=null;apf.destroyHtmlNode(this.oDrag);this.oDrag=null;};}).call(apf.markupedit.prototype=new apf.MultiSelect());apf.aml.setElement("markupedit",apf.markupedit);apf.BindingEachRule=function(g,d){this.$init(d,apf.NODE_HIDDEN,g);var c=this;this.$noderegister=function(i){i.amlNode.$handleBindingRule(c.match,"each");i.amlNode.$sort=c.sort?new apf.Sort(c):null;};};(function(){this.$attrExcludePropBind=apf.extend({sort:1,"data-type":1,"date-format":1,"sort-method":1,order:1,"case-order":1},this.$attrExcludePropBind);this.$propHandlers.sort=this.$propHandlers["data-type"]=this.$propHandlers["date-format"]=this.$propHandlers.order=this.$propHandlers["case-order"]=function(d,g){delete this["c"+g];};this.addEventListener("prop.match",function(k){var j=this.parentNode;if(j.localName=="bindings"){var d=j.$amlNodes;for(var g=0;g<d.length;g++){d[g].$handleBindingRule(this.match,"each");}}else{j.$handleBindingRule(this.match,"each");}});var c;this.addEventListener("DOMNodeInserted",c=function(k){if(k.currentTarget!=this){return;}var j=this.parentNode;if(j.localName=="bindings"){j.addEventListener("noderegister",this.$noderegister);var d=j.$amlNodes;for(var g=0;g<d.length;g++){d[g].$handleBindingRule(this.match,"each");d[g].$sort=this.sort?new apf.Sort(this):null;}}else{j.$handleBindingRule(this.match,"each");j.$sort=this.sort?new apf.Sort(this):null;}});this.addEventListener("DOMNodeRemoved",function(k){if(k.currentTarget!=this){return;}var j=this.parentNode;if(j.localName=="bindings"){j.removeEventListener("noderegister",this.$noderegister);var d=j.$amlNodes;for(var g=0;g<d.length;g++){delete d[g].$sort;}}else{delete j.$sort;}});this.addEventListener("DOMNodeInsertedIntoDocument",c);}).call(apf.BindingEachRule.prototype=new apf.BindingRule());apf.aml.setElement("each",apf.BindingEachRule);apf.text=function(d,c){this.$init(c||"text",apf.NODE_VISIBLE,d);};(function(){this.implement(apf.ChildValue);this.$focussable=true;this.focussable=false;this.$allowSelect=true;this.$hasStateMessages=true;this.$textTimer=this.$lastMsg=this.$lastClass=this.$changedHeight=null;this.$booleanProperties.scrolldown=true;this.$booleanProperties.secure=true;this.$supportedProperties.push("behavior","scrolldown","secure","value");this.$propHandlers.behavior=function(c){this.addOnly=c=="addonly";};this.$propHandlers.value=function(d){var c=false;if(typeof d!="string"){d=d?d.toString():"";}if(this.secure){d=d.replace(/<a /gi,"<a target='_blank' ").replace(/<object.*?\/object>/g,"").replace(/<script.*?\/script>/g,"").replace(new RegExp("ondblclick|onclick|onmouseover|onmouseout|onmousedown|onmousemove|onkeypress|onkeydown|onkeyup|onchange|onpropertychange","g"),"ona");}if(this.addOnly){this.$container.insertAdjacentHTML("beforeend",d);}else{d=d.replace(/\<\?xml version="1\.0" encoding="UTF-16"\?\>/,"");this.$container.innerHTML=d;}if(apf.cannotSizeIframe&&this.oIframe){this.oIframe.style.width=this.oIframe.offsetWidth+"px";}if(this.scrolldown&&this.$scrolldown){this.oScroll.scrollTop=this.oScroll.scrollHeight;}};this.$propHandlers["empty-message"]=function(c){if(!this.childNodes.length){this.$setClearMessage(this["empty-message"]);}};this.setValue=function(c){this.setProperty("value",c,false,true);};this.getValue=function(){return this.$container.innerHTML;};this.addEventListener("keydown",function(d){var c=d.keyCode;switch(c){case 33:this.$container.scrollTop-=this.$container.offsetHeight;break;case 34:this.$container.scrollTop+=this.$container.offsetHeight;break;case 35:this.$container.scrollTop=this.$container.scrollHeight;break;case 36:this.$container.scrollTop=0;break;case 38:this.$container.scrollTop-=10;break;case 40:this.$container.scrollTop+=10;break;default:return;}return false;},true);this.$xmlUpdate=function(j,d,i,g){if(this.addOnly&&j!="add"){return;}if(g){g.xmlNode=this.addOnly?d:this.xmlRoot;}if(this.addOnly){apf.xmldb.nodeConnect(this.documentId,d,null,this);var c=this.$findHtmlNode(i.getAttribute("id")+"|"+this.$uniqueId);this.$propHandlers.value.call(this,this.$applyBindRule("value",d)||"");}else{this.$propHandlers.value.call(this,this.$applyBindRule("value",this.xmlRoot)||"");}};this.$load=function(d){apf.xmldb.addNodeListener(d,this);var g=this.$applyBindRule("value",d);if(g||typeof g=="string"){if(this.caching){var c=this.$findHtmlNode(d.getAttribute("id")+"|"+this.$uniqueId);if(c){c.contents=g;}}this.$propHandlers.value.call(this,g);}else{this.$propHandlers.value.call(this,"");}};this.$draw=function(){var c=this;this.$ext=this.$getExternal();this.$container=this.$getLayoutNode("main","container",this.$ext);if(apf.hasCssUpdateScrollbarBug&&!apf.getStyle(this.$container,"padding")){this.$fixScrollBug();}this.oScroll=this.oFocus?this.oFocus.parentNode:this.$container;this.$scrolldown=true;this.oScroll.onscroll=function(){c.$scrolldown=this.scrollTop>=this.scrollHeight-this.offsetHeight+apf.getVerBorders(this);};clearInterval(this.$textTimer);this.$textTimer=setInterval(function(){if(c.oScroll&&c.$scrolldown&&c.scrolldown){c.oScroll.scrollTop=c.oScroll.scrollHeight;}},60);if(this.$container.tagName.toLowerCase()=="iframe"){if(apf.isIE){this.oIframe=this.$container;var g=this.skin.selectSingleNode("iframe_style");this.oIframe.contentWindow.document.write('<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">                    <head>                        <style>'+(g?g.firstChild.nodeValue:"")+"</style>                        <script>                            document.onkeydown = function(e){                                if (!e) e = event;                                if (top.apf.disableF5 && e.keyCode == 116) {                                    e.keyCode = 0;                                    return false;                                }                            }                        <\/script>                    </head>                    <body oncontextmenu='return false'></body>");this.$container=this.oIframe.contentWindow.document.body;}else{var d=document.createElement("div");this.$ext.parentNode.replaceChild(d,this.$ext);d.className=this.$ext.className;this.$ext=this.$container=d;}}};this.addEventListener("DOMNodeRemovedFromDocument",function(){clearInterval(this.$textTimer);apf.destroyHtmlNode(this.oDrag);if(this.oScroll){this.oScroll.onscoll=this.oScroll=null;}this.oDrag=this.oIframe=this.oFocus=null;});}).call(apf.text.prototype=new apf.BaseSimple());apf.aml.setElement("text",apf.text);apf.propedit=function(d,c){this.$init(c||"propedit",apf.NODE_VISIBLE,d);this.$nodes=[];this.$editors={};this.$dynCssClasses=[];};(function(){this.$init(function(){this.addEventListener("keydown",c,true);});this.$focussable=true;this.$isTreeArch=true;this.$isWindowContainer=-1;this.startClosed=true;this.$animType=apf.tween.NORMAL;this.$animSteps=3;this.$animSpeed=20;this.$useiframe=0;this.$attrExcludePropBind=apf.extend({properties:3},this.$attrExcludePropBind);this.$booleanProperties.iframe=true;this.$propHandlers.properties=function(k){if(!k){return this.clear();}var g=this;var j={load:function(n){g.$loadingProps=false;if(typeof n=="string"){n=apf.getXml(n);}g.$properties=n;if(g.xmlRoot){g.load(g.xmlRoot);}},clear:function(){g.$loadingProps=false;},xmlRoot:this.xmlRoot};var i;this.$loadingProps=true;if(typeof k=="string"){if(k.substr(0,1)=="<"){j.load(k);}else{apf.setModel(k,j);}}else{if(k.$isModel){k.register(j);}else{if(this.$properties==k){return;}setTimeout(function(){j.load(k);});}}delete this.$properties;};this.$canLoadData=function(){return this.$headings?true:false;};this.$columns=["50%","50%"];this.$propHandlers.columns=function(g){this.$columns=g&&g.splitSafe(",")||["50%","50%"];if(this.$headings){this.$headings[0].setProperty("width",this.$columns[0]);this.$headings[1].setProperty("width",this.$columns[1]);}};function d(){var g=(this.current||this.$selected),i=this.$body;i.scrollTop=(g.offsetTop)-21;}this.$findHtmlNode=function(g){return this.$pHtmlDoc.getElementById(g);};function c(C){var H=C.keyCode,j=C.ctrlKey,t=C.shiftKey;var g=this.$lastEditor&&this.$lastEditor[2],F=this.$useiframe?this.oDoc.documentElement:this.$body,s,A,n,G,E,u,i;switch(H){case 36:return false;case 35:return false;case 107:break;case 37:this.$slideToggle(this.$selected.firstChild);return false;case 107:case 39:this.$slideToggle(this.$selected.firstChild);return false;case 38:var A=g;var D=g.previousSibling;while(D&&D.nodeType!=1){D=D.previousSibling;}if(D){var k=D,w;while((w=k.selectNodes("prop")).length){k=w[w.length-1];}D=k;}else{D=A.parentNode;if(D[apf.TAGNAME]!="prop"){D=D.previousSibling;while(D&&D.nodeType!=1){D=D.previousSibling;}if(D&&D[apf.TAGNAME]!="prop"){D=(w=D.selectNodes("prop"))[w.length-1];while(D&&D.nodeType!=1){D=D.previousSibling;}}}}if(!D){return;}var B=apf.xmldb.findHtmlNode(D,this);while(!B.offsetWidth){B=apf.xmldb.findHtmlNode(D=D.parentNode,this);}var q=apf.getAbsolutePosition(B,this.$body)[1]-(B.offsetHeight/2);if(q<=this.$ext.scrollTop){this.$ext.scrollTop=q;}this.select(B);return false;case 40:var A,D=(A=g).selectSingleNode("prop")||A.nextSibling;do{while(D&&(D.nodeType!=1||D[apf.TAGNAME]!="prop")){D=D.nextSibling;}if(!D){D=A.parentNode.nextSibling;if(D&&D[apf.TAGNAME]!="prop"){D=D.selectSingleNode("prop");}}}while(D&&D.nodeType!=1);if(!D){return;}var B=apf.xmldb.findHtmlNode(D,this);while(!B.offsetWidth){B=apf.xmldb.findHtmlNode(D=D.parentNode,this);}if(D==A){D=A.nextSibling;while(D&&(D.nodeType!=1||D[apf.TAGNAME]!="prop")){D=D.nextSibling;}var B=apf.xmldb.findHtmlNode(D,this);}var q=apf.getAbsolutePosition(B,this.$body)[1]+(B.offsetHeight/2);if(q>this.$ext.scrollTop+this.$ext.offsetHeight){this.$ext.scrollTop=q-this.$ext.offsetHeight;}this.select(B);return false;}}this.$focus=function(){if(!this.$ext||(apf.isIE&&this.$useiframe&&this.cssfix)){return;}this.$setStyleClass(this.oFocus||this.$ext,this.$baseCSSname+"Focus");if(this.oDoc){this.$setStyleClass(this.oDoc.documentElement,this.$baseCSSname+"Focus");}};this.$blur=function(){if(this.renaming){this.stopRename(null,true);}if(!this.$ext||(apf.isIE&&this.$useiframe&&this.cssfix)){return;}this.$setStyleClass(this.oFocus||this.$ext,"",[this.$baseCSSname+"Focus"]);if(this.oDoc){this.$setStyleClass(this.oDoc.documentElement,"",[this.$baseCSSname+"Focus"]);}};this.$slideToggle=function(g){container=g.parentNode.lastChild;if(apf.getStyle(container,"display")=="block"){g.className=g.className.replace(/min/,"plus");this.$slideClose(container);}else{g.className=g.className.replace(/plus/,"min");this.$slideOpen(container);}};this.$slideOpen=function(g){g.style.display="";apf.tween.single(g,{type:"scrollheight",from:3,diff:-2,to:g.scrollHeight,anim:this.$animType,steps:this.$animSteps,interval:this.$animSpeed,onfinish:function(i){i.style.overflow="visible";i.style.height="auto";}});};this.$slideClose=function(g){g.style.height=g.offsetHeight;g.style.overflow="hidden";apf.tween.single(g,{type:"scrollheight",from:g.scrollHeight,diff:-2,to:0,anim:this.$animType,steps:this.$animSteps,interval:this.$animSpeed,onfinish:function(i,j){i.style.display="none";}});};this.$findContainer=function(i){var g=i.nextSibling;if(!g){return i;}return g.nodeType==1?g:g.nextSibling;};this.addEventListener("bindingsload",this.$loaddatabinding=function(k){var n=k.bindings.properties;if(!n||!n.length){return;}for(var j=0,g=n.length;j<g;j++){}});this.$unloaddatabinding=function(){};this.getColumn=function(g){return this.$headings[g||this.$lastcol||0];};this.resizeColumn=function(j,i){var g=this.$headings[j];g.resize(i);};this.hideColumn=function(i){var g=this.$headings[i];g.hide();};this.showColumn=function(i){var g=this.$headings[i];g.show();};this.$getProperties=function(j){if(this.properties){return this.$properties||false;}else{if(this.$bindings.properties){var k=this.$bindings.properties;for(var g=0;g<k.length;g++){if(!k[g].match){return xx;}}}}return false;};this.$load=function(n){var s=this.$getProperties();if(!s){return false;}var j=[];var k=this.documentId=apf.xmldb.getXmlDocId(s);apf.xmldb.addNodeListener(n,this);var g=this,q=s.ownerDocument;(function i(w,H,D){for(var J,K,I,G,F,E,A,C=0,B=w.length;C<B;C++){A=w[C];g.$getNewContext("row");E=g.$getLayoutNode("row");if(A[apf.TAGNAME]=="group"){g.$getNewContext("cell");apf.setStyleClass(E,"heading");I=E.appendChild(g.$getLayoutNode("cell"));apf.setNodeValue(g.$getLayoutNode("cell","caption",I),(A.getAttribute("caption")||"").trim()||"");F=E.appendChild(q.createElement("blockquote"));i(A.selectNodes("prop"),F,D);E.insertBefore(J=q.createElement("u"),E.firstChild).appendChild(q.createTextNode(" "));J.setAttribute("class","min");}else{apf.xmldb.nodeConnect(k,A,E,g);g.$getNewContext("cell");h=g.$headings[0];I=E.appendChild(g.$setStyleClass(g.$getLayoutNode("cell"),h.$className));apf.setNodeValue(g.$getLayoutNode("cell","caption",I),(A.getAttribute("caption")||"").trim()||"");if(D){I.firstChild.setAttribute("style","padding-left:"+(D*15)+"px");}g.$getNewContext("cell");h=g.$headings[1];I=E.appendChild(g.$setStyleClass(g.$getLayoutNode("cell"),h.$className));apf.setNodeValue(g.$getLayoutNode("cell","caption",I),((apf.lm.compile(A.getAttribute("value"),{nostring:true}))(g.xmlRoot)||"")||"");if((K=A.selectNodes("prop")).length){F=E.appendChild(q.createElement("blockquote"));F.setAttribute("style","display:none;overflow:hidden;height:0;");i(K,g.$getLayoutNode("heading","container",F),D+1);E.insertBefore(J=q.createElement("u"),E.firstChild).appendChild(q.createTextNode(" "));J.setAttribute("class","plus");}}if(!H){j.push(E);}else{H.appendChild(E);}}})(s.selectNodes("group|prop"),null,0);apf.insertHtmlNodes(j,this.$body);this.setProperty("root",this.xmlRoot);var t=s.selectSingleNode(".//prop");if(t){this.select(this.$findHtmlNode(t.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId));}};this.$xmlUpdate=function(s,A,k,u){if(A!=this.xmlRoot){return;}if(u&&this.$lastEditor[0]==u.amlNode){this.$lastEditor[1].firstChild.innerHTML=((apf.lm.compile(this.$lastEditor[2].getAttribute("value"),{nostring:true}))(this.xmlRoot)||"")||"";}else{var j=this.$getProperties();var n,w,g=j.selectNodes(".//prop");for(var t=0,q=g.length;t<q;t++){n=g[t];w=this.$findHtmlNode(n.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId);w.childNodes[w.firstChild.tagName=="U"?2:1].firstChild.innerHTML=((apf.lm.compile(n.getAttribute("value"),{nostring:true}))(this.xmlRoot)||"")||"";}}};this.$hideEditor=function(g){if(this.$lastEditor){this.$lastEditor[0].setProperty("visible",false);if(g){var q=this.$lastEditor[0].$ext.parentNode;q.removeChild(this.$lastEditor[0].$ext);q.removeAttribute("id");delete q.onresize;}var k=this.$lastEditor[1].childNodes;for(var n=0,j=k.length;n<j;n++){if(!k[n].host){k[n].style.display="";}}delete this.$lastEditor;}};this.select=function(F){if(this.$selected==F){return;}if(this.$selected){this.$setStyleClass(this.$selected,"",["selected"]);}this.$setStyleClass(F,"selected");this.$selected=F;this.$hideEditor();var j=apf.xmldb.getNode(F);var B=this;this.setProperty("selected",j);var C=this.$selected.childNodes[this.$selected.firstChild.tagName=="U"?2:1];var E,A=j.getAttribute("editor");var s=apf.lm.compile(A,{xpathmode:2});if(s.type==2){if(!A){if(j.childNodes.length){return;}else{throw new Error("Missing editor attribute on property element: "+j.xml);}}if(!this.$editors[A]){var D=apf.namespaces[apf.ns.aml].elements[A];var n="textarea|textbox|secret".indexOf(A)>-1;var k={htmlNode:C,width:"100%+2",height:19,style:"position:relative;z-index:10000",value:"[{"+this.id+".root}::"+(v=j.getAttribute("value")).substr(1,v.length-2)+"]",focussable:false,realtime:!n};if(n){k.onkeydown=function(i){if(i.keyCode==13){this.change(this.getValue());}};}if(D.prototype.hasFeature(apf.__MULTISELECT__)){k.caption="[text()]";k.eachvalue="[@value]";k.each="item";k.model="{apf.xmldb.getElementById('"+j.getAttribute(apf.xmldb.xmlIdTag)+"')}";}E=this.$editors[A]=new D(k);var w=apf.getBox(apf.getStyle(E.$ext,"margin"));if(w[1]||w[3]){E.setAttribute("width","100%+2-"+(w[1]+w[3]));}else{if(!w[3]){E.$ext.style.marginLeft="-1px";}}E.parentNode=this;E.$focusParent=this;E.setAttribute("focussable","true");E.$parentId=C.getAttribute("id");E.$parentRsz=C.onresize;}else{E=this.$editors[A];if(E.hasFeature(apf.__MULTISELECT__)){E.setAttribute("model","{apf.xmldb.getElementById('"+j.getAttribute(apf.xmldb.xmlIdTag)+"')}");}E.setAttribute("value","[{"+this.id+".root}::"+(v=j.getAttribute("value")).substr(1,v.length-2)+"]");E.setProperty("visible",true);if(E.$ext.parentNode&&E.$ext.parentNode.nodeType==1){if(!E.$parentRsz){E.$parentRsz=E.$ext.parentNode.onresize;}E.$ext.parentNode.removeAttribute("id");delete E.$ext.parentNode.onresize;}C.appendChild(E.$ext);C.setAttribute("id",C.$parentId);if(E.$parentRsz){C.onresize=E.$parentRsz;C.onresize();}}}else{var u=s.call(this,this.xmlRoot);if(u.localName=="template"){}else{}}var g=C.childNodes;for(var t=0,q=g.length;t<q;t++){if(!g[t].host){g[t].style.display="none";}}this.$lastEditor=[E,C,j];};this.addEventListener("$clear",function(g){this.$hideEditor(true);});this.$draw=function(){this.$ext=this.$getExternal();this.$body=this.$getLayoutNode("main","body",this.$ext);this.$head=this.$getLayoutNode("main","head",this.$ext);this.$pointer=this.$getLayoutNode("main","pointer",this.$ext);this.$container=this.$body;if(this.$head.firstChild){this.$head.removeChild(this.$head.firstChild);}if(this.$body.firstChild){this.$body.removeChild(this.$body.firstChild);}var i=this.$widthdiff=this.$getOption("main","widthdiff")||0;this.$defaultwidth=this.$getOption("main","defaultwidth")||"100";this.$useiframe=apf.isIE&&(apf.isTrue(this.$getOption("main","iframe"))||this.iframe);var g=this;if(this.$useiframe&&!this.oIframe){var j=this.$body.className;this.oIframe=this.$body.appendChild(document.createElement(apf.isIE?"<iframe frameborder='0'></iframe>":"iframe"));this.oIframe.frameBorder=0;this.oWin=this.oIframe.contentWindow;this.oDoc=this.oWin.document;this.oDoc.write('<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">                <html xmlns="http://www.w3.org/1999/xhtml">                    <head><script>                        apf = {                            lookup : function(uid){                                return window.parent.apf.lookup(uid);                            },                            Init : {add:function(){},run:function(){}}                        };<\/script>                    </head>                    <body></body>                </html>');this.$body=this.oDoc.body;this.$body.className=j;this.oDoc.documentElement.className=this.$ext.className;apf.skins.loadCssInWindow(this.skinName,this.oWin,this.mediaPath,this.iconPath);if(apf.isIE){this.$setStyleClass(this.oDoc.documentElement,this.$baseCSSname+"Focus");}apf.convertIframe(this.oIframe,true);if(apf.getStyle(this.oDoc.documentElement,apf.isIE?"overflowY":"overflow-y")=="auto"){this.oIframe.onresize=function(){g.$head.style.marginRight=g.oDoc.documentElement.scrollHeight>g.oDoc.documentElement.offsetHeight?"16px":"0";};this.addEventListener("afterload",this.oIframe.onresize);this.addEventListener("xmlupdate",this.oIframe.onresize);}this.oDoc.documentElement.onmousedown=function(k){if(!k){k=g.oWin.event;}if((k.srcElement||k.target).tagName=="HTML"){apf.popup.forceHide();}};this.oDoc.documentElement.onscroll=function(){if(g.$isFixedGrid){g.$head.scrollLeft=g.oDoc.documentElement.scrollLeft;}};}else{if(apf.getStyle(this.$body,apf.isIE?"overflowY":"overflow-y")=="auto"){this.$resize=function(){g.$head.style.marginRight=g.$body.scrollHeight>g.$body.offsetHeight?"16px":"0";};apf.layout.setRules(this.$ext,this.$uniqueId+"_datagrid","var o = apf.all["+this.$uniqueId+"];                     if (o) o.$resize()");apf.layout.queue(this.$ext);this.addEventListener("afterload",this.$resize);this.addEventListener("xmlupdate",this.$resize);}this.$body.onmousedown=function(k){if(!k){k=event;}if((k.srcElement||k.target)==this){apf.popup.forceHide();}};this.$body.onscroll=function(){if(g.$isFixedGrid){g.$head.scrollLeft=g.$body.scrollLeft;}};}var g=this;this.$body.onmousedown=function(n){if(!n){n=event;}var k=n.srcElement||n.target;if(k==this){return;}if(k.tagName=="U"){g.$slideToggle(k);return;}while(k.host||(k.getAttribute(apf.xmldb.htmlIdTag)||"").indexOf("|")==-1){k=k.parentNode;if(k==this){return;}}g.select(k);};};this.$loadAml=function(g){this.$headings=[new apf.BindingColumnRule().$draw(this,"Property",this.$columns[0],"first"),new apf.BindingColumnRule().$draw(this,"Value",this.$columns[1])];};this.$destroy=function(){apf.popup.removeContent(this.$uniqueId);for(var g in this.$editors){this.$editors[g].destroy();}this.$ext.onclick=this.$body.onresize=null;apf.layout.removeRule(this.$body,"dg"+this.$uniqueId);apf.layout.activateRules(this.$body);};}).call(apf.propedit.prototype=new apf.DataBinding());apf.aml.setElement("propedit",apf.propedit);apf.aml.setElement("column",apf.BindingColumnRule);apf.aml.setElement("description",apf.BindingRule);apf.aml.setElement("color",apf.BindingRule);apf.checkbox=function(d,c){this.$init(c||"checkbox",apf.NODE_VISIBLE,d);};(function(){this.implement(apf.DataAction);this.$notfromext=true;this.$focussable=true;this.checked=false;this.$values=[1,0];this.$booleanProperties.checked=true;this.$supportedProperties.push("value","checked","label","values");this.$propHandlers.value=function(c){c=(typeof c=="string"?c.trim():c);this.checked=(typeof c!="undefined"&&c!==null&&c.toString()==this.$values[0].toString());if(this.checked){apf.setStyleClass(this.$ext,this.$baseCSSname+"Checked");}else{apf.setStyleClass(this.$ext,"",[this.$baseCSSname+"Checked"]);}};this.$propHandlers.checked=function(c){if(!this.$values){if(this.getAttribute("values")){this.$propHandler.values.call(this,this.getAttribute("values"));}else{this.$values=[false,true];}}this.setProperty("value",this.$values[c?0:1]);};this.$propHandlers.label=function(d){if(!this.$ext){return;}var c=this.$getLayoutNode("main","label",this.$ext);if(c.nodeType==1){c.innerHTML=d;}else{c.nodeValue=d;}};this.$propHandlers.values=function(c){this.$values=typeof c=="string"?c.split("|"):(c||[1,0]);};this.setValue=function(c){if(!this.$values){return;}this.setProperty("value",c,false,true);};this.getValue=function(){return this.xmlRoot?this.$values[this.checked?0:1]:this.value;};this.check=function(){this.setProperty("value",this.$values[0],false,true);};this.uncheck=function(){this.setProperty("value",this.$values[1],false,true);};this.addEventListener("$clear",function(){this.setProperty("value",this.$values[1]);});this.$enable=function(){if(this.$input){this.$input.disabled=false;}this.$doBgSwitch(1);};this.$disable=function(){if(this.$input){this.$input.disabled=true;}this.$doBgSwitch(4);};this.$setState=function(c,g,d){this.$doBgSwitch(this.states[c]);this.$setStyleClass(this.$ext,(c!="Out"?this.$baseCSSname+c:""),[this.$baseCSSname+"Down",this.$baseCSSname+"Over"]);this.state=c;if(d){this.dispatchEvent(d,g);}};this.$clickHandler=function(){this.change(this.$values[(!this.checked)?0:1]);if(this.validate){this.validate(true);}return true;};this.$draw=function(){this.$ext=this.$getExternal();this.$input=this.$getLayoutNode("main","input",this.$ext);this.$setupEvents();};this.$childProperty="label";}).call(apf.checkbox.prototype=new apf.BaseButton());apf.aml.setElement("checkbox",apf.checkbox);apf.application=function(){this.$init("application",apf.NODE_HIDDEN);if(!apf.isO3){this.$int=document.body;this.$tabList=[];this.$focussable=apf.KEYBOARD;this.focussable=true;this.visible=true;this.$isWindowContainer=true;this.focus=function(){this.dispatchEvent("focus");};this.blur=function(){this.dispatchEvent("blur");};apf.window.$addFocus(this);}};apf.application.prototype=new apf.AmlElement();apf.aml.setElement("application",apf.application);apf.loader=function(){this.$init("loader",apf.NODE_HIDDEN);this.show=function(){this.$ext.style.display="block";};this.hide=function(){this.$ext.style.display="none";};this.addEventListener("DOMNodeInsertedIntoDocument",function(d){var g;if(!(g=this.parentNode.$int)){return;}this.$ext=apf.insertHtmlNode(null,g,null,this.$aml?(this.$aml.serialize?this.$aml.serialize():this.$aml.xml):this.serialize());if(!apf.loaded){var c=this;apf.addEventListener("load",function(){if(apf.config.autoHideLoading){apf.queue.empty();c.hide();}});}});};apf.loader.prototype=new apf.AmlElement();apf.aml.setElement("loader",apf.loader);apf.AmlConfig=function(){this.$init("config",apf.NODE_VISIBLE);};(function(){this.focussable=false;this.$canLeechSkin=true;this.$draw=function(){this.$ext=this.$int=this.$getExternal(this.$isLeechingSkin?this.localName:"main");};}).call(apf.AmlConfig.prototype=new apf.Presentation());apf.aml.setElement("config",apf.AmlConfig);apf.bindings=function(d,c){this.$init(c||"bindings",apf.NODE_HIDDEN,d);this.$bindings=new apf.ruleList();this.$amlNodes={};};(function(){this.$smartbinding=null;this.register=function(c){if(c.localName=="smartbinding"){this.$smartbinding=c;this.$smartbinding.add(this);return;}if(!c.hasFeature(apf.__DATABINDING__)){return;}this.$amlNodes[c.$uniqueId]=c;if(!this.$amlLoaded){return;}if(!this.$bindings.$isCompiled){this.$cbindings=this.$bindings.compile();}c.$bindings=this.$bindings;c.$cbindings=this.$cbindings;c.dispatchEvent("bindingsload",{bindings:this.$bindings,compiled:this.$cbindings});this.dispatchEvent("noderegister",{amlNode:c});c.$checkLoadQueue();};this.unregister=function(){this.$amlNodes[this.amlNode.$uniqueId]=null;delete this.$amlNodes[this.amlNode.$uniqueId];this.amlNode.$bindings=this.amlNode.$cbindings=false;this.amlNode.dispatchEvent("bindingsunload",{bindings:this.$bindings,compiled:this.$cbindings});};this.reload=function(){for(var c in this.$amlNodes){this.$amlNodes[c].reload();}};this.addEventListener("DOMNodeInsertedIntoDocument",function(k){var d=this.childNodes;for(var j,g=0,c=d.length;g<c;g++){if(!(j=d[g]).$amlLoaded&&j.nodeType==1){j.dispatchEvent("DOMNodeInsertedIntoDocument");}}this.register(this.parentNode);for(var n in this.$amlNodes){this.register(this.$amlNodes[n]);}});}).call(apf.bindings.prototype=new apf.AmlElement());apf.ruleList=function(){this.$compiled={};};apf.ruleList.prototype={$isCompiled:false,getRule:function(d,j){var q=this[d];if(!q){return false;}for(var k,n,g=0,c=q.length;g<c;g++){n=q[g];if(!n.match){return n;}k=n.cmatch||n.compile("match",{injectself:true,xpathmode:2});if(k&&k(j)){return n;}}},compile:function(g){var t,k,u=this.$compiled,n=false;if(g){k=[];t=this[g];for(var q,j=0,d=t.length;j<d;j++){if(!(q=t[j]).match&&!q.value){continue;}k.push(q.match,q.value);if(!n&&q.value){n=q.value.indexOf("<a:")>-1;}}u[g]=apf.lm.compileMatch(k);u[g].hasAml=n;return u;}for(g in this){if(g=="each"){continue;}t=this[g];if(t.dataType!=apf.ARRAY){continue;}k=[],n=false;for(var q,j=0,d=t.length;j<d;j++){if(!(q=t[j]).match&&!q.value){continue;}k.push(q.match,q.value);if(!n&&q.value){n=q.value.indexOf("<a:")>-1;}}u[g]=apf.lm.compileMatch(k);u[g].hasAml=n;}this.$isCompiled=true;return u;},getRuleIndex:function(d,c){var g=this[d][c];if(g.value){if(!g.cvalue){g.compile("value");}}else{if(g.match){if(!g.cmatch){g.compile("match");}}}return g;},getDataNode:function(c,t,s,k,w){var n,j,g,d,q,u=this[c];if(!u){return;}for(q,n=0,j=u.length;n<j;n++){q=u[n];g=q.cvaluematch;if(!g){if(q.match&&q.value){q.valuematch="{_n = "+q.match+"; %[child::"+q.value.substr(1,q.value.length-2).split("|").join("|child::")+"]}";}else{q.valuematch=q.match||q.value;}g=q.$compile("valuematch",{xpathmode:w?4:3,injectself:q.match?true:false});}if(g&&(d=g(t,s))){if(k){k.push(q);}return d;}}return false;}};apf.aml.setElement("bindings",apf.bindings);apf.appsettings=function(d,c){this.$init(c||"appsettings",apf.NODE_HIDDEN,d);};(function(){this.$parsePrio="001";this.$attrExcludePropBind={language:1,login:1,logout:1,layout:1};this.$supportedProperties=["debug","name","baseurl","resource-path","disable-right-click","allow-select","allow-blur","auto-disable-actions","auto-disable","disable-f5","auto-hide-loading","disable-space","disable-backspace","undokeys","initdelay","default-page","query-append","outline","drag-outline","resize-outline","resize-outline","iepngfix","iepngfix-elements","iphone-fullscreen","iphone-statusbar","iphone-icon","iphone-icon-is-glossy","iphone-fixed-viewport","layout","skinset","language","storage","offline","login"];this.$booleanProperties={debug:1,"disable-right-click":1,"allow-select":1,"allow-blur":1,"auto-disable-actions":1,"auto-disable":1,"disable-f5":1,"auto-hide-loading":1,"disable-space":1,"disable-backspace":1,undokeys:1,initdelay:1,outline:1,iepngfix:1,"iphone-fullscreen":1,"iphone-icon-is-glossy":1,"iphone-fixed-viewport":1};this.$handlePropSet=function(g,d,c){if(this.$booleanProperties[g]){d=apf.isTrue(d);}this[g]=d;apf.config.setProperty(g,d);};this.addEventListener("DOMNodeInsertedIntoDocument",function(c){if(apf.isIphone&&apf.runIphone){apf.runIphone();delete apf.runIphone;}});}).call(apf.appsettings.prototype=new apf.AmlElement());apf.aml.setElement("appsettings",apf.appsettings);apf.BindingColorRule=function(d,c){this.$init(c,apf.NODE_HIDDEN,d);};(function(){this.addEventListener("DOMNodeInsertedIntoDocument",function(d){if(this.$bindings&&this.$bindings.color){var c=this.$bindings.color[0];apf.setStyleRule("."+this.$baseCSSname+(apf.isIE?" .records .highlight SPAN":" .records .highlight span"),"color",c.getAttribute("text"),null,this.oWin);apf.setStyleRule("."+this.$baseCSSname+(apf.isIE?" .records .highlight SPAN":" .records .highlight span"),"backgroundColor",c.getAttribute("row"),null,this.oWin);apf.setStyleRule("."+this.$baseCSSname+(apf.isIE?" .records .highlight":" .records .highlight"),"backgroundColor",c.getAttribute("row"),null,this.oWin);}apf.importStylesheet([["."+this.className,"width:"+this.$width+(this.$isPercentage?"%;":"px;")+"text-align:"+h.align],["."+this.className,"width:"+this.$width+(this.$isPercentage?"%;":"px;")+"text-align:"+h.align]]);this.$draw();});}).call(apf.BindingColorRule.prototype=new apf.BindingRule());apf.aml.setElement("color",apf.BindingColorRule);apf.rpc=function(d,c){this.$init(c||"rpc",apf.NODE_HIDDEN,d);if(!this.supportMulticall){this.multicall=false;}this.stack={};this.urls={};this.$methods={};};(function(){this.useHTTP=true;this.namedArguments=false;this["route-server"]=apf.host+"/cgi-bin/rpcproxy.cgi";this.autoroute=false;this.$auth=false;this.$booleanProperties.multicall=true;this.$supportedProperties.push("protocol","type","multicall","http-method");this.$propHandlers["route-server"]=function(d){this.autoroute=d?true:false;};this.$propHandlers.protocol=function(d){if(!d){return;}if(!apf[d]){throw new Error(apf.formatErrorString(1025,null,"Teleport baseclass","Could not find Ajax.org Teleport RPC Component '"+d+"'",this));return;}this.implement(apf[d]);};this.$propHandlers.type=function(d){this.$useXml=(typeof d=="string"&&d.toUpperCase()=="XML");};this.setCallback=function(d,g){if(!this.$methods[d]){throw new Error(apf.formatErrorString(0,this,"Teleport RPC","Trying to set callback: method not found."));}this.$methods[d].callback=g;};this.setUrl=function(g,d){if(!this.$methods[g]){throw new Error(apf.formatErrorString(0,this,"Teleport RPC","Trying to set callback: method not found."));}this.$methods[g].setProperty("url",d);};this.$convertArgs=function(s,q){if(!this.namedArguments){return Array.prototype.slice.call(q);}var k=this.$methods[s].names;if(!k||!k.length){return{};}var u,n,t,g,d={};for(n=0,t=0,g=k.length;t<g;t++){s=k[t].name;u=k[t].value;if(u){u=apf.parseExpression(u);}else{u=q[n++];if(apf.isNot(u)&&k[t]["default"]){u=apf.parseExpression(k[t]["default"]);}}u=apf.isTrue(k[t].encoded)?encodeURIComponent(u):u;d[s]=u;}return d;};function c(d){var i,g;if(typeof d.callback=="string"){i=d.callback.split("."),g=self[i.shift()];while(g&&i.length){g=g[i.shift()];}}else{g=d.callback;}return g||apf.K;}this.call=function(g,s,w){var u,n=this.$methods[g];if(typeof s[s.length-1]=="function"){s=Array.prototype.slice.call(s);u=s.pop();}else{u=c(n);}s=this.$convertArgs(g,s);if(this.multicall){if(!this.stack[this.url]){this.stack[this.url]=this.getMulticallObject?this.getMulticallObject():[];}this.getSingleCall(g,s,this.stack[this.url]);return true;}var t=this,q=w.message||this.createMessage(n["method-name"]||g,s);function j(C,B,A){A.data=C;if(B!=apf.SUCCESS){u.call(t,null,B,A);}else{if(t.isValid&&!t.isValid(A)){u.call(t,null,apf.ERROR,A);}else{u.call(t,t.unserialize(A.data),B,A);}}}var k,d=apf.getAbsolutePath(this.baseurl||apf.config.baseurl,this.url),i=apf.extend({callback:j,async:n.async,userdata:n.userdata,nocache:(this.nocache===false)?false:true,data:q,useXML:this.$useXml||n.type=="xml",caching:n.caching,ignoreOffline:n["ignore-offline"]},w);return this.$get(d,i);};this.purge=function(t,s,j,u){if(!this.stack[this.url]||!this.stack[this.url].length){throw new Error(apf.formatErrorString(0,null,"Executing a multicall","No RPC calls where executed before calling purge()."));}var k=this.createMessage("multicall",[this.stack[this.url]]),d=apf.getAbsolutePath(this.baseurl||apf.config.baseurl,this.url);if(u){for(var q=[],n=0;n<u.length;n++){q.push(encodeURIComponent(u[n][0])+"="+encodeURIComponent(u[n][1]||""));}d=d+(d.match(/\?/)?"&":"?")+q.join("&");}var g=this.$get(d,{callback:t,async:j,userdata:s,nocache:true,data:k,useXML:this.$useXml});this.stack[this.url]=this.getMulticallObject?this.getMulticallObject():[];};this.revert=function(d){this.stack[d.url]=this.getMulticallObject?this.getMulticallObject():[];};this.getStackLength=function(){return this.stack[this.url]?this.stack[this.url].length:0;};this.$addMethod=function(n){if(n.localName!="method"){throw new Error(apf.formatErrorString(0,this,"Parsing RPC Teleport node","Found element which is not a method",this));return false;}var j=n.name,d=n.receive||this.receive,k=0,g=n.childNodes.length,q;this[j]=function(){return this.call(j,arguments);};if(d){n.callback=d;}this.$methods[j]=n;if(!n.names){n.names=[];}for(;k<g;k++){q=n.childNodes[k];if(q.localName=="param"||q.localName=="variable"){n.names.push(q);}}return true;};this.$removeMethod=function(g){var d=g.name;delete this[d];delete this.$methods[d];};this.$setAuth=function(d){this.$auth=d;};this.exec=function(n,i,k,g){if(!g){g={};}if(g.multicall){this.forceMulticall=true;}if(!this[n]){throw new Error(apf.formatErrorString(0,null,"Saving/Loading data","Could not find RPC function by name '"+n+"' in data instruction '"+g.instruction+"'"));}var j=this.$methods[n];if(g.userdata){j.userdata=g.userdata;}if(!this.multicall){j.callback=k;}var d=this.call(n,i,g);if(this.multicall){return this.purge(k,"&@^%!@");}else{if(g.multicall){this.forceMulticall=false;return this;}}if(!this.multicall&&!j.async&&k){k(d,apf.SUCCESS,{tpModule:this});}};}).call(apf.rpc.prototype=new apf.Teleport());apf.config.$inheritProperties.baseurl=1;apf.aml.setElement("rpc",apf.rpc);apf.method=function(d,c){this.$init(c||"method",apf.NODE_HIDDEN,d);this.async=true;this.caching=false;this["ignore-offline"]=false;};(function(){this.$parsePrio="002";this.$booleanProperties.async=true;this.$booleanProperties.caching=true;this.$booleanProperties["ignore-offline"]=true;this.$supportedProperties.push("name","receive","async","caching","ignore-offline","method-name","type","url");this.$propHandlers["ignore-offline"]=function(c){this.ignoreOffline=c;};this.$propHandlers["method-name"]=function(c){this.methodName=c;};this.addEventListener("DOMNodeInserted",function(c){if(this.parentNode.$addMethod&&c.currentTarget==this){this.parentNode.$addMethod(this);}});this.addEventListener("DOMNodeRemoved",function(c){if(this.parentNode.$removeMethod&&c.currentTarget==this){this.parentNode.$removeMethod(this);}});this.addEventListener("DOMNodeInsertedIntoDocument",function(c){if(this.parentNode.$addMethod){this.parentNode.$addMethod(this);}});}).call(apf.method.prototype=new apf.AmlElement());apf.aml.setElement("method",apf.method);apf.cgi=function(){this.supportMulticall=false;this.namedArguments=true;this.unserialize=function(c){return c;};this.getSingleCall=function(d,c,g){g.push(c);};this.createMessage=function(j,c){var n,k=[];function g(w,i){if(w&&w.dataType==apf.ARRAY){for(var q=0;q<w.length;q++){g(w[q],i+"%5B"+q+"%5D");}}else{if(typeof w=="object"){if(w.nodeType){try{var t=w.outerHTML||w.serialize&&w.serialize()||apf.getCleanCopy(w).xml;}catch(u){var t="Could not serialize object";}k.push(i+"="+encodeURIComponent(t));}else{for(n in w){if(typeof w[n]=="function"){continue;}g(w[n],i+"%5B"+encodeURIComponent(n)+"%5D");}}}else{if(typeof w!="undefined"&&w!==null){k.push(i+"="+encodeURIComponent(w));}}}}if(this.multicall){k.push("func="+this.mcallname);for(var d=0;d<c[0].length;d++){g(c[0][d],"f%5B"+d+"%5D");}}else{for(n in c){g(c[n],n);}}if(!this.baseUrl){this.baseUrl=this.url;}this.url=this.$methods[j].url?this.$methods[j].url:this.baseUrl;if(this.method!="GET"){return k.join("&");}this.url=this.url+(k.length?(this.url.indexOf("?")>-1?"&":"?")+k.join("&"):"");return"";};this.addEventListener("DOMNodeInsertedIntoDocument",function(){this.method=(this["http-method"]||"GET").toUpperCase();this.contentType=this.method=="GET"?null:"application/x-www-form-urlencoded";});this.submitForm=function(n,s){if(!this["postform"]){this.addMethod("postform",s);}var g=[];for(var k=0,c=n.elements.length;k<c;k++){if(!n.elements[k].name){continue;}if(n.elements[k].tagname=="input"&&(n.elements[k].type=="checkbox"||n.elements[k].type=="radio")&&!n.elements[k].checked){continue;}if(n.elements[k].tagname="select"&&n.elements[k].multiple){for(var d=0;d<n.elements[k].options.length;d++){if(n.elements[k].options[d].selected){g.push(n.elements[k].name+"="+encodeURIComponent(n.elements[k].options[d].value));}}}else{g.push(n.elements[k].name+"="+encodeURIComponent(n.elements[k].value));}}var q=(n.action||location.href);this.urls.postform=q+(q.indexOf("?")>-1?"&":"?")+g.join("&");this["postform"].call(this);return false;};};apf.UndoData=function(i,d){this.localName="UndoData";this.extra={};apf.extend(this,i);if(d){this.at=d;}else{if(i&&i.tagName=="UndoData"){this.args=i.args.slice();}else{this.selNode=this.selNode||(this.action=="removeNode"?this.args[0]:(this.amlNode?this.amlNode.selected:null));}}var g,c=this;this.saveChange=function(k,j,s){if(this.action=="group"){var q=this.args[1];j.$addToQueue(q,k,true);return j.$queueNext(this);}var n;if(this.xmlActionNode){n=this.xmlActionNode.getAttribute(k?"undo":"set");if(k&&!n){n=this.xmlActionNode.getAttribute("set");}}if(!n){return j.$queueNext(this);}this.state=k?"restoring":"saving";if(!g.asyncs){return j.$receive(null,apf.SUCCESS,{amlNode:this.amlNode},this,s);}g.ignoreOffline=true;apf.saveData(n,g);};this.preparse=function(k,j,n){var q;if(this.xmlActionNode){q=this.xmlActionNode.getAttribute(k?"undo":"set");if(k&&!q){q=this.xmlActionNode.getAttribute("set");}}if(!q){return this;}g=apf.extend({xmlNode:this.action=="multicall"?this.args[0].xmlNode:this.selNode||this.xmlNode,userdata:apf.isTrue(this.xmlActionNode.getAttribute("ignore-fail")),multicall:n,undo:k,precall:true,callback:function(u,t,s){if(g.asyncs){s.amlNode=c.amlNode;return j.$receive(u,t,s,c,callback);}}},this.extra);apf.saveData(q,g);return this;};};apf.actiontracker.actions={setTextNode:function(g,c){var d=g.args;if(!c){apf.xmldb.setTextNode(d[0],d[1],d[2],g);}else{apf.xmldb.setTextNode(d[0],g.extra.oldValue,d[2]);}},setAttribute:function(g,c){var d=g.args;if(!c){g.extra.name=d[1];g.extra.oldValue=d[0].getAttribute(d[1]);apf.xmldb.setAttribute(d[0],d[1],d[2],d[3],g);}else{if(!g.extra.oldValue){apf.xmldb.removeAttribute(d[0],d[1]);}else{apf.xmldb.setAttribute(d[0],d[1],g.extra.oldValue,d[3]);}}},removeAttribute:function(g,c){var d=g.args;if(!c){g.extra.name=d[1];g.extra.oldValue=d[0].getAttribute(d[1]);apf.xmldb.removeAttribute(d[0],d[1],d[2],g);}else{apf.xmldb.setAttribute(d[0],d[1],g.extra.oldValue,d[2]);}},replaceNode:function(g,c){var d=g.args;if(!c){apf.xmldb.replaceNode(d[1],d[0],d[2],g);}else{apf.xmldb.replaceNode(d[0],d[1],d[2],g);}},addChildNode:function(g,c){var d=g.args;if(!c){apf.xmldb.addChildNode(d[0],d[1],d[2],d[3],g);}else{apf.xmldb.removeNode(g.extra.addedNode);}},appendChild:function(g,c){var d=g.args;if(!c){apf.xmldb.appendChild(d[0],d[1],d[2],d[3],d[4],g);}else{apf.xmldb.removeNode(g.xmlNode);}},moveNode:function(g,c){var d=g.args;if(!c){apf.xmldb.moveNode(d[0],d[1],d[2],d[3],g);}else{apf.xmldb.moveNode(g.extra.oldParent,d[1],g.extra.beforeNode,d[3]);}},removeNode:function(g,c){var d=g.args;if(!c){apf.xmldb.removeNode(d[0],d[1],g);}else{apf.xmldb.appendChild(g.extra.parent,g.extra.removedNode,g.extra.beforeNode);}},removeNodeList:function(j,c){if(c){var k=j.extra.removeList;for(var g=k.length-1;g>=0;g--){apf.xmldb.appendChild(k[g].pNode,k[g].removedNode,k[g].beforeNode);}}else{apf.xmldb.removeNodeList(j.args,j);}},group:function(i,g,c){if(!i.$undostack){var d=i.args[0];i.$undostack=d;i.$redostack=[];}c[g?"undo":"redo"](i.$undostack.length,false,i.$undostack,i.$redostack);},setValueByXpath:function(i,c){var g=i.args;if(!c){if(i.extra.newNode){apf.xmldb.appendChild(i.extra.parentNode,i.extra.newNode);}else{var d=[];apf.setNodeValue(g[0],g[1],true,{undoObj:i,xpath:g[2],newNodes:d,forceNew:g[3]});i.extra.newNode=d[0];}}else{if(i.extra.newNode){i.extra.parentNode=i.extra.newNode.parentNode;apf.xmldb.removeNode(i.extra.newNode);}else{apf.setNodeValue(i.extra.appliedNode,i.extra.oldValue,true);}}},multicall:function(n,d,c){var k=n.args;var j=apf.xmldb.delayUpdate;apf.xmldb.delayUpdate=true;if(!d){for(var g=0;g<k.length;g++){if(!k[g].extra){k[g].extra={};}apf.actiontracker.actions[k[g].action](k[g],false,c);}}else{for(var g=k.length-1;g>=0;g--){apf.actiontracker.actions[k[g].action](k[g],true,c);}}apf.xmldb.delayUpdate=j;}};apf.LiveMarkupPi=function(){this.$init();};(function(){this.mainBind="data";this.implement(apf.StandardBinding);this.getDocument=function(){return this.$data&&this.$data.ownerDocument;};this.clear=function(c){if(c=="loading"&&apf.getInheritedAttribute(this,"loading-message")){this.$propHandlers.calcdata.call(this,"<span class='loading'>Loading...</span>");this.calcdata="";}};this.$propHandlers.calcdata=function(g){if(this.$data){var c=this.$data.childNodes;for(var d=c.length-1;d>=0;d--){c[d].destroy(true);}}if(typeof g=="string"&&g.indexOf("<a:")>-1){this.$ext.innerHTML="";this.$data=this.ownerDocument.$domParser.parseFromString("<a:application xmlns:a='"+apf.ns.apf+"'>"+g+"</a:application>","text/xml",{htmlNode:this.$ext}).documentElement;}else{if(this.$data){var c=this.$data.childNodes;for(var d=0;d<c.length;d++){c[d].destroy(true);}}this.$ext.innerHTML=g||"";}};}).call(apf.LiveMarkupPi.prototype=new apf.AmlProcessingInstruction(true));apf.aml.setProcessingInstruction("lm",apf.LiveMarkupPi);apf.aml.setProcessingInstruction("lm-debug",apf.LiveMarkupPi);apf.aml.setProcessingInstruction("livemarkup",apf.LiveMarkupPi);apf.LiveTextPi=function(){this.$init();};(function(){this.mainBind="data";this.implement(apf.StandardBinding);this.$propHandlers.calcdata=function(c){this.$ext.innerHTML=c&&apf.htmlentities(c)||"";};}).call(apf.LiveTextPi.prototype=new apf.AmlProcessingInstruction(true));apf.aml.setProcessingInstruction("lt",apf.LiveTextPi);apf.aml.setProcessingInstruction("livetext",apf.LiveTextPi);if(document.all){var oldWinError=window.onerror,z;window.onerror=z=function(c){apf.console.error("Error caught from early startup. Might be a html parser syntax error (not your fault). "+c);if(!arguments.caller){return true;}};}apf.Init.addConditional(function(){if(document.all&&window.onerror==z){window.onerror=oldWinError;}apf.dispatchEvent("domready");},null,["body","class"]);apf.addDomLoadEvent(function(){apf.Init.run("body");});apf.start();