var apf={VERSION:"3.3beta",CDN:"",READY:false,NODE_HIDDEN:101,NODE_VISIBLE:102,NODE_O3:103,KEYBOARD:2,KEYBOARD_MOUSE:true,SUCCESS:1,TIMEOUT:2,ERROR:3,OFFLINE:4,debug:true,debugType:"Memory",debugFilter:"!teleport",includeStack:[],initialized:false,AppModules:[],autoLoadSkin:false,started:false,crypto:{},config:{},_GET:{},$asyncObjects:{"apf.oHttp":1,"apf.ajax":1},basePath:"./",ns:{apf:"http://ajax.org/2005/aml",aml:"http://ajax.org/2005/aml",xsd:"http://www.w3.org/2001/XMLSchema",xhtml:"http://www.w3.org/1999/xhtml",xslt:"http://www.w3.org/1999/XSL/Transform",xforms:"http://www.w3.org/2002/xforms",ev:"http://www.w3.org/2001/xml-events"},availHTTP:[],releaseHTTP:function(a){if(apf.brokenHttpAbort){return;}if(self.XMLHttpRequestUnSafe&&a.constructor==XMLHttpRequestUnSafe){return;}a.onreadystatechange=function(){};a.abort();this.availHTTP.push(a);},browserDetect:function(){if(this.$bdetect){return;}this.$bdetect=true;var j=navigator.userAgent.toLowerCase()||"";this.isOpera=(self.opera&&Object.prototype.toString.call(self.opera)=="[object Opera]");this.isKonqueror=j.indexOf("konqueror")!=-1;this.isSafari=/a/.__proto__=="//";this.isSafariOld=false;this.isIphone=j.indexOf("iphone")!=-1||j.indexOf("aspen simulator")!=-1;this.isChrome=Boolean(/source/.test((/a/.toString+"")))||j.indexOf("chrome")!=-1;this.isWebkit=this.isSafari||this.isChrome||this.isKonquerer;if(this.isWebkit){var g=j.match(/applewebkit\/(\d+)/);if(g){this.webkitRev=parseInt(g[1]);this.isSafariOld=parseInt(g[1])<420;}}this.isGecko=(function(k){k[k]=k+"";return k[k]!=k+"";})(new String("__count__"));this.isGecko3=this.isGecko&&(function a(){})[-5]=="x";this.isGecko35=this.isGecko&&(/a/[-1]&&Object.getPrototypeOf)?true:false;this.versionGecko=this.isGecko?parseFloat(j.match(/(?:gecko)\/([\d\.]+)/i)[1]):-1;this.versionFF=this.isGecko?parseFloat(j.match(/(?:firefox)\/([\d\.]+)/i)[1]):-1;var d;this.isIE=!+"\v1";if(this.isIE){this.isIE=parseFloat(j.match(/msie ([\d\.]*)/)[1]);}this.isIE8=this.isIE==8&&(d=true);this.isIE7=!d&&this.isIE==7&&(d=true);if(this.isIE==7&&document.documentMode==7){apf.isIE7=true;apf.isIE8=false;apf.isIE7Emulate=true;apf.isIE=7;}this.isIE6=!d&&this.isIE==6&&(d=true);var c=(navigator.platform.match(/mac|win|linux/i)||["other"])[0].toLowerCase();this.isWin=(c=="win");this.isMac=(c=="mac");this.isLinux=(c=="linux");this.isAIR=j.indexOf("adobeair")!=-1;try{}catch(i){this.isDeskrun=false;}},setCompatFlags:function(){this.TAGNAME=apf.isIE?"baseName":"localName";this.styleSheetRules=apf.isIE?"rules":"cssRules";this.brokenHttpAbort=apf.isIE6;this.canUseHtmlAsXml=apf.isIE;this.supportNamespaces=!apf.isIE;this.cannotSizeIframe=apf.isIE;this.hasConditionCompilation=apf.isIE;this.supportOverflowComponent=apf.isIE;this.hasEventSrcElement=apf.isIE;this.canHaveHtmlOverSelects=!apf.isIE6&&!apf.isIE5;this.hasInnerText=apf.isIE;this.hasMsRangeObject=apf.isIE;this.descPropJs=apf.isIE;this.hasClickFastBug=apf.isIE;this.hasExecScript=window.execScript?true:false;this.canDisableKeyCodes=apf.isIE;this.hasTextNodeWhiteSpaceBug=apf.isIE||apf.isIE>=8;this.hasCssUpdateScrollbarBug=apf.isIE;this.canUseInnerHtmlWithTables=!apf.isIE;this.hasSingleResizeEvent=!apf.isIE;this.hasStyleFilters=apf.isIE;this.supportOpacity=!apf.isIE;this.supportPng24=!apf.isIE6&&!apf.isIE5;this.cantParseXmlDefinition=apf.isIE50;this.hasDynamicItemList=!apf.isIE||apf.isIE>=7;this.canImportNode=apf.isIE;this.hasSingleRszEvent=!apf.isIE;this.hasXPathHtmlSupport=!apf.isIE;this.hasFocusBug=apf.isIE;this.hasReadyStateBug=apf.isIE50;this.dateSeparator=apf.isIE?"-":"/";this.canCreateStyleNode=!apf.isIE;this.supportFixedPosition=!apf.isIE||apf.isIE>=7;this.hasHtmlIdsInJs=apf.isIE&&apf.isIE<8||apf.isWebkit;this.needsCssPx=!apf.isIE;this.hasCSSChildOfSelector=!apf.isIE||apf.isIE>=8;this.styleAttrIsObj=apf.isIE<8;this.hasAutocompleteXulBug=apf.isGecko;this.loadsLocalFilesSync=apf.isIE||apf.isGecko;this.mouseEventBuffer=apf.isIE?20:6;this.hasComputedStyle=typeof document.defaultView!="undefined"&&typeof document.defaultView.getComputedStyle!="undefined";this.supportCSSAnim=apf.isWebkit&&(apf.webkitRev>525);this.w3cRange=Boolean(window.getSelection);this.locale=(apf.isIE?navigator.userLanguage:navigator.language).toLowerCase();this.characterSet=document.characterSet||document.defaultCharset||"utf-8";var j=document.createElement("div");this.hasContentEditable=(typeof j.contentEditable=="string"||typeof j.contentEditable=="boolean");var k=["transform","OTransform","KhtmlTransform","MozTransform","WebkitTransform"],n=["","O","Khtml","Moz","Webkit"],c=["","o-","khtml-","moz-","webkit-"],g=["transitionend","transitionend","transitionend","transitionend","webkitTransitionEnd"],d=0,a=5;this.supportCSSAnim=false;this.supportCSSTransition=false;for(;d<a&&!this.supportCSSAnim;++d){if(typeof j.style[k[d]]=="undefined"){continue;}this.supportCSSAnim=k[d];this.runtimeStylePrefix=n[d];this.classNamePrefix=c[d];this.cssAnimEvent=g[d];}j=null;delete j;this.supportVML=apf.isIE;this.supportSVG=!apf.isIE;this.hasHtml5XDomain=apf.versionGecko>=3.5;this.supportCanvas=!!document.createElement("canvas").getContext;this.supportCanvasText=!!(this.supportCanvas&&typeof document.createElement("canvas").getContext("2d").fillText=="function");this.hasVideo=!!document.createElement("video")["canPlayType"];this.hasAudio=!!document.createElement("audio")["canPlayType"];this.hasGeolocation=!!navigator.geolocation;this.supportHashChange=("onhashchange" in self)&&(!apf.isIE||apf.isIE>=8);this.windowHorBorder=this.windowVerBorder=apf.isIE8&&(!self.frameElement||parseInt(self.frameElement.frameBorder))?4:0;this.maxHttpRetries=apf.isOpera?0:3;this.percentageMatch=new RegExp();this.percentageMatch.compile("([\\-\\d\\.]+)\\%","g");this.reMatchXpath=new RegExp();this.reMatchXpath.compile("(^|\\|)(?!\\@|[\\w-]+::)","g");apf.isGears=!!apf.initGears()||0;},reboot:function(){apf.console.info("Restarting application...");location.href=location.href;},extend:function(c,g){var j,d,a=!c.notNull;if(arguments.length==2){for(j in g){if(a||g[j]){c[j]=g[j];}}return c;}for(d=1;d<arguments.length;d++){g=arguments[d];for(j in g){if(a||g[j]){c[j]=g[j];}}}return c;},$extend:function(a,c){for(var d in c){a[d]=c[d];}return a;},ajax:(function(){var a=function(){return this.oHttp.get.apply(this.oHttp,arguments);};a.exec=function(j,d,i,c){if(j=="ajax"&&d[0]){var g=d[1]||{};return this.oHttp.exec(g.method||"GET",[d[0]],g.callback,apf.extend(c||{},g));}};return a;})(),start:function(){this.started=true;var c=location.href.split("#")[0].split("?")[0];this.host=location.hostname&&c.replace(/(\/\/[^\/]*)\/.*$/,"$1");this.hostPath=c.replace(/\/[^\/]*$/,"")+"/";apf.console.info("Starting Ajax.org Platform Application...");apf.console.warn("Debug build of Ajax.org Platform "+(apf.VERSION?"version "+apf.VERSION:""));this.setCompatFlags();apf.$debugwin.start();if(this.isIE){apf.runIE();}if(apf.isWebkit){apf.runWebkit();}if(this.isOpera){apf.runOpera();}if(this.isGecko||!this.isIE&&!apf.isWebkit&&!this.isOpera){apf.runGecko();}this.oHttp=new this.http();this.Init.addConditional(this.parseAppMarkup,apf,["body"]);try{if(apf.isIE){document.execCommand("BackgroundImageCache",false,true);}}catch(d){}this.started=true;if(this.load_done){this.execDeferred();}this.root=true;for(var a=0;a<apf.$required.length;a++){apf.include(apf.$required[a]);}apf.require=apf.include;},nsqueue:{},findPrefix:function(c,g){var d;if(c.nodeType==9){if(!c.documentElement){return false;}if(c.documentElement.namespaceURI==g){return c.prefix||c.scopeName;}d=c.documentElement;}else{if(c.namespaceURI==g){return c.prefix||c.scopeName;}d=c.ownerDocument.documentElement;if(d&&d.namespaceURI==g){return c.prefix||c.scopeName;}while(c.parentNode){c=c.parentNode;if(c.namespaceURI==g){return c.prefix||c.scopeName;}}}if(d){for(var a=0;a<d.attributes.length;a++){if(d.attributes[a].nodeValue==g){return d.attributes[a][apf.TAGNAME];}}}return false;},importClass:function(c,a,g){if(!c){throw new Error(apf.formatErrorString(1018,null,"importing class","Could not load reference. Reference is null"));}if(!a){return apf.jsexec(c.toString(),g);}var d=c.toString().replace(/^\s*function\s*\w*\s*\([^\)]*\)\s*\{/,"").replace(/\}\s*$/,"");return apf.jsexec(d,g);},toString:function(){return"[Ajax.org Platform (apf)]";},all:[],implement:function(g){if(arguments.length==1){if(!g){throw new Error(apf.formatErrorString(0,this,"Implementing class","Could not implement from '"+g[j]+"'",this));}g.call(this);}else{for(var d,j=0,c=arguments.length;j<c;j++){d=arguments[j];if(!d){throw new Error(apf.formatErrorString(0,this,"Implementing class","Could not implement from '"+arguments[j]+"'",this));}arguments[j].call(this);}}return this;},uniqueHtmlIds:0,setUniqueHtmlId:function(a){var c;a.setAttribute("id",c="q"+this.uniqueHtmlIds++);return c;},getUniqueId:function(){return this.uniqueHtmlIds++;},lookup:function(a){return this.all[a];},findHost:function(c){while(c&&c.parentNode){try{if(c.host){break;}}catch(a){}c=c.parentNode;}return(c&&c.host&&typeof c.host!="string")?c.host:false;},setReference:function(a,c){return self[a]&&self[a].hasFeature?0:(self[a]=c);},console:{data:{time:{messages:{}},log:{messages:{}},custom:{messages:{}},warn:{messages:{}},error:{messages:{}},repeat:{messages:{}}},toggle:function(d,i){var a=apf.$debugwin?apf.$debugwin.resPath:apf.basePath+"core/debug/resources/";if(d.style.display=="block"){d.style.display="none";d.parentNode.style.backgroundImage="url("+a+"splus.gif)";d.innerHTML="";}else{d.style.display="block";d.parentNode.style.backgroundImage="url("+a+"smin.gif)";d.innerHTML=this.cache[i].replace(/\&/g,"&amp;").replace(/\t/g,"&nbsp;&nbsp;&nbsp;").replace(/ /g,"&nbsp;").replace(/\</g,"&lt;").replace(/\n/g,"<br />");var g=d.parentNode.parentNode.parentNode,c=d.parentNode.parentNode;if(g.scrollTop+g.offsetHeight<c.offsetTop+c.offsetHeight){g.scrollTop=c.offsetTop+c.offsetHeight-g.offsetHeight;}}},cache:[],history:[],typeLut:{time:"log",repeat:"log"},$lastmsg:"",$lastmsgcount:0,$detectSameMessage:function(){apf.console.$lastmsg="";if(apf.console.$lastmsgcount){var a=apf.console.$lastmsgcount+" times the same message";apf.console.$lastmsgcount=0;apf.console.write(a,"repeat");clearTimeout(apf.console.$timer);}},teleportList:[],teleport:function(a){if(this.teleportModel){a.setXml(this.teleportModel.data);}this.teleportList.push(a);},setTeleportModel:function(d){if(this.teleportModel==d){return;}this.teleportModel=d;var a=apf.getXml("<teleport />");for(var c=0;c<this.teleportList.length;c++){this.teleportList[c].setXml(a);}d.load(a);},write:function(d,s,n,k,q,j){clearTimeout(this.$timer);if(d==this.$lastmsg){this.$lastmsgcount++;this.$timer=$setTimeout(this.$detectSameMessage,1000);return;}this.$detectSameMessage();this.$lastmsg=d;this.$timer=$setTimeout(this.$detectSameMessage,1000);if(!Number.prototype.toPrettyDigit){Number.prototype.toPrettyDigit=function(){var t=this.toString();return(t.length==1)?"0"+t:t;};}var c=new Date(),a=String(c.getMilliseconds());while(a.length<3){a+="0";}var g=c.getHours().toPrettyDigit()+":"+c.getMinutes().toPrettyDigit()+":"+c.getSeconds().toPrettyDigit()+"."+a;d=(!j?"<span class='console_date'>["+g+"]</span> ":"")+String(d).replace(/(<[^>]+>)| /g,function(u,t,w){if(t){return t;}return"&nbsp;";}).replace(/\t/g,"&nbsp;&nbsp;&nbsp;");var i=apf.$debugwin&&apf.$debugwin.resPath?apf.$debugwin.resPath:apf.basePath+"core/debug/resources/";if(k){d+="<blockquote style='margin:2px 0 0 0;background:url("+i+"splus.gif) no-repeat 2px 3px'><strong style='width:120px;cursor:default;display:block;padding:0 0 0 17px' onmousedown='(self.apf || window.opener.apf).console.toggle(this.nextSibling, "+(this.cache.push(k)-1)+")'>More information</strong><div style='display:none;background-color:#EEEEEE;padding:3px 3px 20px 3px;overflow:auto;max-height:200px'></div></blockquote>";}d="<div class='console_line console_"+s+"' >"+d+"</div>";if(!n){n="default";}this.history.push([this.typeLut[s]||s,d]);if(this.win&&!this.win.closed){this.showWindow(d);}this.debugInfo.push(d);if(apf.dispatchEvent){apf.dispatchEvent("debug",{message:d,type:s});}},clear:function(){this.history=[];},getAll:function(k,g,j){var n={error:k,warn:g,log:j,custom:1};var c=[];for(var d=0,a=this.history.length;d<a;d++){if(n[this.history[d][0]]){c.push(this.history[d][1]);}}return c.join("");},debug:function(d,a,c){this.write(d,"time",a,c);},time:function(d,a,c){this.write(d,"time",a,c);},log:function(d,a,c){this.write(apf.htmlentities(d).replace(/\n/g,"<br />"),"log",a,c);},info:function(d,a,c){this.log(apf.htmlentities(d).replace(/\n/g,"<br />"),a,c);},warn:function(d,a,c){this.write(apf.htmlentities(d).replace(/\n/g,"<br />"),"warn",a,c);},error:function(d,a,c){this.write(d.replace(/\n/g,"<br />"),"error",a,c);},dir:function(a){this.info(apf.vardump(a,null,false).replace(/ /g,"&nbsp;").replace(/</g,"&lt;"));},debugInfo:[],debugType:"",showWindow:function(a){if(!this.win||this.win.closed){this.win=window.open("","debug");this.win.document.write('<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><body style="margin:0;font-family:Verdana;font-size:8pt;"></body>');}if(!this.win){if(!this.haspopupkiller){alert("Could not open debug window, please check your popupkiller");}this.haspopupkiller=true;}else{this.win.document.write((a||this.debugInfo.join("")).replace(/\{imgpath\}/g,apf.debugwin?apf.debugwin.resPath:apf.basePath+"core/debug/resources/"));}}},htmlentities:function(a){return a;},formatErrorString:function(j,n,d,A,k,c,g){var q=[];if(k&&k.ownerDocument){if(k.nodeType==9){k=k.documentElement;}if(k.ownerDocument.documentElement){var i=k.ownerDocument.documentElement.getAttribute("filename");if(!i&&k.ownerDocument.documentElement.tagName=="html"){i=location.href;}i=i?apf.removePathContext(apf.hostPath,i):"Unkown filename";}else{i="Unknown filename";}if(apf.$debugwin){var u=apf.$debugwin.$serializeObject(k);}else{var u=(k.outerHTML||k.xml||k.serialize()).replace(/\<\?xml\:namespace prefix = j ns = "http\:\/\/ajax.org\/2005\/aml" \/\>/g,"").replace(/xmlns:a="[^"]*"\s*/g,"");}var t,a=0,s=k.previousSibling||k.parentNode&&k.parentNode.previousSibling;while(s&&s[apf.TAGNAME]!="body"){t=(s.outerHTML||s.xml||s.serialize()).split("\n").length;a+=t-1;s=s.previousSibling||s.parentNode&&s.parentNode.previousSibling;}if(s&&s[apf.TAGNAME]!="body"){a="unknown";}else{if(k.ownerDocument&&k.ownerDocument.documentElement.tagName=="html"){a+=apf.lineBodyStart;}}q.push("aml file: [line: "+a+"] "+i);}if(n){q.push("Element: "+(apf.$debugwin&&!apf.isDebugWindow?apf.$debugwin.$serializeObject(n):"'"+(n.name||(n.$aml?n.getAttribute("id"):null)||"{Anonymous}")+"' ["+n.tagName+"]"));}if(d){q.push("Process: "+d.replace(/ +/g," "));}if(A){q.push("Message: ["+j+"] "+A.replace(/ +/g," "));}if(c){q.push(c+": "+g);}if(k&&u){q.push("Related Markup: "+u);}return(apf.lastErrorMessage=q.join("\n"));},getDirname:function(a){return((a||"").match(/^([^#]*\/)[^\/]*(?:$|\#)/)||{})[1];},getFilename:function(a){return((a||"").split("?")[0].match(/(?:\/|^)([^\/]+)$/)||{})[1];},getAbsolutePath:function(c,a){return a.charAt(0)=="/"?a:(!a||!c||a.match(/^\w+\:\/\//)?a:c.replace(/\/$/,"")+"/"+a.replace(/^\//,""));},include:function(g,a,j,k){if(apf.started){apf.console.info("including js file: "+g);}var c=a?apf.getAbsolutePath(apf.basePath||"",g):g;var i=document.getElementsByTagName("head")[0],d=document.createElement("script");if(j){d.setAttribute("_apf_type",j);}if(k){d.text=k;}else{d.src=c;}i.appendChild(d);return d;},$required:[],require:function(){var c=apf.getDirname(location.href),d=0,a=arguments.length;for(;d<a;d++){this.$required.push(apf.getAbsolutePath(c,arguments[d]));}},Init:{queue:[],cond:{combined:[]},done:{},add:function(a,c){if(this.inited){a.call(c);}else{if(a){this.queue.push([a,c]);}}},addConditional:function(c,d,a){if(typeof a!="string"){if(this.checkCombined(a)){return c.call(d);}this.cond.combined.push([c,d,a]);}else{if(self[a]){c.call(d);}else{if(!this.cond[a]){this.cond[a]=[];}this.cond[a].push([c,d]);this.checkAllCombined();}}},checkAllCombined:function(){for(var a=0;a<this.cond.combined.length;a++){if(!this.cond.combined[a]){continue;}if(this.checkCombined(this.cond.combined[a][2])){this.cond.combined[a][0].call(this.cond.combined[a][1]);this.cond.combined[a]=null;}}},checkCombined:function(a){for(var c=0;c<a.length;c++){if(!this.done[a[c]]){return false;}}return true;},run:function(a){this.inited=this.done[a]=true;this.checkAllCombined();var d=a?this.cond[a]:this.queue;if(!d){return;}for(var c=0;c<d.length;c++){d[c][0].call(d[c][1]);}}},parseStrategy:0,parseAppMarkup:function(a){var c=false;if(c&&document.documentElement.outerHTML.split(">",1)[0].indexOf(apf.ns.aml)==-1){apf.console.warn("The aml namespace declaration wasn't found. No aml elements were found in the body. Exiting");return false;}if(this.parseStrategy==21||!this.parseStrategy&&!a){return apf.oHttp.get((apf.alternativeAml||document.body&&document.body.getAttribute("xmlurl")||location.href).split(/#/)[0],{type:"markup",callback:function(n,k,d){if(k!=apf.SUCCESS){var s=new Error(apf.formatErrorString(0,null,"Loading XML application data","Could not load XML from remote source: "+d.message));if(d.tpModule.retryTimeout(d,k,null,s)===true){return true;}throw s;}apf.lineBodyStart=(n.replace(/\n/g,"\\n").match(/(.*)<body/)||[""])[0].split("\\n").length;var q=n.replace(/\<\!DOCTYPE[^>]*>/,"").replace(/^[\r\n\s]*/,"");if(!apf.supportNamespaces){q=q.replace(/xmlns\=\"[^"]*\"/g,"");}if(self.ERROR_HAS_OCCURRED){return;}if(apf.isIE){document.body.innerHTML="";}else{var g=document.body.childNodes;for(var j=g.length-1;j>=0;j--){g[j].parentNode.removeChild(g[j]);}}document.documentElement.style.display="block";document.body.style.display="block";apf.initialize(q);},ignoreOffline:true});}else{document.body.style.display="block";if(!self.ERROR_HAS_OCCURRED){apf.initialize(a.outerHTML||a.xml);}}},namespaces:{},setNamespace:function(a,c){this.namespaces[a]=c;c.namespaceURI=a;},initialize:function(c){if(apf.initialized){return;}apf.initialized=true;apf.console.info("Initializing...");clearInterval(apf.Init.interval);apf.Init.run();var a=parseFloat(apf.getStyle(document.body,"marginTop"));apf.doesNotIncludeMarginInBodyOffset=(document.body.offsetTop!==a);apf.window.init(c);},execDeferred:function(){var a=apf.load_events.length;while(a--){(apf.load_events.shift())();}},load_events:[],load_timer:null,load_done:false,load_init:null,addDomLoadEvent:function(k){if(!this.$bdetect){this.browserDetect();}if(apf.load_done){return k();}if(!apf.load_init){apf.load_init=function(){if(apf.load_done){return;}clearInterval(apf.load_timer);apf.load_timer=null;apf.load_done=true;if(apf.started){apf.execDeferred();}};}apf.load_events.push(k);if(k&&apf.load_events.length==1){var n=document,d="undefined";if((typeof n.readyState!=d&&n.readyState=="complete")||(typeof n.readyState==d&&(n.getElementsByTagName("body")[0]||n.body))){return apf.load_init();}if(n.addEventListener&&!apf.isOpera){window.addEventListener("DOMContentLoaded",apf.load_init,false);}else{if(apf.isIE&&window==top){apf.load_timer=setInterval(function(){try{n.documentElement.doScroll("left");}catch(i){$setTimeout(arguments.callee,0);return;}apf.load_init();},10);}else{if(apf.isOpera){n.addEventListener("DOMContentLoaded",function(){apf.load_timer=setInterval(function(){for(var s=0,q=n.styleSheets.length;s<q;s++){if(n.styleSheets[s].disabled){return;}}apf.load_init();},10);},false);}else{if(apf.isWebkit&&!apf.isIphone){var j=n.getElementsByTagName("link"),c=j.length,g;for(;c>=0;c++){if(!j[c]||j[c].getAttribute("rel")!="stylesheet"){j.splice(c,0);}}g=j.length;apf.load_timer=setInterval(function(){if(/loaded|complete/.test(n.readyState)&&n.styleSheets.length==g){apf.load_init();}},10);}else{var a=window.onload;window.onload=function(){apf.load_init();if(a){a();}};}}}}}},addListener:function(d,c,a){if(d.addEventListener){d.addEventListener(c,a,false);}else{if(d.attachEvent){d.attachEvent("on"+c,a);}}return this;},removeListener:function(d,c,a){if(d.removeEventListener){d.removeEventListener(c,a,false);}else{if(d.detachEvent){d.detachEvent("on"+c,a);}}return this;},stopEvent:function(a){this.stopPropagation(a).preventDefault(a);return false;},stopPropagation:function(a){if(a.stopPropagation){a.stopPropagation();}else{a.cancelBubble=true;}return this;},preventDefault:function(a){if(a.preventDefault){a.preventDefault();}else{a.returnValue=false;}return this;},unload:function(c){apf.console.info("Initiating self destruct...");this.isDestroying=true;this.popup.destroy();var g,d=0,a=this.all.length;for(;d<a;d++){g=this.all[d];if(g&&g!=c&&g.destroy&&!g.apf){g.destroy(false);}}for(d=0,a=this.availHTTP.length;d<a;d++){this.availHTTP[d]=null;}this.availHTTP.length=0;if(apf.xmldb){apf.xmldb.unbind(apf.window);}this.isDestroying=false;}};var $xmlns=function(c,a,g,d){if(!apf.supportNamespaces){if(!d){d=apf.findPrefix(c,g);}if(c.style||c==document){return c.getElementsByTagName(a);}else{if(d){(c.nodeType==9?c:c.ownerDocument).setProperty("SelectionNamespaces","xmlns:"+d+"='"+g+"'");}return c.selectNodes(".//"+(d?d+":":"")+a);}}return c.getElementsByTagNameNS(g,a);};var $setTimeout=setTimeout;var $setInterval=setInterval;apf.setTimeout=function(c,a){apf.eventDepth++;return $setTimeout(function(){c();if(--apf.eventDepth==0){apf.queue.empty();}},a);};document.documentElement.className+=" has_apf";document.documentElement.style.display="none";apf.browserDetect();apf.Init.run("apf");apf.Class=function(){};apf.Class.prototype=new (function(){var FUN="function",OBJ="object",UNDEF="undefined",SEL="model",PROP="prop.",MODEL="model",VALUE="value";this.$regbase=0;this.hasFeature=function(test){return this.$regbase&test;};this.$initStack=[];this.$bufferEvents=[];this.$init=function(callback,nodeFunc,struct){if(typeof callback==FUN||callback===true){this.$bufferEvents=this.$bufferEvents.slice();if(callback===true){return this;}this.$initStack=this.$initStack.slice();this.$initStack.push(callback);return this;}this.addEventListener=realAddEventListener;this.$removalQueue=[];if(this.nodeType!=2){this.$uniqueId=apf.all.push(this)-1;}this.$captureStack={};this.$eventsStack={};this.$funcHandlers={};var i=0,l=this.$initStack.length;for(;i<l;i++){this.$initStack[i].apply(this,arguments);}for(i=0,l=this.$bufferEvents.length;i<l;i++){this.addEventListener.apply(this,this.$bufferEvents[i]);}delete realAddEventListener;delete this.$initStack;delete this.$bufferEvents;if(struct&&struct.htmlNode){this.$pHtmlNode=struct.htmlNode;this.ownerDocument.$domParser.$continueParsing(this);apf.queue.empty();}return this;};this.implement=apf.implement;this.$handlePropSet=function(prop,value){this[prop]=value;};this.$bindProperty=function(myProp,bObject,bProp,fParsed){if(!fParsed){return bObject.$handlePropSet(bProp,this[myProp]);}var eventName=PROP+myProp,eFunc,isBeingCalled,isLang;(this.$eventsStack[eventName]||(this.$eventsStack[eventName]=[])).push(eFunc=function(e){if(isBeingCalled){return;}isBeingCalled=true;try{if(fParsed.asyncs){return fParsed.call(bObject,bObject.xmlRoot,function(value){bObject.setProperty(bProp,value,true,false,10);isBeingCalled=false;});}else{var value=fParsed.call(bObject,bObject.xmlRoot);}}catch(e){apf.console.warn("[331] Could not execute binding for property "+bProp+"\n\n"+e.message);isBeingCalled=false;return;}bObject.setProperty(bProp,value,true,false,10);isBeingCalled=false;});return eFunc;};this.$attrExcludePropBind=false;this.$setDynamicProperty=function(prop,pValue){var exclNr=this.$attrExcludePropBind[prop],options;if(SEL.indexOf(prop)>-1||exclNr==3){options={xpathmode:2,parsecode:true};}else{if(exclNr==2){options={nostring:true};}else{if(exclNr===0){options={parsecode:true,nothrow:this.target.match(/-debug$/)?true:false};}}}var fParsed=apf.lm.compile(pValue,options);if(prop==MODEL){(this.$modelParsed=fParsed).instruction=pValue;}else{if(exclNr===0){this.$lastFParsed=fParsed;}}if(fParsed.type==2){this[prop]=!pValue;return this.setProperty(prop,fParsed.str);}if(exclNr==2||fParsed.xpaths.length&&exclNr!=1){if(!this.hasFeature(apf.__DATABINDING__)){this.implement(apf.StandardBinding);}this.$addAttrBind(prop,fParsed,pValue);}var matches=exclNr&&exclNr!=3&&prop!=MODEL?{}:fParsed.props,found=false,_self=this,o,node,bProp,p;for(p in matches){o=p.split(".");if(o.length>2){bProp=o.pop();try{node=eval(o.join("."));}catch(e){if(arguments[2]){apf.console.warn("[287] Could not execute binding test : "+pValue.replace(/</g,"&lt;")+"\n\n"+e.message);}else{apf.queue.add(prop+":"+this.$uniqueId,function(){_self.$clearDynamicProperty(prop);_self.$setDynamicProperty(prop,pValue,true);});}continue;}if(!node||typeof node!=OBJ||(!node.$regbase&&node.$regbase!==0)){bProp=o[1];node=self[o[0]];}else{o.push(bProp);}}else{bProp=o[1];node=self[o[0]]||o[0]=="this"&&this;}if(!node){if(arguments[2]){apf.console.warn("[287] Could not execute binding test : "+pValue.replace(/</g,"&lt;")+"\n\n"+o[0]+" does not exist");}else{apf.queue.add(prop+":"+this.$uniqueId,function(){_self.$clearDynamicProperty(prop);_self.$setDynamicProperty(prop,pValue,true);});return;}}if(!node.$bindProperty){continue;}if(!this.$funcHandlers[prop]){this.$funcHandlers[prop]=[];}this.$funcHandlers[prop].push({amlNode:node,prop:bProp,handler:node.$bindProperty(bProp,this,prop,fParsed)});found=true;}if(found){this.$funcHandlers[prop][0].handler({initial:true});}else{if(exclNr){return this.setProperty(prop,pValue);}try{if(fParsed.asyncs){return fParsed.call(this,this.xmlRoot,function(value){_self.setProperty(prop,value,true);});}else{var value=fParsed.call(this,this.xmlRoot);}}catch(e){apf.console.warn("[331] Could not execute binding test or: "+pValue.replace(/</g,"&lt;")+"\n\n"+e.message);return;}this[prop]=!value;this.setProperty(prop,value,true);}};this.$clearDynamicProperty=function(prop){if(this.$removeAttrBind){this.$removeAttrBind(prop);}if(prop==MODEL){this.$modelParsed=null;}var f,i,l,h=this.$funcHandlers[prop];if(h&&typeof h!=FUN){for(i=0,l=h.length;i<l;i++){(f=h[i]).amlNode.removeEventListener(PROP+f.prop,f.handler);}delete this.$funcHandlers[prop];}};this.watch=function(propName,callback){var eventName=PROP+propName,wrapper=function(e){callback.call(this,propName,e.oldvalue,e.value);};wrapper.callback=callback;(this.$eventsStack[eventName]||(this.$eventsStack[eventName]=[])).push(wrapper);};this.unwatch=function(propName,callback){var list,eventName=PROP+propName;if(!(list=this.$eventsStack[eventName])){return;}for(var i=0,l=list.length;i<l;i++){if(list[i].callback==callback){list.remove(i);return;}}};this.getAvailableProperties=function(){return this.$supportedProperties.slice();};this.setProperty=function(prop,value,forceOnMe,setAttr,inherited){var s,r,arr,e,i,l,oldvalue=this[prop],isChanged=(typeof value==OBJ)?value!=(typeof oldvalue==OBJ?oldvalue:null):String(oldvalue)!==String(value),eventName=PROP+prop;if(isChanged){if(!forceOnMe){if(this.xmlRoot&&typeof value!=OBJ&&(!(s=this.$attrExcludePropBind[prop]))&&(r=(this.$attrBindings&&this.$attrBindings[prop]||prop!=VALUE&&this.$bindings[prop]&&this.$bindings[prop][0]))){if(r.cvalue.type==3){return apf.setNodeValue(this.$getDataNode(prop.toLowerCase(),this.xmlRoot,true),value,true);}}}if(this.$handlePropSet(prop,value,forceOnMe)===false){return;}value=this[prop];if(setAttr){this.setAttribute(prop,value,true);}}if(arr=this.$eventsStack[eventName]){if(this.dispatchEvent(eventName,{prop:prop,value:value,oldvalue:oldvalue})===false){e.returnValue=false;}}if((aci||(aci=apf.config.$inheritProperties))[prop]&&this.$amlLoaded){if(inherited!=10&&!value){delete this.$inheritProperties[prop];if(this.$setInheritedAttribute(prop)){return;}}else{if(inherited!=10){this.$inheritProperties[prop]=inherited||-1;}}if((!e||e.returnValue!==false)&&this.childNodes){(function recur(nodes){var i,l,node,n;for(i=0,l=nodes.length;i<l;i++){node=nodes[i];if(node.nodeType!=1){continue;}if(!(n=node.$inheritProperties[prop])){recur(node.childNodes);}else{if(n>0){node.setProperty(prop,value,false,false,2);}}}})(this.childNodes);}}return value;};var aci;this.getProperty=function(prop){return this[prop];};apf.eventDepth=0;this.eventDepth=0;this.dispatchEvent=function(eventName,options,e){var arr,result,rValue,i,l;apf.eventDepth++;this.eventDepth++;e=options&&options.name?options:e;if(options&&!options.bubbles&&options.currentTarget&&options.currentTarget!=this){throw new Error("Invalid use of options detected in dispatch Event");}if((!e||!e.currentTarget)&&(!options||!options.currentTarget)){if(!(options||(options={})).currentTarget){options.currentTarget=this;}if(arr=this.$captureStack[eventName]){for(i=0,l=arr.length;i<l;i++){rValue=arr[i].call(this,e||(e=new apf.AmlEvent(eventName,options)));if(typeof rValue!=UNDEF){result=rValue;}}}}if(options&&options.captureOnly){return e&&typeof e.returnValue!=UNDEF?e.returnValue:result;}else{if(this["on"+eventName]){result=this["on"+eventName].call(this,e||(e=new apf.AmlEvent(eventName,options)));}if(arr=this.$eventsStack[eventName]){for(i=0,l=arr.length;i<l;i++){if(!arr[i]){continue;}rValue=arr[i].call(this,e||(e=new apf.AmlEvent(eventName,options)));if(typeof rValue!=UNDEF){result=rValue;}}}}var p;while(this.$removalQueue.length){p=this.$removalQueue.shift();p[0].remove(p[1]);}if((e&&e.bubbles&&!e.cancelBubble||!e&&options&&options.bubbles)&&this!=apf){rValue=(this.parentNode||this.ownerElement||apf).dispatchEvent(eventName,options,e);if(typeof rValue!=UNDEF){result=rValue;}}if(--apf.eventDepth==0&&this.ownerDocument&&!this.ownerDocument.$domParser.$parseContext&&!apf.isDestroying&&eventName!="debug"&&apf.queue){apf.queue.empty();}this.eventDepth--;return e&&typeof e.returnValue!=UNDEF?e.returnValue:result;};this.addEventListener=function(a,b,c){this.$bufferEvents.push([a,b,c]);};var realAddEventListener=function(eventName,callback,useCapture){if(eventName.substr(0,2)=="on"){eventName=eventName.substr(2);}var s,stack=useCapture?this.$captureStack:this.$eventsStack;if(!(s=stack[eventName])){s=stack[eventName]=[];}if(s.indexOf(callback)==-1){s.unshift(callback);}for(var i=this.$removalQueue.length-1;i>=0;i--){if(this.$removalQueue[i][0]==s&&this.$removalQueue[i][1]==callback){this.$removalQueue.removeIndex(i);}}var f;if(f=this.$eventsStack["$event."+eventName]){f[0].call(this,callback);}};this.removeEventListener=function(eventName,callback,useCapture){var stack=(useCapture?this.$captureStack:this.$eventsStack)[eventName];if(stack){if(this.eventDepth){this.$removalQueue.push([stack,callback]);}else{stack.remove(callback);}}};this.hasEventListener=function(eventName){return(this.$eventsStack[eventName]&&this.$eventsStack[eventName].length>0);};this.destroy=function(deep,clean){if(typeof this.$uniqueId==UNDEF&&this.nodeType!=2){return;}this.$amlLoaded=false;this.$amlDestroyed=true;if(this.$destroy){this.$destroy();}this.dispatchEvent("DOMNodeRemoved",{bubbles:!apf.isDestroying});this.dispatchEvent("DOMNodeRemovedFromDocument");apf.all[this.$uniqueId]=undefined;if(!this.nodeFunc&&this.nodeType!=2){try{if(this.id||this.name){self[this.id||this.name]=null;}}catch(ex){}return;}if(this.$ext&&!this.$ext.isNative&&this.$ext.nodeType==1&&this.localName!="a"){this.$ext.oncontextmenu=this.$ext.host=null;if(clean){if(this.localName!="collection"){this.$ext.parentNode.removeChild(this.$ext);}}}if(this.$int&&!this.$int.isNative&&this.$int.nodeType==1&&this.localName!="a"){this.$int.host=null;}this.$aml=null;if(deep&&this.childNodes){var nodes=this.childNodes;for(i=nodes.length-1;i>=0;i--){if(nodes[i].destroy){nodes[i].destroy(true,clean&&this.localName=="collection");}}this.childNodes=null;}if(this.parentNode&&this.removeNode){this.removeNode();}else{if(this.ownerElement&&!this.ownerElement.$amlDestroyed){this.ownerElement.removeAttributeNode(this);}}if(this.$focussable&&this.focussable){apf.window.$removeFocus(this);}if(this.attributes){var attr=this.attributes;for(var i=attr.length-1;i>=0;i--){this.$clearDynamicProperty(attr[i].nodeName);attr[i].destroy();}}if(deep!==false&&this.childNodes&&this.childNodes.length){apf.console.warn("You have destroyed an Aml Node without destroying it's children. Please be aware that if you don't maintain a reference, memory might leak");}try{if(this.id||this.name){self[this.id||this.name]=null;}}catch(ex){}apf.nameserver.remove(this.localName,this);};})();apf.extend(apf,new apf.Class().$init());apf.Init.run("class");apf.color={colors:{aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgrey:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},fixHSB:function(a){return{h:Math.min(360,Math.max(0,a.h)),s:Math.min(100,Math.max(0,a.s)),b:Math.min(100,Math.max(0,a.b))};},fixRGB:function(a){return{r:Math.min(255,Math.max(0,a.r)),g:Math.min(255,Math.max(0,a.g)),b:Math.min(255,Math.max(0,a.b))};},fixHex:function(d){var a=6-d.length;if(a>0){var g=[],c=0;for(;c<a;c++){g.push("0");}g.push(d);d=g.join("");}return d;},hexToRGB:function(a){a=parseInt(((a.indexOf("#")>-1)?a.substring(1):a),16);return{r:a>>16,g:(a&65280)>>8,b:(a&255)};},hexToHSB:function(a){return this.RGBToHSB(this.hexToRGB(a));},RGBToHSB:function(d){var c={h:0,s:0,b:0};var g=Math.min(d.r,d.g,d.b),a=Math.max(d.r,d.g,d.b),i=a-g;c.b=a;if(a!=0){}c.s=a!=0?255*i/a:0;if(c.s!=0){if(d.r==a){c.h=(d.g-d.b)/i;}else{if(d.g==a){c.h=2+(d.b-d.r)/i;}else{c.h=4+(d.r-d.g)/i;}}}else{c.h=-1;}c.h*=60;if(c.h<0){c.h+=360;}c.s*=100/255;c.b*=100/255;return c;},HSBToRGB:function(a){var d={},k=Math.round(a.h),j=Math.round(a.s*255/100),c=Math.round(a.b*255/100);if(j==0){d.r=d.g=d.b=c;}else{var n=c,i=(255-j)*c/255,g=(n-i)*(k%60)/60;if(k==360){k=0;}if(k<60){d.r=n,d.b=i,d.g=i+g;}else{if(k<120){d.g=n,d.b=i,d.r=n-g;}else{if(k<180){d.g=n,d.r=i,d.b=i+g;}else{if(k<240){d.b=n,d.r=i,d.g=n-g;}else{if(k<300){d.b=n,d.g=i,d.r=i+g;}else{if(k<360){d.r=n,d.g=i,d.b=n-g;}else{d.r=0,d.g=0,d.b=0;}}}}}}}return{r:Math.round(d.r),g:Math.round(d.g),b:Math.round(d.b)};},RGBToHex:function(a){var d=[a.r.toString(16),a.g.toString(16),a.b.toString(16)],c=0;for(;c<3;c++){if(d[c].length==1){d[c]="0"+d[c];}}return d.join("");},HSBToHex:function(a){return this.RGBToHex(this.HSBToRGB(a));}};if(typeof isFinite=="undefined"){function isFinite(a){return a+1!=a;}}apf.NUMBER=1;apf.BOOLEAN=2;apf.STRING=3;apf.ARRAY=4;apf.DATE=5;apf.REGEXP=6;apf.FUNCTION=7;Array.prototype.dataType=apf.ARRAY;Number.prototype.dataType=apf.NUMBER;Date.prototype.dataType=apf.DATE;Boolean.prototype.dataType=apf.BOOLEAN;String.prototype.dataType=apf.STRING;RegExp.prototype.dataType=apf.REGEXP;Function.prototype.dataType=apf.FUNCTION;apf.getCgiString=function(a,g,d){var k=[];function j(q,i){var s;if(apf.isArray(q)){for(var n=0;n<q.length;n++){j(q[n],i+"%5B%5D");}}else{if(typeof q=="object"){for(s in q){if(apf.isSafariOld&&(!q[s]||typeof p[s]!="object")){continue;}if(typeof q[s]=="function"){continue;}j(q[s],i+"%5B"+encodeURIComponent(s)+"%5D");}}else{k.push(i+"="+encodeURIComponent(q));}}}if(g){k.push("func="+d);for(var c=0;c<a[0].length;c++){j(a[0][c],"f%5B"+c+"%5D");}}else{for(prop in a){if(apf.isSafariOld&&(!a[prop]||typeof a[prop]=="function")){continue;}j(a[prop],prop);}}return k.join("&");};apf.fromCgiString=function(c){if(!c){return false;}var q={};c=c.split("&");for(var k,g=0;g<c.length;g++){k=c[g].split("=");k[0]=decodeURIComponent(k[0]);var n=k[0].replace(/\]/g,"").split("[");var d=q;for(var a=0;a<n.length;a++){if(d[n[a]]){d=d[n[a]];}else{if(n.length==a+1){if(n[a]){d[n[a]]=decodeURIComponent(k[1]);}else{d.push(decodeURIComponent(k[1]));}break;}else{d[n[a]]=!n[a+1]?[]:{};d=d[n[a]];}}}}return q;};Function.prototype.extend=function(){apf.extend.apply(this,[this].concat(Array.prototype.slice.call(arguments)));return this;};Function.prototype.bindWithEvent=function(){var a=this,c=Array.prototype.slice.call(arguments),g=c.shift(),d=c.shift();return function(i){if(!i){i=window.event;}return a.apply(g,[i].concat(c).concat(Array.prototype.slice.call(arguments)));};};Array.prototype.copy=function(){var a=[];for(var d=0,c=this.length;d<c;d++){a[d]=this[d]&&this[d].copy?this[d].copy():this[d];}return a;};Array.prototype.merge=function(){for(var g=0,c=arguments.length;g<c;g++){for(var d=0,a=arguments[g].length;d<a;d++){this.push(arguments[g][d]);}}};Array.prototype.arrayAdd=function(){var n=this.copy();for(var g=0,c=arguments.length;g<c;g++){for(var d=0,a=n.length;d<a;d++){n[d]+=arguments[g][d];}}return n;};Array.prototype.equals=function(d){for(var c=0,a=this.length;c<a;c++){if(this[c]!=d[c]){return false;}}return true;};Array.prototype.makeUnique=function(){var a,d,c=[];for(a=0,d=this.length;a<d;a++){if(c.indexOf(this[a])==-1){c.push(this[a]);}}this.length=0;for(a=0,d=c.length;a<d;a++){this.push(c[a]);}return this;};Array.prototype.contains=function(a,c){return this.indexOf(a,c)!=-1;};Array.prototype.indexOf=Array.prototype.indexOf||function(d,g){var a=this.length;for(var c=(g<0)?Math.max(0,a+g):g||0;c<a;c++){if(this[c]===d){return c;}}return -1;};Array.prototype.lastIndexOf=Array.prototype.lastIndexOf||function(d,g){var a=this.length;for(var c=(g>=a)?a-1:(g<0)?g+a:a-1;c>=0;c--){if(this[c]===d){return c;}}return -1;};Array.prototype.pushUnique=function(a){if(this.indexOf(a)==-1){this.push(a);}return this;};Array.prototype.search=function(){for(var c=0,d=arguments.length;c<d;c++){if(typeof this[c]!="array"){continue;}for(var a=0;a<d;a++){if(this[c][a]!=arguments[a]){break;}else{if(a==(d-1)){return this[c];}}}}};Array.prototype.each=Array.prototype.forEach=Array.prototype.forEach||function(d){for(var c=0,a=this.length;c<a;c++){d.call(this,this[c],c,this);}return this;};Array.prototype.remove=function(c){for(var a=this.length-1;a>=0;a--){if(this[a]!=c){continue;}this.splice(a,1);}return this;};Array.prototype.removeIndex=function(a){if(!this.length){return null;}return this.splice(a,1);};Array.prototype.insertIndex=function(c,a){this.splice(a,0,c);};Array.prototype.invert=Array.prototype.reverse=Array.prototype.reverse||function(){var a=this.length-1;for(var c,d=0;d<Math.ceil(0.5*a);d++){c=this[d];this[d]=this[a-d];this[a-d]=c;}return this;};Array.prototype.filter=Array.prototype.filter||function(g,j){var d=[];for(var c=0,a=this.length;c<a;c++){if(g.call(j,this[c],c,this)){d.push(this[c]);}}return d;};Array.prototype.every=Array.prototype.every||function(d,g){for(var c=0,a=this.length;c<a;c++){if(!d.call(g,this[c],c,this)){return false;}}return true;};Array.prototype.map=Array.prototype.map||function(g,j){var d=[];for(var c=0,a=this.length;c<a;c++){d[c]=g.call(j,this[c],c,this);}return d;};Array.prototype.some=Array.prototype.some||function(d,g){for(var c=0,a=this.length;c<a;c++){if(d.call(g,this[c],c,this)){return true;}}return false;};Number.prototype.toPrettyDigit=Number.prototype.toPrettyDigit||function(){var a=this.toString();return(a.length==1)?"0"+a:a;};RegExp.prototype.getNativeFlags=function(){return(this.global?"g":"")+(this.ignoreCase?"i":"")+(this.multiline?"m":"")+(this.extended?"x":"")+(this.sticky?"y":"");};RegExp.prototype.addFlags=function(a){return new RegExp(this.source,(a||"")+this.getNativeFlags());};String.prototype.uCaseFirst=function(){return this.substr(0,1).toUpperCase()+this.substr(1);};String.prototype.trim=function(){return this.replace(/[\s\n\r]*$/,"").replace(/^[\s\n\r]*/,"");};String.prototype.repeat=function(a){return Array(a+1).join(this);};String.prototype.count=function(a){return this.split(a).length-1;};String.prototype.stripTags=function(){return this.replace(/<\/?[^>]+>/gi,"");};String.prototype.escape=function(){return escape(this);};String.prototype.toXml=function(){var d=apf.getXml("<root>"+this+"</root>");if(d.childNodes.length==1){return d.childNodes[0];}else{var c=d.ownerDocument.createDocumentFragment(),a=d.childNodes;while(a.length){c.appendChild(a[0]);}return c;}};if(typeof window!="undefined"&&typeof window.document!="undefined"&&typeof window.document.createElement=="function"){String.prototype.escapeHTML=function(){this.escapeHTML.text.data=this;return this.escapeHTML.div.innerHTML;};String.prototype.unescapeHTML=function(){var d=document.createElement("div");d.innerHTML=this.stripTags();if(d.childNodes[0]){if(d.childNodes.length>1){var a=[];for(var c=0;c<d.childNodes.length;c++){a.push(d.childNodes[c].nodeValue);}return a.join("");}else{return d.childNodes[0].nodeValue;}}return"";};String.prototype.escapeHTML.div=document.createElement("div");String.prototype.escapeHTML.text=document.createTextNode("");String.prototype.escapeHTML.div.appendChild(String.prototype.escapeHTML.text);if("<\n>".escapeHTML()!=="&lt;\n&gt;"){String.prototype.escapeHTML=null;}if("&lt;\n&gt;".unescapeHTML()!=="<\n>"){String.prototype.unescapeHTML=null;}}if(!String.prototype.escapeHTML){String.prototype.escapeHTML=function(){return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");};}if(!String.prototype.unescapeHTML){String.prototype.unescapeHTML=function(){return this.stripTags().replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&");};}String.prototype.truncate=function(c,a){return this.length>=c?this.substring(0,c-(a?4:1))+(a?"...":""):this;};String.prototype.pad=function(a,d,c){return c?(this+Array(a).join(d)).slice(0,a):(Array(a).join(d)+this).slice(-a);};apf.PAD_LEFT=false;apf.PAD_RIGHT=true;String.prototype.splitSafe=function(d,a,c){return(c&&this.toLowerCase()||this).replace(/(?:^\s+|\n|\s+$)/g,"").split(new RegExp("[\\s ]*"+d+"[\\s ]*","g"),a||999);};String.prototype.appendRandomNumber=function(d){for(var a=[],c=1;c<=d;c++){a.push(apf.randomGenerator.generate(1,9));}return this.toString()+a.join("");};String.prototype.prependRandomNumber=function(d){for(var a=[],c=1;c<=d;c++){a.push(apf.randomGenerator.generate(1,9));}return a.join("")+this.toString();};String.prototype.sprintf=function(){var g=this.toString(),a=0,d=g.indexOf("%s");while(d>=0){var c=arguments[a++]||" ";g=g.substr(0,d)+c+g.substr(d+2);d=g.indexOf("%s");}return g;};apf.isJson=(function(){var c=/\\["\\\/bfnrtu@]/g,a=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,g=/(?:^|:|,)(?:\s*\[)+/g,d=/^[\],:{}\s]*$/;return function(i){if(!i){return false;}return d.test(i.replace(c,"@").replace(a,"]").replace(g,""));};})();if(!self.JSON){self.JSON=(function(){var i=new RegExp('(?:false|true|null|[\\{\\}\\[\\]]|(?:-?\\b(?:0|[1-9][0-9]*)(?:\\.[0-9]+)?(?:[eE][+-]?[0-9]+)?\\b)|(?:"(?:[^\\0-\\x08\\x0a-\\x1f"\\\\]|\\\\(?:["/\\\\bfnrt]|u[0-9A-Fa-f]{4}))*"))',"g"),s=new RegExp("\\\\(?:([^u])|u(.{4}))","g"),k={'"':'"',"/":"/","\\":"\\",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"},n=function(t,u,w){return u?k[u]:String.fromCharCode(parseInt(w,16));},c=new String(""),a="\\",j={"{":Object,"[":Array},d=Object.hasOwnProperty,q=function(t,u){t=u+t;return t.substring(t.length-u.length);},g={0:function(u){if(u.nodeType&&u.ownerDocument&&u.cloneNode(true)){return"apf.xmldb.getXml("+JSON.stringify(apf.getXmlString(u))+")";}var t=[];for(var w in u){t.push('"'+w.replace(/(["\\])/g,"\\$1")+'": '+JSON.stringify(u[w]));}return"{"+t.join(", ")+"}";},5:function(t){t='"'+t.replace(/(["\\])/g,"\\$1")+'"';return t.replace(/(\n)/g,"\\n").replace(/\r/g,"");},2:function(t){return t.toString();},4:function(t){return t.toString();},3:function(t){return'{"jsonclass":["sys.ISODate", ["'+q(t.getUTCFullYear(),"0000")+q(t.getUTCMonth()+1,"00")+q(t.getUTCDate(),"00")+"T"+q(t.getUTCHours(),"00")+":"+q(t.getUTCMinutes(),"00")+":"+q(t.getUTCSeconds(),"00")+'"]]}';},1:function(t){for(var w=[],u=0;u<t.length;u++){w.push(JSON.stringify(t[u]));}return"["+w.join(", ")+"]";},7:function(t){return;}};return{parse:function(E,A){var w=E.match(i),G;var F=w[0];if("{"==F){G={};}else{if("["==F){G=[];}else{throw new Error(F);}}var D,H,B=[G];for(var u=1,t=w.length;u<t;++u){F=w[u];switch(F.charCodeAt(0)){default:H=B[0];H[D||H.length]=+(F);D=void 0;break;case 34:F=F.substring(1,F.length-1);if(F.indexOf(a)!==-1){F=F.replace(s,n);}H=B[0];if(!D){if(H instanceof Array){D=H.length;}else{D=F||c;break;}}H[D]=F;D=void 0;break;case 91:H=B[0];B.unshift(H[D||H.length]=[]);D=void 0;break;case 93:B.shift();break;case 102:H=B[0];H[D||H.length]=false;D=void 0;break;case 110:H=B[0];H[D||H.length]=null;D=void 0;break;case 116:H=B[0];H[D||H.length]=true;D=void 0;break;case 123:H=B[0];B.unshift(H[D||H.length]={});D=void 0;break;case 125:B.shift();break;}}if(B.length){throw new Error();}if(A){var C=function(N,M){var O=N[M];if(O&&typeof O=="object"){var I=null;for(var K in O){if(d.call(O,K)&&O!==N){var J=C(O,K);if(J!==void 0){O[K]=J;}else{if(!I){I=[];}I.push(K);}}}if(I){for(var L=I.length;--L>=0;){delete O[I[L]];}}}return A.call(N,M,O);};G=C({"":G},"");}return G;},stringify:function(t){if(typeof args=="function"||apf.isNot(t)){return"null";}return g[t.dataType||0](t);}};})();}apf.serialize=function(a){return self.JSON.stringify(a);};apf.unserialize=function(a){if(!a){return a;}return self.JSON.parse(a);};apf.hotkeys={};apf.keyMods={ctrl:1,alt:2,shift:4,meta:8};apf.keyNames={"32":"Spacebar","13":"Enter","9":"Tab","27":"Esc","46":"Del","36":"Home","35":"End","107":"+","37":"Left Arrow","38":"Up Arrow","39":"Right Arrow","40":"Down Arrow","33":"Page Up","34":"Page Down","112":"F1","113":"F2","114":"F3","115":"F4","116":"F5","117":"F6","118":"F7","119":"F8","120":"F9","121":"F10","122":"F11","123":"F12"};apf.registerHotkey=function(a,g){var n=0,d;var k=a.splitSafe("\\-|\\+",null,true),j=false,q=false;for(var c=0;c<k.length;c++){if(apf.keyMods[k[c]]){n=n|apf.keyMods[k[c]];if(apf.isMac){j=(apf.keyMods[k[c]]===apf.keyMods.ctrl);q=(apf.keyMods[k[c]]===apf.keyMods.meta);}}else{d=k[c];}}if(j&&!q){n=n|apf.keyMods.meta;}if(!d){throw new Error("missing key for hotkey: "+a);}(apf.hotkeys[n]||(apf.hotkeys[n]={}))[d]=g;if(!apf.initHotkey){apf.initHotkey=true;apf.addEventListener("hotkey",function(u){if(apf.isMac&&u.metaKey){u.ctrlKey=true;}var t=0|(u.ctrlKey?1:0)|(u.shiftKey?4:0)|(u.metaKey?8:0);var i=apf.keyNames[u.keyCode];if(!t&&!i){return;}var s=(apf.hotkeys[t]||{})[(i||String.fromCharCode(u.keyCode)).toLowerCase()];if(s){s();u.returnValue=false;apf.queue.empty();}});}};apf.removeHotkey=function(a){apf.registerHotkey(a,null);};apf.setStyleRule=function(c,s,t,a,n){c=c.toLowerCase();if(!a){var k=(n||self).document.styleSheets;for(var d=k.length-1;d>=0;d--){try{var u=k[d][apf.styleSheetRules];for(var g=0;g<u.length;g++){if(u.item(g).selectorText.toLowerCase()==c){u.item(g).style[s]=t;return true;}}}catch(q){}}}else{var u=(n||self).document.styleSheets[a||0][apf.styleSheetRules];for(var g=0;g<u.length;g++){if(u.item(g).selectorText.toLowerCase()==c){u.item(g).style[s]=t;return true;}}}return false;};apf.getStyleRule=function(c,s,a,n){c=c.toLowerCase();if(!a){var k=(n||self).document.styleSheets;for(var d=k.length-1;d>=0;d--){try{var t=k[d][apf.styleSheetRules];for(var g=0;g<t.length;g++){if(t.item(g).selectorText.toLowerCase()==c){return t.item(g).style[s];}}}catch(q){}}}else{var t=(n||self).document.styleSheets[a||0][apf.styleSheetRules];for(var g=0;g<t.length;g++){if(t.item(g).selectorText.toLowerCase()==c){return t.item(g).style[s];}}}return false;};apf.setStyleClass=function(d,c,g,i){if(!d||i&&this.disabled){return;}if(d.nodeFunc){throw new Error(apf.formatErrorString(0,this,"Setting style class","Trying to set style class on aml node. Only xml or html nodes can              be passed to this function"));}if(c){if(g){g[g.length]=c;}else{g=[c];}}var a=new RegExp("(^| +)(?:"+(g?g.join("|"):"")+")","gi");d.className!=null?(d.className=d.className.replace(a," ")+(c?" "+c:"")):d.setAttribute("class",(d.getAttribute("class")||"").replace(a," ")+(c?" "+c:""));return d;};apf.importCssString=function(c,i,g){i=i||document;var d=i.getElementsByTagName("head")[0];if(!apf.supportOpacity){c=c.replace(/opacity[ \s]*\:[ \s]*([\d\.]+)/g,function(j,k){return"filter:progid:DXImageTransform.Microsoft.Alpha(opacity="+(k*100)+")";});}if(apf.canCreateStyleNode){var a=i.createElement("style");a.appendChild(i.createTextNode(c));if(g){a.setAttribute("media",g);}d.appendChild(a);}else{d.insertAdjacentHTML("beforeend",".<style media='"+(g||"all")+"'>"+c+"</style>");}};apf.getStyleRecur=function(a,d){var c=apf.hasComputedStyle?document.defaultView.getComputedStyle(a,"").getPropertyValue(d.replace(/([A-Z])/g,function(g,i){return"-"+i.toLowerCase();})):a.currentStyle[d];return((!c||c=="transparent"||c=="inherit")&&a.parentNode&&a.parentNode.nodeType==1)?this.getStyleRecur(a.parentNode,d):c;};apf.importStylesheet=function(c,d){for(var a=0;a<c.length;a++){if(!c[a][1]){continue;}if(apf.isIE){(d||window).document.styleSheets[0].addRule(c[a][0],c[a][1]);}else{(d||window).document.styleSheets[0].insertRule(c[a][0]+" {"+c[a][1]+"}",0);}}};apf.isInRect=function(c,a,g){var d=this.getAbsolutePosition(c);if(a<d[0]||g<d[1]||a>c.offsetWidth+d[0]-10||g>c.offsetHeight+d[1]-10){return false;}return true;};apf.getOverflowParent=function(a){a=a.offsetParent;while(a&&(this.getStyle(a,"overflow")!="hidden"||"absolute|relative".indexOf(this.getStyle(a,"position"))==-1)){a=a.offsetParent;}return a||document.documentElement;};apf.getPositionedParent=function(a){a=a.offsetParent;while(a&&a.tagName.toLowerCase()!="body"&&"absolute|relative".indexOf(this.getStyle(a,"position"))==-1){a=a.offsetParent;}return a||document.documentElement;};apf.getAbsolutePosition=function(c,n,d){if("getBoundingClientRect" in document.documentElement){if(apf.doesNotIncludeMarginInBodyOffset&&c==document.body){return[c.offsetLeft+(parseFloat(apf.getStyle(c,apf.descPropJs?"marginLeft":"margin-top"))||0),+(c.scrollLeft||0),c.offsetTop+(parseFloat(apf.getStyle(c,apf.descPropJs?"marginTop":"margin-top"))||0)+(c.scrollTop||0)];}var j=c.getBoundingClientRect(),A=j.top,g=j.left,t=(apf.isIE&&apf.isIE<8);if(n&&n!=document.body){var w=apf.getAbsolutePosition(n,null,true);A-=w[1];g-=w[0];}if(!(apf.isIE&&c==document.documentElement)){g+=document.body.scrollLeft||document.documentElement.scrollLeft||0;A+=document.body.scrollTop||document.documentElement.scrollTop||0;}if(d&&!n){g+=parseInt(apf.getStyle(c,apf.descPropJs?"borderLeftWidth":"border-left-width"))||0;A+=parseInt(apf.getStyle(c,apf.descPropJs?"borderTopWidth":"border-top-width"))||0;}return[g-(t?2:0),A-(t?2:0)];}var k=d?0:c.offsetLeft,B=d?0:c.offsetTop;c=d?c:c.offsetParent||c.parentNode;if(apf.isIE8&&n){u=this.getStyle(c,"borderLeftWidth");k-=(apf.isIE&&c.currentStyle.borderLeftStyle!="none"&&u=="medium"?2:parseInt(u)||0);i=this.getStyle(c,"borderTopWidth");B-=(apf.isIE&&c.currentStyle.borderTopStyle!="none"&&i=="medium"?2:parseInt(i)||0);}var u,i,C;while(c&&c!=n){u=apf.isOpera||apf.isIE8?0:this.getStyle(c,apf.descPropJs?"borderLeftWidth":"border-left-width");k+=(apf.isIE&&c.currentStyle.borderLeftStyle!="none"&&u=="medium"?2:parseInt(u)||0)+c.offsetLeft;if(apf.isIE&&!apf.isIE8&&apf.getStyle(c,"styleFloat")=="none"&&apf.getStyle(c,"position")=="relative"){var a=c.previousSibling;while(a){if(a.nodeType==1){C=apf.getStyle(a,"styleFloat");if(C=="left"){k-=parseInt(apf.getStyle(c,"marginLeft"))||0;break;}else{if(C=="right"){break;}}}a=a.previousSibling;}}i=apf.isOpera||apf.isIE8?0:this.getStyle(c,apf.descPropJs?"borderTopWidth":"border-top-width");B+=(apf.isIE&&c.currentStyle.borderTopStyle!="none"&&i=="medium"?2:parseInt(i)||0)+c.offsetTop;if(!apf.isGecko&&c!=n&&(c.tagName!="HTML"||c.ownerDocument!=document)){k-=c.scrollLeft;B-=c.scrollTop;}if(c.tagName.toLowerCase()=="table"){B-=parseInt(c.border||0)+parseInt(c.cellSpacing||0);k-=parseInt(c.border||0)+parseInt(c.cellSpacing||0)*2;}else{if(c.tagName.toLowerCase()=="tr"){var s;B-=(s=parseInt(c.parentNode.parentNode.cellSpacing));while(c.previousSibling){B-=(c=c.previousSibling).offsetHeight+s;}}}if(apf.isIE&&!c.offsetParent&&c.parentNode.nodeType==1){k-=c.parentNode.scrollLeft;B-=c.parentNode.scrollTop;}c=c.offsetParent;}return[k,B];};apf.getViewPort=function(c){c=c||window;var a=(!c.document.compatMode||c.document.compatMode=="CSS1Compat")?c.document.html||c.document.documentElement:c.document.body;return{x:c.pageXOffset||a.scrollLeft,y:c.pageYOffset||a.scrollTop,width:c.innerWidth||a.clientWidth,height:c.innerHeight||a.clientHeight};};apf.plane={init:function(){if(!this.plane){this.plane=document.createElement("DIV");document.body.appendChild(this.plane);this.plane.style.background="url(images/spacer.gif)";this.plane.style.position="absolute";this.plane.style.zIndex=100000000;this.plane.style.left=0;this.plane.style.top=0;}},lastCursor:null,show:function(k,g,d){this.init();var c=this.plane;this.current=k;if(!g){this.lastZ=this.current.style.zIndex;this.current.style.zIndex=100000;}else{this.plane.appendChild(k);}var a=(c.parentNode==document.body?apf.getWindowWidth():c.parentNode.offsetWidth);var i=(c.parentNode==document.body?apf.getWindowHeight():c.parentNode.offsetHeight);if(d){if(this.lastCursor===null){this.lastCursor=document.body.style.cursor;}document.body.style.cursor=apf.getStyle(k,"cursor");}this.plane.style.display="block";var j=apf.getDiff(c.parentNode);this.plane.style.width=(a-j[0])+"px";this.plane.style.height=(i-j[1])+"px";return c;},hide:function(){var a=apf.isChildOf(this.plane,document.activeElement);if(this.lastZ!==null){if(this.current.style.zIndex==100000){this.current.style.zIndex=this.lastZ;}this.lastZ=null;}if(this.current.parentNode==this.plane){this.plane.parentNode.appendChild(this.current);}this.plane.style.display="none";if(a){if(!apf.isIE){document.activeElement.focus();}apf.document.activeElement.$focus();}this.current=null;if(this.lastCursor!==null){document.body.style.cursor=this.lastCursor;this.lastCursor=null;}return this.plane;}};apf.highlightXml=apf.highlightCode=function(j){var c=j.split(/\n\r?/);for(var g=1000,d=0,a=c.length;d<a;d++){g=Math.min(g,c[d].match(/^(\s+)?[^\s]/)&&RegExp.$1.length||1000);if(!g){break;}}j=j.replace(new RegExp("^ {"+g+"}","gm"),"").replace(/<!doctype([\s\S]+?)>|<!--([\s\S]+?)-->|<\?([\w\-]+)([\s\S]+?)\?>|<\!\[CDATA\[([\s\S]*?)\]\]>|<(\w+:)?script([\s\S]*?)>([\s\S]*?)<\/(?:\w+:)?script>|<([\/\w\:\-]+)([\s\S]*?)(\/?)>/g,function(q,t,u,s,A,B,i,w,D,n,C,k){if(t){return'<span style="color:gray">&lt;!doctype'+t.replace(/</g,"&lt;")+"&gt;</span>";}else{if(u){return'<span style="color:green">&lt;!--'+u.replace(/</g,"&lt;")+"--&gt;</span>";}else{if(s){return'<span style="color:orange">&lt;?'+s+"</span>"+apf.highlightJs(A,true)+'<span style="color:orange">?&gt;</span>';}else{if(B){return'<span style="color:gray">&lt;![CDATA['+B+"]]&gt;</span>";}else{if(i){return'<span style="color:#127ac6">&lt;'+i+"script"+(C?"</span>"+C.replace(/("[\s\S]*?")|([\w\-\:]+)/g,function(E,G,F){if(G){return G;}return'<span style="color:red">'+F+"</span>";})+'<span style="color:#127ac6">&gt;</span>':"&gt;</span>")+apf.highlightJs(D,true)+'<span style="color:#127ac6">&lt;/'+i+"script&gt;</span>";}else{if(n){return'<span style="color:#127ac6">&lt;'+(n.substr(0,2)=="a:"?"<a href='element."+n.substr(2)+"'>"+n+"</a>":n)+(C?"</span>"+C.replace(/("[\s\S]*?")|([\w\-\:]+)/g,function(E,G,F){if(G){return G;}return'<span style="color:red">'+F+"</span>";})+'<span style="color:#127ac6">'+k+"&gt;</span>":"&gt;</span>");}}}}}}});return j;};apf.removeStartWhitespaces=function(j){var c=j.split(/\n\r?/);for(var g=1000,d=0,a=c.length;d<a;d++){g=Math.min(g,c[d].match(/^(\s+)?[^\s]/)&&RegExp.$1.length||1000);if(!g){break;}}return j.replace(new RegExp("^ {"+g+"}","gm"),"");};apf.convertAmlToJson=function(j){var g=apf.getXml("<a:app xmlns:a='"+apf.ns.apf+"'>"+j+"</a:app>",null,true);var d=[],c={"true":1,"false":1};var a=(function i(n,D,A){var u=new Array(D+2).join("  "),q=[];for(var t,E=0,w=n.length;E<w;E++){t=n[E];if(t.nodeType==3||t.nodeType==4){if(t.nodeValue.replace(/[\s]*$/,"").replace(/^[\s]*/,"")){(A||q).push("data",'"'+t.nodeValue.trim().replace(/"/g,'\\"').replace(/\n/g,"\\\n")+'"');}continue;}else{if(t.nodeType==8){q.push(u+"//"+t.nodeValue);continue;}else{if(t.nodeType!=1){continue;}else{if(t[apf.TAGNAME]=="script"){var K=t.childNodes;for(var B=0,C=K.length;B<C;B++){if(K[B].nodeValue.trim()!="//"){d.push(K[B].nodeValue.replace(/^ {16}/gm,"").replace(/\/\/$/,"")+"\n");}}continue;}}}}var G,F=t.childNodes.length+(G=t.attributes).length;var I=0,k=[];q.push(u+"new apf."+t[apf.TAGNAME]+(F||!D?"({":"()"+(D==0?";":(E==w-1?"":","))));if(!D){k.push("htmlNode","document.body");I=Math.max(8,I);}for(var J,B=0,C=G.length;B<C;B++){k.push((J=G[B]).nodeName,J.nodeName.substr(0,2)=="on"?"function(){"+J.nodeValue+"}":(parseInt(J.nodeValue)==J.nodeValue||c[J.nodeValue]?J.nodeValue:'"'+J.nodeValue.replace(/"/g,'\\"')+'"'));I=Math.max(J.nodeName.length,I);}var H="";if(t[apf.TAGNAME]=="model"&&t.childNodes.length){k.push("data",'"'+apf.serializeChildren(t).trim().replace(/"/g,'\\"').replace(/\r?\n/g,"\\\n")+'"');}else{if(F){var H=i(t.childNodes,D+2,k);}}I=Math.max(H?10:4,I);I++;for(B=0,C=k.length;B<C;B+=2){q.push(u+"  "+k[B].pad(I," ",apf.PAD_RIGHT)+": "+k[B+1]+(B!=C-2||H?",":""));}if(H){q.push(u+"  "+"childNodes".pad(I," ",apf.PAD_RIGHT)+": [");q.push(H.substr(0,H.length-1));q.push(u+"  ]");}if(F||!D){q.push(u+"})"+(D==0?";":(E==w-1?"":",")));}}return q.join("\n")+(D==0?"\n\n"+d.join("").trim():"");})(g.childNodes,0);return a+"\n\n";};apf.highlightJs=function(a,k){if(!k){var d=a.split(/\n\r?/);for(var j=1000,g=0,c=d.length;g<c;g++){j=Math.min(j,d[g].match(/^(\s+)?[^\s]/)&&RegExp.$1.length||1000);if(!j){break;}}a=a.replace(new RegExp("^ {"+j+"}","gm"),"");}return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/(\/\*[\s\S]+\*\/)|(\/\/.*)$|("(?:[^"\\]+|\\[\s\S])*")|('(?:[^'\\]+|\\[\s\S])*')|(\W)(apf|break|continue|do|for|import|new|this|void|case|default|else|function|in|return|typeof|while|comment|delete|export|if|label|switch|var|with|abstract|implements|protected|boolean|instanceOf|public|byte|int|short|char|interface|static|double|long|synchronized|false|native|throws|final|null|transient|float|package|true|goto|private|catch|enum|throw|class|extends|try|const|finally|debugger|super)(\W)|(\W)(\w+)(\s*\()/gm,function(i,D,B,s,q,u,w,n,A,t,C){if(t){return A+'<span style="color:#ff8000">'+t+"</span>"+C;}else{if(B||D){return'<span style="color:green">'+(B||D)+"</span>";}else{if(s||q){return'<span style="color:#808080">'+(s||q)+"</span>";}else{if(u){return u+'<span style="color:#127ac6">'+w+"</span>"+n;}}}}});};apf.highlightCode2=function(a){var d=[],c=[];return a.replace(/(\/\*[\s\S]*?\*\/|\/\/.*)/g,function(g){d.push(g);return"###n"+(d.length-1)+"###";}).replace(/\"([\s\S]*?)\"/g,function(i,g){c.push(g);return"###s"+(c.length-1)+"###";}).replace(/\'([\s\S]*?)\'/g,function(i,g){c.push(g);return"###q"+(c.length-1)+"###";}).replace(/(\<)|(\>)/g,function(j,i,g){return"<span stylecolorwhite>"+(i?"@lt@":"@gt@")+"</span>";}).replace(/(\W)-?([\d\.]+)(\W)/g,"$1<span stylecolor#127ac6>$2</span>$3").replace(/([\|\&\=\;\,\:\?\+\*\-]+)/g,"<span stylecolorwhite>$1</span>").replace(/(\W)(break|continue|do|for|import|new|this|void|case|default|else|function|in|return|typeof|while|comment|delete|export|if|label|switch|var|with|abstract|implements|protected|boolean|instanceOf|public|byte|int|short|char|interface|static|double|long|synchronized|false|native|throws|final|null|transient|float|package|true|goto|private|catch|enum|throw|class|extends|try|const|finally|debugger|super)(\W)/g,"$1<span stylecolorgreen>$2</span>$3").replace(/([\(\)\{\}\[\]])/g,"<span stylecoloryellow>$1</span>").replace(/###n(\d+)###/g,function(i,g){return"<span stylecolorpurple>"+d[g].escapeHTML()+"</span>";}).replace(/###s(\d+)###/g,function(i,g){return'<span stylecolorgray>"'+c[g].escapeHTML()+'"</span>';}).replace(/###q(\d+)###/g,function(i,g){return"<span stylecolorgray>'"+c[g].escapeHTML()+"'</span>";}).replace(/stylecolor(.*?)\>/g,"style='color:$1'>").replace(/@(.*?)@/g,"&$1;");};apf.formatJS=function(c){var i=0,a=0;var j=[],g=[];return c.replace(/(\/\*[\s\S]*?\*\/|\/\/.*)/g,function(d){j.push(d);return"###n"+(j.length-1)+"###";}).replace(/\"([\s\S]*?)\"/g,function(k,d){g.push(d);return"###s"+(g.length-1)+"###";}).replace(/\'([\s\S]*?)\'/g,function(k,d){g.push(d);return"###q"+(g.length-1)+"###";}).replace(/;+/g,";").replace(/{;/g,"{").replace(/({)|(})|(\()|(\))|(;)/g,function(d,u,w,n,q,s){if(u){i++;}if(w){i--;}if(n){a++;return n;}if(q){a--;return q;}var t="";for(var k=0;k<i;k++){t+="\t";}if(u){return"{\n"+t;}if(w){return"\n"+t+"}";}if(s){return(a>0)?s:(";\n"+t);}}).replace(/;\s*\n\s*\n/g,";\n").replace(/}var/g,"}\nvar").replace(/([\n\s]*)###n(\d+)###[\n\s]*/g,function(k,d,n){return d+j[n]+d;}).replace(/###s(\d+)###/g,function(k,d,n){return'"'+g[d]+'"';}).replace(/###q(\d+)###/g,function(k,d,n){return"'"+g[d]+"'";});};apf.flash=(function(){function getControlVersion(){var version,axo;try{axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7");version=axo.GetVariable("$version");}catch(e){}if(!version){try{axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");version="WIN 6,0,21,0";axo.AllowScriptAccess="always";version=axo.GetVariable("$version");}catch(e){}}if(!version){try{axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.3");version=axo.GetVariable("$version");}catch(e){}}if(!version){try{axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.3");version="WIN 3,0,18,0";}catch(e){}}if(!version){try{axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");version="WIN 2,0,0,11";}catch(e){version=-1;}}return version;}function getSwfVersion(){var flashVer=-1,sAgent=navigator.userAgent.toLowerCase();if(navigator.plugins!=null&&navigator.plugins.length>0){if(navigator.plugins["Shockwave Flash 2.0"]||navigator.plugins["Shockwave Flash"]){var swVer2=navigator.plugins["Shockwave Flash 2.0"]?" 2.0":"",swfDescr=navigator.plugins["Shockwave Flash"+swVer2].description,aDescr=swfDescr.split(" "),aTempMaj=aDescr[2].split("."),nMajor=aTempMaj[0],nMinor=aTempMaj[1],sRev=aDescr[3];if(sRev==""){sRev=aDescr[4];}if(sRev[0]=="d"){sRev=sRev.substring(1);}else{if(sRev[0]=="r"){sRev=sRev.substring(1);if(sRev.indexOf("d")>0){sRev=sRev.substring(0,sRev.indexOf("d"));}}}flashVer=nMajor+"."+nMinor+"."+sRev;}}else{if(sAgent.indexOf("webtv/2.6")!=-1){flashVer=4;}else{if(sAgent.indexOf("webtv/2.5")!=-1){flashVer=3;}else{if(sAgent.indexOf("webtv")!=-1){flashVer=2;}else{if(apf.isIE&&!apf.isOpera){flashVer=getControlVersion();}}}}}return flashVer;}function detectFlashVersion(reqMajorVer,reqMinorVer,reqRevision){var versionStr=getSwfVersion();if(versionStr==-1){return false;}if(versionStr!=0){var aVersions;if(apf.isIE&&!apf.isOpera){var aTemp=versionStr.split(" "),sTemp=aTemp[1];aVersions=sTemp.split(",");}else{aVersions=versionStr.split(".");}var nMajor=aVersions[0],nMinor=aVersions[1],sRev=aVersions[2];if(nMajor>parseFloat(reqMajorVer)){return true;}if(nMajor==parseFloat(reqMajorVer)){if(nMinor>parseFloat(reqMinorVer)){return true;}if(nMinor==parseFloat(reqMinorVer)&&sRev>=parseFloat(reqRevision)){return true;}}return false;}}function generateObj(objAttrs,params,embedAttrs,stdout){if(stdout=="undefined"){stdout=false;}var i,str=[];if(apf.isIE&&!apf.isOpera){str.push("<object ");for(i in objAttrs){str.push(i,'="',objAttrs[i],'" ');}str.push(">");for(i in params){str.push('<param name="',i,'" value="',params[i],'" />');}str.push("</object>");}else{str.push("<embed ");for(i in embedAttrs){str.push(i,'="',embedAttrs[i],'" ');}str.push("></embed>");}var sOut=str.join("");if(stdout===true){document.write(sOut);}return sOut;}function AC_FL_RunContent(options){var ret=AC_GetArgs(options,"movie","clsid:d27cdb6e-ae6d-11cf-96b8-444553540000","application/x-shockwave-flash");return generateObj(ret.objAttrs,ret.params,ret.embedAttrs);}function buildContent(options){var v=isEightAvailable();if(isAvailable()&&!v){return buildInstaller(options||{});}if(v){return AC_FL_RunContent(options);}return'This content requires the             <a href="http://www.adobe.com/go/getflash/">Adobe Flash Player</a>.';}function embed(options){var obj=options.context,node=options.htmlNode,prop=options.property||"$player";delete options.context,delete options.htmlNode,delete options.property;var content=buildContent(options),cb=function(){$setTimeout(function(){node.innerHTML=content;obj[prop]=getElement(options.id);$setTimeout(function(){var fail=null;if(!obj[prop].parentNode){fail="File Uploader error: The movie has to be enabled manually because of Flashblock. No browser refresh is required.";}else{if(obj[prop].style.display=="none"){fail="File Uploader error: Adblock Plus blocks or hides the movie. Please enable it and refresh your browser.";}else{if(!obj[prop].offsetWidth){fail="File Uploader error: The Flash movie failed to load. Please check if the file exists and the path is correct.";}}}if(fail){apf.console.error(fail,"audio");obj.dispatchEvent("error",{message:fail});}},1000);},200);};return apf.loaded?cb():apf.addEventListener("load",cb);}function buildInstaller(options){if(!options){options={};}var ret=AC_GetArgs(options,"movie","clsid:d27cdb6e-ae6d-11cf-96b8-444553540000","application/x-shockwave-flash"),MMPlayerType=(apf.isIE==true)?"ActiveX":"PlugIn",MMredirectURL=window.location;document.title=document.title.slice(0,47)+" - Flash Player Installation";var MMdoctitle=document.title;return AC_FL_RunContent({src:"playerProductInstall",FlashVars:"MMredirectURL="+MMredirectURL+"&MMplayerType="+MMPlayerType+"&MMdoctitle="+MMdoctitle+"",width:"100%",height:"100%",align:"middle",id:ret.embedAttrs.name,quality:"high",bgcolor:"#000000",name:ret.embedAttrs.name,allowScriptAccess:"always",type:"application/x-shockwave-flash",pluginspage:"http://www.adobe.com/go/getflashplayer"});}var sSrc="src|movie",sObj="onafterupdate|onbeforeupdate|onblur|oncellchange|onclick|ondblclick|ondrag|ondragend|ondragenter|ondragleave|ondragover|ondrop|onfinish|onfocus|onhelp|onmousedown|onmouseup|onmouseover|onmousemove|onmouseout|onkeypress|onkeydown|onkeyup|onload|onlosecapture|onpropertychange|onreadystatechange|onrowsdelete|onrowenter|onrowexit|onrowsinserted|onstart|onscroll|onbeforeeditfocus|onactivate|onbeforedeactivate|ondeactivate|type|codebase|id",sEmb="width|height|align|vspace|hspace|class|title|accesskey|name|tabindex";function AC_GetArgs(options,srcParamName,classid,mimeType){var i,name,ret={embedAttrs:{},params:{},objAttrs:{}};for(i in options){name=i.toLowerCase();if(name=="classid"){continue;}if(name=="pluginspage"){ret.embedAttrs[i]=options[i];}else{if(sSrc.indexOf(name)>-1){ret.embedAttrs.src=options[i];ret.params[srcParamName]=options[i];}else{if(sObj.indexOf(name)>-1){ret.objAttrs[i]=options[i];}else{if(sEmb.indexOf(name)>-1){ret.embedAttrs[i]=ret.objAttrs[i]=options[i];}else{ret.embedAttrs[i]=ret.params[i]=options[i];}}}}}ret.objAttrs.classid=classid;if(mimeType){ret.embedAttrs.type=mimeType;}return ret;}function getElement(id){var elem;if(typeof id=="object"){return id;}if(apf.isIE){return self[id];}else{elem=document[id]?document[id]:document.getElementById(id);if(!elem){elem=apf.lookup(id);}return elem;}}var hash={},uniqueID=1;function addPlayer(player){hash[++uniqueID]=player;return uniqueID;}function getPlayer(id){return hash[id];}function callMethod(id,methodName){var player=hash[id];if(player==null){throw new Error(apf.formatErrorString(0,this,"Player with id: "+id+" not found"));}if(player[methodName]==null){throw new Error(apf.formatErrorString(0,this,"Method "+methodName+" Not found"));}apf.console.info("[FLASH] received method call for player '"+id+"', '"+methodName+"'");var args=[],i=2,l=arguments.length;for(;i<l;i++){args.push(decode(arguments[i]));}player[methodName].apply(player,args);}function remote(o,fn){if(typeof o=="string"){o=hash[o];}var rs=o.CallFunction('<invoke name="'+fn+'" returntype="javascript">'+__flash__argumentsToXML(arguments,2)+"</invoke>");return eval(rs);}function encode(data){if(!data||typeof data!="string"){return data;}return data.replace(/\&([^;]*)\;/g,"&amp;$1;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace("\\","&custom_backslash;").replace(/\0/g,"\\0").replace(/\"/g,"&quot;");}function decode(data){if(data&&data.length&&typeof data!="string"){data=data[0];}if(!data||typeof data!="string"){return data;}return data.replace(/\&custom_lt\;/g,"<").replace(/\&custom_gt\;/g,">").replace(/\&custom_backslash\;/g,"\\").replace(/\\0/g,"\0");}var aIsAvailable={};function isAvailable(sVersion){if(typeof sVersion!="string"){sVersion="6.0.65";}var aVersion=sVersion.split(".");while(aVersion.length<3){aVersion.push("0");}if(typeof aIsAvailable[sVersion]=="undefined"){aIsAvailable[sVersion]=detectFlashVersion(parseInt(aVersion[0]),parseInt(aVersion[1]),parseInt(aVersion[2]));}return aIsAvailable[sVersion];}function isEightAvailable(){return isAvailable("8.0.0");}var oSandboxTypes={remote:"remote (domain-based) rules",localwithfile:"local with file access (no internet access)",localwithnetwork:"local with network (internet access only, no local access)",localtrusted:"local, trusted (local + internet access)"};function getSandbox(sType){var oSandbox={type:null,description:null,noRemote:false,noLocal:false,error:null};oSandbox.type=sType.toLowerCase();oSandbox.description=oSandboxTypes[(typeof oSandboxTypes[oSandbox.type]!="undefined"?oSandbox.type:"unknown")];if(oSandbox.type=="localwithfile"){oSandbox.noRemote=true;oSandbox.noLocal=false;oSandbox.error="Flash security note: Network/internet URLs will not                                  load due to security restrictions.                                 Access can be configured via Flash Player Global Security                                 Settings Page:                                  http://www.macromedia.com/support/documentation/en/flashplayer/help/settings_manager04.html";}else{if(oSandbox.type=="localwithnetwork"){oSandbox.noRemote=false;oSandbox.noLocal=true;}else{if(oSandbox.type=="localtrusted"){oSandbox.noRemote=false;oSandbox.noLocal=false;}}}return oSandbox;}return{isAvailable:isAvailable,isEightAvailable:isEightAvailable,buildContent:buildContent,embed:embed,encode:encode,decode:decode,getElement:getElement,addPlayer:addPlayer,getPlayer:getPlayer,callMethod:callMethod,getSandbox:getSandbox,remote:remote};})();apf.setcookie=function(d,i,c,k,g,j){var a=d+"="+escape(i)+";";if(c){a+="expires="+new Date(c+new Date().getTimezoneOffset()*60).toGMTString()+";";}if(k){a+="path="+k+";";}if(g){a+="domain="+g+";";}if(j){a+="secure";}document.cookie=a;return i;};apf.getcookie=function(d){var c=document.cookie.split("; ");for(var g=0;g<c.length;g++){var a=c[g].split("=");if(d==a[0]){return unescape(a[1]);}}return"";};apf.delcookie=function(a,c){document.cookie=a+"=blah; expires=Fri, 31 Dec 1999 23:59:59 GMT;"+(c?"domain="+c:"");};apf.pasteWindow=function(c){var a=window.open("about:blank");a.document.write(c);};apf.xmlEntityMap={quot:"34",amp:"38",apos:"39",lt:"60",gt:"62",nbsp:"160",iexcl:"161",cent:"162",pound:"163",curren:"164",yen:"165",brvbar:"166",sect:"167",uml:"168",copy:"169",ordf:"170",laquo:"171",not:"172",shy:"173",reg:"174",macr:"175",deg:"176",plusmn:"177",sup2:"178",sup3:"179",acute:"180",micro:"181",para:"182",middot:"183",cedil:"184",sup1:"185",ordm:"186",raquo:"187",frac14:"188",frac12:"189",frac34:"190",iquest:"191",agrave:"192",aacute:"193",acirc:"194",atilde:"195",auml:"196",aring:"197",aelig:"198",ccedil:"199",egrave:"200",eacute:"201",ecirc:"202",euml:"203",igrave:"204",iacute:"205",icirc:"206",iuml:"207",eth:"208",ntilde:"209",ograve:"210",oacute:"211",ocirc:"212",otilde:"213",ouml:"214",times:"215",oslash:"216",ugrave:"217",uacute:"218",ucirc:"219",uuml:"220",yacute:"221",thorn:"222",szlig:"223",agrave:"224",aacute:"225",acirc:"226",atilde:"227",auml:"228",aring:"229",aelig:"230",ccedil:"231",egrave:"232",eacute:"233",ecirc:"234",euml:"235",igrave:"236",iacute:"237",icirc:"238",iuml:"239",eth:"240",ntilde:"241",ograve:"242",oacute:"243",ocirc:"244",otilde:"245",ouml:"246",divide:"247",oslash:"248",ugrave:"249",uacute:"250",ucirc:"251",uuml:"252",yacute:"253",thorn:"254",yuml:"255",oelig:"338",oelig:"339",scaron:"352",scaron:"353",yuml:"376",fnof:"402",circ:"710",tilde:"732",alpha:"913",beta:"914",gamma:"915",delta:"916",epsilon:"917",zeta:"918",eta:"919",theta:"920",iota:"921",kappa:"922",lambda:"923",mu:"924",nu:"925",xi:"926",omicron:"927",pi:"928",rho:"929",sigma:"931",tau:"932",upsilon:"933",phi:"934",chi:"935",psi:"936",omega:"937",alpha:"945",beta:"946",gamma:"947",delta:"948",epsilon:"949",zeta:"950",eta:"951",theta:"952",iota:"953",kappa:"954",lambda:"955",mu:"956",nu:"957",xi:"958",omicron:"959",pi:"960",rho:"961",sigmaf:"962",sigma:"963",tau:"964",upsilon:"965",phi:"966",chi:"967",psi:"968",omega:"969",thetasym:"977",upsih:"978",piv:"982",ensp:"8194",emsp:"8195",thinsp:"8201",zwnj:"8204",zwj:"8205",lrm:"8206",rlm:"8207",ndash:"8211",mdash:"8212",lsquo:"8216",rsquo:"8217",sbquo:"8218",ldquo:"8220",rdquo:"8221",bdquo:"8222",dagger:"8224",dagger:"8225",bull:"8226",hellip:"8230",permil:"8240",prime:"8242",prime:"8243",lsaquo:"8249",rsaquo:"8250",oline:"8254",frasl:"8260",euro:"8364",image:"8465",weierp:"8472",real:"8476",trade:"8482",alefsym:"8501",larr:"8592",uarr:"8593",rarr:"8594",darr:"8595",harr:"8596",crarr:"8629",larr:"8656",uarr:"8657",rarr:"8658",darr:"8659",harr:"8660",forall:"8704",part:"8706",exist:"8707",empty:"8709",nabla:"8711",isin:"8712",notin:"8713",ni:"8715",prod:"8719",sum:"8721",minus:"8722",lowast:"8727",radic:"8730",prop:"8733",infin:"8734",ang:"8736",and:"8743",or:"8744",cap:"8745",cup:"8746","int":"8747",there4:"8756",sim:"8764",cong:"8773",asymp:"8776",ne:"8800",equiv:"8801",le:"8804",ge:"8805",sub:"8834",sup:"8835",nsub:"8836",sube:"8838",supe:"8839",oplus:"8853",otimes:"8855",perp:"8869",sdot:"8901",lceil:"8968",rceil:"8969",lfloor:"8970",rfloor:"8971",lang:"9001",rang:"9002",loz:"9674",spades:"9824",clubs:"9827",hearts:"9829",diams:"9830"};apf.htmlentities=function(a){return a.escapeHTML();};apf.xmlentities=function(a){return a.replace(/&([a-z]+);/gi,function(d,c){if(apf.xmlEntityMap[c=c.toLowerCase()]){return"&#"+apf.xmlEntityMap[c]+";";}return d;});};apf.html_entity_decode=function(a){return(a||"").replace(/\&\#38;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&nbsp;/g," ");};apf.isCharacter=function(a){return(a<112||a>122)&&(a==32||a>42||a==8);};apf.randomGenerator={d:new Date(),seed:null,A:48271,M:2147483647,Q:null,R:null,oneOverM:null,generate:function(c,a){if(this.seed==null){this.seed=2345678901+(this.d.getSeconds()*16777215)+(this.d.getMinutes()*65535);}this.Q=this.M/this.A;this.R=this.M%this.A;this.oneOverM=1/this.M;return Math.floor((a-c+1)*this.next()+c);},next:function(){var a=this.seed/this.Q;var c=this.seed%this.Q;var d=this.A*c-this.R*a;if(d>0){this.seed=d;}else{this.seed=d+this.M;}return(this.seed*this.oneOverM);}};apf.getNoCacheUrl=function(a){return a+(a.indexOf("?")==-1?"?":"&")+"nocache="+new Date().getTime();};apf.parseExpression=function(str){if(!apf.parseExpression.regexp.test(str)){return str;}try{return eval(RegExp.$1);}catch(e){throw new Error(apf.formatErrorString(0,null,"Parsing Expression","Invalid expression given '"+str+"'"));}};apf.parseExpression.regexp=/^\{([\s\S]*)\}$/;apf.formatNumber=function(a,d){var c=parseFloat(a);if(!c){return a;}var g=new String(Math.round(c*100)/100).replace(/(\.\d?\d?)$/,function(i){return i.pad(3,"0",apf.PAD_RIGHT);});if(g.indexOf(".")==-1){g+=".00";}return d+g;};apf.jsexec=function(str,win){if(!str){return str;}if(!win){win=self;}if(apf.isO3){eval(str,self);}else{if(apf.hasExecScript){win.execScript(str);}else{var head=win.document.getElementsByTagName("head")[0];if(head){var script=win.document.createElement("script");script.setAttribute("type","text/javascript");script.text=str;head.appendChild(script);head.removeChild(script);}else{eval(str,win);}}}return str;};apf.K=function(){};apf.isNumber=function(a){return parseFloat(a)==a;};apf.isArray=function(a){return Object.prototype.toString.call(a)==="[object Array]";};apf.isTrue=function(a){return(a===true||a==="true"||a==="on"||typeof a=="number"&&a>0||a==="1");};apf.isFalse=function(a){return(a===false||a==="false"||a==="off"||a===0||a==="0");};apf.isNot=function(a){return(!a&&typeof a!="string"&&a!==0||(typeof a=="number"&&!isFinite(a)));};apf.removePathContext=function(c,a){if(!a){return"";}if(a.indexOf(c)>-1){return a.substr(c.length);}return a;};apf.cancelBubble=function(a,c){a.cancelBubble=true;if(c.$focussable&&!c.disabled){apf.window.$focus(c);}};apf.destroyHtmlNode=function(a){if(!a){return;}if(!apf.isIE||a.ownerDocument!=document){if(a.parentNode){a.parentNode.removeChild(a);}return;}var c=document.getElementById("IELeakGarbageBin");if(!c){c=document.createElement("DIV");c.id="IELeakGarbageBin";c.style.display="none";document.body.appendChild(c);}c.appendChild(a);c.innerHTML="";};apf.getRules=function(c){var d={};for(var a=c.firstChild;a;a=a.nextSibling){if(a.nodeType!=1){continue;}else{if(!d[a[apf.TAGNAME]]){d[a[apf.TAGNAME]]=[];}d[a[apf.TAGNAME]].push(a);}}return d;};apf.isCoord=function(a){return a||a===0;};apf.getCoord=function(c,a){return c||c===0?c:a;};apf.getBox=function(g,d){if(!d){d=0;}if(g==null||(!parseInt(g)&&parseInt(g)!=0)){return[0,0,0,0];}var a=String(g).split(" ");for(var c=0;c<a.length;c++){a[c]=parseInt(a[c])||0;}switch(a.length){case 1:a[1]=a[0];a[2]=a[0];a[3]=a[0];break;case 2:a[2]=a[0];a[3]=a[1];break;case 3:a[3]=a[1];break;}return a;};apf.getNode=function(d,a){var g=0;if(d!=null){for(var c=0;c<d.childNodes.length;c++){if(d.childNodes[c].nodeType==1){if(g==a[0]){d=d.childNodes[c];if(a.length>1){a.shift();d=this.getNode(d,a);}return d;}g++;}}}return null;};apf.getFirstElement=function(a){try{a.firstChild.nodeType==1?a.firstChild:a.firstChild.nextSibling;}catch(c){throw new Error(apf.formatErrorString(1052,null,"Xml Selection","Could not find element:\n"+(a?a.xml:"null")));}return a.firstChild.nodeType==1?a.firstChild:a.firstChild.nextSibling;};apf.getLastElement=function(a){try{a.lastChild.nodeType==1?a.lastChild:a.lastChild.nextSibling;}catch(c){throw new Error(apf.formatErrorString(1053,null,"Xml Selection","Could not find last element:\n"+(a?a.xml:"null")));}return a.lastChild.nodeType==1?a.lastChild:a.lastChild.previousSibling;};apf.selectTextHtml=function(c){if(!apf.hasMsRangeObject){return;}var a=document.selection.createRange();try{a.moveToElementText(c);}catch(d){}a.select();};apf.isChildOf=function(a,g,c){if(!a||!g){return false;}if(g.nodeType==2){g=g.ownerElement||g.selectSingleNode("..");}if(c&&a==g){return true;}var d=g.parentNode;while(d){if(d==a){return true;}d=d.parentNode;}return false;};apf.isOnlyChild=function(k,c){if(!k||!k.parentNode||c&&c.indexOf(k.nodeType)==-1){return false;}var g,a,j,d=k.parentNode.childNodes;for(g=0,a=d.length;g<a;g++){j=d[g];if(j.nodeType==1&&j!=k){return false;}if(j.nodeType==3&&!j.nodeValue.trim()){return false;}}return true;};apf.getChildNumber=function(g,n){var k=g.parentNode,c=0;if(!k){return 0;}if(!n){n=k.childNodes;}if(apf.hasIndexOfNodeList){return n.indexOf(g);}for(var d=0,a=n.length;d<a;d++){if(n[d]==g){return c;}c++;}return c;};apf.mergeXml=function(q,k,u){if(typeof k!="object"){k=getElementById(k);}if(u&&u.clearContents){var c,d,g,a=k.selectNodes("descendant::node()[@"+apf.xmldb.xmlListenTag+"]");for(g=a.length-1;g>=0;g--){var t=a[g].getAttribute(apf.xmldb.xmlListenTag).split(";");for(d=t.length-1;d>=0;d--){c=apf.all[t[d]];if(c.dataParent&&c.dataParent.xpath){c.dataParent.parent.signalXmlUpdate[c.$uniqueId]=true;}else{if(c.$model){c.$model.$waitForXml(c);}}}}a=k.childNodes;for(g=a.length-1;g>=0;g--){k.removeChild(a[g]);}}beforeNode=u&&u.beforeNode?u.beforeNode:apf.getNode(k,[0]);a=q.childNodes;if(k.ownerDocument.importNode){doc=k.ownerDocument;for(g=0,l=a.length;g<l;g++){k.insertBefore(doc.importNode(a[g],true),beforeNode);}}else{for(g=a.length-1;g>=0;g--){k.insertBefore(a[0],beforeNode);}}if(u&&u.copyAttributes){var n=q.attributes;for(g=0;g<n.length;g++){if(n[g].nodeName!=apf.xmldb.xmlIdTag){k.setAttribute(n[g].nodeName,n[g].nodeValue);}}}return k;};apf.setNodeValue=function(j,i,n,g){if(!j){return;}var k,a,d;if(g){k=g.undoObj;a=g.xpath;d=g.newNodes;k.extra.oldValue=g.forceNew?"":apf.queryValue(j,a);k.xmlNode=j;if(a){j=apf.createNodeFromXpath(j,a,d,g.forceNew);}k.extra.appliedNode=j;}if(j.nodeType==1){if(!j.firstChild){j.appendChild(j.ownerDocument.createTextNode("-"));}j.firstChild.nodeValue=apf.isNot(i)?"":i;if(n){apf.xmldb.applyChanges("synchronize",j,k);}}else{var c=j.nodeValue;j.nodeValue=apf.isNot(i)?"":i;if(j.$triggerUpdate){j.$triggerUpdate(null,c);}if(n){apf.xmldb.applyChanges("synchronize",j.parentNode||j.ownerElement||j.selectSingleNode(".."),k);}}};apf.setQueryValue=function(c,a,g){var d=apf.createNodeFromXpath(c,a);if(!d){return null;}apf.setNodeValue(d,g,true);return d;};apf.queryValue=function(c,a){if(!c){return"";}if(c.nodeType==2){return c.nodeValue;}if(a){c=c.selectSingleNode(a);if(!c){return"";}}return c.nodeType==1?(!c.firstChild?"":c.firstChild.nodeValue):c.nodeValue;};apf.queryValues=function(j,c){var d=[];if(!j){return d;}var a=j.selectNodes(c);if(!a.length){return d;}for(var g=0;g<a.length;g++){var k=a[g];if(k.nodeType==1){k=k.firstChild;}d.push(k.nodeValue||"");}return d;};apf.queryNodes=function(c,a){if(a&&(apf.hasXPathHtmlSupport&&a.selectSingleNode||!a.style)){return a.selectNodes(c);}return apf.XPath.selectNodes(c,a);};apf.queryNode=function(c,a){if(a&&(apf.hasXPathHtmlSupport&&a.selectSingleNode||!a.style)){return a.selectSingleNode(c);}var d=apf.queryNodes(c+(apf.isIE?"":"[1]"),a?a:null);return d.length>0?d[0]:null;};apf.getInheritedAttribute=function(g,d,i){var c,a;if(g.nodeValue!=1){g=g.parentNode;}while(g&&(g.nodeType!=1||!(c=d&&((a=g.getAttribute(d))||typeof a=="string")||i&&i(g)))){g=g.parentNode;}if(a==""){return"";}return !c&&d&&apf.config?apf.config[d]:c;};apf.createNodeFromXpath=function(j,C,k,q){var A,w="",D=C.replace(/('.*?')|(".*?")|\|/g,function(i,F,E){if(F||E){return F||E;}return"-%-|-%-";}).split("-%-|-%-")[0].split("/");if(!q&&(A=j.selectSingleNode(C))){return A;}var n=D.length-1;if(q){if(D[n].trim().match(/^\@(.*)$|^text\(\)$/)){n--;}}for(var a,s=false,d=0;d<n;d++){if(!s&&j.selectSingleNode(w+(d!=0?"/":"")+D[d])){w+=(d!=0?"/":"")+D[d];continue;}var c=D[d].match(/(\w+)\[@([\w-]+)=(\w+)\]/);if(!c&&D[d].match(/\@|\[.*\]|\(.*\)/)){throw new Error(apf.formatErrorString(1041,this,"Select via xPath","Could not use xPath to create xmlNode: "+C));}if(!c&&D[d].match(/\/\//)){throw new Error(apf.formatErrorString(1041,this,"Select via xPath","Could not use xPath to create xmlNode: "+C));}if(c){D[d]=c[1];}s=true;a=j.selectSingleNode(w||".").appendChild(j.ownerDocument.createElement(D[d]));if(c){a.setAttribute(c[2],c[3]);w+=(w?"/":"")+c[0];}else{w+=(w?"/":"")+D[d];}if(k){k.push(a);}}if(!w){w=".";}var u,g=D[n],t=j.nodeType==9?j:j.ownerDocument;do{if(g.match(/^\@(.*)$/)){(u||j.selectSingleNode(w)).setAttributeNode(u=j.ownerDocument.createAttribute(RegExp.$1));}else{if(g.trim()=="text()"){u=(u||j.selectSingleNode(w)).appendChild(j.ownerDocument.createTextNode(""));}else{var B=g.match(/(\w+)\[@([\w-]+)=(\w+)\]/);if(B){g=B[1];}u=(u||j.selectSingleNode(w)).appendChild(t.createElement(g));if(B){u.setAttribute(B[2],B[3]);}if(k){k.push(u);}}}w+=(w?"/":"")+D[n];}while((g=D[++n]));return u;};apf.convertMethods={json:function(a){return JSON.stringify(apf.xml2json(a));},cgivars:function(t,A){if(!A){A="";}var B,c,k,q,d,w=[],a=t.childNodes,n={},s=0,g=a.length;for(;s<g;++s){if(a[s].nodeType!=1){continue;}c=a[s].tagName;if(n[c]){continue;}k=t.selectNodes(c);if(k.length>1){n[c]=true;for(q=0,d=k.length;q<d;q++){B=this.cgivars(k[q],A+c+"["+q+"]");if(B){w.push(B);}}}else{B=this.cgivars(a[s],A+c);if(B){w.push(B);}}}var u=t.attributes;for(s=0,g=u.length;s<g;s++){if(u[s].nodeValue){if(A){w.push(A+"["+u[s].nodeName+"]="+escape(u[s].nodeValue));}else{w.push(u[s].nodeName+"="+escape(u[s].nodeValue));}}}if(w.length){return w.join("&");}B=apf.queryValue(t,"text()");if(A&&B){return A+"="+escape(B);}return"";},cgiobjects:function(t,A,E,F){if(!A){A="";}var g=t.childNodes,n;var k=[],D={};var G="",d,C;var B,s,q;var u,c;var w;for(s=0;s<g.length;s++){n=g[s];if(n.nodeType==1){d=n.tagName;w=n.parentNode.selectNodes(d).length==1?true:false;if(typeof D[d]=="undefined"){D[d]=0;}G=A+(E?"[":"")+d+(E?"]":"")+(w?"":"["+D[d]+"]");u=n.attributes;c=n.attributes.length;if(c>0){for(q=0;q<c;q++){if(!(B=u[q]).nodeValue){continue;}k.push(G+"[_"+B.nodeName+"]="+escape(B.nodeValue.trim()));}}C=this.cgiobjects(n,G,true);if(C.dataType!==1){k.push(C);}else{if(n.firstChild&&n.firstChild.nodeValue.trim()){k.push(G+(c>0?"[_]=":"=")+escape(n.firstChild.nodeValue.trim()));}else{if(c==0){if(F){k.push(G);}}}}D[d]++;}}if(!E&&t.getAttribute("id")){k.push("id="+escape(t.getAttribute("id")));}if(k.length){return k.join("&");}return k;}};apf.convertXml=function(a,c){return apf.convertMethods[c](a);};apf.getTextNode=function(a){for(var d=0,c=a.childNodes.length;d<c;++d){if(a.childNodes[d].nodeType==3||a.childNodes[d].nodeType==4){return a.childNodes[d];}}return false;};apf.getBoundValue=function(c,g,d){if(!g&&!c.xmlRoot){return"";}var a=c.$getDataNode("value",c.xmlRoot);return a?apf.queryValue(a):"";};apf.getArrayFromNodelist=function(g){for(var c=[],d=0,a=g.length;d<a;++d){c.push(g[d]);}return c;};apf.serializeChildren=function(g){var k,j=[],c=g.childNodes,d=0,a=c.length;for(;d<a;++d){j[d]=(k=c[d]).nodeType==1?k.xml||k.serialize():(k.nodeType==8?"":k.nodeValue);}return j.join("");};apf.getXmlString=function(c){var a=apf.xmldb.cleanNode(c.cloneNode(true));return a.xml||a.serialize();};apf.getXml=function(d,a,c){return apf.getXmlDom(d,a,c).documentElement;};apf.formatXml=function(j){j=j.trim();var c=j.split("\n"),g=0,d=0,a=c.length;for(;d<a;++d){c[d]=c[d].trim();}c=c.join("\n").replace(/\>\n/g,">").replace(/\>/g,">\n").replace(/\n\</g,"<").replace(/\</g,"\n<").split("\n");c.removeIndex(0);c.removeIndex(c.length);for(d=0,a=c.length;d<a;d++){c[d]="    ".repeat((c[d].match(/^\s*\<\//)?(g==0)?0:--g:(c[d].match(/^\s*\<[^\?][^>]+[^\/]\>/)?g++:g)))+c[d];}if(!j){return"";}return c.join("\n");};apf.xmlToXpath=function(s,t,q){if(!s){return"";}if(q===true&&s.nodeType==1&&s.getAttribute(apf.xmldb.xmlIdTag)){return"//node()[@"+apf.xmldb.xmlIdTag+"='"+s.getAttribute(apf.xmldb.xmlIdTag)+"']";}if(apf!=this&&this.lookup&&this.select){var j,c=this.lookup[s.tagName];if(c){j=s.selectSingleNode(c).nodeValue;return"//"+s.tagName+"["+c+"='"+j+"']";}for(var k=0,g=this.select.length;k<g;k++){if(s.selectSingleNode(this.select[k][0])){j=s.selectSingleNode(this.select[k][1]).nodeValue;return"//"+this.select[k][0]+"["+this.select[k][1]+"='"+j+"']";}}}if(s==t){return".";}if(!s.parentNode&&!s.ownerElement){throw new Error(apf.formatErrorString(0,null,"Converting XML to Xpath","Error xml node without parent and non matching context cannot             be converted to xml.",s));return false;}var n=[],d=s;if(d.nodeType==2){n.push("@"+d.nodeName);d=d.ownerElement||s.selectSingleNode("..");}var a;do{n.unshift((d.nodeType==1?d.tagName:"text()")+"["+(q&&(a=d.nodeType==1&&d.getAttribute(apf.xmldb.xmlIdTag))?"@"+apf.xmldb.xmlIdTag+"='"+a+"'":(apf.getChildNumber(d,d.parentNode.selectNodes(d.tagName))+1))+"]");d=d.parentNode;}while(d&&d.nodeType==1&&d!=t);return n.join("/");};apf.xpathToXml=function(a,c){if(!c){throw new Error(apf.formatErrorString(0,null,"Converting Xpath to XML","Error context xml node is empty, thus xml node cannot              be found for '"+a+"'"));return false;}return c.selectSingleNode(a);};apf.popup={cache:{},focusFix:{INPUT:1,TEXTAREA:1,SELECT:1},setContent:function(i,g,d,c,a){if(!this.popup){this.init();}this.cache[i]={content:g,style:d,width:c,height:a};g.style.position="absolute";g.onmousedown=function(j){if(!j){j=event;}if(apf.hasFocusBug&&!apf.popup.focusFix[(j.srcElement||j.target).tagName]){apf.window.$focusfix();}(j||event).cancelBubble=true;};return g.ownerDocument;},removeContent:function(a){this.cache[a]=null;delete this.cache[a];},init:function(){this.popup={};apf.addEventListener("hotkey",function(a){if(a.keyCode=="27"||a.altKey){apf.popup.forceHide();}});},show:function(t,u){u=apf.extend({x:0,y:0,animate:false,ref:null,width:null,height:null,callback:null,draggable:false,resizable:false,allowTogether:false,autoCorrect:true},u);if(!this.popup){this.init();}if((!u.allowTogether||u.allowTogether!=this.last)&&this.last!=t){this.hide();}var d=this.cache[t];d.options=u;var a=d.content,j=false;if(!d.content.style.zIndex){d.content.style.zIndex=10000000;}if(d.content.style.display&&d.content.style.display.indexOf("none")>-1){d.content.style.display="";}if(u.ref){var n=apf.getAbsolutePosition(u.ref,d.content.offsetParent||d.content.parentNode),q=(u.y||0)+n[1],c=apf.getOverflowParent(d.content);if(u.width||d.width){a.style.width=((u.width||d.width)-3)+"px";}j=u.autoCorrect&&(q+(u.height||d.height||d.content.offsetHeight))>(c==document.documentElement?(apf.isIE?c.offsetHeight:(window.innerHeight+window.pageYOffset))+c.scrollTop:c.offsetHeight+c.scrollTop);a.style.top=(j?(q-(u.height||d.height||d.content.offsetHeight)-(u.y||0)):q)+"px";a.style.left=((u.x||0)+n[0])+"px";}apf.setStyleClass(a,j?"upward":"downward",[j?"downward":"upward"]);if(u.animate){if(u.animate=="fade"){apf.tween.single(a,{type:"fade",from:0,to:1,anim:apf.tween.NORMAL,steps:apf.isIE?5:10,onfinish:function(){if(apf.isIE){a.style.filter="";}}});}else{var s,k=apf.isIE8?5:7,g=0;s=setInterval(function(){var i=++g*((u.height||d.height)/k);a.style.height=i+"px";if(j){a.style.top=(q-i-(u.y||0))+"px";}else{a.scrollTop=-1*(g-k)*((u.height||d.height)/k);}a.style.display="block";if(g>=k){clearInterval(s);if(u.callback){u.callback(a);}}},10);}}else{if(u.height||d.height){a.style.height=(u.height||d.height)+"px";}a.style.top=(q)+"px";a.style.display="block";if(u.callback){u.callback(a);}}$setTimeout(function(){apf.popup.last=t;});if(u.draggable){u.id=t;this.makeDraggable(u);}},hide:function(){if(this.isDragging){return;}var a=this.cache[this.last];if(a){if(a.content){a.content.style.display="none";}if(a.options&&a.options.onclose){a.options.onclose(apf.extend(a.options,{htmlNode:a.content}));a.options.onclose=false;}}},isShowing:function(a){return this.last&&this.last==a&&this.cache[this.last]&&this.cache[this.last].content.style.display!="none";},isDragging:false,makeDraggable:function(a){if(!apf.Interactive||this.cache[a.id].draggable){return;}var c=this.cache[a.id].content;this.cache[a.id].draggable=true;var d={$propHandlers:{},minwidth:10,minheight:10,maxwidth:10000,maxheight:10000,dragOutline:false,resizeOutline:false,draggable:true,resizable:a.resizable,$ext:c,oDrag:c.firstChild};c.onmousedown=c.firstChild.onmousedown=function(g){if(!g){g=event;}if(apf.hasFocusBug&&!apf.popup.focusFix[(g.srcElement||g.target).tagName]){apf.window.$focusfix();}(g||event).cancelBubble=true;};apf.implement.call(d,apf.Interactive);d.$propHandlers.draggable.call(d,true);d.$propHandlers.resizable.call(d,true);},forceHide:function(){if(this.last&&!apf.plane.current&&this.isShowing(this.last)){var a=apf.lookup(this.last);if(!a){this.last=null;}else{if(a.dispatchEvent("popuphide")!==false){this.hide();}}}},destroy:function(){for(var a in this.cache){if(this.cache[a]){this.cache[a].content.onmousedown=null;apf.destroyHtmlNode(this.cache[a].content);this.cache[a].content=null;this.cache[a]=null;}}if(!this.popup){return;}}};apf.nameserver={lookup:{},add:function(a,c){if(!this.lookup[a]){this.lookup[a]=[];}if(this.onchange){this.onchange(a,c);}return this.lookup[a].push(c)-1;},register:function(a,d,c){if(!this.lookup[a]){this.lookup[a]={};}if(this.onchange){this.onchange(a,c,d);}return(this.lookup[a][d]=c);},remove:function(a,c){var d=this.lookup[a];if(d){for(var g in d){if(d[g]==c){delete d[g];}}}},get:function(a,c){return this.lookup[a]?this.lookup[a][c]:null;},getAll:function(j){var d,a=[],c=this.lookup[j];if(!c){return a;}if(c.dataType==apf.ARRAY){for(var g=0;g<c.length;g++){a.push(c[g]);}}else{for(d in c){a.push(c[d]);}}return a;},getAllNames:function(d){var c,a=[];for(c in this.lookup[d]){if(parseInt(c)==c){continue;}a.push(c);}return a;}};apf.config=new apf.Class().$init();apf.extend(apf.config,{disableRightClick:false,allowSelect:false,allowBlur:true,autoDisableActions:true,autoDisable:false,disableF5:true,autoHideLoading:true,disableSpace:true,defaultPage:"home",disableBackspace:true,undokeys:false,outline:false,dragOutline:false,resizeOutline:false,autoDisableNavKeys:true,disableTabbing:false,resourcePath:null,initdelay:true,liveText:false,iphoneFullscreen:true,iphoneStatusbar:"default",iphoneIcon:null,iphoneIconIsGlossy:false,iphoneFixedViewport:true,skinset:"default",name:self.window&&window.location.href.replace(/[^0-9A-Za-z_]/g,"_"),tags:{},defaults:{},baseurl:"",model:"@default","empty-message":"No items","loading-message":"Loading...","offline-message":"You are currently offline.",setDefaults:function(){},getDefault:function(c,j){var g=this.defaults[c];if(!g){return;}for(var a=g.length-1;a>=0;a--){if(g[a][0]==j){return g[a][1];}}},setProperty:function(a,c){this[a.replace(/-(\w)/g,function(d,g){return g.toUpperCase();})]=this[a]=c;(this.$propHandlers&&this.$propHandlers[a]||apf.GuiElement.propHandlers[a]||apf.K).call(this,c);},$inheritProperties:{},$propHandlers:{baseurl:function(a){this.baseurl=apf.parseExpression(a);},language:function(a){},layout:function(a){apf.queue.add("layout",function(){apf.setModel(apf.config.layout,apf.layout);});},"resource-path":function(a){this.resourcePath=apf.parseExpression(a||"").replace(/resources\/?|\/$/g,"");},skinset:function(a){if(this.$amlLoaded){apf.skins.changeSkinset(a);}},outline:function(a){this.dragOutline=this.resizeOutline=this.outline=apf.isTrue(a);},"drag-outline":function(a){this.dragOutline=a?apf.isTrue(a):false;},"resize-outline":function(a){this.resizeOutline=a?!apf.isFalse(a):false;},storage:function(a){if(a){apf.storage.init(a);}},"disable-f5":function(a){if(apf.isDeskrun&&a){shell.norefresh=true;}},debug:function(a){if(a){apf.$debugwin.activate();apf.addEventListener("load",function(){apf.removeEventListener("load",arguments.callee);});}apf.debug=a;}}});apf.offline={onLine:true};apf.tween=(function(F){var R={left:function(V,U){V.style.left=U+t;},right:function(V,U){V.style.left="";V.style.right=U+t;},top:function(V,U){V.style.top=U+t;},bottom:function(V,U){V.style.top="";V.style.bottom=U+t;},width:function(W,V,U){W.style.width=V+t;},height:function(W,V,U){W.style.height=V+t;},scrollTop:function(W,V,U){W.scrollTop=V;},scrollLeft:function(W,V,U){W.scrollLeft=V;},"height-rsz":function(W,V,U){W.style.height=V+t;if(F.hasSingleResizeEvent){window.onresize();}},mwidth:function(V,U,X){var W=F.getDiff(V);V.style.width=U+t;V.style.marginLeft=-1*(U/2+(parseInt(F.getStyle(V,"borderLeftWidth"))||W[0]/2)+(X.margin||0))+t;},mheight:function(V,U,X){var W=F.getDiff(V);V.style.height=U+t;V.style.marginTop=(-1*U/2-(parseInt(F.getStyle(V,"borderTopWidth"))||W[1]/2)+(X.margin||0))+t;},scrollwidth:function(V,U){V.style.width=U+t;V.scrollLeft=V.scrollWidth;},scrollheight_old:function(V,U){try{V.style.height=U+t;V.scrollTop=V.scrollHeight;}catch(W){alert(U);}},scrollheight:function(W,V,Y){var X=F.getHeightDiff(W),U=Y.$int||W;W.style.height=Math.max((V+(Y.diff||0)),0)+t;U.scrollTop=U.scrollHeight-U.offsetHeight-X+(Y.diff||0);},scrolltop:function(V,U){V.style.height=U+t;V.style.top=(-1*U-2)+t;V.scrollTop=0;},clipright:function(W,V,U){W.style.clip="rect(auto, auto, auto, "+V+"px)";W.style.marginLeft=(-1*V)+t;},fade:function(V,U){if(!F.supportOpacity&&F.hasStyleFilters){V.style.filter="alpha(opacity="+parseInt(U*100)+")";}else{V.style.opacity=U;}},bgcolor:function(V,U){V.style.backgroundColor=U;},textcolor:function(V,U){V.style.color=U;},htmlcss:function(V,U,W){if(F.hasStyleFilters&&W.type=="filter"){V.style.filter="progid:DXImageTransform.Microsoft.Alpha(opacity="+U+")";}else{V.style[W.type]=U+(W.needsPx?t:"");}},transformscale:function(V,U,W){V.style[W.type]=s+parseFloat(U)+k;},transformrotate:function(V,U,W){V.style[W.type]=O+parseFloat(U)+N;},transformvalscale:function(U){return s+parseFloat(U)+k;},transformvalrotate:function(U){return O+parseFloat(U)+N;}};var u="id",t="px",A="number",D="transformval",q="transform",E="scale",s="scale(",O="rotate(",k=")",N="deg)",S=["linear","ease-in","ease-out","ease","ease-in-out","cubic-bezier"],w={left:"left",right:"right",top:"top",bottom:"bottom",width:"width",height:"height",scrollTop:false,scrollLeft:false,mwidth:false,mheight:false,scrollwidth:false,scrollheight:false,fade:"opacity",opacity:"opacity",bgcolor:"background-color",textcolor:"color",transform:"transform"},T=Math.pow,P=Math.round,j=0,K=1,L=2,J={},H=null,g=function(U,V){if(!U.getAttribute(u)){F.setUniqueHtmlId(U);}if(!J[U.getAttribute(u)]){J[U.getAttribute(u)]=[];}J[U.getAttribute(u)].push(V);if(J[U.getAttribute(u)].length==1){V(0);}},M=function(V){var U=J[V.getAttribute(u)];if(!U){return;}U.shift();if(U.length){U[0](0);}},d=function(W,U){var V=J[W.getAttribute(u)];if(!V){return;}if(U&&H&&H.control){H.control.stop=true;}V.length=0;},n=function(Z,aa,W,V){var Y=0,U=V-1,X=[aa];if(typeof Z==A){if(!Z){Z=F.tween.linear;}else{if(Z==1){Z=F.tween.easeInCubic;}else{if(Z==2){Z=F.tween.easeOutCubic;}}}}for(Y=0;Y<U;++Y){X.push(Z(Y/V,aa,W-aa));}X.push(W);return X;},i=function(aa,U,Z,ab){var V,W,ac=F.color.colors,ae=parseInt((ac[U]||U).slice(1),16),ad=parseInt((ac[Z]||Z).slice(1),16),Y=0,X=[];for(;Y<ab;Y++){W=Y/(ab-1),V=1-W;X[X.length]="#"+("000000"+((P((ae&255)*V+(ad&255)*W)&255)|(P((ae&65280)*V+(ad&65280)*W)&65280)|(P((ae&16711680)*V+(ad&16711680)*W)&16711680)).toString(16)).slice(-6);}return X;},Q=function(U,V){V=F.extend({steps:3,interval:20,anim:F.tween.linear,control:{}},V);if(U.nodeFunc>100){V.$int=U.$int;U=U.$ext;}try{if("fixed|absolute|relative".indexOf(F.getStyle(U,"position"))==-1){U.style.position="relative";}}catch(Y){}var ac=(F.supportCSSAnim&&F.supportCSSTransition&&w[V.type]),X=(V.type==q);V.method=ac?V.type:X?R[q+(V.subType||E)]:R[V.type]||R.htmlcss;var ac=(F.supportCSSAnim&&F.supportCSSTransition&&w[V.type]),X=(V.type==q);V.method=ac?V.type:X?R[q+(V.subType||E)]:R[V.type]||R.htmlcss;if(!V.method){throw new Error(F.formatErrorString(0,this,"Single Value Tween","Could not find method for tweening operation '"+V.type+"'"));}if(ac){var Z=w[V.type];if(Z===false){return F.tween;}V.type=Z||V.type;if(X){if(!V.subType){V.subType=E;}V.type=F.supportCSSAnim;}var W=(X)?R[D+(V.subType||E)]:null;U.style[V.type]=X?W(V.from):V.from+(C[V.type]?t:"");$setTimeout(function(){U.style[V.type]=X?W(V.to):V.to+(C[V.type]?t:"");U.offsetTop;U.style[F.cssPrefix+"Transition"]=V.type+" "+((V.steps*V.interval)/1000)+"s "+S[V.anim||0];var ad=function(){if(V.onfinish){V.onfinish(U,V.userdata);}U.style[F.cssPrefix+"Transition"]="";U.removeEventListener(F.cssAnimEvent,ad);};U.addEventListener(F.cssAnimEvent,ad);});return F.tween;}if(V.control){V.control.stop=function(){V.control.state=K;d(U);if(V.onstop){V.onstop(U,V.userdata);}};}var ab=V.color?i(V.anim,V.from,V.to,V.steps):n(V.anim,parseFloat(V.from),parseFloat(V.to),V.steps),aa=function(ad){if(V.control&&V.control.state){V.control.state=L;return;}H=V;if(V.onbeforeeach&&V.onbeforeeach(U,V.userdata)===false){return;}try{V.method(U,ab[ad],V);}catch(ae){}if(V.oneach){V.oneach(U,V.userdata);}if(ad<V.steps){return $setTimeout(function(){aa(ad+1);},V.interval);}H=null;if(V.control){V.control.state=L;}if(V.onfinish){V.onfinish(U,V.userdata);}M(U);};g(U,aa);return F.tween;},I=function(X,an){an=F.extend({steps:3,interval:20,anim:F.tween.linear,control:{}},an);if(X.nodeFunc>100){an.$int=X.$int;X=X.$ext;}var am,aa,ae=F.supportCSSAnim&&F.supportCSSTransition,ac=false,U=((an.steps*an.interval)/1000),V=S[an.anim||0],al=[],ag=[],ak=0,ah=an.tweens.length;for(;ak<ah;ak++){var ao=an.tweens[ak];if(ao.oHtml&&ao.oHtml.nodeFunc>100){ao.$int=ao.oHtml.$int;ao.oHtml=ao.oHtml.$ext;}am=(ae&&w[ao.type]);aa=(ao.type==q);if(aa){if(!ao.subType){ao.subType=E;}ao.type=F.supportCSSAnim;}ao.method=am?ao.type:aa?R[q+(ao.subType)]:R[ao.type]||R.htmlcss;if(!ao.method){throw new Error(F.formatErrorString(0,this,"Multi Value Tween","Could not find method for tweening operation '"+ao.type+"'"));}if(am){var W=aa?ao.type:w[ao.type];ao.type=W||ao.type;var ad=R[D+(ao.subType)];X.style[ao.type]=aa?ad(ao.from):ao.from+(C[ao.type]?t:"");ag.push([ao.type,aa?ad(ao.to):ao.to+(C[ao.type]?t:"")]);al.push(ao.type+" "+U+"s "+V+" 0");ac=true;}else{al.push(ao.color?i(an.anim,ao.from,ao.to,an.steps):n(an.anim,parseFloat(ao.from),parseFloat(ao.to),an.steps));}}if(ac){X.style[F.cssPrefix+"Transition"]=al.join(",");X.offsetTop;var Z=0,Y=function(){Z++;if(Z==ag.length){if(an.onfinish){an.onfinish(X,an.userdata);}X.style[F.cssPrefix+"Transition"]="";X.removeEventListener(F.cssAnimEvent,Y);}};X.addEventListener(F.cssAnimEvent,Y,false);for(var ai=0,aj=ag.length;ai<aj;ai++){X.style[ag[ai][0]]=ag[ai][1];}return F.tween;}if(an.control){an.control.stop=function(){an.control.state=K;d(X);if(an.onstop){an.onstop(X,an.userdata);}};}var af=an.tweens,ab=function(aq){if(an.control&&an.control.state){an.control.state=L;return;}H=an;try{for(var ap=0;ap<al.length;ap++){af[ap].method(af[ap].oHtml||X,al[ap][aq],af[ap]);}}catch(ar){}if(an.oneach){an.oneach(X,an.userdata);}if(aq<an.steps){return $setTimeout(function(){ab(aq+1);},an.interval);}H=null;if(an.control){an.control.state=L;}if(an.onfinish){an.onfinish(X,an.userdata);}M(X);};g(X,ab);return F.tween;},B=function(Y,V,ak,al){(ak=ak||{}).tweens=[];if(Y.nodeFunc>100){Y=Y.$ext;}if(al){F.setStyleClass(Y,"",[V]);}var ag=function(am,ao){if(am){F.setStyleClass(Y,"",[V]);}else{F.setStyleClass(Y,V);}for(var an=0;an<ak.tweens.length;an++){if(ak.tweens[an].type=="filter"){continue;}Y.style[ak.tweens[an].type]="";}if(ao){ao.apply(this,arguments);}};var U=ak.onfinish,X=ak.onstop;ak.onfinish=function(){ag(al,U);};ak.onstop=function(){ag(!al,X);};var ac,Z,ad,af,aj,ai,ab,ah,ae={};for(ah=0;ah<document.styleSheets.length;ah++){ab=document.styleSheets[ah][F.styleSheetRules];for(af=ab.length-1;af>=0;af--){var aa=ab[af];if(!aa.style||!aa.selectorText.match("."+V+"$")){continue;}for(ai in aa.style){if(!aa.style[ai]||c.indexOf("|"+ai+"|")==-1){continue;}if(ai=="filter"){if(!aa.style[ai].match(/opacity\=([\d\.]+)/)){continue;}Z=RegExp.$1;ac=(F.getStyleRecur(Y,ai)||"").match(/opacity\=([\d\.]+)/);ad=ac?RegExp.$1:100;aj=false;if(Z==ad){if(al){ad=100;}else{Z=100;}}}else{Z=al&&Y.style[ai]||aa.style[ai];if(al){Y.style[ai]="";}ad=F.getStyleRecur(Y,ai);aj=ai.match(/color/i)?true:false;}ae[ai]={type:ai,from:(aj?String:parseFloat)(al?Z:ad),to:(aj?String:parseFloat)(al?ad:Z),color:aj,needsPx:C[ai.toLowerCase()]||false};}}}for(var W in ae){ak.tweens.push(ae[W]);}if(al){F.setStyleClass(Y,V);}return I(Y,ak);},a=function(V,U,W){B(V,U,W,true);},C={left:true,top:true,bottom:true,right:true,width:true,height:true,fontSize:true,lineHeight:true,textIndent:true},c="|backgroundColor|backgroundPosition|color|width|filter|height|left|top|bottom|right|fontSize|letterSpacing|lineHeight|textIndent|opacity|paddingLeft|paddingTop|paddingRight|paddingBottom|borderLeftWidth|borderTopWidth|borderRightWidth|borderBottomWidth|borderLeftColor|borderTopColor|borderRightColor|borderBottomColor|marginLeft|marginTop|marginRight|marginBottom|transform|",G="|scale|rotate|";return{single:Q,multi:I,css:B,cssRemove:a,clearQueue:d,addModule:function(U,V,W){if(typeof U!="string"||typeof V!="function"||(R[U]&&!W)){return this;}R[U]=V;return this;},NORMAL:0,EASEIN:1,EASEOUT:2,linear:function(V,W,U){return U*V+W;},easeInQuad:function(V,W,U){return U*T(V,2)+W;},easeOutQuad:function(V,W,U){return -U*V*(V-2)+W;},easeInOutQuad:function(V,W,U){if((V/=0.5)<1){return U/2*V*V+W;}return -U/2*((--V)*(V-2)-1)+W;},easeInCubic:function(V,W,U){return U*Math.pow(V,3)+W;},easeOutCubic:function(V,W,U){return U*(T(V-1,3)+1)+W;},easeInOutCubic:function(V,W,U){if((V/=0.5)<1){return U/2*__(V,3)+W;}return U/2*(__(V-2,3)+2)+W;},easeInQuart:function(V,W,U){return U*T(V,4)+W;},easeOutQuart:function(V,W,U){return -U*(T(V-1,4)-1)+W;},easeInOutQuart:function(V,W,U){if((V/=0.5)<1){return U/2*T(V,4)+W;}return -U/2*(T(V-2,4)-2)+W;},easeInQuint:function(V,W,U){return U*T(V,5)+W;},easeOutQuint:function(V,W,U){return U*(T(V-1,5)+1)+W;},easeInOutQuint:function(V,W,U){if((V/=0.5)<1){return U/2*T(V,5)+W;}return U/2*(T(V-2,5)+2)+W;},easeInSine:function(V,W,U){return -U*Math.cos(V*(Math.PI/2))+U+W;},easeOutSine:function(V,W,U){return U*Math.sin(V*(Math.PI/2))+W;},easeInOutSine:function(V,W,U){return -U/2*(Math.cos(Math.PI*V)-1)+W;},easeInExpo:function(V,W,U){return(V==0)?W:U*T(2,10*(V-1))+W;},easeOutExpo:function(V,W,U){return(V==1)?W+U:U*(-T(2,-10*V)+1)+W;},easeInOutExpo:function(V,W,U){if(V==0){return W;}if(V==1){return W+U;}if((V/=0.5)<1){return U/2*T(2,10*(V-1))+W;}return U/2*(-T(2,-10*--V)+2)+W;},easeInCirc:function(V,W,U){return -U*(Math.sqrt(1-V*V)-1)+W;},easeOutCirc:function(V,W,U){return U*Math.sqrt(1-(V-=1)*V)+W;},easeInOutCirc:function(V,W,U){if((V/=0.5)<1){return -U/2*(Math.sqrt(1-V*V)-1)+W;}return U/2*(Math.sqrt(1-(V-=2)*V)+1)+W;},easeInElastic:function(W,Z,V){var X=1.70158,Y=0.3,U=V;if(W==0){return Z;}if(W==1){return Z+V;}if(!U||U<Math.abs(V)){U=V;X=Y/4;}else{X=Y/(2*Math.PI)*Math.asin(V/U);}return -(U*T(2,10*(W-=1))*Math.sin((W*1-X)*(2*Math.PI)/Y))+Z;},easeOutElastic:function(W,Z,V){var X=1.70158,Y=0.3,U=V;if(W==0){return Z;}if(W==1){return Z+V;}if(U<Math.abs(V)){U=V;X=Y/4;}else{X=Y/(2*Math.PI)*Math.asin(V/U);}return U*T(2,-10*W)*Math.sin((W-X)*(2*Math.PI)/Y)+V+Z;},easeInOutElastic:function(W,Z,V){var X=1.70158,Y=0,U=V;if(W==0){return Z;}if((W/2)==2){return Z+V;}if(!Y){Y=0.3*1.5;}if(U<Math.abs(V)){U=V;X=Y/4;}else{X=Y/(2*Math.PI)*Math.asin(V/U);}if(W<1){return -0.5*(U*T(2,10*(W-=1))*Math.sin((W-X)*(2*Math.PI)/Y))+Z;}return U*T(2,-10*(W-=1))*Math.sin((W-X)*(2*Math.PI)/Y)*0.5+V+Z;},easeInBack:function(V,X,U){var W=1.70158;return U*T(V,2)*((W+1)*V-W)+X;},easeOutBack:function(V,X,U){var W=1.70158;return U*((V-=1)*V*((W+1)*V+W)+1)+X;},easeInOutBack:function(V,X,U){var W=1.70158;if((V/2)<1){return U/2*(V*V*(((W*=(1.525))+1)*V-W))+X;}return U/2*((V-=2)*V*(((W*=(1.525))+1)*V+W)+2)+X;},easeInBounce:function(V,W,U){return U-F.tween.easeOutBounce(1-V,0,U)+W;},easeOutBounce:function(V,W,U){if(V<(1/2.75)){return U*(7.5625*V*V)+W;}else{if(V<(2/2.75)){return U*(7.5625*(V-=(1.5/2.75))*V+0.75)+W;}else{if(V<(2.5/2.75)){return U*(7.5625*(V-=(2.25/2.75))*V+0.9375)+W;}else{return U*(7.5625*(V-=(2.625/2.75))*V+0.984375)+W;}}}},easeInOutBounce:function(V,W,U){if(V<1/2){return F.tween.easeInBounce(V*2,0,U)*0.5+W;}return F.tween.easeOutBounce(V*2-1,0,U)*0.5+U*0.5+W;}};})(apf);apf.date=(function(){return{masks:{"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"},i18n:{beginWeekday:1,dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNumbers:{Sun:0,Mon:1,Tue:2,Wed:3,Thu:4,Fri:5,Sat:6,Sunday:0,Monday:1,Tuesday:2,Wednesday:3,Thursday:4,Friday:5,Saturday:6},monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"],monthNumbers:{Jan:0,Feb:1,Mar:2,Apr:3,May:4,Jun:5,Jul:6,Aug:7,Sep:8,Oct:9,Nov:10,Dec:11}}};})();apf.date.dateFormat=(function(){var a=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,c=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,g=/[^-+\dA-Z]/g,d=function(j,i){j=String(j);i=i||2;while(j.length<i){j="0"+j;}return j;};return function(q,I,C){var k=apf.date;if(arguments.length==1&&(typeof q=="string"||q instanceof String)&&!/\d/.test(q)){I=q;q=undefined;}q=q?new Date(q):new Date();if(isNaN(q)){return"NaN";}I=String(k.masks[I]||I||k.masks["default"]);if(I.slice(0,4)=="UTC:"){I=I.slice(4);C=true;}var F=C?"getUTC":"get",w=q[F+"Date"](),i=q[F+"Day"](),t=q[F+"Month"](),B=q[F+"FullYear"](),E=q[F+"Hours"](),u=q[F+"Minutes"](),G=q[F+"Seconds"](),A=q[F+"Milliseconds"](),j=C?0:q.getTimezoneOffset(),n={d:w,dd:d(w),ddd:k.i18n.dayNames[i],dddd:k.i18n.dayNames[i+7],m:t+1,mm:d(t+1),mmm:k.i18n.monthNames[t],mmmm:k.i18n.monthNames[t+12],yy:String(B).slice(2),yyyy:B,h:E%12||12,hh:d(E%12||12),H:E,HH:d(E),M:u,MM:d(u),s:G,ss:d(G),l:d(A,3),L:d(A>99?Math.round(A/10):A),t:E<12?"a":"p",tt:E<12?"am":"pm",T:E<12?"A":"P",TT:E<12?"AM":"PM",Z:C?"UTC":(String(q).match(c)||[""]).pop().replace(g,""),o:(j>0?"-":"+")+d(Math.floor(Math.abs(j)/60)*100+Math.abs(j)%60,4),S:["th","st","nd","rd"][w%10>3?0:(w%100-w%10!=10)*w%10]};return I.replace(a,function(s){return s in n?n[s]:s.slice(1,s.length-1);});};})();apf.date.getDateTime=function(t,A){var i=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g;var k=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC:)(?:[-+]\d{4})?)\b/g;var a=0;var c,w=new Date().getFullYear(),g=1,q=1,j=12,n=0,C=0;var B=apf.date.i18n;if(!A){throw new Error(apf.formatErrorString(0,null,"date-format","Date format is null"));}A=A.replace(k,"");var u=A.replace(i,function(G,F,E){var d=t.substring(E+a,E+a+G.length);switch(G){case"d":case"m":case"h":case"H":case"M":case"s":if(!/[\/, :\-](d|m|h|H|M|s)$|^(d|m|h|H|M|s)[\/, :\-]|[\/, :\-](d|m|h|H|M|s)[\/, :\-]/.test(A)){throw new Error(apf.formatErrorString(0,null,"date-format","Dates without leading zero needs separators"));}var D=parseInt(t.substring(E+a,E+a+2));if(D.toString().length==2){a++;}return G=="d"?q=D:(G=="m"?g=D:(G=="M"?n=D:(G=="s"?C=D:j=D)));case"dd":return q=d;case"dddd":a+=B.dayNames[B.dayNumbers[d.substring(0,3)]+7].length-4;break;case"mm":return g=d;case"mmm":return g=B.monthNumbers[d]+1;case"mmmm":var s=B.monthNumbers[d.substring(0,3)];a+=B.monthNames[s+12].length-4;return g=s+1;case"yy":return w=parseInt(d)<70?"20"+d:d;case"yyyy":return w=d;case"hh":return j=d;case"HH":return j=d;case"MM":return n=d;case"ss":return C=d;case"'T'":case"'Z'":a-=2;break;}});return new Date(w,g-1,q,j,n,C);};Date.prototype.format=function(a,c){return apf.date.dateFormat(this,a,c);};Date.parse=function(c,a){return apf.date.getDateTime(c,a);};apf.xmldb=new (function(){this.xmlDocTag="a_doc";this.xmlIdTag="a_id";this.xmlListenTag="a_listen";this.htmlIdTag="id";this.disableRSB=false;this.$xmlDocLut=[];this.$nodeCount={};this.getElementById=function(g,d){if(!d){d=this.$xmlDocLut[g.split("|")[0]];}if(!d){return false;}return d.selectSingleNode("descendant-or-self::node()[@"+this.xmlIdTag+"='"+g+"']");};this.getNode=function(d){if(!d||!d.getAttribute(this.htmlIdTag)){return false;}return this.getElementById(d.getAttribute(this.htmlIdTag).split("|",2).join("|"));};this.getNodeById=function(i,g){var d=i.split("|");d.pop();return this.getElementById(d.join("|"),g);};this.getDocumentById=function(d){return this.$xmlDocLut[d];};this.getDocument=function(d){return this.$xmlDocLut[d.getAttribute(this.xmlIdTag).split("|")[0]];};this.getID=function(d,g){return d.getAttribute(this.xmlIdTag)+"|"+g.$uniqueId;};this.getElement=function(n,q){var d=n.childNodes;for(var g=0,k=0;k<d.length;k++){if(d[k].nodeType!=1){continue;}if(g++==q){return d[k];}}};this.setModel=function(d){apf.nameserver.register("model",d.data.ownerDocument.documentElement.getAttribute(this.xmlDocTag),d);};this.findModel=function(d){return apf.nameserver.get("model",d.ownerDocument.documentElement.getAttribute(this.xmlDocTag));};this.getXmlId=function(d){return d.getAttribute(this.xmlIdTag)||this.nodeConnect(apf.xmldb.getXmlDocId(d),d);};this.getHtmlNode=function(d,g){if(d&&d.nodeType==1&&d.getAttribute(this.xmlIdTag)){return g.$findHtmlNode(d.getAttribute(this.xmlIdTag)+"|"+g.$uniqueId);}return null;};this.findHtmlNode=function(d,g){do{if(d.nodeType==1&&d.getAttribute(this.xmlIdTag)){return g.$findHtmlNode(d.getAttribute(this.xmlIdTag)+"|"+g.$uniqueId);}if(d==g.xmlRoot){return null;}d=d.parentNode;}while(d&&d.nodeType!=9);return null;};this.findXmlNode=function(d){if(!d){return false;}var g;while(d&&d.nodeType==1&&(d.tagName.toLowerCase()!="body"&&!(g=d.getAttribute(this.htmlIdTag))||(g||(g=d.getAttribute(this.htmlIdTag)))&&g.match(/^q/))){if(d.host&&d.host.$ext==d){return d.host.xmlRoot;}d=d.parentNode;}if(!d||d.nodeType!=1){return false;}if(d.tagName.toLowerCase()=="body"){return false;}return this.getNode(d);};this.getXml=apf.getXml;this.nodeConnect=function(i,g,k,n){if(!this.$nodeCount[i]){this.$nodeCount[i]=0;}var j;j=g.getAttribute(this.xmlIdTag)||g.setAttribute(this.xmlIdTag,(j=i+"|"+ ++this.$nodeCount[i]))||j;if(!n){return j;}var d=j+"|"+n.$uniqueId;if(k){k.setAttribute(this.htmlIdTag,d);}return d;};this.$listeners=[];this.addNodeListener=function(g,j,i){if(!j||(!j.$xmlUpdate&&!j.setProperty)){throw new Error(apf.formatErrorString(1040,null,"Adding Node listener","Interface not supported."));}var k,d=String(g.getAttribute(this.xmlListenTag)||"");if(!i){i=String(j.$uniqueId);}if(i.charAt(0)=="p"){i=i.split("|");k=this.$listeners.push(function(){var s=apf.all[i[1]];if(s){var q=apf.all[i[3]];var n=q.$propBinds[i[1]][i[2]].listen;s.$execProperty(i[2],n?q.data.selectSingleNode(n):q.data);}})-1;}else{k="e"+i;if(!this.$listeners[k]){this.$listeners[k]=function(n){var q=apf.all[i];if(q){q.$xmlUpdate.apply(q,n);}};}}if(!d||d.indexOf(k+";")==-1){g.setAttribute(this.xmlListenTag,(d?d+k:k)+";");}return g;};this.removeNodeListener=function(k,q,s){var j=k.getAttribute(this.xmlListenTag);var d=(j?j.split(";"):[]);if(!s){s=q.$uniqueId;}for(var n=[],g=0;g<d.length;g++){if(d[g]!=s){n.push(d[g]);}}k.setAttribute(this.xmlListenTag,n.join(";"));return k;};this.setTextNode=apf.setTextNode=function(g,j,d,k){var i;if(d){i=g.selectSingleNode(d);if(!i){return;}g=i.nodeType==1?i:null;}if(g.nodeType!=1){i=g;}else{if(g||!i){i=g.selectSingleNode("text()");if(!i){i=g.appendChild(g.ownerDocument.createTextNode(""));}}}if(k){k.extra.oldValue=i.nodeValue;}i.nodeValue=j;if(i.$regbase){i.$setValue(j);}this.applyChanges("text",i.parentNode,k);};this.setAttribute=apf.setAttribute=function(i,g,j,d,k){(d?i.selectSingleNode(d):i).setAttribute(g,j);this.applyChanges("attribute",i,k);};this.removeAttribute=apf.removeAttribute=function(i,g,d,j){if(j){j.name=g;}(d?i.selectSingleNode(d):i).removeAttribute(g);this.applyChanges("attribute",i,j);};this.replaceNode=apf.replaceNode=function(i,j,g,k){if(g){j=j.selectSingleNode(g);}if(k){k.oldNode=j;k.xmlNode=i;}var d=j.parentNode;d.replaceChild(i,j);this.copyConnections(j,i);this.applyChanges("replacechild",i,k);return i;};this.addChildNode=apf.addChildNode=function(q,n,d,g,s){var k=q.insertBefore(q.ownerDocument.createElement(n),g);for(var j=0;j<d.length;j++){k.setAttribute(d[j][0],d[j][1]);}if(s){s.extra.addedNode=k;}this.applyChanges("add",k,s);return k;};this.appendChild=apf.appendChild=function(k,j,g,q,d,n){if(q&&k.selectSingleNode(j.tagName)){return false;}if(n){this.cleanNode(j);}if(k.ownerDocument.importNode&&k.ownerDocument!=j.ownerDocument){j=k.ownerDocument.importNode(j,true);}if(d){var i=[];var k=apf.createNodeFromXpath(k,d,i);if(i.length){k.appendChild(j);while(i.length){if(k==i.pop()&&i.length){k=k.parentNode;}}}}else{if(j.parentNode){this.removeNode(j);}}k.insertBefore(j,g);this.applyChanges("add",j,n);return j;};this.moveNode=apf.moveNode=function(j,i,g,d,k){if(!k){k={extra:{}};}k.extra.oldParent=i.parentNode;k.extra.beforeNode=i.nextSibling;k.extra.parent=(d?j.selectSingleNode(d):j);this.applyChanges("move-away",i,k);if(!apf.isWebkit&&apf.xmldb.getXmlDocId(i)!=apf.xmldb.getXmlDocId(j)){i.removeAttributeNode(i.getAttributeNode(this.xmlIdTag));this.nodeConnect(apf.xmldb.getXmlDocId(j),i);}if(apf.isWebkit&&j.ownerDocument!=i.ownerDocument){i=j.ownerDocument.importNode(i,true);}k.extra.parent.insertBefore(i,g);this.applyChanges("move",i,k);};this.removeNode=apf.removeNode=function(g,d,j){if(d){g=g.selectSingleNode(d);}if(j){j.extra.parent=g.parentNode;j.extra.removedNode=g;j.extra.beforeNode=g.nextSibling;}this.applyChanges("remove",g,j);var i=g.parentNode;i.removeChild(g);this.applyChanges("redo-remove",g,null,i);};this.removeNodeList=apf.removeNodeList=function(d,n){for(var j=[],g=0;g<d.length;g++){if(n){j.push({pNode:d[g].parentNode,removedNode:d[g],beforeNode:d[g].nextSibling});}this.applyChanges("remove",d[g],n);var k=d[g].parentNode;k.removeChild(d[g]);this.applyChanges("redo-remove",d[g],null,k);}if(n){n.extra.removeList=j;}};var c={},a;this.$hasQueue=false;this.applyChanges=function(s,D,F,k){if(F&&F.$dontapply){return;}if(F&&!F.xmlNode){F.xmlNode=D;}var d=k,E=(D.nodeType==1?D:D.parentNode);if(!this.delayUpdate&&"|remove|move-away|".indexOf("|"+s+"|")>-1){this.notifyQueued();}var q,C,A,w,t,u,g,n,B,G;while(E&&E.nodeType==1){q=E.getAttribute(this.xmlListenTag);if(q){A=q.split(";");for(w=0;w<A.length;w++){C=A[w];u=c[C];if(!u){c[C]=u=[];}if("|update|attribute|text|".indexOf("|"+s+"|")>-1){G=false;for(t=0;t<u.length;t++){if(u[t]&&D==u[t][1]&&"|update|attribute|text|".indexOf("|"+u[t][0]+"|")>-1){u[t]=null;G=true;continue;}}u.push(["update",D,E,F,d]);B=true;continue;}if("|remove|move-away|add|".indexOf("|"+s+"|")>-1){if(this.$listeners[C]){this.$listeners[C]([s,D,E,F,d]);}}else{u.push([s,D,E,F,d]);B=true;}}}E=E.parentNode||k;if(E==k){k=null;}}if(F&&!this.delayUpdate){apf.xmldb.notifyQueued();}else{if(B){clearTimeout(a);a=$setTimeout(function(){apf.xmldb.notifyQueued();});}}};this.notifyQueued=function(){this.$hasQueue=false;clearTimeout(a);for(var j in c){if(!j){continue;}var k=c[j];var g=this.$listeners[j];if(!k){continue;}for(var d=0;d<k.length;d++){if(!k[d]){continue;}g(k[d]);}}c={};};this.notifyListeners=function(i){var g=i.getAttribute(apf.xmldb.xmlListenTag);if(g){g=g.split(";");for(var d=0;d<g.length;d++){apf.all[g[d]].$xmlUpdate("synchronize",i,i);}}};this.copyConnections=function(g,d){try{d.setAttribute(this.xmlListenTag,g.getAttribute(this.xmlListenTag));}catch(i){}try{d.setAttribute(this.xmlIdTag,g.getAttribute(this.xmlIdTag));}catch(i){}};this.cleanNode=function(j){try{var g,d=j.selectNodes("descendant-or-self::node()[@"+this.xmlListenTag+"]");for(g=d.length-1;g>=0;g--){d[g].removeAttribute(this.xmlListenTag);}d=j.selectNodes("descendant-or-self::node()[@"+this.xmlIdTag+"]");for(g=d.length-1;g>=0;g--){d[g].removeAttribute(this.xmlIdTag);}d=j.selectNodes("descendant-or-self::node()[@"+this.xmlDocTag+"]");for(g=d.length-1;g>=0;g--){d[g].removeAttribute(this.xmlDocTag);}d=j.selectNodes("descendant-or-self::node()[@a_loaded]");for(g=d.length-1;g>=0;g--){d[g].removeAttribute("a_loaded");}}catch(k){}return j;};this.copy=this.getCleanCopy=apf.getCleanCopy=function(d){return apf.xmldb.cleanNode(d.cloneNode(true));};this.unbind=function(t){for(var w={},q=0;q<t.apf.all.length;q++){if(t.apf.all[q]&&t.apf.all[q].unloadBindings){w[t.apf.all[q].unloadBindings()]=true;}}for(var d=0;d<this.$xmlDocLut.length;d++){if(!this.$xmlDocLut[d]){continue;}var u=this.$xmlDocLut[d].selectNodes("//self::node()[@"+this.xmlListenTag+"]");if(!u){continue;}for(var q=0;q<u.length;q++){var n=u[q].getAttribute(this.xmlListenTag).split(";");for(var s=[],g=0;g<n.length;g++){if(!w[n[g]]){s.push(n[g]);}}if(s.length!=n.length){u[q].setAttribute(this.xmlListenTag,s.join(";"));}}}};this.getXmlDocId=function(i,d){var j=i.ownerDocument.documentElement;if(!apf.isChildOf(j,i)){j=i;}var g=(j||i).getAttribute(this.xmlDocTag)||this.$xmlDocLut.indexOf(j||i.ownerDocument||i);if(!g||g==-1){g=this.$xmlDocLut.push(j||i.ownerDocument||i)-1;if(j){j.setAttribute(this.xmlDocTag,g);}}if(d){apf.nameserver.register("model",g,d);}return g;};});apf.queue={q:{},timer:null,add:function(c,a){this.q[c]=a;if(!this.timer){this.timer=$setTimeout("apf.queue.empty()");}},remove:function(a){delete this.q[a];},empty:function(d){clearTimeout(this.timer);this.timer=null;if(apf.layout&&apf.layout.$hasQueue){apf.layout.processQueue();}if(apf.xmldb&&apf.xmldb.$hasQueue){apf.xmldb.notifyQueued();}var c=this.q;for(var d in c){var a=c[d];if(a){delete c[d];a();}}}};apf.storage={modules:{},init:function(a){if(!a){a=this.autodetect();}var c=this.getProvider(a);apf.storage=apf.extend(this,c);apf.storage.init=null;apf.console.info("Installed storage provider '"+a+"'");return c;},getProvider:function(a){var c=apf.storage.modules[a];if(!c||typeof c!="object"){apf.console.warn("Could not find storage provider '"+a+"'");return false;}if(!c.isAvailable()){apf.console.warn("Storage provider '"+a+"' is not available");return false;}if(!c.initialized&&(!c.init||c.init()===false)){apf.console.warn("Could not install storage provider '"+a+"");return false;}c.name=a;apf.extend(c,this.base);return c;},autodetect:function(){for(var a in this.modules){if("memory|cookie".indexOf(a)>-1){continue;}if(this.modules[a].isAvailable()){return a;}}return !location.host&&this.modules.cookie?"cookie":(this.modules.memory?"memory":null);},base:{namespace:"default",isValidKeyArray:function(a){return(!a||!a.join)?false:/^[0-9A-Za-z_\.\-]*$/.test(a.join(""));},isValidKey:function(a){return(a===null||a===undefined)?false:/^[0-9A-Za-z_\.\-]*$/.test(a);},getAllPairs:function(g,c){var j=this.getKeys(g);if(!j||!j.length){return;}var a=this.getMultiple(j,g);for(var d=0;d<j.length&&a;d++){if(a[d]){c[j[d]]=a[d];}}return j.length;}}};apf.Sort=function(c){var d={};this.parseXml=function(q,k){if(k){d={};}d.order=q.order;d.getValue=q.csort||q.$compile("sort");d.getNodes=self[q["nodes-method"]];d.ascending=(d.order||"").indexOf("desc")==-1;d.order=null;if(q["data-type"]){d.method=g[q["data-type"]];}else{if(q["sort-method"]){d.method=self[q["sort-method"]];if(!d.method){throw new Error(apf.formatErrorString(0,null,"Sorting nodes","Invalid or missing sort function name provided '"+q["sort-method"]+"'",q));}}else{d.method=g.alpha;}}var s=q["date-format"];if(s){d.sort_dateFmtStr=s;d.method=g.date;var j=s.match(/(D+|Y+|M+|h+|m+|s+)/g);if(j){for(var t={},n=0;n<j.length;n++){t[j[n].substr(0,1)]=n+1;}d.dateFormat=new RegExp(s.replace(/([^\sDYMhms])/g,"\\$1").replace(/YYYY/,"(\\d\\d\\d\\d)").replace(/(DD|YY|MM|hh|mm|ss)/g,"(\\d\\d)"));d.dateReplace="$"+t.M+"/$"+t.D+"/$"+t.Y;if(t.h){d.dateReplace+=" $"+t.h+":$"+t.m+":$"+t.s;}}}};this.set=function(j,i){if(i){d={};}apf.extend(d,j);if(!d.ascending){d.ascending=j.order?j.order.indexOf("desc")==-1:true;}d.order=null;if(j.type){d.method=g[j.type];}else{if(j.method){d.method=self[j.method];}else{if(!d.method){d.method=g.alpha;}}}if(!d.getValue){d.getValue=function(k){return apf.queryValue(k,d.xpath);};}};this.get=function(){return apf.extend({},d);};this.findSortSibling=function(q,n){var j=getNodes?getNodes(q,n):this.getTraverseNodes(q);for(var k=0;k<j.length;k++){if(!compare(n,j[k],true,sortSettings)){return j[k];}}return null;};var a=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000"];var g={alpha:function(i){return i.toString().toLowerCase();},number:function(i){return(i.length<a.length?a[a.length-i.length]:"")+i;},date:function(j,i){var k=d.dateFormat;var q=d.dateReplace;var s=d.sort_dateFmtStr;var n;if(!k){n=new Date(j);}else{if(s=="*"){n=Date.parse(j);}else{n=(new Date(j.replace(k,q))).getTime();}}j=""+n.getTime();if(j=="NaN"){j="0";}return(j.length<a.length?a[a.length-j.length]:"")+j;}};this.apply=function(k,A,q,j,u){var B=[],t=k.length;while(t--){var C=d.getValue(k[t]);if(k){B[B.length]={toString:function(){return this.v;},xmlNode:k[t],v:(d.method||g.alpha)(C||"",A,k[t])};}}B.sort();var s=u?Math.min(B.length,j+u):B.length;if(!j){j=0;}if(q){if(d.ascending){for(t=j;t<s;t++){f(t,s,B[t].xmlNode,B[t].v);}}else{for(t=s-1;t>=j;t--){f(s-t-1,s,B[t].xmlNode,B[t].v);}}}else{var w=[];if(d.ascending){for(t=j;t<s;t++){w[w.length]=B[t].xmlNode;}}else{for(t=s-1;t>=j;t--){w[w.length]=B[t].xmlNode;}}return w;}};if(c){this.parseXml(c);}};apf.skins={skins:{},css:[],events:["onmousemove","onmousedown","onmouseup","onmouseout","onclick","ondragcopy","ondragstart"],Init:function(t,n,u){var d=(n?n.getAttribute("id"):null)||t.getAttribute("id");var g=(n?n.getAttribute("src").match(/\//)||u:"")?(u||n.getAttribute("src")).replace(/\/[^\/]*$/,"")+"/":"";var j=null,q=null;j=t.getAttribute("media-path");if(j!==null){j=apf.getAbsolutePath(g||apf.hostPath,j);}else{if(n){j=n.getAttribute("media-path");if(j!==null){j=apf.getAbsolutePath(apf.hostPath,j);}else{j=apf.getAbsolutePath(g||apf.hostPath,"images/");}}}q=t.getAttribute("icon-path");if(q!==null){q=apf.getAbsolutePath(g||apf.hostPath,q);}else{if(n){q=n.getAttribute("icon-path");if(q!==null){q=apf.getAbsolutePath(apf.hostPath,q);}else{q=apf.getAbsolutePath(g||apf.hostPath,"icons/");}}}if(!d){d="default";}if(t.getAttribute("id")){document.body.className+=" "+t.getAttribute("id");}var s=d.split("|");d=s[0];if(!this.skins[d]||d=="default"){this.skins[d]={base:g,name:d,iconPath:q,mediaPath:j,templates:{},originals:{},xml:t};if(s.length>1){for(var k=0;k<s.length;k++){this.skins[s[k]]=this.skins[d];}}}if(!this.skins["default"]&&this.$first==n){this.skins["default"]=this.skins[d];}var c=t.childNodes;for(var k=c.length-1;k>=0;k--){if(c[k].nodeType!=1){continue;}this.skins[d].templates[c[k].getAttribute("name")]=c[k];if(c[k].ownerDocument){this.importSkinDef(c[k],g,d);}}this.purgeCss(j,q);if(this.queue[d]){for(var a in this.queue[d]){this.queue[d][a]();}}},loadStylesheet:function(filename,title){var o;with(o=document.getElementsByTagName("head")[0].appendChild(document.createElement("LINK"))){rel="stylesheet";type="text/css";href=filename;title=title;}return o;},importSkinDef:function(xmlNode,basepath,name){var i,l,nodes=$xmlns(xmlNode,"style",apf.ns.aml),tnode,node;for(i=0,l=nodes.length;i<l;i++){node=nodes[i];if(node.getAttribute("src")){this.loadStylesheet(node.getAttribute("src").replace(/src/,basepath+"/src"));}else{var test=true;if(node.getAttribute("condition")){try{test=eval(node.getAttribute("condition"));}catch(e){test=false;}}if(test){tnode=node.firstChild;while(tnode){this.css.push(tnode.nodeValue);tnode=tnode.nextSibling;}}}}nodes=$xmlns(xmlNode,"alias",apf.ns.apf);var t=this.skins[name].templates;for(i=0;i<nodes.length;i++){if(!nodes[i].firstChild){continue;}t[nodes[i].firstChild.nodeValue.toLowerCase()]=xmlNode;}},loadedCss:"",purgeCss:function(a,d){if(!this.css.length){return;}var c=this.css.join("\n").replace(/images\//g,a).replace(/icons\//g,d);apf.importCssString(c);this.css=[];},loadCssInWindow:function(a,n,d,j){this.css=[];var c=a.split(":");var k=this.skins[c[0]];var g=k.templates[c[1]];this.importSkinDef(g,k.base,k.name);var i=this.css.join("\n").replace(/images\//g,d).replace(/icons\//g,j);apf.importCssString(i);this.css=[];},setSkinPaths:function(a,d){a=a.split(":");var c=a[0];var g=a[1];if(!this.skins[c]){throw new Error(apf.formatErrorString(1076,null,"Retrieving Skin","Could not find skin '"+c+"'",d.$aml));}d.iconPath=this.skins[c].iconPath;d.mediaPath=this.skins[c].mediaPath;},getTemplate:function(d,c){d=d.split(":");var j=d[0];var n=d[1];if(!this.skins[j]){if(c){return false;}throw new Error(apf.formatErrorString(1077,null,"Retrieving Template","Could not find skin '"+j+"'"));return false;}if(!this.skins[j].templates[n]){return false;}var q=this.skins[j].templates[n];var a=this.skins[j].originals[n];if(!a){a=this.skins[j].originals[n]={};if(!$xmlns(q,"presentation",apf.ns.aml)[0]){throw new Error(apf.formatErrorString(1078,null,"Retrieving Template","Missing presentation tag in '"+j+"'"));}var g=$xmlns(q,"presentation",apf.ns.aml)[0].childNodes;for(var k=0;k<g.length;k++){if(g[k].nodeType!=1){continue;}a[g[k].baseName||g[k][apf.TAGNAME]]=g[k];}}return a;},getCssString:function(a){return apf.queryValue($xmlns(this.skins[a.split(":")[0]].xml,"style",apf.ns.aml)[0],"text()");},queue:{},waitForSkin:function(a,d,c){if(this.skins[a]){return;}(this.queue[a]||(this.queue[a]={}))[d]=c;return true;},iconMaps:{},addIconMap:function(a){this.iconMaps[a.name]=a;if(a.size){a.width=a.height=a.size;}else{if(!a.width){a.width=1;}if(!a.height){a.height=1;}}},setIcon:function(d,n,a){if(!n){d.style.backgroundImage="";return;}if(d.tagName.toLowerCase()=="img"){d.setAttribute("src",n?(a||"")+n:"");return;}var k=n.split(":");var j=this.iconMaps[k[0]];if(j){var i,g,c=k[1].split(",");i=(c[(j.type=="vertical")?1:0]||0)*j.width;g=(c[(j.type=="vertical")?0:1]||0)*j.height;d.style.backgroundImage="url("+(a||"")+j.src+")";d.style.backgroundPosition=((-1*i)-j.offset[0])+"px "+((-1*g)-j.offset[1])+"px";}else{d.style.backgroundImage="url("+(a||"")+n+")";}}};apf.layout={layouts:{},addParent:function(c,a){var d;if(!(d=c.getAttribute("id"))){d=apf.setUniqueHtmlId(c);}return this.layouts[d]={layout:new apf.layoutParser(c,a),controls:[]};},splitters:{},freesplitters:[],vars:{},getSplitter:function(a){if(!this.splitters[this.getHtmlId(a.parentNode)]){this.splitters[this.getHtmlId(a.parentNode)]=[];}if(this.freesplitters.length){var c=this.freesplitters.pop();}else{var c=new apf.splitter();var d=apf.findHost(a.parentNode)||apf.document.documentElement;c.parentNode=d;c.skinset=apf.getInheritedAttribute(d,"skinset");c.dispatchEvent("DOMNodeInsertedIntoDocument");}this.splitters[this.getHtmlId(a.parentNode)].push(c);return c;},clearSplitters:function(d){var a=this.splitters[this.getHtmlId(d.parentNode)];if(!a){return;}for(var c=0;c<a.length;c++){this.freesplitters.push(a[c]);if(!a[c].$ext.parentNode){continue;}a[c].$ext.parentNode.removeChild(a[c].$ext);}a.length=0;},get:function(d,a){var c=this.layouts[d.getAttribute("id")];if(!c){c=this.addParent(d,a);}return c;},isLoadedXml:function(i){var a=i.childNodes;var j=i.selectSingleNode(".//node[@name]");var g=j?self[j.getAttribute("name")]:null;if(!g){throw new Error(apf.formatErrorString(0,null,"Loading Alignment from XML","Could not find AML node"+(j?" by name '"+j.getAttribute("name")+"'":""),i));}var d=g.$ext.parentNode;var c=this.getHtmlId(d);return(this.loadedXml[c]==i);},$loadFrom:function(a){apf.getData(a,{callback:function(c){if(!c){return;}if(!c){throw new Error(apf.formatErrorString(0,null,"Loading default layout","Could not find default layout using processing                      instruction: '"+a+"'"));return;}apf.layout.loadXml(c);}});},loadedXml:{},cacheXml:{},loadXml:function(k){var a=k.childNodes;var q=k.selectSingleNode(".//node[@name]");var j=q?self[q.getAttribute("name")]:null;if(!j){throw new Error(apf.formatErrorString(0,null,"Loading Alignment from XML","Could not find AML node"+(q?" by name '"+q.getAttribute("name")+"'":""),k));}var g=j.$ext.parentNode;var n=this.get(g,apf.getBox(k.getAttribute("margin")||""));var d=this.getHtmlId(g);this.metadata=[];for(var c=0;c<a.length;c++){if(a[c].nodeType!=1){continue;}n.root=this.parseXml(a[c],n);break;}this.compile(g);if(apf.window.inited){this.activateRules(g);}this.loadedXml[d]=k;},metadata:[],getData:function(a,c){return{vbox:(a=="vbox"),hbox:(a=="hbox"),node:"vbox|hbox".indexOf(a)==-1,children:[],isRight:false,isBottom:false,edgeMargin:0,splitter:null,minwidth:0,minheight:0,weight:1,pHtml:c.parentNode,size:[300,200],position:[0,0],last:{},toString:function(){var g=apf.vardump(this,null,false);for(var d=0;d<this.children.length;d++){g+="\n{Child "+d+"\n===========\n"+this.children[d].toString()+"}";}return g;},copy:function(){var g=apf.extend({},this);g.toString=this.toString;if(!this.node){g.children=[];for(var d=0;d<this.children.length;d++){g.children[d]=this.children[d].copy();g.children[d].parent=g;}}return g;},hidden:false,hiddenChildren:[],prehide:function(j){if(this.hidden==3){this.hidden=true;if(this.hid){apf.lookup(this.hid).visible=false;}if(this.oHtml){this.oHtml.style.display="none";}return;}if(this.hidden&&!j){return;}if(!this.parent){return;}this.hidepos={prev:this.parent.children[this.stackId-1],next:this.parent.children[this.stackId+1]};this.hidden=true;var g,s,q=0,k,d,n=["children","hiddenChildren"];while(n.length){g=this.parent[n.pop()];for(k=0,d=g.length;k<d;k++){s=g[k];if(s!=this&&!s.hidden){q=1;break;}}}if(!q){this.parent.prehide(j);}if(j){return this.hide(true);}if(apf.layout.dlist.contains(this)){apf.layout.dlist.remove(this);return false;}else{apf.layout.dlist.pushUnique(this);}},preshow:function(d){if(!this.hidden){return;}this.hidden=false;if(d){return this.show(true);}if(this.parent.hidden){this.parent.preshow();}if(apf.layout.dlist.contains(this)){apf.layout.dlist.remove(this);return false;}else{apf.layout.dlist.pushUnique(this);}},hide:function(g){var d=this.parent.children;d.removeIndex(this.stackId);for(var j=0;j<d.length;j++){d[j].stackId=j;}this.parent.hiddenChildren.push(this);if(g){return;}if(this.hidden!=3){if(this.hid){apf.lookup(this.hid).visible=false;}if(this.oHtml){this.oHtml.style.display="none";}}},show:function(g){var d=this.parent.children;if(this.hidepos.prev&&this.hidepos.prev.parent==this.parent&&!this.hidepos.prev.hidden&&!apf.layout.dlist.contains(this.hidepos.prev)){if(d.length<this.hidepos.prev.stackId+1){d.push(this);}else{d.insertIndex(this,this.hidepos.prev.stackId+1);}}else{if(this.hidepos.next&&this.hidepos.next.parent==this.parent&&!this.hidepos.next.hidden&&!apf.layout.dlist.contains(this.hidepos.next)){if(this.hidepos.next.stackId==0){d.unshift(this);}else{if(d.length<this.hidepos.next.stackId-1){d.push(this);}else{d.insertIndex(this,this.hidepos.next.stackId-1);}}}else{if(!this.hidepos.prev){d.unshift(this);}else{if(!this.hidepos.next){d.push(this);}else{if(this.stackId<d.length){d.insertIndex(this,this.stackId);}else{d.push(this);}}}}}for(var j=0;j<d.length;j++){if(d[j]){d[j].stackId=j;}}this.parent.hiddenChildren.remove(this);if(!g){if(this.hidden!=3){if(this.hid){apf.lookup(this.hid).visible=true;}if(this.oHtml){this.oHtml.style.display="block";}}}this.hidden=false;this.hidepos=null;},remove:function(){var j=this.parent;if(!j){return;}if(this.hidden||j.hiddenChildren.contains(this)){j.hiddenChildren.remove(this);apf.layout.dlist.remove(this);}else{var d=j.children;d.remove(this);for(var g=0;g<d.length;g++){d[g].stackId=g;}}for(var k in this.last){if(k=="splitter"){if(j.originalMargin){if(j.parent.pOriginalMargin){j.parent.splitter=null;j.parent.edgeMargin=j.parent.pOriginalMargin[0];j.parent.pOriginalMargin=null;delete j.last.splitter;}j.splitter=null;j.edgeMargin=j.originalMargin[0];j.originalMargin=null;}}this[k]=j[k]||this.last[k];}this.last={};if(!j.children.length&&!j.hiddenChildren.length){j.remove();}this.parent=null;},add:function(j){this.parent=j;if(this.hidden){var d=j.hiddenChildren;d.push(this);}else{var d=j.children;d.push(this);for(var g=0;g<d.length;g++){if(d[g]){d[g].stackId=g;}}}}};},parseXml:function(x,layout,amlNode,norecur){var aData=this.getData(typeof amlNode=="string"?amlNode:x.localName||x[apf.TAGNAME],layout.layout);if(aData.node){if(!amlNode){amlNode=self[x.getAttribute("name")];if(!amlNode){throw new Error(apf.formatErrorString(0,null,"Parsing Alignment from XML","Could not find AML node"+x.getAttribute("name"),x));}}aData.oHtml=amlNode.$ext;amlNode.aData=aData;amlNode.$setLayout("alignment");var aml=amlNode;if(aml.getAttribute("width")){aData.fwidth=aml.getAttribute("width");}if(aml.getAttribute("height")){aData.fheight=aml.getAttribute("height");}if(!this.getHtmlId(aData.oHtml)){apf.setUniqueHtmlId(aData.oHtml);}aData.id=this.getHtmlId(aData.oHtml);if(aData.oHtml.style){aData.oHtml.style.position="absolute";}aData.hid=amlNode.$uniqueId;}else{aData.id=this.metadata.push(aData)-1;}if(x.getAttribute("align")){aData.template=x.getAttribute("align");}if(x.getAttribute("lean")){aData.isBottom=x.getAttribute("lean").match(/bottom/);}if(x.getAttribute("lean")){aData.isRight=x.getAttribute("lean").match(/right/);}if(x.getAttribute("edge")&&x.getAttribute("edge")!="splitter"){aData.edgeMargin=x.getAttribute("edge");}if(x.getAttribute("weight")){aData.weight=parseFloat(x.getAttribute("weight"));}if(x.getAttribute("splitter")||x.getAttribute("edge")=="splitter"){aData.splitter=x.getAttribute("splitter")||(x.getAttribute("edge")=="splitter"?4:false);}if(x.getAttribute("width")){aData.fwidth=String(apf.parseExpression(x.getAttribute("width")));}if(x.getAttribute("height")){aData.fheight=String(apf.parseExpression(x.getAttribute("height")));}if(x.getAttribute("lastsplitter")){aData.lastsplitter=x.getAttribute("lastsplitter");}if(x.getAttribute("hidden")){aData.hidden=(x.getAttribute("hidden")==3)?x.getAttribute("hidden"):apf.isTrue(x.getAttribute("hidden"));}else{if(x.getAttribute("visible")=="false"){aData.hidden=true;}}if(x.getAttribute("state")){aData.state=x.getAttribute("state");}if(x.getAttribute("stack")){aData.stackId=parseInt(x.getAttribute("stack"));}if(x.getAttribute("position")){aData.position=x.getAttribute("position").split(",");}if(x.getAttribute("size")){aData.size=x.getAttribute("size").split(",");}if(aData.fwidth&&aData.fwidth.indexOf("/")>-1){aData.fwidth=eval(aData.fwidth);if(aData.fwidth<=1){aData.fwidth=(aData.fwidth*100)+"%";}}if(aData.fheight&&aData.fheight.indexOf("/")>-1){aData.fheight=eval(aData.fheight);if(aData.fheight<=1){aData.fheight=(aData.fheight*100)+"%";}}aData.edgeMargin=Math.max(aData.splitter||0,aData.edgeMargin||0);aData.xml=x;return aData;},checkInheritance:function(j){var g=j.children[j.children.length-1];if(j.originalMargin){if(j.parent.pOriginalMargin){j.parent.splitter=null;j.parent.edgeMargin=j.parent.pOriginalMargin[0];j.parent.pOriginalMargin=null;j.splitter=j.last.splitter;delete j.last.splitter;}j.splitter=null;var a=j.originalMargin[1];j.edgeMargin=j.originalMargin[0];a.splitter=a.splitter===false?false:a.last.splitter;j.originalMargin=null;delete a.last.splitter;}if(g&&g.template&&(g.splitter||g.splitter===null&&j.originalMargin)&&j.parent){if(!j.splitter){g.last.splitter=j.splitter=g.splitter;j.originalMargin=[j.edgeMargin,g];j.edgeMargin=Math.max(j.edgeMargin,j.splitter);}g.splitter=null;if(j.parent&&j.stackId==j.parent.children.length-1&&(j.parent.parent&&j.parent.parent.children.length>1)){if(!j.parent.splitter){j.last.splitter=j.parent.splitter=j.splitter;j.parent.last.splitter=null;j.parent.edgeMargin=Math.max(j.parent.edgeMargin,j.parent.splitter);j.parent.pOriginalMargin=[j.parent.edgeMargin];}j.splitter=null;}else{if(j.parent.pOriginalMargin){j.parent.splitter=null;j.parent.edgeMargin=j.parent.pOriginalMargin[0];j.parent.pOriginalMargin=null;j.splitter=j.last.splitter;delete j.last.splitter;}}}for(var d=0;d<j.children.length;d++){if(!j.children[d].node){this.checkInheritance(j.children[d]);}}var k=j.children[0];if(k&&j.parent){if(j.vbox){if(!j.fwidth&&k.fwidth||k.last.fwidth&&k.fwidth!==null&&k.last.fwidth==j.fwidth){k.last.fwidth=j.fwidth=k.fwidth;k.fwidth=null;}var c=j.parent;if((c&&!c.fheight&&k.fheight||k.last.fheight&&k.fheight!==null&&k.last.fheight==c.fheight)&&j.children.length==1){k.last.fheight=c.fheight=k.fheight;k.fheight=null;}}else{if((!j.fheight&&k.fheight||k.last.fheight&&k.fheight!==null&&k.last.fheight==j.fheight)&&j.children.length==1){k.last.fheight=j.fheight=k.fheight;k.fheight=null;}}if(k.weight||k.last.weight&&k.last.weight==j.weight){k.last.weight=j.weight=k.weight;}}},compileAlignment:function(c){if(!c.children.length){this.removeRule(c.pHtml,"layout");var a=this.layouts[c.pHtml.getAttribute("id")];if(a){apf.layout.clearSplitters(a.layout);}return;}var j=c.children;for(var g=false,d=0;d<j.length;d++){if(j[d].template=="bottom"){if(j[d].splitter){j[d-1].splitter=j[d].splitter;j[d].splitter=null;}j[d-1].edgeMargin=Math.max(j[d].edgeMargin,j[d-1].edgeMargin||0,j[d-1].splitter||0);j[d].edgeMargin=null;}if(j[d].hidden){j[d].prehide(true);}}this.checkInheritance(c);var a=this.layouts[c.pHtml.getAttribute("id")];a.layout.compile(c.copy());a.layout.reset();},addAlignNode:function(k,c){var C=(typeof k.align=="undefined"?k.getAttribute("align"):k.align).split("-");var F=c.children;var D=k.aData;if(typeof k.splitter=="undefined"){if(C[1]=="splitter"){D.splitter=C[2]||4;}else{D.splitter=false;}}D.edgeMargin=Math.max(D.edgeMargin,D.splitter||0);C=C[0];D.template=C;if(C=="top"){for(var d=F.length,u=0;u<F.length;u++){if(F[u].template!="top"){d=u;break;}}for(var u=F.length-1;u>=d;u--){F[u+1]=F[u];F[u].stackId=u+1;}F[d]=D;F[d].stackId=d;D.parent=c;}else{if(C=="bottom"){D.stackId=F.push(D)-1;D.parent=c;}else{var t=null;for(var d=-1,u=0;u<F.length;u++){if(F[u].hbox){t=F[u];break;}else{if(F[u].node&&F[u].template=="top"){d=u;}}}if(!t){var q=apf.layout.get(c.pHtml);t=apf.layout.parseXml(apf.xmldb.getXml("<hbox />"),q,null,true);t.parent=c;if(d>-1){for(var u=F.length-1;u>d;u--){F[u+1]=F[u];F[u].stackId++;}F[d+1]=t;t.stackId=d+1;}else{t.stackId=F.unshift(t)-1;}}var j,g=t.children.concat(t.hiddenChildren);for(var u=0;u<g.length;u++){if(g[u].template==C){j=g[u];break;}}g=t.children;if(!j){var q=apf.layout.get(c.pHtml);j=apf.layout.parseXml(apf.xmldb.getXml("<vbox />"),q,null,true);j.parent=t;j.template=C;if(C=="left"){if(!D.fwidth){var A;for(var E=false,u=0;u<g.length;u++){if(g[u].template=="middle"){E=g[u];break;}}if(E&&!E.children.length){g.remove(E);for(var u=0;u<g.length;u++){g[u].stackId=u;}}}g.unshift(j);for(var u=0;u<g.length;u++){g[u].stackId=u;}}else{if(C=="right"){if(D.fwidth){var A;for(var E=false,u=0;u<g.length;u++){if(g[u].template=="middle"||g[u].template=="left"&&!g[u].fwidth){E=true;break;}}if(!E){A=apf.layout.parseXml(apf.xmldb.getXml("<vbox />"),q,null,true);A.parent=t;A.template="middle";A.stackId=g.push(A)-1;}}j.stackId=g.push(j)-1;}else{if(C=="middle"){for(var B,u=0;u<g.length;u++){if(g[u].template=="right"){B=u;}}var w=g[B];if(w){g[B]=j;j.stackId=B;w.stackId=g.push(w)-1;}else{j.stackId=g.push(j)-1;}}}}}D.stackId=j.children.push(D)-1;D.parent=j;if(j.hidden){j.preshow(true);}}}},compile:function(d){var c=this.layouts[d.getAttribute("id")];if(!c){return false;}var a=c.root.copy();c.layout.compile(a);c.layout.reset();},removeAll:function(c){c.children.length=null;this.compileAlignment(c);var a=this.getHtmlId(c.pHtml);if(!this.rules[a]){delete this.qlist[a];}},timer:null,qlist:{},dlist:[],$hasQueue:false,queue:function(c,d,a){this.$hasQueue=true;var g;if(!(g=this.getHtmlId(c))){g=apf.setUniqueHtmlId(c);}if(this.qlist[g]){if(d){this.qlist[g][2].push(d);}if(a){this.qlist[g][1]=a;}return;}this.qlist[g]=[c,a,[d]];if(!this.timer){this.timer=$setTimeout("apf.layout.processQueue()");}},processQueue:function(){var d,k,a,j,g;for(d=0;d<this.dlist.length;d++){if(this.dlist[d].hidden){this.dlist[d].hide();}else{this.dlist[d].show();}}do{var c=this.qlist;this.qlist={};this.$hasQueue=false;for(k in c){j=c[k];if(j[1]){apf.layout.compileAlignment(j[1]);}g=j[2];for(d=0,a=g.length;d<a;d++){if(g[d]){g[d].$updateLayout();}}apf.layout.activateRules(j[0]);}}while(this.$hasQueue);if(apf.hasSingleRszEvent){apf.layout.forceResize();}this.dlist=[];clearTimeout(this.timer);this.timer=null;},rules:{},onresize:{},getHtmlId:function(a){return a.getAttribute?a.getAttribute("id"):1;},setRules:function(d,i,g,c){if(!this.getHtmlId(d)){apf.setUniqueHtmlId(d);}if(!this.rules[this.getHtmlId(d)]){this.rules[this.getHtmlId(d)]={};}var a=this.rules[this.getHtmlId(d)][i];if(!c&&a){this.rules[this.getHtmlId(d)][i]=g+"\n"+a;}else{this.rules[this.getHtmlId(d)][i]=g;}},getRules:function(a,c){return c?this.rules[this.getHtmlId(a)][c]:this.rules[this.getHtmlId(a)];},removeRule:function(g,k){var c=this.getHtmlId(g);if(!this.rules[c]){return;}var d=this.rules[c][k]||false;delete this.rules[c][k];var j;for(j in this.rules[c]){}if(!j){delete this.rules[c];}if(apf.hasSingleRszEvent){if(this.onresize[c]){this.onresize[c]=null;}else{var i=g.parentNode;while(i&&i.nodeType==1&&!this.onresize[i.getAttribute("id")]){i=i.parentNode;}if(i&&i.nodeType==1){var a=this.onresize[i.getAttribute("id")];if(a.children){delete a.children[c];}}}}return d;},activateRules:function(i,q){if(!i){var a,j;for(a in this.rules){j=document.getElementById(a);if(!j||j.onresize){continue;}this.activateRules(j);}if(apf.hasSingleRszEvent&&window.onresize){window.onresize();}return;}var k,g,s,w,u=[];if(!apf.hasSingleRszEvent){w=this.rules[this.getHtmlId(i)];if(!w){i.onresize=null;return false;}for(g in w){if(typeof w[g]!="string"){continue;}u.push(w[g]);}k=apf.needsCssPx?new Function(u.join("\n")):new Function(u.join("\n").replace(/ \+ 'px'|try\{\}catch\(e\)\{\}\n/g,""));i.onresize=k;if(!q){k();}}else{var d=this.getHtmlId(i);w=this.rules[d];if(!w){return false;}for(g in w){if(typeof w[g]!="string"){continue;}u.push(w[g]);}var c=i.parentNode;while(c&&c.nodeType==1&&!this.onresize[c.getAttribute("id")]){c=c.parentNode;}var n=new Function(u.join("\n"));if(this.onresize[d]){n.children=this.onresize[d].children;}if(c&&c.nodeType==1){var t=this.onresize[c.getAttribute("id")];(t.children||(t.children={}))[d]=n;}else{this.onresize[d]=n;}if(!q){n();}if(!window.onresize){var k=function(C){try{var E=[];for(var A in C){E.unshift(C[A]);}for(var B=0;B<E.length;B++){E[B]();if(E[B].children){k(E[B].children);}}}catch(D){}};window.onresize=function(){k(apf.layout.onresize);};}}},forceResize:function(j){if(apf.hasSingleRszEvent){return window.onresize&&window.onresize();}var c=j.onresize;if(c){c();}var g=j.getElementsByTagName("*");for(var d=0,a=g.length;d<a;d++){if(g[d].onresize){g[d].onresize();}}},paused:{},pause:function(c,d){if(apf.hasSingleRszEvent){var a=this.getHtmlId(c);this.paused[a]=this.onresize[a]||true;if(d){this.onresize[a]=d;this.onresize[a].children=this.paused[a].children;d();}else{delete this.onresize[a];}}else{this.paused[this.getHtmlId(c)]=c.onresize||true;if(d){c.onresize=d;d();}else{c.onresize=null;}}},play:function(c){if(!this.paused[this.getHtmlId(c)]){return;}if(apf.hasSingleRszEvent){var a=this.getHtmlId(c);var d=this.paused[a];if(typeof d=="function"){this.onresize[a]=d;}else{delete this.onresize[a];}if(window.onresize){window.onresize();}this.paused[this.getHtmlId(c)]=null;}else{var d=this.paused[this.getHtmlId(c)];if(typeof d=="function"){c.onresize=d;d();}else{c.onresize=null;}this.paused[this.getHtmlId(c)]=null;}}};apf.layout.load=apf.layout.loadXml;apf.getWindowWidth=function(){return apf.isIE?document.documentElement.offsetWidth-apf.windowHorBorder:window.innerWidth;};apf.getWindowHeight=function(){return apf.isIE?document.documentElement.offsetHeight-apf.windowVerBorder:window.innerHeight;};apf.layoutParser=function(a,d){d=(d&&d.length==4)?d:[0,0,0,0];this.pMargin=d;this.RULES=[];this.parentNode=a;if(!this.parentNode.getAttribute("id")){apf.setUniqueHtmlId(this.parentNode);}var j={};var g=0;var i=0;this.createSplitters=true;this.setMargin=function(k){d=k;};this.reset=function(){this.RULES=[];j={};this.lastType=this.globalEdge=this.globalSplitter=null;};this.compile=function(k,n){this.addRule("var v = apf.layout.vars");this.globalSplitter=k.splitter;this.globalEdge=k.edgeMargin;if(this.globalSplitter||this.globalEdge){this.setglobals(k);}this.preparse(k);this.parserules(k);if(this.createSplitters){apf.layout.clearSplitters(this);this.parsesplitters(k);}this.RULES=new c().calc(this.RULES);var q=("try{"+this.RULES.join("}catch(e){}\ntry{")+"}catch(e){}\n").replace(/([^=]+\.style[^=]+) = (.*?)\}/g,"$1 = ($2) + 'px'}");if(!apf.hasHtmlIdsInJs){q=q.replace(/q([\w|]+)\.(offset|style)/g,'document.getElementById("q$1").$2');}this.lastRoot=k;if(!n){apf.layout.setRules(this.parentNode,"layout",q,true);apf.layout.queue(this.parentNode);}else{return q;}return false;};this.addRule=function(k){this.RULES.push(k);};this.setglobals=function(n,q){if(!q&&this.globalEdge&&!n.edgeMargin&&(!n.xml||!n.xml.getAttribute("edge"))){if(!n.splitter){n.splitter=this.globalSplitter;}n.edgeMargin=Math.max(this.globalSplitter,this.globalEdge);}if(n.node){return;}for(var k=0;k<n.children.length;k++){this.setglobals(n.children[k],k==n.children.length-1);}};this.preparse=function(n){if(n.node){return;}else{var C=n.vbox?"height":"width";var s=0;var B=0;var H=0;n.childweight=0;n.childminwidth=0;n.childminheight=0;var G=["v."+C+"_"+n.id],q=[];var k=n.children;for(var u=0;u<k.length;u++){if(u<k.length-1){G.push(" - "+k[u].edgeMargin);}var A=k[u]["f"+C];if(A){q.push((A.indexOf("%")>-1)?" - ("+(k[u]["calc"+C]="v.innerspace_"+n.id+" * "+parseFloat(A)/100)+")":" - ("+A+")");}else{n.childweight+=k[u].weight;k[u]["calc"+C]="Math."+(u%2==0?"ceil":"floor")+"(v.restspace_"+n.id+" * ("+k[u].weight+"/v.weight_"+n.id+"))";}var w=(n.vbox?"width":"height");var E=k[u]["f"+w];if(!E){k[u]["calc"+w]=(n.vbox?"v.width_":"v.height_")+n.id;}else{k[u]["calc"+w]=E.indexOf("%")>-1?"v.innerspace_"+n.id+" * "+parseFloat(E)/100:E;}if(k[u].node&&k[u].xml.visible!==false){k[u].oHtml.style.display="block";}else{this.preparse(k[u]);}if(n.vbox){n.childminheight+=Math.max(k[u].childminheight||0,k[u].minheight||0,10)+k[u].edgeMargin;n.childminwidth=Math.max(n.childminwidth,k[u].minwidth||k[u].childminwidth||10);}else{n.childminwidth+=Math.max(k[u].minwidth||0,k[u].childminwidth||0,10)+k[u].edgeMargin;n.childminheight=Math.max(n.childminheight,k[u].minheight||k[u].childminheight||10);}}n.innerspace=G.join("");n.restspace=n.innerspace+" "+q.join("");if(!n.parent){var t=0,J=0;if(this.parentNode.tagName.toLowerCase()!="body"){var D=apf.getDiff(this.parentNode);J=D[0];t=D[1];}var I=(this.parentNode.tagName.toLowerCase()=="body"?"apf.getWindowWidth()":"document.getElementById('"+this.parentNode.id+"').offsetWidth");var F=(this.parentNode.tagName.toLowerCase()=="body"?"apf.getWindowHeight()":"document.getElementById('"+this.parentNode.id+"').offsetHeight");n.calcwidth="Math.max("+g+", "+I+" - "+(d[1])+" - "+d[3]+" - "+t+")";n.calcheight="Math.max("+i+", "+F+" - "+(d[2])+" - "+d[0]+" - "+J+")";}}};this.parserules=function(u){if(!u.node){this.addRule("v.width_"+u.id+" = Math.max("+u.childminwidth+","+u.minwidth+","+(u.calcwidth||u.fwidth)+")");this.addRule("v.height_"+u.id+" = Math.max("+u.childminheight+","+u.minheight+","+(u.calcheight||u.fheight)+")");this.addRule("v.weight_"+u.id+" = "+u.childweight);this.addRule("v.innerspace_"+u.id+" = "+u.innerspace);this.addRule("v.restspace_"+u.id+" = "+u.restspace);var n=apf.layout.metadata[u.id];n.calcData=u;u.original=n;if(!u.parent){this.addRule("v.left_"+u.id+" = "+d[3]);this.addRule("v.top_"+u.id+" = "+d[0]);for(var s=0;s<u.children.length;s++){this.parserules(u.children[s]);}return;}else{var B=["v.top_"+u.id," = "];var D=["v.left_"+u.id," = "];}}else{var B=[u.id,".style.top = "];var D=[u.id,".style.left = "];if(u.hid){var n=apf.lookup(u.hid).aData;n.calcData=u;u.original=n;}var t=u.oHtml;var A=apf.getDiff(t);var C=A[1];var q=A[0];if(u.calcwidth){this.addRule(u.id+".style.width = -"+q+" + Math.max( "+u.calcwidth+", "+u.minwidth+")");}else{t.style.width=Math.max(0,u.fwidth-q)+"px";}if(u.calcheight){this.addRule(u.id+".style.height = -"+C+" + Math.max( "+u.calcheight+", "+u.minheight+")");}else{t.style.height=Math.max(0,u.fheight-C)+"px";}}var k=u.parent.children[u.stackId-1];var w=u.parent.children[u.stackId+1];if(u.parent.vbox){if(u.parent.isBottom){if(!w){B.push("v.top_",u.parent.id," + v.height_",u.parent.id," - ",u.id,".offsetHeight");}else{if(w.node){B.push(w.id,".offsetTop - ",w.edgeMargin," - ",u.id,".offsetHeight");}else{B.push("v.top_"+w.id," - ",w.edgeMargin," - ",(u.node?u.id+".offsetHeight":"v.height_"+u.id));}}}else{if(!u.stackId){B.push("v.top_"+u.parent.id);}else{if(k){if(k.node){B.push(k.id,".offsetTop + ",k.id,".offsetHeight + ",k.edgeMargin);}else{B.push("v.top_",k.id," + v.height_",k.id," + ",k.edgeMargin);}}}}}else{B.push("v.top_"+u.parent.id);}if(u.parent.hbox){if(u.parent.isRight){if(!w){D.push("v.left_",u.parent.id," + v.width_",u.parent.id," - ",(u.node?u.id+".offsetWidth":"v.width_"+u.id),null);}else{if(w.node){D.push(w.id,".offsetLeft - ",w.edgeMargin," - ",(u.node?u.id+".offsetWidth":"v.width_"+u.id));}else{D.push("v.left_"+w.id," - ",w.edgeMargin," - ",(u.node?u.id+".offsetWidth":"v.width_"+u.id));}}}else{if(!u.stackId){D.push("v.left_"+u.parent.id);}else{if(k){if(k.node){D.push(k.id,".offsetLeft + ",k.id,".offsetWidth + ",k.edgeMargin);}else{D.push("v.left_",k.id," + v.width_",k.id," + ",k.edgeMargin);}}}}}else{D.push("v.left_"+u.parent.id);}if(D.length>2){this.addRule(D.join(""));}if(B.length>2){this.addRule(B.join(""));}if(!u.node){for(var s=0;s<u.children.length;s++){this.parserules(u.children[s]);}}};this.parsesplitters=function(n){if(n.parent&&n.splitter>0){apf.layout.getSplitter(this).init(n.splitter,n.hid,n);}if(!n.node){for(var k=0;k<n.children.length;k++){this.parsesplitters(n.children[k]);}}};function c(){this.parselookup={};this.nRules=[];this.doneRules={};this.maskText=function(s,q,n,k){return q+".offset"+n.toUpperCase();};this.handleVar=function(s,q,n,k){var t="a"+q.replace(/\|/g,"_")+"_style_"+n.toLowerCase();return j[t]?t:s;};this.parseRule=function(u){var q=u.split(" = "),A=q[0].replace(/^([_\w\d\|]+)\.style\.(\w)/,this.maskText),t="a"+q[0].replace(/[\.\|]/g,"_");j[t]=true;var s=q[1].split(/[ \(\)]/),w=[],k;for(var n=0;n<s.length;n++){if(s[n].match(/^([_\w\d\|]+)\.offset(\w+)$/)&&!s[n].match(/PNODE/)){w.push(s[n]);}}if(t.match(/width|height/i)){q[1]=q[1].replace(/^(\s*[\-\d]+[\s\-\+]+)/,"");k=q[0]+" = "+RegExp.$1+t;}else{k=q[0]+" = "+t;}if(u.match(/^v\./)){return{id:A,rule_p1:q[0]+" = ",rule_p2:q[1],ruleb:null,deps:w,processed:false};}return{id:A,rule_p1:"var "+t+" = ",rule_p2:q[1],ruleb:k,deps:w,processed:false};};this.calc=function(q){var n,u,t="";for(n=0;n<q.length;n++){if(q[n].match(/^var/)){this.nRules.push(q[n]);continue;}var s=this.parseRule(q[n],n);this.parselookup[s.id]=s;}for(u in this.parselookup){this.processNode(this.parselookup[u]);}for(u in this.parselookup){var k=this.parselookup[u];this.walkRules(k);}for(u in this.parselookup){this.nRules.push(this.parselookup[u].ruleb);}return this.nRules;};this.walkRules=function(k){if(this.doneRules[k.id]){return;}for(var n=0;n<k.deps.length;n++){if(k.deps[n]&&!k.deps[n].walked&&!this.doneRules[k.deps[n].id]){k.deps[n].walked=true;this.walkRules(k.deps[n]);}}this.doneRules[k.id]=true;this.nRules.push(k.rule_p1+k.rule_p2.replace(/([_\w\d\|]+)\.offset(\w+)/g,this.handleVar));};this.processNode=function(q){for(var n=0;n<q.deps.length;n++){var k=typeof q.deps[n]=="string"?this.parselookup[q.deps[n]]:q.deps[n];if(!k){q.deps[n]=null;continue;}q.deps[n]=k;if(!k.processed){k.processed=true;this.processNode(k);}}};}};apf.saveData=apf.getData=function(c,w){if(!c){return false;}var A,k=c.charAt(0),u=w.callback;var j=function(E,D,C){var B=this;$setTimeout(function(){t.call(B,E,D,C);});};var t=function(D,C,B){var E=w.callback;if(C!=apf.SUCCESS){return E(D,C,B||{});}return E(D,C,B||{});};if(!w){w={};}var i=w.fParsed||(c.indexOf("{")>-1||c.indexOf("[")>-1?apf.lm.compile(c,{withopt:true,precall:w._pc==-1?false:w._pc,alwayscb:true,simplexpath:true}):{str:c,type:2});if(i.type==3){if(i.xpaths[0]){var q=i.xpaths[0],s=i.xpaths[1];if(q=="#"||s=="#"){var g=(apf.lm.compile(c,{xpathmode:5}))();if(typeof g!="string"){q=g.model&&g.model.$isModel&&g.model;if(q){s=g.xpath;}else{if(g.model){q=apf.xmldb.findModel(g.model);s=apf.xmlToXpath(g.model,q.data)+(g.xpath?"/"+g.xpath:"");}else{throw new Error();}}}else{q=null;}}else{q=apf.nameserver.get("model",q);}if(!q){throw new Error("Could not find model '"+q+"' in "+c);}return j(q.data.selectSingleNode(s),apf.SUCCESS,{});}else{if(!w.xmlNode){throw new Error(apf.formatErrorString(0,null,"Loading data","Xpath found without model and no xmlNode specified"+c));}return j(w.xmlNode.data.selectSingleNode(i.xpaths[1]),apf.SUCCESS,{});}}if(k=="<"){if(i.type==2){A=i.str;}else{return i(w.xmlNode,j,w);}}else{if((k=="["||k=="{")){return i(w.xmlNode,j,w);}else{if(i.type==1||i.type==3){var n=u;u=w.callback=function(E,D,B){if(w._pc===true){return;}if(D!=apf.SUCCESS){return n.apply(this,arguments);}var C=E.split(" "),F="get";if(C.length>1&&C[0].length<10){F=C.shift();C=C.join(" ");}else{C=E;}u=w.callback=n;apf.oHttp.exec(F,[C],j,w);};i(w.xmlNode,j,w);}else{if(w._pc===true){return;}var d=c.split(" "),a="get";if(d.length>1&&d[0].length<10){a=d.shift();d=d.join(" ");}else{d=c;}apf.oHttp.exec(a,[d],j,w);}}}if(A){if(u){j(A,apf.SUCCESS,{});}else{return A;}}};apf.setModel=function(a,g){if(!a){return;}var d=a.indexOf("{")>-1||a.indexOf("[")>-1?apf.lm.compile(a,{alwayscb:true}):{type:2,str:a};if(a=="@default"||d.type==2){var c=apf.nameserver.get("model",a);if(c){return c.register(g);}else{if(a=="@default"){return;}}if(a.indexOf(".")==-1&&a.indexOf("/")==-1){apf.console.warn("Could not find model '"+a+"'");return;}}if(d.type==3){if(d.models){if(d.xpaths.length==2&&d.xpaths[0]!="#"&&d.xpaths[1]!="#"){if(!apf.nameserver.get("model",d.xpaths[0])){throw new Error("Could not find model '"+d.xpaths[0]+"' in "+a);}apf.nameserver.get("model",d.xpaths[0]).register(g,d.xpaths[1]);return;}}else{apf.console.warn("Xpath found without model. This might fail if no                context is specified using local(): "+a);}}if(g.clear){g.clear("loading");}apf.getData(a,{parsed:d,xmlNode:g&&g.xmlRoot,callback:function(n,k,i){if(k!=apf.SUCCESS){throw new Error(apf.formatErrorString(0,null,"Loading new data","Could not load data into model.                 \nMessage: "+i.message+"                \nInstruction: '"+a+"'"));}if(!n){return g.clear&&g.clear();}if(typeof n=="string"){if(n.charAt(0)=="<"){n=apf.getXml(n);}else{if(n.indexOf("http://")==0){return apf.setModel(n,g);}else{throw new Error("Invalid data from server");}}}var j=apf.xmldb.findModel(n);if(j){j.register(g,apf.xmlToXpath(n,j.data));}else{new apf.model().register(g).load(n);}}});};apf.storage.modules.gears=apf.storage.modules["gears.sql"]={table_name:"STORAGE",initialized:false,$available:null,$db:null,init:function(){this.factory=apf.nameserver.get("google","gears");this.database_name=apf.config.name.substr(0,46)+".apf.offline.gears";this.$db=this.factory.create("beta.database","1.0");this.$db.open(this.database_name);try{this.$sql("CREATE TABLE IF NOT EXISTS "+this.table_name+"(  namespace TEXT,  key TEXT,  value TEXT )");this.$sql("CREATE UNIQUE INDEX IF NOT EXISTS namespace_key_index ON "+this.table_name+" (namespace, key)");this.initialized=true;}catch(a){apf.console.warn(a.message);return false;}},$sql:function(c,d){var a=this.$db.execute(c,d);return this.$normalizeResults(a);},destroy:function(){this.$db.close();},$normalizeResults:function(a){var d=[];if(!a){return[];}while(a.isValidRow()){var j={};for(var c=0;c<a.fieldCount();c++){var k=a.fieldName(c);var g=a.field(c);j[k]=g;}d.push(j);a.next();}a.close();return d;},isAvailable:function(){return apf.isGears;},put:function(a,d,c){if(this.isValidKey(a)==false){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Invalid key given: "+a));}if(!c){c=this.namespace;}if(this.isValidKey(c)==false){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Invalid namespace given: "+c));}d=apf.serialize(d);try{this.$sql("DELETE FROM "+this.table_name+" WHERE namespace = ? AND key = ?",[c,a]);this.$sql("INSERT INTO "+this.table_name+" VALUES (?, ?, ?)",[c,a,d]);}catch(g){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Error setting name/value pair: "+g.message));return false;}return true;},get:function(c,d){if(this.isValidKey(c)==false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid key given: "+c));}if(!d){d=this.namespace;}if(this.isValidKey(d)==false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid namespace given: "+d));}var a=this.$sql("SELECT * FROM "+this.table_name+" WHERE namespace = ? AND  key = ?",[d,c]);if(!a.length){return null;}return apf.unserialize(a[0].value);},getNamespaces:function(){var d=[this.namespace];var a=this.$sql("SELECT namespace FROM "+this.table_name+" DESC GROUP BY namespace");for(var c=0;c<a.length;c++){if(a[c].namespace!=this.namespace){d.push(a[c].namespace);}}return d;},getKeys:function(g){if(!g){g=this.namespace;}if(this.isValidKey(g)==false){throw new Error(apf.formatErrorString(0,null,"Retrieving keys","Invalid namespace given: "+g));}var a=this.$sql("SELECT key FROM "+this.table_name+" WHERE namespace = ?",[g]);var d=[];for(var c=0;c<a.length;c++){d.push(a[c].key);}return d;},clear:function(a){if(!a){a=this.namespace;}if(this.isValidKey(a)==false){throw new Error(apf.formatErrorString(0,null,"Clearing storage","Invalid namespace given: "+a));}this.$sql("DELETE FROM "+this.table_name+" WHERE namespace = ?",[a]);},remove:function(a,c){if(!c){c=this.namespace;}if(this.isValidKey(c)==false){throw new Error(apf.formatErrorString(0,null,"Removing key","Invalid namespace given: "+c));}this.$sql("DELETE FROM "+this.table_name+" WHERE namespace = ? AND key = ?",[c,a]);},putMultiple:function(g,a,d){if(this.isValidKeyArray(g)===false||!a instanceof Array||g.length!=a.length){throw new Error(apf.formatErrorString(0,null,"Setting multiple name/value pairs","Invalid arguments: keys = ["+g+"],                                     values = ["+a+"]"));}if(!d){d=this.namespace;}if(this.isValidKey(d)==false){throw new Error(apf.formatErrorString(0,null,"Setting multiple name/value pairs","Invalid namespace given: "+d));}try{this.$sql.open();this.$sql.db.execute("BEGIN TRANSACTION");var k="REPLACE INTO "+this.table_name+" VALUES (?, ?, ?)";for(var c=0;c<g.length;c++){var j=apf.serialize(a[c]);this.$sql.db.execute(k,[d,g[c],j]);}this.$sql.db.execute("COMMIT TRANSACTION");this.$sql.close();}catch(n){throw new Error(apf.formatErrorString(0,null,"Writing multiple name/value pair","Error writing file: "+n.message));return false;}return true;},getMultiple:function(j,g){if(this.isValidKeyArray(j)===false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid key array given: "+j));}if(!g){g=this.namespace;}if(this.isValidKey(g)==false){throw new Error(apf.formatErrorString(0,null,"Getting multiple name/value pairs","Invalid namespace given: "+g));}var k="SELECT * FROM "+this.table_name+" WHERE namespace = ? AND  key = ?";var d=[];for(var c=0;c<j.length;c++){var a=this.$sql(k,[g,j[c]]);d[c]=a.length?apf.unserialize(a[0].value):null;}return d;},removeMultiple:function(d,c){if(this.isValidKeyArray(d)===false){throw new Error(apf.formatErrorString(0,null,"Removing name/value pair","Invalid key array given: "+d));}if(!c){c=this.namespace;}if(this.isValidKey(c)==false){throw new Error(apf.formatErrorString(0,null,"Removing multiple name/value pairs","Invalid namespace given: "+c));}this.$sql.open();this.$sql.db.execute("BEGIN TRANSACTION");var g="DELETE FROM "+this.table_name+" WHERE namespace = ? AND key = ?";for(var a=0;a<d.length;a++){this.$sql.db.execute(g,[c,d[a]]);}this.$sql.db.execute("COMMIT TRANSACTION");this.$sql.close();},isPermanent:function(){return true;},getMaximumSize:function(){return this.SIZE_NO_LIMIT;},hasSettingsUI:function(){return false;},showSettingsUI:function(){throw new Error(this.declaredClass+" does not support a storage settings user-interface");},hideSettingsUI:function(){throw new Error(this.declaredClass+" does not support a storage settings user-interface");}};apf.storage.modules.air={init:function(){this.ByteArray=window.runtime.flash.utils.ByteArray;this.EncryptedLocalStore=window.runtime.flash.data.EncryptedLocalStore;},isAvailable:function(){return apf.isAIR;},_getItem:function(a){var c=this.EncryptedLocalStore.getItem("__apf_"+a);return c?c.readUTFBytes(c.length):"";},_setItem:function(c,d){var a=new this.ByteArray();a.writeUTFBytes(d);this.EncryptedLocalStore.setItem("__apf_"+c,a);},_removeItem:function(a){this.EncryptedLocalStore.removeItem("__apf_"+a);},put:function(a,i,c){if(this.isValidKey(a)==false){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Invalid key given: "+a));}if(!c){c=this.namespace;}if(this.isValidKey(c)==false){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Invalid namespace given: "+c));}try{var g=this._getItem("namespaces")||"";if(g.indexOf("|"+c+"|")==-1){this._setItem("namespaces",g+c+"|");}var d=this._getItem(c+"_keys")||"";if(d.indexOf("|"+a+"|")==-1){this._setItem(c+"_keys",d+a+"|");}this._setItem("_"+c+"_"+a,i);}catch(j){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Error writing: "+j.message));return false;}return true;},get:function(a,c){if(this.isValidKey(a)==false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid key given: "+a));}if(!c){c=this.namespace;}if(this.isValidKey(c)==false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid namespace given: "+c));}return this._getItem("_"+c+"_"+a);},getNamespaces:function(){var c=[this.namespace];var d=(this._getItem("namespaces")||"").split("|");for(var a=0;a<d.length;a++){if(d[a]&&d[a]!=this.namespace){c.push(d[a]);}}return c;},getKeys:function(d){if(!d){d=this.namespace;}if(this.isValidKey(d)==false){throw new Error(apf.formatErrorString(0,null,"Getting keys","Invalid namespace given: "+d));}var c=[];var g=(this._getItem(d+"_keys")||"").split("|");for(var a=0;a<g.length;a++){if(g[a]){c.push(g[a]);}}return c;},clear:function(c){if(!c){c=this.namespace;}if(this.isValidKey(c)==false){throw new Error(apf.formatErrorString(0,null,"Clearing storage","Invalid namespace given: "+c));}var g=this._getItem("namespaces")||"";if(g.indexOf("|"+c+"|")!=-1){this._setItem("namespaces",g.replace("|"+c+"|","|"));}var d=(this._getItem(c+"_keys")||"").split("|");for(var a=0;a<d.length;a++){if(d[a].length){this._removeItem(c+"_"+d[a]);}}this._removeItem(c+"_keys");},remove:function(a,c){if(!c){c=this.namespace;}if(this.isValidKey(c)==false){throw new Error(apf.formatErrorString(0,null,"Removing key","Invalid namespace given: "+c));}var d=this._getItem(c+"_keys")||"";if(d.indexOf("|"+a+"|")!=-1){this._setItem(c+"_keys",d.replace("|"+a+"|","|"));}this._removeItem("_"+c+"_"+a);},putMultiple:function(g,a,d){if(this.isValidKeyArray(g)===false||!a instanceof Array||g.length!=a.length){throw new Error(apf.formatErrorString(0,null,"Setting multiple name/value pairs","Invalid arguments: keys = ["+g+"], values = ["+a+"]"));}if(!d){d=this.namespace;}if(this.isValidKey(d)==false){throw new Error(apf.formatErrorString(0,null,"Setting multiple name/value pairs","Invalid namespace given: "+d));}try{for(var c=0;c<g.length;c++){this.put(g[c],value[c],null,d);}}catch(j){throw new Error(apf.formatErrorString(0,null,"Writing multiple name/value pair","Error writing file: "+j.message));return false;}return true;},getMultiple:function(g,d){if(this.isValidKeyArray(g)===false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid key array given: "+g));}if(!d){d=this.namespace;}if(this.isValidKey(d)==false){throw new Error(apf.formatErrorString(0,null,"Getting multiple name/value pairs","Invalid namespace given: "+d));}var c=[];for(var a=0;a<g.length;a++){c[a]=this.get(g[a],d);}return c;},removeMultiple:function(d,c){if(this.isValidKeyArray(d)===false){throw new Error(apf.formatErrorString(0,null,"Removing name/value pair","Invalid key array given: "+d));}if(!c){c=this.namespace;}if(this.isValidKey(c)==false){throw new Error(apf.formatErrorString(0,null,"Removing multiple name/value pairs","Invalid namespace given: "+c));}for(var a=0;a<d.length;a++){this.remove(d[a],c);}},isPermanent:function(){return true;},getMaximumSize:function(){return this.SIZE_NO_LIMIT;},hasSettingsUI:function(){return false;},showSettingsUI:function(){throw new Error(this.declaredClass+" does not support a storage settings user-interface");},hideSettingsUI:function(){throw new Error(this.declaredClass+" does not support a storage settings user-interface");}};apf.storage.modules.memory={initialized:true,store:{},isAvailable:function(){return true;},put:function(a,d,c){if(this.isValidKey(a)==false){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Invalid key given: "+a));}if(!c){c=this.namespace;}if(this.isValidKey(c)==false){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Invalid namespace given: "+c));}d=apf.serialize(d);if(!this.store[c]){this.store[c]={};}this.store[c][a]=d;},get:function(a,c){if(this.isValidKey(a)==false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid key given: "+a));}if(!c){c=this.namespace;}if(this.isValidKey(c)==false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid namespace given: "+c));}if(!this.store[c]||!this.store[c][a]){return null;}return apf.unserialize(this.store[c][a]);},getNamespaces:function(){var a=[this.namespace];for(var c in this.store){a.push(c);}return a;},getKeys:function(c){if(!c){c=this.namespace;}if(this.isValidKey(c)==false){throw new Error(apf.formatErrorString(0,null,"Clearing storage","Invalid namespace given: "+c));}var a=[];for(var d in this.store[c]){a.push(d);}return a;},clear:function(a){if(!a){a=this.namespace;}if(this.isValidKey(a)==false){throw new Error(apf.formatErrorString(0,null,"Clearing storage","Invalid namespace given: "+a));}delete this.store[a];},remove:function(a,c){if(!c){c=this.namespace;}if(this.isValidKey(c)==false){throw new Error(apf.formatErrorString(0,null,"Removing key","Invalid namespace given: "+c));}if(this.store[c]){delete this.store[c][a];}},putMultiple:function(g,a,d){if(this.isValidKeyArray(g)===false||!a instanceof Array||g.length!=a.length){throw new Error(apf.formatErrorString(0,null,"Setting multiple name/value pairs","Invalid arguments: keys = ["+g+"],                                     values = ["+a+"]"));}if(!d){d=this.namespace;}if(this.isValidKey(d)==false){throw new Error(apf.formatErrorString(0,null,"Setting multiple name/value pairs","Invalid namespace given: "+d));}if(!this.store[d]){this.store[d]={};}for(var c=0;c<g.length;c++){this.store[d][g[c]]=apf.serialize(a[c]);}return true;},getMultiple:function(g,d){if(this.isValidKeyArray(g)===false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid key array given: "+g));}if(!d){d=this.namespace;}if(this.isValidKey(d)==false){throw new Error(apf.formatErrorString(0,null,"Getting multiple name/value pairs","Invalid namespace given: "+d));}if(!this.store[d]){return[];}var c=[];for(var a=0;a<g.length;a++){if(this.store[d][g[a]]){c.push(apf.unserialize(this.store[d][g[a]]));}}return c;},removeMultiple:function(d,c){if(this.isValidKeyArray(d)===false){throw new Error(apf.formatErrorString(0,null,"Removing name/value pair","Invalid key array given: "+d));}if(!c){c=this.namespace;}if(this.isValidKey(c)==false){throw new Error(apf.formatErrorString(0,null,"Removing multiple name/value pairs","Invalid namespace given: "+c));}if(!this.store[c]){return;}for(var a=0;a<d.length;a++){delete this.store[c][d[a]];}},isPermanent:function(){return false;},getMaximumSize:function(){return this.SIZE_NO_LIMIT;},hasSettingsUI:function(){return false;},showSettingsUI:function(){throw new Error(this.declaredClass+" does not support a storage settings user-interface");},hideSettingsUI:function(){throw new Error(this.declaredClass+" does not support a storage settings user-interface");}};apf.storage.modules.flash={initialized:false,asyncInit:true,_available:null,_statusHandler:null,_flashReady:false,_pageReady:false,delayCalls:[],init:function(){this.name="flashStorage";this.id=apf.flash.addPlayer(this);this.STORAGE_SWF=(apf.config.resourcePath||apf.basePath)+"resources/apfStorage.swf?cachebust="+new Date().getTime();var flash=apf.flash.buildContent("src",this.STORAGE_SWF,"width","215","height","138","align","middle","id",this.name,"quality","high","bgcolor","#ffffff","allowFullScreen","true","name",this.name,"flashvars","playerID="+this.id,"allowScriptAccess","always","type","application/x-shockwave-flash","pluginspage","http://www.adobe.com/go/getflashplayer","menu","true");this.container=document.createElement("div");this.container.id=this.name+"_Container";this.container.className="apfVideo";with(this.container.style){width=height="0px";overflow="hidden";}document.body.appendChild(this.container);this.container.innerHTML=flash;this.player=apf.flash.getElement(this.name);this._allNamespaces=this.getNamespaces();this._flashReady=this._pageReady=true;},setVisible:function(visible){if(visible==true){this.container.style.position="absolute";this.container.style.visibility="visible";}else{with(this.container.style){position="absolute";x="-1000px";y="-1000px";visibility="hidden";}}return this;},callMethod:function(){if(!this.initialized||typeof this.player.callMethod!="function"){this.delayCalls.push(arguments);}else{var c=[this.player,"callMethod"],g=apf.flash,d=0,a=arguments.length;for(;d<a;d++){c.push(g.encode(c[d]));}g.remote.apply(null,c);}},delayedCallTimer:null,makeDelayCalls:function(){clearTimeout(this.delayedCallTimer);if(!this.delayCalls.length){if(typeof this["onready"]=="function"){this.onready();}return this;}this.callMethod.apply(this,this.delayCalls[0]);this.delayCalls.splice(0,1);var a=this;this.delayedCallTimer=window.setTimeout(function(){a.makeDelayCalls();},1);return this;},ready:function(a){if(this.initialized){a();}else{this.onready=a;}},event:function(c,d){if(c=="status"){var a=apf.storage;if(statusResult==a.PENDING){this.setVisible(true);}else{this.setVisible(false);}if(a._statusHandler){a._statusHandler.call(null,d.status,d.keyName,d.namespace);}}else{if(c=="loaded"){this.initialized=true;this.setVisible(false).makeDelayCalls();}}},setFlushDelay:function(a){if(a===null||typeof a==="undefined"||isNaN(a)){throw new Error("Invalid argunment: "+a);}this.callMethod("setFlushDelay",String(a));},getFlushDelay:function(){return Number(this.callMethod("getFlushDelay"));},flush:function(a){if(a==null||typeof a=="undefined"){a=apf.storage.namespace;}this.callMethod("flush",a);},isAvailable:function(){return location.protocol!="file:"&&apf.flash.isEightAvailable();},put:function(a,d,c){if(this.isValidKey(a)==false){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Invalid key given: "+a));}if(!c){c=this.namespace;}if(this.isValidKey(c)==false){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Invalid namespace given: "+c));}this.callMethod("put",a,apf.serialize(d),c);},putMultiple:function(k,c,g){if(this.isValidKeyArray(k)===false||!c instanceof Array||k.length!=c.length){throw new Error(apf.formatErrorString(0,null,"Setting multiple name/value pairs","Invalid arguments: keys = ["+k+"], values = ["+c+"]"));}if(!g){g=this.namespace;}if(this.isValidKey(g)==false){throw new Error(apf.formatErrorString(0,null,"Setting multiple name/value pairs","Invalid namespace given: "+g));}var n=k.join(",");var q=[];for(var d=0;d<c.length;d++){c[d]=apf.unserialize(c[d]);q[d]=c[d].length;}var a=c.join("");var j=q.join(",");this.callMethod("putMultiple",n,a,j,g);},get:function(c,d){if(this.isValidKey(c)==false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid key given: "+c));}if(!d){d=this.namespace;}if(this.isValidKey(d)==false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid namespace given: "+d));}var a=this.callMethod("get",c,d);if(a==""){return null;}return apf.unserialize(apf.flash.decode(a));},getMultiple:function(keys,namespace){if(this.isValidKeyArray(keys)===false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid key array given: "+keys));}if(!namespace){namespace=this.namespace;}if(this.isValidKey(namespace)==false){throw new Error(apf.formatErrorString(0,null,"Getting multiple name/value pairs","Invalid namespace given: "+namespace));}var metaKey=keys.join(",");var metaResults=this.callMethod("getMultiple",metaKey,namespace);if(!metaResults){return null;}var results=eval("("+metaResults.replace(/""([^",\]]+)/g,'"\\"$1').replace(/([^",]+)""/g,'$1\\""')+")");for(var i=0;i<results.length;i++){results[i]=(results[i]=="")?null:apf.unserialize(apf.flash.decode(results[i]));}return results;},_destringify:function(results){if(typeof results=="string"&&(/^string:/.test(results))){results=results.substring("string:".length);}else{results=eval(results);}return results;},getKeys:function(c){if(!c){c=this.namespace;}if(this.isValidKey(c)==false){throw new Error(apf.formatErrorString(0,null,"Clearing storage","Invalid namespace given: "+c));}var a=this.callMethod("getKeys",c);if(a==this||a==null||a=="null"){a="";}a=a.split(",");a.sort();return a;},getNamespaces:function(){var a=this.callMethod("getNamespaces");if(a==this||a==null||a=="null"){a=apf.storage.namespace||"default";}a=a.split(",");a.sort();return a;},clear:function(a){if(!a){a=this.namespace;}if(this.isValidKey(a)==false){throw new Error(apf.formatErrorString(0,null,"Clearing storage","Invalid namespace given: "+a));}this.callMethod("clear",a);},remove:function(a,c){if(!c){c=this.namespace;}if(this.isValidKey(c)==false){throw new Error(apf.formatErrorString(0,null,"Removing key","Invalid namespace given: "+c));}this.callMethod("remove",a,c);},removeMultiple:function(c,a){if(this.isValidKeyArray(c)===false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid key array given: "+c));}if(!a){a=this.namespace;}if(this.isValidKey(a)==false){throw new Error(apf.formatErrorString(0,null,"Getting multiple name/value pairs","Invalid namespace given: "+a));}var d=c.join(",");this.callMethod("removeMultiple",d,a);},isPermanent:function(){return true;},getMaximumSize:function(){return this.SIZE_NO_LIMIT;},hasSettingsUI:function(){return false;},showSettingsUI:function(){throw new Error(apf.formatErrorString(0,null,this.declaredClass+" does not support a storage settings user-interface"));},hideSettingsUI:function(){throw new Error(apf.formatErrorString(0,null,this.declaredClass+" does not support a storage settings user-interface"));},getResourceList:function(){return[];}};apf.storage.modules.cookie={initialized:true,isAvailable:function(){return true;},put:function(a,d,c){if(this.isValidKey(a)==false){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Invalid key given: "+a));}if(!c){c=this.namespace;}if(this.isValidKey(c)==false){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Invalid namespace given: "+c));}d=apf.serialize(d);apf.setcookie(c+"~"+a,d,new Date().getTime()+(60*60*24*365*10000));},get:function(a,c){if(this.isValidKey(a)==false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid key given: "+a));}if(!c){c=this.namespace;}if(this.isValidKey(c)==false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid namespace given: "+c));}var d=apf.getcookie(c+"~"+a);return d?apf.unserialize(d):null;},getNamespaces:function(){throw new Error("Not Implemented");var a=[this.namespace];for(var c in this.store){a.push(c);}return a;},getKeys:function(c){throw new Error("Not Implemented");if(!c){c=this.namespace;}if(this.isValidKey(c)==false){throw new Error(apf.formatErrorString(0,null,"Clearing storage","Invalid namespace given: "+c));}var a=[];for(var d in this.store[c]){a.push(d);}return a;},clear:function(a){throw new Error("Not Implemented");if(!a){a=this.namespace;}if(this.isValidKey(a)==false){throw new Error(apf.formatErrorString(0,null,"Clearing storage","Invalid namespace given: "+a));}delete this.store[a];},remove:function(a,c){if(!c){c=this.namespace;}if(this.isValidKey(c)==false){throw new Error(apf.formatErrorString(0,null,"Removing key","Invalid namespace given: "+c));}apf.delcookie(c+"~"+a);},putMultiple:function(g,a,d){throw new Error("Not Implemented");if(this.isValidKeyArray(g)===false||!a instanceof Array||g.length!=a.length){throw new Error(apf.formatErrorString(0,null,"Setting multiple name/value pairs","Invalid arguments: keys = ["+g+"],                                     values = ["+a+"]"));}if(!d){d=this.namespace;}if(this.isValidKey(d)==false){throw new Error(apf.formatErrorString(0,null,"Setting multiple name/value pairs","Invalid namespace given: "+d));}if(!this.store[d]){this.store[d]={};}for(var c=0;c<g.length;c++){this.store[d][g[c]]=apf.serialize(a[c]);}return true;},getMultiple:function(g,d){throw new Error("Not Implemented");if(this.isValidKeyArray(g)===false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid key array given: "+g));}if(!d){d=this.namespace;}if(this.isValidKey(d)==false){throw new Error(apf.formatErrorString(0,null,"Getting multiple name/value pairs","Invalid namespace given: "+d));}if(!this.store[d]){return[];}var c=[];for(var a=0;a<g.length;a++){if(this.store[d][g[a]]){c.push(apf.unserialize(this.store[d][g[a]]));}}return c;},removeMultiple:function(d,c){throw new Error("Not Implemented");if(this.isValidKeyArray(d)===false){throw new Error(apf.formatErrorString(0,null,"Removing name/value pair","Invalid key array given: "+d));}if(!c){c=this.namespace;}if(this.isValidKey(c)==false){throw new Error(apf.formatErrorString(0,null,"Removing multiple name/value pairs","Invalid namespace given: "+c));}if(!this.store[c]){return;}for(var a=0;a<d.length;a++){delete this.store[c][d[a]];}},isPermanent:function(){return false;},getMaximumSize:function(){return this.SIZE_NO_LIMIT;},hasSettingsUI:function(){return false;},showSettingsUI:function(){throw new Error(this.declaredClass+" does not support a storage settings user-interface");},hideSettingsUI:function(){throw new Error(this.declaredClass+" does not support a storage settings user-interface");}};apf.storage.modules.html5={domain:(location.hostname=="localhost")?"localhost.localdomain":location.hostname,initialized:true,storage:apf.isIE?self.localStorage:self.globalStorage,isAvailable:function(){try{var c=this.storage[location.href];}catch(a){return false;}return true;},put:function(a,d,c){if(this.isValidKey(a)==false){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Invalid key given: "+a));}a=this.getFullKey(a,c);d=apf.serialize(d);try{var i=this.storage[this.domain];i.setItem(a,d);}catch(g){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Could not set name/value pair"));}},get:function(c,d){if(this.isValidKey(c)==false){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Invalid key given: "+c));}c=this.getFullKey(c,d);var g=this.storage[this.domain];var a=g.getItem(c);if(a==null||a==""){return null;}return apf.unserialize(a);},getNamespaces:function(){var d=[this.namespace];var j={};var k=this.storage[this.domain];var a=/^__([^_]*)_/;for(var c=0;c<k.length;c++){var n=k.key(c);if(a.test(n)==true){var g=n.match(a)[1];if(typeof j[g]=="undefined"){j[g]=true;d.push(g);}}}return d;},getKeys:function(d){if(!d){d=this.namespace;}if(this.isValidKey(d)==false){throw new Error(apf.formatErrorString(0,null,"Getting keys","Invalid namespace given: "+d));}var k=new RegExp(d==this.namespace?"^([^_]{2}.*)$":"^__"+d+"_(.*)$");var g=this.storage[this.domain];var a=[];for(var c=0;c<g.length;c++){var j=g.key(c);if(k.test(j)==true){j=j.match(k)[1];a.push(j);}}return a;},clear:function(c){if(!c){c=this.namespace;}if(this.isValidKey(c)==false){throw new Error(apf.formatErrorString(0,null,"Clearing storage","Invalid namespace given: "+c));}var g=new RegExp(c==this.namespace?"^[^_]{2}":"^__"+c+"_");var d=this.storage[this.domain];for(var a=d.length-1;a>=0;a--){if(g.test(d.key(a))==true){d.removeItem(d.key(a));}}},remove:function(a,c){a=this.getFullKey(a,c);var d=this.storage[this.domain];d.removeItem(a);},isPermanent:function(){return true;},getMaximumSize:function(){return 0;},hasSettingsUI:function(){return false;},showSettingsUI:function(){throw new Error(apf.formatErrorString(0,null,this.declaredClass+" does not support a storage settings user-interface"));},hideSettingsUI:function(){throw new Error(apf.formatErrorString(0,null,this.declaredClass+" does not support a storage settings user-interface"));},getFullKey:function(a,c){if(!c){c=this.namespace;}if(this.isValidKey(c)==false){throw new Error(apf.formatErrorString(0,null,"Clearing storage","Invalid namespace given: "+c));}return c==this.namespace?a:"__"+c+"_"+a;}};apf.storage.modules["air.file"]={initialized:false,init:function(){this.File=window.runtime.flash.filesystem.File;this.FileStream=window.runtime.flash.filesystem.FileStream;this.FileMode=window.runtime.flash.filesystem.FileMode;this.storagePath="__APF_"+(apf.config.name?apf.config.name.toUpperCase():"STORAGE")+"/";try{var a=this.File.applicationStorageDirectory.resolvePath(this.storagePath);if(!a.exists){a.createDirectory();}this.initialized=true;}catch(c){apf.console.warn(c.message);return false;}},isAvailable:function(){return apf.isAIR;},put:function(d,i,g){if(this.isValidKey(d)==false){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Invalid key given: "+d));}if(!g){g=this.namespace;}if(this.isValidKey(g)==false){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Invalid namespace given: "+g));}try{this.remove(d,g);var a=this.File.applicationStorageDirectory.resolvePath(this.storagePath+g);if(!a.exists){a.createDirectory();}var c=a.resolvePath(d);var k=new this.FileStream();k.open(c,this.FileMode.WRITE);k.writeObject(i);k.close();}catch(j){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Error writing file: "+j.message));return false;}return true;},get:function(d,g){if(this.isValidKey(d)==false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid key given: "+d));}if(!g){g=this.namespace;}if(this.isValidKey(g)==false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid namespace given: "+g));}var c=this.File.applicationStorageDirectory.resolvePath(this.storagePath+g+"/"+d);if(!c.exists||c.isDirectory){return false;}var i=new this.FileStream();i.open(c,this.FileMode.READ);var a=i.readObject();i.close();return a;},getNamespaces:function(){var d=[this.namespace];var a=this.File.applicationStorageDirectory.resolvePath(this.storagePath);var g=a.getDirectoryListing();for(var c=0;c<g.length;c++){if(g[c].isDirectory&&g[c].name!=this.namespace){d.push(g[c].name);}}return d;},getKeys:function(g){if(!g){g=this.namespace;}if(this.isValidKey(g)==false){throw new Error(apf.formatErrorString(0,null,"Clearing storage","Invalid namespace given: "+g));}var d=[];var a=this.File.applicationStorageDirectory.resolvePath(this.storagePath+g);if(a.exists&&a.isDirectory){var j=a.getDirectoryListing();for(var c=0;c<j.length;c++){d.push(j[c].name);}}return d;},clear:function(c){if(!c){c=this.namespace;}if(this.isValidKey(c)==false){throw new Error(apf.formatErrorString(0,null,"Clearing storage","Invalid namespace given: "+c));}var a=this.File.applicationStorageDirectory.resolvePath(this.storagePath+c);if(a.exists&&a.isDirectory){a.deleteDirectory(true);}},remove:function(c,d){if(!d){d=this.namespace;}if(this.isValidKey(d)==false){throw new Error(apf.formatErrorString(0,null,"Removing key","Invalid namespace given: "+d));}var a=this.File.applicationStorageDirectory.resolvePath(this.storagePath+d+"/"+c);if(a.exists&&!a.isDirectory){a.deleteFile();}},putMultiple:function(g,a,d){if(this.isValidKeyArray(g)===false||!a instanceof Array||g.length!=a.length){throw new Error(apf.formatErrorString(0,null,"Setting multiple name/value pairs","Invalid arguments: keys = ["+g+"], values = ["+a+"]"));}if(!d){d=this.namespace;}if(this.isValidKey(d)==false){throw new Error(apf.formatErrorString(0,null,"Setting multiple name/value pairs","Invalid namespace given: "+d));}try{for(var c=0;c<g.length;c++){this.put(g[c],a[c],null,d);}}catch(j){throw new Error(apf.formatErrorString(0,null,"Writing multiple name/value pair","Error writing file: "+j.message));return false;}return true;},getMultiple:function(g,d){if(this.isValidKeyArray(g)===false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid key array given: "+g));}if(!d){d=this.namespace;}if(this.isValidKey(d)==false){throw new Error(apf.formatErrorString(0,null,"Getting multiple name/value pairs","Invalid namespace given: "+d));}var c=[];for(var a=0;a<g.length;a++){c[a]=this.get(g[a],d);}return c;},removeMultiple:function(d,c){if(this.isValidKeyArray(d)===false){throw new Error(apf.formatErrorString(0,null,"Removing name/value pair","Invalid key array given: "+d));}if(!c){c=this.namespace;}if(this.isValidKey(c)==false){throw new Error(apf.formatErrorString(0,null,"Removing multiple name/value pairs","Invalid namespace given: "+c));}for(var a=0;a<d.length;a++){this.remove(d[a],c);}},isPermanent:function(){return true;},getMaximumSize:function(){return this.SIZE_NO_LIMIT;},hasSettingsUI:function(){return false;},showSettingsUI:function(){throw new Error(this.declaredClass+" does not support a storage settings user-interface");},hideSettingsUI:function(){throw new Error(this.declaredClass+" does not support a storage settings user-interface");}};apf.storage.modules["air.sql"]={database_file:"apf.db",initialized:false,_db:null,init:function(){this.File=window.runtime.flash.filesystem.File;this.SQLConnection=window.runtime.flash.data.SQLConnection;this.SQLStatement=window.runtime.flash.data.SQLStatement;this.table_name="__APF_"+(apf.config.name?apf.config.name.toUpperCase():"STORAGE");try{this._db=new this.SQLConnection();this._db.open(this.File.applicationStorageDirectory.resolvePath(this.database_file));this._sql("CREATE TABLE IF NOT EXISTS "+this.table_name+"(namespace TEXT, key TEXT, value TEXT)");this._sql("CREATE UNIQUE INDEX IF NOT EXISTS namespace_key_index ON "+this.table_name+" (namespace, key)");this.initialized=true;}catch(a){apf.console.warn(a.message);return false;}},_sql:function(c,d){var a=new this.SQLStatement();a.sqlConnection=this._db;a.text=c;if(d){apf.extend(a.parameters,d);}a.execute();return a.getResult();},isAvailable:function(){return apf.isAIR;},put:function(a,d,c){if(this.isValidKey(a)==false){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Invalid key given: "+a));}if(!c){c=this.namespace;}if(this.isValidKey(c)==false){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Invalid namespace given: "+c));}try{this._sql("DELETE FROM "+this.table_name+" WHERE namespace = :namespace AND key = :key",{":namespace":c,":key":a});this._sql("INSERT INTO "+this.table_name+" VALUES (:namespace, :key, :value)",{":namespace":c,":key":a,":value":d});}catch(g){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Error writing file: "+g.message));return false;}return true;},get:function(c,d){if(this.isValidKey(c)==false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid key given: "+c));}if(!d){d=this.namespace;}if(this.isValidKey(d)==false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid namespace given: "+d));}var a=this._sql("SELECT * FROM "+this.table_name+" WHERE namespace = :namespace AND key = :key",{":namespace":d,":key":c});if(a.data&&a.data.length){return a.data[0].value;}return null;},getNamespaces:function(){var d=[this.namespace];var a=this._sql("SELECT namespace FROM "+this.table_name+" DESC GROUP BY namespace");if(a.data){for(var c=0;c<a.data.length;c++){if(a.data[c].namespace!=this.namespace){d.push(a.data[c].namespace);}}}return d;},getKeys:function(g){if(!g){g=this.namespace;}if(this.isValidKey(g)==false){throw new Error(apf.formatErrorString(0,null,"Clearing storage","Invalid namespace given: "+g));}var d=[];var a=this._sql("SELECT key FROM "+this.table_name+" WHERE namespace = :namespace",{":namespace":g});if(a.data){for(var c=0;c<a.data.length;c++){d.push(a.data[c].key);}}return d;},clear:function(a){if(!a){a=this.namespace;}if(this.isValidKey(a)==false){throw new Error(apf.formatErrorString(0,null,"Clearing storage","Invalid namespace given: "+a));}this._sql("DELETE FROM "+this.table_name+" WHERE namespace = :namespace",{":namespace":a});},remove:function(a,c){if(!c){c=this.namespace;}if(this.isValidKey(c)==false){throw new Error(apf.formatErrorString(0,null,"Removing key","Invalid namespace given: "+c));}this._sql("DELETE FROM "+this.table_name+" WHERE namespace = :namespace AND key = :key",{":namespace":c,":key":a});},putMultiple:function(g,a,d){if(this.isValidKeyArray(g)===false||!a instanceof Array||g.length!=a.length){throw new Error(apf.formatErrorString(0,null,"Setting multiple name/value pairs","Invalid arguments: keys = ["+g+"], values = ["+a+"]"));}if(!d){d=this.namespace;}if(this.isValidKey(d)==false){throw new Error(apf.formatErrorString(0,null,"Setting multiple name/value pairs","Invalid namespace given: "+d));}try{this._db.begin();for(var c=0;c<g.length;c++){this._sql("DELETE FROM "+this.table_name+" WHERE namespace = :namespace AND key = :key",{":namespace":d,":key":key[c]});this._sql("INSERT INTO "+this.table_name+" VALUES (:namespace, :key, :value)",{":namespace":d,":key":key[c],":value":value});}this._db.commit();}catch(j){throw new Error(apf.formatErrorString(0,null,"Writing multiple name/value pair","Error writing file: "+j.message));return false;}return true;},getMultiple:function(j,g){if(this.isValidKeyArray(j)===false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid key array given: "+j));}if(!g){g=this.namespace;}if(this.isValidKey(g)==false){throw new Error(apf.formatErrorString(0,null,"Getting multiple name/value pairs","Invalid namespace given: "+g));}var d=[];for(var c=0;c<j.length;c++){var a=this._sql("SELECT * FROM "+this.table_name+" WHERE namespace = :namespace AND key = :key",{":namespace":g,":key":j[c]});d[c]=a.data&&a.data.length?a.data[0].value:null;}return d;},removeMultiple:function(d,c){if(this.isValidKeyArray(d)===false){throw new Error(apf.formatErrorString(0,null,"Removing name/value pair","Invalid key array given: "+d));}if(!c){c=this.namespace;}if(this.isValidKey(c)==false){throw new Error(apf.formatErrorString(0,null,"Removing multiple name/value pairs","Invalid namespace given: "+c));}this._db.begin();for(var a=0;a<d.length;a++){this._sql("DELETE FROM "+this.table_name+" WHERE namespace = namespace = :namespace AND key = :key",{":namespace":c,":key":d[a]});}this._db.commit();},isPermanent:function(){return true;},getMaximumSize:function(){return this.SIZE_NO_LIMIT;},hasSettingsUI:function(){return false;},showSettingsUI:function(){throw new Error(this.declaredClass+" does not support a storage settings user-interface");},hideSettingsUI:function(){throw new Error(this.declaredClass+" does not support a storage settings user-interface");}};apf.http=function(){this.queue=[null];this.callbacks={};this.cache={};this.timeout=this.timeout||10000;this.autoroute=this.autoroute||false;this["route-server"]=this["route-server"]||null;if(!this.$uniqueId){this.$uniqueId=apf.all.push(this)-1;}this.toString=this.toString||function(){return"[Ajax.org Teleport Component : (HTTP)]";};var a=apf.config.name+".apf.http";this.saveCache=function(){if(!apf.serialize){throw new Error(apf.formatErrorString(1079,this,"HTTP save cache","Could not find JSON library."));}apf.console.info("[HTTP] Loading HTTP Cache","teleport");var c=apf.serialize(comm.cache);apf.storage.put("cache_"+this.name,c,apf.config.name+".apf.http");};this.loadCache=function(){var c=apf.storage.get("cache_"+this.name,apf.config.name+".apf.http");apf.console.info("[HTTP] Loading HTTP Cache","steleport");if(!c){return false;}this.cache=apf.unserialize(c);return true;};this.clearCache=function(){apf.storage.remove("cache_"+this.name,apf.config.name+".apf.http");};this.getXml=function(d,g,c){if(!c){c={};}c.useXML=true;c.callback=g;return this.get(d,c);};this.get=this.$get=function(j,d){if(!d){d={};}var i=this;var s=d.id;var k=d.async=(d.async||typeof d.async=="undefined"||apf.isOpera||false);if(apf.isWebkit){j=apf.html_entity_decode(j);}var E=d.data||"";if(apf.isNot(s)){if(this.cache[j]&&this.cache[j][E]){var u={responseText:this.cache[j][E],responseXML:{},status:200,isCaching:true};}else{var u=apf.getHttpReq();}s=this.queue.push({http:u,url:j,callback:d.callback,retries:0,options:d})-1;if(u.isCaching){if(k){return $setTimeout("apf.lookup("+this.$uniqueId+").receive("+s+");",50);}else{return this.receive(s);}}}else{var u=this.queue[s].http;if(u.isCaching){u=apf.getHttpReq();}else{u.abort();}}if(k){u.onreadystatechange=function(){if(!i.queue[s]||u.readyState!=4){return;}i.receive(s);};}var t=this.autoroute&&apf.isOpera?true:(d.autoroute||this.shouldAutoroute),w=t?this["route-server"]:j;if(!d.hideLogMessage){apf.console.teleport(this.queue[s].log=new apf.teleportLog({id:s,tp:this,type:d.type,method:this.method||d.method||"GET",url:j,route:t?w:"",data:new String(E&&E.xml?E.xml:E),start:new Date()}));}var c=[];function D(G,H){c.push(G+": "+H);u.setRequestHeader(G,H);}var g=false;try{if(d.nocache){w=apf.getNoCacheUrl(w);}try{netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");}catch(A){if(apf.hasHtml5XDomain&&w.match(/^http:\/\//)&&!new apf.url(w).isSameLocation()){throw new Error(apf.formatErrorString(0,this,"Communication error","Url: "+w+"\nReason: Same origin policy in effect"));}}u.open(this.method||d.method||"GET",w,k);if(d.username){D("Authorization","Basic "+apf.crypto.Base64.encode(d.username+":"+d.password));}if(!apf.isWebkit){D("User-Agent","Ajax.org Teleport 3.0");}D("X-Requested-With","XMLHttpRequest");if(!d.headers||!d.headers["Content-type"]){D("Content-type",this.contentType||(this.useXML||d.useXML?"text/xml":"text/plain"));}if(t){D("X-Route-Request",j);D("X-Proxy-Request",j);D("X-Compress-Response","gzip");}}catch(A){g=A.message;}if(g){var C=false;if(self.XMLHttpRequestUnSafe){try{u=new XMLHttpRequestUnSafe();u.onreadystatechange=function(){if(!i.queue[s]||u.readyState!=4){return;}i.receive(s);};u.open(this.method||d.method||"GET",(d.nocache?apf.getNoCacheUrl(w):w),k);D("X-Requested-With","XMLHttpRequest");if(!d.headers||!d.headers["Content-type"]){D("Content-type",this.contentType||(this.useXML||d.useXML?"text/xml":"text/plain"));}this.queue[s].http=u;d.async=true;C=true;}catch(A){}}if(!C&&this.autoroute&&!t){this.shouldAutoroute=true;d.autoroute=true;return this.get(j,d);}if(!C){var B=d.callback?d.callback(null,apf.ERROR,{userdata:d.userdata,http:u,url:j,tpModule:this,id:s,message:"Permission denied accessing remote resource: "+j+"\nMessage: "+g}):false;if(!B){this.clearQueueItem(s);}return;}}if(this.$headerHook){this.$headerHook(u);}if(d.headers){for(var F in d.headers){D(F,d.headers[F]);}}if(!d.hideLogMessage){this.queue[s].log.request(c);}function q(){var I=self.navigator.onLine?"File or Resource not available "+j:"Browser is currently working offline";apf.console.warn(I,"teleport");if(!d.hideLogMessage){i.queue[s].log.response({end:new Date(),message:I,http:u});}var G=self.navigator&&navigator.onLine?apf.ERROR:apf.TIMEOUT;var H=d.callback?d.callback(null,G,{userdata:d.userdata,http:u,url:j,tpModule:i,id:s,message:I}):false;if(!H){i.clearQueueItem(s);}}function n(I){var G;if(apf.isIE&&I){var H=window.onerror;window.onerror=function(){if(arguments.caller.callee==n){window.onerror=H;return true;}else{window.onerror=H;if(H){return H.apply(window,arguments);}}};u.send(E);window.onerror=H;}else{try{u.send(E);}catch(J){G=true;}}if(G){q();return;}}if(!k){n.call(this);return this.receive(s);}else{if(apf.loadsLocalFilesSync&&location.protocol=="file:"&&j.indexOf("http://")==-1){$setTimeout(function(){n.call(i,true);});}else{n.call(i);}return s;}};if(!this.exec){this.exec=function(k,g,j,d){if(!d){d={};}var c=g[0],i="";if(!d.method){d.method=k.toUpperCase();}if(!d.callback){d.callback=j;}this.contentType="application/x-www-form-urlencoded";this.$get(apf.getAbsolutePath(apf.config.baseurl,c),d.method=="GET"?d:apf.extend({data:i},d));};}this.receive=function(c){if(!this.queue[c]){return false;}var g=this.queue[c],n=g.http,q=g.callback;if(self.navigator&&navigator.onLine===false&&(location.protocol!="file:"||g.url.indexOf("http://")>-1)){return false;}if(g.async){try{if(n.status){}}catch(j){var k=this;return $setTimeout(function(){k.receive(c);},10);}}if(!g.options.hideLogMessage){apf.console.info("[HTTP] Receiving ["+c+"]"+(n.isCaching?"[<span style='color:orange'>cached</span>]":"")+" from "+g.url,"teleport",n.responseText);}var i=[],d={end:new Date(),tpModule:this,http:n,url:g.url,callback:q,id:c,retries:g.retries||0,userdata:g.options.userdata};if(n.status>600){return this.$timeout(c);}d.data=n.responseText;if(n.status>=400&&n.status<600||n.status<10&&n.status!=0){i.push("HTTP error ["+c+"]:"+n.status+"\n"+n.responseText);}if(g.options.useXML||this.useXML){if((n.responseText||"").replace(/^[\s\n\r]+|[\s\n\r]+$/g,"")==""){i.push("Received an empty XML document (0 bytes)");}else{try{var s=(n.responseXML&&n.responseXML.documentElement)?apf.xmlParseError(n.responseXML):apf.getXmlDom(n.responseText);if(!apf.supportNamespaces){s.setProperty("SelectionLanguage","XPath");}d.data=s.documentElement;}catch(j){i.push("Received invalid XML\n\n"+j.message);}}}if(i.length){d.message=i.join("\n");if(g.log){g.log.response(d);}if(!q||!q(d.data,apf.ERROR,d)){this.clearQueueItem(c);}return;}if(g.options.caching){if(!this.cache[g.url]){this.cache[g.url]={};}this.cache[g.url][g.options.data]=n.responseText;}if(g.log){g.log.response(d);}if(!q||!q(d.data,apf.SUCCESS,d)){this.clearQueueItem(c);}return d.data;};this.$timeout=function(q){if(!this.queue[q]){return false;}var n=this.queue[q],g=n.http;try{if(g.status){}}catch(i){var d=this;return $setTimeout(function(){d.$timeout(q);},10);}var k=n.callback;g.abort();apf.console.info("HTTP Timeout ["+q+"]","teleport");var c;var j=k?k(null,apf.TIMEOUT,c={end:new Date(),userdata:n.options.userdata,http:g,url:n.url,tpModule:this,id:q,message:"HTTP Call timed out",retries:n.retries||0}):false;if(n.log){n.log.response(c);}if(!j){this.clearQueueItem(q);}};this.retryTimeout=function(c,g,d,j,i){if(g==apf.TIMEOUT&&c.retries<(i||apf.maxHttpRetries)){return c.tpModule.retry(c.id);}j=j||new Error(apf.formatErrorString(0,this,"Communication "+(g==apf.TIMEOUT?"timeout":"error"),"Url: "+c.url+"\nInfo: "+c.message));if((d||apf).dispatchEvent("error",apf.extend({error:j,state:g,bubbles:true},c))===false){return true;}};this.clearQueueItem=function(c){if(!this.queue[c]){return false;}if(apf.releaseHTTP){apf.releaseHTTP(this.queue[c].http);}this.queue[c]=null;delete this.queue[c];return true;};this.retry=function(d){if(!this.queue[d]){return false;}var c=this.queue[d];apf.console.info("[HTTP] Retrying request ["+d+"]","teleport");c.retries++;c.options.id=d;this.get(c.url,c.options);return true;};this.cancel=function(c){if(c===null){c=this.queue.length-1;}if(!this.queue[c]){return false;}this.clearQueueItem(c);};if(!this.$loadAml&&!this.instantiate&&!this.call){this.$loadAml=function(c){var n=this["receive"];for(var k=0,d=this.childNodes.length;k<d;k++){if(this.childNodes[k].nodeType!=1){continue;}var j=this.childNodes[k].getAttribute("url"),q=self[this.childNodes[k].getAttribute("receive")||n],g={useXML:this.childNodes[k].getAttribute("type")=="XML",async:!apf.isFalse(this.childNodes[k].getAttribute("async"))};this[this.childNodes[k].getAttribute("name")]=function(s,i){g.userdata=i;g.data=s;return this.get(j,g);};}};this.instantiate=function(c){var i=c.getAttribute("src"),g={async:c.getAttribute("async")!="false",nocache:true};this.getURL=function(k,j){g.data=k;g.userdata=j;g.callback=this.callbacks.getURL;return this.get(i,g);};var d="http"+Math.round(Math.random()*100000);apf.setReference(d,this);return d+".getURL()";};this.call=function(d,c){this[d].call(this,c);};}};apf.teleportLog=function(a){var d,g=a.method+" "+a.url+" HTTP/1.1\n\n"+a.data;this.setXml=function(i){if(!d){var j=i.ownerDocument;d=j.createElement(a.tp.localName||a.type||"http");d.appendChild(j.createElement("request")).appendChild(j.createTextNode(g||"-"));d.appendChild(j.createElement("response")).appendChild(j.createTextNode(c||"-"));}apf.xmldb.appendChild(i,d);};this.request=function(i){g=g.replace(/\n\n/,"\n"+i.join("\n")+"\n\n");if(d){apf.setQueryValue(d,"request/text()",g);}this.request=function(){};};var c="";this.response=function(i){var j=i.http.getAllResponseHeaders();c="HTTP/1.1 "+i.http.status+" "+i.http.statusText+"\n"+(j?j:"\n")+i.http.responseText;if(d){apf.setQueryValue(d,"response/text()",c);}};};apf.Init.run("http");apf.USEIFRAME=false;function runTpIframe(){function c(){this.$uniqueId=apf.all.push(this);var d=this;if(apf.USEIFRAME){this.iframe=document.body.appendChild(document.createElement("iframe"));this.iframe.style.width="400px";this.iframe.style.height="300px";this.iframe.style.position="absolute";this.iframe.style.left="0";this.iframe.style.top="0";this.iframe.style.zIndex=1000000000;document.body.style.display="block";}else{var i=document.body.appendChild(document.createElement("xml"));this.xmlDocument=i.XMLDocument;this.xmlDocument.setProperty("SelectionLanguage","XPath");document.body.removeChild(i);}this.readyState=0;this.status=null;this.responseText=null;this.responseXML=null;this.setRequestHeader=function(){};this.send=function(){this.done=false;if(apf.USEIFRAME){this.iframe.src=this.url;}else{this.xmlDocument.load(this.url);}};this.open=function(s,n,q){this.method=s;this.url=n;this.async=q;if(apf.USEIFRAME){if(!q){throw new Error(apf.formatErrorString(1081,null,"Iframe callback","Compatibility mode prevents possibility of non-async calls"));}this.iframe.onload=g;}else{this.xmlDocument.async=q;this.xmlDocument.onreadystatechange=j;}};this.abort=function(){if(apf.USEIFRAME){this.iframe.onreadystatechange=null;this.iframe.src="about:blank";d.done=false;d.readyState="";}else{this.xmlDocument.abort();}};var k=this;function j(){k.receive();}this.receive=function(){this.readyState=this.xmlDocument.readyState;if(this.readyState==4){this.status=200;this.responseText=this.xmlDocument.responseText||this.xmlDocument.xml;this.responseXML=this.xmlDocument;}if(this.onreadystatechange){this.onreadystatechange();}};function g(){if(d.done){return;}d.done=true;d.receiveIframe();}this.receiveIframe=function(){var q=this.iframe.contentWindow.document.body.innerText;q=q.replace(/^- /gm,"");try{this.responseXML=apf.getXmlDom(q);this.responseXML.setProperty("SelectionLanguage","XPath");this.responseXML.loadXML(q);}catch(n){this.responseXML=null;}this.responseText=this.responseXML?this.responseXML.xml:q;this.status=200;this.readyState=4;if(this.onreadystatechange){this.onreadystatechange();}};}function a(j,i){var d=document.body.appendChild(document.createElement("xml"));var g=d.XMLDocument;document.body.removeChild(d);g.setProperty("SelectionLanguage","XPath");if(j){g.loadXML(j);}if(!i){apf.xmlParseError(g);}return g;}}apf.DOMParser=function(){};apf.DOMParser.prototype=new (function(){this.caseInsensitive=true;this.preserveWhiteSpace=true;this.$shouldWait=0;var c=[/\<\!(DOCTYPE|doctype)[^>]*>/,/&nbsp;/g,/<\s*\/?\s*(?:\w+:\s*)[\w-]*[\s>\/]/g],a="//@*[not(contains(local-name(), '.')) and not(translate(local-name(), 'ABCDEFGHIJKLMNOPQRSTUVWXYZ', 'abcdefghijklmnopqrstuvwxyz') = local-name())]";this.parseFromString=function(i,k,d){var g;if(this.caseInsensitive){var j=i.replace(c[0],"").replace(c[2],function(n){return n.toLowerCase();});if(!this.supportNamespaces){j=j.replace(/xmlns\=\"[^"]*\"/g,"");}var g=apf.getXmlDom(j);if(apf.xmlParseError){apf.xmlParseError(g);}g=g.documentElement;}else{g=apf.getXmlDom(i,null,this.preserveWhiteSpace||apf.debug).documentElement;}return this.parseFromXml(g,d);};this.parseFromXml=function(g,k){var M,d,F,E;if(!k){k={};}if(!k.delayedRender&&!k.include){if(k.doc){M=k.doc;d=k.docFrag||M.createDocumentFragment();}else{M=new apf.AmlDocument();M.$aml=g;M.$domParser=this;}F=this.$createNode(M,g.nodeType,g);(d||M).appendChild(F);if(k.htmlNode){F.$int=k.htmlNode;}}else{F=k.amlNode;M=k.doc;if(k.include){var G=F.childNodes;var B=G.indexOf(k.beforeNode);var w=G.splice(B,G.length-B);}}this.$parseContext=[F,k];var H,D={},u=[],q=this;(function A(O,j){var P,T,N,S,n=O.childNodes,R=0,Q=j.length;for(;R<Q;R++){T=q.$createNode(M,(N=j[R]).nodeType,N);if(!T){continue;}n[P=n.length]=T;T.parentNode=O;if(P>0){(T.previousSibling=n[P-1]).nextSibling=T;}if(!T.render&&T.canHaveChildren&&(S=N.childNodes).length){A(T,S);}if(T.$parsePrio){if(T.$parsePrio=="001"){T.dispatchEvent("DOMNodeInsertedIntoDocument");continue;}(D[T.$parsePrio]||(u.push(T.$parsePrio)&&(D[T.$parsePrio]=[]))).push(T);}}O.firstChild=n[0];O.lastChild=n[P];})(F,g.childNodes);if(k.include&&w.length){var s=G.length-1;G.push.apply(G,w);var t=G[s];var C=G[s+1];(C.previousSibling=t).nextSibling=C;F.lastChild=G[G.length-1];}if(k.delay){F.$parseOptions={prios:u,nodelist:D};return(d||M);}u.sort();var L,K,J,I;for(L=0,J=u.length;L<J;L++){H=D[u[L]];for(K=0,I=H.length;K<I;K++){H[K].dispatchEvent("DOMNodeInsertedIntoDocument");}}if(this.$shouldWait){return(d||M);}if(k.timeout){$setTimeout(function(){q.$continueParsing(F,k);});}else{this.$continueParsing(F,k);}return(d||M);};this.$callCount=0;this.$continueParsing=function(g,A){if(this.$shouldWait&&--this.$shouldWait!=0){return;}if(!A){A={};}this.$callCount++;if(g.$parseOptions){var t=g.$parseOptions.prios,w=g.$parseOptions.nodelist,s,q,n,k,d;delete g.$parseOptions;t.sort();for(s=0,n=t.length;s<n;s++){nodes=w[t[s]];for(q=0,k=nodes.length;q<k;q++){if(!(d=nodes[q]).parentNode||d.$amlLoaded){continue;}nodes[q].dispatchEvent("DOMNodeInsertedIntoDocument");}}}if(!A.ignoreSelf&&!g.$amlLoaded){g.dispatchEvent("DOMNodeInsertedIntoDocument");}(function u(B){var D,E;for(var C=0,j=B.length;C<j;C++){if(!(D=B[C]).$parsePrio&&!D.$amlLoaded){D.dispatchEvent("DOMNodeInsertedIntoDocument");}if(!D.render&&(E=D.childNodes).length){u(E);}}})(g.childNodes);if(!--this.$callCount&&!A.delay){apf.queue.empty();}if(A.callback){A.callback.call(g.ownerDocument);}delete this.$parseContext;};this.$createNode=function(F,t,G,j,E,A){var g;switch(t){case 1:var d,w;if(G){if((j=G.namespaceURI||apf.ns.xhtml)&&!(w=F.$prefixes[j])){F.$prefixes[w=G.prefix||G.scopeName||""]=j;F.$namespaceURIs[j]=w;if(!F.namespaceURI&&!w){F.namespaceURI=j;F.prefix=w;}}E=G.baseName||G.localName||G.tagName.split(":").pop();}else{w=F.$prefixes[j]||"";}if(!j){throw new Error("Missing namespace definition.");}if(!apf.namespaces[j]){if(this.allowAnyElement){j=apf.ns.xhtml;}else{throw new Error("Missing namespace handler for '"+j+"'");}}var s=apf.namespaces[j].elements;if(!(s[E]||s["@default"])){throw new Error("Missing element constructor: "+E);}g=new (s[E]||s["@default"])(null,E);g.prefix=w||"";g.namespaceURI=j;g.tagName=w?w+":"+E:E;if(G){if(d=G.getAttribute("id")){g.$propHandlers.id.call(g,g.id=d);}var C=G.attributes,k;for(var D,u=0,q=C.length;u<q;u++){g.attributes.push(new apf.AmlAttr(g,(k=(D=C[u]).nodeName),D.nodeValue));if(k=="render"){g.render=true;}}}break;case 2:g=new apf.AmlAttr();g.name=g.nodeName=E;if(A||(A=G&&G.nodeValue)){g.value=g.nodeValue=A;}if(G){if(G.namespaceURI&&!(g.prefix=F.$namespaceURIs[g.namespaceURI=G.namespaceURI])){F.$prefixes[g.prefix=G.prefix||G.scopeName]=g.namespaceURI;}}else{g.prefix=F.$prefixes[j];}break;case 3:if(G){A=G&&G.nodeValue;}if(!this.preserveWhitespace&&!(A||"").trim()){return;}g=new apf.AmlText();g.nodeValue=A||G&&G.nodeValue;break;case 7:var B=E||G&&G.nodeName;if(!apf.aml.processingInstructions[B]){throw new Error(apf.formatErrorString(0,null,"The processing instruction does not exist","Could not find the processing instruction with target: "+B));}g=new apf.aml.processingInstructions[B]();g.target=g.nodeName=B;g.data=g.nodeValue=A||G&&G.nodeValue;break;case 4:g=new apf.AmlCDATASection();g.nodeValue=A||G&&G.nodeValue;break;case 5:g=new apf.AmlNode();g.nodeType=t;break;case 6:g=new apf.AmlNode();g.nodeType=t;break;case 8:g=new apf.AmlComment();g.nodeValue=A||G&&G.nodeValue;break;case 9:g=new apf.AmlDocument();g.$domParser=this;break;case 10:g=new apf.AmlNode();g.nodeType=t;break;case 11:g=new apf.AmlDocumentFragment();break;}g.$aml=G;g.ownerDocument=F;return g;};})();apf.AmlNamespace=function(){this.elements={};this.processingInstructions={};};apf.AmlNamespace.prototype={setElement:function(a,c){return this.elements[a]=c;},setProcessingInstruction:function(c,a){this.processingInstructions[c]=a;}};apf.aml=new apf.AmlNamespace();apf.setNamespace("http://ajax.org/2005/aml",apf.aml);apf.__AMLNODE__=1<<14;apf.AmlNode=function(){this.$init(function(){this.childNodes=[];});};(function(){this.$regbase=this.$regbase|apf.__AMLNODE__;this.NODE_ELEMENT=1;this.NODE_ATTRIBUTE=2;this.NODE_TEXT=3;this.NODE_CDATA_SECTION=4;this.NODE_ENTITY_REFERENCE=5;this.NODE_ENTITY=6;this.NODE_PROCESSING_INSTRUCTION=7;this.NODE_COMMENT=8;this.NODE_DOCUMENT=9;this.NODE_DOCUMENT_TYPE=10;this.NODE_DOCUMENT_FRAGMENT=11;this.NODE_NOTATION=12;this.ownerDocument=null;this.nodeValue="";this.namespaceURI="";this.appendChild=this.insertBefore=function(g,t,d){if(!g||!g.hasFeature||!g.hasFeature(apf.__AMLNODE__)){throw new Error(apf.formatErrorString(1072,this,"Insertbefore DOM operation","Invalid argument passed. Expecting an AmlElement."));}if(this.nodeType==this.NODE_DOCUMENT){if(this.childNodes.length){throw new Error(apf.formatErrorString(0,this,"Insertbefore DOM operation","Only one top level element is allowed in an AML document."));}else{this.documentElement=g;}}if(g.nodeType==this.NODE_DOCUMENT_FRAGMENT){var a=g.childNodes.slice(0);for(var k=0,j=a.length;k<j;k++){this.insertBefore(a[k],t);}return g;}var c=g.parentNode==this,q=g.$pHtmlNode,w=g.parentNode,n=-1,s=this;if(t){n=this.childNodes.indexOf(t);if(n<0){if(t==this){throw new Error(apf.formatErrorString(1072,this,"Insertbefore DOM operation","Before node is the same node as inserted node"));}else{throw new Error(apf.formatErrorString(1072,this,"Insertbefore DOM operation","Before node is not a child of the parent node specified"));}return false;}}if(!g.ownerDocument){g.ownerDocument=this.ownerDocument||apf.ownerDocument;}if(g.parentNode){g.removeNode(c,d);}g.parentNode=this;if(t){n=this.childNodes.indexOf(t);}if(t){g.nextSibling=t;g.previousSibling=t.previousSibling;t.previousSibling=g;if(g.previousSibling){g.previousSibling.nextSibling=g;}}if(n>=0){this.childNodes=this.childNodes.slice(0,n).concat(g,this.childNodes.slice(n));}else{n=this.childNodes.push(g)-1;g.nextSibling=null;if(n>0){g.previousSibling=this.childNodes[n-1];g.previousSibling.nextSibling=g;}else{g.previousSibling=null;}}this.firstChild=this.childNodes[0];this.lastChild=this.childNodes[this.childNodes.length-1];function A(){g.$pHtmlNode=s.canHaveChildren?s.$int:document.body;g.dispatchEvent("DOMNodeInserted",{$beforeNode:t,relatedNode:s,$isMoveWithinParent:c,$oldParentHtmlNode:q,$oldParent:w,bubbles:true});var i;var B=(g.$ext&&g.$ext.nodeType==1&&(i=g.$ext.getElementsByTagName("iframe")).length>0&&apf.findHost(i[0].parentNode)==g);if(!d&&g.$ext){if(!g.$altExt||g.$altExt.parentNode==g.$pHtmlNode){g.$pHtmlNode.insertBefore(c&&g.$altExt||g.$ext,t&&(t.$altExt||t.$ext)||null);}}}var u=this.nodeType==this.NODE_DOCUMENT?this:this.ownerDocument;if(!u||u.$domParser.$shouldWait){return g;}if(this.nodeType==this.NODE_DOCUMENT_FRAGMENT){return;}if(!g.$amlLoaded){(this.ownerDocument||this).$domParser.$continueParsing(g,{delay:true});}A();return g;};this.removeNode=function(c,a){if(c&&typeof c!="boolean"){throw new Error(apf.formatErrorString(0,this,"Removing node from parent","Invalid DOM Call. removeNode() does not take any arguments."));}if(!this.parentNode||!this.parentNode.childNodes){return this;}if(!this.parentNode.childNodes.contains(this)){return false;}if(this.$amlLoaded&&!apf.isDestroying){this.dispatchEvent("DOMNodeRemoved",{relatedNode:this.parentNode,bubbles:true,$doOnlyAdmin:c});if(!a&&!c&&this.$ext&&this.$ext.parentNode){this.$ext.parentNode.removeChild(this.$ext);}}this.parentNode.childNodes.remove(this);if(this.parentNode.firstChild==this){this.parentNode.firstChild=this.nextSibling;}if(this.parentNode.lastChild==this){this.parentNode.lastChild=this.previousSibling;}if(this.nextSibling){this.nextSibling.previousSibling=this.previousSibling;}if(this.previousSibling){this.previousSibling.nextSibling=this.nextSibling;}this.$pHtmlNode=this.parentNode=this.previousSibling=this.nextSibling=null;return this;};this.removeChild=function(a){if(!a||!a.hasFeature||!a.hasFeature(apf.__AMLNODE__)){throw new Error(apf.formatErrorString(0,this,"Removing a child node","Invalid Argument. removeChild() requires one argument of type AMLElement."));}a.removeNode();return this;};this.replaceChild=function(){};this.cloneNode=function(a){if(a&&this.nodeType==1){return this.ownerDocument.$domParser.parseFromXml(this,{doc:this.ownerDocument,delay:true}).childNodes[0];}else{return this.ownerDocument.$domParser.$createNode(this.ownerDocument,this.nodeType,this);}};this.canDispatch=function(a,c){};this.compareDocumentPosition=function(a){};this.hasAttributes=function(){return this.attributes&&this.attributes.length;};this.hasChildNodes=function(){return this.childNodes&&this.childNodes.length;};this.isDefaultNamespace=function(a){if(c.nodeType==1){if(!this.prefix){return this.namespaceURI==a;}}var c=this.parentNode||this.ownerElement;return c&&c.isDefaultNamespace(a);};this.lookupNamespaceURI=function(c){if(a.nodeType==1){if(this.namespaceURI&&c==this.prefix){return this.namespaceURI;}}var a=this.parentNode||this.ownerElement;return a&&a.lookupNamespaceURI(c);};this.lookupPrefix=function(a){if(this.nodeType==1){if(a==this.namespaceURI&&this.prefix){return this.prefix;}}var c=this.parentNode||this.ownerElement;return c&&c.lookupPrefix(a);};this.normalize=function(){};this.selectNodes=function(c,a){if(!apf){return;}if(!apf.XPath){apf.runXpath();}return apf.XPath.selectNodes(c,a||(this.nodeType==9?this.documentElement:this));};this.selectSingleNode=function(c,a){if(!apf){return;}if(!apf.XPath){apf.runXpath();}return apf.XPath.selectNodes(c,a||(this.nodeType==9?this.documentElement:this))[0];};}).call(apf.AmlNode.prototype=new apf.Class());apf.AmlElement=function(d,a){var c=this.$init;this.$init=function(i,g,n){this.$supportedProperties=this.$supportedProperties.slice();var s,k,j;k=this.$propHandlers;j=this.$propHandlers={};for(s in k){j[s]=k[s];}k=this.$booleanProperties;j=this.$booleanProperties={};for(s in k){j[s]=k[s];}c.call(this,i,g,n);};this.$init(function(q,k,s){this.$events={};this.$inheritProperties={};this.attributes=new apf.AmlNamedNodeMap(this);this.nodeFunc=k;this.localName=q;if(s){var j,t,n,g;if(s.childNodes){j=s.childNodes;delete s.childNodes;}for(t in s){if(t=="htmlNode"){continue;}this.attributes.push(new apf.AmlAttr(this,t,s[t]));}if(!this.ownerDocument){this.ownerDocument=apf.document;this.prefix="";this.namespaceURI=null;this.tagName=q;}if(j){this.childNodes=j;for(n=0,g=j.length;n<g;n++){j[n].nextSibling=j[n+1]||null;j[n].previousSibling=j[n-1]||null;j[n].parentNode=this;}this.firstChild=j[0]||null;this.lastChild=j[j.length-1]||null;}this.$aml=apf.$emptyNode||(apf.$emptyNode=apf.getXml("<empty />"));}});if(a){c.call(this,a,apf.NODE_HIDDEN,d);}};(function(){this.nodeType=this.NODE_ELEMENT;this.canHaveChildren=true;this.$propHandlers={id:function(d){if(d=="apf"){throw new Error(apf.formatErrorString(0,this,"Setting Name of Element","Cannot set name of element to 'apf'"));}if(this.name==d){return;}if(self[this.name]==this){self[this.name]=null;}if(!self[d]||!self[d].hasFeature){try{self[d]=this;}catch(c){var a=true;}}if(a&&d in self){apf.console.warn("trying to set a value in the global scope with a reserved name '"+d+"'.\nNothing wrong with that, except that you will not be able to reference\nthe object from the global scope in JS.");}apf.nameserver.register(this.localName,d,this);this.name=d;}};this.$booleanProperties={};this.$inheritProperties={};this.$supportedProperties=[];this.getElementsByTagName=function(j,n){j=j.toLowerCase();var k,g,c,d=this.childNodes,a=[];for(g=0,c=d.length;g<c;g++){if((k=d[g]).nodeType!=1){continue;}if(k.tagName==j||j=="*"){a.push(k);}if(!n&&k.nodeType==1){a=a.concat(k.getElementsByTagName(j));}}return a;};this.getElementsByTagNameNS=function(j,g,q){g=g.toLowerCase();var n,k,c,d=this.childNodes,a=[];for(k=0,c=d.length;k<c;k++){if((n=d[k]).nodeType!=1){continue;}if(n.namespaceURI==j&&(n.localName==g||g=="*")){a.push(n);}if(!q&&n.nodeType==1){a=a.concat(n.getElementsByTagNameNS(j,g));}}return a;};this.setAttribute=function(g,j,i){g=g.toLowerCase();var c=this.attributes.getNamedItem(g);if(!c){this.attributes.push(c=new apf.AmlAttr(this,g,j));if(!this.$amlLoaded){return;}if(i){c.$setValue(j);}else{c.dispatchEvent("DOMNodeInsertedIntoDocument",{relatedNode:this});c.dispatchEvent("DOMNodeInserted",{relatedNode:this,bubbles:true});}return;}var d=c.nodeValue;c.$setValue(j);if(i||!this.$amlLoaded){return;}c.$triggerUpdate(null,d);};this.setAttributeNode=function(a){this.attributes.setNamedItem(a);};this.setAttributeNS=function(c,a,d){return this.setAttribute(a,d);};this.hasAttribute=function(a){return this.getAttributeNode(a)?true:false;};this.hasAttributeNS=function(c,a){return this.hasAttribute(a);};this.removeAttribute=function(a){this.attributes.removeNamedItem(a);return this;};this.removeAttributeNS=function(c,a){return this.removeAttribute(a);};this.removeAttributeNode=function(a){this.attributes.removeNamedItem(a.name);};this.getAttribute=function(c,a){var d=this.attributes.getNamedItem(c);return d?(a?d.inheritedValue||d.nodeValue:d.nodeValue):null;};this.getAttributeNode=function(a){return this.attributes.getNamedItem(a);};this.getBoundingClientRect=function(){return new apf.AmlTextRectangle(this);};this.querySelector=function(){};this.querySelectorAll=function(){};this.scrollIntoView=function(){};this.replaceMarkup=function(a,c){apf.console.info("Remove all children from element");if(!c){c={};}if(!c.$intAML){c.$intAML=this.$aml;}if(!c.$int){c.$int=this.$int;}c.clear=true;for(var d=this.childNodes.length-1;d>=0;d--){var g=this.childNodes[d];if(g.destroy){g.destroy(true);}if(g.$ext!=this.$int){apf.destroyHtmlNode(g.$ext);}}this.childNodes.length=0;this.$int.innerHTML="<div class='loading'>loading...</div>";this.insertMarkup(a,c);};this.insertMarkup=function(c,d){apf.console.info("Loading sub markup from external source");var a=new apf.XiInclude();a.setAttribute("href",c);if(d&&d.clear){a.setAttribute("clear",true);}a.options=d;a.callback=d&&d.callback;this.appendChild(a);};this.serialize=function(c){if(c||!this.firstChild){return"<"+(this.prefix?this.prefix+":"+this.localName+" xmlns:"+this.prefix+'="'+this.namespaceURI+'"':this.localName)+(this.attributes.length?" ":"")+this.attributes.join(" ")+"/>";}else{var d=["<"+(this.prefix?this.prefix+":"+this.localName+" xmlns:"+this.prefix+'="'+this.namespaceURI+'"':this.localName)+(this.attributes.length?" ":"")+this.attributes.join(" ")+">"];for(var a=this.firstChild;a;a=a.nextSibling){d.push(a.serialize());}return d.join("")+"</"+(this.prefix?this.prefix+":"+this.localName:this.localName)+">";}};this.$setInheritedAttribute=function(d){var c,a=this;c=a.getAttribute(d);if(!c){a=a.parentNode;while(a&&a.nodeType==1&&!(c=a.getAttribute(d,true))){a=a.parentNode;}}if(!c&&apf.config&&d){c=apf.config[d];}if(c){this.$clearDynamicProperty(d);if(typeof c=="string"&&(c.indexOf("{")>-1||c.indexOf("[")>-1)){this.$setDynamicProperty(d,c);this.$inheritProperties[d]=2;}else{this.setProperty(d,c,false,false,2);}}return c;};this.$handlePropSet=function(g,d,c){if(d&&this.$booleanProperties[g]){d=apf.isTrue(d);}if(typeof this[g]=="function"){throw new Error("Could not set property/attribute '"+g+"' which has the same name as a method on this object: '"+this.toString()+"'");}this[g]=d;var a;return(a=this.$propHandlers&&this.$propHandlers[g]||this.nodeFunc==apf.NODE_VISIBLE&&apf.GuiElement&&apf.GuiElement.propHandlers[g]||null)&&a.call(this,d,g,c);};this.addEventListener("DOMNodeInsertedIntoDocument",function(k){var g,j,d,c=this.attributes;for(j=0,d=c.length;j<d;j++){c[j].dispatchEvent("DOMNodeInsertedIntoDocument");}this.$amlLoaded=true;},true);}).call(apf.AmlElement.prototype=new apf.AmlNode());apf.AmlCharacterData=function(){this.data="";this.length=0;this.$init(true);this.appendData=function(a){this.dispatchEvent("DOMCharacterDataModified",{value:a});};this.deleteData=function(c,a){this.dispatchEvent("DOMCharacterDataModified",{offset:c,count:a});};this.insertData=function(c,a){this.dispatchEvent("DOMCharacterDataModified",{offset:c,count:a});};this.replaceData=function(d,a,c){this.dispatchEvent("DOMCharacterDataModified",{offset:d,count:a,value:c});};this.substringData=function(c,a){};};apf.AmlCharacterData.prototype=new apf.AmlNode();apf.AmlText=function(a){this.$init(a);};(function(){this.nodeType=this.NODE_TEXT;this.nodeName="#text";this.serialize=function(){return apf.xmlentities(this.nodeValue).replace(/</g,"&lt;").replace(/>/g,"&gt;");};this.$setValue=function(a){this.dispatchEvent("DOMCharacterDataModified",{bubbles:true,prevValue:this.nodeValue,newValue:this.nodeValue=a});if(this.$amlLoaded&&this.$ext){this.$ext.nodeValue=a;}};this.addEventListener("DOMNodeInsertedIntoDocument",function(c){var d;if(!(d=this.parentNode.$int)||this.parentNode.hasFeature(apf.__CHILDVALUE__)){return;}this.$amlLoaded=true;var a=this.nodeValue;if(apf.config.liveText&&!this.parentNode.hasFeature(apf.__CHILDVALUE__)&&(a.indexOf("{")>-1||a.indexOf("[")>-1)){this.$supportedProperties=[];this.$propHandlers={};this.$booleanProperties={};this.$inheritProperties={};this.$propHandlers.calcdata=apf.LiveMarkupPi.prototype.$propHandlers.calcdata;this.$setInheritedAttribute=apf.AmlElement.prototype.$setInheritedAttribute;this.implement(apf.StandardBinding);d.appendChild(this.$ext=document.createElement("span"));this.$setDynamicProperty("calcdata",this.nodeValue);return;}if(apf.hasTextNodeWhiteSpaceBug){var a=a.replace(/[\t\n\r ]+/g," ");if(a&&a!=" "){this.$ext=d.appendChild(d.ownerDocument.createTextNode(a));}}else{this.$ext=d.appendChild(d.ownerDocument.createTextNode(a));}},true);}).call(apf.AmlText.prototype=new apf.AmlCharacterData());apf.AmlTextRectangle=function(d){var a=this;function c(){var g=a.getAbsolutePosition(a.$ext);a.setProperty("left",g[0]);a.setProperty("top",g[1]);a.setProperty("right",document.documentElement.offsetWidth-g[0]);a.setProperty("bottom",document.documentElement.offsetWidth-g[1]);}d.addEventListener("prop.width",c);d.addEventListener("prop.height",c);d.addEventListener("prop.left",c);d.addEventListener("prop.top",c);c.call(d);};apf.AmlTextRectangle.prototype=new apf.Class();apf.AmlProcessingInstruction=function(a){this.$init(a);this.$supportedProperties=[];this.$propHandlers={};this.$booleanProperties={};this.$inheritProperties={};};(function(){this.nodeType=this.NODE_PROCESSING_INSTRUCTION;this.data=null;this.target=null;this.serialize=function(){return"<?"+this.target+"\n"+apf.xmlentities(this.nodeValue)+"\n?>";};this.reload=function(){this.$handlePropSet("data",this.data);};this.$attrExcludePropBind=apf.extend({calcdata:0},this.$attrExcludePropBind);this.getAttribute=function(){};this.$setInheritedAttribute=apf.AmlElement.prototype.$setInheritedAttribute;this.$setValue=function(a){this.setProperty("data",a);};this.$handlePropSet=function(d,c,a){this[d]=c;if(d=="data"){this.$clearDynamicProperty("calcdata");this.$setDynamicProperty("calcdata",c);}else{if(d=="target"){}else{if(this.$propHandlers[d]){this.$propHandlers[d].call(this,c,d);}}}};this.addEventListener("DOMNodeInsertedIntoDocument",function(a){var c;if(this.parentNode.$bindingRule||!(c=this.parentNode.$int)){return;}c.appendChild(this.$ext=document.createElement("span"));this.$ext.host=this;this.$setDynamicProperty("calcdata",this.data);if(this.target.match(/\-debug$/)){apf.console.info(this.$lastFParsed.toString());}},true);this.addEventListener("DOMNodeRemovedFromDocument",function(a){this.$clearDynamicProperty("calcdata");});}).call(apf.AmlProcessingInstruction.prototype=new apf.AmlNode());apf.AmlDocument=function(){this.$prefixes={};this.$namespaceURIs={};this.domConfig=new apf.AmlConfiguration();this.$init();};(function(){this.nodeType=this.NODE_DOCUMENT;this.nodeFunc=apf.NODE_HIDDEN;this.nodeName="#document";this.$amlLoaded=true;this.activeElement=null;this.doctype=null;this.domConfig=null;this.implementation=null;this.characterSet=apf.characterSet;this.documentElement=null;this.getElementById=function(a){return self[a];};this.getElementsByTagName=function(c){var d,a=(d=this.documentElement).getElementsByTagName(c);if(c=="*"||d.tagName==c){a.unshift(d);}return a;};this.getElementsByTagNameNS=function(d,c){var g,a=(g=this.documentElement).getElementsByTagNameNS(d,c);if(c=="*"||g.tagName==c&&g.namespaceURI==d){a.unshift(g);}return a;};this.createElement=function(a){return this.$domParser.$createNode(this,this.NODE_ELEMENT,null,this.namespaceURI,a);};this.createElementNS=function(a,c){return this.$domParser.$createNode(this,this.NODE_ELEMENT,null,a,c);};this.importNode=function(c,a){if(a&&c.nodeType==1){return this.$domParser.parseFromXml(c,{doc:this,delay:true}).childNodes[0];}else{return this.$domParser.$createNode(this,c.nodeType,c);}};this.createAttribute=function(a){return this.$domParser.$createNode(this,this.NODE_ATTRIBUTE,null,this.nameSpaceURI,a);};this.createAttributeNS=function(a,c){return this.$domParser.$createNode(this,this.NODE_ATTRIBUTE,null,a,c);};this.createEvent=function(){return new apf.AmlEvent();};this.createComment=function(a){return this.$domParser.$createNode(this,this.NODE_COMMENT,null,null,null,a);};this.createProcessingInstruction=function(a){return this.$domParser.$createNode(this,this.NODE_PROCESSING_INSTRUCTION,null,null,null,a);};this.createCDATASection=function(a){return this.$domParser.$createNode(this,this.NODE_CDATA_SECTION,null,null,null,a);};this.createTextNode=function(a){return this.$domParser.$createNode(this,this.NODE_TEXT,null,null,null,a);};this.createDocumentFragment=function(){return this.$domParser.$createNode(this,this.NODE_DOCUMENT_FRAGMENT);};this.querySelector=function(){};this.querySelectorAll=function(){};this.evaluate=function(i,g,d,j,c){var a=apf.XPath.selectNodes(i,g||this.documentElement);return{snapshotLength:a.length,snapshotItem:function(k){return a[k];}};};this.createNSResolver=function(a){return{};};this.hasFocus=function(){};}).call(apf.AmlDocument.prototype=new apf.AmlNode());apf.AmlComment=function(a){this.nodeType=this.NODE_COMMENT;this.nodeName="#comment";this.$init(a);};(function(){this.serialize=function(){return"<!--"+this.nodeValue+"-->";};this.$setValue=function(a){this.dispatchEvent("DOMCharacterDataModified",{bubbles:true,newValue:a,prevValue:this.nodeValue});};}).call(apf.AmlComment.prototype=new apf.AmlCharacterData());apf.AmlNamedNodeMap=function(a){this.$host=a;};(function(){this.getNamedItem=function(a){for(var c=0;c<this.length;c++){if(this[c].name==a){return this[c];}}return false;};this.setNamedItem=function(g){var a=g.name;for(var d,c=this.length-1;c>=0;c--){if(this[c].name==a){this[c].ownerElement=null;this.splice(c,1);break;}}this.push(g);g.ownerElement=this.$host;g.ownerDocument=this.$host.ownerDocument;g.$triggerUpdate();};this.removeNamedItem=function(a){for(var d,c=this.length-1;c>=0;c--){if(this[c].name==a){d=this[c];this.splice(c,1);break;}}if(!d){return false;}d.ownerElement.setProperty(a,"");d.ownerElement=null;return d;};this.item=function(a){return this[a];};this.length=0;this.splice=function(g,d){for(var c=g,a=this.length-d;c<a;c++){this[c]=this[c+1];}delete this[c];this.length-=d;};this.push=function(a){this[this.length++]=a;return this.length;};this.join=function(k){var c=[];for(var n,g,j=0,d=this.length;j<d;j++){if((n=(g=this[j]).ownerElement)&&!n.$inheritProperties[g.nodeName]){c.push(this[j]);}}return c.join(k);};}).call(apf.AmlNamedNodeMap.prototype={});apf.AmlEvent=function(a,c){this.name=a;var d;for(d in c){this[d]=c[d];}};apf.AmlEvent.prototype={bubbles:false,cancelBubble:false,preventDefault:function(){this.returnValue=false;},stopPropagation:function(){this.cancelBubble=true;},stop:function(){this.returnValue=false;this.cancelBubble=true;}};apf.AmlAttr=function(d,a,c){this.$init();if(d){this.ownerElement=d;this.ownerDocument=d.ownerDocument;}this.nodeName=this.name=a;this.nodeValue=this.value=c;};(function(){this.nodeType=this.NODE_ATTRIBUTE;this.MODIFICATION=1;this.ADDITION=2;this.REMOVAL=3;this.serialize=this.toString=function(){return this.name+'="'+apf.xmlentities(String(this.value)).replace(/</g,"&lt;").replace(/>/g,"&gt;")+'"';};this.$setValue=function(a){this.nodeValue=this.value=a;this.specified=true;this.ownerElement.dispatchEvent("DOMAttrModified",{relatedNode:this,attrChange:this.MODIFICATION,attrName:this.name,newValue:a,prevValue:this.$lastValue||"",bubbles:true});this.$lastValue=a;};this.$triggerUpdate=function(i,c){var a=this.name,g=this.value||this.nodeValue,d=this.ownerElement;if(a=="id"&&!this.specified&&d.id){this.specified=true;return;}if(a.substr(0,2)=="on"){if(d.$events[a]){d.removeEventListener(a.replace(/^on/,""),d.$events[a]);}if(g){d.addEventListener(a,(d.$events[a]=(typeof g=="string"?apf.lm.compile(g,{event:true,parsecode:true}):g)));}return;}else{if(this.specified){d.$clearDynamicProperty(a);}if(typeof g=="string"&&(d.$attrExcludePropBind[a]||(g.indexOf("{")>-1||g.indexOf("[")>-1))){d.$setDynamicProperty(a,g);return;}}d.setProperty(a,g);if(this.specified){d.dispatchEvent("DOMAttrModified",{relatedNode:this,attrChange:this.MODIFICATION,attrName:a,newValue:g,prevValue:this.$lastValue||"",bubbles:true});}else{this.specified=true;}this.$lastValue=g;};this.addEventListener("DOMNodeInsertedIntoDocument",this.$triggerUpdate);}).call(apf.AmlAttr.prototype=new apf.AmlNode());apf.AmlCDATASection=function(a){this.nodeType=this.NODE_CDATA_SECTION;this.nodeName="#cdata-section";this.$init(a);};apf.AmlCDATASection.prototype=new apf.AmlText(true);apf.AmlCDATASection.prototype.serialize=function(){return"<![CDATA["+this.nodeValue+"]]>";};apf.AmlConfiguration=function(a){this.parameterNames=[];this.$init(a);};(function(){this.setParameter=this.setProperty;this.getParameter=this.getProperty;this.canSetParameter=function(a,c){return this.parameterNames.indexOf(a)>-1;};}).call(apf.AmlConfiguration.prototype=new apf.Class());apf.AmlDocumentFragment=function(a){this.$init(a);};apf.AmlDocumentFragment.prototype=new apf.AmlNode();apf.AmlDocumentFragment.prototype.nodeName="#document-fragment";apf.AmlDocumentFragment.prototype.nodeType=apf.AmlDocumentFragment.prototype.NODE_DOCUMENT_FRAGMENT;apf.xhtml=new apf.AmlNamespace();apf.setNamespace("http://www.w3.org/1999/xhtml",apf.xhtml);apf.XhtmlElement=function(d,c){this.$init(c||true,apf.NODE_VISIBLE,d);this.$xoe=this.addEventListener;this.addEventListener=this.$xae;this.removeEventListener=this.$xre;var a=this;this.$de=function(g){a.dispatchEvent(g.type,g);};};(function(){this.$xae=function(c,a){this.$xoe.apply(this,arguments);if(this.$ext){apf.addListener(this.$ext,c,this.$de);}};this.$xre=function(c,a){apf.AmlElement.prototype.removeEventListener.apply(this,arguments);if(this.$ext){apf.removeListener(this.$ext,c,this.$de);}};this.$handlePropSet=function(a,g,d){if(this.$booleanProperties[a]){g=apf.isTrue(g);}this[a]=g;var c=this.$propHandlers&&this.$propHandlers[a]||apf.GuiElement.propHandlers[a];if(c){c.call(this,g,null,a);}else{if(this.$int){this.$int.setAttribute(apf.isIE&&a=="class"?"className":a,g);}}};this.addEventListener("DOMNodeInsertedIntoDocument",function(a){var c;if(!(c=this.parentNode.$int)){return;}if(this.$aml){this.$ext=this.$int=apf.insertHtmlNode(this.$aml.serialize?this.$aml:this.$aml.cloneNode(false),c);}else{this.$ext=this.$int=c.appendChild(document.createElement(this.localName));}},true);}).call(apf.XhtmlElement.prototype=new apf.AmlElement());apf.xhtml.setElement("@default",apf.XhtmlElement);apf.XhtmlOptionElement=function(c,a){this.$init(a||"option",apf.NODE_VISIBLE,c);};(function(){this.addEventListener("DOMNodeInsertedIntoDocument",function(a){this.$ext=this.$int=this.parentNode.$int.appendChild(this.parentNode.$int.ownerDocument.createElement("option"));if(this.value){this.$int.setAttribute("value",this.value);}},true);}).call(apf.XhtmlOptionElement.prototype=new apf.AmlElement());apf.xhtml.setElement("option",apf.XhtmlOptionElement);apf.XhtmlInputElement=function(c,a){this.$init(a||"input",apf.NODE_VISIBLE,c);};(function(){this.$xae=apf.XhtmlElement.prototype.$xae;this.$xre=apf.XhtmlElement.prototype.$xre;this.$handlePropSet=function(a,d,c){if(a=="type"){return;}return apf.XhtmlElement.prototype.$handlePropSet.call(this,a,d,c);};this.addEventListener("DOMNodeInsertedIntoDocument",function(a){var c;if(!(c=this.parentNode.$int)){return;}if(this.$aml){this.$ext=this.$int=apf.insertHtmlNode(this.$aml.serialize?this.$aml:this.$aml.cloneNode(false),c);}else{this.$ext=this.$int=document.createElement(this.localName);if(this.getAttribute("type")){this.$int.setAttribute("type",this.getAttribute("type"));}c.appendChild(this.$int);}},true);}).call(apf.XhtmlInputElement.prototype=new apf.AmlElement());apf.xhtml.setElement("input",apf.XhtmlInputElement);apf.XhtmlHtmlElement=function(c,a){this.$init(a||"html",apf.NODE_VISIBLE,c);this.$int=document.body;this.$tabList=[];this.$focussable=apf.KEYBOARD;this.focussable=true;this.visible=true;this.$isWindowContainer=true;this.focus=function(){this.dispatchEvent("focus");};this.blur=function(){this.dispatchEvent("blur");};apf.window.$addFocus(this);this.addEventListener("DOMNodeInsertedIntoDocument",function(s){var k,j,u,g,t,d=this.attributes,q=this.ownerDocument;for(k=0,j=d.length;k<j;k++){u=(g=d[k]).nodeName.split(":");if(u[0]=="xmlns"){if(t=u[1]){q.$prefixes[t]=g.nodeValue;q.$namespaceURIs[g.nodeValue]=t;}else{q.namespaceURI=g.nodeValue;}}}if(!q.namespaceURI){q.namespaceURI=apf.ns.xhtml;}});};apf.XhtmlHtmlElement.prototype=new apf.XhtmlElement();apf.xhtml.setElement("html",apf.XhtmlHtmlElement);apf.XhtmlSkipChildrenElement=function(c,a){this.$init(a,apf.NODE_VISIBLE,c);};(function(){this.canHaveChildren=false;this.$redraw=function(){var a=this;apf.queue.add("redraw"+this.$uniqueId,function(){var d=a.$ext.parentNode;var c=a.$ext.nextSibling;d.removeChild(a.$ext);a.$ext=apf.insertHtmlNode(null,d,c,a.$aml?(a.$aml.serialize?a.$aml.serialize():a.$aml.xml):a.serialize());});};this.addEventListener("DOMNodeInsertedIntoDocument",function(a){var c;if(!(c=this.parentNode.$int)){return;}this.$ext=apf.insertHtmlNode(null,c,null,this.$aml?(this.$aml.serialize?this.$aml.serialize():this.$aml.xml):this.serialize());},true);}).call(apf.XhtmlSkipChildrenElement.prototype=new apf.AmlElement());apf.xhtml.setElement("object",apf.XhtmlSkipChildrenElement);apf.xhtml.setElement("embed",apf.XhtmlSkipChildrenElement);apf.xhtml.setElement("table",apf.XhtmlSkipChildrenElement);apf.xhtml.setElement("pre",apf.XhtmlSkipChildrenElement);apf.XhtmlBodyElement=function(c,a){this.$init(a||"body",apf.NODE_VISIBLE,c);};(function(){this.addEventListener("DOMNodeInsertedIntoDocument",function(a){if(!this.ownerDocument.body){this.ownerDocument.body=this;}this.$ext=this.$int=document.body;},true);}).call(apf.XhtmlBodyElement.prototype=new apf.AmlElement());apf.xhtml.setElement("body",apf.XhtmlBodyElement);apf.XhtmlIgnoreElement=function(c,a){this.$init(a,apf.NODE_VISIBLE,c);};apf.XhtmlIgnoreElement.prototype=new apf.AmlElement();apf.xhtml.setElement("script",apf.XhtmlIgnoreElement);apf.xhtml.setElement("noscript",apf.XhtmlIgnoreElement);apf.xhtml.setElement("head",apf.XhtmlIgnoreElement);apf.xhtml.setElement("meta",apf.XhtmlIgnoreElement);apf.xinclude=new apf.AmlNamespace();apf.setNamespace("http://www.w3.org/2001/XInclude",apf.xinclude);apf.XiInclude=function(c,a){this.$init(a||"include",apf.NODE_HIDDEN,c);};apf.xinclude.setElement("include",apf.XiInclude);apf.aml.setElement("include",apf.XiInclude);(function(){this.$parsePrio="002";this.$propHandlers.href=this.$propHandlers.src=function(g){if(typeof g!="string"){return c.call(this,g);}this.$path=g.charAt(0)=="{"?g:apf.getAbsolutePath(apf.hostPath,g);var i=this.ownerDocument.$domParser;if(!this.defer){i.$shouldWait++;this.$parseContext=i.$parseContext||[this.parentNode];}d.call(this,this.$path);};function a(g){if(this.callback){this.callback({xmlNode:g,amlNode:this.parentNode});}this.parentNode.removeChild(this);}function c(j){var n=this.ownerDocument.$domParser;if(this.clear){this.parentNode.$int.innerHTML="";}if(j){n.parseFromXml(j,{doc:this.ownerDocument,amlNode:this.parentNode,beforeNode:this,include:true});if(!this.defer){var k=(this.$parseContext[1]||(this.$parseContext[1]={})),i=k.callback,g=this;k.callback=function(){a.call(g,j);if(i){i.call(g.ownerDocument);}};n.$continueParsing.apply(n,this.$parseContext);}else{a.call(this,j);}}else{if(!this.defer){n.$continueParsing.apply(n,this.$parseContext);}a.call(this,j);}}function d(i){apf.console.info("Loading include file: "+i);var g=this;apf.getData(i,apf.extend(this.options||{},{type:"markup",callback:function(q,n,j){if(n!=apf.SUCCESS){var s=new Error(apf.formatErrorString(1007,g,"Loading Includes","Could not load Include file '"+(i||g.src)+"'\nReason: "+j.message));if(j.tpModule.retryTimeout(j,n,null,s)===true){return true;}apf.console.error(s.message);c.call(g,null);return;}q=q.replace(/\<\!DOCTYPE[^>]*>/,"").replace(/^[\r\n\s]*/,"");if(!apf.supportNamespaces){q=q.replace(/xmlns\=\"[^"]*\"/g,"");}if(q.indexOf("<a:application")==-1){q="<a:application xmlns:a='"+apf.ns.aml+"'>"+q+"</a:application>";}var k=apf.getXml(q,null,true);if(!k){throw new Error(apf.formatErrorString(0,null,"Loading include","Could not parse include file. Maybe the file does not exist?",k));}k.setAttribute("filename",j.url);apf.console.info("Loading of "+k[apf.TAGNAME].toLowerCase()+" include done from file: "+j.url);c.call(g,k);},async:true,ignoreOffline:true}));}}).call(apf.XiInclude.prototype=new apf.AmlElement());apf.__ANCHORING__=1<<13;apf.Anchoring=function(){this.$regbase=this.$regbase|apf.__ANCHORING__;this.$anchors=[];var j=1;var d=2;this.$updateQueue=0;this.$inited=this.$parsed=this.$anchoringEnabled=false;this.$hordiff=this.$verdiff=0;this.$rule_v=this.$rule_h=this.$rule_header="";var g=apf.layout;this.$supportedProperties.push("anchors");var c={right:function(s,t){if(!this.$anchoringEnabled&&!this.$setLayout("anchoring")){return;}if(!s&&s!==0){this.$ext.style[t]="";}if(!this.$updateQueue){g.queue(this.$pHtmlNode,this);}this.$updateQueue=this.$updateQueue|d;},bottom:function(s,t){if(!this.$anchoringEnabled&&!this.$setLayout("anchoring")){return;}if(!s&&s!==0){this.$ext.style[t]="";}if(!this.$updateQueue){g.queue(this.$pHtmlNode,this);}this.$updateQueue=this.$updateQueue|j;}};c.left=c.width=c.right;c.top=c.height=c.bottom;this.$propHandlers.anchors=function(s){this.$anchors=s?s.splitSafe("(?:, *| )"):[];if(!this.$anchoringEnabled&&!this.$setLayout("anchoring")){return;}if(!this.$updateQueue&&apf.loaded){g.queue(this.$pHtmlNode,this);}this.$updateQueue=this.$updateQueue|d|j;};this.$disableAnchoring=function(s){if(!this.$inited||!this.$anchoringEnabled||!this.$pHtmlNode){return;}g.removeRule(this.$pHtmlNode,this.$uniqueId+"_anchors");if(g.queue){g.queue(this.$pHtmlNode);}for(var t in c){delete this.$propHandlers[t];}this.removeEventListener("DOMNodeRemoved",k);this.removeEventListener("DOMNodeInserted",a);if(this.right){this.$ext.style.left=apf.getHtmlLeft(this.$ext);}if(this.bottom){this.$ext.style.top=apf.getHtmlTop(this.$ext);}this.removeEventListener("prop.visible",i);this.$inited=false;this.$anchoringEnabled=false;};this.$enableAnchoring=function(){if(this.$inited){return;}apf.extend(this.$propHandlers,c);this.addEventListener("DOMNodeRemoved",k);this.addEventListener("DOMNodeInserted",a);this.addEventListener("prop.visible",i);this.$updateQueue=0|((this.left||this.width||this.right||this.anchors)&&d)|((this.top||this.height||this.bottom||this.anchors)&&j);if(this.$updateQueue){g.queue(this.$pHtmlNode,this);}this.$inited=true;this.$anchoringEnabled=true;};function i(s){if(!(this.$rule_header||this.$rule_v||this.$rule_h)){return;}if(s.value){if(this.$rule_v||this.$rule_h){var t=this.$rule_header+"\n"+this.$rule_v+"\n"+this.$rule_h;g.setRules(this.$pHtmlNode,this.$uniqueId+"_anchors",t);g.queue(this.$pHtmlNode,this);}g.processQueue();}else{g.removeRule(this.$pHtmlNode,this.$uniqueId+"_anchors");g.queue(this.$pHtmlNode);}}function k(s){if(s&&(s.$doOnlyAdmin||s.currentTarget!=this)){return;}if(g.queue&&this.$pHtmlNode){g.removeRule(this.$pHtmlNode,this.$uniqueId+"_anchors");g.queue(this.$pHtmlNode);}}function a(s){if(!this.$amlLoaded||s.currentTarget!=this){return;}if(!s.$isMoveWithinParent&&this.$parsed){this.$moveAnchoringRules(s.$oldParentHtmlNode);}}this.$moveAnchoringRules=function(s,t){var u=s&&g.removeRule(s,this.$uniqueId+"_anchors");if(u){g.queue(s);}if(!this.$rule_v&&!this.$rule_h){return;}this.$rule_header=q.call(this);u=this.$rule_header+"\n"+this.$rule_v+"\n"+this.$rule_h;g.setRules(this.$pHtmlNode,this.$uniqueId+"_anchors",u);g.queue(this.$pHtmlNode,this);};this.$hasAnchorRules=function(){return this.$rule_v||this.$rule_h?true:false;};function q(){return"try{            var oHtml = "+(apf.hasHtmlIdsInJs?this.$ext.getAttribute("id"):"document.getElementById('"+this.$ext.getAttribute("id")+"')")+";                        var pWidth = "+(this.$pHtmlNode==this.$pHtmlDoc.body?"apf.getWindowWidth()":"apf.getHtmlInnerWidth(oHtml.parentNode)")+";                        var pHeight = "+(this.$pHtmlNode==this.$pHtmlDoc.body?"apf.getWindowHeight()":"apf.getHtmlInnerHeight(oHtml.parentNode)")+";            }catch(e){            }";}function n(t,s){return String(t).replace(apf.percentageMatch,"(("+s+" * $1)/100)");}this.$updateLayout=function(){if(!this.$ext.offsetHeight&&!this.$ext.offsetWidth){var E=this;var A=function(N,M,O){if(E.$updateQueue&&apf.isTrue(O)&&(E.$ext.offsetWidth||E.$ext.offsetHeight)){E.$updateLayout();apf.layout.activateRules(E.$ext.parentNode);var P=E;while(P){P.unwatch("visible",A);P=P.parentNode;}E.$isWaitingOnDisplay=false;}};this.$isWaitingOnDisplay=true;this.watch("visible",A);var u=this.parentNode;while(u){u.watch("visible",A);u=u.parentNode;}return;}if(!this.$parsed){if(!this.$ext.getAttribute("id")){apf.setUniqueHtmlId(this.$ext);}this.$rule_header=q.call(this);this.$parsed=true;}if(!this.$updateQueue){if(this.visible){this.$ext.style.display="";}return;}if(this.draggable=="relative"){if("absolute|fixed|relative".indexOf(apf.getStyle(this.$ext,"position"))==-1){this.$ext.style.position="absolute";}}else{if(this.left||this.left===0||this.top||this.top===0||this.right||this.right===0||this.bottom||this.bottom===0||this.$anchors.length){if("absolute|fixed".indexOf(apf.getStyle(this.$ext,"position"))==-1){this.$ext.style.position="absolute";}}}var J;if(this.$updateQueue&d){J=[];this.$hordiff=apf.getWidthDiff(this.$ext);var D=this.$anchors[3]||this.left,H=this.$anchors[1]||this.right,w=this.width,G=D||D===0,L=H||H===0,C=w||w===0;if(H&&typeof H=="string"){H=n(H,"pWidth");}if(G){if(parseInt(D)!=D){D=n(D,"pWidth");J.push("oHtml.style.left = ("+D+") + 'px'");}else{this.$ext.style.left=D+"px";}}if(!G&&L){if(parseInt(H)!=H){H=n(H,"pWidth");J.push("oHtml.style.right = ("+H+") + 'px'");}else{this.$ext.style.right=H+"px";}}if(C){if(parseInt(w)!=w){w=n(w,"pWidth");J.push("oHtml.style.width = Math.max("+(this.minwidth-this.$hordiff)+", Math.min("+(this.maxwidth-this.$hordiff)+", "+w+" - "+this.$hordiff+")) + 'px'");}else{this.$ext.style.width=((w>this.minwidth?(w<this.maxwidth?w:this.maxwidth):this.minwidth)-this.$hordiff)+"px";}}if(G&&L){J.push("oHtml.style.width = (pWidth - ("+H+") - ("+D+") - "+this.$hordiff+") + 'px'");}this.$rule_h=(J.length?"try{"+J.join(";}catch(e){};try{")+";}catch(e){};":"");}if(this.$updateQueue&j){J=[];this.$verdiff=apf.getHeightDiff(this.$ext);var F=this.$anchors[0]||this.top,s=this.$anchors[2]||this.bottom,I=this.height,B=F||F===0,t=s||s===0,K=I||I===0;if(s&&typeof s=="string"){s=n(s,"pHeight");}if(B){if(parseInt(F)!=F){F=n(F,"pHeight");J.push("oHtml.style.top = ("+F+") + 'px'");}else{this.$ext.style.top=F+"px";}}if(!B&&t){if(parseInt(s)!=s){J.push("oHtml.style.bottom = ("+s+") + 'px'");}else{this.$ext.style.bottom=s+"px";}}if(K){if(parseInt(I)!=I){I=n(I,"pHeight");J.push("oHtml.style.height = Math.max("+(this.minheight-this.$verdiff)+", Math.min("+(this.maxheight-this.$verdiff)+", "+I+" - "+this.$verdiff+")) + 'px'");}else{this.$ext.style.height=((I>this.minheight?(I<this.maxheight?I:this.maxheight):this.minheight)-this.$verdiff)+"px";}}if(B&&t){J.push("oHtml.style.height = (pHeight - ("+s+") - ("+F+") - "+this.$verdiff+") + 'px'");}this.$rule_v=(J.length?"try{"+J.join(";}catch(e){};try{")+";}catch(e){};":"");}if(this.$rule_v||this.$rule_h){g.setRules(this.$pHtmlNode,this.$uniqueId+"_anchors",this.$rule_header+"\n"+this.$rule_v+"\n"+this.$rule_h,true);}else{g.removeRule(this.$pHtmlNode,this.$uniqueId+"_anchors");}this.$updateQueue=0;};this.addEventListener("DOMNodeInsertedIntoDocument",function(s){});this.addEventListener("DOMNodeRemovedFromDocument",function(s){this.$disableAnchoring();});};apf.__ALIGNMENT__=1<<12;apf.Alignment=function(){this.$regbase=this.$regbase|apf.__ALIGNMENT__;var l=apf.layout;if(typeof this.dock=="undefined"){this.dock=false;}if(typeof this.dockable=="undefined"){this.dockable=false;}this.$booleanProperties.dock=true;this.$booleanProperties.dockable=true;this.$supportedProperties.push("dock","dockable","align","lean","edge","weight","splitter","minwidth","minheight");this.$disableAlignment=function(purge){if(!this.aData||!this.$alignmentEnabled){return;}for(var prop in propHandlers){delete this.$propHandlers[prop];}this.removeEventListener("DOMNodeRemoved",remove);this.removeEventListener("DOMNodeInserted",reparent);this.removeEventListener("prop.visible",visibleHandler);remove.call(this);this.$alignmentEnabled=false;};this.$enableAlignment=function(purge){this.$alignmentEnabled=true;var buildParent="vbox|hbox".indexOf(this.parentNode.tagName)==-1&&!this.parentNode.pData;apf.extend(this.$propHandlers,propHandlers);this.addEventListener("DOMNodeRemoved",remove);this.addEventListener("DOMNodeInserted",reparent);this.addEventListener("prop.visible",visibleHandler);var layout=l.get(this.$pHtmlNode,buildParent?apf.getBox(this.parentNode.margin||this.$pHtmlNode.getAttribute("margin")||""):null);if(buildParent){this.parentNode.pData=l.parseXml(this.parentNode||apf.getXml("<vbox />"),layout,"vbox",true);layout.root=this.parentNode.pData;}if(!this.aData){this.aData=l.parseXml(this,layout,this,true);}if(this.align){l.addAlignNode(this,layout.root);if(this.aData.hidden||this.visible===false){this.aData.prehide(true);}this.$purgeAlignment();}else{var pData=this.parentNode.aData||this.parentNode.pData;this.aData.stackId=pData.children.push(this.aData)-1;this.aData.parent=pData;}};function visibleHandler(e){if(!this.aData){return;}if(!this.aData.hidden==e.value){return;}if(e.value){if(this.aData.preshow()!==false){this.$ext.style.display="none";}this.$purgeAlignment();}else{this.$ext.style.display="block";this.aData.prehide();this.$purgeAlignment();}apf.layout.processQueue();}this.$purgeAlignment=function(){var layout=l.get(this.$pHtmlNode);if(this.$ext&&this.$ext.style.display=="block"&&!this.$ext.offsetHeight&&!this.$ext.offsetWidth){var _self=this;var propChange=function(name,old,value){if(_self.$ext.offsetWidth||_self.$ext.offsetHeight){l.queue(_self.$pHtmlNode,null,layout.root);var p=_self;while(p){p.unwatch("visible",propChange);p=p.parentNode;}_self.$isWaitingOnDisplay=false;}};this.$isWaitingOnDisplay=true;this.watch("visible",propChange);var p=this.parentNode;while(p){p.watch("visible",propChange);p=p.parentNode;}return;}l.queue(this.$pHtmlNode,null,layout.root);};function remove(e){if(e&&(e.$doOnlyAdmin||e.currentTarget!=this)){return;}if(this.aData){this.aData.remove();this.$purgeAlignment();if(this.parentNode.pData&&!this.parentNode.pData.children.length){l.removeAll(this.parentNode.pData);this.parentNode.pData=null;}if(this.$ext){this.$ext.style.display="none";}}}function reparent(e){if(!this.$amlLoaded||e.currentTarget!=this){return;}if(!e.$isMoveWithinParent&&this.aData&&this.aData.pHtml!=this.$pHtmlNode){this.aData.pHtml=this.$pHtmlNode;this.$enableAlignment();}}var propHandlers={align:function(value){if(value){this.$setLayout("alignment");}else{this.$setLayout("anchoring");this.$ext.style.display="block";}},lean:function(value){this.aData.isBottom=(value||"").indexOf("bottom")>-1;this.aData.isRight=(value||"").indexOf("right")>-1;this.$purgeAlignment();},edge:function(value){this.aData.edgeMargin=Math.max(this.aData.splitter||0,value!="splitter"?value:0);this.aData.splitter=value=="splitter"?5:false;this.$purgeAlignment();},weight:function(value){this.aData.weight=parseFloat(value);this.$purgeAlignment();},splitter:function(value){this.aData.splitter=value?5:false;this.aData.edgeMargin=Math.max(this.aData.splitter||0,this.edge||0);if(!value&&this.align&&this.align.indexOf("-splitter")){this.align=this.aData.template=this.align.replace("-splitter","");}this.$purgeAlignment();},width:function(value){this.width=null;this.aData.fwidth=value||false;if(this.aData.fwidth&&this.aData.fwidth.indexOf("/")>-1){this.aData.fwidth=eval(this.aData.fwidth);if(this.aData.fwidth<=1){this.aData.fwidth=(this.aData.fwidth*100)+"%";}}this.$purgeAlignment();},height:function(value){this.height=null;this.aData.fheight=String(value)||false;if(this.aData.fheight&&this.aData.fheight.indexOf("/")>-1){this.aData.fheight=eval(this.aData.fheight);if(this.aData.fheight<=1){this.aData.fheight=(this.aData.fheight*100)+"%";}}this.$purgeAlignment();},minwidth:function(value){this.aData.minwidth=value;this.$purgeAlignment();},minheight:function(value){this.aData.minheight=value;this.$purgeAlignment();}};this.addEventListener("DOMNodeRemovedFromDocument",function(e){this.$disableAlignment();this.aData=null;});};apf.__CONTENTEDITABLE__=1<<24;apf.__GUIELEMENT__=1<<15;apf.__VALIDATION__=1<<6;apf.GuiElement=function(){this.$init(true);};(function(){this.$regbase=this.$regbase|apf.__GUIELEMENT__;this.$focussable=apf.KEYBOARD_MOUSE;this.visible=true;this.$booleanProperties["disable-keyboard"]=true;this.$booleanProperties.visible=true;this.$booleanProperties.focussable=true;this.$supportedProperties.push("draggable","resizable");this.$supportedProperties.push("focussable","zindex","disabled","tabindex","disable-keyboard","contextmenu","visible","autosize","loadaml","actiontracker","alias","width","left","top","height","tooltip");this.$setLayout=function(c){if(!this.$drawn||!this.$pHtmlNode){return false;}if(this.parentNode){if(this.parentNode.localName=="table"){this.parentNode.register(this);this.$disableCurrentLayout=null;return c=="table";}else{if("vbox|hbox".indexOf(this.parentNode.localName)>-1){this.parentNode.register(this);this.$disableCurrentLayout=null;return c==this.parentNode.localName;}else{if(this.align){if(!this.$alignmentEnabled){if(this.$disableCurrentLayout){this.$disableCurrentLayout();}this.$enableAlignment();this.$disableCurrentLayout=this.$disableAlignment;}return c=="alignment";}}}}if(!this.$anchoringEnabled){if(this.$disableCurrentLayout){this.$disableCurrentLayout();}this.$enableAnchoring();this.$disableCurrentLayout=this.$disableAnchoring;}return c=="anchoring";};this.addEventListener("DOMNodeInserted",function(c){if(c.currentTarget==this&&"vbox|hbox|table".indexOf(this.parentNode.localName)==-1){this.$setLayout();}});this.implement(apf.Anchoring,apf.Alignment);this.setWidth=function(c){this.setProperty("width",c,false,true);return this;};this.setHeight=function(c){this.setProperty("height",c,false,true);return this;};this.setLeft=function(c){this.setProperty("left",c,false,true);return this;};this.setTop=function(c){this.setProperty("top",c,false,true);return this;};if(!this.show){this.show=function(){this.setProperty("visible",true,false,true);return this;};}if(!this.hide){this.hide=function(){this.setProperty("visible",false,false,true);return this;};}this.getWidth=function(){return(this.$ext||{}).offsetWidth;};this.getHeight=function(){return(this.$ext||{}).offsetHeight;};this.getLeft=function(){return(this.$ext||{}).offsetLeft;};this.getTop=function(){return(this.$ext||{}).offsetTop;};this.enable=function(){this.setProperty("disabled",false,false,true);return this;};this.disable=function(){this.setProperty("disabled",true,false,true);return this;};this.sendToBack=function(){this.setProperty("zindex",0,false,true);return this;};this.bringToFront=function(){this.setProperty("zindex",apf.all.length+1,false,true);return this;};this.sendBackwards=function(){this.setProperty("zindex",this.zindex-1,false,true);return this;};this.bringForward=function(){this.setProperty("zindex",this.zindex+1,false,true);return this;};this.hasFocus=function(){};this.addEventListener("DOMNodeInsertedIntoDocument",function(d){var c=this.$aml;if(this.parentNode){if(this.localName=="item"&&this.parentNode.hasFeature(apf.__MULTISELECT__)){this.$pHtmlNode=this.parentNode.$container;}else{this.$pHtmlNode=this.parentNode.$int;}}if(!this.$pHtmlNode){return;}this.$pHtmlDoc=this.$pHtmlNode.ownerDocument||document;if(this.$initSkin){this.$initSkin(c);}if(this.$draw){this.$draw();}if(d.id){this.$ext.setAttribute("id",d.id);}if(typeof this.visible=="undefined"){this.visible=true;}if(apf.debug&&this.$ext&&this.$ext.nodeType){this.$ext.setAttribute("uniqueId",this.$uniqueId);}if(this.$focussable&&typeof this.focussable=="undefined"){apf.GuiElement.propHandlers.focussable.call(this);}this.$drawn=true;},true);this.addEventListener("DOMNodeInsertedIntoDocument",function(c){if(!this.$pHtmlNode){return;}this.$setLayout();if(this.$loadAml){this.$loadAml(this.$aml);}});var a;this.addEventListener("$event.resize",a=function(d){apf.layout.setRules(this.$ext,"resize","var o = apf.all["+this.$uniqueId+"];            if (o) o.dispatchEvent('resize');",true);apf.layout.queue(this.$ext);this.removeEventListener("$event.resize",a);});this.addEventListener("contextmenu",function(q){if(!this.contextmenus){return;}if(this.hasFeature(apf.__DATABINDING__)){var c;var u=this.hasFeature(apf.__MULTISELECT__)?this.selected:this.xmlRoot;var n,k,j,d,g,s,t,w;for(n=0,k=this.contextmenus.length;n<k;n++){d=(typeof(t=this.contextmenus[n])=="string");w=null;if(!d&&t.match&&u){w=(t.cmatch||(t.cmatch=apf.lm.compile(t.match,{xpathmode:3,injectself:true})))(u);}if(d||u&&w||!t.match){s=d?t:t.menu;if(!self[s]){throw new Error(apf.formatErrorString(0,this,"Showing contextmenu","Could not find contextmenu by name: '"+s+"'"),this.$aml);return;}self[s].display(q.x,q.y,null,this,u);q.returnValue=false;q.cancelBubble=true;break;}}}else{s=typeof this.contextmenus[0]=="string"?this.contextmenus[0]:this.contextmenus[0].getAttribute("menu");if(!self[s]){throw new Error(apf.formatErrorString(0,this,"Showing contextmenu","Could not find contextmenu by name: '"+s+"'",this.$aml));return;}self[s].display(q.x,q.y,null,this);q.returnValue=false;q.cancelBubble=true;}});}).call(apf.GuiElement.prototype=new apf.AmlElement());apf.GuiElement.propHandlers={focussable:function(a){this.focussable=typeof a=="undefined"||a;if(!this.hasFeature(apf.__FOCUSSABLE__)){this.implement(apf.Focussable);}if(this.focussable){apf.window.$addFocus(this,this.tabindex);}else{apf.window.$removeFocus(this);}},zindex:function(a){this.$ext.style.zIndex=a;},visible:function(a){if(apf.isFalse(a)||typeof a=="undefined"){this.$ext.style.display="none";if(apf.document.activeElement==this||this.canHaveChildren&&apf.isChildOf(this,apf.document.activeElement,false)){if(apf.config.allowBlur&&this.hasFeature(apf.__FOCUSSABLE__)){this.blur();}else{apf.window.moveNext();}}this.visible=false;}else{this.$ext.style.display="block";if(apf.layout&&this.$int){apf.layout.forceResize(this.$int);}this.visible=true;}},disabled:function(k){if(!this.$drawn){var a=this;this.disabled=false;apf.queue.add("disable"+this.$uniqueId,function(i){a.disabled=k;apf.GuiElement.propHandlers.disabled.call(a,k);});return;}if(this.canHaveChildren){if(k!=-1){k=this.disabled=apf.isTrue(k);}var d=this.childNodes;for(var j,g=0,c=d.length;g<c;g++){j=d[g];if(j.nodeFunc==apf.NODE_VISIBLE){if(k&&j.disabled!=-1){j.$disabled=j.disabled||false;}j.setProperty("disabled",k?-1:false);}}if(this.$isWindowContainer){return;}}if(k==-1||k==false){}else{if(typeof this.$disabled=="boolean"){if(k===null){k=this.$disabled;this.$disabled=null;}else{this.$disabled=k||false;return;}}}if(apf.isTrue(k)||k==-1){this.disabled=false;if(apf.document.activeElement==this){apf.window.moveNext(true);if(apf.document.activeElement==this){this.$blur();}}if(this.hasFeature(apf.__PRESENTATION__)){this.$setStyleClass(this.$ext,this.$baseCSSname+"Disabled");}if(this.$disable){this.$disable();}this.disabled=k;}else{if(this.hasFeature(apf.__DATABINDING__)&&apf.config.autoDisable&&!(!this.$bindings||this.xmlRoot)){return false;}this.disabled=false;if(apf.document.activeElement==this){this.$focus();}if(this.hasFeature(apf.__PRESENTATION__)){this.$setStyleClass(this.$ext,null,[this.$baseCSSname+"Disabled"]);}if(this.$enable){this.$enable();}}},enabled:function(a){this.setProperty("disabled",!a);},"disable-keyboard":function(a){this.disableKeyboard=apf.isTrue(a);},tooltip:function(a){this.$ext.setAttribute("title",a);},align:function(a){if(a){this.$setLayout("alignment");}},contextmenu:function(a){this.contextmenus=[a];},actiontracker:function(a){if(!a){this.$at=null;}else{if(a.tagName=="actiontracker"){this.$at=a;}else{this.$at=typeof a=="string"&&self[a]?apf.nameserver.get("actiontracker",a)||self[a].getActionTracker():apf.setReference(a,apf.nameserver.register("actiontracker",a,new apf.actiontracker()));if(!this.$at.name){this.$at.name=a;}}}},aml:function(a){this.insertMarkup(a);}};apf.__PRESENTATION__=1<<9;apf.Presentation=function(){this.$init(true);};(function(){this.$regbase=this.$regbase|apf.__PRESENTATION__;this.$supportedProperties.push("skin");this.$propHandlers.skinset=this.$propHandlers.style=function(d){if(!this.styleAttrIsObj&&this.$amlLoaded){this.$ext.setAttribute("style",d);}};var a;this.$propHandlers["class"]=function(d){this.$setStyleClass(this.$ext,d,[a||""]);};this.$setStyleClass=apf.setStyleClass;function c(n){if(!this.$amlLoaded||n&&(n.$isMoveWithinParent||n.currentTarget!=this)){return;}this.$setInheritedAttribute(this,"skinset");if(this.attributes.getNamedItem("skin")){return;}var d,i=this.parentNode,g;if((d=this.$canLeechSkin.dataType==apf.STRING?this.$canLeechSkin:this.localName)&&i.$originalNodes&&(g=i.$originalNodes[d])&&g.getAttribute("inherit")){var j=g.getAttribute("link");this.$isLeechingSkin=true;if(j){this.$forceSkinChange(j);}else{var k=i.skinName.split(":");this.$forceSkinChange(k[1],k[0]);}}else{if(this.$isLeechingSkin){delete this.kin;this.$forceSkinChange();}}}this.$initSkin=function(d){if(this.$canLeechSkin){this.addEventListener("DOMNodeInserted",c);}if(!this.skin){this.skin=this.getAttribute("skin");}var g,j=this.parentNode,i;if(this.$canLeechSkin&&!this.skin&&(g=this.$canLeechSkin.dataType==apf.STRING?this.$canLeechSkin:this.localName)&&j.$originalNodes&&(i=j.$originalNodes[g])&&i.getAttribute("inherit")){var k=i.getAttribute("link");this.$isLeechingSkin=true;if(k){this.skin=k;this.$loadSkin();}else{this.$loadSkin(j.skinName);}}else{if(!this.skinset){this.skinset=this.getAttribute("skinset");}this.$loadSkin(null,this.$canLeechSkin);}};this.$loadSkin=function(i,g){this.baseSkin=i||(this.skinset||this.$setInheritedAttribute("skinset"))+":"+(this.skin||this.localName);clearTimeout(this.$skinTimer);if(this.skinName){this.$blur();this.$baseCSSname=null;}this.skinName=this.baseSkin;this.$pNodes={};this.$originalNodes=apf.skins.getTemplate(this.skinName,true);if(!this.$originalNodes){var j=this.skin;if(j){var d=this.skinName.split(":")[0];this.baseName=this.skinName="default:"+j;this.$originalNodes=apf.skins.getTemplate(this.skinName);if(!this.$originalNodes&&d!="default"){this.baseName=this.skinName=d+":"+this.localName;this.$originalNodes=apf.skins.getTemplate(this.skinName,true);}}if(!this.$originalNodes){this.baseName=this.skinName="default:"+this.localName;this.$originalNodes=apf.skins.getTemplate(this.skinName);}if(!this.$originalNodes){if(g){return(this.baseName=this.skinName=this.originalNode=null);}throw new Error(apf.formatErrorString(1077,this,"Presentation","Could not load skin: "+this.baseSkin));}}if(this.$originalNodes){apf.skins.setSkinPaths(this.skinName,this);}};this.$getNewContext=function(g,d){if(g!=g.toLowerCase()){throw new Error("Invalid layout node name ('"+g+"'). lowercase required");}if(!this.$originalNodes[g]){throw new Error(apf.formatErrorString(0,this,"Getting new skin item","Missing node in skin description '"+g+"'"));}this.$pNodes[g]=this.$originalNodes[g].cloneNode(true);};this.$hasLayoutNode=function(d){if(d!=d.toLowerCase()){throw new Error("Invalid layout node name ('"+d+"'). lowercase required");}return this.$originalNodes[d]?true:false;};this.$getLayoutNode=function(d,j,i){if(d!=d.toLowerCase()){throw new Error("Invalid layout node name ('"+d+"'). lowercase required");}if(!this.$pNodes){throw new Error("Skin not loaded for :"+this.serialize(true));}var g=this.$pNodes[d]||this.$originalNodes[d];if(!g){if(!this.$dcache){this.$dcache={};}if(!this.$dcache[d+"."+this.skinName]){this.$dcache[d+"."+this.skinName]=true;apf.console.info("Could not find node '"+d+"' in '"+this.skinName+"'","skin");}return false;}if(!j){return apf.getFirstElement(g);}var k=g.selectSingleNode("@"+j);if(!k){return null;}return(i?apf.queryNode(k.nodeValue,i):apf.getFirstElement(g).selectSingleNode(k.nodeValue));};this.$getOption=function(g,j){g=g.toLowerCase();var i=this.$pNodes[g]||this.$originalNodes[g];if(!j||!i){return i;}var d=i.selectSingleNode("@"+j);return d?d.nodeValue:"";};this.$getExternal=function(d,g,j,k){if(!g){g=this.$pHtmlNode;}if(!d){d="main";}d=d.toLowerCase();this.$getNewContext(d);var n=this.$getLayoutNode(d);var i;if(i=(k||this).getAttributeNode("style")){n.setAttribute("style",i.nodeValue);}if(i=(k||this).getAttributeNode("class")){this.$setStyleClass(n,(a=i.nodeValue));}if(j){j.call(this,n);}n=apf.insertHtmlNode(n,g);n.host=this;if(i=(k||this).getAttributeNode("bgimage")){n.style.backgroundImage="url("+apf.getAbsolutePath(this.mediaPath,i.nodeValue)+")";}if(!this.$baseCSSname){this.$baseCSSname=n.className.trim().split(" ")[0];}this.minwidth=apf.getCoord(parseInt(this.$getOption("main","minwidth")),5);this.minheight=apf.getCoord(parseInt(this.$getOption("main","minheight")),5);this.maxwidth=apf.getCoord(parseInt(this.$getOption("main","maxwidth")),10000);this.maxheight=apf.getCoord(parseInt(this.$getOption("main","maxheight")),10000);return n;};this.$focus=function(){if(!this.$ext){return;}this.$setStyleClass(this.oFocus||this.$ext,this.$baseCSSname+"Focus");};this.$blur=function(){if(this.renaming){this.stopRename(null,true);}if(!this.$ext){return;}this.$setStyleClass(this.oFocus||this.$ext,"",[this.$baseCSSname+"Focus"]);};this.$fixScrollBug=function(){if(this.$int!=this.$ext){this.oFocus=this.$int;}else{this.oFocus=this.$int=this.$ext.appendChild(document.createElement("div"));this.$int.style.height="100%";this.$int.className="focusbug";}};}).call(apf.Presentation.prototype=new apf.GuiElement());apf.config.$inheritProperties.skinset=1;apf.__VALIDATION__=1<<6;apf.__DATABINDING__=1<<1;apf.DataBinding=function(){this.$init(true);this.$loadqueue=this.$dbTimer=null;this.$regbase=this.$regbase|apf.__DATABINDING__;this.$mainBind="value";this.$bindings=this.$cbindings=this.$attrBindings=false;this.$attrExcludePropBind=apf.extend({model:1,each:1},this.$attrExcludePropBind);this.setQueryValue=function(g,k,i){var j=apf.createNodeFromXpath(this[i||"xmlRoot"],g);if(!j){return null;}apf.setNodeValue(j,k,true);return j;};this.queryValue=function(g,i){return apf.queryValue(this[i||"xmlRoot"],g);};this.queryValues=function(g,i){return apf.queryValues(this[i||"xmlRoot"],g);};this.queryNode=function(g,i){var j=this[i||"xmlRoot"];return j?j.selectSingleNode(g):null;};this.queryNodes=function(g,i){var j=this[i||"xmlRoot"];return j?j.selectNodes(g):[];};this.$checkLoadQueue=function(){if(this.$loadqueue){this.xmlRoot=null;var g=this.load(this.$loadqueue[0],{cacheId:this.$loadqueue[1]});if(!g||g.dataType!=apf.ARRAY||g!=this.$loadqueue){this.$loadqueue=null;}}};this.$execProperty=function(n,j){var i=this.$attrBindings[n];if(i.cvalue.asyncs){var g=this;return i.cvalue.call(this,j,function(q){g.setProperty(n,q,true);});}else{var k=i.cvalue.call(this,j);}this.setProperty(n,k,true);};this.$applyBindRule=function(i,j,g,n){var k=this.$attrBindings[i]&&this.$attrBindings[i].cvalue||this.$cbindings[i];return k?k.call(this,j,n):g||"";};this.$hasBindRule=function(g){return this.$attrBindings[g]||this.$bindings&&this.$bindings[g];};this.$getBindRule=function(g,i){return this.$attrBindings[g]||this.$bindings&&this.$bindings.getRule(g,i);};var c={drag:1,drop:1,dragcopy:1};this.$getDataNode=function(j,k,t,i,g){var q,s=this.$attrBindings[j];if(s){if(s.cvalue.type!=3){return false;}var n=s.cvalue2||s.compile("value",{xpathmode:g?4:3,parsecode:1,injectself:c[j]});if(n&&(q=n(k,t))){if(i){i.push(s);}return q;}return false;}return this.$bindings&&this.$bindings.getDataNode(j,k,t,i,g);};this.setModel=function(g){this.setAttribute("model",g,false,true);};this.getModel=function(g){if(g&&!this.$model){return this.dataParent?this.dataParent.parent.getModel(true):null;}return this.$model;};this.reload=this.reload||function(){this.load(this.xmlRoot,{cacheId:this.cacheId,force:true});};this.load=function(i,g){if(g){var n=g.cacheId,k=g.force,q=g.noClearMsg;}if(n&&n==this.cacheId&&!k){return;}if(apf.popup.isShowing(this.$uniqueId)){apf.popup.forceHide();}if(i){if(typeof i=="string"){if(i.charAt(0)=="<"){i=apf.getXmlDom(i).documentElement;}else{return apf.model.prototype.$loadFrom.call(this,i,g);}}else{if(i.nodeType==9){i=i.documentElement;}else{if(i.nodeType==3||i.nodeType==4){i=i.parentNode;}else{if(i.nodeType==2){i=i.ownerElement||i.parentNode||i.selectSingleNode("..");}}}}}if(this.$preventDataLoad||!this.$canLoadData&&((!this.$bindings&&!this.$canLoadDataAttr)||!this.$amlLoaded)&&(!this.hasFeature(apf.__MULTISELECT__)||!(this.each||this.$template))||this.$canLoadData&&!this.$canLoadData()){this.xmlRoot=i;if(this.$amlLoaded&&!this.$attrBindings){apf.console.warn("Could not load data yet in "+(this.localName?this.localName+"["+(this.name||"")+"]":this.nodeName)+". The loaded data is queued until smartbinding rules are loaded or set manually.");}return this.$loadqueue=[i,n];}if(this.dataParent&&this.dataParent.xpath){this.dataParent.parent.signalXmlUpdate[this.$uniqueId]=!i;}if(!i&&(!n||!this.$isCached||!this.$isCached(n))){apf.console.warn("No xml root node was given to load in "+this.localName+"["+(this.name||"")+"]. Clearing any loaded xml in this component");this.clear(q);if(apf.config.autoDisable&&this.$createModel===false){this.setProperty("disabled",true);}return;}var j=this.disabled;this.disabled=false;if(this.dispatchEvent("beforeload",{xmlNode:i})===false){return false;}apf.console.info("Loading XML data in "+(this.localName?this.localName+"["+(this.name||"")+"]":this.nodeName));if(this.caching&&!k&&i&&i==this.xmlRoot){return;}this.clear(true,true);this.cacheId=n;if(this.dispatchEvent("$load",{forceNoCache:k,xmlNode:i})===false){delete this.cacheId;return;}this.documentId=apf.xmldb.getXmlDocId(i);this.xmlRoot=i;this.setProperty("root",this.xmlRoot);this.$load(i);this.$loadSubData(i);if(this.$createModel===false){this.disabled=true;this.setProperty("disabled",false);}else{this.disabled=j;}this.dispatchEvent("afterload",{xmlNode:i});};this.$loadSubData=function(g){if(this.$hasLoadStatus(g)){return;}var n,k=this.$getBindRule("load",g);if(k&&(!k[1]||k[1](g))){this.$setLoadStatus(g,"loading");if(this.$setClearMessage){this.$setClearMessage(this["loading-message"],"loading");}var j=this.getModel(true);if(!j){throw new Error("Could not find model");}var i=this;if(j.$insertFrom(k.getAttribute("get"),{xmlNode:n,insertPoint:g,amlNode:this,callback:function(){i.setProperty(i.hasFeature(apf.__MULTISELECT__)?"selected":"root",g);}})===false){this.clear(true);if(apf.config.autoDisable){this.setProperty("disabled",true);}}}};this.clear=function(j,n,i){if(!this.$container){return;}if(this.clearSelection){this.clearSelection(true);}var k=this.$container.offsetHeight;if(this.dispatchEvent("$clear")!==false){this.$container.innerHTML="";}if(typeof j=="string"){var g=j;j=false;if(!this[g+"-message"]){this.$setInheritedAttribute(g+"-message");}}this.$lastClearType=g||null;if(!j&&this.$setClearMessage){this.$setClearMessage(g?this[g+"-message"]:this["empty-message"],g||"empty",k);}else{if(this.$removeClearMessage){this.$removeClearMessage();}}if(!i){this.documentId=this.xmlRoot=this.cacheId=null;}if(!j){if(this.hasFeature(apf.__MULTISELECT__)){this.setProperty("length",0);}}};this.clearMessage=function(g){this.customMsg=g;this.clear("custom");};this.$setLoadStatus=function(i,k,g){var j=i.getAttribute("a_loaded");j=j?j.replace(new RegExp("\\|\\w+\\:"+this.$uniqueId+"\\|","g"),""):"";if(!g){j+="|"+k+":"+this.$uniqueId+"|";}i.setAttribute("a_loaded",j);};this.$removeLoadStatus=function(g){this.$setLoadStatus(g,null,true);};this.$hasLoadStatus=function(g,j){var i=g.getAttribute("a_loaded");if(!i){return false;}return(i.indexOf((j||"")+":"+this.$uniqueId+"|")!=-1);};this.insert=function(j,g){if(typeof j=="string"){if(j.charAt(0)=="<"){j=apf.getXmlDom(j).documentElement;}else{if(!g.insertPoint){g.insertPoint=this.xmlRoot;}return apf.model.prototype.$insertFrom.call(this,j,g);}}var k=g.insertPoint||this.xmlRoot;if(this.dispatchEvent("beforeinsert",{xmlParentNode:k})===false){return false;}if(typeof g.copyAttributes=="undefined"){g.copyAttributes=true;}var i=apf.mergeXml(j,k,g);apf.xmldb.applyChanges("insert",k);if(this.selectable&&this.autoselect){if(this.xmlNode==i){this.$selectDefault(this.xmlNode);}}else{if(this.xmlNode==i){this.setProperty("root",this.xmlNode);}}if(this.$hasLoadStatus(k,"loading")){this.$setLoadStatus(k,"loaded");}this.dispatchEvent("afterinsert");};this.$booleanProperties["render-root"]=true;this.$supportedProperties.push("empty-message","loading-message","offline-message","render-root","smartbinding","bindings","actions");this.$propHandlers["render-root"]=function(g){this.renderRoot=g;};this.$propHandlers["empty-message"]=function(g){this["empty-message"]=g;if(this.$updateClearMessage){this.$updateClearMessage(this["empty-message"],"empty");}};this.$propHandlers["loading-message"]=function(g){this["loading-message"]=g;if(this.$updateClearMessage){this.$updateClearMessage(this["loading-message"],"loading");}};this.$propHandlers["offline-message"]=function(g){this["offline-message"]=g;if(this.$updateClearMessage){this.$updateClearMessage(this["offline-message"],"offline");}};this.$propHandlers.smartbinding=this.$propHandlers.actions=this.$propHandlers.bindings=function(i,j){var g="$"+j;if(this[g]){this[g].unregister(this);}if(!i){return;}if(!apf.nameserver.get(j,i)){throw new Error(apf.formatErrorString(1064,this,"Setting "+j,"Could not find "+j+" by name '"+i+"'"));}apf.nameserver.get(j,i).register(this);if(j!="actions"){this.$checkLoadQueue();}};var d={caption:1,icon:1,select:1,css:1,sort:1,drop:2,drag:2,dragcopy:2,eachvalue:1};this.$addAttrBind=function(g,k,u){if(k.models){if(this.hasFeature(apf.__MULTISELECT__)){if(d[g]){throw new Error("Cannot use external model inside "+g+" rule");}}}var n,s,A,q,B=k.xpaths,t={};for(n=0;n<B.length;n+=2){if(!t[(A=B[n])]){t[A]=1;}else{t[A]++;}}if(!this.$propsUsingMainModel){this.$propsUsingMainModel={};}var w=(this.$attrBindings||(this.$attrBindings={}))[g]={cvalue:k,value:u,compile:apf.BindingRule.prototype.$compile,models:[]};delete this.$propsUsingMainModel[g];for(s,n=0;n<B.length;n+=2){A=B[n];if(t[A]==-1){continue;}s=B[n+1];if(A=="#"||s=="#"){var j=(w.cvalue3||(w.cvalue3=apf.lm.compile(w.value,{xpathmode:5})))(this.xmlRoot);if(typeof j!="string"){q=j.model&&j.model.$isModel&&j.model;if(q){s=j.xpath;}else{if(j.model){q=apf.xmldb.findModel(j.model);s=apf.xmlToXpath(j.model,q.data)+(j.xpath?"/"+j.xpath:"");}else{this.addEventListener("prop."+g,function(D){var C=(w.cvalue3||(w.cvalue3=apf.lm.compile(w.value,{xpathmode:5})))(this.xmlRoot);if(C.model){this.removeEventListener("prop."+g,arguments.callee);var i=this;setTimeout(function(){i.$clearDynamicProperty(g);i.$setDynamicProperty(g,u);},10);}});continue;}}}else{q=null;}}else{q=null;}if(!q){if(A){q=apf.nameserver.get("model",A)||apf.setReference(A,apf.nameserver.register("model",A,new apf.model()));}else{if(!this.$model&&!this.$initingModel){a.call(this);}q=this.$model;if(!this.hasFeature(apf.__MULTISELECT__)&&d[g]!=2||!d[g]){this.$propsUsingMainModel[g]={xpath:s,optimize:t[A]==1};}}}if(q&&(!this.hasFeature(apf.__MULTISELECT__)&&d[g]!=2||!d[g])){q.$bindXmlProperty(this,g,s,t[A]==1,u.indexOf("*[")>-1);w.models.push(q);}t[A]=-1;}w.xpath=s;this.$canLoadDataAttr=d[g]==1;this.$checkLoadQueue();};this.$removeAttrBind=function(n){var j=this.$attrBindings[n];if(!j){return;}delete this.$attrBindings[n];var k=j.models;for(var g=0;g<k.length;g++){k[g].$unbindXmlProperty(this,n);}};this.$initingModel;function a(){this.$initingModel=true;this.$setInheritedAttribute("model");}this.addEventListener("DOMNodeInsertedIntoDocument",function(g){if(!this.model&&this.$setClearMessage&&!this.value){this.$setClearMessage(this["empty-message"],"empty");}this.$amlLoaded=true;this.$checkLoadQueue();});this.$propHandlers.model=function(s){if(!s&&!this.$modelParsed){if(this.$model){this.clear();this.$model.unregister(this);this.$model=null;this.lastModelId="";}else{if(this.dataParent){this.dataParent.parent=null;}}return;}this.$initingModel=true;var k;if((k=this.$modelParsed)&&k.type!=2){var q,n=k.props;if(this.dataParent){this.dataParent=null;}for(var t in n){this.dataParent={parent:self[t.split(".")[0]],xpath:null,model:this.$modelParsed.instruction};q=true;break;}if(q){if(this.dataParent&&!this.dataParent.signalXmlUpdate){this.dataParent.signalXmlUpdate={};}}this.$modelParsed=null;}var j;if(typeof s=="object"){if(s.dataType==apf.ARRAY){j=apf.nameserver.get("model",s[0]);j.register(this,s[1]);return;}else{if(s.$isModel){j=s;s=this.model=j.name;if(!s){j.setProperty("id",s=this.model="model"+j.$uniqueId);}}else{if(this.dataParent){this.model=this.dataParent.model;j=apf.xmldb.findModel(s);var i=apf.xmlToXpath(s,j.data,true)||".";if(j.queryNode(i)!=s){throw new Error("xml data node is not attached to model");}j.register(this,i);return;}else{}}}}clearTimeout(this.$dbTimer);if(!this.$amlLoaded&&this.nodeType==1){var g=this;this.$dbTimer=$setTimeout(function(){if(!g.$amlDestroyed){apf.setModel(s,g);}});}else{apf.setModel(s,this);}};};apf.DataBinding.prototype=new apf.Presentation();apf.config.$inheritProperties.model=1;apf.config.$inheritProperties["empty-message"]=1;apf.config.$inheritProperties["loading-message"]=1;apf.config.$inheritProperties["offline-message"]=1;apf.config.$inheritProperties.noloading=1;apf.Init.run("databinding");apf.MultiselectBinding=function(){if(!this.setQueryValue){this.implement(apf.DataBinding);}this.$init(function(){this.$selectTimer={};});};(function(){this.length=0;this.$attrExcludePropBind=apf.extend({caption:2,icon:2,eachvalue:2,select:2,css:2,sort:2,drag:2,drop:2,dragcopy:2,selected:2,each:1,selection:3,"selection-unique":3,"selection-constructor":3},this.$attrExcludePropBind);this.resort=function(i,d,g){if(!this.$sort){this.$sort=new apf.Sort();}this.$sort.set(i,d);if(this.clearAllCache){this.clearAllCache();}if(g){return;}var c=this;(function j(q,u){var s=c.$sort.apply(apf.getArrayFromNodelist(q.selectNodes(c.each)));for(var n=0;n<s.length;n++){if(c.$isTreeArch||c.$withContainer){var t=apf.xmldb.findHtmlNode(s[n],c);if(!c.$findContainer){throw new Error(apf.formatErrorString(c,"Sorting Nodes","This component does not                              implement _self.$findContainer"));}var k=c.$findContainer(t);u.appendChild(t);if(!apf.isChildOf(t,k,true)){u.appendChild(k);}j(s[n],k);}else{u.appendChild(apf.xmldb.findHtmlNode(s[n],c));}}})(this.xmlRoot,this.$container);return i;};this.toggleSortOrder=function(){return this.resort({ascending:!this.$sort.get().ascending}).ascending;};this.getSortSettings=function(){return this.$sort.get();};this.getTraverseNodes=function(d){if(!this.each){throw new Error("Could not render bound data. Missing 'each' rule for "+this.localName+(this.id&&"["+this.id+"]"||""));}if(this.$sort){var c=apf.getArrayFromNodelist((d||this.xmlRoot).selectNodes(this.each));return this.$sort.apply(c);}return(d||this.xmlRoot).selectNodes(this.each);};this.getFirstTraverseNode=function(d){if(this.$sort){var c=(d||this.xmlRoot).selectNodes(this.each);return this.$sort.apply(c)[0];}return(d||this.xmlRoot).selectSingleNode(this.each);};this.getLastTraverseNode=function(d){var c=this.getTraverseNodes(d||this.xmlRoot);return c[c.length-1];};this.isTraverseNode=function(g){var c=this.getTraverseNodes(this.getTraverseParent(g)||this.xmlRoot);for(var d=0;d<c.length;d++){if(c[d]==g){return true;}}return false;};this.getNextTraverseSelected=function(j,c,n){if(!j){j=this.selected;}if(!n){n=1;}var g=0;var d=this.getTraverseNodes(this.getTraverseParent(j)||this.xmlRoot);while(d[g]&&d[g]!=j){g++;}var k=(c==null)?d[g+n]||d[g-n]:(c?d[g+n]:d[g-n]);return k||n&&(g<n||(g+1)>Math.floor(d.length/n)*n)?k:(c?d[d.length-1]:d[0]);};this.getNextTraverse=function(j,c,k){if(!k){k=1;}if(!j){j=this.selected;}var g=0;var d=this.getTraverseNodes(this.getTraverseParent(j)||this.xmlRoot);while(d[g]&&d[g]!=j){g++;}return d[g+(c?-1*k:k)];};this.getTraverseParent=function(d){if(!d.parentNode||d==this.xmlRoot){return false;}if(d.$regbase){return d.parentNode;}var c,g=d.getAttribute(apf.xmldb.xmlIdTag);if(!g){d.setAttribute(apf.xmldb.xmlIdTag,"temp");g="temp";}c=d.selectSingleNode("ancestor::node()[(("+this.each+")/@"+apf.xmldb.xmlIdTag+")='"+g+"']");if(g=="temp"){d.removeAttribute(apf.xmldb.xmlIdTag);}return c;};if(!this.$findHtmlNode){this.$findHtmlNode=function(c){return this.$pHtmlDoc.getElementById(c);};}this.$setClearMessage=function(k,g,j){if(!this.$empty){if(!this.$hasLayoutNode("empty")){return;}this.$getNewContext("empty");var d=this.$getLayoutNode("empty");if(!d){return;}this.$empty=apf.insertHtmlNode(d,this.$container);}else{this.$container.appendChild(this.$empty);}var i=this.$getLayoutNode("empty","caption",this.$empty);if(i){apf.setNodeValue(i,k||"");}this.$empty.setAttribute("id","empty"+this.$uniqueId);apf.setStyleClass(this.$empty,g,["loading","empty","offline"]);var c=apf.getStyle(this.$ext,"height");this.$empty.style.height=(j&&(!c||c=="auto")&&g!="empty")?(Math.max(10,(j-apf.getHeightDiff(this.$empty)-apf.getHeightDiff(this.$ext)))+"px"):"";};this.$updateClearMessage=function(g,c){if(!this.$empty||this.$empty.parentNode!=this.$container||this.$empty.className.indexOf(c)==-1){return;}var d=this.$getLayoutNode("empty","caption",this.$empty);if(d){apf.setNodeValue(d,g||"");}};this.$removeClearMessage=function(){if(!this.$empty){this.$empty=document.getElementById("empty"+this.$uniqueId);}if(this.$empty&&this.$empty.parentNode){this.$empty.parentNode.removeChild(this.$empty);}};this.$load=function(c){apf.xmldb.addNodeListener(c,this);var i=this.getTraverseNodes(c).length;if(!this.renderRoot&&!i){return this.clear(null,null,true);}var d=this.$addNodes(c,null,null,this.renderRoot);this.$fill(d);if(this.selectable){if(this.autoselect){if(!this.selected){if(this.renderRoot){this.select(c,null,null,null,true);}else{if(d.length){this.$selectDefault(c);}}}}else{this.clearSelection(true);var g=this.renderRoot?this.xmlRoot:this.getFirstTraverseNode();if(g){this.setCaret(g);}if(this.selected){this.setProperty("selected",null);}if(this.choosen){this.setProperty("choosen",null);}}}if(this.focussable){apf.document.activeElement==this?this.$focus():this.$blur();}if(i!=this.length){this.setProperty("length",i);}};var a={insert:127,add:123,remove:46,"redo-remove":79,synchronize:127,"move-away":105,move:77};this.$xmlUpdate=function(F,i,s,B,E){if(!this.xmlRoot){return;}var w,k,c,t,I=i;if(!s){s=this.xmlRoot;}if(F=="redo-remove"){E.appendChild(i);var H=this.isTraverseNode(i);E.removeChild(i);if(!H){i=E;}}do{if(F=="add"&&this.isTraverseNode(i)&&I==i){break;}if(i.getAttribute(apf.xmldb.xmlIdTag)){t=this.$findHtmlNode(i.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId);if(t&&(I!=i||i==this.xmlRoot)&&a[F]&1){F="update";}if(i==s&&!this.renderRoot){if(i==this.xmlRoot&&F!="insert"){this.dispatchEvent("xmlupdate",{action:F,xmlNode:i,UndoObj:B});return;}break;}if(t&&a[F]&2&&!this.isTraverseNode(i)){F="remove";}if(!t&&a[F]&4&&this.isTraverseNode(i)){F="add";break;}if(t||F=="move"){break;}}else{if(a[F]&8&&this.isTraverseNode(i)){F="add";break;}}if(i==s){break;}i=i.parentNode;}while(i&&i.nodeType!=9);var g=i;if(i&&i.nodeType==9){i=I;}if(F=="replacechild"&&(B?B.args[0]==this.xmlRoot:!this.xmlRoot.parentNode)){return this.load(B?B.args[1]:s);}if(B&&i&&!B.xmlNode){B.xmlNode=i;}if(F=="move"&&g==I){var A=apf.isChildOf(this.xmlRoot,i.parentNode,true);var q=apf.isChildOf(this.xmlRoot,B.extra.parent,true);if(A&&q){this.$moveNode(i,t);}else{if(A){F="add";}else{if(q){F="remove";}}}}else{if(F=="move-away"){var C=apf.isChildOf(this.xmlRoot,B.extra.parent,true);if(!C){F="remove";}}}if(this.$removeClearMessage&&this.$setClearMessage){if(this.getFirstTraverseNode()){this.$removeClearMessage();}else{this.$setClearMessage(this["empty-message"],"empty");}}if(F=="insert"&&(this.$isTreeArch||i==this.xmlRoot)){if(!i){return;}if(this.$hasLoadStatus(i)&&this.$removeLoading){this.$removeLoading(t);}if(this.$container.firstChild&&!apf.xmldb.getNode(this.$container.firstChild)){this.$container.innerHTML="";if(!this.renderRoot){k=this.getTraverseNodes().length;if(!k){this.clear();}}}w=this.$addNodes(i,(this.$getParentNode?this.$getParentNode(t):t),true,false);this.$fill(w);if(this.selectable&&!this.xmlRoot.selectSingleNode(this.each)){apf.console.warn("No traversable nodes were found for "+this.name+" ["+this.localName+"]\n                                  Traverse Rule : "+this.$getBindRule("each")[4].getAttribute("match"));}if(this.selectable&&(k===0||!this.xmlRoot.selectSingleNode(this.each))){return;}}else{if(F=="add"){var G;c=this.getTraverseParent(i);if(c==this.xmlRoot){G=this.$container;}if(!G&&this.$isTreeArch){G=this.$findHtmlNode(c.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId);}if(!G&&this.getCacheItem){G=this.getCacheItem(c.getAttribute(apf.xmldb.xmlIdTag)||(c.getAttribute(apf.xmldb.xmlDocTag)?"doc"+c.getAttribute(apf.xmldb.xmlDocTag):false));}if(G||this.$isTreeArch&&apf.isChildOf(this.xmlRoot,i)){G=(this.$findContainer&&G?this.$findContainer(G):G)||this.$container;w=this.$addNodes(i,G,true,true,apf.xmldb.getHtmlNode(this.getNextTraverse(i),this));if(G){this.$fill(w);}}}else{if(F=="remove"){if(!i||I!=i){return;}if(t){this.$deInitNode(i,t);}else{if(i==this.xmlRoot){return this.load({noClearMsg:!this.dataParent||!this.dataParent.autoselect});}}}else{if(t){this.$updateNode(i,t);if(F=="replacechild"&&this.hasFeature(apf.__MULTISELECT__)&&this.selected&&i.getAttribute(apf.xmldb.xmlIdTag)==this.selected.getAttribute(apf.xmldb.xmlIdTag)){this.selected=i;}}else{if(F=="redo-remove"){var d=this.xmlRoot;while(d&&d.nodeType!=9){d=d.parentNode;}if(!d){var j=this.getModel(true);if(!j){throw new Error(apf.formatErrorString(0,this,"Setting change notifier on component","Component without a model is listening for changes",this.$aml));}return j.$waitForXml(this);}}}}}}c=i?i.parentNode:E;if(this.$isTreeArch&&!this.$preventRecursiveUpdate&&c&&c.nodeType==1){do{t=this.$findHtmlNode(c.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId);if(t){this.$updateNode(c,t);}}while((c=this.getTraverseParent(c))&&c.nodeType==1);}if(a[F]&32&&this.selectable&&I==i&&(F!="insert"||i==this.xmlRoot)){clearTimeout(this.$selectTimer.timer);if(F=="remove"&&apf.isChildOf(i,this.selected,true)||i==this.$selectTimer.nextNode){this.$selectTimer.nextNode=this.getDefaultNext(i,this.$isTreeArch);}var n=this;this.$selectTimer.timer=$setTimeout(function(){n.$checkSelection(n.$selectTimer.nextNode);n.$selectTimer.nextNode=null;});}if(a[F]&64){if(!k){k=this.xmlRoot.selectNodes(this.each).length;}if(k!=this.length){this.setProperty("length",k);}}if(this.signalXmlUpdate&&a[F]&16){var u;for(u in this.signalXmlUpdate){if(parseInt(u)!=u){continue;}var D=apf.lookup(u);if(!this.selected){continue;}i=this.selected.selectSingleNode(D.dataParent.xpath);if(!i){continue;}D.load(i);}}this.dispatchEvent("xmlupdate",{action:F,xmlNode:i,result:w,UndoObj:B});};this.$addNodes=function(D,C,j,g,s,n){if(!this.each){throw new Error(apf.formatErrorString(1060,this,"adding Nodes for load","No each SmartBinding rule was specified. This rule is                  required for a "+this.localName+" component.",this.$aml));}var B,d;g=(g&&(this.renderRoot&&D==this.xmlRoot||this.isTraverseNode(D)));var c=g?[D]:this.getTraverseNodes(D);var A,u;if(this.caching&&(u=this.cache[(A=D.getAttribute(apf.xmldb.xmlIdTag))])){if(this.$subTreeCacheContext||this.$needsDepth){this.clearCacheItem(A);}else{this.$subTreeCacheContext={oHtml:u,container:C,parentNode:null,beforeNode:null};var B;while(u.childNodes.length){C.appendChild(B=u.childNodes[0]);}return c;}}for(var k=0;k<c.length;k++){if(c[k].nodeType!=1){continue;}if(j){B=this.$findHtmlNode(c[k].getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId);}if(!B){var t=apf.xmldb.nodeConnect(this.documentId,c[k],null,this);var w=g?s:(d?d.nextSibling:null),q=this.$add(c[k],t,g?D.parentNode:D,w?C||this.$container:C,w,(!w&&k==c.length-1),n);if(q===false){break;}}if(j){d=B;}}return c;};this.$handleBindingRule=function(d,g){if(!d){this[g]=null;}if(g=="each"){if(d.indexOf("::")>-1){d=d.replace(/^\[|\]$/g,"").split("::");this.setProperty("model",d[0]);this.each=d[1];}else{this.each=d.replace(/^\[|\]$/g,"");}}if(this.xmlRoot&&!this.$bindRuleTimer&&this.$amlLoaded){var c=this;apf.queue.add("reload"+this.$uniqueId,function(){apf.console.log("Reloading multiselect based on                                  attribute bind change: "+c.serialize(true));c.reload();});}};this.$select=function(c){if(this.renaming){this.stopRename(null,true);}if(!c||!c.style){return;}return this.$setStyleClass(c,"selected");};this.$deselect=function(c){if(this.renaming){this.stopRename(null,true);if(this.ctrlselect){return false;}}if(!c){return;}return this.$setStyleClass(c,"",["selected","indicate"]);};this.$indicate=function(c){if(this.renaming){this.stopRename(null,true);}if(!c){return;}return this.$setStyleClass(c,"indicate");};this.$deindicate=function(c){if(this.renaming){this.stopRename(null,true);}if(!c){return;}return this.$setStyleClass(c,"",["indicate"]);};this.$propHandlers.each=this.$propHandlers.caption=this.$propHandlers.eachvalue=this.$propHandlers.icon=this.$propHandlers.tooltip=this.$handleBindingRule;this.$propHandlers.sort=function(c){if(c){this.$sort=new apf.Sort();this.$sort.set({getValue:apf.lm.compile(c)});}else{this.$sort=null;}};}).call(apf.MultiselectBinding.prototype=new apf.DataBinding());apf.StandardBinding=function(){this.$init(true);if(!this.setQueryValue){this.implement(apf.DataBinding);}if(!this.defaultValue){this.defaultValue="";}this.$load=function(c){apf.xmldb.addNodeListener(c,this);var a,i,j,g,k,d;if(a=this.$bindings){for(j in a){i=j.toLowerCase();if(this.$supportedProperties.indexOf(i)>-1){k=(g=a[i]).length==1?g[0]:this.$getBindRule(i,c);d=k.value||k.match;this.$clearDynamicProperty(i);if(d.indexOf("{")>-1||d.indexOf("[")>-1){this.$setDynamicProperty(i,d);}else{if(this.setProperty){this.setProperty(i,d,true);}}}}}if(this.errBox&&this.isValid&&this.isValid()){this.clearError();}};this.$xmlUpdate=function(g,w,a,n){if(g=="redo-remove"){var c=false,i=this.getModel(true);if(i){var k=i.getXpathByAmlNode(this);if(k){w=i.data.selectSingleNode(k);if(w!=this.xmlRoot){c=true;}}}if(c||this.xmlRoot==w){if(!i){throw new Error(apf.formatErrorString(0,this,"Setting change notifier on component","Component without a model is listening for changes",this.$aml));}return i.$waitForXml(this);}}if(n&&!n.xmlNode){n.xmlNode=this.xmlRoot;}var s,d,q,t,j,u;if(s=this.$bindings){for(q in s){d=q.toLowerCase();if(this.$supportedProperties.indexOf(d)>-1){j=(t=s[d]).length==1?t[0]:this.$getBindRule(d,w);u=j.value||j.match;this.$clearDynamicProperty(d);if(u.indexOf("{")>-1||u.indexOf("[")>-1){this.$setDynamicProperty(d,u);}else{if(this.setProperty){this.setProperty(d,u);}}}}}if(this.errBox&&this.isValid&&this.isValid()){this.clearError();}this.dispatchEvent("xmlupdate",{action:g,xmlNode:w,UndoObj:n});};this.addEventListener("$clear",function(c,a){if(this.$propHandlers&&this.$propHandlers.value){this.value=-99999;this.$propHandlers.value.call(this,"");}});};apf.StandardBinding.prototype=new apf.DataBinding();apf.Init.run("standardbinding");apf.__MULTISELECT__=1<<8;apf.MultiSelect=function(){this.$init(function(){this.$valueList=[];this.$selectedList=[];});};(function(){this.$regbase=this.$regbase|apf.__MULTISELECT__;this.sellength=0;this.selected=null;this.$selected=null;this.caret=null;this.$caret=null;this.useindicator=true;this.remove=function(c){if(!c){c=this.$valueList;}if(c.nodeType){c=[c];}if(!c||!c.length){return;}if(c.contains(this.xmlRoot)){throw new Error(apf.formatErrorString(0,"Removing nodes","You are trying to delete the xml root of this                  element. This is not allowed."));}var g=[];for(var d=0;d<c.length;d++){g.push({action:"removeNode",args:[c[d]]});}if(this.$actions.removegroup){return this.$executeAction("multicall",g,"removegroup",c[0]);}else{return this.$executeAction("multicall",g,"remove",c[0],null,null,c.length>1?c:null);}};this.add=function(s,t,q,c){var n;if(this.$actions){if(s&&s.nodeType){n=this.$actions.getRule("add",s);}else{if(typeof s=="string"){if(s.trim().charAt(0)=="<"){s=apf.getXml(s);n=this.$actions.getRule("add",s);}else{var w=this.$actions.add;for(var j=0,g=w.length;j<g;j++){if(w[j].getAttribute("type")==s){s=null;n=w[j];break;}}}}}if(!n){n=(this.$actions.add||{})[0];}}else{n=null;}var k=this.$isTreeArch?this.selected||this.xmlRoot:this.xmlRoot,d=this,u=function(B,C,i){if(C!=apf.SUCCESS){var D;D=new Error(apf.formatErrorString(1032,d,"Loading xml data","Could not add data for control "+d.name+"["+d.tagName+"] \nUrl: "+i.url+"\nInfo: "+i.message+"\n\n"+s));if(i.tpModule.retryTimeout(i,C,d,D)===true){return true;}throw D;}if(typeof B!="object"){B=apf.getXmlDom(B).documentElement;}if(B.getAttribute(apf.xmldb.xmlIdTag)){B.setAttribute(apf.xmldb.xmlIdTag,"");}var A=d.$actions&&d.$actions.getRule("add",d.$isTreeArch?d.selected:d.xmlRoot);if(!t){if(A&&A.parent){t=(A.cparent||A.compile("parent",{xpathmode:2,injectself:true}))(d.$isTreeArch?d.selected||d.xmlRoot:d.xmlRoot);}else{t=d.$isTreeArch?d.selected||d.xmlRoot:d.xmlRoot;}}if(!t){t=d.xmlRoot;}if(apf.isWebkit&&t.ownerDocument!=B.ownerDocument){B=t.ownerDocument.importNode(B,true);}if(!t){throw new Error(apf.formatErrorString(0,d,"Executing add action","Missing parent node. You can only add nodes to a list if it                     has data loaded. Unable to perform action."));}if(d.$executeAction("appendChild",[t,B,q],"add",B)!==false&&d.autoselect){d.select(B);}if(c){c.call(d,B);}return B;};if(s){return u(s,apf.SUCCESS);}else{if(n.get){return apf.getData(n.get,{xmlNode:k,callback:u});}else{throw new Error(apf.formatErrorString(0,this,"Executing add action","Missing add action defined in action rules. Unable to                      perform action."));}}return addXmlNode;};if(!this.setValue){this.setValue=function(d,c){noEvent=c;this.setProperty("value",d,false,true);noEvent=false;};}this.findXmlNodeByValue=function(j){var d=this.getTraverseNodes(),c=this.$attrBindings.eachvalue&&"eachvalue"||this.$bindings.value&&"value"||this.$hasBindRule("caption")&&"caption";if(!c){return false;}for(var g=0;g<d.length;g++){if(this.$applyBindRule(c,d[g])==j){return d[g];}}};if(!this.getValue){this.getValue=function(d,c){return this.value;};}this.reselect=function(){if(this.selected){this.select(this.selected,null,this.ctrlselect,null,true);}};this.select=function(A,d,u,j,g,n,B){if(!this.selectable||B&&this.disabled||this.editable){return;}if(j==-1){j=false;B=true;}if(this.$skipSelect){this.$skipSelect=false;return;}if(this.ctrlselect&&!u){d=true;}if(!this.multiselect){d=u=false;}if(!this.xmlRoot){if(!this.$buffered){var q;this.addEventListener("afterload",q=function(){this.select.apply(this,this.$buffered);this.removeEventListener("afterload",q);delete this.$buffered;});}this.$buffered=Array.prototype.slice.call(arguments);return;}var w;if(!A){throw new Error(apf.formatErrorString(1075,this,"Making a selection","No selection was specified"));return false;}if(typeof A!="object"){var t=A;A=null;if(typeof A=="string"){A=apf.xmldb.getNodeById(t);}if(!A){A=this.findXmlNodeByValue(t);if(!A){this.clearSelection(n);return;}}}if(!A.style){w=this.$findHtmlNode(A.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId);}else{var c=(w=A).getAttribute(apf.xmldb.htmlIdTag);while(!c&&w.parentNode){c=(w=w.parentNode).getAttribute(apf.xmldb.htmlIdTag);}A=apf.xmldb.getNodeById(c);}if(!u&&!d&&!g&&!this.reselectable&&this.$valueList.length<=1&&this.$valueList.indexOf(A)>-1){return;}if(this.dispatchEvent("beforeselect",{selected:A,htmlNode:w,ctrlKey:d,shiftKey:u,force:g,captureOnly:n})===false){return false;}var i=this.caret;this.caret=A;if(u){var k=this.$calcSelectRange(this.$valueList[0]||i,A);if(this.$caret){this.$deindicate(this.$caret);}this.selectList(k);this.$selected=this.$caret=this.$indicate(w);}else{if(d){if(this.$valueList.contains(A)){if(this.selected==A){this.$deselect(this.$findHtmlNode(this.selected.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId));this.$deindicate(this.$caret);if(this.$valueList.length&&!j){this.selected=this.$valueList[0];}}else{this.$deselect(w,A);}if(!j){this.$selectedList.remove(w);this.$valueList.remove(A);}if(w!=this.$caret){this.$deindicate(this.$caret);}this.$selected=this.$caret=this.$indicate(w);}else{if(this.$caret){this.$deindicate(this.$caret);}this.$caret=this.$indicate(w,A);this.$selected=this.$select(w,A);this.selected=A;if(!j){this.$selectedList.push(w);this.$valueList.push(A);}}}else{if(j&&w&&this.$selectedList.contains(w)){return;}else{if(this.$selected){this.$deselect(this.$selected);}if(this.$caret){this.$deindicate(this.$caret);}if(this.selected){this.clearSelection(true);}this.$caret=this.$indicate(w,A);this.$selected=this.$select(w,A);this.selected=A;this.$selectedList.push(w);this.$valueList.push(A);}}}if(this.delayedselect&&(typeof d=="boolean")){var s=this;$setTimeout(function(){s.dispatchEvent("afterselect",{selection:s.$valueList,selected:A,caret:s.caret,captureOnly:n});},10);}else{this.dispatchEvent("afterselect",{selection:this.$valueList,selected:A,caret:this.caret,captureOnly:n});}return true;};this.choose=function(c,d){if(!this.selectable||d&&this.disabled){return;}if(this.dispatchEvent("beforechoose",{xmlNode:c})===false){return false;}if(c&&!c.style){this.select(c);}if(this.hasFeature(apf.__DATABINDING__)&&this.dispatchEvent("afterchoose",{xmlNode:this.selected})!==false){this.setProperty("chosen",this.selected);}};this.clearSelection=function(d,j){if(!this.selectable||j&&this.disabled||!this.$valueList.length){return;}if(!d){if(this.dispatchEvent("beforeselect",{selection:[],selected:null,caret:this.caret})===false){return false;}}var g;for(var c=this.$valueList.length-1;c>=0;c--){g=this.$findHtmlNode(this.$valueList[c].getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId);this.$deselect(g);}this.$selectedList.length=0;this.$valueList.length=0;this.$selected=this.selected=null;if(this.caret){g=this.$findHtmlNode(this.caret.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId);this.$caret=this.$indicate(g);}if(!d){this.dispatchEvent("afterselect",{selection:this.$valueList,selected:null,caret:this.caret});}};this.selectList=function(c,j,k,s){if(!this.selectable||s&&this.disabled){return;}if(this.dispatchEvent("beforeselect",{selection:c,selected:k||c[0],caret:this.caret,captureOnly:j})===false){return false;}this.clearSelection(true);for(var q,g=0;g<c.length;g++){if(!c[g]||c[g].nodeType!=1){continue;}var n,d=c[g];if(typeof d!="object"){d=apf.xmldb.getNodeById(d);}if(!d.style){n=this.$pHtmlDoc.getElementById(d.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId);}else{n=d;d=apf.xmldb.getNodeById(n.getAttribute(apf.xmldb.htmlIdTag));}if(!d){apf.console.warn("Component : "+this.name+" ["+this.localName+"]\nMessage : xmlNode whilst selecting a list of xmlNodes could not be found. Ignoring.");continue;}if(n){if(!q&&k==n){q=n;}this.$select(n,d);this.$selectedList.push(n);}this.$valueList.push(d);}this.$selected=q||this.$selectedList[0];this.selected=k||this.$valueList[0];this.dispatchEvent("afterselect",{selection:this.$valueList,selected:this.selected,caret:this.caret,captureOnly:j});};this.setCaret=function(c){if(!c){if(this.$caret){this.$deindicate(this.$caret);}this.caret=this.$caret=null;return;}var d;if(typeof c!="object"){c=apf.xmldb.getNodeById(c);}if(!c.style){d=this.$findHtmlNode(c.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId);}else{var g=(d=c).getAttribute(apf.xmldb.htmlIdTag);while(!g&&d.parentNode){g=(d=d.parentNode).getAttribute(apf.xmldb.htmlIdTag);}c=apf.xmldb.getNodeById(g);}if(this.$caret){this.$deindicate(this.$caret);}this.$caret=this.$indicate(d);this.setProperty("caret",this.caret=c);};this.$setTempSelected=function(g,i,d,k){clearTimeout(this.timer);if(this.$bindings.selectable){while(g&&!this.$getDataNode("selectable",g)){g=this.getNextTraverseSelected(g,!k);}if(!g){return;}}if(!this.multiselect){i=d=false;}if(i||this.ctrlselect){if(this.$tempsel){this.select(this.$tempsel);this.$tempsel=null;}this.setCaret(g);}else{if(d){if(this.$tempsel){this.$selectTemp();this.$deselect(this.$tempsel);this.$tempsel=null;}this.select(g,null,d);}else{if(!this.bufferselect||this.$valueList.length>1){this.select(g);}else{var j=apf.xmldb.getID(g,this);this.$deselect(this.$tempsel||this.$selected);this.$deindicate(this.$tempsel||this.$caret);this.$tempsel=this.$indicate(document.getElementById(j));this.$select(this.$tempsel);var c=this;this.timer=$setTimeout(function(){c.$selectTemp();},400);}}}};this.$selectTemp=function(){if(!this.$tempsel){return;}clearTimeout(this.timer);this.select(this.$tempsel);this.$tempsel=null;this.timer=null;};this.selectAll=function(d){if(!this.multiselect||!this.selectable||d&&this.disabled||!this.xmlRoot){return;}var c=this.$isTreeArch?this.xmlRoot.selectNodes(".//"+this.each.split("|").join("|.//")):this.xmlRoot.selectNodes(this.each);this.selectList(c);};this.getSelection=function(c){var d,g;if(c){g=this.xmlRoot?this.xmlRoot.ownerDocument.createDocumentFragment():apf.getXmlDom().createDocumentFragment();for(d=0;d<this.$valueList.length;d++){apf.xmldb.cleanNode(g.appendChild(this.$valueList[d].cloneNode(true)));}}else{for(g=[],d=0;d<this.$valueList.length;d++){g.push(this.$valueList[d]);}}return g;};this.$getSelection=function(c){return c?this.$selectedList:this.$valueList;};this.defaultSelectNext=function(d,c){var g=this.getNextTraverseSelected(d);if(g||!c){this.select(g?g:this.getTraverseParent(d));}else{this.clearSelection(true);}};this.selectNext=function(){var c=this.getNextTraverse();if(c){this.select(c);}};this.selectPrevious=function(){var c=this.getNextTraverse(null,-1);if(c){this.select(c);}};this.getDefaultNext=function(d,c){var g=this.getNextTraverseSelected(d);return(g&&g!=d)?g:(c?this.getTraverseParent(d):null);};this.isSelected=function(d){if(!d){return false;}for(var c=0;c<this.$valueList.length;c++){if(this.$valueList[c]==d){return this.$valueList.length;}}return false;};this.$checkSelection=function(d){if(this.$valueList.length>1){for(var c=[],j=0,g=this.$valueList.length;j<g;j++){if(apf.isChildOf(this.xmlRoot,this.$valueList[j])){c.push(this.$valueList[j]);}}if(c.length>1){this.selectList(c);if(this.caret&&!apf.isChildOf(this.xmlRoot,this.caret)){this.setCaret(d||this.selected);}return;}else{if(c.length){d=c[0];}}}if(!d){if(this.selected&&!apf.isChildOf(this.xmlRoot,this.selected)){d=this.getFirstTraverseNode();}else{if(this.selected&&this.caret&&!apf.isChildOf(this.xmlRoot,this.caret)){this.setCaret(this.selected);}else{if(!this.selected){d=this.xmlRoot?this.getFirstTraverseNode():null;}else{return;}}}}if(d){if(this.autoselect){this.select(d);}else{if(!this.multiselect){this.clearSelection();}this.setCaret(d);}}else{this.clearSelection();}};this.selectable=true;if(typeof this.ctrlselect=="undefined"){this.ctrlselect=false;}if(typeof this.multiselect=="undefined"){this.multiselect=true;}if(typeof this.autoselect=="undefined"){this.autoselect=true;}if(typeof this.delayedselect=="undefined"){this.delayedselect=true;}if(typeof this.allowdeselect=="undefined"){this.allowdeselect=true;}this.reselectable=false;this.$booleanProperties.selectable=true;this.$booleanProperties.multiselect=true;this.$booleanProperties.autoselect=true;this.$booleanProperties.delayedselect=true;this.$booleanProperties.allowdeselect=true;this.$booleanProperties.reselectable=true;this.$supportedProperties.push("selectable","ctrlselect","multiselect","autoselect","delayedselect","allowdeselect","reselectable","selection","selected","default","value","caret");this.$propHandlers.value=function(d){if(this.$lastValue==d){delete this.$lastValue;return;}if(!this.$attrBindings.eachvalue&&!this.$amlLoaded&&this.getAttribute("eachvalue")){var c=this;return apf.queue.add("value"+this.$uniqueId,function(){c.$propHandlers.value.call(c,d);});}var g=this.$getBindRule("value",this.xmlRoot);if(g){if(g.models[0]==this.$model){throw new Error(apf.formatErrorString(0,this,"Setting value attribute",'Value should not point to the same model where the items                     are loaded from. Please use value="[mdlName::xpath]" to                     specify the value. Use selected="[xpath]" to just select                     a node without making a databinding to it.'));}}if(d||d===0||this["default"]){this.select(String(d)||this["default"]);}else{this.clearSelection();}};this.$propHandlers["default"]=function(c,d){if(!this.value||!this.$amlLoaded&&!(this.getAttribute("value")||this.getAttribute("selected")||this.getAttribute("selection"))){this.$propHandlers.value.call(this,"");}};this.$propHandlers.caret=function(c,d){if(c){this.setCaret(c);}};this.$propHandlers.selection=this.$propHandlers.selected=function(C,s){if(!C){C=this[s]=null;}if(s=="selected"&&typeof C!="string"&&C==this.selected){this.selected=null;return;}if(s=="selection"&&(this.getAttribute("selection")||"*").substr(0,1)!="*"){apf.console.warn("Selection attribute ("+this.getAttributeNode("selection")+") should select multiple nodes. Please prefix xpath query with a * (ex.: *[item]).");}if(this.$isSelecting){this.selection=this.$valueList;return false;}var B,q,n,G,F,J,I;if(s=="selection"){if(typeof C=="object"&&C==this.$valueList){var g;if((J=this.$attrBindings[s])&&J.cvalue.models){this.$isSelecting=true;q=this.$attrBindings.eachvalue&&"eachvalue"||this.$bindings.value&&"value"||this.$hasBindRule("caption")&&"caption";if(!q){throw new Error("Missing bind rule set: eachvalue, value or caption");}var k=this.$getDataNode(s,this.xmlRoot);B=C;n=(I=this.$attrBindings["selection-unique"])&&I.cvalue;if(k.length){g=k[0].parentNode;}else{var w,A;if(J.cvalue.xpaths[0]=="#"||J.cvalue.xpaths[1]=="#"){var D=(J.cvalue3||(J.cvalue3=apf.lm.compile(J.value,{xpathmode:5})))(this.xmlRoot);w=D.model&&D.model.$isModel&&D.model;if(w){A=D.xpath;}else{if(D.model){w=apf.xmldb.findModel(D.model);A=apf.xmlToXpath(D.model,w.data)+(D.xpath?"/"+D.xpath:"");}else{}}}else{w=apf.nameserver.get("model",J.cvalue.xpaths[0]);A=J.cvalue.xpaths[1];}if(!w||!w.data){this.$isSelecting=false;return false;}g=w.queryNode(A.replace(/\/[^\/]+$|^[^\/]*$/,"")||".");if(!g){throw new Error("Missing parent node");}}remove_loop:for(G=0;G<k.length;G++){C=n?n(k[G]):this.$applyBindRule(q,k[G]);for(F=0;F<B.length;F++){if(this.$applyBindRule(q,B[F])==C){continue remove_loop;}}apf.xmldb.removeNode(k[G]);}add_loop:for(G=0;G<B.length;G++){C=this.$applyBindRule(q,B[G]);for(F=0;F<k.length;F++){if(n?n(k[F]):this.$applyBindRule(q,k[F])==C){continue add_loop;}}var E=this.$attrBindings["selection-constructor"]&&this.$getDataNode("selection-constructor",B[G])||apf.getCleanCopy(B[G]);apf.xmldb.appendChild(g,E);}this.$isSelecting=false;}return;}this.selection=this.$valueList;}else{this.selected=null;}if(!this.xmlRoot){if(!this.$buffered){var H;this.addEventListener("afterload",H=function(){this.removeEventListener("afterload",H);this.$propHandlers.selected.call(this,C,s);delete this.$buffered;});this.$buffered=true;}this[s]=null;return false;}if(!C||typeof C!="object"){if(this.$attrBindings[s]){B=this.$getDataNode(s,this.xmlRoot);if(B){this.setProperty("selection",B);}}else{if(!C){this.clearSelection();}else{this.select(C);}}return false;}else{if(typeof C.length=="number"){B=C;if(!B.length){this.selected=null;if(this.$valueList.length){this.clearSelection();return false;}else{return;}}if(this.isTraverseNode(B[0])&&apf.isChildOf(this.xmlRoot,B[0])){if(!this.multiselect){this.select(B[0]);}else{this.selectList(B);}return false;}if(this.$attrBindings[s]){q=this.$attrBindings.eachvalue&&"eachvalue"||this.$bindings.value&&"value"||this.$hasBindRule("caption")&&"caption";if(!q){throw new Error("Missing bind rule set: eachvalue, value or caption");}var u=!this.each?this.getTraverseNodes():this.xmlRoot.selectNodes("//"+this.each.split("|").join("|//"));n=(J=this.$attrBindings["selection-unique"])&&J.cvalue;var t=[];for(G=0;G<B.length;G++){C=n?n(B[G]):this.$applyBindRule(q,B[G]);for(F=0;F<u.length;F++){if(this.$applyBindRule(q,u[F])==C){t.push(u[F]);}}}this.selectList(t,true);return false;}throw new Error("Show me which case this is");}else{if(this.$valueList.indexOf(C)==-1){this.select(C);}}}};this.$propHandlers.allowdeselect=function(d){if(d){var c=this;this.$container.onmousedown=function(i){if(!i){i=event;}if(i.ctrlKey||i.shiftKey){return;}var g=i.srcElement||i.target;if(c.allowdeselect&&(g==this||g.getAttribute(apf.xmldb.htmlIdTag))){c.clearSelection();}};}else{this.$container.onmousedown=null;}};this.$propHandlers.ctrlselect=function(c){if(c!="enter"){this.ctrlselect=apf.isTrue(c);}};function a(){this.selectAll();}this.$propHandlers.autoselect=function(c){if(c=="all"&&this.multiselect){this.addEventListener("afterload",a);}else{this.removeEventListener("afterload",a);}};this.$propHandlers.multiselect=function(c){if(!c&&this.$valueList.length>1){this.select(this.selected);}};this.addEventListener("beforeselect",function(c){if(this.$bindings.selectable&&!this.$getDataNode("selectable",c.selected)){return false;}},true);this.addEventListener("afterselect",function(i){var g=null;this.setProperty("caret",i.caret);if(this.sellength!=i.selection.length){this.setProperty("sellength",i.selection.length);}delete this.selection;this.setProperty("selection",i.selection);if(!i.selection.length){this.setProperty("selected",i.selected);if(this.value){this.setProperty("value","");}}else{this.$chained=true;if(!i.force&&(!this.dataParent||!this.dataParent.parent.$chained)){var c=this;$setTimeout(function(){c.setProperty("selected",g||i.selected);delete c.$chained;},10);}else{this.setProperty("selected",g||i.selected);delete this.$chained;}var d=this.$attrBindings.eachvalue&&"eachvalue"||this.$bindings.value&&"value"||this.$hasBindRule("caption")&&"caption";if(d){this.$lastValue=this.$applyBindRule(d,i.selected);if(this.$lastValue!=(d!="value"&&(this.xmlRoot&&this.$applyBindRule("value",this.xmlRoot,null,true))||this.value)){if(d=="eachvalue"||this.xmlRoot!=this){this.change(this.$lastValue);}else{this.setProperty("value",this.$lastValue);}}delete this.$lastValue;}}},true);}).call(apf.MultiSelect.prototype=new apf.MultiselectBinding());apf.__CONTENTEDITABLE__=1<<23;apf.__CHILDVALUE__=1<<27;apf.ChildValue=function(){if(!this.$childProperty){this.$childProperty="value";}this.$regbase=this.$regbase|apf.__CHILDVALUE__;var a;this.addEventListener("DOMCharacterDataModified",a=function(g){if(g.currentTarget==this){return;}var i=typeof this[this.$childProperty]=="undefined";if(!i){return;}var c=this.serialize().match(/^[\s\S]*?>([\s\S]*)<[\s\S]*?$/),d=c&&c[1]||"";if(d.indexOf("{")>-1||d.indexOf("[")>-1){this.$setDynamicProperty(this.$childProperty,d);}else{this.setProperty(this.$childProperty,d);}});this.addEventListener("DOMAttrModified",a);this.addEventListener("DOMNodeInserted",a);this.addEventListener("DOMNodeRemoved",a);this.addEventListener("DOMNodeInsertedIntoDocument",function(g){var i=typeof this[this.$childProperty]=="undefined";if(i&&!this.getElementsByTagNameNS(this.namespaceURI,"*",true).length&&(this.childNodes.length>1||this.firstChild&&(this.firstChild.nodeType==1||this.firstChild.nodeType!=7&&this.firstChild.nodeValue.trim().length))){var c=(this.$aml&&this.$aml.xml||this.serialize()).match(/^[\s\S]*?>([\s\S]*)<[\s\S]*?$/),d=c&&c[1]||"";if(d.indexOf("{")>-1||d.indexOf("[")>-1){this.$setDynamicProperty(this.$childProperty,d);}else{this.setProperty(this.$childProperty,d);}}else{if(i){this.$propHandlers[this.$childProperty].call(this,"");}}});};apf.__DATAACTION__=1<<25;apf.DataAction=function(){this.$regbase=this.$regbase|apf.__DATAACTION__;this.getActionTracker=function(g){if(!apf.AmlNode){return apf.window.$at;}var c=this,d=g?null:this.$at;if(!d&&this.dataParent){d=this.dataParent.parent.$at;}while(!d){if(!c.parentNode){var a;return(a=this.getModel&&this.getModel(true))&&a.$at||apf.window.$at;}d=(c=c.parentNode).$at;}return d;};this.$actionsLog={};this.$actions=false;this.$startAction=function(c,g,i){if(this.disabled||this.contenteditable&&c!="edit"){return false;}var d=this.$actions&&this.$actions.getRule(c,g);if(!d&&apf.config.autoDisableActions&&this.$actions){if(!g){apf.console.warn("Tried starting new action but no xml                     context was specified.");}else{apf.console.warn("Tried starting new action but no '"+c+"' action rule was found.");}return false;}var a=typeof apf.offline!="undefined";if(this.dispatchEvent(c+"start",{xmlContext:g})===false){return false;}this.$actionsLog[c]=g;return true;};this.$stopAction=function(c,d,a){delete this.$actionsLog[c];};this.$executeAction=function(u,i,c,t,j,d,w){if(this.disabled||this.contenteditable&&c!="edit"){return;}apf.console.info("Executing action '"+c+"' for "+(this.name||"")+" ["+(this.localName||"")+"]");var q=this.$actions&&this.$actions.getRule(c,t);if(!q&&this.$actions&&apf.config.autoDisableActions&&"action|change".indexOf(c)==-1){apf.console.warn("Could not execute action '"+c+"'.               No valid action rule was found and auto-disable-actions is enabled");return false;}var s;if(w){s=[];for(var a=w.length-1;a>=0;a--){s.unshift({xmlActionNode:q&&q[4],amlNode:this,selNode:w[a],xmlNode:w[a]});}}var n=new apf.AmlEvent("before"+c.toLowerCase(),{action:u,args:i,xmlActionNode:q,amlNode:this,selNode:d,multiple:s||false});if(!j){if(this.dispatchEvent(n.name,null,n)===false){return false;}delete n.currentTarget;}var g=this.getActionTracker().execute(n);n.xmlNode=g.xmlNode;n.undoObj=g;if(!j){n.name="after"+c.toLowerCase();n.cancelBubble=false;delete n.returnValue;delete n.currentTarget;this.dispatchEvent(n.name,null,n);}return g;};this.$executeSingleValue=function(a,q,A,w,k){var n,s,u=this.$getBindRule(q,A);if(!u){if(this.$getBindRule(q)){throw new Error("There is no rule that matches the xml node for this operation.                                 Please make sure you are matching a node and using the value to                                  specify it's value <a:"+q+" match='person'                                  value='[@name]' /> : "+A.xml);}else{return false;}}var t=u.value?u.cvalue:u.cmatch;if(!t){if(u.value){t=u.compile("value");}else{return false;}}if(t.type!=3){throw new Error("Cannot create from rule that isn't a single xpath");}var B,c=t.xpaths,i=false;if(c[0]=="#"||c[1]=="#"){var g=(u.cvalue3||(u.cvalue3=apf.lm.compile(u.value,{xpathmode:5})))(A);var j=g.model&&g.model.$isModel&&g.model;if(j){var d=j.queryNode(g.xpath);A=j.data;}else{j=apf.xmldb.findModel(g.model);var d=g.model.selectSingleNode(g.xpath);A=g.model;}c[1]=g.xpath;}else{var j=c[0]&&apf.nameserver.get("model",c[0])||this.$model,d=j?j.queryNode(c[1]):(A||this.xmlRoot).selectSingleNode(c[1]);}if(d){if(apf.queryValue(d)==w){return;}B=(d.nodeType==1||d.nodeType==3||d.nodeType==4)?"setTextNode":"setAttribute";s=(d.nodeType==1)?[d,w]:(d.nodeType==3||d.nodeType==4?[d.parentNode,w]:[d.ownerElement||d.selectSingleNode(".."),d.nodeName,w]);}else{if(!this.$createModel){return false;}B="setValueByXpath";n=c[1];if(!A){if(!j){j=this.getModel();}if(j){if(!j.data){j.load("<data />");}n=(j.getXpathByAmlNode(this)||".")+(n&&n!="."?"/"+n:"");A=j.data;}else{if(!this.dataParent){return false;}A=this.dataParent.parent.selected||this.dataParent.parent.xmlRoot;if(!A){return false;}n=(this.dataParent.xpath||".")+(n&&n!="."?"/"+n:"");i=true;}}s=[A,w,n];}if(k){return{func:B,args:s};}this.$executeAction(B,s,a,A);if(i){this.load(A.selectSingleNode(n));}};this.change=function(d,c){if(!this.xmlRoot&&!this.$createModel||!(this.$mainBind=="value"&&this.hasFeature(apf.__MULTISELECT__)?this.$attrBindings.value:this.$hasBindRule(this.$mainBind))){if(!c&&d===this.value||this.dispatchEvent("beforechange",{value:d})===false){return false;}this.setProperty("value",d);return this.dispatchEvent("afterchange",{value:d});}var a=this.$attrBindings.eachvalue&&"eachvalue"||this.$bindings.value&&"value"||this.$hasBindRule("caption")&&"caption";if(d==(a!="value"&&(this.xmlRoot&&this.$applyBindRule("value",this.xmlRoot,null,true))||this.value)){return false;}this.$executeSingleValue("change",this.$mainBind,this.xmlRoot,d);};this.$booleanProperties["render-root"]=true;this.$supportedProperties.push("create-model","actions");this.$propHandlers["create-model"]=function(a){this.$createModel=a;};this.addEventListener("DOMNodeInsertedIntoDocument",function(a){if(typeof this["create-model"]=="undefined"&&!this.$setInheritedAttribute("create-model")){this.$createModel=true;}});};apf.config.$inheritProperties["create-model"]=1;apf.__CACHE__=1<<2;apf.Cache=function(){this.cache={};this.$subTreeCacheContext=null;this.caching=true;this.$regbase=this.$regbase|apf.__CACHE__;this.addEventListener("$load",function(i){if(!this.caching||i.forceNoCache){return;}if(!this.cacheId){this.cacheId=i.xmlNode.getAttribute(apf.xmldb.xmlIdTag)||apf.xmldb.nodeConnect(apf.xmldb.getXmlDocId(i.xmlNode),i.xmlNode);}var g=c.call(this,this.cacheId,i.xmlNode);if(g){if(g==-1){return false;}var d=this.getTraverseNodes();if(d.length&&this.autoselect){this.select(d[0],null,null,null,true);}else{this.clearSelection();}if(!d.length){this.$removeClearMessage();this.$setClearMessage(this["empty-message"],"empty");}if(d.length!=this.length){this.setProperty("length",d.length);}return false;}});this.addEventListener("$clear",function(){if(!this.caching){return;}if(this.hasFeature(apf.__MULTISELECT__)&&this.$subTreeCacheContext&&this.$subTreeCacheContext.oHtml){if(this.renderRoot){this.$subTreeCacheContext.parentNode.insertBefore(this.$subTreeCacheContext.oHtml,this.$subTreeCacheContext.beforeNode);}else{var d=this.$subTreeCacheContext.container||this.$container;while(d.childNodes.length){this.$subTreeCacheContext.oHtml.appendChild(d.childNodes[0]);}}this.documentId=this.xmlRoot=this.cacheId=this.$subTreeCacheContext=null;}else{if(this.$loadedWhenOffline){this.$loadedWhenOffline=false;}else{var g=this.$getCurrentFragment();if(!g){return;}g.documentId=this.documentId;g.xmlRoot=this.xmlRoot;if(this.cacheId||this.xmlRoot){a.call(this,this.cacheId||this.xmlRoot.getAttribute(apf.xmldb.xmlIdTag)||"doc"+this.xmlRoot.getAttribute(apf.xmldb.xmlDocTag),g);}}}});function c(s,j){if(j&&this.hasFeature(apf.__MULTISELECT__)&&this.$isTreeArch){var d,g=j.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId,k=this.$pHtmlDoc.getElementById(g);if(k){d=s?false:this.$container;}else{for(var q in this.cache){if(this.cache[q]&&this.cache[q].nodeType){k=this.cache[q].getElementById(g);if(k){d=s?q:this.cache[q];break;}}}}if(d&&!this.cache[s]){var n=this.$findHtmlNode(j.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId);this.$subTreeCacheContext={oHtml:n,parentNode:n.parentNode,beforeNode:n.nextSibling,cacheItem:d};this.documentId=apf.xmldb.getXmlDocId(j);this.cacheId=s;this.xmlRoot=j;if(this.renderRoot){this.$container.appendChild(n);}else{while(n.childNodes.length){this.$container.appendChild(n.childNodes[0]);}}return true;}}if(!this.cache[s]){return false;}var i=this.cache[s];this.documentId=i.documentId;this.cacheId=s;this.xmlRoot=i.xmlRoot;this.clearCacheItem(s);this.$setCurrentFragment(i);return true;}function a(g,d){if(!this.caching){return;}this.cache[g]=d;}this.$findHtmlNode=function(i){var d=this.$pHtmlDoc.getElementById(i);if(d){return d;}for(var g in this.cache){if(this.cache[g]&&this.cache[g].nodeType){d=this.cache[g].getElementById(i);if(d){return d;}}}return null;};this.clearCacheItem=function(g,d){this.cache[g].documentId=this.cache[g].cacheId=this.cache[g].xmlRoot=null;if(d){apf.destroyHtmlNode(this.cache[g]);}this.cache[g]=null;};this.clearAllCache=function(){for(var d in this.cache){if(this.cache[d]){this.clearCacheItem(d,true);}}};this.getCacheItem=function(d){return this.cache[d];};this.$isCached=function(d){return this.cache[d]||this.cacheId==d?true:false;};if(!this.$getCurrentFragment){this.$getCurrentFragment=function(){var d=this.$container.ownerDocument.createDocumentFragment();while(this.$container.childNodes.length){d.appendChild(this.$container.childNodes[0]);}return d;};this.$setCurrentFragment=function(d){this.$container.appendChild(d);if(!apf.window.hasFocus(this)){this.blur();}};}this.$booleanProperties.caching=true;this.$supportedProperties.push("caching");this.addEventListener("DOMNodeRemovedFromDocument",function(d){this.clearAllCache();});};apf.GuiElement.propHandlers.caching=function(a){if(!apf.isTrue(a)){return;}if(!this.hasFeature(apf.__CACHE__)){this.implement(apf.Cache);}};apf.__RENAME__=1<<10;apf.Rename=function(){this.$regbase=this.$regbase|apf.__RENAME__;this.canrename=true;this.$renameSubject=this.renameTimer=this.lastCursor=null;this.$booleanProperties.canrename=true;this.$booleanProperties.autorename=true;this.$supportedProperties.push("canrename","autorename");this.rename=function(a,c){if(!a){a=this.caret||this.selected;}if(!a){return;}this.$executeSingleValue("rename","caption",a,c);};this.startDelayedRename=function(c,a,d){if(c&&(c.button==2||c.ctrlKey||c.shiftKey)||d&&this.disabled){return;}clearTimeout(this.renameTimer);this.renameTimer=$setTimeout("apf.lookup("+this.$uniqueId+").startRename()",a||400);};this.startRename=function(g,a,k){if(!g&&(this.renaming||!this.canrename||!this.$startAction("rename",this.caret||this.selected,this.stopRename))||k&&this.disabled){return false;}if(!this.hasFocus()){this.focus(null,null,true);}clearTimeout(this.renameTimer);var n=this.$getCaptionElement?this.$getCaptionElement():this.$caret||this.$selected;if(!n){return this.stopRename();}this.renaming=true;this.$renameSubject=this.caret||this.selected;var c=n.offsetWidth;this.lastCursor=n.style.cursor;n.style.cursor="text";n.parentNode.replaceChild(this.$txt,n);n.host=this;if(apf.isTrue(this.$getOption("main","scalerename"))){var j=apf.getWidthDiff(this.$txt);this.$txt.style.width=(c-j-3)+"px";}this.$replacedNode=n;var d=this.$getCaptionXml?this.$getCaptionXml(this.$renameSubject):this.$getDataNode("caption",this.$renameSubject);value=a||!d?"":(d.nodeType!=1?unescape(d.nodeValue):(apf.isOnlyChild(d.firstChild,[3,4])?apf.queryValue(d):this.$applyBindRule("caption",this.$renameSubject)))||"";if(apf.hasContentEditable){if(this.$multiLineRename){this.$txt.innerHTML=apf.htmlCleaner.prepare(value.trim().replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br />"));}else{this.$txt.innerHTML=value.replace(/</g,"&lt;");}}else{this.$txt.value=value;}this.$txt.unselectable="Off";this.$txt.host=this;try{this.$txt.focus();this.$txt.select();}catch(i){}};this.stopRename=function(a,d){clearTimeout(this.renameTimer);if(!this.renaming||a&&a!=this.$renameSubject||!this.$replacedNode){return false;}if(this.$txt.parentNode&&this.$txt.parentNode.nodeType==1){if(apf.isIE8||apf.isIE7Emulate){this.$txt.blur();}this.$txt.parentNode.replaceChild(this.$replacedNode,this.$txt);}this.renaming=false;if(this.$replacedNode){this.$replacedNode.style.cursor=this.lastCursor||"";this.$replacedNode.host=null;}if(this.$multiLineRename){var c=apf.html_entity_decode(apf.htmlCleaner.parse(this.$txt.innerHTML,true).replace(/<br \/>/g,"").replace(/<\/?p>/g,""));}else{var c=this.$txt[apf.hasContentEditable?"innerText":"value"].replace(/<.*?nobr>/gi,"");}if(!d||(this.$validateRename&&!this.$validateRename(c))){this.dispatchEvent("stoprename");this.$stopAction("rename");}else{if(this.$replacedNode){this.$replacedNode.innerHTML=c.replace(/</g,"&lt;").replace(/\r?\n/g,"<br />");}this.rename(this.$renameSubject,c);}if(!this.renaming){this.$renameSubject=null;this.$replacedNode=null;this.$txt.style.width="";}return true;};this.addEventListener("keydown",function(c){var a=c.keyCode;if(this.renaming){if(a==27||this.$multiLineRename&&c.ctrlKey&&a==13||!this.$multiLineRename&&a==13){this.stopRename(null,a==13&&!this.$autocomplete);c.cancelBubble=true;return false;}return;}if(a==113){if(this.$tempsel){this.$selectTemp();}if(this.caret!=this.selected){if(this.multiselect||this.isSelected(this.caret)){this.selected=this.caret;this.$selected=this.$caret;}else{this.select(this.caret,true);}}this.startRename();return false;}},true);this.addEventListener("DOMNodeRemovedFromDocument",function(a){this.$txt.refCount--;if(!this.$txt.refCount){this.$txt.host=this.$txt.onmouseover=this.$txt.onmousedown=this.$txt.select=this.$txt.onfocus=this.$txt.onblur=null;}this.$txt=null;});this.$init(apf.Rename.initEditableArea);};apf.Rename.initEditableArea=function(){if(!(this.$txt=document.getElementById("txt_rename"))){if(apf.hasContentEditable){this.$txt=document.createElement("DIV");this.$txt.contentEditable=true;if(apf.isIE6){this.$txt.style.width="1px";}}else{this.$txt=document.createElement("input");this.$txt.id="txt_rename";this.$txt.autocomplete=false;}if(apf.hasFocusBug){apf.sanitizeTextbox(this.$txt);}this.$txt.refCount=0;this.$txt.id="txt_rename";apf.importCssString("#txt_rename{white-space:nowrap}");this.$txt.onselectstart=function(a){(a||event).cancelBubble=true;};apf.sanitizeTextbox(this.$txt);this.$txt.onmouseover=this.$txt.onmouseout=this.$txt.oncontextmenu=this.$txt.onmousedown=function(a){(a||event).cancelBubble=true;};this.$txt.onkeyup=function(a){if(!this.host.$autocomplete){return;}this.host.$lookup(this[apf.hasContentEditable?"innerHTML":"value"]);};this.$txt.select=function(){if(!apf.hasMsRangeObject){return this.focus();}var a=document.selection.createRange();try{a.moveToElementText(this);if(apf.isFalse(this.host.$getOption("main","selectrename"))||typeof this.host.$renameStartCollapse!="undefined"){a.collapse(this.host.$renameStartCollapse);}}catch(c){}a.select();};if(apf.hasFocusBug){this.$txt.onfocus=function(){if(apf.window){apf.window.$focusfix2();}};}this.$txt.onblur=function(){if(apf.isGecko){return;}if(apf.hasFocusBug){apf.window.$blurfix();}if(this.host.$autocomplete){return;}this.host.stopRename(null,true);};}this.$txt.refCount++;};apf.__DOCKING__=1<<18;apf.BaseButton=function(){this.$init(true);};(function(){this.implement(apf.ChildValue);this.refKeyDown=this.refMouseDown=0;this.mouseOver=this.mouseLeft=false;this.$propHandlers.background=function(c){var d=this.$getLayoutNode("main","background",this.$ext);if(!d){return apf.console.warn("No background defined in the Button skin","button");}if(c){var a=c.split("|");this.$background=a.concat(["vertical",2,16].slice(a.length-1));d.style.backgroundImage="url("+this.mediaPath+a[0]+")";d.style.backgroundRepeat="no-repeat";}else{d.style.backgroundImage="";d.style.backgroundRepeat="";this.$background=null;}};this.addEventListener("keydown",function(c){var a=c.keyCode;switch(a){case 13:if(this.localName!="checkbox"){this.$ext.onmouseup(c.htmlEvent,true);}break;case 32:if(!c.htmlEvent.repeat){this.refKeyDown++;this.$updateState(c.htmlEvent);}return false;}},true);this.addEventListener("keyup",function(c){var a=c.keyCode;switch(a){case 32:this.refKeyDown--;if(this.refKeyDown<0){this.refKeyDown=0;return false;}if(this.refKeyDown+this.refMouseDown==0&&!this.disabled){this.$ext.onmouseup(c,true);}this.$updateState(c);return false;}},true);this.states={Out:1,Over:2,Down:3};this.$updateState=function(c,a){if(c.reset){this.refKeyDown=0;this.refMouseDown=0;this.mouseOver=false;return false;}if(this.refKeyDown>0||(this.refMouseDown>0&&this.mouseOver)||(this.isBoolean&&this.value)){this.$setState("Down",c,a);}else{if(this.mouseOver){this.$setState("Over",c,a);}else{this.$setState("Out",c,a);}}};this.$setupEvents=function(){if(this.editable){return;}var a=this;this.$ext.onmousedown=function(c){c=c||window.event;if(a.disabled||a.$notfromext&&(c.srcElement||c.target)==this){return;}a.refMouseDown=1;a.mouseLeft=false;a.$updateState(c,"mousedown");};this.$ext.onmouseup=function(d,c){d=d||window.event;if(a.disabled||!c&&(!a.mouseOver||!a.refMouseDown)){return;}a.refMouseDown=0;a.$updateState(d,"mouseup");if(a.disabled||(d&&d.type=="click"&&a.mouseLeft==true)){return false;}if(a.refMouseDown+a.refKeyDown){return false;}if(a.$clickHandler&&a.$clickHandler()){a.$updateState(d||event,"click");}else{a.dispatchEvent("click",{htmlEvent:d});}return false;};this.$ext.onmousemove=function(c){if(!a.mouseOver&&!a.disabled){c=c||window.event;if(a.$notfromext&&(c.srcElement||c.target)==this){return;}a.mouseOver=true;a.$updateState(c,"mouseover");}};this.$ext.onmouseout=function(d){d=d||window.event;var c=d.explicitOriginalTarget||d.toElement;if(a.disabled||this==c||apf.isChildOf(this,c)){return;}a.mouseOver=false;a.refMouseDown=0;a.mouseLeft=true;a.$updateState(d,"mouseout");};if(apf.isIphone){apf.iphone.linkEvents(this.$ext,true);}if(apf.hasClickFastBug){this.$ext.ondblclick=this.$ext.onmouseup;}};this.$doBgSwitch=function(c){if(this.background&&(this.$background[2]>=c||c==4)){if(c==4){c=this.$background[2]+1;}var a=this.$background[1]=="vertical"?"0 -"+(parseInt(this.$background[3])*(c-1))+"px":"-"+(parseInt(this.$background[3])*(c-1))+"px 0";this.$getLayoutNode("main","background",this.$ext).style.backgroundPosition=a;}};this.$focus=function(){if(!this.$ext){return;}this.$setStyleClass(this.$ext,this.$baseCSSname+"Focus");};this.$blur=function(a){if(!this.$ext){return;}this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Focus"]);if(a){this.$updateState({});}};this.$destroy=function(a){if(!a&&this.$ext){this.$ext.onmousedown=this.$ext.onmouseup=this.$ext.onmouseover=this.$ext.onmouseout=this.$ext.onclick=this.$ext.ondblclick=null;}};}).call(apf.BaseButton.prototype=new apf.StandardBinding());apf.BaseTab=function(){this.$init(true);};(function(){this.isPaged=true;this.$focussable=apf.KEYBOARD;this.length=0;this.isLoading={};this.inited=this.ready=false;this.set=function(c,d,a){if(a||this.src&&!this.$findPage(c,{})){return this.$propHandlers.activepage.call(this,c,null,null,d,a);}if(d&&this.activepage==c){return d();}this.$lastCallback=d;this.setProperty("activepage",c);};this.$supportedProperties.push("activepage","activepagenr","length","src","loading");this.$propHandlers.activepagenr=this.$propHandlers.activepage=function(g,a,c,q,i){if(!this.inited||apf.isNot(g)){return;}if(!q){q=this.$lastCallback;delete this.$lastCallback;}var j,d={};j=this.$findPage(g,d);if(!j){if(this.src){if(this.isLoading[g]){return;}if(this.$findPage("loading",{})){this.$propHandlers.activepage.call(this,"loading");}this.setProperty("loading",true);this.isLoading[g]=true;j=this.ownerDocument.createElementNS(apf.ns.apf,"page");j.setAttribute("id",g);this.appendChild(j);var k=this;j.insertMarkup(this.src,{page:g,callback:function(s){if(!s.xmlNode){var t=new Error(apf.formatErrorString(0,null,"Loading new page","Could not load new page: "+k.src));k.setProperty("loading",false);if(this.dispatchEvent("error",apf.extend({error:t,bubbles:true},s))===false){return true;}throw t;}else{k.setProperty("activepage",g);if(q){q();}k.setProperty("loading",false);}}});return;}apf.console.warn("Setting tab page which doesn't exist,                               referenced by name: '"+g+"'");return false;}if(j.parentNode!=this){apf.console.warn("Setting active page on page component which                               isn't a child of this tab component. Cancelling.");return false;}if(!j.visible||j.disabled){apf.console.warn("Setting active page on page component which                               is not visible or disabled. Cancelling.");return false;}if(g.tagName){g=d.position;this.activepage=j.name||g;}if(!i){var n={previous:this.activepage,previousId:this.activepagenr,previousPage:this.$activepage,next:g,nextId:d.position,nextpage:j};if(this.dispatchEvent("beforeswitch",n)===false){if(this.hideLoader){this.hideLoader();}return false;}}this.activepagenr=d.position;this.setProperty("activepagenr",d.position);if(this.$activepage){this.$activepage.$deactivate();}j.$activate();this.$activepage=j;if(this.hideLoader){if(j.$rendered!==false){this.hideLoader();}else{j.addEventListener("afterrender",function(){this.parentNode.hideLoader();});}}if(!i){if(j.$rendered!==false){this.dispatchEvent("afterswitch",n);}else{j.addEventListener("afterrender",function(){this.parentNode.dispatchEvent("afterswitch",n);});}}if(typeof q=="function"){q();}return true;};this.getPages=function(){var g=[],c=this.childNodes;for(var d=0,a=c.length;d<a;d++){if("page|case".indexOf(c[d].localName)>-1){g.push(c[d]);}}return g;};this.getPage=function(a){if(apf.isNot(a)){return this.$activepage;}else{return this.$findPage(a);}};this.add=function(a,c,d){var g=apf.document.createElement(d||"page");if(c){g.setAttribute("id",c);}if(a){g.setAttribute("caption",a);}this.appendChild(g);return g;};this.remove=function(a){var c=this.$findPage(a);if(!c){return false;}c.removeNode();return c;};this.addEventListener("DOMNodeRemoved",function(c){var a=c.currentTarget;if(c.$doOnlyAdmin||c.relatedNode!=this||a.localName!="page"){return;}if(this.firstChild==a&&a.nextSibling){a.nextSibling.$first();}if(this.lastChild==a&&a.previousSibling){a.previousSibling.$last();}if(this.$activepage==a){if(a.nextSibling||a.previousSibling){this.set(a.nextSibling||a.previousSibling);}else{this.$activepage=this.activepage=this.activepagenr=null;}}this.setProperty("length",this.childNodes.length);});this.addEventListener("DOMNodeInserted",function(g){var a=g.currentTarget;if(a.localName!="page"||g.relatedNode!=this||a.nodeType!=1){return;}if(!g.$beforeNode){var c;if(c=this.lastChild){if(c.nodeType!=1){c=c.previousSibling;}if(c){c.$last(true);}}a.$last();}if(!this.firstChild||g.$beforeNode==this.firstChild){if(this.firstChild){this.firstChild.$first(true);}a.$first();}if(this.$activepage){var d={};this.$findPage(this.$activepage,d);if(this.activepagenr!=d.position){if(parseInt(this.activepage)==this.activepage){this.activepage=d.position;this.setProperty("activepage",d.position);}this.activepagenr=d.position;this.setProperty("activepagenr",d.position);}}else{if(!this.$activepage){this.set(a);}}this.setProperty("length",this.childNodes.length);});this.$findPage=function(k,n){var j,c=this.childNodes;for(var g=0,d=0,a=c.length;d<a;d++){j=c[d];if("page|case".indexOf(j.localName)>-1&&(g++==k||(k.localName&&j||j.name)==k)){if(n){n.position=g-1;}return j;}}return null;};this.$enable=function(){var c=this.childNodes;for(var d=0,a=c.length;d<a;d++){if(c[d].enable){c[d].enable();}}};this.$disable=function(){var c=this.childNodes;for(var d=0,a=c.length;d<a;d++){if(c[d].disable){c[d].disable();}}};this.addEventListener("keydown",function(d){if(!this.$hasButtons){return;}var c,a=d.keyCode;switch(a){case 9:break;case 13:break;case 32:break;case 37:c=this.getPage().previousSibling;while(c&&(c.nodeType!=1||"page|case".indexOf(c.localName)==-1||!c.visible)){c=c.previousSibling;}if(c){this.setProperty("activepage",c);}break;case 39:c=this.getPage().nextSibling;while(c&&(c.nodeType!=1||"page|case".indexOf(c.localName)==-1||!c.visible)){c=c.nextSibling;}if(c){this.setProperty("activepage",c);}break;default:return;}},true);this.$loadChildren=function(s){var q=false,a=this,k,g,c,n,d;this.inited=true;if(this.$hasButtons){this.$buttons=this.$getLayoutNode("main","buttons",this.$ext);this.$buttons.setAttribute("id",this.$uniqueId+"_buttons");}this.oPages=this.$getLayoutNode("main","pages",this.$ext);if(this.$int){this.$int=this.oPages;q=true;d=this.childNodes;for(k=0;k<d.length;k++){n=d[k];if(n.nodeType!=1){continue;}n.$draw(true);if(n.$skinchange){n.$skinchange();}n.$loadAml();}}else{this.$int=this.oPages;d=this.childNodes;for(g=0,k=0,c=d.length;k<c;k++){if("page|case".indexOf((n=d[k]).localName)>-1){if(g++==0){n.$first();}if(g==c){n.$last();}}}}if(n){this.activepage=(typeof this.activepage!="undefined"?this.activepage:this.activepagenr)||0;q=this.getPage(this.activepage);if(q.render!="runtime"||q.$rendered){this.$propHandlers.activepage.call(this,this.activepage);}}else{this.isPages=false;}this.setProperty("length",g);this.ready=true;if(!this.activepage&&this.getAttribute("src")){this.src=this.getAttribute("src");this.$propHandlers.activepage.call(this);}};this.$destroy=function(a){if(a||!this.oScroller){return;}};}).call(apf.BaseTab.prototype=new apf.Presentation());apf.__XFORMS__=1<<17;apf.__FOCUSSABLE__=1<<26;apf.Focussable=function(){this.$regbase=this.$regbase|apf.__FOCUSSABLE__;this.setTabIndex=function(a){apf.window.$removeFocus(this);apf.window.$addFocus(this,a);return this;};this.focus=function(a,d,c){if(!a){if(this.$isWindowContainer>-1){apf.window.$focusLast(this,d,true);}else{apf.window.$focus(this,d);if(!c&&apf.hasFocusBug){apf.window.$focusfix();}}return this;}if(this.$focus&&!this.editable){this.$focus(d);}this.dispatchEvent("focus",apf.extend({bubbles:true},d));return this;};this.blur=function(a,c){if(apf.popup.isShowing(this.$uniqueId)){apf.popup.forceHide();}if(this.$blur){this.$blur(c);}if(!a){apf.window.$blur(this);}this.dispatchEvent("blur",apf.extend({bubbles:!c||!c.cancelBubble},c));return this;};this.hasFocus=function(){return apf.document.activeElement==this||this.$isWindowContainer&&(apf.document.activeElement||{}).$focusParent==this;};};apf.__MEDIA__=1<<20;apf.BaseSimple=function(){this.$init(true);};(function(){this.implement(apf.DataAction);this.getValue=function(){return this.value;};}).call(apf.BaseSimple.prototype=new apf.StandardBinding());apf.__ALIGNMENT__=1<<29;apf.BaseTree=function(){this.$init(true);this.$dynCssClasses=[];this.$nodes=[];};(function(){this.implement(apf.Rename,apf.DataAction,apf.Cache);this.$isTreeArch=true;this.$focussable=true;this.multiselect=false;this.bufferselect=true;this.startcollapsed=true;this.$animType=apf.tween.NORMAL;this.$animOpenStep=3;this.$animCloseStep=1;this.$animSpeed=10;var a=1<<1,d=1<<2,g=1<<3,k=1<<4;var c=this.$treeState={};this.$treeState[0]="";this.$treeState[a]="min";this.$treeState[a|d]="plus";this.$treeState[g]="last";this.$treeState[g|a]="minlast";this.$treeState[g|a|d]="pluslast";this.$treeState[k]="root";this.$booleanProperties.openadd=true;this.$booleanProperties.startcollapsed=true;this.$booleanProperties.nocollapse=true;this.$booleanProperties.singleopen=true;this.$booleanProperties.prerender=true;this.$booleanProperties.removecontainer=true;this.$supportedProperties.push("openadd","startcollapsed","nocollapse","singleopen","prerender","removecontainer");this.openadd=true;this.startcollapsed=1;this.prerender=true;this.expandAll=function(){if(!this.xmlRoot){return;}var q=this.each.split("|").join("["+this.each.replace(/\|/g," or ")+"]|.//"),n=this;(function(u){var s=u.selectNodes(q);for(var t=0;t<s.length;t++){n.slideToggle(apf.xmldb.getHtmlNode(s[t],n),1,true);arguments.callee(s[t]);}})(this.xmlRoot);};this.collapseAll=function(){if(!this.xmlRoot){return;}var q=this.xmlRoot.selectNodes(".//"+this.each.split("|").join("["+this.each.replace(/\|/g," or ")+"]|.//"));for(var n=q.length-1;n>=0;n--){this.slideToggle(apf.xmldb.getHtmlNode(q[n],this),2,true);}};this.expandAndSelect=function(s){if(!this.xmlRoot){return;}var q=this;(function n(u){var t=q.getTraverseParent(u);if(t!=q.xmlRoot){n(t);}q.slideToggle(apf.xmldb.getHtmlNode(t,q),1,true);})(s);this.select(s);};this.selectPath=function(n){};this.slideToggle=function(t,s,q,u){if(this.nocollapse||u&&this.disabled){return;}if(!t){t=this.$selected;}var w=t.getAttribute(apf.xmldb.htmlIdTag);while(!w&&t.parentNode){w=(t=t.parentNode).getAttribute(apf.xmldb.htmlIdTag);}var n=this.$getLayoutNode("item","container",t);if(!n){return;}if(apf.getStyle(n,"display")=="block"){if(s==1){return;}t.className=t.className.replace(/min/,"plus");this.slideClose(n,apf.xmldb.getNode(t),q);}else{if(s==2){return;}t.className=t.className.replace(/plus/,"min");this.slideOpen(n,apf.xmldb.getNode(t),q);}};this.isCollapsed=function(n){return(apf.getStyle(this.$getLayoutNode("item","container",apf.xmldb.getHtmlNode(n,this)),"display")=="none");};var i={};this.slideOpen=function(q,u,s){if(!u){u=this.selected;}var w=apf.xmldb.findHtmlNode(u,this);if(!q){q=this.$findContainer(w);}if(!q.innerHTML&&!this.getTraverseNodes(u).length){return;}if(this.singleopen){var t=this.getTraverseParent(u),A=(t||this.xmlRoot).getAttribute(apf.xmldb.xmlIdTag);if(i[A]&&i[A][1]!=u&&this.getTraverseParent(i[A][1])==t){this.slideToggle(i[A][0],2);}i[A]=[w,u];}q.style.display="block";if(!this.prerender&&this.$hasLoadStatus(u,"potential")&&!q.innerHTML){this.$extend(u,q,s);return;}if(s||q.scrollHeight>1000){q.style.height="auto";q.style.overflow="visible";return;}var n=this;apf.tween.single(q,{type:"scrollheight",from:0,to:q.scrollHeight,anim:this.$animType,steps:this.$animOpenStep,interval:this.$animSpeed,onfinish:function(B){if(u&&n.$hasLoadStatus(u,"potential")){$setTimeout(function(){B.style.height=B.scrollHeight+"px";B.style.overflow="hidden";n.$extend(u,B);});B.style.height="auto";B.style.overflow="visible";}else{B.style.overflow="visible";B.style.height="auto";}}});};this.slideClose=function(n,s,q){if(this.nocollapse){return;}if(!s){s=this.selected;}if(this.singleopen){var u=(this.getTraverseParent(s)||this.xmlRoot).getAttribute(apf.xmldb.xmlIdTag);i[u]=null;}if(!n){var t=apf.xmldb.findHtmlNode(s,this);n=this.$findContainer(t);}n.style.height=n.offsetHeight;n.style.overflow="hidden";if(q){n.style.height=0;n.style.display="none";return;}apf.tween.single(n,{type:"scrollheight",from:n.scrollHeight,to:0,anim:this.$animType,steps:this.$animCloseStep,interval:this.$animSpeed,onfinish:function(w,A){w.style.display="none";}});};this.$add=function(q,G,n,C,F,B,M){if(this.$isTreeArch&&this.$needsDepth&&typeof M=="undefined"){var w=n;M=0;while(w!=this.xmlRoot){M++;w=w.parentNode;}}var u=this.$getBindRule("insert",q)?true:false,L=this.getTraverseNodes(q),K=L.length?true:false,H=u||K,E=this.$hasBindRule("collapsed")?(this.$getDataNode("collapsed",q)?true:false):(this.$hasBindRule("expanded")?(this.$getDataNode("expanded",q)?false:true):this.startcollapsed),s=(H?a:0)|(E&&H||u?d:0)|(B?g:0),A=this.$initNode(q,s,G,M),D=this.$getLayoutNode("item","container"),J;if(!E&&!this.nocollapse){D.setAttribute("style","overflow:visible;height:auto;display:block;");}var t,I=(!this.removecontainer||H);if(!H||u){D.setAttribute("style","display:none;");}if(!this.prerender){J=L.length;}if(H&&!this.prerender&&J>2&&E||u&&(!this.$hasLoadStatus(q)||this.$hasLoadStatus(q,"potential"))){this.$setLoading(q,D);}else{if(!K&&(t=this.$applyBindRule("empty",q))){this.$setEmptyMessage(D,t);}}if((!C||C==this.$container)&&n==this.xmlRoot&&!F){this.$nodes.push(A);if(!apf.isChildOf(A,D,true)&&I){this.$nodes.push(D);}this.$setStyleClass(A,"root");this.$setStyleClass(D,"root");}else{if(!C){C=apf.xmldb.findHtmlNode(q.parentNode,this);C=C?this.$getLayoutNode("item","container",C):this.$container;}if(C==this.$container){this.$setStyleClass(A,"root");this.$setStyleClass(D,"root");}if(!F&&this.getNextTraverse(q)){F=apf.xmldb.findHtmlNode(this.getNextTraverse(q),this);}if(F&&F.parentNode!=C){F=null;}if(C.style&&this.getTraverseNodes(q.parentNode).length==1){this.$removeEmptyMessage(C);}if(C.style){apf.insertHtmlNode(A,C,F);if(!apf.isChildOf(A,D,true)&&I){var D=apf.insertHtmlNode(D,C,F);}}else{C.insertBefore(A,F);if(!apf.isChildOf(C,D,true)&&I){C.insertBefore(D,F);}}if(C.style){if(!E&&this.openadd&&C!=this.$container&&C.style.display!="block"){this.slideOpen(C,n,true);}this.$fixItem(n,apf.xmldb.findHtmlNode(n,this));if(this.getNextTraverse(q,true)){this.$fixItem(this.getNextTraverse(q,true),apf.xmldb.findHtmlNode(this.getNextTraverse(q,true),this));}}}if((this.prerender||J<3||!E)&&(q.namespaceURI!=apf.ns.apf||q.localName!="item")){this.$addNodes(q,D,false,null,null,(M||0)+1);}return D;};this.$fill=function(){if(this.$useiframe){this.$pHtmlDoc=this.oDoc;}if(this.$useTable){apf.insertHtmlNodes(this.$nodes,this.$container,null,"<table class='records' cellpadding='0' cellspacing='0'><tbody>","</tbody></table>");}else{apf.insertHtmlNodes(this.$nodes,this.$container);}this.$nodes.length=0;};this.$getParentNode=function(n){return n?this.$getLayoutNode("item","container",n):this.$container;};this.$fixItem=function(E,C,B,D,t){if(!C){return;}if(B){var u;if(u=this.getNextTraverse(E,true)){this.$fixItem(u,this.$findHtmlNode(u.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId),null,true);}if(!this.emptyMessage&&E.parentNode.selectNodes(this.each).length==1){this.$fixItem(E.parentNode,this.$findHtmlNode(E.parentNode.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId),null,false,true);}}else{var q=this.$getLayoutNode("item","container",C),A=false;if(t){A=false;}else{if(this.getTraverseNodes(E).length>0){A=true;}else{if(this.$hasLoadStatus(E,"potential")){A=true;}else{A=false;}}}var s=A&&q.style.display!="block",w=this.getNextTraverse(E,null,D?2:1)?false:true,n=(A?a:0)|(s?d:0)|(w?g:0);this.$setStyleClass(this.$getLayoutNode("item","class",C),c[n],["min","plus","last","minlast","pluslast"]);this.$setStyleClass(this.$getLayoutNode("item","container",C),c[n],["min","plus","last","minlast","pluslast"]);if(this.$getLayoutNode("item","openclose",C)){this.$getLayoutNode("item","openclose",C).setAttribute("children",A);}if(!A&&q){q.style.display="none";}}};this.$deInitNode=function(q,t){var n=this.$getLayoutNode("item","container",t),s=t.parentNode;n.parentNode.removeChild(n);s.removeChild(t);if(this.$withContainer){t.parentNode.removeChild(t.nextSibling);}if(q.parentNode!=this.xmlRoot){this.$fixItem(q,t,true);}var u;if(!s.childNodes.length&&(u=this.$applyBindRule("empty",q))){this.$setEmptyMessage(s,u);}this.$fixItem(q,t,true);};this.$moveNode=function(B,A){if(!self.apf.debug&&!A){return;}var s;if(this.$hasLoadStatus(B.parentNode,"potential")){s=this.$getLayoutNode("item","container",A);A.parentNode.removeChild(A);s.parentNode.removeChild(s);this.$extend(B.parentNode);return;}var C=A.parentNode,q=apf.xmldb.findHtmlNode(B.parentNode,this),D=this.getNextTraverse(B),w=D?apf.xmldb.findHtmlNode(D,this):null,u=q?this.$getLayoutNode("item","container",q):this.$container;s=this.$getLayoutNode("item","container",A);if(u!=C&&this.getTraverseNodes(B.parentNode).length==1){this.$removeEmptyMessage(u);}u.insertBefore(A,w);if(s){u.insertBefore(s,w);}var t;if(!C.childNodes.length&&(t=this.$applyBindRule("empty",B))){this.$setEmptyMessage(C,t);}if(this.openadd&&q!=this.$container&&u.style.display!="block"){this.slideOpen(u,q,true);}this.$fixItem(B,A);var n=this.getTraverseParent(B);this.$fixItem(n,apf.xmldb.findHtmlNode(n,this));if(this.getNextTraverse(B,true)){this.$fixItem(this.getNextTraverse(B,true),apf.xmldb.findHtmlNode(this.getNextTraverse(B,true),this));}};this.$setLoading=function(s,q){this.$setLoadStatus(s,"potential");var n=this.getTraverseNodes(s).length;if(!n||n>20){this.$getNewContext("loading");apf.insertHtmlNode(this.$getLayoutNode("loading"),q);}};this.$removeLoading=function(n){if(!n){return;}this.$getLayoutNode("item","container",n).innerHTML="";};this.$extend=function(s,n,q){var u=this.$getBindRule("insert",s),t=u&&u.match?(u.cmatch||u.compile("match"))(s):s;if(u&&t){this.$setLoadStatus(s,"loading");if(u.get){this.getModel().$insertFrom(u.getAttribute("get"),{xmlNode:t,insertPoint:t,amlNode:this});}else{if(this.$applyBindRule("insert",s)){this.insert(data,{insertPoint:t});}}}else{if(!this.prerender){this.$setLoadStatus(s,"loading");this.$removeLoading(apf.xmldb.findHtmlNode(s,this));j.call(this,{action:"insert",xmlNode:s,result:this.$addNodes(s,n,true),anim:!q});}}};function j(s){if(s.action=="move-away"){this.$fixItem(s.xmlNode,apf.xmldb.findHtmlNode(s.xmlNode,this),true);}if(s.action!="insert"){return;}var q=this.$findHtmlNode(s.xmlNode.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId);if(!q){return;}if(s.action=="insert"&&s.result.length>0){var n=this.$getLayoutNode("item","container",q);this.slideOpen(n,s.xmlNode);}else{this.$fixItem(s.xmlNode,q);}}this.addEventListener("xmlupdate",j);this.addEventListener("beforerename",function(){if(this.$tempsel){clearTimeout(this.timer);this.select(this.$tempsel);this.$tempsel=null;this.timer=null;}});this.addEventListener("keydown",function(K){var M=K.keyCode,u=K.ctrlKey,E=K.shiftKey,J=this.$caret||this.$selected,A,D,t,G,F,L,n,C;if(!J||this.renaming){return;}var q=this.caret||this.selected,s=this.$ext;switch(M){case 13:if(this.$tempsel){this.$selectTemp();}if(this.ctrlselect=="enter"){this.select(this.caret,true);}this.choose(J);break;case 32:if(this.$tempsel){this.$selectTemp();}if(this.$mode&&!u){var H=this.getSelection();if(!H.length||!this.multiselect){this.checkToggle(this.caret);}else{this.checkList(H,this.isChecked(this.selected),true);}}else{if(u||!this.isSelected(this.caret)){this.select(this.caret,true);}}return false;case 46:if(this.$tempsel){this.$selectTemp();}this.remove(this.caret);break;case 36:this.$setTempSelected(this.getFirstTraverseNode(),false,E);s.scrollTop=0;return false;case 35:var w=this.getLastTraverseNode();while(!this.isCollapsed(w)){w=this.getLastTraverseNode(w);}this.$setTempSelected(w,false,E,true);s.scrollTop=s.scrollHeight;return false;case 37:if(this.$tempsel){this.$selectTemp();}if(this.caret.selectSingleNode(this.each)&&!this.isCollapsed(this.caret)){this.slideToggle(this.$caret||this.$selected,2);}else{if(n=this.getTraverseParent(this.caret)){this.select(n);}}return false;case 107:case 187:case 39:if(this.$tempsel){this.$selectTemp();}if(this.$hasLoadStatus(this.caret,"potential")||this.getFirstTraverseNode(this.caret)){this.slideToggle(this.$caret||this.$selected,1);}break;case 109:case 189:if(this.getFirstTraverseNode(this.caret)){this.slideToggle(this.$caret||this.$selected,2);}break;case 38:if(!q&&!this.$tempsel){return;}G=this.$tempsel?apf.xmldb.getNode(this.$tempsel):q;L=this.getNextTraverse(G,true);if(L){F=this.getTraverseNodes(L);do{C=this.$getLayoutNode("item","container",this.$findHtmlNode(apf.xmldb.getID(L,this)));if(C&&apf.getStyle(C,"display")=="block"&&F.length){L=F[F.length-1];}else{break;}}while(L&&(F=this.getTraverseNodes(L)).length);}else{if(this.getTraverseParent(G)==this.xmlRoot){this.dispatchEvent("selecttop");return;}else{L=this.getTraverseParent(G);}}if(L&&L.nodeType==1){this.$setTempSelected(L,u,E,true);}else{return false;}J=apf.xmldb.findHtmlNode(L,this);D=apf.getAbsolutePosition(J,this.$container)[1]-(J.offsetHeight/2);if(D<=s.scrollTop){s.scrollTop=D;}return false;case 40:if(!q&&!this.$tempsel){return;}G=this.$tempsel?apf.xmldb.getNode(this.$tempsel):q;L=this.getFirstTraverseNode(G);if(L){C=this.$getLayoutNode("item","container",this.$findHtmlNode(apf.xmldb.getID(G,this)));if(C&&apf.getStyle(C,"display")!="block"){L=null;}}while(!L){n=this.getTraverseParent(G);if(!n){break;}var I=0;F=this.getTraverseNodes(n);while(F[I]&&F[I]!=G){I++;}L=F[I+1];G=n;}if(L&&L.nodeType==1){this.$setTempSelected(L,u,E);}else{return false;}J=apf.xmldb.findHtmlNode(L,this);D=apf.getAbsolutePosition(J,this.$container)[1]+(J.offsetHeight/2);if(D>s.scrollTop+s.offsetHeight){s.scrollTop=D-s.offsetHeight;}return false;case 33:A=apf.getAbsolutePosition(this.$container);t=document.elementFromPoint(A[0]+this.$container.offsetWidth-2,A[1]+2);L=apf.xmldb.findXmlNode(t);if(L==this.selected){s.scrollTop-=s.offsetHeight-apf.getHeightDiff(s);t=document.elementFromPoint(A[0]+this.$container.offsetWidth-2,A[1]+2);L=apf.xmldb.findXmlNode(t);}this.select(L);J=apf.xmldb.findHtmlNode(L,this);D=apf.getAbsolutePosition(J,this.$container)[1]-(J.offsetHeight/2);if(D<=s.scrollTop){s.scrollTop=D;}break;case 34:A=apf.getAbsolutePosition(this.$container);t=document.elementFromPoint(A[0]+this.$container.offsetWidth-2,A[1]+this.$ext.offsetHeight-4);L=apf.xmldb.findXmlNode(t);if(L==this.selected){s.scrollTop+=s.offsetHeight-apf.getHeightDiff(s);t=document.elementFromPoint(A[0]+this.$container.offsetWidth-2,A[1]+this.$ext.offsetHeight-4);L=apf.xmldb.findXmlNode(t);}this.select(L);J=apf.xmldb.findHtmlNode(L,this);D=apf.getAbsolutePosition(J,this.$container)[1]+(J.offsetHeight/2);if(D>s.scrollTop+s.offsetHeight){s.scrollTop=D-s.offsetHeight;}break;default:if(this.celledit){if(!u&&!K.altKey&&(M>46&&M<112||M>123)){this.startRename(null,true);}return;}else{if(M==65&&u){this.selectAll();return false;}else{if(this.caption||(this.bindingRules||{})["caption"]){if(!this.xmlRoot){return;}if(!this.lookup||new Date().getTime()-this.lookup.date.getTime()>300){this.lookup={str:"",date:new Date()};}this.lookup.str+=String.fromCharCode(M);var F=this.getTraverseNodes();for(var B,I=0;I<F.length;I++){B=this.$applyBindRule("caption",F[I]);if(B&&B.substr(0,this.lookup.str.length).toUpperCase()==this.lookup.str){if(!this.isSelected(F[I])){if(this.mode=="check"){this.setCaret(F[I]);}else{this.select(F[I]);}}if(J){this.$container.scrollTop=J.offsetTop-(this.$container.offsetHeight-J.offsetHeight)/2;}return;}}return;}}}break;}},true);this.$getCaptionElement=function(){if(!this.$selected){return false;}var n=this.$getLayoutNode("item","caption",this.$selected);return n.nodeType==1?n:n.parentNode;};this.$calcSelectRange=function(s,n){var u=[],w=false,t=0,q=this.hasFeature(apf.__VIRTUALVIEWPORT__)?this.xmlRoot.selectNodes(this.$isTreeArch?this.each:".//"+this.each.split("|").join("|.//")):this.getTraverseNodes();for(;t<q.length;t++){if(q[t]==s){w=true;}if(w){u.push(q[t]);}if(q[t]==n){w=false;}}if(!u.length||w){u=[];for(w=false,t=q.length-1;t>=0;t--){if(q[t]==s){w=true;}if(w){u.push(q[t]);}if(q[t]==n){w=false;}}}return u;};this.$findContainer=function(n){return this.$getLayoutNode("item","container",n);};this.$selectDefault=function(s){if(this.select(this.getFirstTraverseNode(s),null,null,null,true)){return true;}else{var n=this.getTraverseNodes(s);for(var q=0;q<n.length;q++){if(this.$selectDefault(n[q])){return true;}}}};this.$setEmptyMessage=function(t,u){this.$getNewContext("empty");var q=this.$getLayoutNode("empty");if(!q){return;}var s=apf.insertHtmlNode(q,t);var n=this.$getLayoutNode("empty","caption",s);if(n){apf.setNodeValue(n,u||"");}if(t.style){this.slideOpen(t,null,true);}else{t.setAttribute("style","overflow:visible;height:auto;display:block;");}};this.$removeEmptyMessage=function(q){var n=q.firstChild;if(!n){return;}do{if(n.className=="message"){q.removeChild(n);return;}n=n.nextSibling;}while(n);};this.$drawBase=function(){this.$ext=this.$getExternal();this.$container=this.$getLayoutNode("main","container",this.$ext);this.opencloseaction=this.$getOption("main","openclose");if(apf.hasCssUpdateScrollbarBug&&!this.mode){this.$fixScrollBug();}var n=this;this.$ext.onclick=function(q){n.dispatchEvent("click",{htmlEvent:q||event});};};this.addEventListener("DOMNodeInsertedIntoDocument",function(){if(this.nocollapse){this.startcollapsed=false;}else{if(this.startcollapsed===1){this.startcollapsed=!apf.isFalse(this.$getOption("main","startcollapsed"));}}});this.addEventListener("DOMNodeRemovedFromDocument",function(){this.$ext.onclick=null;apf.destroyHtmlNode(this.oDrag);this.oDrag=null;});}).call(apf.BaseTree.prototype=new apf.MultiSelect());apf.__TRANSACTION__=1<<3;apf.BaseList=function(){this.$init(true);this.$dynCssClasses=[];this.listNodes=[];};(function(){this.implement(apf.Cache,apf.DataAction);this.$focussable=true;this.multiselect=true;this.mode="normal";this.$propHandlers.fill=function(a){if(a){this.loadFillData(this.getAttribute("fill"));}else{this.clear();}};this.$propHandlers.template=function(d){this.$template=typeof d=="object"?d:apf.nameserver.get("template",d);if(!this.$template){var c;apf.addEventListener("parsestop",c=function(){_self.$propHandlers.template.call(_self,d);apf.removeEventListener("parsestop",c);});return;}this.$deInitNode=function(i,j){var g=i.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId;this.$template.destroyInstance(g);if(j){j.parentNode.removeChild(j);}};this.$updateNode=function(g,j,i){};this.$moveNode=function(g,i){};var a=document.createDocumentFragment();this.$add=function(j,i,k,q,g){var n=document.createElement("div");n.setAttribute("id",i);a.appendChild(n);this.$template.getNewInstance(this.$getLayoutNode("item","container",n),i,j,true);};this.$fill=function(){this.$container.appendChild(a);apf.queue.empty();};this.$checkLoadQueue();};this.$keyHandler=function(s){var D=s.keyCode,c=s.ctrlKey,w=s.shiftKey,u=this.$selected||this.$caret;if(s.returnValue==-1||!u||this.renaming){return;}var B=this.caret||this.selected,d=this.$ext,g,j,t,E,A,q,n;switch(D){case 13:if(this.$tempsel){this.$selectTemp();}if(this.ctrlselect=="enter"){this.select(this.caret,true);}this.choose(this.selected);break;case 32:if(c||this.mode!="normal"||!this.isSelected(this.caret)){this.select(this.caret,c);}break;case 109:case 46:if(this.disableremove){return;}if(this.$tempsel){this.$selectTemp();}this.remove(this.mode!="normal"?this.caret:null);break;case 36:if(this.hasFeature(apf.__VIRTUALVIEWPORT__)){this.viewport.change(0,null,true,true);}this.select(this.getFirstTraverseNode(),false,w);this.$container.scrollTop=0;break;case 35:if(this.hasFeature(apf.__VIRTUALVIEWPORT__)){this.viewport.change(this.viewport.length,null,true,true);}this.select(this.getLastTraverseNode(),false,w);this.$container.scrollTop=this.$container.scrollHeight;break;case 107:if(this.more){this.startMore();}break;case 37:if(!B&&!this.$tempsel){return;}g=this.$tempsel?apf.xmldb.getNode(this.$tempsel):B;j=apf.getBox(apf.getStyle(u,"margin"));t=u.offsetWidth?Math.floor((d.offsetWidth-(A?15:0))/(u.offsetWidth+j[1]+j[3])):1;j=apf.getBox(apf.getStyle(u,"margin"));g=this.getNextTraverseSelected(g,false);if(g){this.$setTempSelected(g,c,w,true);}else{return;}u=apf.xmldb.findHtmlNode(g,this);if(u.offsetTop<d.scrollTop){d.scrollTop=Array.prototype.indexOf.call(this.getTraverseNodes(),g)<t?0:u.offsetTop-j[0];}break;case 38:if(!B&&!this.$tempsel){return;}g=this.$tempsel?apf.xmldb.getNode(this.$tempsel):B;j=apf.getBox(apf.getStyle(u,"margin"));A=d.scrollHeight>d.offsetHeight;t=u.offsetWidth?Math.floor((d.offsetWidth-(A?15:0))/(u.offsetWidth+j[1]+j[3])):1;g=this.getNextTraverseSelected(g,false,t);if(g){this.$setTempSelected(g,c,w,true);}else{return;}u=apf.xmldb.findHtmlNode(g,this);if(u.offsetTop<d.scrollTop){d.scrollTop=Array.prototype.indexOf.call(this.getTraverseNodes(),g)<t?0:u.offsetTop-j[0];}break;case 39:if(!B&&!this.$tempsel){return;}g=this.$tempsel?apf.xmldb.getNode(this.$tempsel):B;j=apf.getBox(apf.getStyle(u,"margin"));g=this.getNextTraverseSelected(g,true);if(g){this.$setTempSelected(g,c,w);}else{return;}u=apf.xmldb.findHtmlNode(g,this);if(u.offsetTop+u.offsetHeight>d.scrollTop+d.offsetHeight){d.scrollTop=u.offsetTop-d.offsetHeight+u.offsetHeight+j[0];}break;case 40:if(!B&&!this.$tempsel){return;}g=this.$tempsel?apf.xmldb.getNode(this.$tempsel):B;j=apf.getBox(apf.getStyle(u,"margin"));A=d.scrollHeight>d.offsetHeight;t=u.offsetWidth?Math.floor((d.offsetWidth-(A?15:0))/(u.offsetWidth+j[1]+j[3])):1;g=this.getNextTraverseSelected(g,true,t);if(g){this.$setTempSelected(g,c,w);}else{return;}u=apf.xmldb.findHtmlNode(g,this);if(u.offsetTop+u.offsetHeight>d.scrollTop+d.offsetHeight){d.scrollTop=u.offsetTop-d.offsetHeight+u.offsetHeight+j[0];}break;case 33:if(!B&&!this.$tempsel){return;}g=this.$tempsel?apf.xmldb.getNode(this.$tempsel):B;j=apf.getBox(apf.getStyle(u,"margin"));n=d.scrollHeight>d.offsetHeight;q=d.scrollWidth>d.offsetWidth;t=Math.floor((d.offsetWidth-(n?15:0))/(u.offsetWidth+j[1]+j[3]));E=Math.floor((d.offsetHeight-(q?15:0))/(u.offsetHeight+j[0]+j[2]));g=this.getNextTraverseSelected(g,false,t*E);if(!g){g=this.getFirstTraverseNode();}if(g){this.$setTempSelected(g,c,w,true);}else{return;}u=apf.xmldb.findHtmlNode(g,this);if(u.offsetTop<d.scrollTop){d.scrollTop=Array.prototype.indexOf.call(this.getTraverseNodes(),g)<t?0:u.offsetTop-j[0];}break;case 34:if(!B&&!this.$tempsel){return;}g=this.$tempsel?apf.xmldb.getNode(this.$tempsel):B;j=apf.getBox(apf.getStyle(u,"margin"));n=d.scrollHeight>d.offsetHeight;q=d.scrollWidth>d.offsetWidth;t=Math.floor((d.offsetWidth-(n?15:0))/(u.offsetWidth+j[1]+j[3]));E=Math.floor((d.offsetHeight-(q?15:0))/(u.offsetHeight+j[0]+j[2]));g=this.getNextTraverseSelected(B,true,t*E);if(!g){g=this.getLastTraverseNode();}if(g){this.$setTempSelected(g,c,w);}else{return;}u=apf.xmldb.findHtmlNode(g,this);if(u.offsetTop+u.offsetHeight>d.scrollTop+d.offsetHeight){d.scrollTop=u.offsetTop-d.offsetHeight+u.offsetHeight+j[0];}break;default:if(D==65&&c){this.selectAll();}else{if(this.$hasBindRule("caption")){if(!this.xmlRoot||this.autorename){return;}if(!this.lookup||new Date().getTime()-this.lookup.date.getTime()>300){this.lookup={str:"",date:new Date()};}this.lookup.str+=String.fromCharCode(D);var a=this.getTraverseNodes();for(var C,k=0;k<a.length;k++){C=this.$applyBindRule("caption",a[k]);if(C&&C.substr(0,this.lookup.str.length).toUpperCase()==this.lookup.str){if(!this.isSelected(a[k])){if(this.mode=="check"){this.setCaret(a[k]);}else{this.select(a[k]);}}if(u){this.$container.scrollTop=u.offsetTop-(this.$container.offsetHeight-u.offsetHeight)/2;}return;}}return;}}break;}this.lookup=null;return false;};this.$deInitNode=function(a,c){if(!c){return;}c.parentNode.removeChild(c);};this.$updateNode=function(d,j,g){var c=this.$getLayoutNode("item","icon",j);if(c){if(c.nodeType==1){c.style.backgroundImage="url("+apf.getAbsolutePath(this.iconPath,this.$applyBindRule("icon",d))+")";}else{c.nodeValue=apf.getAbsolutePath(this.iconPath,this.$applyBindRule("icon",d));}}else{var i=this.$getLayoutNode("item","image",j);if(i){if(i.nodeType==1){i.style.backgroundImage="url("+apf.getAbsolutePath(apf.hostPath,this.$applyBindRule("image",d))+")";}else{i.nodeValue=apf.getAbsolutePath(apf.hostPath,this.$applyBindRule("image",d));}}}var k=this.$getLayoutNode("item","caption",j);if(k){if(k.nodeType==1){k.innerHTML=this.$applyBindRule("caption",d);}else{k.nodeValue=this.$applyBindRule("caption",d);}}j.title=this.$applyBindRule("title",d)||"";var a=this.$applyBindRule("css",d);if(a||this.$dynCssClasses.length){this.$setStyleClass(j,a,this.$dynCssClasses);if(a&&!this.$dynCssClasses.contains(a)){this.$dynCssClasses.push(a);}}if(!g&&this.$updateModifier){this.$updateModifier(d,j);}};this.$moveNode=function(g,i){if(!i){return;}var a=i.parentNode;var d=this.getNextTraverse(g);var c=d?apf.xmldb.findHtmlNode(d,this):null;a.insertBefore(i,c);};this.$add=function(t,j,n,u,q){this.$getNewContext("item");var i=this.$getLayoutNode("item"),d=this.$getLayoutNode("item","select"),k=this.$getLayoutNode("item","icon"),a=this.$getLayoutNode("item","image"),s=this.$getLayoutNode("item","caption");i.setAttribute("id",j);d.setAttribute("onmouseover","var o = apf.lookup("+this.$uniqueId+"); o.$setStyleClass(this, 'hover', null, true);");d.setAttribute("onselectstart","return false;");d.setAttribute("style",(d.getAttribute("style")||"")+";user-select:none;-moz-user-select:none;-webkit-user-select:none;");if(this.hasFeature(apf.__RENAME__)||this.hasFeature(apf.__DRAGDROP__)){d.setAttribute("ondblclick","var o = apf.lookup("+this.$uniqueId+"); o.stopRename(); o.choose()");d.setAttribute("onmouseout","var o = apf.lookup("+this.$uniqueId+");            	  o.$setStyleClass(this, '', ['hover'], true);                this.hasPassedDown = false;");d.setAttribute(this.itemSelectEvent||"onmousedown","var o = apf.lookup("+this.$uniqueId+');                 var xmlNode = apf.xmldb.findXmlNode(this);                 var isSelected = o.isSelected(xmlNode);                 this.hasPassedDown = true;                 if (!o.renaming && o.hasFocus() && isSelected == 1)                     this.dorename = true;                 if (!o.hasFeature(apf.__DRAGDROP__) || o.mode != "normal" || !isSelected && !event.ctrlKey)                     o.select(this, event.ctrlKey, event.shiftKey, -1)');d.setAttribute("onmouseup","if (!this.hasPassedDown) return;                var o = apf.lookup("+this.$uniqueId+');if (o.hasFeature(apf.__RENAME__) && this.dorename && o.mode == "normal")                    o.startDelayedRename(event, null, true);this.dorename = false;                 var xmlNode = apf.xmldb.findXmlNode(this);                 var isSelected = o.isSelected(xmlNode);                 if (o.mode == "normal" && o.hasFeature(apf.__DRAGDROP__))                     o.select(this, event.ctrlKey, event.shiftKey, -1)');}else{d.setAttribute("onmouseout","apf.setStyleClass(this, '', ['hover']);");d.setAttribute("ondblclick","var o = apf.lookup("+this.$uniqueId+"); o.choose(null, true)");d.setAttribute(this.itemSelectEvent||"onmousedown","var o = apf.lookup("+this.$uniqueId+"); o.select(this, event.ctrlKey, event.shiftKey, -1)");}this.$listGrid=this.$getOption("main","list-mode")=="grid";if(this.$listGrid){i.setAttribute("onmouseover",i.getAttribute("onmouseover")+"var o = apf.lookup("+this.$uniqueId+");o.$selectSeries(event);");}if(k){if(k.nodeType==1){k.setAttribute("style","background-image:url("+apf.getAbsolutePath(this.iconPath,this.$applyBindRule("icon",t))+")");}else{k.nodeValue=apf.getAbsolutePath(this.iconPath,this.$applyBindRule("icon",t));}}else{if(a){if(a.nodeType==1){if((a.tagName||"").toLowerCase()=="img"){a.setAttribute("src",apf.getAbsolutePath(apf.hostPath,this.$applyBindRule("image",t)));}else{a.setAttribute("style","background-image:url("+apf.getAbsolutePath(apf.hostPath,this.$applyBindRule("image",t))+")");}}else{if(apf.isSafariOld){var c=a.ownerElement.parentNode,g=c.appendChild(c.ownerDocument.createElement("img"));g.setAttribute("src",apf.getAbsolutePath(apf.hostPath,this.$applyBindRule("image",t)));}else{a.nodeValue=apf.getAbsolutePath(apf.hostPath,this.$applyBindRule("image",t));}}}}if(s){apf.setNodeValue(s,this.$applyBindRule("caption",t));}i.setAttribute("title",this.$applyBindRule("tooltip",t)||"");var w=this.$applyBindRule("css",t);if(w){this.$setStyleClass(i,w);if(w){this.$dynCssClasses.push(w);}}if(this.$addModifier){this.$addModifier(t,i);}if(u){apf.insertHtmlNode(i,u,q);}else{this.listNodes.push(i);}};this.$fill=function(){if(this.more&&!this.moreItem){this.$getNewContext("item");var c=this.$getLayoutNode("item"),d=this.$getLayoutNode("item","caption"),a=this.$getLayoutNode("item","select");c.setAttribute("class","more");a.setAttribute("onmousedown","var o = apf.lookup("+this.$uniqueId+');o.clearSelection();o.$setStyleClass(this, "more_down", null, true);');a.setAttribute("onmouseout","apf.lookup("+this.$uniqueId+').$setStyleClass(this, "", ["more_down"], true);');a.setAttribute("onmouseup","apf.lookup("+this.$uniqueId+").startMore(this, true)");if(d){apf.setNodeValue(d,this.more.match(/caption:(.*)(;|$)/i)[1]);}this.listNodes.push(c);}apf.insertHtmlNodes(this.listNodes,this.$container);this.listNodes.length=0;if(this.more&&!this.moreItem){this.moreItem=this.$container.lastChild;}};this.startMore=function(d,c){if(c&&this.disabled){return;}this.$setStyleClass(d,"",["more_down"]);var a;if(!this.$actions.add){if(this.each&&!this.each.match(/[\/\[]/)){a="<"+this.each+(this.each.match(/^a:/)?" xmlns:a='"+apf.ns.aml+"'":"")+" custom='1' />";}else{throw new Error(apf.formatErrorString(0,this,"Could not start more","No add action rule is defined for this component",this.$aml));return false;}}this.add(a,null,null,function(g){this.select(g,null,null,null,null,true);this.$container.appendChild(this.moreItem);var i=function(){this.getActionTracker().undo(this.autoselect?2:1);this.removeEventListener("stoprename",i);this.removeEventListener("beforerename",k);this.removeEventListener("afterrename",j);};var j=function(){this.removeEventListener("afterrename",j);};var k=function(q){this.removeEventListener("stoprename",i);this.removeEventListener("beforerename",k);var n=this.findXmlNodeByValue(q.args[1]);if(n||!q.args[1]){if(q.args[1]&&this.dispatchEvent("notunique",{value:q.args[1]})===false){this.startRename();this.addEventListener("stoprename",i);this.addEventListener("beforerename",k);}else{this.removeEventListener("afterrename",j);this.getActionTracker().undo();if(!this.isSelected(n)){this.select(n);}}return false;}};this.addEventListener("stoprename",i);this.addEventListener("beforerename",k);this.addEventListener("afterrename",j);this.startDelayedRename({},1);});};this.$calcSelectRange=function(d,a){var j=[],c=this.hasFeature(apf.__VIRTUALVIEWPORT__)?this.xmlRoot.selectNodes(this.each):this.getTraverseNodes(),k,g;for(k=false,g=0;g<c.length;g++){if(c[g]==d){k=true;}if(k){j.push(c[g]);}if(c[g]==a){k=false;}}if(!j.length||k){j=[];for(k=false,g=c.length-1;g>=0;g--){if(c[g]==d){k=true;}if(k){j.push(c[g]);}if(c[g]==a){k=false;}}}return j;};this.$selectDefault=function(a){this.select(this.getTraverseNodes()[0],null,null,null,true);};this.loadFillData=function(u){var t,a,g,n=u.splitSafe(","),s=[];for(var c,d,q=0;q<n.length;q++){if((d=n[q]).match(/^\d+-\d+$/)){c=d.split("-");a=parseInt(c[0]);g=parseInt(c[1]);if(c[0].length==c[1].length){t=Math.max(c[0].length,c[1].length);for(var k=a;k<g+1;k++){s.push("<item>"+(k+"").pad(t,"0")+"</item>");}}else{for(var k=a;k<g+1;k++){s.push("<item>"+k+"</item>");}}}else{s.push("<item>"+d+"</item>");}}this.$initingModel=true;this.each="item";this.$setDynamicProperty("caption","[label/text()|@caption|text()]");this.$setDynamicProperty("eachvalue","[value/text()|@value|text()]");this.$canLoadDataAttr=false;this.load("<data>"+s.join("")+"</data>");};}).call(apf.BaseList.prototype=new apf.MultiSelect());apf.__VIRTUALVIEWPORT__=1<<19;apf.BaseStateButtons=function(){this.state="normal";this.edit=false;this.animate=true;var j={min:["minimized","minimize","restore"],max:["maximized","maximize","restore"],edit:["edit","edit","closeedit"],close:["closed","close","show"]};this.$lastheight=null;this.$lastpos=null;this.$lastzindex=null;this.$lastState={normal:true};this.$booleanProperties.animate=true;this.$supportedProperties.push("buttons","animate","state");this.close=function(){this.setProperty("state",this.state.split("|").pushUnique("closed").join("|"),false,true);return this;};this.minimize=function(){this.setProperty("state",this.state.split("|").remove("maximized").remove("normal").pushUnique("minimized").join("|"),false,true);return this;};this.maximize=function(){this.setProperty("state",this.state.split("|").remove("minimized").remove("normal").pushUnique("maximized").join("|"),false,true);return this;};this.restore=function(){this.setProperty("state",this.state.split("|").remove("minimized").remove("maximized").pushUnique("normal").join("|"),false,true);return this;};this.edit=function(k){this.setProperty("state",this.state.split("|").pushUnique("edit").join("|"),false,true);return this;};this.closeedit=function(k){this.setProperty("state",this.state.split("|").remove("edit").join("|"),false,true);return this;};this.$toggle=function(k){var n=j[k][0];this[j[k][this.state.indexOf(n)>-1?2:1]]();};this.$propHandlers.refparent=function(k){if(typeof k=="string"){this.$refParent=self[k]&&self[k].$ext||document.getElementById(k);}else{this.$refParent=k;}};this.$propHandlers.state=function(E,F,L,u){var n=this;if(!this.$amlLoaded){apf.queue.add("state"+this.$uniqueId,function(){n.$propHandlers.state.call(n,E,F);});return;}var J,k,N,G,B,D={},C=E.split("|"),I=this.$lastState,A=[];for(J=0;J<C.length;J++){D[C[J]]=true;}D.value=E;if(!D.maximized&&!D.minimized){D.normal=true;}if(!u&&this.dispatchEvent("beforestatechange",{from:I,to:D})===false){this.state=I.value;return false;}if(D.closed==this.visible){this.setProperty("visible",!D.closed);}if(D.normal!=I.normal||!D.normal&&(D.minimized!=I.minimized||D.maximized!=I.maximized)){if(this.$lastheight){this.$ext.style.height=this.$lastheight;}if(this.$lastpos){if(this.animate&&!F){var w=this.$ext;N=apf.getStyle(w,"position");if(N!="absolute"){G=parseInt(apf.getStyle(w,"left"))||0;B=parseInt(apf.getStyle(w,"top"))||0;}else{G=w.offsetLeft;B=w.offsetTop;}this.animstate=1;apf.tween.multi(w,{steps:5,interval:10,tweens:[{type:"left",from:G,to:this.$lastpos.px[0]},{type:"top",from:B,to:this.$lastpos.px[1]},{type:"width",from:this.$ext.offsetWidth-i,to:this.$lastpos.px[2]},{type:"height",from:this.$ext.offsetHeight-c,to:this.$lastpos.px[3]}],oneach:function(){if(apf.hasSingleRszEvent){apf.layout.forceResize(n.$int);}},onfinish:function(){n.$propHandlers.state.call(n,E,true,null,true);}});return;}this.$ext.style.left=this.$lastpos.css[0];this.$ext.style.top=this.$lastpos.css[1];this.$ext.style.width=this.$lastpos.css[2];this.$ext.style.height=this.$lastpos.css[3];k=this.$lastpos.parentNode;k.style.width=this.$lastpos.parent[0];k.style.height=this.$lastpos.parent[1];k.style.overflow=this.$lastpos.parent[2];}if(this.aData&&this.aData.restore){this.aData.restore();}if(apf.layout){apf.layout.play(this.$pHtmlNode);}if(this.$lastzindex){this.$ext.style.zIndex=this.$lastzindex[0];if(this.oCover){this.oCover.style.zIndex=this.$lastzindex[1];}}this.$lastheight=this.$lastpos=this.$lastzindex=null;if(D.normal){A.push("",this.$baseCSSname+"Max",this.$baseCSSname+"Min");}}if(D.minimized!=I.minimized){if(D.minimized){A.unshift(this.$baseCSSname+"Min",this.$baseCSSname+"Max",this.$baseCSSname+"Edit");if(this.aData&&this.aData.minimize){this.aData.minimize(this.collapsedHeight);}if(!this.aData||!this.aData.minimize){this.$lastheight=apf.getStyle(this.$ext,"height");this.$ext.style.height=Math.max(0,this.collapsedHeight-apf.getHeightDiff(this.$ext))+"px";}if(this.hasFocus()){apf.window.moveNext(null,this,true);}}else{A.push(this.$baseCSSname+"Min");$setTimeout(function(){apf.window.$focusLast(n);});}}if(D.maximized!=I.maximized){if(D.maximized){A.unshift(this.$baseCSSname+"Max",this.$baseCSSname+"Min",this.$baseCSSname+"Edit");k=this.$refParent;if(!k){k=(this.$ext.offsetParent==document.body?document.documentElement:this.$ext.parentNode);}n.animstate=0;var M=false,w=this.$ext;var N=apf.getStyle(w,"position");if(N=="absolute"){k.style.overflow="hidden";G=w.offsetLeft;B=w.offsetTop;}else{var q=apf.getAbsolutePosition(w,k);G=q[0];B=q[1];}this.$lastpos={css:[this.$ext.style.left,this.$ext.style.top,this.$ext.style.width,this.$ext.style.height],px:[G,B,this.$ext.offsetWidth-i,this.$ext.offsetHeight-c],parent:[k.style.width,k.style.height,k.style.overflow],parentNode:k};var H=[w.offsetWidth,w.offsetHeight];function K(){var s=!apf.isIE&&k==document.documentElement?window.innerWidth:k.offsetWidth,t=!apf.isIE&&k==document.documentElement?window.innerHeight:k.offsetHeight;if(N!="absolute"){var Q=apf.getDiff(k);s-=Q[0]+(!n.$refParent&&apf.isIE8?4:0);t-=Q[0]+(!n.$refParent&&apf.isIE8?4:0);}else{if(!n.$refParent&&apf.isIE8){s-=4;t-=4;}}var P=n.$refParent?[0,0,0,0]:g,R=k!=w.offsetParent?apf.getAbsolutePosition(k,w.offsetParent):[0,0],O=apf.getDiff(k);k.style.width=(k.offsetWidth-O[0])+"px";k.style.height=(k.offsetHeight-O[1])+"px";if(n.animate&&!M){n.animstate=1;M=true;apf.tween.multi(w,{steps:5,interval:10,tweens:[{type:"left",from:G,to:R[0]-P[3]},{type:"top",from:B,to:R[1]-P[0]},{type:"width",from:H[0]-i,to:(s-i+P[1]+P[3])},{type:"height",from:H[1]-c,to:(t-c+P[0]+P[2])}],oneach:function(){if(apf.hasSingleRszEvent){apf.layout.forceResize(n.$int);}},onfinish:function(){n.animstate=0;n.dispatchEvent("afterstatechange",{from:I,to:D});}});}else{if(!n.animstate){w.style.left=(R[0]-P[3])+"px";w.style.top=(R[1]-P[0])+"px";w.style.width=(s-i+P[1]+P[3])+"px";w.style.height=(t-c+P[0]+P[2])+"px";}}}if(apf.layout){apf.layout.pause(this.$pHtmlNode,K);}this.$lastzindex=[this.$ext.style.zIndex||1,this.oCover&&this.oCover.style.zIndex||1];if(this.oCover){this.oCover.style.zIndex=apf.WinServer.count+1;}this.$ext.style.zIndex=apf.WinServer.count+2;}else{A.push(this.$baseCSSname+"Max");}}if(D.edit!=I.edit){if(D.edit){A.unshift(this.$baseCSSname+"Edit",this.$baseCSSname+"Max",this.$baseCSSname+"Min");if(this.btnedit){d.edit.innerHTML="close";}this.dispatchEvent("editstart");}else{if(this.dispatchEvent("editstop")===false){return false;}A.push(this.$baseCSSname+"Edit");if(A.length==1){A.unshift("");}if(this.btnedit){d.edit.innerHTML="edit";}}}if(A.length||D.closed!=I.closed){if(A.length){this.$setStyleClass(this.$ext,A.shift(),A);}if(D.edit){this.dispatchEvent("prop.visible",{value:true});if(n.oSettings){apf.layout.forceResize(n.oSettings);}}if(!D.maximized||I.maximized&&n.animate){n.dispatchEvent("afterstatechange",{from:I,to:D});}this.$lastState=D;if(this.aData&&!D.maximized){this.$purgeAlignment();}if(!this.animate&&apf.hasSingleRszEvent&&apf.layout){apf.layout.forceResize(n.$int);}}};var g,i,c,d={};this.$propHandlers.buttons=function(u){if(apf.isIphone){return;}if(!this.$hasLayoutNode("button")){return;}var s=u&&(u=u.replace(/(\|)\||\|$/,"$1")).split("|")||[],k=this.$buttons.childNodes,A=u&&new RegExp("("+u+")"),B={},w=[];for(var q=0;q<k.length;q++){if(k[q].nodeType!=1||k[q].tagName!="DIV"){continue;}if(k[q].getAttribute("button")&&(!u||!k[q].className||!k[q].className.match(A))){k[q].style.display="none";this.$setStyleClass(k[q],"",["min","max","close","edit"]);w.push(k[q]);}else{B[RegExp.$1]=k[q];}}for(q=0;q<s.length;q++){if(!s[q]){continue;}if(B[s[q]]){this.$buttons.insertBefore(B[s[q]],this.$buttons.firstChild);continue;}var n=w.pop();if(!n){this.$getNewContext("button");n=this.$getLayoutNode("button");n.setAttribute("button","button");a.call(this,n);n=apf.insertHtmlNode(n,this.$buttons);}this.$setStyleClass(n,s[q],["min","max","close","edit"]);n.onclick=new Function("apf.lookup("+this.$uniqueId+").$toggle('"+s[q]+"')");n.style.display="block";d[s[q]]=n;this.$buttons.insertBefore(n,this.$buttons.firstChild);}var t=apf.getDiff(this.$ext);i=t[0];c=t[1];g=apf.getBox(apf.getStyle(this.$ext,"borderWidth"));};function a(k){k.setAttribute("onmousedown","var o = apf.all["+this.$uniqueId+"]             o.$setStyleClass(this, 'down', null, true);             event.cancelBubble = true;              var o = apf.findHost(this).$ext;             if (o.onmousedown) o.onmousedown(event);             event.cancelBubble = true;             apf.window.$mousedown(event);");k.setAttribute("onmouseup","var o = apf.all["+this.$uniqueId+"]             o.$setStyleClass(this, '', ['down'], true)");k.setAttribute("onmouseover","var o = apf.all["+this.$uniqueId+"]             o.$setStyleClass(this, 'hover', null, true)");k.setAttribute("onmouseout","var o = apf.all["+this.$uniqueId+"]             o.$setStyleClass(this, '', ['hover', 'down'], true)");}this.$initButtons=function(t){this.collapsedHeight=this.$getOption("Main","collapsed-height");var s=this.$getLayoutNode("main","buttons",t);if(!s||apf.isIphone||!this.getAttribute("buttons")||!this.$hasLayoutNode("button")){return;}var k=(this.getAttribute("buttons")||"").split("|").length;for(var q,n=0;n<k;n++){this.$getNewContext("button");q=s.appendChild(this.$getLayoutNode("button"));q.setAttribute("button","button");a.call(this,q);}};this.addEventListener("DOMNodeRemovedFromDocument",function(n){for(var k in d){d[k].onclick=null;}});};apf.Teleport=function(){this.$init(true);};apf.__TELEPORT__=1<<28;(function(){this.$parsePrio="002";this.$regbase=this.$regbase|apf.__TELEPORT__;this.$booleanProperties.autoroute=true;this.$supportedProperties.push("url","timeout","protocol","route-server","autoroute");this.$propHandlers.url=function(c){var a=new apf.url(c);if(!a.protocol){throw new Error(apf.formatErrorString(0,this,"Communication (Teleport) initialization error","Invalid server url provided."));}this.$domain=a.host;this.$rootPath=a.path;this.$server=c.replace(new RegExp(this.$rootPath+"$"),"");};this.$propHandlers.timeout=function(a){this.timeout=parseInt(a)||10000;};this.$propHandlers.protocol=function(c){var a=c.toLowerCase();if(!apf[a]){throw new Error(apf.formatErrorString(1025,null,"Teleport baseclass","Could not find Ajax.org Teleport RPC Component '"+a+"'",this));}this.implement(apf[a]);};this.toString=function(){return"[Ajax.org Teleport Component : "+(this.name||"")+" ("+this.type+")]";};this.addEventListener("DOMNodeInsertedIntoDocument",function(){if(!apf.http){throw new Error(apf.formatErrorString(1024,null,"Teleport baseclass","Could not find Ajax.org Teleport HTTP Component",this.$aml));}this.implement(apf.http);if(this.id){apf.$asyncObjects[this.id]=1;}});}).call(apf.Teleport.prototype=new apf.AmlElement());apf.Init.run("teleport");apf.__INTERACTIVE__=1<<21;apf.Interactive=function(){var q,n,Y,W,c,L=null,X,Q,G,R,ag,u,M,aa,d,ac,a,B,i,F,P,O,Z,s=this,ab,V,U,J,S,A,g;this.$regbase=this.$regbase|apf.__INTERACTIVE__;this.$propHandlers.draggable=function(w){if(apf.isFalse(w)){this.draggable=w=false;}else{if(apf.isTrue(w)){this.draggable=w=true;}}var ah=this.oDrag||this.$ext;if(ah.interactive&1){return;}var t=ah.onmousedown;ah.onmousedown=function(aj,ai){if(!s.editable&&t&&t.apply(this,arguments)===false){return;}if(!ai&&(aj||event).button==2){return;}j.apply(this,arguments);};ah.interactive=(ah.interactive||0)+1;};this.$propHandlers.resizable=function(ah){if(apf.isFalse(ah)){this.resizable=ah=false;}else{if(apf.isTrue(ah)){this.resizable=ah=true;}}var ai=this.oResize||this.$ext;if(ai.interactive&2){return;}if(!s.editable){var t=ai.onmousedown;var w=ai.onmousemove;ai.onmousedown=function(){if(t&&t.apply(this,arguments)===false){return;}K.apply(this,arguments);};ai.onmousemove=function(){if(w&&w.apply(this,arguments)===false){return;}E.apply(this,arguments);};}ai.interactive=(ai.interactive||0)+2;i=this.$getOption&&parseInt(this.$getOption("Main","resize-border"))||3;F=this.$getOption&&parseInt(this.$getOption("Main","resize-corner"))||12;P=apf.getBox(apf.getStyle(this.$ext,apf.isIE?"borderWidth":"border-width"));};this.$cancelInteractive=function(){document.onmouseup(null,true);};function j(w,t){if(!w){w=event;}if(!t&&(!s.draggable||apf.dragMode)){return;}S=false;apf.dragMode=true;J=false;apf.popup.forceHide();ab="absolute|fixed".indexOf(apf.getStyle(s.$ext,"position"))>-1;if(!ab){s.$ext.style.position=ab?"absolute":"relative";}if(s.editable){ab=true;}if(ab&&!s.aData){apf.plane.show(S?oOutline:s.$ext);}var ah=ab?apf.getAbsolutePosition(s.$ext,s.$ext.offsetParent,true):[parseInt(apf.getStyle(s.$ext,"left"))||0,parseInt(apf.getStyle(s.$ext,"top"))||0];q=ah[0]-(V=w.clientX);n=ah[1]-(U=w.clientY);if(s.$ext.style.right){s.$ext.style.left=ah[0]+"px";s.$ext.style.right="";}if(s.$ext.style.bottom){s.$ext.style.top=ah[1]+"px";s.$ext.style.bottom="";}document.onmousemove=k;document.onmouseup=function(ak,ai){document.onmousemove=document.onmouseup=null;if(ab&&!s.aData){apf.plane.hide();}var aj=S?oOutline:s.$ext;if(J){if(ai){X=s.left;Q=s.top;r=s.right;b=s.bottom;M=s.width;aa=s.height;}if(s.setProperty){T();}else{if(S){s.$ext.style.left=X+"px";s.$ext.style.top=Q+"px";}}}X=Q=M=aa=null;if(!ab){s.$ext.style.position="relative";}if(s.showdragging){apf.setStyleClass(s.$ext,"",["dragging"]);}if(ab&&S){oOutline.style.display="none";}apf.dragMode=false;if(s.dispatchEvent){s.dispatchEvent("afterdrag",{htmlNode:aj});}};if(t){document.onmousemove(w);}else{if(apf.isIE){apf.window.$mousedown(w);}}return false;}function k(ai){if(!ai){ai=event;}if(!J&&s.showdragging){apf.setStyleClass(s.$ext,"dragging");}var w=ai.clientX-V,t=ai.clientY-U,ak;if(!J&&(ak=w*w>t*t?w:t)*ak<2){return;}else{if(!J){if(S&&oOutline.style.display!="block"){oOutline.style.display="block";}if(s.dispatchEvent&&s.dispatchEvent("beforedrag")===false){document.onmouseup();return;}}}var ah=S?oOutline:s.$ext;ah.style.left=(X=ai.clientX+q)+"px";ah.style.top=(Q=ai.clientY+n)+"px";if(s.realtime){var aj=s.$stick={};s.$showDrag(X,Q,ah,ai,aj);if(typeof aj.l!="undefined"){X=aj.l,ah.style.left=X+"px";}if(typeof aj.t!="undefined"){Q=aj.t,ah.style.top=Q+"px";}}J=true;}this.$resizeStart=K;function K(al,ai){if(!al){al=event;}if(!s.resizable||String(s.height).indexOf("%")>-1&&s.parentNode.localName=="vbox"||String(s.width).indexOf("%")>-1&&s.parentNode.localName=="hbox"){return;}A=false;if(!A){var ak=apf.getDiff(s.$ext);Z=ak[0];O=ak[1];}c=apf.getAbsolutePosition(s.$ext);c.push(s.$ext.offsetWidth);c.push(s.$ext.offsetHeight);g=apf.getAbsolutePosition(s.$ext,s.$ext.offsetParent,true);var ah=0,w=0,t=(V=al.clientX)-c[0]+ah+document.documentElement.scrollLeft,am=(U=al.clientY)-c[1]+w+document.documentElement.scrollTop,aj;if(ai&&ai.resizeType){ab="absolute|fixed".indexOf(apf.getStyle(s.$ext,"position"))>-1;aj=ai.resizeType;}else{aj=N.call(s.$ext,t,am);}Y=t;W=am;if(!aj){return;}if(s.dispatchEvent&&s.dispatchEvent("beforeresize",{type:aj,setType:function(an){aj=an;}})===false){if(apf.isIE){apf.window.$mousedown(al);}return;}apf.popup.forceHide();apf.dragMode=true;J=false;d=aj.indexOf("w")>-1;ac=aj.indexOf("n")>-1;a=aj.indexOf("e")>-1;B=aj.indexOf("s")>-1;if(!s.minwidth){s.minwidth=0;}if(!s.minheight){s.minheight=0;}if(!s.maxwidth){s.maxwidth=10000;}if(!s.maxheight){s.maxheight=10000;}if(ab){G=g[0]+c[2];R=g[1]+c[3];ag=g[0]+c[2];u=g[1]+c[3];document.title=R+":"+u;}if(ab){apf.plane.show(A?oOutline:s.$ext);}if(s.$ext.style.right){s.$ext.style.left=g[0]+"px";}if(s.$ext.style.bottom){s.$ext.style.top=g[1]+"px";}if(!ai||!ai.nocursor){if(L===null){L=document.body.style.cursor;}document.body.style.cursor=aj+"-resize";}document.onmousemove=C;document.onmouseup=function(ap,an){document.onmousemove=document.onmouseup=null;if(ab){apf.plane.hide();}clearTimeout(I);if(A){var ao=apf.getDiff(s.$ext);Z=ao[0];O=ao[1];}if(an){X=s.left;Q=s.top;r=s.right;b=s.bottom;M=s.width;aa=s.height;}else{ae(ap||event,true);}if(s.setProperty){T();}X=Q=M=aa=null;document.body.style.cursor=L;L=null;if(A){oOutline.style.display="none";}apf.dragMode=false;if(s.dispatchEvent){s.dispatchEvent("afterresize");}};if(apf.isIE){apf.window.$mousedown(al);}return false;}function T(ai,ak,w,ao,al,aj){if(typeof ai=="undefined"){ai=X,ak=Q,w=M,ao=aa,aj=O,al=Z;}var an=s.left||s.left===0;var ap=s.right||s.right===0;var t=s.bottom||s.bottom===0;var ah=s.top||s.top===0;if(ab){var am=oOutline.style.display=="block"?oOutline:s.$ext;if(ap){s.setProperty("right",apf.getHtmlRight(am),0,s.editable);if(!s.left){am.style.left="";}}if(t){s.setProperty("bottom",apf.getHtmlBottom(am),0,s.editable);if(!s.top){am.style.top="";}}if((ai||ai===0)&&(!ap||an)){s.setProperty("left",ai,0,s.editable);}if((ak||ak===0)&&(!t||ah)){s.setProperty("top",ak,0,s.editable);}}if(w&&(!an||!ap)){s.setProperty("width",w+al,0,s.editable);}if(ao&&(!s.top||!t)){s.setProperty("height",ao+aj,0,s.editable);}}this.$updateProperties=T;var ad=Math.min,D=Math.max,af,I;function C(t){if(!t){t=event;}clearTimeout(I);if(af&&new Date().getTime()-af<(A?6:apf.mouseEventBuffer)){var w={clientX:t.clientX,clientY:t.clientY};I=setTimeout(function(){ae(w);},10);return;}af=new Date().getTime();ae(t);}function ae(aj,ai){var ah=A&&!ai?oOutline:s.$ext;var w=document.documentElement.scrollLeft,t=document.documentElement.scrollTop;if(d){if(ab){ah.style.left=(X=D((ag-s.maxwidth),ad((G-s.minwidth),g[0]+aj.clientX-V+w)))+"px";}ah.style.width=(M=ad(s.maxwidth-Z,D(Z,s.minwidth,c[2]-(aj.clientX-V)+w)-Z))+"px";}if(ac){if(ab){ah.style.top=(Q=D((u-s.maxheight),ad((R-s.minheight),g[1]+aj.clientY-U+t)))+"px";}ah.style.height=(aa=ad(s.maxheight-O,D(O,s.minheight,c[3]-(aj.clientY-U)+t)-O))+"px";}if(a){ah.style.width=(M=ad(s.maxwidth-Z,D(Z,s.minwidth,aj.clientX-c[0]+(c[2]-Y)+w)-Z))+"px";}if(B){ah.style.height=(aa=ad(s.maxheight-O,D(O,s.minheight,aj.clientY-c[1]+(c[3]-W)+t)-O))+"px";}if(s.parentNode&&s.parentNode.localName=="table"){T();apf.layout.processQueue();}if(s.realtime){var ak=s.$stick={};s.$showResize(X||apf.getHtmlLeft(ah),Q||apf.getHtmlTop(ah),M&&M+Z||ah.offsetWidth,aa&&aa+O||ah.offsetHeight,aj,ak,d,ac,a,B);if(d&&typeof ak.l!="undefined"){ah.style.left=(X=D((ag-s.maxwidth),ad((G-s.minwidth),ak.l)))+"px";}if(ac&&typeof ak.t!="undefined"){ah.style.top=(Q=D((u-s.maxheight),ad((R-s.minheight),ak.t)))+"px";}if(typeof ak.w!="undefined"){ah.style.width=(M=ad(s.maxwidth-Z,D(Z,s.minwidth,ak.w)-Z))+"px";}if(typeof ak.h!="undefined"){ah.style.height=(aa=ad(s.maxheight-O,D(O,s.minheight,ak.h)-O))+"px";}}if(apf.hasSingleRszEvent){apf.layout.forceResize(s.$int);}}function N(t,ai){var ah="",w="";ab="absolute|fixed".indexOf(apf.getStyle(s.$ext,"position"))>-1;if(s.resizable==true||s.resizable=="vertical"){if(ai<i+P[0]){ah=ab?"n":"";}else{if(ai>this.offsetHeight-i){ah="s";}else{if(ai>this.offsetHeight-F){w="s";}}}}if(s.resizable==true||s.resizable=="horizontal"){if(t<(ah?F:i)+P[0]){ah+=w+(ab?"w":"");}else{if(t>this.offsetWidth-(ah||w?F:i)){ah+=w+"e";}}}return ah;}var H;function E(ai){if(!ai){ai=event;}if(!s.resizable||s.editable||document.onmousemove){return;}var al=apf.getAbsolutePosition(s.$ext),ah=0,w=0,t=ai.clientX-al[0]+ah+document.documentElement.scrollLeft,ak=ai.clientY-al[1]+w+document.documentElement.scrollTop;if(!H){H=apf.getStyle(this,"cursor");}var aj=N.call(s.$ext,t,ak);this.style.cursor=aj?aj+"-resize":H||"default";}};apf.GuiElement.propHandlers.resizable=function(a){this.implement(apf.Interactive);this.$propHandlers.resizable.apply(this,arguments);};apf.GuiElement.propHandlers.draggable=function(a){this.implement(apf.Interactive);this.$propHandlers.draggable.apply(this,arguments);};apf.__DELAYEDRENDER__=1<<11;apf.DelayedRender=function(){this.$regbase=this.$regbase|apf.__DELAYEDRENDER__;this.$rendered=false;this.$render=function(c){if(this.$rendered){return;}if(this.dispatchEvent("beforerender")===false){return;}if(this["render-delay"]||c){$setTimeout("apf.lookup("+this.$uniqueId+").$renderparse()",10);}else{this.$renderparse();}};this.$renderparse=function(){if(this.$rendered){return;}var c=this.ownerDocument.$domParser;c.parseFromXml(this.$aml,{amlNode:this,doc:this.ownerDocument,delayedRender:true});c.$continueParsing(this);this.$rendered=true;this.dispatchEvent("afterrender");};var a;this.addEventListener("prop.visible",a=function(){if(arguments[0].value){this.$render();this.removeEventListener("prop.visible",a);}});};apf.GuiElement.propHandlers.render=function(a){if(!this.hasFeature(apf.__DELAYEDRENDER__)&&a=="runtime"){this.implement(apf.DelayedRender);if(this.localName!="page"){this.visible=false;this.$ext.style.display="none";}if(typeof this["render-delay"]=="undefined"){this.$setInheritedAttribute("render-delay");}}};apf.config.$inheritProperties["render-delay"]=1;apf.__DRAGDROP__=1<<5;apf.__MULTICHECK__=1<<22;apf.window=function(){this.$uniqueId=apf.all.push(this);this.apf=apf;this.toString=function(){return"[apf.window]";};this.getActionTracker=function(){return this.$at;};this.loadCodeFile=function(D){if(self[D]){apf.importClass(self[D],true,this.win);}else{apf.include(D);}};this.show=function(){if(apf.isDeskrun){j.Show();}};this.hide=function(){if(apf.isDeskrun){j.Hide();}else{this.loaded=false;if(this.win){this.win.close();}}};this.focus=function(){if(apf.isDeskrun){j.SetFocus();}else{window.focus();}};this.setIcon=function(D){if(apf.isDeskrun){j.icon=parseInt(D)==D?parseInt(D):D;}};this.setTitle=function(D){this.title=D||"";if(apf.isDeskrun){j.caption=D;}else{document.title=(D||"");}};this.loadAml=function(D){if(D[apf.TAGNAME]=="deskrun"){this.loadDeskRun(D);}};var j=apf.isDeskrun?window.external:null,t=apf.isDeskrun?j.shell:null;this.loadDeskRun=function(I){j.style=I.getAttribute("style")||"ismain|taskbar|btn-close|btn-max|btn-min|resizable";apf.config.drRegName=I.getAttribute("record");if(I.getAttribute("minwidth")){j.setMin(I.getAttribute("minwidth"),I.getAttribute("minheight"));}if(I.getAttribute("record")&&t.RegGet(apf.config.drRegName+"/window")){var H=t.RegGet(apf.config.drRegName+"/window");if(H){H=H.split(",");window.external.width=Math.max(I.getAttribute("minwidth"),Math.min(parseInt(H[2]),window.external.shell.GetSysValue("deskwidth")));window.external.height=Math.max(I.getAttribute("minheight"),Math.min(parseInt(H[3]),window.external.shell.GetSysValue("deskheight")));window.external.left=Math.max(0,Math.min(parseInt(H[0]),screen.width-window.external.width));window.external.top=Math.max(0,Math.min(parseInt(H[1]),screen.height-window.external.height));}}else{j.left=I.getAttribute("left")||200;j.top=I.getAttribute("top")||200;j.width=I.getAttribute("width")||800;j.height=I.getAttribute("height")||600;}j.caption=I.getAttribute("caption")||"DeskRun";j.icon=I.getAttribute("icon")||100;var F=$xmlns(I,"context",apf.ns.aml);if(F.length){F=F[0];if(!apf.config.tray){apf.config.tray=window.external.CreateWidget("trayicon");}var G=apf.config.tray;G.icon=I.getAttribute("tray")||100;G.tip=I.getAttribute("tooltip")||"DeskRun";G.PopupClear();G.PopupItemAdd("Exit",3);G.PopupItemAdd("SEP",function(){});var D=F.childNodes;for(var E=D.length-1;E>=0;E--){if(D[E].nodeType!=1){continue;}if(D[E][apf.TAGNAME]=="divider"){G.PopupItemAdd("SEP",function(){});}else{G.PopupItemAdd(apf.queryValue(D[E],"."),D[E].getAttribute("href")?new Function("window.open('"+D[E].getAttribute("href")+"')"):new Function(D[E].getAttribute("onclick")));}}}j.shell.debug=apf.debug?7:0;j.Show();j.SetFocus();};this.$tabList=[];this.$addFocus=function(E,F,D){if(!D){E.addEventListener("DOMNodeInserted",C);E.addEventListener("DOMNodeRemoved",q);if(E.$isWindowContainer>-2){E.addEventListener("focus",B);E.addEventListener("blur",B);E.$focusParent=E;if(E.$isWindowContainer>-1){if(!E.$tabList){E.$tabList=[E];}this.$tabList.push(E);return;}else{E.$tabList=[E];}}}var G=w(E),H=G.$tabList;if(H[F]){apf.console.warn("Aml node already exist for tabindex "+F+". Will insert "+E.tagName+" ["+(E.name||"")+"] before existing one");}if(!E.$isWindowContainer){E.$focusParent=G;}if(H[F]){H.insertIndex(E,F);}else{H.push(E);}};this.$removeFocus=function(D){if(!D.$focusParent){return;}D.$focusParent.$tabList.remove(D);if(!D.$isWindowContainer){D.removeEventListener("DOMNodeInserted",C);D.removeEventListener("DOMNodeRemoved",q);}if(D.$isWindowContainer>-2){D.removeEventListener("focus",B);D.removeEventListener("blur",B);}};var a;this.$focus=function(E,H,G){var D=this.document.activeElement;if(D==E&&!G){return;}var F=D==E;this.$settingFocus=E;if(!H){H={};}if(D&&D!=E&&a!=D){a=D;H.toElement=E;H.fromElement=D;D.blur(true,H);if(a!=D){return false;}}(apf.activeElement=this.document.activeElement=E).focus(true,H);this.$settingFocus=null;apf.dispatchEvent("movefocus",{toElement:E});if(!F){apf.console.info("Focus given to "+E.localName+" ["+(E.name||"")+"]");}};this.$blur=function(E){var D=this.document.activeElement;if(D!=E){return false;}apf.console.info(D.localName+" ["+(D.name||"")+"] was blurred.");D.$focusParent.$lastFocussed=null;apf.activeElement=this.document.activeElement=null;apf.dispatchEvent("movefocus",{fromElement:E});};var n;this.$focusDefault=function(D,F){var E=w(D);this.$focusLast(E,F);};this.$focusRoot=function(D){var E=apf.document.documentElement;if(this.$focusLast(E,D)===false){}};this.$focusLast=function(F,J,E){var D=F.$lastFocussed;if(D&&D.parentNode&&D.$focussable===true&&(E||D.$ext.offsetHeight)){this.$focus(D,J,true);}else{var G,I=F,H;while(I){if(!H&&I.focussable!==false&&I.$focussable===true&&!I.$tabList&&(E||I.$ext.offsetHeight)&&!I.disabled){this.$focus(I,J,true);break;}if((G=!H&&I.firstChild||!(H=false)&&I.nextSibling)){I=G;if(I.$isWindowContainer>0){H=true;}}else{if(I==F){if(I.$isWindowContainer){this.$focus(I,J,true);}return;}else{do{I=I.parentNode;}while(I&&!I.nextSibling&&I!=F&&!I.$isWindowContainer);if(I==F){return;}if(I){if(I.$isWindowContainer){this.$focus(I,J,true);break;}I=I.nextSibling;}}}}if(!I){this.$focus(apf.document.documentElement);}}};function B(D){if(D.name=="blur"){if(D.srcElement!=this&&this.$blur){this.$blur();}return;}if(D.srcElement!=this&&this.$focus){this.$focus();}if(D.srcElement==this||D.trackedChild){D.trackedChild=true;return;}this.$lastFocussed=D.srcElement;if(this.localName.indexOf("window")>-1){D.trackedChild=true;}}function w(D){var E=D;do{E=E.parentNode;}while(E&&!E.$isWindowContainer);return E||apf.document.documentElement;}function C(D){if(D&&D.currentTarget!=this){return;}if(this.$isWindowContainer){apf.window.$tabList.pushUnique(this);}else{apf.window.$addFocus(this,this.tabindex,true);}}function q(D){if(D&&(D.currentTarget!=this||D.$doOnlyAdmin)){return;}if(apf.document.activeElement==this){apf.window.moveNext();}if(this.$isWindowContainer){apf.window.$tabList.remove(this);return;}if(!this.$focusParent){return;}this.$focusParent.$tabList.remove(this);}this.hasFocus=function(D){return this.document.activeElement==D;};this.moveNext=function(N,G,D,M){if(D&&apf.document.activeElement){var F=apf.document.activeElement.$focusParent;if(F.visible&&F.modal){return false;}}var I,E,K,H=G||apf.document.activeElement,J=H?(D&&H.$isWindowContainer>0?apf.window:H.$focusParent):apf.document.documentElement,L=J.$tabList;if(H&&(D||H!=apf.document.documentElement)){E=(L||[]).indexOf(H);if(E==-1){apf.console.warn("Moving focus from element which isn't in the list                                  of it's parent. This should never happen.");return;}}else{E=-1;}if(this.document.activeElement&&this.document.activeElement==H&&L.length==1||L.length==0){return false;}I=(N?-1:1);K=E;if(E<0){E=0;}do{K+=I;if(K>=L.length){K=0;}else{if(K<0){K=L.length-1;}}if(E==K&&H){if(L[0].$isWindowContainer){this.$focus(L[0],M);}return false;}H=L[K];}while(!H||H.disabled||H==apf.document.activeElement||(D?!H.visible:H.$ext&&!H.$ext.offsetHeight)||H.focussable===false||D&&!H.$tabList.length);if(J==apf.window){this.$focusLast(H,{mouse:true},D);}else{(M||(M={})).shiftKey=N;this.$focus(H,M);}};this.focusDefault=function(){if(this.moveNext()===false){this.moveNext(null,apf.document.documentElement,true);}};apf.addListener(window,"beforeunload",function(){return apf.dispatchEvent("exit");});apf.addListener(window,"unload",function(){if(!apf){return;}apf.window.isExiting=true;apf.window.destroy();});var g,d="",u="";this.$focusfix=function(){if(apf.isIphone){return;}d+="a";clearTimeout(g);$setTimeout("window.focus();");g=$setTimeout(c);};this.$focusfix2=function(){if(apf.isIphone){return;}d+="b";clearTimeout(g);g=$setTimeout(c);};this.$blurfix=function(){if(apf.isIphone){return;}d+="c";clearTimeout(g);g=$setTimeout(c);};function c(){clearTimeout(g);if(d=="e"||d=="c"||d.charAt(0)=="x"&&!d.match(/eb$/)||d=="ce"||d=="de"){if(u!="blur"){u="blur";apf.window.dispatchEvent("blur");}}else{if(u!="focus"){u="focus";apf.window.dispatchEvent("focus");}}d="";g=null;}apf.addListener(window,"focus",this.$focusevent=function(){if(apf.isIphone){return apf.window.dispatchEvent("focus");}if(apf.hasFocusBug){d+="d";clearTimeout(g);g=$setTimeout(c);}else{clearTimeout(A);i.newState="focus";A=$setTimeout(i,10);}});apf.addListener(window,"blur",this.$blurevent=function(){if(!apf){return;}if(apf.isIphone){return apf.window.dispatchEvent("blur");}if(apf.hasFocusBug){d+="e";clearTimeout(g);g=$setTimeout(c);}else{clearTimeout(A);i.newState="blur";A=$setTimeout(i,10);}});var A;function i(){clearTimeout(A);var D=i.newState;if(u==D){return;}u=D;apf.dispatchEvent(u);}this.hasFocus=function(){return(u=="focus");};apf.addListener(document,"contextmenu",function(F){if(!F){F=event;}var G,E,D=apf.findHost(F.srcElement||F.target)||apf.document.activeElement||apf.document&&apf.document.documentElement;if(D&&D.localName=="menu"){return false;}if(apf.contextMenuKeyboard){if(D){G=D.selected?apf.getAbsolutePosition(D.$selected):apf.getAbsolutePosition(D.$ext||D.$pHtmlNode);}else{G=[0,0];}E={x:G[0]+10+document.documentElement.scrollLeft,y:G[1]+10+document.documentElement.scrollTop,htmlEvent:F};}else{if(F.htmlEvent){E=F;}else{E={x:F.clientX+document.documentElement.scrollLeft,y:F.clientY+document.documentElement.scrollTop,htmlEvent:F};}}E.bubbles=true;apf.contextMenuKeyboard=null;if((D||apf).dispatchEvent("contextmenu",E)===false||E.returnValue===false){if(F.preventDefault){F.preventDefault();}return false;}if(apf.config.disableRightClick){if(F.preventDefault){F.preventDefault();}return false;}});var k={INPUT:1,TEXTAREA:1,SELECT:1};apf.addListener(document,"mousedown",this.$mousedown=function(I){I=I||window.event;var H,F=apf.findHost(I.srcElement||I.target),E=F&&F.$editable;if(apf.popup.last&&(!F||apf.popup.last!=F.$uniqueId)){apf.popup.forceHide();}if((!F||!F.$focussable||F.focussable===false)&&apf.config.allowBlur&&F.canHaveChildren!=2){n=null;if(apf.document.activeElement){apf.document.activeElement.blur();}}else{if(F){if((H=apf.document.activeElement&&apf.document.activeElement.$focusParent||n)&&H.visible&&H.modal&&F.$focusParent!=H){apf.window.$focusLast(H,{mouse:true,ctrlKey:I.ctrlKey});}else{if(!F&&apf.document.activeElement){apf.window.$focusRoot();}else{if(F.$isWindowContainer==-1){if(F.$tabList.length){apf.window.moveNext(null,F.$tabList[0],null,{mouse:true});}else{apf.window.$focus(F);}}else{if(!F.disabled&&F.focussable!==false){if(F.$focussable===apf.KEYBOARD_MOUSE){apf.window.$focus(F,{mouse:true,ctrlKey:I.ctrlKey});}else{if(F.canHaveChildren==2){if(!apf.config.allowBlur||!apf.document.activeElement||apf.document.activeElement.$focusParent!=F){apf.window.$focusLast(F,{mouse:true,ctrlKey:I.ctrlKey});}}else{apf.window.$focusDefault(F,{mouse:true,ctrlKey:I.ctrlKey});}}}else{apf.window.$focusDefault(F,{mouse:true,ctrlKey:I.ctrlKey});}}}}if(apf.hasFocusBug){var D=k[(I.srcElement||I.target).tagName]&&!(I.srcElement||I.target).disabled||(I.srcElement&&I.srcElement.isContentEditable)||F.$isContentEditable&&F.$isContentEditable(I)&&!F.disabled;if(!F||!D){apf.window.$focusfix();}}else{if(!u){apf.window.$focusevent();}}}}apf.dispatchEvent("mousedown",{htmlEvent:I,amlNode:F||apf.document.documentElement});if(apf.isIE||apf.isIphone){return;}var G=!((!apf.document&&(!apf.isParsingPartial||F)||apf.dragMode)&&!k[I.target.tagName]);if(G){F=apf.findHost(I.target);if(F){var D=k[(I.srcElement||I.target).tagName]&&!(I.srcElement||I.target).disabled||(I.srcElement&&I.srcElement.isContentEditable)||F.$isContentEditable&&F.$isContentEditable(I)&&!F.disabled;if(!D&&!apf.config.allowSelect&&F.nodeType!=F.NODE_PROCESSING_INSTRUCTION&&!F.$allowSelect&&!F.$int){G=false;}}}if(!G&&!E){if(I.preventDefault){I.preventDefault();}return false;}});apf.addListener(document,"selectstart",function(F){if(!F){F=event;}var E=!(!apf.document||apf.dragMode);var D=apf.findHost(F.srcElement);if(E){if(!apf.config.allowSelect&&D&&D.nodeType!=D.NODE_PROCESSING_INSTRUCTION&&!D.$allowSelect&&!D.$int){E=false;}}if(!E){F.returnValue=false;return false;}});apf.addListener(document,"keyup",this.$keyup=function(D){if(!D){D=event;}if(apf.document&&apf.document.activeElement&&!apf.document.activeElement.disableKeyboard&&apf.document.activeElement.dispatchEvent("keyup",{keyCode:D.keyCode,ctrlKey:D.ctrlKey,shiftKey:D.shiftKey,altKey:D.altkey,htmlEvent:D})===false){D.returnValue=false;return false;}apf.dispatchEvent("keyup",null,D);});function s(H){if(!H){H=event;}var J=null;if(H.wheelDelta){J=H.wheelDelta/120;if(apf.isOpera){J*=-1;}}else{if(H.detail){J=-H.detail/3;}}if(J!==null){if(apf.isIE){var F=H.srcElement||H.target;while(F&&F.scrollHeight<=F.offsetHeight){F=F.parentNode;}if(!F){return;}if(F.nodeType==9){F=F.documentElement;}if(F&&F.tagName=="BODY"&&"auto|scroll".indexOf(apf.getStyle(F,"overflowY"))==-1){F=document.documentElement;}if(F&&"auto|scroll".indexOf(apf.getStyle(F,"overflowY"))>-1){var D,I=0.35*F.offsetHeight*J;if(J<0){if(F&&F.scrollTop>=(D=F.scrollHeight-F.offsetHeight+apf.getVerBorders(F))+I){F.scrollTop=D;H.returnValue=false;}}else{if(F&&F.scrollTop<=I){F.scrollTop=0;H.returnValue=false;}}}}var G={delta:J,target:H.target||H.srcElement,button:H.button,ctrlKey:H.ctrlKey,shiftKey:H.shiftKey,altKey:H.altKey},E=apf.dispatchEvent("mousescroll",G);if(E===false||G.returnValue===false){if(H.preventDefault){H.preventDefault();}H.returnValue=false;}}}if(document.addEventListener){document.addEventListener("DOMMouseScroll",s,false);}window.onmousewheel=document.onmousewheel=s;apf.addListener(document,"keydown",this.$keydown=function(I){I=I||event;if(I.keyCode==120||I.ctrlKey&&I.altKey&&I.keyCode==68){apf.$debugwin.activate();}if(I.keyCode==93){apf.contextMenuKeyboard=true;}var F=apf.findHost(I.srcElement||I.target),E=k[(I.explicitOriginalTarget||I.srcElement||I.target).tagName]||(I.srcElement&&I.srcElement.isContentEditable);var K,J=apf.isMac?I.metaKey:I.ctrlKey;if(!E&&apf.config.undokeys&&J){if(I.keyCode==90){K=apf.document.activeElement;while(K&&!K.getActionTracker&&!K.$at){K=K.parentNode;}if(!K){K=apf.window;}(K.$at||K.getActionTracker()).undo();}else{if(I.keyCode==89){K=apf.document.activeElement;while(K&&!K.getActionTracker&&!K.$at){K=K.parentNode;}if(!K){K=apf.window;}(K.$at||K.getActionTracker()).redo();}}}var G={ctrlKey:I.ctrlKey,metaKey:I.metaKey,shiftKey:I.shiftKey,altKey:I.altKey,keyCode:I.keyCode,htmlEvent:I,bubbles:true};if(!E&&apf.dispatchEvent("hotkey",G)===false||G.returnValue===false){I.returnValue=false;I.cancelBubble=true;if(I.stopPropagation){I.stopPropagation();}if(apf.canDisableKeyCodes){try{I.keyCode=0;}catch(I){}}if(I.preventDefault){I.preventDefault();}return false;}delete G.currentTarget;if((apf.document.activeElement&&!apf.document.activeElement.disableKeyboard&&!apf.document.activeElement.editable&&apf.document.activeElement.dispatchEvent("keydown",G)||apf.dispatchEvent("keydown",G))===false){I.returnValue=false;I.cancelBubble=true;if(apf.canDisableKeyCodes){try{I.keyCode=0;}catch(I){}}if(I.preventDefault){I.preventDefault();}return false;}else{if((!apf.config.disableTabbing||apf.document.activeElement)&&I.keyCode==9){if(I.ctrlKey&&apf.document.activeElement){var D=apf.document.activeElement.$focusParent;if(D.modal){if(I.preventDefault){I.preventDefault();}return false;}apf.window.moveNext(I.shiftKey,apf.document.activeElement.$focusParent,true);D=apf.document.activeElement.$focusParent;if(D&&D.bringToFront){D.bringToFront();}}else{if(!apf.document.activeElement||apf.document.activeElement.tagName!="menu"){apf.window.moveNext(I.shiftKey);}}if(I.preventDefault){I.preventDefault();}return false;}}var H=apf.isMac?I.metaKey:I.altKey;if(apf.config.disableBackspace&&I.keyCode==8&&!E){if(apf.canDisableKeyCodes){try{I.keyCode=0;}catch(I){}}I.returnValue=false;}if(apf.config.disableF5&&(I.keyCode==116||I.keyCode==117)){if(apf.canDisableKeyCodes){try{I.keyCode=0;}catch(I){}}else{I.preventDefault();I.stopPropagation();}}if(I.keyCode==27){I.returnValue=false;}if(!apf.config.allowSelect&&I.shiftKey&&(I.keyCode>32&&I.keyCode<41)&&!E){I.returnValue=false;}if(I.returnValue===false&&I.preventDefault){I.preventDefault();}return I.returnValue;});apf.document={};this.init=function(D){if(apf.actiontracker){this.$at=new apf.actiontracker();this.$at.name="default";apf.nameserver.register("actiontracker","default",this.$at);}apf.console.info("Start parsing main application");apf.Latometer.start();this.$domParser=new apf.DOMParser();this.document=apf.document=this.$domParser.parseFromString(D,"text/xml",{timeout:apf.config.initdelay,callback:function(F){if(apf.parsed!=2){var E=apf.parsed;apf.parsed=2;apf.dispatchEvent("parse",{initial:E});apf.parsed=true;}if(!apf.loaded){if(apf.isDeskrun){apf.window.deskrun.Show();}if(!apf.document.activeElement&&!apf.config.allowBlur){apf.window.focusDefault();}apf.loaded=true;$setTimeout(function(){apf.dispatchEvent("load");});}apf.console.info("Initialization finished");apf.Latometer.end();apf.Latometer.addPoint("Total load time");apf.Latometer.start(true);}});this.addEventListener("focus",function(E){if(!apf.document.activeElement&&n&&!apf.isIphone){if(n.$isWindowContainer==-1){if(n.$tabList.length){apf.window.moveNext(null,n.$tabList[0]);}else{apf.window.$focus(n);}}else{apf.window.$focusLast(n);}}});this.addEventListener("blur",function(E){if(!apf.document.activeElement||apf.isIphone){return;}apf.document.activeElement.blur(true,{srcElement:this});n=apf.document.activeElement.$focusParent;apf.activeElement=apf.document.activeElement=null;});};this.destroy=function(){this.$at=null;apf.unload(this);apf=this.win=this.window=this.document=null;window.onfocus=window.onerror=window.onunload=window.onbeforeunload=window.onbeforeprint=window.onafterprint=window.onmousewheel=window.onblur=null;document.oncontextmenu=document.onmousedown=document.onmousemove=document.onmouseup=document.onselectstart=document.onmousewheel=document.onkeyup=document.onkeydown=null;if(document.body){document.body.onmousedown=document.body.onmousemove=document.body.onmouseup=null;document.body.innerHTML="";}};};apf.window.prototype=new apf.Class().$init();apf.window=new apf.window();apf.sanitizeTextbox=function(a){a.onfocus=function(){if(apf.window){apf.window.$focusfix2();}};a.onblur=function(){if(apf.window){apf.window.$blurfix();}};};apf.runGecko=function(){if(apf.runNonIe){apf.runNonIe();}HTMLDocument.prototype.selectNodes=XMLDocument.prototype.selectNodes=function(g,d){try{var q=this.evaluate(g,(d||this),this.createNSResolver(this.documentElement),7,null);}catch(n){var s=n.message;if(n.code==n.INVALID_EXPRESSION_ERR){s=s.replace(/the expression/i,"'"+g+"'");}throw new c(n.lineNumber,"XPath error: "+s);}var j=new Array(q.snapshotLength);j.expr=g;for(var k=j.length-1;k>=0;k--){j[k]=q.snapshotItem(k);}return j;};Text.prototype.selectNodes=Element.prototype.selectNodes=function(d){return this.ownerDocument.selectNodes(d,this);};HTMLDocument.prototype.selectSingleNode=XMLDocument.prototype.selectSingleNode=function(g,d){var i=this.selectNodes(g+"[1]",d||null);return i[0]||null;};Text.prototype.selectSingleNode=Element.prototype.selectSingleNode=function(d){return this.ownerDocument.selectSingleNode(d,this);};var a=new XMLSerializer();apf.insertHtmlNodes=function(j,q,g){var s=document.createElement("div"),t=document.createDocumentFragment(),k=j.length-1,d,n;for(;k>=0;k--){n=j[k];t.insertBefore(n,t.firstChild);}s.innerHTML=apf.html_entity_decode(a.serializeToString(t)).replace(/<([^>]+)\/>/g,"<$1></$1>");t=document.createDocumentFragment();for(k=0,d=s.childNodes.length;k<d;k++){n=s.childNodes[0];t.appendChild(n);}if(g){q.insertBefore(t,g);}q.appendChild(t);};apf.insertHtmlNode=function(g,j,d,i){if(j.nodeType!=11&&!j.style){return j.appendChild(g);}var k=document.createElement("div");if(!i){i=apf.html_entity_decode(g.serialize?g.serialize(true):((g.nodeType==3||g.nodeType==4||g.nodeType==2)?g.nodeValue:a.serializeToString(g)));}k.innerHTML=i.replace(/<([^>]+)\/>/g,"<$1></$1>");if(d){j.insertBefore(k.firstChild,d);}j.appendChild(k.firstChild);return d?d.previousSibling:j.lastChild;};function c(d,g){if(!apf.$debugwin.nativedebug){apf.$debugwin.errorHandler(g,"",0);}this.message=g;this.nr=d;}apf.getHtmlLeft=function(d){return(d.offsetLeft+(parseInt(apf.getStyle(d.parentNode,"border-left-width"))||0));};apf.getHtmlRight=function(d){var g;return(((g=d.offsetParent).tagName=="BODY"?apf.getWindowWidth():g.offsetWidth)-d.offsetLeft-d.offsetWidth-(2*(parseInt(apf.getStyle(g,"border-left-width"))||0))-(parseInt(apf.getStyle(g,"border-right-width"))||0));};apf.getHtmlTop=function(d){return(d.offsetTop+(parseInt(apf.getStyle(d.parentNode,"border-top-width"))||0));};apf.getHtmlBottom=function(d){var g;return(((g=d.offsetParent).tagName=="BODY"?apf.getWindowHeight():g.offsetHeight)-d.offsetTop-d.offsetHeight-(2*(parseInt(apf.getStyle(g,"border-top-width"))||0))-(parseInt(apf.getStyle(g,"border-bottom-width"))||0));};apf.getBorderOffset=function(d){return[-1*(parseInt(apf.getStyle(d,"border-left-width"))||0),-1*(parseInt(apf.getStyle(d,"border-top-width"))||0)];};};apf.initGears=function(){var a,c;var g=apf.nameserver.get("google","gears");if(g){return g;}if(typeof GearsFactory!="undefined"){a=new GearsFactory();}else{if(apf.isIE){try{a=new ActiveXObject("Gears.Factory");}catch(d){}}else{if(navigator.mimeTypes["application/x-googlegears"]){a=document.createElement("object");a.setAttribute("type","application/x-googlegears");a.setAttribute("width",0);a.setAttribute("height",0);a.style.display="none";document.documentElement.appendChild(a);}}}if(!a){return null;}return apf.nameserver.register("google","gears",a);};apf.runIphone=function(){if(!apf.isIphone){return;}$setTimeout(function(){apf.importCssString('html, body {                margin: 0;                font-family: Helvetica;                background: #fff;                color: #000000;                overflow-x: hidden;                -webkit-user-select: none;                -webkit-text-size-adjust: none;                -webkit-touch-callout: none;            }            body > *:not(.toolbar) {                min-height: 372px;            }            body[orient="landscape"] > *:not(.toolbar) {                min-height: 268px;            }            body > *[selected="true"] {                display: block;            }',"screen");var q=document.getElementsByTagName("head")[0];if(apf.config.iphoneIcon){var s=document.createElement("link");s.setAttribute("rel","apple-touch-icon"+(apf.config.iphoneIconIsGlossy?"":"-precomposed"));s.setAttribute("href","apf.config.iphoneIcon");q.appendChild(s);}function t(u,w){var A=document.createElement("meta");A.setAttribute("name",u);A.setAttribute("content",w);q.appendChild(A);}if(apf.config.iphoneFixedViewport){t("viewport","width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0;");}if(apf.config.iphoneFullScreen){t("apple-mobile-web-app-capable","yes");if(apf.config.iphoneStatusBar){t("apple-mobile-web-app-status-bar-style","apf.config.iphoneStatusBar");}}});var a=false,d=0,j="portrait",g="landscape",i=null;apf.addDomLoadEvent(function(){$setTimeout(c,0);i=setInterval(c,300);});function n(){switch(window.orientation){case 0:k(j);break;case 90:case -90:k(g);break;}}if(typeof window.onorientationchange=="object"){window.onorientationchange=n;a=true;$setTimeout(n,0);}function c(){if(!a){if(window.innerWidth!=d){d=window.innerWidth;var q=d==320?j:g;k(q);}}}function k(q){document.body.setAttribute("orient",q);$setTimeout("scrollTo(0,1)",100);}["gesturestart","gesturechange","gestureend","orientationchange"].forEach(function(q){document["on"+q]=function(s){if(apf.dispatchEvent){apf.dispatchEvent(q,s);}};});apf.iphone={titleNode:null,linkEvents:function(t,s){return;t[s?"onclick":"ontouchstart"]=function(u){if(!u.touches||u.touches.length!=1){return;}var w=u.touches[0];if(typeof this.onmousedown=="function"){this.onmousedown(w);if(this!=document){return false;}}};t.ontouchmove=function(u){if(!u.touches||u.touches.length!=1){return;}var w=u.touches[0];if(typeof this.onmousemove=="function"){this.onmousemove(w);if(this!=document){return false;}}};var q=false;t.ontouchend=t.ontouchcancel=function(u){if(q){return;}var w=u.touches&&u.touches.length?u.touches[0]:u.changedTouches[0];if(!w){return;}q=true;$setTimeout(function(){q=false;});if(typeof this.onmouseup=="function"){this.onmouseup(w);if(this!=document){return false;}}};return this;},nav:{sections:null,active:null,def:"home",divideChar:"/",levelTwoChar:"-",go:function(B,w){var A,s,C=apf.iphone.nav;C.update();if(!(s=C.sections[B.page])){return;}scrollTo(0,1);apf.dispatchEvent("pagechange",B);var E=s.getAttribute("title");if(apf.iphone.titleNode&&E){apf.iphone.titleNode.innerHTML=E;}if(w){for(A in C.sections){C.sections[A].hide();}s.show();}else{for(A in C.sections){if(!C.sections[A].visible||A==B.page){continue;}var D=C.sections[A];D.setProperty("zindex",0);apf.tween.single(D.$ext,{steps:5,interval:10,from:D.$ext.offsetLeft,to:(B.index<0)?1000:-1000,type:"left",anim:apf.tween.EASEOUT,onfinish:function(){D.setProperty("visible",false);}});}var u=10,t=s.$ext,q=(B.index<0)?-(t.offsetWidth)-u:window.innerWidth+t.offsetLeft+u;s.setProperty("visible",true);s.setProperty("zindex",apf.all.length+1);apf.tween.single(t,{steps:5,interval:10,from:q,to:0,type:"left",anim:apf.tween.EASEIN});}},update:function(s){if(this.sections&&!s){return;}this.sections={};for(var q in window){if(window[q]&&window[q]["tagName"]&&window[q].tagName=="section"){this.sections[q]=window[q];}}}}};$setTimeout(function(){apf.addEventListener("hashchange",apf.iphone.nav.go);if(location.href.match(/#(.*)$/)){apf.history.init(decodeURI(RegExp.$1));}else{if(apf._GET.page){apf.history.init(apf._GET.page);}else{apf.history.init();}}});document.ontouchstart=function(q){if(!q.touches||q.touches.length!=1){return;}var u=q.touches[0],t=u.target,s=apf.findHost(u.target);if(!s){return;}while(typeof t.onmousedown!="function"&&t!=document.body){t=t.parentNode;}if(typeof t.onmousedown=="function"){if(typeof t.onmouseover=="function"){t.onmouseover(u);}else{if(typeof t.onmousemove=="function"){t.onmousemove(u);}}t.onmousedown(u);return false;}};document.ontouchmove=function(q){if(!q.touches||q.touches.length!=1){return;}var u=q.touches[0],t=u.target,s=apf.findHost(u.target);if(!s){return;}while(typeof t.onmousemove!="function"&&t!=document.body){t=t.parentNode;}if(typeof t.onmousemove=="function"){t.onmousemove(u);return false;}else{if(typeof document.onmousemove=="function"){return document.onmousemove(u);}}};document.ontouchend=document.ontouchcancel=function(q){var u=q.touches&&q.touches.length?q.touches[0]:q.changedTouches[0];if(!u){return;}var t=u.target,s=apf.findHost(u.target);if(!s){return;}while(typeof t.onmouseup!="function"&&t!=document.body){t=t.parentNode;}if(typeof t.onmouseup=="function"){if(typeof t.onmouseout=="function"){t.onmouseout(u);}t.onmouseup(u,true);return false;}else{if(typeof document.onmouseup=="function"){return document.onmouseup(u);}}};};apf.runIE=function(){var a=false,d=false;if(self.XMLHttpRequest){try{new XMLHttpRequest();}catch(c){a=true;}}try{new ActiveXObject("microsoft.XMLHTTP");}catch(c){d=true;}if(d){apf.importClass(runTpIframe,true,self);}apf.getHttpReq=d?function(){if(apf.availHTTP.length){return apf.availHTTP.pop();}return new XMLHttpRequest();}:function(){if(apf.availHTTP.length){return apf.availHTTP.pop();}return new ActiveXObject("microsoft.XMLHTTP");};apf.getXmlDom=d?function(j,g){var i=getDOMParser(j,g);return i;}:function(k,g,j){var i=new ActiveXObject("microsoft.XMLDOM");i.setProperty("SelectionLanguage","XPath");if(j){i.preserveWhiteSpace=true;}if(k){if(apf.cantParseXmlDefinition){k=k.replace(/\] \]/g,"] ]").replace(/^<\?[^>]*\?>/,"");}i.loadXML(k);if(!g){this.xmlParseError(i);}}return i;};apf.xmlParseError=function(i){var g=i.parseError;if(g!=0){throw new Error(apf.formatErrorString(1050,null,"XML Parse error on line "+g.line,g.reason+"Source Text:\n"+g.srcText.replace(/\t/gi," ")));}return i;};apf.getStyle=function(g,i){return g.currentStyle[i];};apf.insertHtmlNodes=function(n,s,k){for(var u=[],q=0,j=n.length;q<j;q++){u[q]=n[q].xml;}u=apf.html_entity_decode(u.join(""));if(apf.isIE<7){u=u.replace(/style="background-image:([^"]*)"/g,"find='$1' style='background-image:$1'");}try{(k||s).insertAdjacentHTML(k?"beforebegin":"beforeend",u);}catch(t){document.body.insertAdjacentHTML("beforeend","<table><tr>"+u+"</tr></table>");var g=document.body.lastChild.firstChild.firstChild;for(q=g.childNodes.length-1;q>=0;q--){s.appendChild(g.childNodes[apf.hasDynamicItemList?0:q]);}}if(apf.isIE<7){$setTimeout(function(){var A=s.getElementsByTagName("*");for(var C,B=0,w=A.length;B<w;B++){if(C=A[B].getAttribute("find")){A[B].style.backgroundImage=C.trim();}}});}};apf.insertHtmlNode=function(j,k,g,q){if(k.nodeType!=11&&!k.style){return k.appendChild(j);}var i=g||k;if(!q){q=apf.html_entity_decode(j.serialize?j.serialize(true):j.xml||j.outerHTML||j.nodeValue);}try{i.insertAdjacentHTML(g?"beforeBegin":"beforeEnd",q);}catch(n){apf.console.warn("Warning found block element inside a "+i.tagName+" element. Rendering will give unexpected results");i.insertAdjacentHTML("afterEnd",q);return i.nextSibling;}if(g){return g.previousSibling;}else{return k.lastChild.nodeType==1?k.lastChild:k.lastChild.previousSibling;}};apf.getHorBorders=function(g){return((parseInt(g.currentStyle.borderLeftWidth)||0)+(parseInt(g.currentStyle.borderRightWidth)||0));};apf.getVerBorders=function(g){return(0,(parseInt(g.currentStyle.borderTopWidth)||0)+(parseInt(g.currentStyle.borderBottomWidth)||0));};apf.getWidthDiff=function(g){return Math.max(0,(parseInt(g.currentStyle.paddingLeft)||0)+(parseInt(g.currentStyle.paddingRight)||0)+(parseInt(g.currentStyle.borderLeftWidth)||0)+(parseInt(g.currentStyle.borderRightWidth)||0));};apf.getHeightDiff=function(g){return Math.max(0,(parseInt(g.currentStyle.paddingTop)||0)+(parseInt(g.currentStyle.paddingBottom)||0)+(parseInt(g.currentStyle.borderTopWidth)||0)+(parseInt(g.currentStyle.borderBottomWidth)||0));};apf.getDiff=function(g){return[Math.max(0,(parseInt(g.currentStyle.paddingLeft)||0)+(parseInt(g.currentStyle.paddingRight)||0)+(parseInt(g.currentStyle.borderLeftWidth)||0)+(parseInt(g.currentStyle.borderRightWidth)||0)),Math.max(0,(parseInt(g.currentStyle.paddingTop)||0)+(parseInt(g.currentStyle.paddingBottom)||0)+(parseInt(g.currentStyle.borderTopWidth)||0)+(parseInt(g.currentStyle.borderBottomWidth)||0))];};apf.getMargin=function(g){return[Math.max(0,(parseInt(g.currentStyle.marginLeft)||0)+(parseInt(g.currentStyle.marginRight)||0)),Math.max(0,(parseInt(g.currentStyle.marginTop)||0)+(parseInt(g.currentStyle.marginBottom)||0))];};apf.getHtmlLeft=function(g){return(g.offsetLeft-(apf.isIE>7&&parseInt(g.parentNode.currentStyle.borderLeftWidth)||0));};apf.getHtmlRight=function(g){var i;return(((i=g.offsetParent).tagName=="BODY"?apf.getWindowWidth():i.offsetWidth)-g.offsetLeft-g.offsetWidth-(apf.isIE<8&&parseInt(i.currentStyle.borderLeftWidth)||0)-(parseInt(i.currentStyle.borderRightWidth)||0));};apf.getHtmlTop=function(g){return(g.offsetTop-(apf.isIE>7&&parseInt(g.offsetParent.currentStyle.borderTopWidth)||0));};apf.getHtmlBottom=function(g){var i;return(((i=g.offsetParent).tagName=="BODY"?apf.getWindowHeight():i.offsetHeight)-g.offsetTop-g.offsetHeight-(apf.isIE<8&&parseInt(i.currentStyle.borderTopWidth)||0)-(parseInt(i.currentStyle.borderBottomidth)||0));};apf.getBorderOffset=function(g){return apf.isIE<8&&[0,0]||[parseInt(g.currentStyle.borderLeftWidth)||0,parseInt(g.currentStyle.borderTopWidth)||0];};apf.getHtmlInnerWidth=function(g){return(g.offsetWidth-(parseInt(g.currentStyle.borderLeftWidth)||0)-(parseInt(g.currentStyle.borderRightWidth)||0));};apf.getHtmlInnerHeight=function(g){return(g.offsetHeight-(parseInt(g.currentStyle.borderTopWidth)||0)-(parseInt(g.currentStyle.borderBottomWidth)||0));};apf.getOpacity=function(g){return parseInt(((g.currentStyle.filter||"").match(/alpha\(opacity=(\d*)\)/)||[0,0])[1])/100;};apf.setOpacity=function(i,g){i.style.filter="alpha(opacity="+Math.round(g*100)+")";};apf.popup2={cache:{},setContent:function(n,k,j,i,g){if(!this.popup){this.init();}this.cache[n]={content:k,style:j,width:i,height:g};if(k.parentNode){k.parentNode.removeChild(k);}if(j){apf.importCssString(j,this.popup.document);}return this.popup.document;},removeContent:function(g){this.cache[g]=null;delete this.cache[g];},init:function(){this.popup=window.createPopup();this.popup.document.write('<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">                <html xmlns="http://www.w3.org/1999/xhtml" xmlns:a='+apf.ns.aml+' xmlns:xsl="http://www.w3.org/1999/XSL/Transform">                <head>                    <script>                    var apf = {                        all: [],                        lookup:function(uniqueId){                            return this.all[uniqueId] || {                                $setStyleClass:function(){}                            };                        }                    };                    function destroy(){                        apf.all=null;                    }                    <\/script>                    <style>                    HTML{border:0;overflow:hidden;margin:0}                    BODY{margin:0}                    </style>                </head>                <body onmouseover="if(!self.apf) return;if(this.c){apf.all = this.c.all;this.c.Popup.parentDoc=self;}"></body>                </html>');var g=apf;this.popup.document.body.onmousemove=function(){this.c=g;};},show:function(D,w,u,k,q,j,C,B){if(!this.popup){this.init();}var n=this.cache[D];this.popup.document.body.innerHTML=n.content.outerHTML;if(k){var A,t=7,s=0,g=this.popup;A=setInterval(function(){var i=++s*((C||n.height)/t);g.show(w,u,j||n.width,i,q);g.document.body.firstChild.style.marginTop=(s-t-1)*((C||n.height)/t);if(s>t){clearInterval(A);B(g.document.body.firstChild);}},10);}else{this.popup.show(w,u,j||n.width,C||n.height,q);}this.last=D;},hide:function(){if(this.popup){this.popup.hide();}},forceHide:function(){if(this.last){apf.lookup(this.last).dispatchEvent("popuphide");}},destroy:function(){if(!this.popup){return;}this.popup.document.body.c=null;this.popup.document.body.onmouseover=null;}};apf.importClass(apf.runXpath,true,self);};apf.runNonIe=function(){DocumentFragment.prototype.getElementById=function(d){return this.childNodes.length?this.childNodes[0].ownerDocument.getElementById(d):null;};if(XMLDocument.prototype.__defineGetter__){XMLDocument.prototype.__defineGetter__("xml",function(){return(new XMLSerializer()).serializeToString(this);});XMLDocument.prototype.__defineSetter__("xml",function(){throw new Error(apf.formatErrorString(1042,null,"XML serializer","Invalid assignment on read-only property 'xml'."));});Node.prototype.__defineGetter__("xml",function(){if(this.nodeType==3||this.nodeType==4||this.nodeType==2){return this.nodeValue;}return(new XMLSerializer()).serializeToString(this);});Element.prototype.__defineGetter__("xml",function(){return(new XMLSerializer()).serializeToString(this);});}if(typeof HTMLElement!="undefined"){if(!HTMLElement.prototype.insertAdjacentElement){Text.prototype.insertAdjacentElement=HTMLElement.prototype.insertAdjacentElement=function(d,g){switch(d.toLowerCase()){case"beforebegin":this.parentNode.insertBefore(g,this);break;case"afterbegin":this.insertBefore(g,this.firstChild);break;case"beforeend":this.appendChild(g);break;case"afterend":if(this.nextSibling){this.parentNode.insertBefore(g,this.nextSibling);}else{this.parentNode.appendChild(g);}break;}};}if(!HTMLElement.prototype.insertAdjacentHTML){Text.prototype.insertAdjacentHTML=HTMLElement.prototype.insertAdjacentHTML=function(g,j){var i=this.ownerDocument.createRange();i.setStartBefore(apf.isWebkit?document.body:(self.document?document.body:this));var d=i.createContextualFragment(j);this.insertAdjacentElement(g,d);};}if(!HTMLBodyElement.prototype.insertAdjacentHTML){HTMLBodyElement.prototype.insertAdjacentHTML=HTMLElement.prototype.insertAdjacentHTML;}if(!HTMLElement.prototype.insertAdjacentText){Text.prototype.insertAdjacentText=HTMLElement.prototype.insertAdjacentText=function(g,i){var d=document.createTextNode(i);this.insertAdjacentElement(g,d);};}HTMLElement.prototype.removeNode=function(){if(!this.parentNode){return;}this.parentNode.removeChild(this);};if(HTMLElement.prototype.__defineSetter__){HTMLElement.prototype.__defineSetter__("innerText",function(d){var g=""+d;this.innerHTML=g.replace(/\&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");});HTMLElement.prototype.__defineGetter__("innerText",function(){return this.innerHTML.replace(/<[^>]+>/g,"").replace(/\s\s+/g," ").replace(/^\s*|\s*$/g," ");});HTMLElement.prototype.__defineGetter__("outerHTML",function(){return(new XMLSerializer()).serializeToString(this);});}}var a=false;try{XMLDocument.prototype.async=true;a=true;}catch(c){}Document.prototype.onreadystatechange=null;Document.prototype.parseError=0;Array.prototype.item=function(d){return this[d];};Array.prototype.expr="";try{XMLDocument.prototype.readyState=0;}catch(c){}XMLDocument.prototype.$clearDOM=function(){while(this.hasChildNodes()){this.removeChild(this.firstChild);}};XMLDocument.prototype.$copyDOM=function(d){this.$clearDOM();if(d.nodeType==9||d.nodeType==11){var j=d.childNodes;for(var g=0;g<j.length;g++){this.appendChild(this.importNode(j[g],true));}}else{if(d.nodeType==1){this.appendChild(this.importNode(d,true));}}};XMLDocument.prototype.loadXML=function(i){apf.xmldb.setReadyState(this,1);var g=this.xml||this.serialize();var d=(new DOMParser()).parseFromString(i,"text/xml");apf.xmldb.setReadyState(this,2);this.$copyDOM(d);apf.xmldb.setReadyState(this,3);apf.xmldb.loadHandler(this);return g;};Node.prototype.getElementById=function(d){};HTMLElement.prototype.replaceNode=Element.prototype.replaceNode=function(d){if(!this.parentNode){return;}this.parentNode.insertBefore(d,this);this.parentNode.removeChild(this);};XMLDocument.prototype.$load=XMLDocument.prototype.load;XMLDocument.prototype.load=function(j){var d=document.implementation.createDocument("","",null);d.$copyDOM(this);this.parseError=0;apf.xmldb.setReadyState(this,1);try{if(this.async==false&&a){var g=new XMLHttpRequest();g.open("GET",j,false);g.overrideMimeType("text/xml");g.send(null);apf.xmldb.setReadyState(this,2);this.$copyDOM(g.responseXML);apf.xmldb.setReadyState(this,3);}else{this.$load(j);}}catch(i){this.parseError=-1;}finally{apf.xmldb.loadHandler(this);}return d;};apf.getStyle=function(d,g){return window.getComputedStyle(d,"").getPropertyValue(g);};HTMLDocument.prototype.setProperty=XMLDocument.prototype.setProperty=function(d,g){};apf.getHttpReq=function(){if(apf.availHTTP.length){return apf.availHTTP.pop();}return new XMLHttpRequest();};apf.getXmlDom=function(i,d){var g;if(i){g=new DOMParser();g=g.parseFromString(i,"text/xml");if(!d){this.xmlParseError(g);}}else{g=document.implementation.createDocument("","",null);}return g;};apf.xmlParseError=function(g){if(g.getElementsByTagName("parsererror").length){var k=g.documentElement.firstChild.nodeValue.split("\n"),i=k[2].match(/\w+ (\d+)/)[1],j=k[0].replace(/\w+ \w+ \w+: (.*)/,"$1"),d=g.documentElement.lastChild.firstChild.nodeValue.split("\n")[0];throw new Error(apf.formatErrorString(1050,null,"XML Parse Error on line "+i,j+"\nSource Text : "+d.replace(/\t/gi," ")));}return g;};apf.xmldb.setReadyState=function(d,g){d.readyState=g;if(d.onreadystatechange!=null&&typeof d.onreadystatechange=="function"){d.onreadystatechange();}};apf.xmldb.loadHandler=function(d){if(!d.documentElement||d.documentElement.tagName=="parsererror"){d.parseError=-1;}apf.xmldb.setReadyState(d,4);};apf.Init.add(function(){var g,d=document.getElementsByTagName("form");for(g=0;g<d.length;g++){d[g].removeNode();}d=document.getElementsByTagName("xml");for(g=0;g<d.length;g++){d[g].removeNode();}d=null;});if(document.body){document.body.focus=function(){};}apf.getHorBorders=function(d){return Math.max(0,(parseInt(apf.getStyle(d,"border-left-width"))||0)+(parseInt(apf.getStyle(d,"border-right-width"))||0));};apf.getVerBorders=function(d){return Math.max(0,(parseInt(apf.getStyle(d,"border-top-width"))||0)+(parseInt(apf.getStyle(d,"border-bottom-width"))||0));};apf.getWidthDiff=function(d){return Math.max(0,(parseInt(apf.getStyle(d,"padding-left"))||0)+(parseInt(apf.getStyle(d,"padding-right"))||0)+(parseInt(apf.getStyle(d,"border-left-width"))||0)+(parseInt(apf.getStyle(d,"border-right-width"))||0));};apf.getHeightDiff=function(d){return Math.max(0,(parseInt(apf.getStyle(d,"padding-top"))||0)+(parseInt(apf.getStyle(d,"padding-bottom"))||0)+(parseInt(apf.getStyle(d,"border-top-width"))||0)+(parseInt(apf.getStyle(d,"border-bottom-width"))||0));};apf.getDiff=function(d){return[Math.max(0,parseInt(apf.getStyle(d,"padding-left"))+parseInt(apf.getStyle(d,"padding-right"))+parseInt(apf.getStyle(d,"border-left-width"))+parseInt(apf.getStyle(d,"border-right-width"))||0),Math.max(0,parseInt(apf.getStyle(d,"padding-top"))+parseInt(apf.getStyle(d,"padding-bottom"))+parseInt(apf.getStyle(d,"border-top-width"))+parseInt(apf.getStyle(d,"border-bottom-width"))||0)];};apf.getMargin=function(d){return[Math.max(0,(parseInt(apf.getStyle(d,"margin-left"))||0)+(parseInt(apf.getStyle(d,"margin-right"))||0)),Math.max(0,(parseInt(apf.getStyle(d,"margin-top"))||0)+(parseInt(apf.getStyle(d,"margin-bottom"))||0))];};apf.getHtmlInnerWidth=function(d){return(d.offsetWidth-(parseInt(apf.getStyle(d,"border-left-width"))||0)-(parseInt(apf.getStyle(d,"border-right-width"))||0));};apf.getHtmlInnerHeight=function(d){return(d.offsetHeight-(parseInt(apf.getStyle(d,"border-top-width"))||0)-(parseInt(apf.getStyle(d,"border-bottom-width"))||0));};apf.getOpacity=function(d){return apf.getStyle(d,"opacity");};apf.setOpacity=function(g,d){g.style.opacity=d;};};apf.runOpera=function(){if(apf.runNonIe){apf.runNonIe();}Document.prototype.selectNodes=XMLDocument.prototype.selectNodes=HTMLDocument.prototype.selectNodes=function(d,c){var k=this.evaluate(d,(c?c:this),this.createNSResolver(this.documentElement),XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);var g=new Array(k.snapshotLength);g.expr=d;for(var j=0;j<g.length;j++){g[j]=k.snapshotItem(j);}return g;};Text.prototype.selectNodes=Element.prototype.selectNodes=function(c){var d=this.ownerDocument;if(!d.selectSingleNode){d.selectSingleNode=HTMLDocument.prototype.selectSingleNode;d.selectNodes=HTMLDocument.prototype.selectNodes;}if(d.selectNodes){return d.selectNodes(c,this);}else{throw new Error(apf.formatErrorString(1047,null,"XPath Selection","Method selectNodes is only supported by XML Nodes"));}};Document.prototype.selectSingleNode=XMLDocument.prototype.selectSingleNode=HTMLDocument.prototype.selectSingleNode=function(d,c){var g=this.selectNodes(d+"[1]",c?c:null);return g.length>0?g[0]:null;};Text.prototype.selectSingleNode=Element.prototype.selectSingleNode=function(c){var d=this.ownerDocument;if(!d.selectSingleNode){d.selectSingleNode=HTMLDocument.prototype.selectSingleNode;d.selectNodes=HTMLDocument.prototype.selectNodes;}if(d.selectSingleNode){return d.selectSingleNode(c,this);}else{throw new Error(apf.formatErrorString(1048,null,"XPath Selection","Method selectSingleNode is only supported by XML Nodes. \nInfo : "+e));}};var a=new XMLSerializer();apf.insertHtmlNodes=function(g,n,d){var k,q=document.createDocumentFragment(),j=0,c=g.length;for(;j<c;j++){if(!(k=g[j])){continue;}q.appendChild(k);}(d||n).insertAdjacentHTML(d?"beforebegin":"beforeend",apf.html_entity_decode(a.serializeToString(q)).replace(/<([^>]+)\/>/g,"<$1></$1>"));};apf.insertHtmlNode=function(d,i,c,g){if(i.nodeType!=11&&!i.style){return i.appendChild(d);}if(!g){g=apf.html_entity_decode(d.serialize?d.serialize(true):((d.nodeType==3||d.nodeType==4||d.nodeType==2)?d.nodeValue:a.serializeToString(d)));}(c||i).insertAdjacentHTML(c?"beforebegin":"beforeend",g.replace(/<([^>]+)\/>/g,"<$1></$1>"));return c?c.previousSibling:i.lastChild;};apf.getHtmlLeft=function(c){return(c.offsetLeft-(parseInt(apf.getStyle(c.parentNode,"border-left-width"))||0));};apf.getHtmlRight=function(c){var d;return(((d=c.offsetParent).tagName=="BODY"?apf.getWindowWidth():d.offsetWidth)-c.offsetLeft-c.offsetWidth-(parseInt(apf.getStyle(d,"border-right-width"))||0));};apf.getHtmlTop=function(c){return(c.offsetTop-(parseInt(apf.getStyle(c.offsetParent,"border-top-width"))||0));};apf.getHtmlBottom=function(c){var d;return(((d=c.offsetParent).tagName=="BODY"?apf.getWindowHeight():d.offsetHeight)-c.offsetTop-c.offsetHeight-(parseInt(apf.getStyle(d,"border-bottom-width"))||0));};apf.getBorderOffset=function(c){return[parseInt(apf.getStyle(c,"border-left-width"))||0,parseInt(apf.getStyle(c,"border-top-width"))||0];};};apf.runWebkit=function(){HTMLDocument.prototype.selectNodes=XMLDocument.prototype.selectNodes=function(d,c){if(d.substr(0,2)=="//"){d="."+d;}try{var n=this.evaluate(d,(c||this),this.createNSResolver(this.documentElement),7,null);}catch(k){try{var n=this.evaluate("child::"+d,(c||this),this.createNSResolver(this.documentElement),7,null);}catch(k){throw new Error("XPath error: "+k.message+"\nLine: "+k.lineNumber+"\nExpression: '"+d+"'");}}var g=new Array(n.snapshotLength);g.expr=d;for(var j=g.length-1;j>=0;j--){g[j]=n.snapshotItem(j);}return g;};Text.prototype.selectNodes=Element.prototype.selectNodes=function(c){return this.ownerDocument.selectNodes(c,this);};HTMLDocument.prototype.selectSingleNode=XMLDocument.prototype.selectSingleNode=function(d,c){var g=this.selectNodes(d,c||null);return g[0]||null;};Text.prototype.selectSingleNode=Element.prototype.selectSingleNode=function(c){return this.ownerDocument.selectSingleNode(c,this);};var a=new XMLSerializer();apf.insertHtmlNodes=function(j,q,g){var n,s=document.createDocumentFragment(),d=[],k=0,c=j.length;for(;k<c;k++){if(!(n=j[k])){continue;}s.appendChild(n);}(g||q).insertAdjacentHTML(g?"beforebegin":"beforeend",apf.html_entity_decode(a.serializeToString(s)).replace(/<([^>]+)\/>/g,"<$1></$1>"));};apf.insertHtmlNode=function(d,i,c,g){if(i.nodeType!=11&&!i.style){return i.appendChild(d);}if(!g){g=apf.html_entity_decode(d.serialize?d.serialize(true):((d.nodeType==3||d.nodeType==4||d.nodeType==2)?d.nodeValue:a.serializeToString(d)));}(c||i).insertAdjacentHTML(c?"beforebegin":"beforeend",g.replace(/<([^>]+)\/>/g,"<$1></$1>"));return c?c.previousSibling:i.lastChild;};apf.getHtmlLeft=function(c){return c.offsetLeft;};apf.getHtmlRight=function(c){var d;return(((d=c.offsetParent).tagName=="BODY"?apf.getWindowWidth():d.offsetWidth)-c.offsetLeft-c.offsetWidth-(parseInt(apf.getStyle(d,"border-left-width"))||0)-(parseInt(apf.getStyle(d,"border-right-width"))||0));};apf.getHtmlTop=function(c){return c.offsetTop;};apf.getHtmlBottom=function(c){var d;return(((d=c.offsetParent).tagName=="BODY"?apf.getWindowHeight():d.offsetHeight)-c.offsetTop-c.offsetHeight-(parseInt(apf.getStyle(d,"border-top-width"))||0)-(parseInt(apf.getStyle(d,"border-bottom-width"))||0));};apf.getBorderOffset=function(c){return[0,0];};if(apf.runNonIe){apf.runNonIe();}};apf.lm=new (function(){var bE={"var":1,"for":1,"while":1,"do":1,"if":1,"else":1,"switch":1,"case":1,"break":1,"continue":1,"default":1,"function":2,"return":1,"try":1,"catch":1,"throw":1,"debugger":1,alert:1,confirm:1,setTimeout:1,setInterval:1,"delete":1,"export":1,"import":1,label:1,foreach:1,each:1,node:1,local:1,yield:1,let:1,"finally":1,"delete":1},aD={"\n":1,"\r\n":1,"==":2,"++":2,"--":2,'"':5,"'":5,"<!--":6,"-->":6,"/*":6,"//":6,"*/":6,"{":7,"}":8,"[":9,"]":10,"(":11,")":12,"<":13,">":14,"+=":2,"-=":2,"/=":2,"*=":2,"!=":2},aV={"{":"}","[":"]","(":")","{{":"}"},aY={ancestor:1,"ancestor-or-self":1,attribute:1,child:1,descendant:1,"descendant-or-self":1,following:1,"following-sibling":1,namespace:1,parent:1,preceding:1,self:1},a6={";":1,",":2,"^":3,"=":4,"+=":4,"-=":4,"/=":4,"*=":4,"/":5,":":6},aX={"~":"_val(_n,","%":"_nod(_n,","*":"_nods(_n,","#":"_cnt(_n,","$":"_lng("},q={"~":"_val(_n,","%":"_xml(_n,","*":"_xmls(_n,","#":"_cnt(_n,","$":"_lng("},bj={"~":"_val(_n,","%":"_val(_n,","*":"_val(_n,","#":"_cnt(_n,","$":"_lng("},bL,J={"~":"_val(_n,","%":"_xml(_n,","*":"_xmls(_n,","#":"_cnt(_n,","$":"_lng("},ar={"~":"_val(_n,","%":"_xml(_n,","*":"_xmls(_n,","#":"_cnt(_n,","$":"_lnged("},n={"[":1,"(":1,",":1,"=":1,"return":1,"throw":1},ah={"else":1,"return":1,"delete":1},aH={"do":1,"else":1,"try":1},bb={"=":"_asn(","+=":"_add(","-=":"_sub(","/=":"_div(","*=":"_mul("},aJ={"+":1,"%":1,"-":1,"/":1,"=":1,"(":1,"?":1,"|":1,"^":1,"[":1,"&":1,"*":1,"!":1,":":1,"<":1,",":1},aZ={"{":1,"} ":1,")":1,")   ":1,";":1,"\n":1,"else":1},S={"{":1,";":1,"\n":1,"else":1},C={"} ":1,")   ":1,"(":1,";":1,"&":1,"^":1,"|":1,",":1,'"':1,"'":1,"=":1,"!=":2,"+=":2,"-=":2,"/=":2,"*=":2,"?":1,"{":1,"}":1,">":1,"[":1,"+":1,":":1,"else":1,"return":1},M={'"':1,"'":1,">":1,"]":1,"}":1},bB={'\\"':'"',"\\'":"'","\\{":"{","\\}":"}","\\[":"[","\\]":"]","\\(":"(","\\)":")","\\\\":"\\"},bH={alert:1,confirm:1,setTimeout:1,setInterval:1,"switch":1,call:1,"return":1,"throw":1,"case":1,"catch":1},w={" ":1,"\n":1},a9={"{":1,";":1,"(":1,"\n":1},bq={"\\{":"{","\\}":"}","\\[":"[","\\]":"]","\\(":"(","\\)":")"},I={"\\{":"{","\\}":"}","\\[":"[","\\]":"]","\\(":"(","\\)":")","\\\\":"\\\\\\\\","\\":"\\\\","\\<":"<","\\>":">"},az={lte:"<=",gte:">=",lt:"<",gt:">",and:"&&",or:"||",andbin:"&",orbin:"|",LTE:"<=",GTE:">=",LT:"<",GT:">",AND:"&&",OR:"||",ANDBIN:"&",ORBIN:"|"},V={0:"_val(_n,",1:"_valcr(_n,_cr,",2:"_nod(_n,",3:"_nodcr(_n,_cr,",4:"_nods(_n,",5:"_xpt(_n,",6:"_valst(_n,",7:"_valed(_n,",8:"_valattr(_n,",foreach:"_nods(_n,",each:"_nods(_n,",local:"_nod(_n,",tagName:"_nod(_n,",localName:"_nod(_n,",xml:"_xmlq(",_call:"_val(_n,"},a7={"_val(_n,":"_valm(","_valcr(_n,_cr,":"_valcr(0,_cr,","_nod(_n,":"_nodm(","_nodcr(_n,_cr,":"_nodcr(0,_cr,","_nods(_n,":"_nodsm(","_xml(_n,":"_xml(0,","_xmls(_n,":"_xmls(0,","_cnt(_n,":"_cntm(","_xpt(_n,":"_xptm(","_valst(_n,":"_valm(","_valed(_n,":"_valed(0,","_lng(":"_lng(","_lnged(":"_lnged(","_nod_del(_n,":"_nod_del(0,","_nods_del(_n,":"_nods_del(0,"},ai={"=":{"_val(_n,":"_nod_asn(_n,","_valm(":"_nod_asn(0,","_valcr(_n,_cr,":"_nod_asn(_n,","_valcr(0,_cr,":"_nod_asn(0,","_nod(_n,":"_nod_asn(_n,","_nodm(":"_nod_asn(0,","_nodcr(_n,_cr,":"_nod_asn(_n,","_nodcr(0,_cr,":"_nod_asn(0,","_nods(_n,":"_nods_asn(_n,","_nodsm(":"_nods_asn(0,"},"+=":{"_val(_n,":"_nod_add(_n,","_valm(":"_nod_add(0,","_valcr(_n,_cr,":"_nod_add(_n,","_valcr(0,_cr,":"_nod_add(0,","_nod(_n,":"_nod_add(_n,","_nodm(":"_nod_add(0,","_nodcr(_n,_cr,":"_nod_add(_n,","_nodcr(0,_cr,":"_nod_add(0,","_nods(_n,":"_nods_add(_n,","_nodsm(":"_nods_add(0,"}},A={"_cnt(_n,":"_nod_del(_n,","_xpt(_n,":"_nod_del(_n,","_val(_n,":"_nod_del(_n,","_valcr(_n,":"_nod_del(_n,","_nod(_n,":"_nod_del(_n,","_nodcr(_n,_cr,":"_nod_del(_n,","_nods(_n,":"_nods_del(_n,"},al=/(\r?[\n]|\/\*|\*\/|\/\/|\<\!\-\-|\-\-\>|[=\!+\/\*-]=|\+\+|\-\-|["'{(\[\])}\]\<\>]|$)|([ \t]+)|([a-zA-Z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF.$_][\w.$_]*)|(\d[x\d.]*)|(\\?[\w._?,:;!=+-\\\/^&|*"'[\]{}()%$#@~`<>]?)/g,an=/(^|\|)(?!\@|text\(\)|\.\.|[\w\-\:]+?\:\:)/g,aF={},aK={},aG={},bC=apf.$asyncObjects||{comm:1,rpc:1,http:1,"apf.ajax":1},aM,bJ,aN,k,aS,bu,au,av,ak,bm,aO,bM,bK,Z,am=[],bl,aB=[],aC=[],bw,bd,B,bx,bO,N,aI,bv,at,G,bz,aQ,af,a0,aq,aP,bi,bs,R;aF["if"]="if(",aK["if"]=")",aF["while"]="while(",aK["while"]=")",aF["for"]="for(",aK["for"]=")",aF["switch"]="switch(",aK["switch"]=")",aF["catch"]="catch(",aK["catch"]=")",aK["function"]=")  ";aF.foreach=aF.each="\nfor(var _t=_t||[],_t=(_t.push(_n,0,(";aK.foreach=aK.each=")||[]),_t);(_n=_t[_t.length-1][_t[_t.length-2]++])||(_t.length-=2,_n=_t.pop(),0);)";aF.local="\nfor(var _t=_t||[],_t=(_t.push(_n,((_n=_local(";aK.local=")),1)),_t);(_t[_t.length-1]--&&_n)||(_t.length--,_n=_t.pop(),0);)";aF.localName="_localName(_n",aK.localName=")";aF.output="_o.join(''",aK.output=")";aF.reset="(_o=[],l=0",aK.reset=")";aF.index="apf.getChildNumber(_n",aK.index=")",aF.item="(_t[_t.length-1][_t[_t.length-2]-1]",aK.item=")",aF.first="(_t[_t.length-2]==1",aK.first=")",aF.last="(_t[_t.length-2]==_t[_t.length-1].length",aK.last=")",aF.total="(_t[_t.length-1].length",aK.total=")",aF.pos="(_t[_t.length-2]-1",aK.pos=")",aF.tagName="_tagName(_n",aK.tagName=")";aF._nodeValue="_nodeValue(_n",aK._nodeValue=")";aK.async="])";aK.precall="])";aK._call=")";var U={_call:".call(_n",localName:aF.localName,tagName:aF.tagName,nodeValue:aF.nodeValue,index:aF.index},F="(function(){var _o=[],_l=0;\n",Q=";return _l==1?_o[0]:_o.join('');})()",E="_async(_n,_c,_a,_w,_f,this,",H="',_a[++_a.i]||[",L="_r=",aj,ay="_o[_l++]=",bG="",aW="{var _o=[],_l=0,_n=this;\n",a8=";\nreturn _l==1?_o[0]:_o.join('');}",a5="(_a=_a||{}).i=0;try{\n",bg="}catch(_e){if(_e.x)return;throw(_e);}\n",a4="(_a=_a||{}).i=0;try{_pc(_w);",bf="}catch(_e){if(_e.x)return;throw(_e);}",bh="with(_w){",bp="}",bD="var _o=[],_l=0;_o[_l++]=",aa="var _o=[],_l=0;\n",bN=";\nreturn _ret(_l==1?_o[0]:_o.join(''));",X=";\n_c(_ret(_l==1?_o[0]:_o.join('')),apf.SUCCESS,apf.$lmx);apf.$lmx=null;",ap="return _ret(",aA=");",ba="_c(_ret(",bk="),apf.SUCCESS,apf.$lmx);apf.$lmx=null;\n",K="var _r=",u="var _r;",T=";\nreturn _r;",d=";\n_c(_r,apf.SUCCESS,apf.$lmx);apf.$lmx=null;",c=";\n_c(0,apf.SUCCESS,apf.$lmx);apf.$lmx=null;;",a3="return ",be="",aU="_c(",a2=",apf.SUCCESS);",bc="var _f=function(_n,_c,_w,_a){",g="var _f=function(_n,_w){",j="var _f=function(_n){",ae="var _f=function(_n,_c,_w,_cr,_a){",i="var _f=function(_n,_w,_cr,){",ao="var _f=function(_n,_cr){",ab="var _f=function(event,_c,_w,_a,_n){",bn="var _f=function(event,_w,_n){",ad="var _f=function(event,_n){",D="}",W="var _f=function(_m){",P=";\nif(_n=_r){if(!_n.nodeType)_n=_m;",ax=";\nif(_n=",aE="){if(!_n.nodeType)_n=_m;",bo="\nreturn ",aT="\nreturn _ret(",a1=");",a="\nreturn _n;",by="\nreturn (_r = (",bI="))?(_r.nodeType?_r:_n):(_r===null?null:_n);",br="var _r, _n = _m;",O=";\n_n = _m;",t="\nreturn _ret(_nodeValue(_n));",aR="\nreturn _n;",bF="\n}";function ac(s){var bP,bt;if(au[bd-1]=="{{"){bP=bd-1;}else{for(bt=bl-2,bP=0;bt>=0&&au[bP=(am[bt]&268435455)-1]!="{{";bt-=2){}}if(!s&&av>bP+1){au[bP]=F+ay;}else{au[bP]=F;}bw=1;}function aL(bX,bR,bt,bQ,s,bP,bT){var bW,bV,bU,bS=bR?aD[bR]:(bt?0:(bQ?3:(s?4:(bX?2:15))));switch(bw){case 0:case 1:switch(bS){case 0:if((G==3&&at!="$")||G==4){au[av++]=" ";}else{if(aX[at]){G=0;}}break;case 1:aI++,bi=bT;if(au[av-1]!="\n"&&!a9[at]){au[av++]="\n";}if(aX[at]){G=0;}break;case 2:if(bV=a6[bX]){switch(bV){case 1:if(!am[bl-1]){au[av++]=")",bl-=2;}if(!bw){if(au[av-1]!="\n"&&at!="{"&&at!=";"){au[av++]="\n";}}else{if(!bl||am[bl-1]){au[av++]=";";}}break;case 2:if(!am[bl-1]){au[av++]=")",bl-=2;}au[av++]=",";break;case 3:if(au[av-1]=="\n"||au[av-1]==";"||at=="{"||at=="} "||av==bd){if(!bw){ac();}au[av++]="  ";}else{au[av++]="^";}break;case 4:if(at!="<"&&at!=">"){if(!bw&&au[bd-1]!="("){ac(true);}au[av++]=bX;for(bV=av;bV>=bd&&!bE[au[bV]]&&!((au[bV]=="  "||au[bV]==(bv?ay:aj))&&(au[bV]="",1));bV--){}if(G==3&&bz>0&&at.charAt(0)!="."){if(aS){av-=2;while(w[au[av]]){av--;}bU=at;au[av++]=bb[bX],au[av++]=bU.slice(0,bz),au[av++]=",'",au[av++]=bU.slice(bz+1),au[av++]="',",am[bl++]=bd|(bw<<28),am[bl++]="";}}else{if(au[bV=av-2]==") "){if(!(bW=ai[bX])||!(bW=bW[au[bU=am[bl]&268435455]])){throw {t:"Invalid xpath assign",p:bT};}au[bU]=bW,au[bV]=",",au[bV+1]="",au[bV+2]="";am[bl++]=bd|(bw<<28),am[bl++]="";}}}else{au[av++]=bX;}break;case 5:if(n[at]){am[bl++]=bd|(bw<<28);am[bl++]=au[av++]=bX;bd=B=av-1;bv++,bw=5,bx=bX;}else{au[av++]="/";}break;case 6:if(bl>2&&am[bl-1]=="{{"&&(av<bd+4&&G==5)||(av<bd+3&&(G==3||G==4))){au[bd-1]=am[bl-1]="{";bw=(bV=am[bl-2])>>28;am[bl-2]=bV&268435455,bv--;}else{if(au[av-3]=="case"||(G==5&&R=="case")){bX=";";}}au[av++]=":";break;default:au[av++]=bX;break;}}else{au[av++]=bB[bX]||bX;}break;case 3:case 4:bV=bW=bU=0;bz=(R=bX).lastIndexOf(".");if(bX.charAt(0)!="."&&((bV=(bW=((aZ[at]||au[av-1]=="\n")&&!aJ[at]))&&!am[bl-1].indexOf("{")&&av>bd)||(bU=bE[bX]))&&!bw){if(bU==2&&am[bl-1].indexOf("{")){bU=0;}ac(bU);}if(bW&&!am[bl-1]){au[av-1]=="\n"&&(au[av-1]=""),au[av++]=")",au[av++]="\n",bV=1,bl-=2;}if(bV&&bw&&!bE[bX]&&!bH[bX]){au[av++]=(bv?ay:aj);}if(bz>0&&bX.charAt(0)!="."){aO[au[av++]=af=bX]=1;}else{au[av++]=az[bX]||bX;}break;case 5:if((bV=(bW=((aZ[at]||au[av-1]=="\n")&&!aJ[at]))&&!am[bl-1].indexOf("{")&&av>bd)&&!bw){ac();}if(bW&&!am[bl-1]){au[av-1]=="\n"&&(au[av-1]=""),au[av++]=")",au[av++]="\n",bV=1,bl-=2;}if(bV){au[av++]=(au[av-2]!="\n"&&M[at])?"+":(bv?ay:aj);}else{if(M[at]){au[av++]="+";}}am[bl++]=bd|(bw<<28),am[bl++]=au[av++]=bX;bd=B=av-1,bv++,bw=5,bx=bX;break;case 6:if(bX=="*/"||bX=="-->"){throw {t:"Unmatched comment "+bX,p:bT};}a0=bw,aq=at,aP=G,bw=6,bx=bX;break;case 7:if(au[av-1]==")  "||(au[av-2]==")  "&&av--)){if(am[bl-1]!="("&&am[bl-1]!="["){am[bl++]=bd|(bw<<28),am[bl++]="{{",au[av++]=aW,bd=av,bw=1,bv++,au[av++]="";}else{am[bl++]=bd,am[bl++]=au[av++]=bX,bd=av;bw=1;}}else{if((aF[am[bl+1]]&&at==")   ")||aH[at]){am[bl++]=bd,am[bl++]=au[av++]=bX,bd=av;au[av++]="";}else{if((bV=(bW=((aZ[at]||au[av-1]=="\n")&&!aJ[at]))&&!am[bl-1].indexOf("{")&&av>bd)&&!bw){ac();}if(bW&&!am[bl-1]){au[av-1]=="\n"&&(au[av-1]=""),au[av++]=")",au[av++]="\n",bV=1,bl-=2;}if(bV){au[av++]=(au[av-2]!="\n"&&M[at])?"+''+":(bv?ay:aj);}else{if(M[at]){au[av++]=(at=="}")?"+''+":"+";}}am[bl++]=bd|(bw<<28),am[bl++]=au[av++]="{{";if(!bv&&bd!=av){bM++;}bv++,B=bd=av,bw=0;}}break;case 8:if(!am[bl-1]){au[av++]=")",au[av++]="\n",bl-=2;}if(aV[bV=am[--bl]]!=(au[av++]=bX)){throw {t:"Cannot close "+bV+" with "+bX,p:bT};}if(bV=="{{"){if(bd==av-1){if((am[bl-1]>>28)<=1){au[bd-1]="{",au[av-1]="}";}else{au[bd-1]=au[av-1]="'";}}else{if(!bw){au[bd-1]="(",au[av-1]=")";}else{if(au[bd-1]==aW){if(bd==av-2){au[bd-1]="{",au[av-1]="}";}else{au[av-1]=a8;}}else{au[av-1]=Q;}}}bw=(bV=am[--bl])>>28,bd=bV&268435455;B=av,bv--;if(!bv){bM++;}if(bw==7){au[av++]='+"\\"',bw=4;}}else{bd=am[--bl];}break;case 9:if(((G==3&&!ah[at]&&at!="$")||at==")"||at=="]")&&au[av-1]!="\n"){au[av++]="[",am[bl++]=bd|(bw<<28),am[bl++]=bX,B=bd=av;}else{aQ=null;if((bU=aX[at])){av--,at=au[av-1];if(au[av-1]=="delete"||(au[av-2]=="delete"&&av--)){bU=A[bU],av--;}}else{bU=V[am[bl-1]]||V[bv?0:aM];if(at=="delete"){bU=A[bU],av-=2;}}if((bV=(bW=((aZ[at]||au[av-1]=="\n")&&!aJ[at]))&&!am[bl-1].indexOf("{")&&(av>bd||am[bl-1].length==1))&&!bw){ac();}if(bW&&!am[bl-1]){au[av-1]=="\n"&&(au[av-1]=""),au[av++]=")",au[av++]="\n",bV=1,bl-=2;}if(bV){au[av++]=(au[av-2]!="\n"&&M[at])?"+":(bv?ay:aj);}else{if(M[at]){au[av++]="+";}}if(!bv&&av!=bd){bM++;}bv++,am[bl++]=bd|(bw<<28),am[bl++]=au[av++]=bU,B=bd=av,aB[bd]=bT,bw=3;}break;case 10:if(!am[bl-1]){au[av++]=")",bl-=2;}if(aV[bV=am[--bl]]!=(au[av++]=bX)){throw {t:"Cannot close "+bV+" with "+bX,p:bT};}bd=am[--bl]&268435455;break;case 11:if(((bV=(bW=((S[at]||au[av-1]=="\n")&&!aJ[at]))&&!am[bl-1].indexOf("{")&&av>bd))&&!bw){ac();}if(bW&&!am[bl-1]){au[av-1]=="\n"&&(au[av-1]=""),au[av++]=")",au[av++]="\n",bV=1,bl-=2;}if(bV&&bw){au[av++]=(bv?ay:aj),G=0;}if(bU=aF[at]){if(au[av-1]==" "){av--;}au[av-1]=bU,am[bl++]=bd,am[bl++]=at,bd=B=av;}else{if(G==3){if(bz<0){bV=0;if(at=="function"||au[av-3]=="function"||au[av-4]=="function"){am[bl++]=bd,am[bl++]="function",au[av++]="(",bd=B=av;if(at!="function"&&bu&&bl==4){au[bV=(au[av-4]=="function")?(av-4):(av-5)]="var "+at+" = self."+at+" = function";au[bV+2]="";}}else{if(!bH[at]&&au[av-3]!="new"){au[av++]=".call(_n",am[bl++]=bd,am[bl++]="_call",bd=B=av;}else{am[bl++]=bd,am[bl++]=au[av++]=bX,bd=B=av;}}}else{if(bz>1&&(bC[bV=at.substring(0,bz)]||bC[bV=at])){if(au[--av]==" "){av--;}au[av++]=E,au[av++]=bV,au[av++]=",'";au[av++]=at.slice(bz+1);au[av++]=H,am[bl++]=bd,am[bl++]="async",bd=B=av,ak++;}else{if(at.indexOf(".")!=bz){aO[at.slice(0,bz)]=1;}am[bl++]=bd,am[bl++]=au[av++]=bX,bd=B=av;}}}else{am[bl++]=bd,am[bl++]=au[av++]=bX,bd=B=av;}if(at==af){delete aO[at];}}break;case 12:if(!am[bl-1]){au[av-1]=="\n"&&(au[av-1]=""),au[av++]=")",au[av++]="\n",bV=1,bl-=2;}if(bU=aK[bV=am[--bl]]){if(bV!="_call"){bX=")   ";}if((bW=U[bV])&&bW!=au[av-1]){au[bd-1]=bW+",";}au[av++]=bU;}else{if(aV[bV]!=(au[av++]=bX)){throw {t:"Cannot close "+bV+" with "+bX,p:bT};}}bd=am[--bl]&268435455;break;case 13:if(av==bd||C[at]||au[av-1]=="\n"){if((bV=(bW=((aZ[at]||au[av-1]=="\n")&&!aJ[at]))&&!am[bl-1].indexOf("{")&&av>bd)&&!bw){ac();}if(bW&&!am[bl-1]){au[av-1]=="\n"&&(au[av-1]=""),au[av++]=")",au[av++]="\n",bV=1,bl-=2;}if(bV){au[av++]=(au[av-2]!="\n"&&M[at])?"+''+":(bv?ay:aj);}else{if(M[at]){au[av++]="+";}}bs=null,au[av++]='"',au[av++]="<",bv++,am[bl++]=bd|(bw<<28),bl+=3,am[bl-2]=am[bl-1]=0;B=bd=av-1,bw=4;}else{au[av++]="<";}break;case 14:au[av++]=">";break;case 15:if(bl&&!am[bl-1]){au[av-1]=="\n"&&(au[av-1]=""),au[av++]=")",au[av++]="\n",bV=1,bl-=2;}break;}break;case 2:switch(bS){case 1:aI++,bi=bT;if(av!=bd&&av!=B){au[av++]="\\n";}break;case 2:if(av==B){au[av]=(av++==bd)?'"':'+"';}au[av++]=I[bX]||bX;break;case 3:if(av==B){au[av]=(av++==bd)?'"':'+"';}if(bX.charAt(bX.length-1)=="$"){au[av++]=bX.slice(0,-1);au[av++]=bX="$";}else{au[av++]=bX;}break;case 5:if(av==B){au[av]=(av++==bd)?'"':'+"';}au[av++]=(bX=='"')?'\\"':"'";break;case 7:if(av==B){if(av!=bd){au[av++]="+";}}else{au[av++]='"+',bv||bM++;}am[bl++]=bd|536870912,am[bl++]=au[av++]="{{",bv++,B=bd=av,bw=0;break;case 9:aQ=null;if((bU=q[at])&&au[av-1]==at){if(--av-1==bd){av--;}}else{bU=V[(bv||bd!=av)?0:aM];}if(av!=bd){au[av]=(av++==B)?"+":(bv||bM++,'"+');if(!bv){bM++;}}am[bl++]=bd|536870912,am[bl++]=au[av++]=bU,B=bd=av,bv++,bw=3;break;case 15:if(bl){throw {t:"Unclosed "+am[bl-1]+" found at end in textmode",p:bT};}if(av!=bd&&av!=B){au[av++]='"',bv||bM++;}break;default:if(av==B){au[av]=(av++==bd)?'"':'+"';}au[av++]=bX;}break;case 3:switch(bS){case 0:if(av!=bd){if(av==B){au[av++]='+"';}au[av++]=bX;}break;case 1:aI++,bi=bT;break;case 2:if(bX==":"&&at==":"&&!aY[bU=au[av-2]]&&((bV=am[bl-2])>>28)!=6){if(au[av-2]=='+"'){au[av-2]=au[av-1]="",aQ="#";}else{au[av-1]='"';if(B==bd){aQ=au.slice(B+1,av-1).join("");}else{aQ="#";}}if(!(bU=a7[au[bd-1]])){throw {t:"Invalid model found for: "+au[bd-1],p:bT};}au[bd-1]=bU,au[av++]=",",B=bd=av;}else{if(bX==","&&(bV=(am[bl-2]>>28))<=1){av=bd-1,bW=bO.slice(aB[bd]+1,bT+1);G=9,bw=bV,au[av++]=at="[";am[bl-2]=(am[bl-2]&268435455)|(bw<<28),am[bl-1]=at,B=bd=av,bv--;if(!bv){bK--;}if(bW.length>1){aC.push(bO);(bO=bW).replace(al,aL);bO=aC.pop();}}else{if(av==B){au[av]=(av++==bd)?'"':'+"';}au[av++]=bB[bX]||bX;}}break;case 3:if(av==B){au[av]=(av++==bd)?'"':'+"';}if(bX.charAt(bX.length-1)=="$"){au[av++]=bX.slice(0,-1);au[av++]=bX="$";}else{au[av++]=bX;}break;case 5:if(av==B){au[av]=(av++==bd)?'"':'+"';}if(am[bl-1]=="["){am[bl-1]=bX;}else{if(am[bl-1]==bX){am[bl-1]="[";}}if(bX=='"'){au[av++]="\\";}au[av++]=bX;break;case 7:if(av==B){if(av!=bd){au[av++]="+''+";}}else{au[av++]='"+';}am[bl++]=bd|805306368,am[bl++]=au[av++]="{{",bv++,B=bd=av,bw=0;if(aQ&&am[bl-3]!=q["$"]){bm.push(aQ,"#");aQ=null,Z++;}break;case 9:if(am[bl-1]=="'"||am[bl-1]=='"'||((G!=3||at=="$")&&at!=")"&&at!="]")){if(aQ){bm.push(aQ,"#"),Z++;}aQ=null;if((bU=q[at])&&au[av-1]==at){av--;}else{bU=V[0];}if(av==B){if(av!=bd){au[av++]="+";}}else{au[av++]='"+';}am[bl++]=bd|805306368,am[bl++]=au[av++]=bU,bv++,B=bd=av,bw=3;}else{if(av==B){au[av]=(av++==bd)?'"':'+"';}am[bl++]=bd|1610612736,am[bl++]=au[av++]="[";}break;case 10:bl--,bw=(bU=am[--bl])>>28,bU=bU&268435455;if(bw==6){if(am[bl+1]!="["){throw {t:"In xpath, cannot close "+am[bl+1]+" with "+bX,p:bT};}if(av==B){au[av]=(av++==bd)?'"':'+"';}au[av++]="]";bw=3;}else{if(av==bd){if((am[bl]>>28)<=1){au[bd-1]="[",au[av++]="]";}else{au[bd-1]=au[av++]='"';}B=av;}else{if(av!=B){au[av++]='"';}if(B==bd){bV=au.slice(B+1,av-1).join("");if(k&&au[bd-1]!=","&&bV!=(bW=bV.replace(an,"$1self::"))&&am[bl+1]!=q["$"]){au[bd+1]=bV=bW;for(bW=bd+2;bW<av-1;bW++){au[bW]="";}}}else{if((bW=au[bd-1])!=","){bV="#";if(k){au[bd-1]=bW+"_injself(",au[av++]=")";}}else{bV="";}}if(am[bl+1]!=q["$"]&&bV){bm.push(aQ,bV);if(aQ){Z++;}}au[av++]=") ",B=av;if(bw==7){au[av++]='+"\\"',bw=4;}}bv--,aQ=null;if(!bv){bM++,bK++;}}bd=bU;break;case 11:if(av==B){au[av]=(av++==bd)?'"':'+"';}am[bl++]=bd|805306368,am[bl++]=au[av++]="(";break;case 12:if(av==B){au[av]=(av++==bd)?'"':'+"';}if(aV[bV=am[--bl]]!=(au[av++]=bX)){throw {t:"Cannot close "+bV+" with "+bX,p:bT};}bd=am[--bl]&268435455;break;case 15:throw {t:"Unexpected end whilst parsing xpath",p:bT};break;default:if(av==B){au[av]=(av++==bd)?'"':'+"';}au[av++]=bX;break;}break;case 4:switch(bS){case 0:if(av==B){au[av++]='+"';}au[av++]=" ",G=0;break;case 1:if(av==B){au[av++]='+"';}aI++,bi=bT,au[av++]="\\n",G=1;break;case 2:if(av==B){au[av++]='+"';}if(bX=="/"&&at=="<"){bl-=4;if(am[bl]||am[bl+2]){throw {t:"Unexpected closing tag whilst parsing xml",p:bT};}}else{if(bX==":"&&G==3&&au[av-2]=="<"){bs=at;}}au[av++]=I[bX]||bX;break;case 3:if(av==B){au[av++]='+"';}if(bX.charAt(bX.length-1)=="$"){au[av++]=bX.slice(0,-1);au[av++]=bX="$";}else{au[av++]=bX;}break;case 5:if(av==B){au[av++]='+"';}if(bX=='"'){au[av++]="\\";}au[av++]=bX;break;case 6:if(bX=="//"&&!am[bl-1]){if(av==B){au[av++]='+"';}au[av++]=bX;}else{if(bX=="*/"){throw {t:"Unmatched comment "+bX,p:bT};}a0=bw,aq=at,aP=G,bw=6,bx=bX;}break;case 13:bs=null;if(av==B){au[av++]='+"';}au[av++]=bX,am[bl]=am[bl+2]=0,bl+=4,am[bl-1]=0;break;case 14:if(av==B){au[av++]='+"';}au[av++]=bX;if(at!="<"){if(at=="/"){bl-=4;if(am[bl+2]){throw {t:"Unexpected / whilst parsing xml",p:bT};}if(au[av-3]=="<"){av-=2,au[av-1]="";}}else{bl-=2;}if(am[bl]){bv--,au[av++]='"',bd=am[bl],B=av,bw=bd>>28,bd=bd&268435455;}else{am[bl-1]=1;}}else{av--,au[av-1]="";}break;case 9:aQ=null;if(at=="!"&&au[av-2]=="<"&&!am[bl-1]){au[av++]=bX,am[bl++]=bd|(bw<<28);am[bl++]="]]>",bd=B=av-1;bv++,bw=5;}else{if(am[bl-1]){if((bV=bL[at])){av--;}else{bV=V[bs?bJ:0];}am[bl++]=bd|1073741824;}else{am[bl++]=bd|1073741824;if((bV=bj[at])){av--;if(au[av-1]=="="){at="=";}}else{bV=V[bs?aN:8];}if(at=="="){au[av++]='\\"',am[bl-1]=bd|1879048192;}}au[av]=(av++==B)?"+''+":'"+';bv++,am[bl++]=au[av++]=bV,B=bd=av,bw=3;}break;case 7:if(!am[bl-1]&&at=="="){au[av++]='\\"',am[bl++]=bd|1879048192;}else{am[bl++]=bd|1073741824;}au[av]=(av++==B)?"+''+":'"+';am[bl++]=au[av++]="{{",bv++;B=bd=av,bw=0;break;default:if(av==B){au[av++]='+"';}au[av++]=bX;break;case 15:throw {t:"Unexpected end whilst parsing xml",p:bT};break;}break;case 5:switch(bS){case 1:aI++,bi=bT;if(av==B){au[av]=(av++==bd)?'"':'+"';}au[av++]="\\n";break;case 2:if(bX=="/"&&am[bl-1]=="/"){au[av++]="/",bd=am[bl-=2],B=av,bw=bd>>28,bd=bd&268435455,bv--;}else{if(av==B){au[av]=(av++==bd)?'"':'+"';}au[av++]=(am[bl-1]!="/"&&bq[bX])||bX;}break;case 3:if(av==B){au[av]=(av++==bd)?"":'+"';}if(bX.charAt(bX.length-1)=="$"){au[av++]=bX.slice(0,-1);au[av++]=bX="$";}else{au[av++]=bX;}break;case 5:if(am[bl-1]==bX){if(bd!=B){au[av]=(av++!=B)?(bX+")"):")";}else{au[av++]=bX;}bd=am[bl-=2],B=av,bw=bd>>28;bd=bd&268435455,bv--;}else{if(av==B){au[av]=(av++==bd)?'"':'+"';}au[av++]=bX=='"'?'\\"':bX;}break;case 6:if(am[bl-1]=="/"&&bX=="*/"){au[av++]="*/",bd=am[bl-=2],B=av,bw=bd>>28,bd=bd&268435455,bv--;}else{if(av==B){au[av]=(av++==bd)?"":'+"';}au[av++]=bX;}break;case 7:if(am[bl-1]!="'"&&am[bl-1]!="/"){if(am[bl-1]=='"'){au[bd]='("';}if(av==B){if(av!=bd){au[av++]="+";}}else{au[av++]='"+';}am[bl++]=bd|1342177280,au[av++]=am[bl++]="{{",bv++,B=bd=av,bw=0;}else{au[av++]=bX;}break;case 9:if(am[bl-1]!="'"&&am[bl-1]!="/"&&(am[bl-1]=='"'&&(au[bd]='("')||av!=bd+2||at!="CDATA")){aQ=null;if((bU=q[at])&&au[av-1]==at){av--;}else{bU=V[0];}if(av!=bd){au[av]=(av++==B)?"+":'"+';}am[bl++]=bd|1342177280,am[bl++]=au[av++]=bU,B=bd=av,bv++,bw=3;}else{au[av++]=bX;}break;case 14:if(av==B){au[av]=(av++==bd)?"":'+"';}au[av++]=bX;if(am[bl-1]=="]]>"&&at=="]"&&au[av-3]=="]"){bd=am[bl-=2],bw=bd>>28;bd=bd&268435455,bv--;bl-=4;if(am[bl]){bv--,au[av++]='"',bd=am[bl],B=av,bw=bd>>28,bd=bd&268435455;}else{am[bl-1]=1;}}break;case 15:throw {t:"Unexpected end whilst parsing string",p:bT};break;default:if(av==B){au[av]=(av++==bd)?"":'+"';}au[av++]=bX;break;}break;case 6:switch(bS){case 1:aI++,bi=bT;if(bx=="//"){bw=a0,bX=at=aq,bS=G=aP;}break;case 6:if((bx=="/*"&&bX=="*/")||(bx=="<!--"&&bX=="-->")){bw=a0,bX=at=aq,bS=G=aP;}break;case 15:if(bx!="//"){throw {t:"Unexpected end whilst parsing comment",p:bT};}else{bw=a0,bX=at=aq,bS=G=aP;if(bl&&!am[bl-1]){au[av-1]=="\n"&&(au[av-1]=""),au[av++]=")",au[av++]="\n",bV=1,bl-=2;}}break;}break;}if(bS>1){at=bX,G=bS;}}this.lastCode=function(){if(typeof(au)=="object"){return au.join("");}return au;};function bA(bP,s,bt){if(bP.t){throw new Error(apf.formatErrorString(0,null,"Parsing live markup source","Error whilst parsing: "+bP.t+" on line:"+aI+" col:"+(bP.p-s-2)+(bt?(" part: "+bt):"")+"\n"+bO));}else{throw new Error(apf.formatErrorString(0,null,"Compiling live markup function","Error whilst compiling: "+bP.message+"\nInput:\n"+bO+"\nGenerated:\n"+apf.lm.lastCode()));}}var ag={},Y={};this.resetCache=function(){ag={};};var aw=/^\s*~~(c\d+)~~/;this.compile=function(bt,s){if(!s){s=Y;}if(bt==null||!bt.length){return s.nostring?function(){return bt;}:{type:2,str:bt};}var bS,bQ;if(bt.charAt(0)=="~"&&(bS=bt.match(aw))){if(bS=apf.lm_exec[bS[1]]){return bS;}alert("ERROR, undefined live markup cache marker found:"+bt);return{type:2,str:bt};}var bP=(s.xpathmode|(s.withopt&&16)|(s.precall&&32)|(s.alwayscb&&64)|(s.nostring&&128)|(s.parsecode&&256)|(s.nostate&&512)|(s.editable&&1024)|(s.langedit&&2048)|(s.injectself&&4096)|(s.event&&8192)|(s.funcglobal&&16384))+bt;if(bS=ag[bP]){return bS;}k=s.injectself,aM=s.xpathmode||0,aN=s.nostate?0:6,bJ=s.editable?7:0;bu=s.funcglobal;bL=s.langedit?ar:J;aO={},bm=[],am=[],au=["","","",""],bO=bt,N=bO.length;av=bd=B=au.length,bM=bK=ak=Z=bv=aI=G=bi=0;if(s.parsecode){bw=0,bl=2,am[0]=av,am[1]="{{",at="{",aj=s.event?"":(aM<=1?ay:L);}else{bw=2,bl=at=0,aj=ay;}if(s.nothrow){bO.replace(al,aL);}else{try{bO.replace(al,aL);}catch(bR){bA(bR,bi);return null;}}if(s.parsecode){if(bv||am[bl-1].length==1){bA({t:"Unclosed "+am[bl-1]+" found at end in codemode",p:N},bi);}if(B!=av){bM++;}}if(!s.nostring&&(bw==2&&B==4||av==4)){return{type:2,str:au.slice(5,-1).join("").replace(/\\n/g,"\n").replace(/\\"/g,'"')};}if(ak||s.alwayscb){if(s.event){if(bw==1){au[3]="";}au[av++]=c;}else{if(aM){if(bw==1){au[3]=(au[3]!=F)?K:u,au[av++]=d;}else{au[3]=aU,au[av++]=a2;}}else{if(bw==1){au[3]=(au[3]!=F)?bD:aa,au[av++]=X;}else{au[3]=ba,au[av++]=bk;}}}if(ak){if(bw==1){if(s.precall){au[2]=a4,au[av-1]=bf+au[av-1];}else{au[2]=a5,au[av-1]=bg+au[av-1];}}else{au[av++]=au[3]+"_r"+au[av-2];if(s.precall){au[2]=a4,au[3]=K,au[av-2]=bf;}else{au[2]=a5,au[3]=K,au[av-2]=bg;}}}if(s.withopt){au[1]=bh,au[av++]=bp;}au[0]=s.event?ab:((aM==1||aM==3)?ae:bc);au[av++]=D;}else{if(s.event){if(bw==1){au[3]="";}}else{if(aM){if(bw==1){au[3]=(au[3]!=F)?K:u,au[av++]=T;}else{au[3]=a3,au[av++]=be;}}else{if(bw==1){au[3]=(au[3]!=F)?bD:aa,au[av++]=bN;}else{au[3]=ap,au[av++]=aA;}}}if(s.withopt){au[2]=bh,au[av++]=bp;}au[0]=s.event?(s.withopt?bn:ad):(s.withopt?((aM==1||aM==3)?i:g):((aM==1||aM==3)?ao:j));au[av++]=D;}if(s.nothrow){bQ=apf.lm_exec.compile(au.join(""));}else{try{bQ=apf.lm_exec.compile(au.join(""));}catch(bR){bA(bR,bi);return null;}}bQ.type=(bM==1&&bK==1)?3:1;bQ.xpaths=bm,bQ.models=Z,bQ.props=aO,bQ.asyncs=ak;ag[bP]=bQ;return bQ;};this.compileMatch=function(bS,s){if(!s){s=Y;}aO={},bm=[],au=[W,br],am=[],bv=0,av=au.length,bL=J;for(var bQ,bt,bR=0,bP=bS.length;bR<bP;bR+=2){if(bO=bS[bR]){N=am.length,aM=2;if(bR){au[av++]=O;}au[av++]="";am[0]=bt=av=bd=B=au.length,aj=L;aI=G=bM=bK=ak=bw=bi=0;bl=2,am[1]="{{",at="{";k=1;if(s.nothrow){bO.replace(al,aL);}else{try{bO.replace(al,aL);}catch(bU){bA(bU,bi);return null;}}if(bv||am[bl-1].length==1){bA({t:"Unclosed "+am[bl-1]+" found at end in codemode",p:N});}if(ak){bA({t:"Asynchronous calls not supported in match/value"});}if(bw==1){au[bt-1]=(au[bt-1]!=F)?aj:"",au[av++]=P;}else{au[bt-1]=ax,au[av++]=aE;}}if(bO=bS[bR+1]){N=am.length;if(!bS[bR]&&bR){au[av++]=O;}au[av++]="";bt=av=bd=B=au.length,aj=ay;aM=k=at=bl=aI=bM=bK=G=ak=bi=0;if(s.node){aM=2;}bw=2,k=0;if(s.nothrow){bO.replace(al,aL);}else{try{bO.replace(al,aL);}catch(bU){bA(bU,bi);return null;}}if(ak){bA({t:"Asynchronous calls not supported in match/value"});}if(s.node){if(bw==2&&B==bt||av==bt){au[bt-1]=a;}else{au[bt-1]=by,au[av++]=bI;}}else{if(bw==2&&B==bt||av==bt){au[bt-1]=bo;}else{au[bt-1]=aT,au[av++]=a1;}}if(bS[bR]){au[av++]=bF;}else{break;}}else{if(!bS[bR]){bA({t:"Both match and value are empty"});}if(s.node){au[av++]=aR;}else{au[av++]=t;}aM=2;au[av++]=bF;}}au[av++]=D;var bT;if(s.nothrow){bT=apf.lm_exec.compile(au.join(""));}else{try{bT=apf.lm_exec.compile(au.join(""));}catch(bU){bA(bU,bi);return null;}}bT.type=1,bT.xpaths=bm,bT.props=aO,bT.asyncs=ak;return bT;};this.setWarnLevel=function(s){apf.lm_exec.setWarnLevel(s);};})();apf.lm_exec=new (function(){var wlvl=1;this.setWarnLevel=function(lvl){wlvl=lvl;};function wxpath(x,t){apf.console.warn("Live Markup warning in "+t+", no results for xpath: '"+x+"'");}function wnode(x,t){apf.console.warn("Live Markup warning in "+t+", xpath on null node: '"+x+"'");}function wmodel(m,x,t){apf.console.log("Live Markup warning in "+t+", xpath on empty model: '"+m+"' xpath: '"+x+"'");}function wlang(x,t){apf.console.log("Live Markup warning in "+t+", language symbol not found: '"+x+"'");}function xmlParse(str){var n=apf.getXmlDom("<_apflmlist_>"+str+"</_apflmlist_>");if(!n||!(n=n.documentElement)){return null;}return(n.firstChild==n.lastChild)?n.firstChild:n;}function __val(n,x){if(!n){return(wlvl>1&&wnode(x),"");}return(n=(n.nodeType!=1&&n||(n=n.selectSingleNode(x))&&(n.nodeType!=1&&n||(n=n.firstChild)&&n.nodeType!=1&&n)))&&n.nodeValue||(wlvl>2&&wxpath(x,"_val"),"");}var __valattrrx=/(["'])/g;function __valattrrp(m,a){return m=='"'?"&quot;":"&apos;";}function __valattr(n,x){if(!n){return(wlvl>1&&wnode(x),"");}return(n=(n.nodeType!=1&&n||(n=n.selectSingleNode(x))&&(n.nodeType!=1&&n||(n=n.firstChild)&&n.nodeType!=1&&n)))&&n.nodeValue.replace(__valattrrx,__valattrrp)||(wlvl>2&&wxpath(x,"_val"),"");}function __valm(m,x){var n;if(!m||!(n=(m.charAt&&((m.charAt(0)=="<"&&xmlParse(m))||((n=apf.nameserver.lookup.model[m])&&n.data)))||(m.$isModel?m.data:(m.charAt?0:m)))){return(wlvl>0&&wmodel(m,x,"_valm"),"");}return(n=(n.nodeType!=1&&n||(n=n.selectSingleNode(x))&&(n.nodeType!=1&&n||(n=n.firstChild)&&n.nodeType!=1&&n)))&&n.nodeValue||(wlvl>2&&wxpath(x),"");}function __nod(n,x){return n?n.selectSingleNode(x):(wlvl>1&&wnode(x,"_nod"),null);}function _nods(n,x){return n?n.selectNodes(x):(wlvl>1&&wnode(x,"_nods"),[]);}function __nodm(m,x){var n;if(!m||!(n=(m.charAt&&((m.charAt(0)=="<"&&xmlParse(m))||((n=apf.nameserver.lookup.model[m])&&n.data)))||(m.$isModel?m.data:(m.charAt?0:m)))){return(wlvl>0&&wmodel(m,x,"_nodm"),null);}return n.selectSingleNode(x);}function _nodsm(m,x){var n;if(!m||!(n=(m.charAt&&((m.charAt(0)=="<"&&xmlParse(m))||((n=apf.nameserver.lookup.model[m])&&n.data)))||(m.$isModel?m.data:(m.charAt?0:m)))){return(wlvl>0&&wmodel(m,x,"_nodsm"),[]);}return n.selectNodes(x);}function __cnt(n,x){return n?n.selectNodes(x).length:(wlvl>1&&wnode(x,"_cnt"),0);}function __cntm(m,x){var n;if(!m||!(n=(m.charAt&&((m.charAt(0)=="<"&&xmlParse(m))||((n=apf.nameserver.lookup.model[m])&&n.data)))||(m.$isModel?m.data:(m.charAt?0:m)))){return(wlvl>0&&wmodel(m,x,"_cntm"),0);}return n.selectNodes(x).length;}function _xpt(n,x){return{xpath:x,toString:function(){return"LM Xpath object: "+this.x;}};}function _xptm(m,x){return{model:m,xpath:x,toString:function(){return"LM Xpath object with model: "+this.x;}};}function _xml(n,m,x){if(n){x=m;}else{if(!m||!(n=(m.charAt&&((m.charAt(0)=="<"&&xmlParse(m))||((n=apf.nameserver.lookup.model[m])&&n.data)))||(m.$isModel?m.data:(m.charAt?0:m)))){return(wlvl>0&&wmodel(m,x,"_xml"),"");}}return(n&&(n=n.selectSingleNode(x)))&&n.xml||(wlvl>0&&!n&&wnode(x,"_xml"),"");}function _xmls(n,m,x){if(n){x=m;}else{if(!m||!(n=(m.charAt&&((m.charAt(0)=="<"&&xmlParse(m))||((n=apf.nameserver.lookup.model[m])&&n.data)))||(m.$isModel?m.data:(m.charAt?0:m)))){return(wlvl>0&&wmodel(m,x,"_xmls"),"");}}for(var i=0,j=((n=n.selectNodes(x))).length,o=[];i<j;i++){o[i]=n[i].xml;}return o.join("");}function _valcr(n,cr,m,x){if(n){x=m;}else{if(!m||!(n=(m.charAt&&((m.charAt(0)=="<"&&xmlParse(m))||((n=apf.nameserver.lookup.model[m])&&n.data)))||(m.$isModel?m.data:(m.charAt?0:m)))){return(wlvl>0&&wmodel(m,x,"_valcr"),"");}}if(cr){apf.createNodeFromXpath(ni,x);}else{if(n=ni.selectSingleNode(x)){return(n=(n.nodeType!=1&&n||(n=n.selectSingleNode(x))&&(n.nodeType!=1&&n||(n=n.firstChild)&&n.nodeType!=1&&n)))&&n.nodeValue||"";}}return(wlvl>2&&wxpath(x,"_valcr"),"");}function _nodcr(n,cr,m,x){if(n){x=m;}else{if(!m||!(n=(m.charAt&&((m.charAt(0)=="<"&&xmlParse(m))||((n=apf.nameserver.lookup.model[m])&&n.data)))||(m.$isModel?m.data:(m.charAt?0:m)))){return(wlvl>0&&wmodel(m,x,"_nodcr"),null);}}return n.selectSingleNode(x)||(cr&&apf.createNodeFromXpath(n,x));}function _valst(n,x){var m=apf.xmldb.findModel(n);if(!m){return(wlvl>0&&wmodel(m,x,"_valst"),"");}return"["+m.id+"::"+apf.xmlToXpath(n,m.data,true)+"/"+x+"]";}function _valed(n,m,x){if(n){x=m;}return"<div contenteditable='true' class='contenteditable'>CONTENT_EDITABLE_TODO</div>";}function _nod_del(n,m,x){if(n){x=m;}else{if(!m||!(n=(m.charAt&&((m.charAt(0)=="<"&&xmlParse(m))||((n=apf.nameserver.lookup.model[m])&&n.data)))||(m.$isModel?m.data:(m.charAt?0:m)))){return(wlvl>0&&wmodel(m,x,"_nod_del"),null);}}if(!(n=n.selectSingleNode(x))){return(wlvl>2&&wxpath(m,x,"_nod_del"),null);}apf.xmldb.removeNode(n);}function _nods_del(n,m,x){if(n){x=m;}else{if(!m||!(n=(m.charAt&&((m.charAt(0)=="<"&&xmlParse(m))||((n=apf.nameserver.lookup.model[m])&&n.data)))||(m.$isModel?m.data:(m.charAt?0:m)))){return(wlvl>0&&wmodel(m,x,"_nods_del"),null);}}if(!(n=n.selectNodes(x))){return;}apf.xmldb.removeNodeList(n);}function _nod_asn(n,m,x,v){if(n){v=x,x=m;}else{if(!m||!(n=(m.charAt&&((m.charAt(0)=="<"&&xmlParse(m))||((n=apf.nameserver.lookup.model[m])&&n.data)))||(m.$isModel?m.data:(m.charAt?0:m)))){throw new Error(apf.formatErrorString(0,0,"LM Xpath Assign","Cannot assign to nonresolving model:"+m+"\nxpath:"+x+"\nvalue:"+v));}}if(!n||(x&&!(n=apf.createNodeFromXpath(n,x)))){throw new Error(apf.formatErrorString(0,0,"LM Xpath Assign","Cannot assign could not resolve \nxpath:"+x+"\nvalue:"+v));}var c;if(!v||(v.charAt&&(c=v.charAt(0)!="<"))||typeof(v)=="number"){apf.setNodeValue(n,v,true);return v;}if(!c){if(n.nodeType!=1){throw new Error(apf.formatErrorString(0,0,"LM Xpath Assign","Cannot assign to a non-element node\nxpath:"+x+"\nvalue:"+v));}if(!(c=xmlParse(v))){throw new Error(apf.formatErrorString(0,0,"LM Xpath append","Cannot append broken XML.\nxpath:"+x+"\nvalue:"+v));}if(c.tagName!="_apflmlist_"){return apf.xmldb.replaceNode(c,n);}else{c=c.childNodes;apf.xmldb.replaceNode(n=c[0],n);for(var i=0,j=c.length;i<j;i++){n=apf.xmldb.appendChild(n.parentNode,c[0],n.nextSibling);}return n;}}else{if(v.length){throw new Error(apf.formatErrorString(0,0,"LM Xpath Assign","Assign of xpath nodelists not yet supported\nxpath:"+x+"\nvalue:"+v));}else{if(!v.selectNodes){throw new Error(apf.formatErrorString(0,0,"LM Xpath Assign","Cannot assign non-element node\nxpath:"+x+"\nvalue:"+v));}if(v.nodeType==2){if(n.nodeType!=2){throw new Error(apf.formatErrorString(0,0,"LM Xpath Assign","Cannot assign attribute node to replace non attribute, use += xpath:"+x+"\nvalue:"+v));}apf.xmldb.removeAttribute(c=n.ownerElement||n.selectSingleNode(".."),n.nodeName);apf.xmldb.setAttribute(c,v.nodeName,v.nodeValue);c.getAttributeNode(v.nodeName);}else{apf.xmldb.replaceNode(v,n);}}}return v;}function _nods_asn(n,m,x,v){if(n){v=x,x=m;}else{if(!m||!(n=(m.charAt&&((m.charAt(0)=="<"&&xmlParse(m))||((n=apf.nameserver.lookup.model[m])&&n.data)))||(m.$isModel?m.data:(m.charAt?0:m)))){throw new Error(apf.formatErrorString(0,0,"LM Xpath Assign","Cannot assign to nonresolving model:"+m+"\nxpath:"+x+"\nvalue:"+v));}}for(var i=0,j=(n=n.selectNodes(x)).length;i<j;i++){_nod_asn(n[i],null,v);}return v;}function _nod_add(n,m,x,v){if(n){v=x,x=m;}else{if(!m||!(n=(m.charAt&&((m.charAt(0)=="<"&&xmlParse(m))||((n=apf.nameserver.lookup.model[m])&&n.data)))||(m.$isModel?m.data:(m.charAt?0:m)))){throw new Error(apf.formatErrorString(0,0,"LM Xpath append","Cannot append to nonresolving model:"+m+"\nxpath:"+x+"\nvalue:"+v));}}if(!n||(x&&!(n=n.selectSingleNode(x)))){return _nod_asn(n,0,x,v);}var c;if(!v||(v.charAt&&(c=v.charAt(0)!="<"))||typeof(v)=="number"){apf.setNodeValue(n,v=((n=(n.nodeType!=1&&n||(n=n.selectSingleNode(x))&&(n.nodeType!=1&&n||(n=n.firstChild)&&n.nodeType!=1&&n)))&&n.nodeValue||"")+v,true);return v;}if(!c){if(n.nodeType!=1){throw new Error(apf.formatErrorString(0,0,"LM Xpath append","Cannot append to a non-element node\nxpath:"+x+"\nvalue:"+v));}if(!(c=xmlParse(v))){throw new Error(apf.formatErrorString(0,0,"LM Xpath append","Cannot append broken XML.\nxpath:"+x+"\nvalue:"+v));}if(c.tagName!="_apflmlist_"){return apf.xmldb.appendChild(n.parentNode,xmlParse(v),n.nextSibling);}else{c=c.childNodes;for(var i=0,j=c.length;i<j;i++){n=apf.xmldb.appendChild(n.parentNode,c[0],n.nextSibling);}return n;}}else{if(v.length){throw new Error(apf.formatErrorString(0,0,"LM Xpath append","Nodelists not yet supported\nxpath:"+x+"\nvalue:"+v));}else{if(!v.selectNodes){throw new Error(apf.formatErrorString(0,0,"LM Xpath append","Cannot assign non-element node\nxpath:"+x+"\nvalue:"+v));}if(v.nodeType==2){if(n.nodeType!=1){throw new Error(apf.formatErrorString(0,0,"LM Xpath append","Cannot append attribute to anything but element node"));}apf.xmldb.setAttribute(c=n.ownerElement||n.selectSingleNode(".."),v.nodeName,v.nodeValue);apf.xmldb.removeAttribute(v.ownerElement||v.selectSingleNode(".."),v.nodeName);return c.getAttributeNode(v.nodeName);}else{return apf.xmldb.appendChild(n.parentNode,v,n.nextSibling);}}}}function _nods_add(n,m,x,v){if(n){v=x,x=m;}else{if(!m||!(n=(m.charAt&&((m.charAt(0)=="<"&&xmlParse(m))||((n=apf.nameserver.lookup.model[m])&&n.data)))||(m.$isModel?m.data:(m.charAt?0:m)))){throw new Error(apf.formatErrorString(0,0,"LM Xpath Assign","Cannot append to nonresolving model:"+m+"\nxpath:"+x+"\nvalue:"+v));}}for(var i=0,j=(n=n.selectNodes(x)).length;i<j;i++){_nod_add(n[i],null,v);}return v;}function _asn(o,p,v){if(!o||typeof(o)!="object"){throw new Error(apf.formatErrorString(0,0,"LM Property Assign","Cannot assign property on non object, property:"+p));}if(o.setAttribute){o.setAttribute(p,v);}else{o[p]=v;}return v;}function _add(o,p,v){return _asn(o,p,o&&o[p]+v);}function _sub(o,p,v){return _asn(o,p,o&&o[p]-v);}function _div(o,p,v){return _asn(o,p,o&&o[p]/v);}function _mul(o,p,v){return _asn(o,p,o&&o[p]*v);}function _local(n){if(n&&n.charAt&&n.charAt(0)=="<"){return apf.getXmlDom(n).documentElement;}if(!n&&wlvl>1){wnode("-","_local");}return n;}function _tagName(n1,n2){return(n2&&n2.tagName)||(n1&&n1.tagName);}function _localName(n1,n2){return(n2&&n2[apf.TAGNAME])||(n1&&n1[apf.TAGNAME]);}function _nodeValue(n,n2){if(n2){n=n2;}return(n=(n.nodeType!=1&&n||(n.nodeType!=1&&n||(n=n.firstChild)&&n.nodeType!=1&&n)))&&n.nodeValue||"";}var langrx=/(\\*)\$\[(.*?)\]/g;var lang=apf.language;apf.$lm_has_lang=0;function _lngrx(tok,esc,x){apf.$lm_has_lang=1;if(esc){return"$["+x+"]";}return lang.words[x]||(wlvl>1&&wlang(x,"_lngrx"),"");}function __ret(r){if(r&&r.indexOf&&r.indexOf("$[")!=-1){return r.replace(langrx,_lngrx);}return r;}function __lng(x,x2){apf.$lm_has_lang=1;return lang.words[x]||(wlvl>1&&wlang(x,"_lng"),"");}function _lnged(x,x2){apf.$lm_has_lang=1;return lang.words[x]||(wlvl>1&&wlang(x,"_lnged"),"");}function _injself(s){return s.charAt?s.replace(selfrx,"$1self::"):s;}apf.$lmx=null;function _async(_n,_c,_a,_w,_f,_this,obj,func,args){var i=_a.i,v;if(!_a.ret){_a.ret=[];}if(_a[i]){return _a.ret[i];}_a[i]=true;if(!obj.exec){return _a.ret[i]=(func)?obj[func].apply(obj,args):obj.apply(obj,args);}if(_w&&_w._pc){_w._pc={obj:obj,func:func,args:args,_c:_c};}else{obj.exec(func,args,function(data,state,extra){if(state!=apf.SUCCESS){_c(null,state,extra);}else{apf.$lmx=extra;_a.ret[i]=data;if(_w){_f.call(_this,_n,_c,_w,_a);}else{_f.call(_this,_n,_c,_a);}}});}throw ({x:1});}function _pc(_w){var o;if(typeof(o=_w._pc)!="object"||!o){return;}o.obj.exec(o.func,o.args,o._c);throw ({x:1});}this.compile=function(code){var _ret=__ret,_val=__val,_valm=__valm,_nod=__nod,_nodm=__nodm,_cnt=__cnt,_cntm=__cntm,_lng=__lng,_valattr=__valattr;eval(code);return _f;};var LMBEGINCACHE;var LMENDCACHE;})();apf.url=function(k){var g;if(k.indexOf(":")==-1&&(g=location.toString()).indexOf(":")!=-1){g=new apf.url(g);k=apf.getAbsolutePath(g.protocol+"://"+g.host+"/"+(g.directory.charAt(g.directory.length-1)=="/"?g.directory:g.directory+"/"),k).replace(/\/\/\/\//,"///");}var j=apf.url.options,c=j.parser[j.strictMode?"strict":"loose"].exec(k),d=14;this.uri=k.toString();while(d--){this[j.key[d]]=c[d]||"";}this[j.q.name]={};var a=this;this[j.key[12]].replace(j.q.parser,function(n,i,q){if(i){a[j.q.name][i]=q;}});this.isSameLocation=function(){if(this.uri.length&&this.uri.charAt(0)=="#"){return false;}if(!this.protocol&&!this.port&&!this.host){return true;}if(!this.protocol&&this.host&&this.port&&window.location.hostname==this.host&&window.location.port==this.port){return true;}if(!this.protocol&&this.host&&!this.port&&window.location.hostname==this.host&&window.location.port==80){return true;}return window.location.protocol==(this.protocol+":")&&window.location.hostname==this.host&&(window.location.port==this.port||!window.location.port&&!this.port);};};apf.url.options={strictMode:false,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}};apf.runXpath=function(){apf.XPath={cache:{},getSelf:function(htmlNode,tagName,info,count,num,sResult){var numfound=0,result=null,data=info[count];if(data){data[0](htmlNode,data[1],info,count+1,numfound++,sResult);}else{sResult.push(htmlNode);}},getChildNode:function(htmlNode,tagName,info,count,num,sResult){var numfound=0,result=null,data=info[count];var nodes=htmlNode.childNodes;if(!nodes){return;}for(var i=0;i<nodes.length;i++){if(tagName&&(tagName!=nodes[i].tagName)&&(nodes[i].style?nodes[i].tagName.toLowerCase():nodes[i].tagName)!=tagName){continue;}htmlNode=nodes[i];if(data){data[0](nodes[i],data[1],info,count+1,numfound++,sResult);}else{sResult.push(nodes[i]);}}},doQuery:function(htmlNode,qData,info,count,num,sResult){var result=null,data=info[count];var query=qData[0];var returnResult=qData[1];try{var qResult=eval(query);}catch(e){apf.console.error(e.name+" "+e.type+":"+apf.XPath.lastExpr+"\n\n"+query);return;}if(returnResult){return sResult.push(qResult);}if(!qResult||qResult.dataType==apf.ARRAY&&!qResult.length){return;}if(data){data[0](htmlNode,data[1],info,count+1,0,sResult);}else{sResult.push(htmlNode);}},getTextNode:function(htmlNode,empty,info,count,num,sResult){var data=info[count],nodes=htmlNode.childNodes;for(var i=0;i<nodes.length;i++){if(nodes[i].nodeType!=3&&nodes[i].nodeType!=4){continue;}if(data){data[0](nodes[i],data[1],info,count+1,i,sResult);}else{sResult.push(nodes[i]);}}},getAnyNode:function(htmlNode,empty,info,count,num,sResult){var data=info[count],nodes=htmlNode.getElementsByTagName("*");for(var i=0;i<nodes.length;i++){if(data){data[0](nodes[i],data[1],info,count+1,i,sResult);}else{sResult.push(nodes[i]);}}},getAttributeNode:function(htmlNode,attrName,info,count,num,sResult){if(!htmlNode||htmlNode.nodeType!=1){return;}if(attrName=="*"){var nodes=htmlNode.attributes;for(var i=0;i<nodes.length;i++){arguments.callee.call(this,htmlNode,nodes[i].nodeName,info,count,i,sResult);}return;}var data=info[count],value=htmlNode.getAttributeNode(attrName);if(data){data[0](value,data[1],info,count+1,0,sResult);}else{if(value){sResult.push(value);}}},getAllNodes:function(htmlNode,x,info,count,num,sResult){var data=info[count],tagName=x[0],inclSelf=x[1],prefix=x[2],nodes,i,l;if(inclSelf&&(htmlNode.tagName==tagName||tagName=="*"||tagName=="node()")){if(data){data[0](htmlNode,data[1],info,count+1,0,sResult);}else{sResult.push(htmlNode);}}if(tagName=="node()"){tagName="*";prefix="";if(apf.isIE){nodes=htmlNode.getElementsByTagName("*");}else{nodes=[];(function recur(x){for(var n,i=0;i<x.childNodes.length;i++){n=x.childNodes[i];if(n.nodeType!=1){continue;}nodes.push(n);recur(n);}})(htmlNode);}}else{nodes=htmlNode.getElementsByTagName((prefix&&(apf.isGecko||apf.isOpera||htmlNode.nodeFunc)?prefix+":":"")+tagName);}for(i=0,l=nodes.length;i<l;i++){if(data){data[0](nodes[i],data[1],info,count+1,i,sResult);}else{sResult.push(nodes[i]);}}},getAllAncestorNodes:function(htmlNode,x,info,count,num,sResult){var data=info[count],tagName=x[0],inclSelf=x[1],i=0,s=inclSelf?htmlNode:htmlNode.parentNode;while(s&&s.nodeType==1){if(s.tagName==tagName||tagName=="*"||tagName=="node()"){if(data){data[0](s,data[1],info,count+1,++i,sResult);}else{sResult.push(s);}}s=s.parentNode;}},getParentNode:function(htmlNode,empty,info,count,num,sResult){var data=info[count],node=htmlNode.parentNode;if(data){data[0](node,data[1],info,count+1,0,sResult);}else{if(node){sResult.push(node);}}},getPrecedingSibling:function(htmlNode,tagName,info,count,num,sResult){var data=info[count],node=htmlNode.previousSibling;while(node){if(tagName!="node()"&&(node.style?node.tagName.toLowerCase():node.tagName)!=tagName){node=node.previousSibling;continue;}if(data){data[0](node,data[1],info,count+1,0,sResult);}else{if(node){sResult.push(node);break;}}}},getFollowingSibling:function(htmlNode,tagName,info,count,num,sResult){var result=null,data=info[count];var node=htmlNode.nextSibling;while(node){if(tagName!="node()"&&(node.style?node.tagName.toLowerCase():node.tagName)!=tagName){node=node.nextSibling;continue;}if(data){data[0](node,data[1],info,count+1,0,sResult);}else{if(node){sResult.push(node);break;}}}},multiXpaths:function(contextNode,list,info,count,num,sResult){for(var i=0;i<list.length;i++){info=list[i][0];var rootNode=(info[3]?contextNode.ownerDocument.documentElement:contextNode);info[0](rootNode,info[1],list[i],1,0,sResult);}sResult.makeUnique();},compile:function(sExpr){var isAbsolute=sExpr.match(/^\//);sExpr=sExpr.replace(/\[(\d+)\]/g,"/##$1").replace(/\|\|(\d+)\|\|\d+/g,"##$1").replace(/\.\|\|\d+/g,".").replace(/\[([^\]]*)\]/g,function(match,m1){return"/##"+m1.replace(/\|/g,"_@_");});if(sExpr=="/"||sExpr=="."){return sExpr;}return this.processXpath(sExpr.replace(/\/\//g,"descendant::"),isAbsolute);},processXpath:function(sExpr,isAbsolute){var results=[],i,l,m,query;sExpr=sExpr.replace(/'[^']*'/g,function(m){return m.replace("|","_@_");});sExpr=sExpr.split("|");for(i=0,l=sExpr.length;i<l;i++){sExpr[i]=sExpr[i].replace(/_\@\_/g,"|");}if(sExpr.length==1){sExpr=sExpr[0];}else{for(i=0,l=sExpr.length;i<l;i++){sExpr[i]=this.processXpath(sExpr[i]);}results.push([this.multiXpaths,sExpr]);return results;}var sections=sExpr.split("/");for(i=0,l=sections.length;i<l;i++){if(sections[i]=="."||sections[i]==""){continue;}else{if(sections[i]==".."){results.push([this.getParentNode,null]);}else{if(sections[i].match(/^[\w-_\.]+(?:\:[\w-_\.]+){0,1}$/)){results.push([this.getChildNode,sections[i]]);}else{if(sections[i].match(/^\#\#(\d+)$/)){results.push([this.doQuery,["num+1 == "+parseInt(RegExp.$1)]]);}else{if(sections[i].match(/^\#\#(.*)$/)){query=RegExp.$1;m=[query.match(/\(/g),query.match(/\)/g)];if(m[0]||m[1]){while(!m[0]&&m[1]||m[0]&&!m[1]||m[0].length!=m[1].length){if(!sections[++i]){break;}query+="/"+sections[i];m=[query.match(/\(/g),query.match(/\)/g)];}}results.push([this.doQuery,[this.compileQuery(query)]]);}else{if(sections[i]=="*"){results.push([this.getChildNode,null]);}else{if(sections[i].substr(0,2)=="[]"){results.push([this.getAllNodes,["*",false]]);}else{if(sections[i].match(/descendant-or-self::node\(\)$/)){results.push([this.getAllNodes,["*",true]]);}else{if(sections[i].match(/descendant-or-self::([^\:]*)(?:\:(.*)){0,1}$/)){results.push([this.getAllNodes,[RegExp.$2||RegExp.$1,true,RegExp.$1]]);}else{if(sections[i].match(/descendant::([^\:]*)(?:\:(.*)){0,1}$/)){results.push([this.getAllNodes,[RegExp.$2||RegExp.$1,false,RegExp.$1]]);}else{if(sections[i].match(/ancestor-or-self::([^\:]*)(?:\:(.*)){0,1}$/)){results.push([this.getAllAncestorNodes,[RegExp.$2||RegExp.$1,true,RegExp.$1]]);}else{if(sections[i].match(/ancestor::([^\:]*)(?:\:(.*)){0,1}$/)){results.push([this.getAllAncestorNodes,[RegExp.$2||RegExp.$1,false,RegExp.$1]]);}else{if(sections[i].match(/^\@(.*)$/)){results.push([this.getAttributeNode,RegExp.$1]);}else{if(sections[i]=="text()"){results.push([this.getTextNode,null]);}else{if(sections[i]=="node()"){results.push([this.getChildNode,null]);}else{if(sections[i].match(/following-sibling::(.*)$/)){results.push([this.getFollowingSibling,RegExp.$1.toLowerCase()]);}else{if(sections[i].match(/preceding-sibling::(.*)$/)){results.push([this.getPrecedingSibling,RegExp.$1.toLowerCase()]);}else{if(sections[i]=="self::node()"){results.push([this.getSelf,null]);}else{if(sections[i].match(/self::(.*)$/)){results.push([this.doQuery,["apf.XPath.doXpathFunc(htmlNode, 'local-name') == '"+RegExp.$1+"'"]]);}else{query=sections[i];m=[query.match(/\(/g),query.match(/\)/g)];if(m[0]||m[1]){while(!m[0]&&m[1]||m[0]&&!m[1]||m[0].length!=m[1].length){if(!sections[++i]){break;}query+="/"+sections[i];m=[query.match(/\(/g),query.match(/\)/g)];}}results.push([this.doQuery,[this.compileQuery(query),true]]);}}}}}}}}}}}}}}}}}}}}results[0][3]=isAbsolute;return results;},compileQuery:function(code){return new apf.CodeCompilation(code).compile();},doXpathFunc:function(contextNode,type,nodelist,arg2,arg3,xmlNode,force){if(!nodelist||nodelist.length==0){nodelist="";}if(type=="not"){return !nodelist;}if(!force){var arg1,i,l;if(typeof nodelist=="object"||nodelist.dataType==apf.ARRAY){if(nodelist&&!nodelist.length){nodelist=[nodelist];}var res=false,value;for(i=0,l=nodelist.length;i<l;i++){xmlNode=nodelist[i];if(!xmlNode||typeof xmlNode=="string"||"position|last|count|local-name|name".indexOf(type)>-1){value=xmlNode;}else{if(xmlNode.nodeType==1&&xmlNode.firstChild&&xmlNode.firstChild.nodeType!=1){xmlNode=xmlNode.firstChild;}value=xmlNode.nodeValue;}if(res=arguments.callee.call(this,contextNode,type,value,arg2,arg3,xmlNode,true)){return res;}}return res;}else{arg1=nodelist;}}switch(type){case"position":return apf.getChildNumber(contextNode)+1;case"format-number":return apf.formatNumber(arg1);case"floor":return Math.floor(arg1);case"ceiling":return Math.ceil(arg1);case"starts-with":return arg1?arg1.substr(0,arg2.length)==arg2:false;case"string-length":return arg1?arg1.length:0;case"count":return arg1?arg1.length:0;case"last":return arg1?arg1[arg1.length-1]:null;case"name":var c=xmlNode||contextNode;return c.nodeName||c.tagName;case"local-name":var c=xmlNode||contextNode;if(c.nodeType!=1){return false;}return c.tagName.split(":").pop();case"substring":return arg1&&arg2?arg1.substring(arg2,arg3||0):"";case"contains":return arg1&&arg2?arg1.indexOf(arg2)>-1:false;case"concat":var str="";for(i=1,l=arguments.length;i<l;i++){if(typeof arguments[i]=="object"){str+=getNodeValue(arguments[i][0]);continue;}str+=arguments[i];}return str;case"translate":for(i=0,l=arg2.length;i<l;i++){arg1=arg1.replace(arg2.substr(i,1),arg3.substr(i,1));}return arg1;}},selectNodeExtended:function(sExpr,contextNode,match){var sResult=this.selectNodes(sExpr,contextNode);if(sResult.length==0){return null;}if(!match){return sResult;}for(var i=0,l=sResult.length;i<l;i++){if(getNodeValue(sResult[i])==match){return[sResult[i]];}}return null;},getRoot:function(xmlNode){while(xmlNode.parentNode&&xmlNode.parentNode.nodeType==1){xmlNode=xmlNode.parentNode;}return xmlNode.parentNode;},selectNodes:function(sExpr,contextNode){if(!this.cache[sExpr]){this.cache[sExpr]=this.compile(sExpr);}if(sExpr.length>20){this.lastExpr=sExpr;this.lastCompile=this.cache[sExpr];}if(typeof this.cache[sExpr]=="string"){if(this.cache[sExpr]=="."){return[contextNode];}if(this.cache[sExpr]=="/"){return[(contextNode.nodeType==9?contextNode.documentElement:this.getRoot(contextNode))];}}if(typeof this.cache[sExpr]=="string"&&this.cache[sExpr]=="."){return[contextNode];}var info=this.cache[sExpr][0],rootNode=(info[3]?(contextNode.nodeType==9?contextNode.documentElement:this.getRoot(contextNode)):contextNode),sResult=[];if(rootNode){info[0](rootNode,info[1],this.cache[sExpr],1,0,sResult);}return sResult;}};function getNodeValue(sResult){if(sResult.nodeType==1){return sResult.firstChild?sResult.firstChild.nodeValue:"";}if(sResult.nodeType>1||sResult.nodeType<5){return sResult.nodeValue;}return sResult;}apf.CodeCompilation=function(code){this.data={F:[],S:[],I:[],X:[]};this.compile=function(){code=code.replace(/ or /g," || ").replace(/ and /g," && ").replace(/!=/g,"{}").replace(/=/g,"==").replace(/\{\}/g,"!=");this.tokenize();this.insert();code=code.replace(/, \)/g,", htmlNode)");return code;};this.tokenize=function(){var data=this.data.F;code=code.replace(/(translate|format-number|contains|substring|local-name|last|position|round|starts-with|string|string-length|sum|floor|ceiling|concat|count|not)\s*\(/g,function(d,match){return(data.push(match)-1)+"F_";});data=this.data.S;code=code.replace(/'([^']*)'/g,function(d,match){return(data.push(match)-1)+"S_";}).replace(/"([^"]*)"/g,function(d,match){return(data.push(match)-1)+"S_";});data=this.data.X;code=code.replace(/(^|\W|\_)([\@\.\/A-Za-z\*][\*\.\@\/\w\-]*(?:\(\)){0,1})/g,function(d,m1,m2){return m1+(data.push(m2)-1)+"X_";}).replace(/(\.[\.\@\/\w]*)/g,function(d,m1,m2){return(data.push(m1)-1)+"X_";});data=this.data.I;code=code.replace(/(\d+)(\W)/g,function(d,m1,m2){return(data.push(m1)-1)+"I_"+m2;});};this.insert=function(){var data=this.data;code=code.replace(/(\d+)X_\s*==\s*(\d+S_)/g,function(d,nr,str){return"apf.XPath.selectNodeExtended('"+data.X[nr].replace(/'/g,"\\'")+"', htmlNode, "+str+")";}).replace(/(\d+)([FISX])_/g,function(d,nr,type){var value=data[type][nr];if(type=="F"){return"apf.XPath.doXpathFunc(htmlNode, '"+value+"', ";}else{if(type=="S"){return"'"+value+"'";}else{if(type=="I"){return value;}else{if(type=="X"){return"apf.XPath.selectNodeExtended('"+value.replace(/'/g,"\\'")+"', htmlNode)";}}}}}).replace(/, \)/g,")");};};};apf.dump2=apf.vardump2=function(k,j,g,t){if(apf.isWebkit){return"";}if(!k){return k+"";}if(!t){t="";}if(!j){j=0;}var s;switch(k.dataType){case apf.STRING:return'"'+k+'"';case apf.NUMBER:return k;case apf.BOOLEAN:return(k?"true":"false");case apf.DATE:return'Date("'+k+")";case apf.ARRAY:if(k[k.length-2]=="$__vardump"){return"this"+k[k.length-1];}k.push("$__vardump",t);s=["[ "];for(var n=0;n<k.length-2;n++){s.push(s.length>1?",":"",(g&&j>0?"{/*"+typeof(k[n])+"*/}":apf.vardump2(k[n],j+1,g,t+"["+n+"]")));}s.push(" ]");k.pop();k.pop();return s.join("");default:if(typeof k=="function"){return"{/*function*/}";}if(k.nodeType!==undefined&&k.style&&j!=0){return"{/*HTML Element: "+k.tagName+"*/}";}if(k.nodeType!==undefined){return"{/*XML Element : "+k.tagName+"*/}";}if(g&&j>0){return"{/*object/*}";}if(k["$__vardump"]){return"this"+k["$__vardump"]+"";}k["$__vardump"]=t;s=["{\n"];for(var a in k){if(a!="$__vardump"){try{var d=(parseInt(a)==a)?"0x"+("00000000"+parseInt(a).toString(16)).slice(-8):a;if(s.length>1){s.push(",\n");}s.push("\t".repeat(j+1),d,": ",(g&&j>0?"{/*"+typeof(k[a])+"*/}":apf.vardump2(k[a],j+1,g,t+"."+a)));}catch(q){s.push("\t".repeat(j+1),a,": null /*ERROR*/");}}}s.push("\n",("\t".repeat(j)),"}");function c(u){if(!u["$__vardump"]){return;}delete u["$__vardump"];for(var w in u){var i=u[w];if(typeof(i)=="object"){c(u);}}}c(k);return s.join("");}};if(apf.isOpera){window.console={};["log","debug","info","warn","error"].forEach(function(a){window.console[a]=function(){if(typeof arguments==="undefined"){return null;}if(arguments.length===1){opera.postError(a+": "+arguments[0]);return a+": "+arguments[0];}var j=arguments[0],k=/%([sdifo])/g,g=0,d=null;while(d=k.exec(j)){j=j.replace(d[0],String(arguments[++g]));}var c=arguments.length;while(c>g++){if(arguments[g]){j+=" ";j+=String(arguments[g]);}}opera.postError(a+": "+j);};});}apf.dump=apf.vardump=function(j,n,d,a){if(!j){return j+"";}if(!n){n=0;}switch(j.dataType){case"string":return'"'+j+'"';case"number":return j;case"boolean":return j?"true":"false";case"date":return"Date["+new Date()+"]";case"array":var k="{\n";for(var c=0;c<j.length;c++){k+="     ".repeat(n+1)+c+" => "+(!d&&n>0?typeof j[c]:apf.vardump(j[c],n+1,!d))+"\n";}k+="     ".repeat(n)+"}";return k;default:if(typeof j=="function"){return"function";}if(j.xml||j.serialize){return n==0?"[ "+(j.xml||j.serialize())+" ]":"XML Element";}if(!d&&n>0){return"object";}var k="{\n";for(prop in j){try{k+="     ".repeat(n+1)+prop+" => "+(!d&&n>0?typeof j[prop]:apf.vardump(j[prop],n+1,!d))+"\n";}catch(g){k+="     ".repeat(n+1)+prop+" => [ERROR]\n";}}k+="     ".repeat(n)+"}";return k;}};String.prototype.s=function(){return this.replace(/[\r\n]/g,"");};apf.alert_r=function(c,a){alert(apf.vardump(c,null,a));};apf.alert_r2=function(c,a){alert(apf.vardump2(c,null,!a));};apf.ProfilerClass=function(a){this.totalTime=0;this.start=function(c){if(c){this.totalTime=0;}this.startTime=new Date().getTime();this.isStarted=true;};this.stop=this.end=function(){if(!this.startTime){return;}this.totalTime+=new Date().getTime()-this.startTime;this.isStarted=false;};this.addPoint=function(c){this.end();apf.console.time("[TIME] "+(c||"Profiled Section")+": "+this.totalTime+"ms");this.start(true);};if(!a){this.start();}};apf.Latometer=new apf.ProfilerClass(true);if(self.navigator&&navigator.userAgent.indexOf("Opera")!=-1){window.console={};["log","debug","info","warn","error"].forEach(function(a){window.console[a]=function(){if(typeof arguments==="undefined"){return null;}if(arguments.length===1){opera.postError(a+": "+arguments[0]);return a+": "+arguments[0];}var j=arguments[0],k=/%([sdifo])/g,g=0,d=null;while(d=k.exec(j)){j=j.replace(d[0],String(arguments[++g]));}var c=arguments.length;while(c>g++){if(arguments[g]){j+=" ";j+=String(arguments[g]);}}opera.postError(a+": "+j);};});}function prettySize(a){if(a<1024){return a+" Bytes";}else{if(a<1024*1024){return Math.round(a/1024)+" KB";}else{if(a<1024*1024*1024){return Math.round(a/(1024*1024))+" MB";}}}}apf.$debugwin={resPath:"",showtime:true,nativedebug:false,highlighthover:true,cache:[],apf:(function(){apf.isDebugWindow=self.frameElement&&self.frameElement.isDebugWin>-1;if(apf.isDebugWindow){var a=self.parent.apf;apf.xmldb.$xmlDocLut=a.xmldb.$xmlDocLut;apf.xmldb.$listeners=a.xmldb.$listeners;apf.xmldb.$nodeCount=a.xmldb.$nodeCount;(apf.$asyncObjects||(apf.$asyncObjects={}))["$apf_ide_mdlProps"]=1;return a;}return apf;})(),init:function(){this.updateLog();this.apf.addEventListener("debug",this.debugHandler);apf.importCssString(".console_date{display:inline}");apf.storage.init();this.showtime=apf.storage.get("apfdebug_console_date")!==false;this.nativedebug=apf.storage.get("apfdebug_debugger")==true;this.highlighthover=apf.storage.get("apfdebug_highlight_hover")!==false;txtCode.setValue(apf.storage.get("jsexec")||"");codetype.setProperty("value",apf.storage.get("scriptype")||"Javascript");txtModel.setValue(apf.storage.get("mdlvalue")||"");this.apf.$debugwin.setNativeDebug(this.nativedebug);itmShowtime.setAttribute("checked",this.showtime);itmDebug.setAttribute("checked",this.nativedebug);cbHighlightHover.setAttribute("checked",this.highlighthover);$apf_ide_mdl.load(this.apf.document.documentElement);var a=this;this.$mmouseover=function(g){var d=g.htmlEvent.srcElement||g.htmlEvent.target;var c=d.tagName=="DIV"||d.tagName=="SPAN"?null:apf.xmldb.findXmlNode(d);if(cbHighlightHover.checked){a.apf.$debugwin.highlightAmlNode(c,!c);}g.cancelBubble=true;};this.$mmouseout=function(c){self.apf.$debugwin.highlightAmlNode(null,true);c.cancelBubble=true;};$apf_ide_mdlProps.exec=function(k,i,j,g){if(k=="getProperty"&&i[0]){var d,c=i[0];if(d=$apf_ide_mdlProps.queryNode(c)){return j(d,apf.SUCCESS);}if(!g){g={};}if(!g.callback){g.callback=function(s,q,n){if(q!=apf.SUCCESS){$apf_ide_mdlProps.exec(k,["empty"],j,g);c="empty";return false;}else{j($apf_ide_mdlProps.queryNode(c),q,n);}};}this.insert("props/"+c+".xml",g);}};apf.addEventListener("mousedown",function(){errBox.hide();});},start:function(){if(!apf.isDebugWindow){window.onerror=this.nativedebug?null:this.errorHandler;}},errorHandler:function(g,a,d,c){if(!g){g="";}if(!c){apf.$debugwin.apf.console.error((apf.$debugwin.apf!=apf?"[Debug Window Error]: ":"")+"Error on line "+d+" of "+apf.removePathContext(apf.hostPath,a)+"\n"+g);}if(apf.$debugwin.apf==apf){apf.$debugwin.show();}return true;},updateLog:function(){apf_console.clear();apf_console.setValue(this.apf.console.getAll(btnError.value,btnWarn.value,btnLog.value));},updateTeleportFilter:function(a){var c=tlist.each.split("|");if(a.value){c.push(a.firstChild.nodeValue.toLowerCase());}else{c=c.remove(a.firstChild.nodeValue.toLowerCase());}tlist.setAttribute("each",c.join("|")||"none");},debugHandler:function(a){if((self["btn"+a.type.uCaseFirst()]||btnLog).value||a.type=="custom"){apf_console.setValue(a.message);}if(a.type=="error"&&tabDebug.activepagenr!=0){errBox.setMessage(";<a href='javascript:void(0)' onclick='tabDebug.set(0);errBox.hide()'>"+a.message+"</a>");errBox.show();}},showAmlNode:function(a){tabDebug.set(1);pgBrowse.set(0);if(!mrkAml.xmlRoot){mrkAml.addEventListener("afterload",function(){apf.$debugwin.showAmlNode(a);mrkAml.removeEventListener("afterload",arguments.callee);});}else{mrkAml.expandAndSelect(a);if(mrkAml.selected!=a){this.showObject(null,a.getAttribute("id")||"",a);}}},toggleHighlight:function(a,c){if(document.onmousemove){document.onmousemove=document.onmousedown=null;return;}var d;document.onmousemove=function(k){if(apf.$debugwin.$hdiv){apf.$debugwin.$hdiv.style.top="10000px";}var g=(k||(k=event)).clientX;var n=k.clientY;var j=document.elementFromPoint(g,n);var i=apf.findHost(j);if(d!=i){apf.$debugwin.highlightAmlNode(null,true);}if(d=i){apf.$debugwin.highlightAmlNode(i,false,true);}};document.onmousedown=function(i){var g=d||apf.findHost((i||(i=event)).srcElement||i.target);if(g){a.showAmlNode(g);apf.$debugwin.highlightAmlNode(null,true);c.setValue(false);document.onmousemove=document.onmousedown=null;}};},highlightAmlNode:function(d,a,c){if(a){if(this.$hdiv){this.$hdiv.style.display="none";}return;}if(!d){return;}if(!this.$hdiv){apf.importCssString(".apf_highlight_div{                    background : #004eff;                    position   : absolute;                    z-index    : 1000000;                    opacity    : 0.3;                }                .apf_border_div{                    background : url(images/spacer.gif);                    position   : absolute;                    z-index    : 1000000;                    border     : 1px solid blue;                }");this.$hdiv=document.body.appendChild(document.createElement("div"));this.$hdiv.style.display="none";}apf.setStyleClass(this.$hdiv,c?"apf_border_div":"apf_highlight_div",["apf_border_div","apf_highlight_div"]);if(false&&d.tagName=="html"){this.$hdiv.style.left="0px";this.$hdiv.style.top="0px";this.$hdiv.style.width="100%";this.$hdiv.style.height="100%";this.$hdiv.style.display="block";}else{if(d.$ext&&(d.$ext.offsetHeight||d.$ext.offsetWidth)){var i=apf.getAbsolutePosition(d.$ext);this.$hdiv.style.left=i[0]+"px";this.$hdiv.style.top=i[1]+"px";var g=apf.getDiff(this.$hdiv);this.$hdiv.style.width=(d.$ext.offsetWidth-g[0])+"px";this.$hdiv.style.height=(d.$ext.offsetHeight-g[1])+"px";this.$hdiv.style.display="block";}else{this.$hdiv.style.display="none";}}},showObject:function(g,c,d){tabDebug.set(1);pgBrowse.set(2);txtCurObject.setValue(c);trObject.clear("loading");var a=this;setTimeout(function(){if(!g&&g!==0){$apf_ide_mdlObject.load(a.analyze(d,c,c));}else{$apf_ide_mdlObject.load(a.analyze(a.apf.$debugwin.cache[g],"apf.$debugwin.cache["+g+"]",c));}},10);},types:["Object","Number","Boolean","String","Array","Date","RegExp","Function","Object"],domtypes:[null,"Element","Attr","Text","CDataSection","EntityReference","Entity","ProcessingInstruction","Comment","Document","DocumentType","DocumentFragment","Notation"],calcName:function(d,i){var a,c=d.tagName=="method"?d.parentNode:d,g=[];do{a=i?c.getAttribute("display")||c.getAttribute("name"):c.getAttribute("name");if(!a){break;}g.unshift(!a.match(/^[a-z_\$][\w_\$]*$/i)?(parseInt(a)==a?"["+a+"]":'["'+a.replace(/'/g,"\\'")+'"]'):a);c=c.parentNode;}while(c&&c.nodeType==1);if(g[0].charAt(0)=="["){g[0]=g[0].substr(2,g[0].length-4);}return g.join(".").replace(/\.\[/g,"[");},analyze:function(pNode,ref,displayName){var item,prop;if(pNode&&!pNode.dataType&&pNode.nodeType&&"item|method".indexOf(pNode.tagName)>-1){var name,loopNode=pNode.tagName=="method"?pNode.parentNode:pNode,path=[];do{name=loopNode.getAttribute("name");if(!name){break;}path.unshift("['"+name.replace(/'/g,"\\'")+"']");loopNode=loopNode.parentNode;}while(loopNode&&loopNode.nodeType==1);path[0]=path[0].substr(2,path[0].length-4);o=self.parent.eval(path.join(""));}else{o=pNode;pNode=null;}if(pNode&&pNode.tagName=="method"){var xml=apf.getXml("<method />");var doc=xml.ownerDocument;for(prop in o){if(typeof o[prop]=="function"&&prop.charAt(0)!="$"){item=xml.appendChild(doc.createElement("method"));item.setAttribute("name",prop);item.setAttribute("type","Function");item.setAttribute("value",prop+o[prop].toString().match(/function\s*[\w-]*(\([\s\S]*?\))/)[1]);}}return xml;}if(!pNode){var xml=apf.getXml("<obj />");var n={};n[displayName]=o;if(typeof o=="object"||o&&o.dataType==apf.ARRAY){n.$isSingleValue=true;}o=n;}else{var xml=apf.getXml("<item "+(ref?"name='"+ref+"'":"")+(displayName?' display="'+displayName.replace(/"/g,"&quot;")+'"':"")+" expand='true' />");}var doc=xml.ownerDocument;try{prop in o;}catch(e){return xml;}for(prop in o){obj=o[prop];if(prop.charAt(0)=="$"||prop.substr(0,2)=="a_"){continue;}if(typeof obj=="function"&&(o.dataType!=apf.ARRAY||prop!=parseInt(prop))){hasMethods=true;continue;}item=xml.appendChild(doc.createElement("item"));item.setAttribute("name",prop);if(typeof obj=="undefined"||obj==null){item.setAttribute("value",String(obj));item.setAttribute("type",String(obj));item.setAttribute("numtype",0);continue;}if(this.types[obj.dataType]){item.setAttribute("type",this.types[obj.dataType]);}var hasProperties=null;try{for(hasProperties in obj){break;}}catch(e){hasProperties=true;}item.setAttribute("numtype",obj.dataType||(hasProperties?8:0));var str,hasMethods;switch(obj.dataType){case apf.STRING:if(obj.length>10000){item.setAttribute("value","String of "+obj.length+" bytes (too large to display)");}else{item.setAttribute("value",'"'+obj.replace(/"/g,'\\"').replace(/</g,"&lt;").replace(/\n/g,"\\n").replace(/\r/g,"\\r")+'"');}break;case apf.NUMBER:item.setAttribute("value",obj);break;case apf.BOOLEAN:item.setAttribute("value",obj?"true":"false");break;case apf.DATE:item.setAttribute("value","["+obj.toString()+"]");break;case apf.FUNCTION:item.setAttribute("value",prop+o[prop].toString().match(/function\s*[\w-]*(\([\s\S]*?\))/)[1]);break;case apf.ARRAY:item.setAttribute("value","("+obj.length+" items)");break;default:item.setAttribute("value","{"+(obj.nodeType==2?"@"+obj.nodeName:(obj.nodeType!=1&&obj.nodeName?obj.nodeName+" Node":(obj.tagName?obj.tagName+" Element":"...")))+"}");if(obj.nodeType!==undefined&&typeof obj.style=="object"){item.setAttribute("type",obj.nodeType==1?"HTML"+obj.tagName.toLowerCase().uCaseFirst()+"Element":"HTML"+this.domtypes[obj.nodeType]);}else{if(obj.nodeType!==undefined){var s;if(obj.$regbase&apf.__AMLNODE__){if(obj.nodeType==1){if(obj.namespaceURI==apf.ns.xhtml){item.setAttribute("type","apf.Xhtml"+obj.localName.uCaseFirst()+"Element");break;}else{if(obj.namespaceURI==apf.ns.xsd){item.setAttribute("type","apf.Xsd"+obj.localName.uCaseFirst()+"Element");break;}}}item.setAttribute("type",obj.nodeType==1?"apf."+obj.localName:"apf.Aml"+this.domtypes[obj.nodeType]);break;}item.setAttribute("type","XML"+this.domtypes[obj.nodeType]);}else{item.setAttribute("type","Object");}}break;}}if(!pNode&&displayName){xml.firstChild.setAttribute("display",displayName);xml.firstChild.setAttribute("expand","true");if(o.$isSingleValue){apf.mergeXml(this.analyze(xml.firstChild,name),xml.firstChild);}}if(hasMethods){xml.insertBefore(doc.createElement("method"),xml.firstChild).setAttribute("name","[Methods]");}return doc.documentElement;},checkChange:function(a){var c=a.getAttribute("value");if(a.tagName=="method"||"Boolean|String|undefined|null|Number".indexOf(a.getAttribute("type"))==-1){return false;}},applyChange:function(xmlNode){var value=xmlNode.getAttribute("value");var name=this.calcName(xmlNode);try{if(name.indexOf(".")>-1){var prop,obj=self.parent.eval(name.replace(/\.([^\.\s]+)$/,""));if(obj&&obj.$supportedProperties&&obj.$supportedProperties.contains(prop=RegExp.$1)){obj.setProperty(prop,self.parent.eval(value));return;}}self.parent.eval(name+" = "+value);}catch(e){trObject.getActionTracker().undo();alert("Invalid Action: "+e.message);}},showXmlNode:function(a){tabDebug.set(1);pgBrowse.set(1);var d=apf.xmldb.$xmlDocLut;var g=a.ownerDocument.documentElement;var k=a.getAttribute(apf.xmldb.xmlIdTag);var c=k.split("|")[0];if(!d[c]){d[c]=g;}else{if(d[c]!=g){var j=this.apf.nameserver.get("model",c);d[c]=g;var i=apf.nameserver.get("model",c);apf.xmldb.getXmlDocId(g,i);if(j){apf.nameserver.register("model",c,j);}}}mrkData.load(a);},jRunCode:function(code,scripttype,model){apf.storage.put("jsexec",code);apf.storage.put("scriptype",scripttype);apf.storage.put("mdlvalue",model);var islm=scripttype=="Live Markup";this.apf.console.write("<span style='color:blue'><span style='float:left'>&gt;&gt;&gt;</span><div style='margin:0 0 0 30px'>"+code.replace(/ /g,"&nbsp;").replace(/\t/g,"&nbsp;&nbsp;&nbsp;").replace(/</g,"&lt;").replace(/\n/g,"\n<br />")+"</div></span>","custom",null,null,null,true);var _self=this;var doIt=function(data){if(islm){var func=apf.$debugwin.apf.lm.compile(code,{parsecode:true});if(model){if(data=apf.$debugwin.apf.nameserver.get("model",model)){data=data.data;}if(!data){var data=apf.getData(model,{callback:function(data,state,extra){if(state==apf.SUCCESS){doIt(data);}else{throw new Error();}}});return;}}var x=func(data);}else{var x=self.parent.eval(code);}var s=_self.$serializeObject(x,code);if(typeof s=="string"){_self.apf.console.write(s,"custom",null,null,null,true);}else{_self.apf.console.write(x?"Could not serialize object: "+s.message:x,"error",null,null,null,true);}};if(apf.$debugwin.nativedebug){doIt();}else{try{doIt();}catch(e){this.apf.console.write(e.message,"error",null,null,null,true);}}},$serializeObject:function(a,d){if(a===null){a="null";}else{if(a===undefined){a="undefined";}}try{var i;if(a.nodeType&&(a.nodeType==1||a.nodeType==7)&&!a.style){if(a.serialize){i="<a class='xmlhl' href='javascript:void(0)' onmouseout='if (cbHighlightHover.checked) apf.$debugwin.apf.$debugwin.highlightAmlNode(null, true)' onmouseover='apf.$debugwin.apf.$debugwin.highlightAmlNode(apf.$debugwin.apf.all["+a.$uniqueId+"])' onclick='apf.$debugwin.showAmlNode(apf.$debugwin.apf.all["+a.$uniqueId+"])'>"+apf.highlightXml(a.serialize().split(">")[0]+">").replace(/<\/?a(?:>| [^>]*>)/g,"")+"</a>";}else{i="<a class='xmlhl' href='javascript:void(0)' onclick='apf.$debugwin.showXmlNode(apf.$debugwin.cache["+(apf.$debugwin.cache.push(a)-1)+"])'>"+apf.highlightXml(apf.getCleanCopy(a).xml.split(">")[0]+">")+"</a>";}return i;}else{if(typeof a=="object"){if(a.dataType==apf.ARRAY){var c=["Array { length: "+a.length];}else{var c=[a.toString(),"{"];for(prop in a){if(c.length==5){c.push("more...");break;}if(typeof a[prop]!="function"&&typeof a[prop]!="object"&&a[prop]&&prop.substr(0,1)!="$"){c.push(prop+"="+a[prop]+", ");}}}return"<a class='xmlhl' href='javascript:void(0)' style='font-weight:bold;font-size:7pt;color:green' onclick='apf.$debugwin.showObject("+(this.apf.$debugwin.cache.push(a)-1)+', "'+d.split(";").pop()+"\")'>"+c.join(" ")+" }</a>";}else{i=a.toString();return i.replace(/</g,"&lt;").replace(/\n/g,"\n<br />");}}}catch(g){return g;}},consoleTextHandler:function(a){if(a.keyCode==9&&a.currentTarget==txtCode){txtCode.focus();a.cancelBubble=true;return false;}else{if(a.keyCode==13&&a.ctrlKey){apf.$debugwin.jRunCode(txtCode.value,codetype.value,txtModel.value);return false;}}},setShowTime:function(a){apf.storage.put("apfdebug_console_date",a);apf.setStyleRule(".console_date","display",a?"inline":"none");this.showtime=a;},setNativeDebug:function(a){apf.storage.put("apfdebug_debugger",a);this.nativedebug=a;window.onerror=this.nativedebug?null:this.errorHandler;},setHighlightHover:function(a){apf.storage.put("apfdebug_highlight_hover",a);this.highlighthover=a;},first:true,show:function(){if(apf.isDebugWindow){return;}if(apf.loadScreen){apf.loadScreen.hide();}if(this.first){if(apf.isIE){apf.setStyleRule("BODY","overflow","",0);p=apf.getBox(apf.getStyle(document.body,"padding"));m=apf.getBox(apf.getStyle(document.body,"margin"));o=[apf.getStyle(document.documentElement,"overflow"),apf.getStyle(document.documentElement,"overflowX"),apf.getStyle(document.documentElement,"overflowY")];}else{p=[parseInt(apf.getStyle(document.body,"padding-top")),parseInt(apf.getStyle(document.body,"padding-right")),parseInt(apf.getStyle(document.body,"padding-bottom")),parseInt(apf.getStyle(document.body,"padding-left"))];m=[parseInt(apf.getStyle(document.body,"margin-top")),parseInt(apf.getStyle(document.body,"margin-right")),parseInt(apf.getStyle(document.body,"margin-bottom")),parseInt(apf.getStyle(document.body,"margin-left"))];o=[apf.getStyleRule("html","overflow")||"auto",apf.getStyleRule("html","overflow-x")||"auto",apf.getStyleRule("html","overflow-y")||"auto"];}this.resPath=(apf.config.resourcePath||apf.basePath)+"resources/";apf.importCssString("                html{                    height : 100%;                    overflow : hidden;                    overflow-x : hidden;                    overflow-y : hidden;                    margin-bottom : "+(p[0]+m[0]+p[2]+m[2])+"px;                }                body{                    position : absolute;                    left : 0;                    top : 0;                    right : 0;                    bottom : 300px;                    margin:0;                    overflow  : "+o[0]+";                    overflow-x : "+o[1]+";                    overflow-y : "+o[2]+";                    padding : "+(p[0]+m[0])+"px "+(p[1]+m[1])+"px "+(p[2]+m[2])+"px "+(p[3]+m[3])+"px;                    width : auto;                }                #apf_debugwin {                    position: fixed;                    bottom: 0px;                    text-align: left;                    height: 300px;                    background: #fff url("+this.resPath+"splitter_handle_vertical.gif) no-repeat 1px 50%;                    width : 100%;                    left: 0px;                    z-index: 100000000;                }            ");document.documentElement.style.overflow="hidden";this.first=false;document.body.insertAdjacentHTML("beforeend","<div id='apf_debugwin'><iframe frameborder='0' width='100%' height='100%' /></div>");this.$iframe=(this.$ext=document.getElementById("apf_debugwin")).firstChild;this.$iframe.isDebugWin=true;apf.getWindowWidth=function(){return document.body.offsetWidth;};apf.getWindowHeight=function(){return document.body.offsetHeight;};setTimeout(function(){apf.$debugwin.$iframe.src=apf.basePath+"debugwin/debugwin.html";});}this.$ext.style.display="block";document.body.style.bottom="300px";},hide:function(){this.$ext.style.display="none";document.body.style.bottom="0";},activate:function(){this.show();}};apf.BindingRule=function(c,a){this.$init(a||true,apf.NODE_HIDDEN,c);};(function(){this.$bindingRule=true;this.compile=function(a){return(this["c"+a]=apf.lm.compile(this[a],{xpathmode:3,injectself:true}));};this.$compile=function(c,a){return(this["c"+c+"2"]=apf.lm.compile(this[c],a));};this.$attrExcludePropBind=apf.extend({value:1,match:1},this.$attrExcludePropBind);this.$propHandlers.value=this.$propHandlers.match=function(c,d){delete this["c"+d];if(this.$amlLoaded){var a=this;while(a&&a.$bindingRule){a=a.parentNode;}if(!a){return;}apf.queue.add("reload"+a.$uniqueId,function(){a.reload();});if(a.$bindings.$isCompiled){a.$bindings.$compiled=a.$bindings.compile(this.localName!="each"&&this.localName);}}};this.addEventListener("DOMNodeInserted",function(c){var a=this;while(a.$bindingRule){a=a.parentNode;}apf.queue.add("reload"+a.$uniqueId,function(){a.reload();});if(c.currentTarget==this){(a.$bindings[this.localName]||(a.$bindings[this.localName]=[])).push(this);}else{if(!this.attributes.getNamedItem("value")){this.value=apf.serializeChildren(this);}else{return;}}if(a.$bindings.$isCompiled){a.$bindings.$compiled=a.$bindings.compile(this.localName!="each"&&this.localName);}});this.addEventListener("DOMNodeRemoved",function(c){var d,a=this;while(a&&a.$bindingRule){a=a.parentNode;}if(!a){return;}if(c.currentTarget==this){if(a.$bindings&&a.$bindings[this.localName]){a.$bindings[this.localName].remove(this);}else{return;}}else{if(!this.attributes.getNamedItem("value")&&(d=this.firstChild)){if(d.nodeType==this.NODE_PROCESSING_INSTRUCTION){if(d.target=="lm"){this.value="{"+d.nodeValue+"}";}else{this.value=d.nodeValue;}}else{this.value=apf.serializeChildren(this).trim();}}else{return;}}apf.queue.add("reload"+a.$uniqueId,function(){if(!a.$amlDestroyed){a.reload();}});if(a.$bindings.$isCompiled){a.$bindings.$compiled=a.$bindings.compile(this.localName!="each"&&this.localName);}});this.addEventListener("DOMNodeInsertedIntoDocument",function(d){if(!this.match&&(!this.value&&!this.childNodes.length&&!this.get||this.localName=="each")||this.select){throw new Error(apf.formatErrorString(0,this,"Bindingrule","Missing attribute 'match'"));}var g;if(!this.value&&(g=this.$aml&&this.$aml.firstChild||this.firstChild)){if(g.nodeType==this.NODE_PROCESSING_INSTRUCTION){if(g.target=="lm"){this.value="{"+g.nodeValue+"}";}else{this.value=g.nodeValue;}}else{this.value=apf.serializeChildren(this.$aml).trim();}}var a=this.parentNode;while(a.$bindingRule){a=a.parentNode;}var i=a.$bindings||(a.$bindings=new apf.ruleList());(i[this.localName]||(i[this.localName]=[])).push(this);if(a.localName!="bindings"&&(this.localName!="each"||!this.childNodes.length)){var c=this;while((c=c.nextSibling)&&c.nodeType!=1){}if(!c||!c.$bindingRule){a.$cbindings=a.$bindings.compile(a.$bindings.$isCompiled?this.localName:null);a.dispatchEvent("bindingsload",{bindings:a.$bindings,compiled:a.$cbindings});a.$checkLoadQueue();}}});}).call(apf.BindingRule.prototype=new apf.AmlElement());apf.aml.setElement("icon",apf.BindingRule);apf.aml.setElement("image",apf.BindingRule);apf.aml.setElement("caption",apf.BindingRule);apf.aml.setElement("css",apf.BindingRule);apf.aml.setElement("selectable",apf.BindingRule);apf.aml.setElement("value",apf.BindingRule);apf.aml.setElement("src",apf.BindingRule);apf.aml.setElement("collapsed",apf.BindingRule);apf.aml.setElement("expanded",apf.BindingRule);apf.aml.setElement("empty",apf.BindingRule);apf.ActionRule=function(c,a){this.$init(a||true,apf.NODE_HIDDEN,c);};(function(){this.$actionRule=true;this.compile=function(c,a){return(this["c"+c]=apf.lm.compile(this[c],a||{xpathmode:2}));};this.$attrExcludePropBind=apf.extend({set:1,get:1,undo:1,lock:1,match:1,parent:1},this.$attrExcludePropBind);this.$propHandlers.set=this.$propHandlers.get=this.$propHandlers.parent=this.$propHandlers.match=function(a,c){delete this["c"+c];};this.addEventListener("DOMNodeInserted",function(c){if(c.currentTarget==this){var a=this.parentNode;if(!a.$actions){a.$actions=new apf.ruleList();}(a.$actions[this.localName]||(a.$actions[this.localName]=[])).push(this);}else{if(this.attributes.getNamedItem("value")){return;}this.value=apf.serializeChildren(this);}});this.addEventListener("DOMNodeRemoved",function(a){if(a.currentTarget==this){this.parentNode.$actions[this.localName].remove(this);}else{if(this.attributes.getNamedItem("value")){return;}this.value=apf.serializeChildren(this);}});this.addEventListener("DOMNodeInsertedIntoDocument",function(a){if(!this.get){this.get=apf.serializeChildren(this.$aml).trim();}var c=this.parentNode.$actions||(this.parentNode.$actions=new apf.ruleList());(c[this.localName]||(c[this.localName]=[])).push(this);});}).call(apf.ActionRule.prototype=new apf.AmlElement());apf.aml.setElement("rename",apf.ActionRule);apf.aml.setElement("remove",apf.ActionRule);apf.aml.setElement("add",apf.ActionRule);apf.aml.setElement("update",apf.ActionRule);apf.aml.setElement("copy",apf.ActionRule);apf.aml.setElement("move",apf.ActionRule);apf.radio=function(c,a){this.$init(a||"radio",apf.NODE_HIDDEN,c);};apf.check=function(c,a){this.$init(a||"check",apf.NODE_HIDDEN,c);};apf.item=function(c,a){this.$init(a||"item",apf.NODE_HIDDEN,c);};(function(){this.$focussable=false;this.$childProperty="caption";this.$canLeechSkin="item";this.implement(apf.ChildValue);this.$attrExcludePropBind=apf.extend({match:1},this.$attrExcludePropBind);this.$supportedProperties.push("submenu","value","match","group","icon","checked","selected","disabled","caption");this.$propHandlers.submenu=function(c){apf.setStyleClass(this.$ext,"submenu");};this.$propHandlers.select=function(c){this.select=c?"self::"+c.split("|").join("|self::"):c;};this.$propHandlers.hotkey=function(d){if(this.$hotkey){apf.setNodeValue(this.$hotkey,d);}if(this.$lastHotkey){apf.removeHotkey(this.$lastHotkey);}if(d){this.$lastHotkey=d;var c=this;apf.registerHotkey(d,function(){if(c.disabled||!c.visible){return;}var k=apf.document.getElementsByTagNameNS(apf.ns.aml,"button");for(var j=0;j<k.length;j++){if(k[j].submenu==c.parentNode.name){var g=k[j];g.$setState("Over",{});$setTimeout(function(){g.$setState("Out",{});},200);break;}}c.$down();c.$up();c.$click();});}};this.$propHandlers.icon=function(c){if(this.$icon){apf.skins.setIcon(this.$icon,c,this.parentNode.iconPath);}};this.$propHandlers.caption=function(c){if(this.$caption){apf.setNodeValue(this.$caption,c);}};this.$propHandlers.checked=function(c){if(this.localName!="check"){return;}if(apf.isTrue(c)){apf.setStyleClass(this.$ext,"checked");}else{apf.setStyleClass(this.$ext,"",["checked"]);}};this.$propHandlers.selected=function(c){if(this.localName!="radio"){return;}if(apf.isTrue(c)){apf.setStyleClass(this.$ext,"selected");}else{apf.setStyleClass(this.$ext,"",["selected"]);}};this.$propHandlers.disabled=function(c){if(apf.isTrue(c)){apf.setStyleClass(this.$ext,"disabled");}else{apf.setStyleClass(this.$ext,"",["disabled"]);}};this.enable=function(c){apf.setStyleClass(this.$ext,this.parentNode.$baseCSSname+"Disabled");};this.disable=function(c){apf.setStyleClass(this.$ext,null,[this.parentNode.$baseCSSname+"Disabled"]);};this.show=function(){this.$ext.style.display="block";};this.hide=function(){this.$ext.style.display="none";};this.addEventListener("AMLReparent",function(c,g,d){if(!this.$amlLoaded){return;}if(!d&&this.skinName!=g.skinName){this.loadAml();}});this.$down=function(){};this.$up=function(){if(this.localName=="radio"){this.parentNode.select(this.group,this.value||this.caption);}else{if(this.localName=="check"){this.$handlePropSet("checked",!this.checked);}}if(this.submenu){this.$over(null,true);return;}this.parentNode.$hideTree=true;this.parentNode.hide();this.parentNode.dispatchEvent("itemclick",{value:this.value||this.caption});};this.$click=function(){this.dispatchEvent("click",{xmlContext:this.parentNode.xmlReference,opener:this.parentNode.opener});};var a;this.$out=function(d){if(apf.isChildOf(this.$ext,d.toElement||d.explicitOriginalTarget)||apf.isChildOf(this.$ext,d.srcElement||d.target)){return;}clearTimeout(a);if(!this.submenu||this.$submenu(true)){apf.setStyleClass(this.$ext,"",["hover"]);var c=this.parentNode.$selected;if(c&&c!=this){apf.setStyleClass(c.$ext,"",["hover"]);}this.parentNode.$selected=null;}};this.$over=function(g,d){if(this.parentNode.$selected==this){return;}if(this.parentNode.$selected){apf.setStyleClass(this.parentNode.$selected.$ext,"",["hover"]);}apf.setStyleClass(this.$ext,"hover");this.parentNode.$selected=this;if(!d&&(apf.isChildOf(this.$ext,g.toElement||g.explicitOriginalTarget)||apf.isChildOf(this.$ext,g.fromElement||g.target))){return;}var i=this.parentNode.$showingSubMenu;if(i){if(i.name==this.submenu){return;}i.hide();this.parentNode.$showingSubMenu=null;}if(this.submenu){if(d){this.$submenu();}else{var c=this;clearTimeout(a);a=$setTimeout(function(){c.$submenu();a=null;},200);}}};this.$submenu=function(c,d){if(!this.submenu){return true;}var g=self[this.submenu];if(!g){throw new Error(apf.formatErrorString(0,this,"Displaying submenu","Could not find submenu '"+this.submenu+"'",this.$aml));return;}if(!c){this.parentNode.$showingSubMenu=g;var i=apf.getAbsolutePosition(this.$ext,this.parentNode.$ext.offsetParent);g.display(i[0]+this.$ext.offsetWidth-3,i[1]+3,false,this,this.parentNode.xmlReference,this.parentNode.$uniqueId);g.setAttribute("zindex",(this.parentNode.zindex||1)+1);}else{if(g.visible&&!d){return false;}if(this.parentNode.$showingSubMenu){this.parentNode.$showingSubMenu=null;}apf.setStyleClass(this.$ext,"",["hover"]);g.hide();return true;}};this.$draw=function(d){var i=this.parentNode;while(i.$canLeechSkin=="item"){i=i.parentNode;}if(i.hasFeature(apf.__MULTISELECT__)){var c=this;if(!this.$hasSetSkinListener){var g;this.parentNode.addEventListener("$skinchange",g=function(){if(c.$amlDestroyed){return;}if(c.$ext.parentNode){this.$deInitNode(c,c.$ext);}var n=i==c.parentNode?i.$container:c.parentNode.$container;var k=n.lastChild;i.$add(c,c.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId,c.parentNode,n!=i.$container&&n,null);i.$fill();if(i.$isTreeArch){c.$container=i.$getLayoutNode("item","container",c.$ext=k&&k.nextSibling||n.firstChild);}else{c.$ext=k&&k.nextSibling||n.firstChild;}var j=c;while((j=j.nextSibling)&&j.nodeType!=1){}if(!j||j.$canLeechSkin!="item"){i.dispatchEvent("afterload");}});this.addEventListener("DOMNodeRemoved",function(j){this.parentNode.removeEventListener("$skinchange",g);});this.$hasSetSkinListener=true;}if(!i.$itemInited){i.canrename=false;i.$removeClearMessage();i.$itemInited=[i.getTraverseNodes,i.getFirstTraverseNode,i.getTraverseParent];i.getTraverseNodes=function(j){return(j||i).getElementsByTagNameNS(apf.ns.apf,"item");};i.getFirstTraverseNode=function(j){return(j||i).getElementsByTagNameNS(apf.ns.apf,"item")[0];};i.getTraverseParent=function(j){return j&&j.parentNode;};i.each=(this.prefix?this.prefix+":":"")+"item";i.$preventDataLoad=true;i.$initingModel=true;i.$setDynamicProperty("icon","[@icon]");i.$setDynamicProperty("image","[@image]");i.$setDynamicProperty("caption","[label/text()|@caption|text()]");i.$setDynamicProperty("eachvalue","[value/text()|@value|text()]");i.$canLoadDataAttr=false;if(!i.xmlRoot){i.xmlRoot=i;}}this.$loadAml=function(){if(!this.getAttribute("caption")){this.setAttribute("caption",this.caption);}var n=i==this.parentNode?i.$container:this.parentNode.$container;var k=n.lastChild;if(!i.documentId){i.documentId=apf.xmldb.getXmlDocId(this);}i.$add(this,apf.xmldb.nodeConnect(i.documentId,this,null,i),this.parentNode,n!=i.$container&&n,null);i.$fill();if(i.$isTreeArch){this.$container=i.$getLayoutNode("item","container",this.$ext=k&&k.nextSibling||n.firstChild);}else{this.$ext=k&&k.nextSibling||n.firstChild;}var j=this;while((j=j.nextSibling)&&j.nodeType!=1){}if(!j||j.$canLeechSkin!="item"){i.dispatchEvent("afterload");if(i.autoselect){i.$selectDefault(this.parentNode);}}};return;}this.$ext=this.$getExternal(this.$isLeechingSkin?"item":"main",null,function(j){var k="var o = apf.lookup("+this.$uniqueId+"); if (o.disabled) return; o";j.setAttribute("onmouseup",k+".$up(event)");j.setAttribute("onmousemove",k+".$over(event)");j.setAttribute("onmouseout",k+".$out(event)");j.setAttribute("onmousedown",k+".$down()");j.setAttribute("onclick",k+".$click()");});apf.setStyleClass(this.$ext,this.localName);this.$caption=this.$getLayoutNode("item","caption",this.$ext);this.$icon=this.$getLayoutNode("item","icon",this.$ext);this.$hotkey=this.$getLayoutNode("item","hotkey",this.$ext);if(!d&&this.nextSibling&&this.nextSibling.$ext){this.$ext.parentNode.insertBefore(this.$ext,this.nextSibling.$ext);}};this.addEventListener("DOMNodeInsertedIntoDocument",function(d){var c=this.$ext?true:false;if(c){if(typeof this.checked!=="undefined"){this.$handlePropSet("checked",this.checked);}else{if(typeof this.selected!=="undefined"){this.$handlePropSet("selected",this.selected);}}if(this.disabled){this.$handlePropSet("disabled",this.disabled);}if(this.caption){this.$handlePropSet("caption",this.caption);}}});}).call(apf.item.prototype=new apf.Presentation());apf.radio.prototype=apf.check.prototype=apf.item.prototype;apf.aml.setElement("radio",apf.radio);apf.aml.setElement("check",apf.check);apf.aml.setElement("item",apf.item);apf.actiontracker=function(c,a){this.$init(a||"actiontracker",apf.NODE_HIDDEN,c);this.$undostack=[];this.$redostack=[];this.$execstack=[];};(function(){this.$lastExecStackItem=null;this.realtime=true;this.undolength=0;this.redolength=0;this.$booleanProperties={};this.$booleanProperties.realtime=true;this.$supportedProperties=["realtime","undolength","redolength","alias","length","position"];this.$handlePropSet=function(g,d,c){switch(g){case"undolength":this.undolength=this.$undostack.length;break;case"redolength":this.redolength=this.$redostack.length;break;default:this[g]=d;}};this.addEventListener("DOMNodeInsertedIntoDocument",function(c){if(this.parentNode){this.parentNode.$at=this;}});this.define=function(d,c){apf.actiontracker.actions[d]=c;};this.getParent=function(){return this.parentNode&&this.parentNode.getActionTracker?this.parentNode.getActionTracker(true):(apf.window.$at!=this?apf.window.$at:null);};this.getDone=function(g){if(typeof g!="number"){return[];}for(var j,c,d=c=this.$stackDone.length;d>=0;--d){if(!(j=this.$stackDone[d])||!j.timestamp){continue;}if(j.timestamp>=g){return this.$stackDone.slice(d);}}return[];};this.getUndone=function(g){if(typeof g!="number"){return[];}for(var j,d=0,c=this.$stackDone.length;d<c;++d){if(!(j=this.$stackUndone[d])||!j.timestamp){continue;}if(j.timestamp<=g){return this.$stackUndone.slice(0,d+1);}}return[];};this.execute=function(c){if(this.dispatchEvent("beforechange",c)===false){return false;}var d=new apf.UndoData(c,this);if(c.action&&!c.transaction){apf.actiontracker.actions[c.action](d,false,this);}d.id=this.$undostack.push(d)-1;this.setProperty("undolength",this.$undostack.length);if(d.multiple){this.$addToQueue(d.multiple,false,true);}else{this.$addToQueue(d,false);}this.$redostack.length=0;this.setProperty("redolength",this.$redostack.length);this.dispatchEvent("afterchange",{action:"do"});return d;};this.purge=function(d,c){if(true){if(this.$execstack.length){this.$execstack[0].undoObj.saveChange(this.$execstack[0].undo,this);this.$lastExecStackItem=this.$execstack[this.$execstack.length-1];}}else{if(parent){this.reset();}}};this.reset=function(){this.$undostack.length=this.$redostack.length=0;this.setProperty("undolength",0);this.setProperty("redolength",0);this.dispatchEvent("afterchange",{action:"reset"});};this.undo=function(g,d,c){a.call(this,g,d,true,c);};this.redo=function(g,d,c){a.call(this,g,d,false,c);};function a(s,q,d,c){var g=d?this.$undostack:this.$redostack,n=d?this.$redostack:this.$undostack;if(!g.length){return;}if(q){var k=g[s];if(!k){return;}if(s!=g.length-1){throw new Error("callstack got corrupted");}g.length--;n.push(k);if(k.action){apf.actiontracker.actions[k.action](k,d,this);}if(!c){if(k.multiple){this.$addToQueue(k.multiple,d,true);}else{this.$addToQueue(k,d);}}this.setProperty("undolength",this.$undostack.length);this.setProperty("redolength",this.$redostack.length);return k;}if(this.dispatchEvent("beforechange")===false){return;}apf.console.info("Executing "+(d?"undo":"redo"));if(s==-1){s=g.length;}if(!s){s=1;}var j=0;while(j<s&&g.length>0){if(!g[g.length-1]){g.length--;apf.console.error("The actiontracker is in an invalid                                    state. The entire undo and redo stack will                                    be cleared to prevent further corruption                                   This is a serious error, please contact                                    the system administrator.");this.$undostack=[];this.$redostack=[];return false;}else{a.call(this,g.length-1,true,d,c);j++;}}this.dispatchEvent("afterchange",{action:d?"undo":"redo",rollback:c});}this.$receive=function(i,g,c,d,k){if(g==apf.TIMEOUT&&c.tpModule.retryTimeout(c,g,this)===true){return true;}if(g!=apf.SUCCESS){if(this.dispatchEvent("actionfail",apf.extend(c,{state:g,message:"Could not sent Action RPC request for control "+this.name+"["+this.localName+"] \n\n"+c.message,bubbles:true}))===false){apf.console.warn("You have cancelled the automatic undo                     process! Please be aware that if you don't retry this call                     the queue will fill up and none of the other actions will                     be sent through.");return true;}if(typeof apf.offline!="undefined"&&!apf.offline.reloading){this.undo(d.id,c.userdata,true);}if(k){k(!c.userdata);}if(!c.userdata){this.$execstack=[];var j=new Error(apf.formatErrorString(0,this,"Executing action","Error sending action to the server:\n"+(c.url?"Url:"+c.url+"\n\n":"")+c.message));if((d&&d.xmlActionNode||c.amlNode||apf).dispatchEvent("error",apf.extend({error:j,state:g,bubbles:true},c))===false){return;}throw j;}}else{this.dispatchEvent("actionsuccess",apf.extend(c,{state:g,bubbles:true},c));if(k){k();}}this.$queueNext(d,k);};this.$addToQueue=function(j,d,q){if(!q&&this.$execstack.length&&!j.state&&this.$execstack[this.$execstack.length-1].undoObj==j){this.$execstack.length--;return;}var c,k,n;if(q){var k,n=this.$execstack.shift();for(var g=0;g<j.length;g++){k=j[g];this.$execstack.unshift({undoObj:(k.tagName?k:new apf.UndoData(k,this)).preparse(d,this),undo:d});}if(n){this.$execstack.unshift(n);}return;}n={undoObj:j.preparse(d,this),undo:d};this.$execstack.push(n)-1;if(this.$execstack.length==1&&this.realtime){j.saveChange(d,this);}};this.$queueNext=function(d,g){if(!this.$execstack[0]||this.$execstack[0].undoObj!=d){throw new Error(apf.formatErrorString(0,this,"Executing Next                 action in queue","The execution stack was corrupted. This is                 a fatal error. The application should be restarted. You will                 lose all your changes. Please contact the administrator."));}d.state=null;var c=this.$execstack.shift();if(!this.$execstack[0]||c==this.$lastExecStackItem){return;}this.$execstack[0].undoObj.saveChange(this.$execstack[0].undo,this,g);};}).call(apf.actiontracker.prototype=new apf.AmlElement());apf.aml.setElement("actiontracker",apf.actiontracker);apf.param=function(c,a){this.$init(a||"param",apf.NODE_HIDDEN,c);};apf.param.prototype=new apf.AmlElement();apf.param.prototype.$parsePrio="002";apf.aml.setElement("variable",apf.param);apf.aml.setElement("param",apf.param);apf.datagrid=function(c,a){this.$init(a||"datagrid",apf.NODE_VISIBLE,c);this.$headings=[],this.$cssRules=[];this.$lastOpened={};this.$editors={};this.$dynCssClasses=[];};(function(){var c=1<<1,g=1<<2,i=1<<3,j=1<<4,d=this.$treeState;this.bufferselect=false;this.$useTable=false;this.$focussable=true;this.$isWindowContainer=-1;this.$widthdiff=0;this.$defaultwidth=0;this.$useiframe=0;this.$needsDepth=true;this.canrename=false;this.$booleanProperties.iframe=true;function a(s,t){for(var q=0;q<s.length;q++){if(!s[q][1]){continue;}if(apf.isIE){(t||window).document.styleSheets[0].addRule(s[q][0],s[q][1]);}else{(t||window).document.styleSheets[0].insertRule(s[q][0]+" {"+s[q][1]+"}",0);}}}function n(){var q=(this.current||this.$selected),s=this.$container;s.scrollTop=(q.offsetTop)-21;}this.$focus=function(){if(!this.$ext||(apf.isIE&&this.$useiframe&&this.cssfix)){return;}this.$setStyleClass(this.$ext,this.$baseCSSname+"Focus");if(this.oDoc){this.$setStyleClass(this.oDoc.documentElement,this.$baseCSSname+"Focus");}};this.$blur=function(){if(!this.$ext||(apf.isIE&&this.$useiframe&&this.cssfix)){return;}this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Focus"]);if(this.oDoc){this.$setStyleClass(this.oDoc.documentElement,"",[this.$baseCSSname+"Focus"]);}k.call(this);};this.addEventListener("bindingsload",this.$loaddatabinding=function(A){var C=A.bindings.column;if(!C||!C.length){return;}this.$headings=C;var u=0,w=false;for(var t,s=0,q=C.length;s<q;s++){t=C[s];if(!t.$width){throw new Error("missing width");}if(!t.$isPercentage){u+=parseFloat(t.$width)||0;}else{w=true;}}if(!w){this.$isFixedGrid=true;this.$setStyleClass(this.$ext,"fixed");if(this.$useiframe){this.$setStyleClass(this.oDoc.documentElement,"fixed");}}else{}if(u>0&&!this.$isFixedGrid){var B=u;this.$cssRules.push(["."+this.$baseCSSname+" .row"+this.$uniqueId,"padding-right:"+B+"px;margin-right:-"+B+"px"]);this.$container.style.paddingRight=this.$head.style.paddingRight=B+"px";}this.$fixed=u;this.$first=0;this.$withContainer=A.bindings.description?true:false;a(this.$cssRules,window);if(this.$useiframe){a(this.$cssRules,this.oWin);}});this.$initNode=function(E,s,D,w){this.$getNewContext("item");var t=this.$getLayoutNode("item");t.setAttribute("id",D);t.setAttribute("class",t.getAttribute("class")+" "+d[s]+" item"+this.$uniqueId);this.$setStyleClass(this.$getLayoutNode("item","container"),d[s]);t.setAttribute("ondblclick","var o = apf.lookup("+this.$uniqueId+");o.choose(null, true);"+(this.$withContainer?"o.slideToggle(this, null, true);":"")+(this.celledit&&!this.namevalue?"o.startRename(null, null, true);":""));if(this.hasFeature(apf.__DRAGDROP__)){t.setAttribute("onmouseout","this.hasPassedDown = false;");t.setAttribute("onmousedown","var o = apf.lookup("+this.$uniqueId+");                var xmlNode = apf.xmldb.findXmlNode(this);                 var isSelected = o.isSelected(xmlNode);                 this.hasPassedDown = true;                 if (!o.hasFeature(apf.__DRAGDROP__) || !isSelected && !event.ctrlKey)                     o.select(this, event.ctrlKey, event.shiftKey, -1);"+(this.cellselect||this.namevalue?"o.selectCell(event, this, isSelected);":""));t.setAttribute("onmouseup","if (!this.hasPassedDown) return;                var o = apf.lookup("+this.$uniqueId+");                 var xmlNode = apf.xmldb.findXmlNode(this);                 var isSelected = o.isSelected(xmlNode);                 if (o.hasFeature(apf.__DRAGDROP__))                     o.select(this, event.ctrlKey, event.shiftKey, -1);");}else{t.setAttribute("onmousedown","var o = apf.lookup("+this.$uniqueId+");                var wasSelected = o.$selected == this;                o.select(this, event.ctrlKey, event.shiftKey, -1);"+(this.cellselect||this.namevalue?"o.selectCell(event, this, wasSelected);":""));}for(var F,B,A=0;A<this.$headings.length;A++){B=this.$headings[A];if(B.tree){this.$getNewContext("treecell");F=this.$getLayoutNode("treecell");var q=this.$getLayoutNode("treecell","openclose");q.setAttribute("style","margin-left:"+(((w||0))*15+4)+"px;");q.setAttribute("onmousedown","var o = apf.lookup("+this.$uniqueId+");                    o.slideToggle(this, null, null, true);                    event.cancelBubble = true;                    apf.window.$mousedown(event);");q.setAttribute("ondblclick","event.cancelBubble = true");}else{this.$getNewContext("cell");F=this.$getLayoutNode("cell");}apf.setStyleClass(F,B.$className);if(B.css){apf.setStyleClass(F,(apf.lm.compile(B.css))(E));}if(B.icon){var u=this.$getLayoutNode(B.tree?"treecell":"cell","caption",t.appendChild(F));(u.nodeType==1&&u||u.parentNode).setAttribute("style","padding-left:19px;background:url("+apf.getAbsolutePath(this.iconPath,((B.cicon||B.$compile("icon",{nostring:true}))(E)||""))+") no-repeat 0 0;");}if(B.value){apf.setNodeValue(this.$getLayoutNode(B.tree?"treecell":"cell","caption",t.appendChild(F)),(B.cvalue2||B.$compile("value",{nostring:true}))(E)||"");}}if(this.$bindings&&this.$bindings.color){var C=this.$getDataNode("color",E);this.$setStyleClass(t,C?"highlight":null,C?["highlight"]:null);}var G=this.$applyBindRule("css",E);if(G){this.$setStyleClass(t,G);if(G){this.$dynCssClasses.push(G);}}return t;};this.$updateNode=function(D,C){if(!C){return;}var q=this.$head.childNodes,t=C.childNodes,E,s;if(!this.namevalue&&this.$curBtn){s=this.$curBtn.parentNode;}var w,A,u=0;w=t[0];while(w){if(w.nodeType!=1){w=w.nextSibling;continue;}A=apf.all[q[u].getAttribute("hid")];E=this.$getLayoutNode(A.tree?"treecell":"cell","caption",w)||w;if(A.css){apf.setStyleClass(E,(apf.lm.compile(A.css))(D));}if(A.tree){}if(A.value){E.innerHTML=(A.cvalue2||A.$compile("value",{nostring:true}))(D)||"";}if(A.icon){(E.nodeType==1&&E||E.parentNode).style.backgroundImage="url("+apf.getAbsolutePath(this.iconPath,((A.cicon||A.$compile("icon",{nostring:true}))(D)||""))+")";}u++;w=w.nextSibling;}if(this.$bindings&&this.$bindings.color){var B=this.$getDataNode("color",D);this.$setStyleClass(C,B?"highlight":null,B?["highlight"]:null);}var F=this.$applyBindRule("css",D);if(F||this.$dynCssClasses.length){this.$setStyleClass(C,F,this.$dynCssClasses);if(F&&!this.$dynCssClasses.contains(F)){this.$dynCssClasses.push(F);}}};this.$dblclick=function(B){var u=this,F,q;while(!(F=B.getAttribute(apf.xmldb.htmlIdTag))||F.indexOf("|")==-1){B=(q=B).parentNode;}if(this.$lastEditor&&this.$lastEditor[3]==B){return;}var L,s=q.className.match(/(col\d+)/)[1];for(var K=0;K<this.$headings.length;K++){if(this.$headings[K].$className==s){L=this.$headings[K];break;}}if(!L.editor){return;}var t=apf.xmldb.getNode(B);var J=L.tree?this.$getLayoutNode("cell","caption",q):q;var E,w=L.editor;var A=apf.lm.compile(w,{xpathmode:2});var H=J.childNodes;for(var K=0,I=H.length;K<I;K++){if(!H[K].host){if(H[K].nodeType==1){H[K].style.display="none";}else{this.$lastTextValue=H[K].nodeValue;H[K].nodeValue="";}}}if(A.type==2){if(!this.$editors[w]){var G=apf.namespaces[apf.ns.aml].elements[w];var M={htmlNode:J,style:"position:relative;z-index:10000",value:"[{"+this.id+".selected}::"+(v=L.value).substr(1,v.length-2)+"]",focussable:false};if(!L.tree){M.width="100%-3";}E=this.$editors[w]=new G(M);var C=apf.getBox(apf.getStyle(E.$ext,"margin"));if(C[1]||C[3]){E.setAttribute("width","100%+2-"+(C[1]+C[3]));}E.addEventListener("blur",function(){k.call(u);});E.parentNode=this;E.realtime=false;E.$focusParent=this;E.setAttribute("focussable","true");E.addEventListener("beforechange",function(N){return u.dispatchEvent("beforechange",N);});E.addEventListener("afterchange",function(N){return u.dispatchEvent("afterchange",N);});E.addEventListener("keydown",function(N){if(N.keyCode==13){k.call(u);u.$focus();}else{if(N.keyCode==27){E.removeAttribute("value");k.call(u);}}});}else{E=this.$editors[w];if(E.hasFeature(apf.__MULTISELECT__)){E.setAttribute("model","{apf.xmldb.getElementById('"+prop.getAttribute(apf.xmldb.xmlIdTag)+"')}");}E.setAttribute("value","[{"+this.id+".selected}::"+(v=L.value).substr(1,v.length-2)+"]");E.setProperty("visible",true);J.appendChild(E.$ext);E.setAttribute("width",L.tree?"":"100%-3");}}else{var D=A.call(this,this.xmlRoot);if(D.localName=="template"){}else{}}if(E.localName=="textbox"){E.select();}E.focus();E.$focus();this.$setStyleClass(B,"editing");this.$lastEditor=[E,J,t,B,this.getActionTracker().undolength];};this.addEventListener("mousedown",function(q){if(this.$lastEditor&&!apf.isChildOf(this.$lastEditor[1],q.htmlEvent.srcElement||q.htmlEvent.target,true)){k.call(this);}});this.addEventListener("beforeselect",function k(w){if(this.$lastEditor){var t=this.$lastEditor;this.$lastEditor=null;t[0].setProperty("visible",false);var s=t[1].childNodes;for(var u=0,q=s.length;u<q;u++){if(!s[u].host){if(s[u].nodeType==1){s[u].style.display="";}else{if(!t[0].value){s[u].nodeValue=this.$lastTextValue;}}}}this.$setStyleClass(t[3],"",["editing"]);this.focus();}});this.getColumn=function(q){return this.$headings[q||this.$lastcol||0];};this.resizeColumn=function(t,s){var q=this.$headings[t];q.resize(s);};this.hideColumn=function(s){var q=this.$headings[s];q.hide();};this.showColumn=function(s){var q=this.$headings[s];q.show();};this.sortColumn=function(q){var s=this.$headings[nr];s.sort();};this.moveColumn=function(t,s){var q=this.$headings[nr];q.move(s);};this.$draw=function(){this.$drawBase();var q=this;this.$ext.onmousedown=function(u){q.dispatchEvent("mousedown",{htmlEvent:u||event});};this.$head=this.$getLayoutNode("main","head",this.$ext);this.$pointer=this.$getLayoutNode("main","pointer",this.$ext);if(this.$head.firstChild){this.$head.removeChild(this.$head.firstChild);}if(this.$container.firstChild){this.$container.removeChild(this.$container.firstChild);}var s=this.$widthdiff=this.$getOption("main","widthdiff")||0;this.$defaultwidth=this.$getOption("main","defaultwidth")||"100";this.$useiframe=apf.isIE&&(apf.isTrue(this.$getOption("main","iframe"))||this.iframe);if(this.$useiframe&&!this.oIframe){var t=this.$container.className;this.oIframe=this.$container.appendChild(document.createElement(apf.isIE?"<iframe frameborder='0'></iframe>":"iframe"));this.oIframe.frameBorder=0;this.oWin=this.oIframe.contentWindow;this.oDoc=this.oWin.document;this.oDoc.write('<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">                <html xmlns="http://www.w3.org/1999/xhtml">                    <head><script>                        apf = {                            lookup : function(uid){                                return window.parent.apf.lookup(uid);                            },                            Init : {add:function(){},run:function(){}}                        };<\/script>                    </head>                    <body></body>                </html>');this.$container=this.oDoc.body;this.$container.className=t;this.oDoc.documentElement.className=this.$ext.className;apf.skins.loadCssInWindow(this.skinName,this.oWin,this.mediaPath,this.iconPath);if(apf.isIE){this.$setStyleClass(this.oDoc.documentElement,this.$baseCSSname+"Focus");}apf.convertIframe(this.oIframe,true);if(apf.getStyle(this.oDoc.documentElement,apf.isIE?"overflowY":"overflow-y")=="auto"){this.oIframe.onresize=function(){q.$head.style.marginRight=q.oDoc.documentElement.scrollHeight>q.oDoc.documentElement.offsetHeight?"16px":"0";};this.addEventListener("afterload",this.oIframe.onresize);this.addEventListener("xmlupdate",this.oIframe.onresize);}this.oDoc.documentElement.onscroll=function(){if(q.$isFixedGrid){q.$head.scrollLeft=q.oDoc.documentElement.scrollLeft;}};}else{if(apf.getStyle(this.$container,apf.isIE?"overflowY":"overflow-y")=="auto"){this.$resize=function(){q.$head.style.marginRight=q.$container.scrollHeight>q.$container.offsetHeight?"16px":"0";};apf.layout.setRules(this.$ext,this.$uniqueId+"_datagrid","var o = apf.all["+this.$uniqueId+"];                     if (o) o.$resize()");apf.layout.queue(this.$ext);this.addEventListener("afterload",this.$resize);this.addEventListener("xmlupdate",this.$resize);}this.$container.onscroll=function(){if(q.$isFixedGrid){q.$head.scrollLeft=q.$container.scrollLeft;}};}this.$container.ondblclick=function(u){if(!u){u=event;}q.$dblclick(u.srcElement||u.target);};};this.$destroy=function(){this.$ext.onclick=this.$container.onresize=null;apf.layout.removeRule(this.$container,"dg"+this.$uniqueId);apf.layout.activateRules(this.$container);};}).call(apf.datagrid.prototype=new apf.BaseTree());apf.aml.setElement("datagrid",apf.datagrid);apf.aml.setElement("description",apf.BindingRule);apf.aml.setElement("color",apf.BindingRule);apf.aml.setElement("contents",apf.BindingRule);apf.skin=function(c,a){this.$init(a||"skin",apf.NODE_HIDDEN,c);};apf.aml.setElement("skin",apf.skin);(function(){this.$parsePrio="002";this.$includesRemaining=0;this.$propHandlers.src=function(i){this.$path=apf.getAbsolutePath(apf.hostPath,i);a.call(this,this.$path);};this.$propHandlers.name=function(i){if(!this.attributes.getNamedItem("src")){this.$path=apf.getAbsolutePath(apf.hostPath,i)+"/index.xml";a.call(this,this.$path);}};function g(n){if(!n.ownerDocument.documentElement){return false;}var j=n.ownerDocument.documentElement.attributes;for(var q=false,k=0;k<j.length;k++){if(j[k].nodeValue==apf.ns.aml){q=true;break;}}if(!q){throw new Error(apf.formatErrorString(0,null,"Checking for the aml namespace","The Ajax.org Platform xml namespace was not found in "+(n.getAttribute("filename")?"in '"+n.getAttribute("filename")+"'":"")));}return q;}function a(i){var k=this.ownerDocument.$domParser;if(!apf.skins.$first){apf.skins.$first=this;}var j=this.attributes.getNamedItem("defer");if(!j||!apf.isTrue(j.nodeValue)){k.$shouldWait++;this.$parseContext=k.$parseContext||[this.ownerDocument.documentElement];}c.call(this,i);}function d(i){if(i){apf.skins.Init(i,this,this.$path);}if(!this.defer){var j=this.ownerDocument.$domParser;j.$continueParsing.apply(j,this.$parseContext);}}function c(j){apf.console.info("Loading include file: "+j);var i=this;apf.getData(j,{type:"skin",callback:function(s,q,k){if(q!=apf.SUCCESS){var t=new Error(apf.formatErrorString(1007,i,"Loading skin file","Could not load skin file '"+(j||i.src)+"'\nReason: "+k.message));if(k.tpModule.retryTimeout(k,q,null,t)===true){return true;}throw t;}s=s.replace(/\<\!DOCTYPE[^>]*>/,"").replace(/^[\r\n\s]*/,"").replace(/xmlns\=\"[^"]*\"/g,"");if(!s){throw new Error(apf.formatErrorString(0,i,"Loading skin","Empty skin file. Maybe the file does not exist?",i));}var n=apf.getXml(s);g(n);if(!n){throw new Error(apf.formatErrorString(0,i,"Loading skin","Could not parse skin. Maybe the file does not exist?",i));}n.setAttribute("filename",k.url);apf.console.info("Loading of "+n[apf.TAGNAME].toLowerCase()+" skin done from file: "+k.url);d.call(i,n);},async:true,ignoreOffline:true});}this.addEventListener("DOMNodeInsertedIntoDocument",function(i){if(this.src||this.name){return;}apf.skins.Init(this);});}).call(apf.skin.prototype=new apf.AmlElement());apf.model=function(c,a){this.$init(a||"model",apf.NODE_HIDDEN,c);this.$amlNodes={};this.$propBinds={};this.$listeners={};this.$proplisteners={};if(!apf.globalModel){apf.globalModel=this;apf.nameserver.register("model","@default",this);}};(function(){this.$parsePrio="020";this.$isModel=true;this.canHaveChildren=false;this["save-original"]=true;this.$state=0;this.$attrExcludePropBind=apf.extend({submission:1,src:1,session:1},this.$attrExcludePropBind);this.$booleanProperties.autoinit=true;this.$booleanProperties["save-original"]=true;this.$supportedProperties=["submission","src","session","autoinit","save-original","remote"];this.$propHandlers.src=this.$propHandlers.get=function(a,c){if(this.$amlLoaded){this.$loadFrom(a);}};this.$propHandlers.validation=function(a,c){apf.nameserver.get("validation",a).register(this);};this.register=function(c,a){if(!c||!c.load){return this;}if(c.$model&&c.$model!=this){c.$model.unregister(c);}var g=this.$amlNodes[c.$uniqueId]={amlNode:c,xpath:a};c.$model=this;if(typeof c.noloading=="undefined"&&c.$setInheritedAttribute&&!c.$setInheritedAttribute("noloading")){c.noloading=false;}if(this.$state==1){if(c.clear&&!c.noloading){c.clear("loading");}}else{if(this.data){this.$loadInAmlNode(g);}else{if(c.clear){c.clear("empty");}}}var j,d,i=c.$propsUsingMainModel;for(var k in i){j=this.$bindXmlProperty(c,k,i[k].xpath,i[k].optimize);if(this.data){if(d=j.root||j.listen?this.data.selectSingleNode(j.root||j.listen):this.data){c.$execProperty(k,d);}else{this.$waitForXml(c,k);}}}return this;};this.$register=function(c,a){this.$amlNodes[c.$uniqueId].xpath=a;};this.unregister=function(a){delete this.$amlNodes[a.$uniqueId];var c=a.$propsUsingMainModel;for(var d in c){this.$unbindXmlProperty(a,d);}};this.getXpathByAmlNode=function(a){var c=this.$amlNodes[a.$uniqueId];if(!c){return false;}return c.xpath;};this.$loadInAmlNode=function(g){var d;var a=g.xpath;var c=g.amlNode;if(this.data&&a){d=this.data.selectSingleNode(a);}else{d=this.data||null;}if(d){delete this.$listeners[c.$uniqueId];c.load(d);}else{this.$waitForXml(c);}};this.$loadInAmlProp=function(j,c){var i,d,g=this.$propBinds[j],a=apf.all[j];if(!a){delete this.$propBinds[j];return;}for(i in g){if(d=g[i].root?c.selectSingleNode(g[i].root):c){apf.xmldb.addNodeListener(c,a,"p|"+j+"|"+i+"|"+this.$uniqueId);delete this.$proplisteners[j];a.$execProperty(i,d);}else{this.$waitForXml(a,i);}}};this.$bindXmlProperty=function(i,a,k,t,n){var c,g,d=i.$uniqueId;if(!this.$propBinds[d]){this.$propBinds[d]={};}g=this.$propBinds[d][a]={bind:k};if(t){if((c=this.$amlNodes[d])&&c.xpath){k=(g.root=c.xpath)+"/"+k;}var j=k.split("/"),s=j.pop();if(s.indexOf("@")==0||s.indexOf("text()")>-1||s.indexOf("node()")>-1){g.listen=j.join("/");}else{g.listen=k;}}else{if((c=this.$amlNodes[d])&&c.xpath){g.listen=c.xpath;}}if(n){g.listen=".";}if(this.data){var u=g.listen?this.data.selectSingleNode(g.listen):this.data;if(u){apf.xmldb.addNodeListener(u,i,"p|"+i.$uniqueId+"|"+a+"|"+this.$uniqueId);return g;}}this.$waitForXml(i,a);return g;};this.$unbindXmlProperty=function(c,i){var g=c.$uniqueId;var d=this.$propBinds[g]&&this.$propBinds[g][i];if(!d){return;}if(this.data){var a=d.listen?this.data.selectSingleNode(d.listen):this.data;if(a){apf.xmldb.removeNodeListener(a,c,"p|"+g+"|"+i+"|"+this.$uniqueId);}}delete this.$proplisteners[g+i];delete this.$propBinds[g][i];return d;};this.getXml=function(){return this.data?apf.xmldb.cleanNode(this.data.cloneNode(true)):false;};this.setQueryValue=function(a,d){if(!this.data){return false;}var c=apf.createNodeFromXpath(this.data,a);if(!c){return null;}apf.setNodeValue(c,d,true);return c;};this.queryValue=function(a){if(!this.data){return false;}return apf.queryValue(this.data,a);};this.queryValues=function(a){if(!this.data){return false;}return apf.queryValue(this.data,a);};this.queryNode=function(a){if(!this.data){return null;}return this.data.selectSingleNode(a);};this.queryNodes=function(a){if(!this.data){return null;}return this.data.selectNodes(a);};this.appendXml=function(d,a){var c=a?apf.createNodeFromXpath(this.data,a):this.data;if(!c){return null;}if(typeof d=="string"){d=apf.getXml(d);}else{d=!d.nodeType?d.getXml():apf.xmldb.getCleanCopy(d);}if(!d){return;}apf.xmldb.appendChild(c,d);};this.removeXml=function(a){if(typeof a=="string"){a=this.data.selectNodes(a);}else{if(!a.length){a=[a];}}if(a){apf.xmldb.removeNodeList(a);}};this.clear=function(){this.load(null);doc=null;};this.reset=function(){this.load(this.$copy);};this.savePoint=function(){this.$copy=apf.xmldb.getCleanCopy(this.data);};this.reloadAmlNode=function(d){if(!this.data){return;}var c=this.$amlNodes[d];var a=c.xpath?this.data.selectSingleNode(c.xpath):this.data;c.amlNode.load(a);};this.addEventListener("DOMNodeInsertedIntoDocument",function(d){var a=this.$aml;if(this.parentNode.hasFeature(apf.__DATABINDING__)){if(!this.name){this.setProperty("id","model"+this.parentNode.$uniqueId);}this.register(this.parentNode);}if(!this.src){var g,c=a;if(c.childNodes.length){if(apf.getNode(c,[0])){if((g=c.xml||c.serialize()).match(/^[\s\S]*?>([\s\S]*)<[\s\S]*?$/)){g=RegExp.$1;if(!apf.supportNamespaces){g=g.replace(/xmlns=\"[^"]*\"/g,"");}}return this.load(apf.getXmlDom(g).documentElement);}else{if(apf.isJson(c.childNodes[0].nodeValue)){return this.load(apf.getXmlDom(c.childNodes[0].nodeValue).documentElement);}}}if(this.submission){this.load("<data />");}}if(!apf.isFalse(this.autoinit)){this.init();}return this;});this.init=function(a){if(this.session){this.$loadFrom(this.session,{isSession:true});}else{if(this.src){this.$loadFrom(this.src,{callback:a});}}};this.$loadFrom=function(c,d){var i=c.split(":");if(!d){d={};}if(!d.isSession){this.src=c;this.$srcOptions=[c,d];}this.dispatchEvent("beforeretrieve");var n,g;for(n in this.$amlNodes){if(!(g=this.$amlNodes[n])||!g.amlNode){continue;}if(!g.amlNode.noloading){g.amlNode.clear("loading");}}this.$state=1;if(!this.$callCount){this.$callCount=1;}else{this.$callCount++;}var a=this,j=this.$callCount,k=d.callback;d.callback=function(t,s,q){if(j!=a.$callCount){return;}a.dispatchEvent("afterretrieve");if(s!=apf.SUCCESS){var u;u=new Error(apf.formatErrorString(1032,a,"Inserting xml data","Could not load data\nInstruction: "+c+"\nUrl: "+q.url+"\nInfo: "+q.message+"\n\n"+t));if(k&&k.apply(this,arguments)===true){return true;}if(q.tpModule&&q.tpModule.retryTimeout(q,s,a,u)===true){return true;}a.$state=0;throw u;}if(d&&d.isSession&&!t){if(this.src){return a.$loadFrom(this.src);}}else{if(d&&d.cancel){return;}a.load(t);a.dispatchEvent("receive",{data:t});if(k){k.apply(this,arguments);}}};return apf.getData(c,d);};this.reload=function(){if(!this.data){return;}if(this.$srcOptions){this.$loadFrom.apply(this,this.$srcOptions);}else{if(this.src){this.$loadFrom(this.src);}}};this.load=function(q,s){if(typeof q=="string"){if(q.charAt(0)=="<"){if(q.substr(0,5).toUpperCase()=="<!DOC"){q=q.substr(q.indexOf(">")+1);}if(!apf.supportNamespaces){q=q.replace(/xmlns\=\"[^"]*\"/g,"");}q=apf.getXmlDom(q,null,true).documentElement;}else{return this.$loadFrom(q,s);}}if(this.ownerDocument&&this.ownerDocument.$domParser.$shouldWait){var k=this;this.data=this.$copy=q;this.$queueLoading=true;apf.queue.add("modelload"+this.$uniqueId,function(){k.load(q,s);k.$queueLoading=false;});return;}else{if(this.$queueLoading){apf.queue.remove("modelload"+this.$uniqueId);}}this.$state=0;if(this.dispatchEvent("beforeload",{xmlNode:q})===false){return false;}var n=q?q.ownerDocument:null;if(q){if(!apf.supportNamespaces){var d=[],j=q.attributes;for(var g=0,c=j.length;g<c;g++){if(j[g].nodeName.substr(0,5)=="xmlns"){d.push(j[g].xml);}}if(d.length){n.setProperty("SelectionNamespaces",d.join(" "));}}apf.xmldb.addNodeListener(q,this);apf.xmldb.nodeConnect(apf.xmldb.getXmlDocId(q,this),q,null,this);if((!s||!s.nocopy)&&this["save-original"]){this.$copy=apf.xmldb.getCleanCopy(q);}}this.data=q;this.dispatchEvent("afterload",{xmlNode:q});for(var a in this.$amlNodes){this.$loadInAmlNode(this.$amlNodes[a]);}for(a in this.$propBinds){this.$loadInAmlProp(a,q);}return this;};this.$waitForXml=function(a,c){if(c){this.$proplisteners[a.$uniqueId+c]={id:a.$uniqueId,amlNode:a,prop:c};}else{this.$listeners[a.$uniqueId]=a;}};this.$xmlUpdate=function(i,c,g,d){var j,a;for(var k in this.$listeners){if(c=this.data.selectSingleNode(this.$amlNodes[k].xpath||".")){this.$listeners[k].load(c);delete this.$listeners[k];}}for(k in this.$proplisteners){j=this.$proplisteners[k];a=this.$propBinds[j.id][j.prop];if(c=a.listen?this.data.selectSingleNode(a.listen):this.data){apf.xmldb.addNodeListener(c,j.amlNode,"p|"+j.id+"|"+j.prop+"|"+this.$uniqueId);delete this.$proplisteners[k];j.amlNode.$execProperty(j.prop,a.root?this.data.selectSingleNode(a.root):this.data);}}};this.$insertFrom=function(c,d){if(!c){return false;}this.dispatchEvent("beforeretrieve");var g=d.amlNode;var i=d.callback,a=this;d.callback=function(n,k,j){a.dispatchEvent("afterretrieve");if(!j){j={};}if(k!=apf.SUCCESS){var q;q=new Error(apf.formatErrorString(0,a,"Inserting xml data","Could not insert data\nInstruction:"+c+"\nUrl: "+j.url+"\nInfo: "+j.message+"\n\n"+n));if(j.tpModule.retryTimeout(j,k,d.amlNode||a,q)===true){return true;}if(i&&i.call(this,j.data,k,j)===false){return;}throw q;}if(typeof d.insertPoint=="string"){d.insertPoint=a.data.selectSingleNode(d.insertPoint);}if(typeof d.clearContents=="undefined"&&j.userdata){d.clearContents=apf.isTrue(j.userdata[1]);}(d.amlNode||a).insert(n,d);if(i){i.call(this,j.data,k,j);}};apf.getData(c,d);};this.insert=function(d,a){if(typeof d=="string"){if(d.charAt(0)=="<"){if(d.substr(0,5).toUpperCase()=="<!DOC"){d=d.substr(d.indexOf(">")+1);}if(!apf.supportNamespaces){d=d.replace(/xmlns\=\"[^"]*\"/g,"");}d=apf.getXmlDom(d).documentElement;}else{return this.$insertFrom(d,a);}}if(!a.insertPoint){a.insertPoint=this.data;}if(!a.insertPoint){throw new Error(apf.formatErrorString(0,amlNode||_self,"Inserting data","Could not determine insertion point for instruction: "+instruction));}if(typeof a.copyAttributes=="undefined"){a.copyAttributes=true;}var c=apf.mergeXml(d,a.insertPoint,a);apf.xmldb.applyChanges("insert",a.insertPoint);return d;};this.convertXml=function(a){if(!a){return this.data.xml;}return apf.convertXml(this.data,a);};this.submit=function(a,i,d,g,j){if(!a){a=this.submission;}if(!d){d=this.data;}if(!d){throw new Error(apf.formatErrorString(0,this,"Submitting model","Could not submit data, because no data was passed and the model does not have data loaded."));}if(!i){i="form";}if(this.dispatchEvent("beforesubmit",{instruction:a})===false){return false;}var c=this;function n(t,s,q){if((s==apf.TIMEOUT||(c.retryOnError&&s==apf.ERROR))&&q.retries<apf.maxHttpRetries){return q.tpModule.retry(q.id);}else{if(s!=apf.SUCCESS){c.dispatchEvent("submiterror",q);}else{c.dispatchEvent("submitsuccess",apf.extend({data:t},q));}}}var k;if(i.indexOf("xml")>-1){k=apf.getXmlString(d);}else{if(i.indexOf("form")>-1){k=apf.convertXml(apf.xmldb.getCleanCopy(d),"cgiobjects");}else{if(i.indexOf("json")>-1){k=apf.convertXml(d,"json");}}}apf.saveData(a,{xmlNode:d,data:k,callback:n});this.dispatchEvent("aftersubmit");};this.$destroy=function(){if(this.session&&this.data){apf.saveData(this.session,{xmlNode:this.getXml()});}};}).call(apf.model.prototype=new apf.AmlElement());apf.aml.setElement("model",apf.model);apf.list=function(c,a){this.$init(a||"list",apf.NODE_VISIBLE,c);};apf.thumbnail=function(c,a){this.$init(a||"thumbnail",apf.NODE_VISIBLE,c);};apf.select=function(c,a){this.$init(a||"select",apf.NODE_VISIBLE,c);};apf.select1=function(c,a){this.$init(a||"selectl",apf.NODE_VISIBLE,c);};(function(){if(!apf.isIphone){this.implement(apf.Rename);}this.$getCaptionElement=function(){if(!(this.$caret||this.$selected)){return;}var d=this.$getLayoutNode("item","caption",this.$caret||this.$selected);if(!d){return;}return d.nodeType==1?d:d.parentNode;};this.$supportedProperties.push("appearance","mode","more","thumbsize");this.$propHandlers.thumbsize=function(j){var g=this.thumbclass;if(apf.isIE){g=g.splitSafe(",");for(var d=0;d<g.length;d++){apf.setStyleRule(g[d],"width",j+"px");apf.setStyleRule(g[d],"height",j+"px");}return;}apf.setStyleRule(g,"width",j+"px");apf.setStyleRule(g,"height",j+"px");};this.$propHandlers.appearance=function(d){};this.mode="normal";this.$propHandlers.mode=function(d){this.mode=d||"normal";if("check|radio".indexOf(this.mode)>-1){this.allowdeselect=false;this.addEventListener("afterrename",a);if(this.mode=="check"){this.autoselect=false;this.ctrlselect=true;}else{if(this.mode=="radio"){this.multiselect=false;}}}else{this.ctrlselect=false;this.removeEventListener("afterrename",a);}};function a(){}this.$propHandlers.more=function(d){if(d){this.delayedselect=false;this.addEventListener("xmlupdate",c);this.addEventListener("afterload",c);this.$setClearMessage=function(g){if(!this.moreItem){this.$fill();}this.$container.appendChild(this.moreItem);};this.$updateClearMessage=function(){};this.$removeClearMessage=function(){};}else{this.removeEventListener("xmlupdate",c);this.removeEventListener("afterload",c);}};function c(d){if((!d.action||"insert|add|synchronize|move".indexOf(d.action)>-1)&&this.moreItem){this.$container.appendChild(this.moreItem);}}this.addEventListener("keydown",this.$keyHandler,true);this.$draw=function(){this.appearance=this.getAttribute("appearance")||"compact";var g=this.getAttribute("mode");this.$ext=this.$getExternal();this.$container=this.$getLayoutNode("main","container",this.$ext);if(apf.hasCssUpdateScrollbarBug&&!this.mode){this.$fixScrollBug();}var d=this;this.$ext.onclick=function(i){d.dispatchEvent("click",{htmlEvent:i||event});};this.$ext.setAttribute("onmouseout",this.$ext.getAttribute("onmouseout")+";var o = apf.lookup("+this.$uniqueId+");o.$selectSeries(event);");this.listtype=parseInt(this.$getOption("main","type"))||1;this.behaviour=parseInt(this.$getOption("main","behaviour"))||1;this.thumbsize=this.$getOption("main","thumbsize");this.thumbclass=this.$getOption("main","thumbclass");};this.$selectSeries=function(g){g=g||event;var d=g.target||g.srcElement;if(g.type=="mouseover"){var d=(d.className||"").indexOf("item")!=-1?d:d.parentNode;this.highlight(d);}else{d=g.toElement?g.toElement:(g.relatedTarget?g.relatedTarget:null);if(!apf.isChildOf(this.$ext,d,true)){this.highlight(this.$selected);}}};this.highlight=function(n){var d=this.$ext.childNodes;var k=d.length;var j=false;for(var g=0;g<k;g++){if((d[g].className||"").indexOf("item")!=-1){if(!j){this.$setStyleClass(d[g],"selected");}else{this.$setStyleClass(d[g],"",["selected"]);}if(d[g]==n){j=true;}}}};this.$loadAml=function(d){};this.$destroy=function(){if(this.$ext){this.$ext.onclick=null;}apf.destroyHtmlNode(this.oDrag);this.oDrag=null;};}).call(apf.list.prototype=new apf.BaseList());apf.thumbnail.prototype=apf.select.prototype=apf.select1.prototype=apf.list.prototype;apf.aml.setElement("thumbnail",apf.thumbnail);apf.aml.setElement("select",apf.select);apf.aml.setElement("select1",apf.select1);apf.aml.setElement("list",apf.list);apf.errorbox=function(c,a){this.$init(a||"errorbox",apf.NODE_VISIBLE,c);};(function(){this.$positioning="basic";this.display=function(d){this.host=d;var c=d.$ext;document.body.appendChild(this.$ext);var a=(parseFloat(d.$getOption&&d.$getOption("main","erroffsetx")||0)),g=(parseFloat(d.$getOption&&d.$getOption("main","erroffsety")||0));this.show();apf.popup.show(this.$uniqueId,{x:a,y:g,animate:false,ref:c});this.$setStyleClass(this.$ext,a+this.$ext.offsetWidth>this.$ext.offsetParent.offsetWidth?"rightbox":"leftbox",["leftbox","rightbox"]);};this.setMessage=function(a){if(a&&a.indexOf(";")>-1){a=a.split(";");a="<strong>"+a.shift()+"</strong>"+a.join(";");}this.$int.innerHTML=a||"";};this.$draw=function(){this.$ext=this.$getExternal();this.$int=this.$getLayoutNode("main","container",this.$ext);this.oClose=this.$getLayoutNode("main","close",this.$ext);if(this.oClose){var a=this;this.oClose.onclick=function(){a.hide();if(apf.document.activeElement){apf.document.activeElement.focus(true,{mouse:true});}};}this.$ext.onmousedown=function(c){(c||event).cancelBubble=true;if(apf.hasFocusBug){apf.window.$focusfix();}};apf.popup.setContent(this.$uniqueId,this.$ext,"",null,null);};this.$loadAml=function(a){if(!apf.isTrue(this.getAttribute("visible"))){this.hide();}};this.$destroy=function(){if(this.oClose){this.oClose.onclick=null;}this.$ext.onmousedown=null;apf.popup.removeContent(this.$uniqueId);};}).call(apf.errorbox.prototype=new apf.Presentation());apf.aml.setElement("errorbox",apf.errorbox);apf.BindingQuicksandRule=function(c,a){this.$init(a,apf.NODE_HIDDEN,c);};(function(){function getFilteredNodes(pNode){pNode=pNode||this.$parent;var attr,tmp,res=[],dataIDs=[],xmlNodes=pNode.$getDataNode("quicksand",pNode.xmlRoot,false,null,true),domNodes=pNode.$ext.childNodes,i=0,l=xmlNodes.length;if(!domNodes.length||!l){return res;}for(;i<l;++i){dataIDs.push(xmlNodes[i].getAttribute("a_id"));}for(i=0,l=domNodes.length;i<l;++i){if(!domNodes[i]||!(attr=domNodes[i].getAttribute("id"))){continue;}tmp=attr.split("|");tmp.pop();if(dataIDs.indexOf(tmp.join("|"))>-1){res.push(domNodes[i]);}}return res;}function nodeInFilter(node,filtered){var i=0,l=filtered.length,s=node.getAttribute("id");for(;i<l;++i){if(filtered[i].getAttribute("id")==s){return filtered[i];}}return null;}function quicksand(parent,customOptions){parent=this.$parent.$ext;var i,l,dest,src,offset,_self=this,coll=getFilteredNodes.call(this),parentOffset=apf.getAbsolutePosition(parent),offsets=[],callbackFunction=typeof(arguments[1])=="function"?arguments[1]:typeof arguments[2]=="function"?arguments[2]:apf.K,postCallback=function(){_self.dispatchEvent("afterquicksand");callbackFunction.call(_self);},options={steps:60,anim:apf.tween.easeInOutQuad,onfinish:postCallback,adjustHeight:true};apf.extend(options,customOptions);if(apf.isIE&&apf.isIE<7){parent.innerHTML="";for(i=0,l=coll.length;i<l;i++){parent.appendChild(coll[i]);}return;}var $source=parent.childNodes;var correctionOffset=[0,0];parent.style.height=parent.offsetHeight+"px";apf.tween.clearQueue(parent,true);for(i=0,l=$source.length;i<l;++i){src=$source[i];offsets[i]=apf.getAbsolutePosition(src,parent,false);}for(i=0,l=$source.length;i<l;++i){src=$source[i];with(src.style){position="absolute";margin="0";top=(offsets[i][1]-parentOffset[1])+"px";left=(offsets[i][0]-parentOffset[0])+"px";}}var $dest=parent.cloneNode(false);$dest.setAttribute("id","");for(i=0,l=coll.length;i<l;++i){$dest.appendChild(coll[i].cloneNode(true));coll[i].$offset=apf.getAbsolutePosition(coll[i]);}parent.parentNode.insertBefore($dest,parent);with($dest.style){zIndex=1;opacity=0;margin=0;position="absolute";top=parentOffset[1]-correctionOffset[1]+"px";left=parentOffset[0]-correctionOffset[0]+"px";}if(false){apf.tween.single(parent,{steps:options.steps,anim:options.anim,type:"height",from:parent.offsetHeight,to:$dest.offsetHeight});}var insets=[];for(i=0,l=$source.length;i<l;++i){src=$source[i];if(dest=nodeInFilter(src,coll)){offset=insets.shift()||offsets[i];options.tweens=[{type:"top",from:dest.$offset[1]-parentOffset[1],to:offset[1]-parentOffset[1]},{type:"left",from:dest.$offset[0]-parentOffset[0],to:offset[0]-parentOffset[0]},{type:"opacity",from:apf.getStyle(src,"opacity"),to:1}];if(apf.supportCSSAnim){options.tweens.push({type:"transform",subType:"scale",from:0,to:1});}apf.tween.multi(src,options);}else{options.tweens=[{type:"opacity",from:apf.getStyle(src,"opacity"),to:0}];if(apf.supportCSSAnim){options.tweens.push({type:"transform",subType:"scale",from:1,to:0});}insets.push(offsets[i]);apf.tween.multi(src,options);}}for(i=0,l=coll.length;i<l;++i){var item=coll[i];if(!nodeInFilter(item,$source)){dest=nodeInFilter(item,coll);options.tweens=[{type:"opacity",from:0,to:1}];if(!apf.isIE){}offset=apf.getAbsolutePosition(dest);dest=dest.cloneNode(true);with(dest.style){position="absolute";margin="0";top=(offset[1]-parentOffset[1])+"px";left=(offset[0]-parentOffset[0])+"px";opacity="0";transform="scale(.0)";}parent.appendChild(dest);apf.tween.multi(dest,options);}}}this.addEventListener("DOMNodeInsertedIntoDocument",function(e){var pNode=this;while(pNode&&pNode.$bindingRule){pNode=pNode.parentNode;}this.$parent=pNode;if(!pNode){return;}var _self=this;setTimeout(function(){quicksand.call(_self);});});}).call(apf.BindingQuicksandRule.prototype=new apf.BindingRule());apf.aml.setElement("quicksand",apf.BindingQuicksandRule);apf.splitter=function(c,a){this.$init(a||"splitter",apf.NODE_VISIBLE,c);apf.plane.init();};(function(){this.$focussable=true;this.update=function(){var F=(this.type=="vertical")?{fsize:"fwidth",size:"width",offsetPos:"offsetLeft",offsetSize:"offsetWidth",pos:"left"}:{fsize:"fheight",size:"height",offsetPos:"offsetTop",offsetSize:"offsetHeight",pos:"top"};this.$ext.offsetTop;this.$amlNode=this.refNode;var k=this.refHtml;var q=apf.layout.vars;var w=this.oItem;var E=false;var D=k?k[F.offsetPos]:q[F.pos+"_"+w.id];var j=k?k[F.offsetSize]:q[F.size+"_"+w.id];var d=w.parent.children;for(var n=0,B=0;B<d.length;B++){if(!d[B][F.fsize]){n++;}}if(!w[F.fsize]&&n>1){for(var c=0,a=0,B=w.stackId+1;B<d.length;B++){if(!d[B][F.fsize]){c+=d[B].weight||1;a+=(d[B].node?d[B].oHtml[F.offsetSize]:q[F.size+"_"+d[B].id]);}}var s=this.$ext[F.offsetPos]-D-j;var C=(a-s)/c;for(var B=0;B<w.stackId;B++){if(!d[B][F.fsize]){d[B].original.weight=(d[B].node?d[B].oHtml[F.offsetSize]:q[F.size+"_"+d[B].id])/C;}}w.original.weight=(j+s)/C;E=true;}else{var t=w[F.fsize]?w[F.fsize].match(/^\d+$/):false;var H=w[F.fsize]?w[F.fsize].match(/^([\d\.]+)\%$/):false;if(t||H||!w[F.fsize]){var s=this.$ext[F.offsetPos]-D-j;var A=this.$ext[F.offsetPos]-D;for(var I=0,u=0,B=w.stackId+1;B<d.length;B++){if(!d[B][F.fsize]){I+=d[B].weight||1;u+=(d[B].node?d[B].oHtml[F.offsetSize]:q[F.size+"_"+d[B].id]);}}if(I>0){var g=((u-s)/I)/(u/I);for(var B=w.stackId+1;B<d.length;B++){d[B].original.weight=g*(d[B].weight||1);}}else{for(var B=w.stackId+1;B<d.length;B++){if(d[B][F.fsize].match(/^\d+$/)){var G=(d[B].node?d[B].oHtml[F.offsetSize]:q[F.size+"_"+d[B].id])-s;d[B].original[F.fsize]=""+Math.max(0,G,d[B].minheight||0);if(d[B][F.fsize]-G!=0){s=d[B][F.fsize]-G;}else{break;}}else{if(d[B][F.fsize].match(/^([\d\.]+)\%$/)){var G=(d[B].node?d[B].oHtml[F.offsetSize]:q[F.size+"_"+d[B].id])-s;d[B].original[F.fsize]=Math.max(0,((parseFloat(RegExp.$1)/(d[B].node?d[B].oHtml[F.offsetSize]:q[F.size+"_"+d[B].id]))*G))+"%";break;}}}}if(w.original[F.fsize]){w.original[F.fsize]=H?((parseFloat(H[1])/j)*A)+"%":""+A;}E=true;}}if(E){apf.layout.compile(this.$ext.parentNode);apf.layout.activateRules(this.$ext.parentNode);if(apf.hasSingleRszEvent){apf.layout.forceResize();}return;}apf.layout.forceResize(this.$ext.parentNode);};this.init=function(A,s,B){this.min=0;this.max=1000000;this.size=parseInt(A)||3;this.refNode=null;this.refHtml=null;var c;if(s){if(typeof s!="object"){s=apf.lookup(s);}this.refNode=s;this.refHtml=this.refNode.$ext;c=this.refHtml.parentNode;B=s.aData.calcData;}else{c=B.pHtml;}this.oItem=B;if(c&&c!=this.$ext.parentNode){c.appendChild(this.$ext);}var w=apf.getDiff(this.$ext);this.$verdiff=w[0];this.$hordiff=w[1];this.$sizeArr=[];this.type=B.parent.vbox?"horizontal":"vertical";var F=apf.layout.get(this.$ext.parentNode).layout;var G="splitter"+this.$uniqueId;F.addRule("var "+G+" = apf.lookup("+this.$uniqueId+").$ext");var a=[G+".style.left = "];var j=[G+".style.top = "];var k=[G+".style.width = -"+this.$hordiff+" + "];var u=[G+".style.height = -"+this.$verdiff+" + "];var t=B.parent.children[B.stackId+1];if(this.type=="horizontal"){k.push("Math.max(");if(B.node){a.push(B.id+".offsetLeft");j.push(B.id+".offsetTop + "+B.id+".offsetHeight");k.push(B.id+".offsetWidth");}else{a.push("v.left_"+B.id);j.push("v.top_"+B.id+" + v.height_"+B.id);k.push("v.width_"+B.id);}k.push(",",t?(t.node?t.id+".offsetWidth":"v.width_"+t.id):0,")");F.addRule(k.join(""));this.$ext.style.height=(B.splitter-this.$hordiff)+"px";}else{u.push("Math.max(");if(B.node){a.push(B.id+".offsetLeft + "+B.id+".offsetWidth");j.push(B.id+".offsetTop");u.push(B.id+".offsetHeight");}else{a.push("v.left_"+B.id+" + v.width_"+B.id);j.push("v.top_"+B.id);u.push("v.height_"+B.id);}u.push(",",t?(t.node?t.id+".offsetHeight":"v.height_"+t.id):0,")");F.addRule(u.join(""));this.$ext.style.width=(B.splitter-this.$hordiff)+"px";}F.addRule(a.join(""));F.addRule(j.join(""));var n=B.parent.children;if(this.type=="vertical"){F.addRule(G+".host.min = "+(B.node?"document.getElementById('"+B.id+"').offsetLeft":"v.left_"+B.id)+" + "+parseInt(B.minwidth||B.childminwidth||10));var C=[],g=[];for(var q=false,D=B.stackId+1;D<n.length;D++){if(!n[D].fwidth){q=true;}}for(var E,D=B.stackId+1;D<n.length;D++){E=n[D];if(E.minwidth||E.childminheight){C.push(parseInt(E.minwidth||E.childminheight));}else{if(E.fwidth){if(!q&&D==B.stackId+1){C.push(10);}else{if(E.fwidth.indexOf("%")!=-1){C.push("("+E.parent.innerspace+") * "+(parseFloat(E.fwidth)/100));}else{C.push(E.fwidth);}}}else{C.push(10);}}C.push(E.edgeMargin);}F.addRule(G+".host.max = v.left_"+B.parent.id+" + v.width_"+B.parent.id+" - ("+(C.join("+")||0)+")");}else{F.addRule(G+".host.min = "+(B.node?"document.getElementById('"+B.id+"').offsetTop":"v.top_"+B.id)+" + "+parseInt(B.minheight||B.childminheight||10));var C=[],g=[];for(var q=false,D=B.stackId+1;D<n.length;D++){if(!n[D].fheight){q=true;}}if(!q&&t&&t.state>0){return this.$ext.parentNode.removeChild(this.$ext);}for(var E,D=B.stackId+1;D<n.length;D++){E=n[D];if(E.minheight||E.childminheight){C.push(parseInt(E.minheight||E.childminheight));}else{if(E.fheight){if(!q&&D==B.stackId+1){C.push(10);}else{if(E.fheight.indexOf("%")!=-1){C.push("("+E.parent.innerspace+") * "+(parseFloat(E.fheight)/100));}else{C.push(E.fheight);}}}else{C.push(10);}}if(E.edgeMargin){C.push(E.edgeMargin);}}F.addRule(G+".host.max = v.top_"+B.parent.id+" + v.height_"+B.parent.id+" - ("+(C.join("+")||0)+")");}this.$setStyleClass(this.$ext,this.type,[this.type=="horizontal"?"vertical":"horizontal"]);if(this.type=="vertical"){this.$setStyleClass(this.$ext,"w-resize",["n-resize"]);}else{this.$setStyleClass(this.$ext,"n-resize",["w-resize"]);}return this;};this.$draw=function(){this.$ext=this.$getExternal();var a=this;this.$ext.onmousedown=function(d){if(!d){d=event;}var c=a;var g=apf.getAbsolutePosition(this);if(c.type=="vertical"){c.tx=d.clientX-g[0];}else{c.ty=d.clientY-g[1];}c.startPos=c.type=="vertical"?this.offsetLeft:this.offsetTop;d.returnValue=false;d.cancelBubble=true;apf.plane.show(this);c.$setStyleClass(this,"moving");c.$setStyleClass(document.body,c.type=="vertical"?"w-resize":"n-resize",[c.type=="vertical"?"n-resize":"w-resize"]);document.onmouseup=function(){c.$setStyleClass(c.$ext,"",["moving"]);apf.plane.hide();c.update();c.$setStyleClass(document.body,"",["n-resize","w-resize"]);document.onmouseup=document.onmousemove=null;};document.onmousemove=function(i){if(!i){i=event;}if(c.type=="vertical"){if(i.clientX>=0){var j=apf.getAbsolutePosition(c.$ext.offsetParent);c.$ext.style.left=(Math.min(c.max,Math.max(c.min,(i.clientX-j[0])-c.tx)))+"px";}}else{if(i.clientY>=0){var j=apf.getAbsolutePosition(c.$ext.offsetParent);c.$ext.style.top=(Math.min(c.max,Math.max(c.min,(i.clientY-j[1])-c.ty)))+"px";}}i.returnValue=false;i.cancelBubble=true;};};};this.$loadAml=function(c){if(this.left||this.top){var j=this.left||this.top;var g=this.right||this.bottom;j=j.split(/\s*,\s*/);g=g.split(/\s*,\s*/);for(var d=0;d<j.length;d++){j[d]=j[d];}for(var d=0;d<g.length;d++){g[d]=g[d];}var a=this;$setTimeout(function(){this.$amlNode.init(a.type,a.size,a.min,a.max,a.change,j,g);});}};}).call(apf.splitter.prototype=new apf.Presentation());apf.aml.setElement("splitter",apf.splitter);apf.comment=function(){this.$init("comment",apf.NODE_HIDDEN);};apf.comment.prototype=new apf.AmlComment();apf.aml.setElement("comment",apf.comment);apf.dropdown=function(c,a){this.$init(a||"dropdown",apf.NODE_VISIBLE,c);};(function(){this.$animType=1;this.$animSteps=5;this.$animSpeed=20;this.$itemSelectEvent="onmouseup";this.dragdrop=false;this.reselectable=true;this.$focussable=true;this.autoselect=false;this.multiselect=false;this.disableremove=true;this.delayedselect=false;this.maxitems=5;this.$booleanProperties.disableremove=true;this.$supportedProperties.push("maxitems","disableremove","initial-message","fill");this.$propHandlers.maxitems=function(c){this.sliderHeight=c?(Math.min(this.maxitems||100,c)*this.itemHeight):10;this.containerHeight=c?(Math.min(this.maxitems||100,c)*this.itemHeight):10;};this.slideToggle=function(c,d){if(!c){c=event;}if(d&&this.disabled){return;}if(this.isOpen){this.slideUp();}else{this.slideDown(c);}};this.slideDown=function(d){if(this.dispatchEvent("slidedown")===false){return false;}this.isOpen=true;this.$propHandlers.maxitems.call(this,this.xmlRoot&&this.each?this.getTraverseNodes().length:this.childNodes.length);this.oSlider.style.display="block";if(!this.ignoreOverflow){this.oSlider.style[apf.supportOverflowComponent?"overflowY":"overflow"]="visible";this.$container.style.overflowY="hidden";}this.oSlider.style.display="";this.$setStyleClass(this.$ext,this.$baseCSSname+"Down");this.oSlider.style.height=(this.sliderHeight-1)+"px";this.oSlider.style.width=(this.$ext.offsetWidth-2-this.widthdiff)+"px";var c=this;apf.popup.show(this.$uniqueId,{x:0,y:this.$ext.offsetHeight,animate:true,ref:this.$ext,width:this.$ext.offsetWidth-this.widthdiff,height:this.containerHeight,callback:function(g){if(!c.ignoreOverflow){c.$container.style.overflowY="auto";}}});};this.slideUp=function(){if(this.isOpen==2){return false;}if(this.dispatchEvent("slideup")===false){return false;}this.isOpen=false;if(this.selected){var c=apf.xmldb.findHtmlNode(this.selected,this);if(c){this.$setStyleClass(c,"",["hover"]);}}this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Down"]);apf.popup.hide();return false;};this.$setLabel=function(c){this.oLabel.innerHTML=c||this["initial-message"]||"";this.$setStyleClass(this.$ext,c?"":this.$baseCSSname+"Initial",!c?[]:[this.$baseCSSname+"Initial"]);};this.addEventListener("afterselect",function(c){if(!c){c=event;}this.slideUp();if(!this.isOpen){this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Over"]);}this.$setLabel(c.selection.length?this.$applyBindRule("caption",this.selected):"");});function a(){if(this.isOpen==2){this.slideDown();}}this.addEventListener("afterload",a);this.addEventListener("xmlupdate",function(){a.call(this);this.$setLabel(this.$applyBindRule("caption",this.selected));});this.$blur=function(){this.slideUp();if(!this.isOpen){this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Over"]);}this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Focus"]);};this.$setClearMessage=function(c){this.$setLabel(c);};this.$removeClearMessage=function(){this.$setLabel("");};this.addEventListener("popuphide",this.slideUp);this.addEventListener("keydown",function(n){var j=n.keyCode;if(!this.xmlRoot){return;}var k;switch(j){case 38:if(n.altKey){this.slideToggle(n.htmlEvent);return;}if(!this.selected){return;}k=this.getNextTraverseSelected(this.caret||this.selected,false);if(k){this.select(k);}break;case 40:if(n.altKey){this.slideToggle(n.htmlEvent);return;}if(!this.selected){k=this.getFirstTraverseNode();if(!k){return;}}else{k=this.getNextTraverseSelected(this.selected,true);}if(k){this.select(k);}break;default:if(j==9||!this.xmlRoot){return;}if(!this.lookup||new Date().getTime()-this.lookup.date.getTime()>1000){this.lookup={str:"",date:new Date()};}this.lookup.str+=String.fromCharCode(j);var d,c=this.getTraverseNodes();for(var g=0;g<c.length;g++){d=this.$applyBindRule("caption",c[g]);if(d&&d.indexOf(this.lookup.str)>-1){this.select(c[g]);return;}}return;}return false;},true);this.$draw=function(){this.$getNewContext("main");this.$getNewContext("container");this.$animType=this.$getOption("main","animtype")||1;this.clickOpen=this.$getOption("main","clickopen")||"button";this.$ext=this.$getExternal(null,null,function(d){d.setAttribute("onmouseover","var o = apf.lookup("+this.$uniqueId+');o.$setStyleClass(o.$ext, o.$baseCSSname + "Over", null, true);');d.setAttribute("onmouseout","var o = apf.lookup("+this.$uniqueId+');if(o.isOpen) return;o.$setStyleClass(o.$ext, "", [o.$baseCSSname + "Over"], true);');var c=this.$getLayoutNode("main","button",d);if(c){c.setAttribute("onmousedown","apf.lookup("+this.$uniqueId+").slideToggle(event, true);");}var g=this.$getLayoutNode("main","label",d);if(this.clickOpen=="both"){g.parentNode.setAttribute("onmousedown","apf.lookup("+this.$uniqueId+").slideToggle(event, true);");}});this.oLabel=this.$getLayoutNode("main","label",this.$ext);if(this.oLabel.nodeType==3){this.oLabel=this.oLabel.parentNode;}this.oIcon=this.$getLayoutNode("main","icon",this.$ext);if(this.$button){this.$button=this.$getLayoutNode("main","button",this.$ext);}this.oSlider=apf.insertHtmlNode(this.$getLayoutNode("container"),document.body);this.$container=this.$getLayoutNode("container","contents",this.oSlider);this.$container.host=this;this.$pHtmlDoc=apf.popup.setContent(this.$uniqueId,this.oSlider,apf.skins.getCssString(this.skinName));this.listtype=parseInt(this.$getLayoutNode("main","type"))||1;this.itemHeight=this.$getOption("main","item-height")||18.5;this.widthdiff=this.$getOption("main","width-diff")||0;this.ignoreOverflow=apf.isTrue(this.$getOption("main","ignore-overflow"))||false;};this.addEventListener("DOMNodeInsertedIntoDocument",function(){if(typeof this["initial-message"]=="undefined"){this.$setInheritedAttribute("initial-message");}if(!this.selected&&this["initial-message"]){this.$setLabel();}});this.$destroy=function(){apf.popup.removeContent(this.$uniqueId);apf.destroyHtmlNode(this.oSlider);this.oSlider=null;};}).call(apf.dropdown.prototype=new apf.BaseList());apf.config.$inheritProperties["initial-message"]=1;apf.aml.setElement("dropdown",apf.dropdown);apf.contextmenu=function(){this.$init("contextmenu",apf.NODE_HIDDEN);};(function(){this.$amlNodes=[];this.$attrExcludePropBind=apf.extend({match:1},this.$attrExcludePropBind);this.register=function(a){if(!a.contextmenus){a.contextmenus=[];}a.contextmenus.push(this);};this.unregister=function(a){a.contextmenus.remove(this);};this.addEventListener("DOMNodeInsertedIntoDocument",function(a){this.register(this.parentNode);});}).call(apf.contextmenu.prototype=new apf.AmlElement());apf.aml.setElement("contextmenu",apf.contextmenu);apf.menu=function(c,a){this.$init(a||"menu",apf.NODE_VISIBLE,c);};(function(){this.$focussable=apf.KEYBOARD;this.$positioning="basic";this.anim=true;this.zindex=10000000;this.$booleanProperties.anim=true;this.$propHandlers.visible=function(k,q,j,i,d){if(k){this.$ext.style.display="block";if(this.opener&&this.opener.localName.indexOf("item")>-1){this.opener.parentNode.$showingSubMenu=this;}}else{this.$ext.style.display="none";var n=apf.menu.lastFocus;if(n!=this.opener&&this.opener&&this.opener.$blur){this.opener.$blur();}if(this.opener&&this.opener.parentNode.localName=="menu"){if(!this.$hideTree){this.$hideTree=-1;}this.opener.parentNode.focus();}else{if(n){if(apf.window.$settingFocus){if(apf.window.$settingFocus!=n&&n.$blur){n.$blur();}this.$blur();if(apf.window.$settingFocus.localName!="menu"){apf.menu.lastFocus=null;}}else{if(!apf.window.hasFocus()){if(n.$blur){n.$blur();}this.$blur();apf.document.activeElement=n;if(n.$focusParent){n.$focusParent.$lastFocussed=n;}apf.menu.lastFocus=null;}else{if(this.$hideTree){if(!this.$hideTree){this.$hideTree=-1;}var g=(n.disabled||!n.visible)&&n!=apf.document.documentElement;if(i||g){if(n.$blur){n.$blur();}this.$blur();apf.document.activeElement=null;if(g&&apf.window.moveNext()===false){apf.window.$focusRoot();}}else{n.focus(null,null,true);}apf.menu.lastFocus=null;}}}}}if(this.$showingSubMenu){this.$showingSubMenu.hide();this.$showingSubMenu=null;}if(this.opener&&this.opener.$submenu){this.opener.$submenu(true,true);if(this.$hideTree===true&&this.opener.parentNode.localName=="menu"){this.opener.parentNode.$hideTree=true;this.opener.parentNode.hide();}this.opener=null;}this.$hideTree=null;if(this.$selected){apf.setStyleClass(this.$selected.$ext,"",["hover"]);this.$selected=null;}}};var c;this.display=function(w,t,n,u,D,q,B){this.opener=u;this.dispatchEvent("display");var C,k,g,d=this.childNodes,s=0,j=d.length,F;for(k=0;k<j;k++){g=d[k];if(g.nodeType!=1){continue;}F=!D||!g.match||(g.cmatch||(g.cmatch=apf.lm.compile(g.match,{xpathmode:3,injectself:true})))(D);if(F){g.show();if(g.localName=="divider"){C=g;if(s==0){g.hide();}s=0;}else{s++;}}else{g.hide();if(!g.nextSibling&&s==0){C.hide();}}}if(this.oOverlay){if(B){this.oOverlay.style.display="block";this.oOverlay.style.width=B+"px";}else{this.oOverlay.style.display="none";}}this.visible=false;this.show();if(w===null){apf.popup.show(this.$uniqueId,{x:0,y:u.$ext.offsetHeight,animate:n||!this.anim?false:"fade",ref:u.$ext,allowTogether:q});}else{var A=apf.getAbsolutePosition(document.body);apf.popup.show(this.$uniqueId,{x:w-A[0],y:t-A[1]-(apf.isIE&&apf.isIE<8?1:0),animate:n||!this.anim?false:"fade",ref:this.$ext.offsetParent,allowTogether:q,autoCorrect:false});}var E=apf.menu.lastFocus=u&&u.$focussable===true?u:apf.menu.lastFocus||apf.document.activeElement;apf.popup.last=null;this.focus();if(E&&E!=this&&E.$focus){E.$focus();}this.xmlReference=D;};this.getValue=function(d){return this.getSelected(d).value||"";};this.getSelected=function(k){var g=this.childNodes;var j,d=g.length;for(j=0;j<d;j++){if(g[j].group!=k){continue;}if(g[j].selected){return g[j];}}return false;};this.select=function(n,k){var g=this.childNodes;var j,d=g.length;for(j=0;j<d;j++){if(g[j].group!=n){continue;}if(g[j].value==k||!g[j].value&&g[j].caption==k){g[j].$handlePropSet("selected",true);}else{if(g[j].selected){g[j].$handlePropSet("selected",false);}}}};this.addEventListener("keydown",function(j){var i,d=j.keyCode;switch(d){case 13:if(!this.$selected){return;}i=this.$selected;i.$down();i.$up();i.$click();break;case 38:i=this.$selected&&this.$selected.previousSibling||this.lastChild;if(i&&i.localName=="divider"){i=i.previousSibling;}if(!i){return;}if(this.$selected){apf.setStyleClass(this.$selected.$ext,"",["hover"]);}apf.setStyleClass(i.$ext,"hover");this.$selected=i;break;case 40:i=this.$selected&&this.$selected.nextSibling||this.firstChild;if(i&&i.localName=="divider"){i=i.nextSibling;}if(!i){return;}if(this.$selected){apf.setStyleClass(this.$selected.$ext,"",["hover"]);}apf.setStyleClass(i.$ext,"hover");this.$selected=i;break;case 37:if(!this.opener){return;}if(this.opener.localName=="button"){i=this.opener.previousSibling;while(i&&!i.submenu){i=i.previousSibling;}if(i){i.dispatchEvent("mouseover");var g=i.parentNode.menuIsPressed;if(g){self[g.submenu].dispatchEvent("keydown",{keyCode:40});}}}else{if(this.opener.parentNode.localName=="menu"){var k=this.opener;this.hide();apf.setStyleClass(k.$ext,"hover");k.parentNode.$showingSubMenu=null;}}break;case 39:if(this.$selected&&this.$selected.submenu){this.$selected.$submenu(null,true);this.$showingSubMenu.dispatchEvent("keydown",{keyCode:40});return;}if(this.opener){var k=this.opener;while(k&&k.parentNode&&k.parentNode.localName=="menu"){k=k.parentNode.opener;}if(k&&k.localName=="button"){i=k.nextSibling;while(i&&!i.submenu){i=i.nextSibling;}if(i){i.dispatchEvent("mouseover");var g=i.parentNode.menuIsPressed;if(g){self[g.submenu].dispatchEvent("keydown",{keyCode:40});}return;}}}if(!this.$selected){arguments.callee.call(this,{keyCode:40});}break;default:return;}return false;},true);function a(){if(this.$showingSubMenu){return;}if(this.$hideTree!=-1){this.$hideTree=true;this.hide();}return false;}this.addEventListener("focus",function(){apf.popup.last=this.$uniqueId;});this.addEventListener("blur",a);this.addEventListener("popuphide",a);this.$draw=function(){this.$pHtmlNode=document.body;this.$ext=this.$getExternal();this.oOverlay=this.$getLayoutNode("main","overlay",this.$ext);apf.popup.setContent(this.$uniqueId,this.$ext,"",null,null);};this.$loadAml=function(d){this.$int=this.$getLayoutNode("main","container",this.$ext);};this.$destroy=function(){apf.popup.removeContent(this.$uniqueId);};}).call(apf.menu.prototype=new apf.Presentation());apf.aml.setElement("menu",apf.menu);apf.input=function(c,a){this.$init(a||"input",apf.NODE_VISIBLE,c);};apf.secret=function(c,a){this.$init(a||"secret",apf.NODE_VISIBLE,c);};apf.password=function(c,a){this.$init(a||"password",apf.NODE_VISIBLE,c);};apf.textarea=function(c,a){this.$init(a||"textarea",apf.NODE_VISIBLE,c);this.multiline=true;};apf.email=function(c,a){this.$init(a||"email",apf.NODE_VISIBLE,c);};apf.textbox=function(c,a){this.$init(a||"textbox",apf.NODE_VISIBLE,c);};(function(){this.implement(apf.DataAction);this.$focussable=true;this.$masking=false;this.$childProperty="value";this.value="";this.isContentEditable=true;this.multiline=false;this.$booleanProperties.focusselect=true;this.$booleanProperties.realtime=true;this.$supportedProperties.push("value","mask","initial-message","focusselect","realtime","type");this.$propHandlers.value=function(d,g,c){if(!this.$input||!c&&this.getValue()==d){return;}if(!c&&!d){this.clear();}else{if(this.isHTMLBox){if(this.$input.innerHTML!=d){this.$input.innerHTML=d;}}else{if(this.$input.value!=d){this.$input.value=d;}}}if(this.$button){this.$button.style.display=d&&!c?"block":"none";}};this.addEventListener("prop.maxlength",function(c){if(this.$input.tagName.toLowerCase().match(/input|textarea/)){this.$input.maxLength=parseInt(c.value)||null;}});this.$propHandlers.mask=function(c){if(this.mask.toLowerCase()=="password"){return;}if(!c){throw new Error("Not Implemented");}if(!this.$masking){this.$masking=true;this.implement(apf.textbox.masking);this.focusselect=false;}this.setMask(this.mask);};this.$propHandlers["initial-message"]=function(c){if(c){if(apf.hasFocusBug){this.$input.onblur();}}if(!this.value){this.clear();}};this.$propHandlers.focusselect=function(d){var c=this;this.$input.onmousedown=function(){c.focusselect=false;};this.$input.onmouseup=this.$input.onmouseout=function(){c.focusselect=d;};};this.$propHandlers.type=function(c){if(c&&"password|username".indexOf(c)>-1&&typeof this.focusselect=="undefined"){this.focusselect=true;this.$propHandlers.focusselect.call(this,true);}};this.setValue=function(c){return this.setProperty("value",c,false,true);};this.clear=function(){if(this["initial-message"]){this.$propHandlers.value.call(this,this["initial-message"],null,true);apf.setStyleClass(this.$ext,this.$baseCSSname+"Initial");}else{this.$propHandlers.value.call(this,"",null,true);}this.dispatchEvent("clear");};this.getValue=function(){var c=this.isHTMLBox?this.$input.innerHTML:this.$input.value;return c==this["initial-message"]?"":c.replace(/\r/g,"");};this.select=function(){try{this.$input.select();}catch(c){}};this.deselect=function(){this.$input.deselect();};this.$enable=function(){this.$input.disabled=false;};this.$disable=function(){this.$input.disabled=true;};this.$insertData=function(c){return this.setValue(c);};this.insert=function(g){if(apf.hasMsRangeObject){try{this.$input.focus();}catch(d){}var c=document.selection.createRange();if(this.oninsert){g=this.oninsert(g);}c.pasteHTML(g);c.collapse(true);c.select();}else{this.$input.value+=g;}};this.addEventListener("$clear",function(){this.value="";if(this["initial-message"]&&apf.document.activeElement!=this){this.$propHandlers.value.call(this,this["initial-message"],null,true);apf.setStyleClass(this.$ext,this.$baseCSSname+"Initial");}else{this.$propHandlers.value.call(this,"");}if(!this.$input.tagName.toLowerCase().match(/input|textarea/i)){if(apf.hasMsRangeObject){try{var c=document.selection.createRange();c.moveStart("sentence",-1);c.select();}catch(d){}}}this.dispatchEvent("clear");});this.$keyHandler=function(d,j,c,g,i){if(this.$button&&d==27){this.clear();this.blur();}};var a;this.$focus=function(g){if(!this.$ext||this.$ext.disabled){return;}this.$setStyleClass(this.$ext,this.$baseCSSname+"Focus");if(this["initial-message"]&&this.$input.value==this["initial-message"]){this.$propHandlers.value.call(this,"",null,true);apf.setStyleClass(this.$ext,"",[this.$baseCSSname+"Initial"]);}var c=this;function d(){try{if(!a||document.activeElement!=c.$input){c.$input.focus();}else{clearInterval(a);return;}}catch(i){}if(c.$masking){c.setPosition();}if(c.focusselect){c.select();}}if((!g||g.mouse)&&apf.isIE){clearInterval(a);a=setInterval(d,1);}else{d();}};this.$blur=function(c){if(!this.$ext){return;}if(!this.realtime){this.change(this.getValue());}this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Focus"]);if(this["initial-message"]&&this.$input.value==""){this.$propHandlers.value.call(this,this["initial-message"],null,true);apf.setStyleClass(this.$ext,this.$baseCSSname+"Initial");}try{if(apf.isIE||!c||c.srcElement!=apf.window){this.$input.blur();}}catch(c){}if(this.oContainer){$setTimeout("var o = apf.lookup("+this.$uniqueId+");                o.oContainer.style.display = 'none'",100);}clearInterval(a);};this.$draw=function(){var c=this;this.$ext=this.$getExternal(null,null,function(i){var g=this.getAttribute("mask");if((typeof g=="string"&&g.toLowerCase()=="password")||"secret|password".indexOf(this.localName)>-1){this.type=="password";this.$getLayoutNode("main","input").setAttribute("type","password");}i.setAttribute("onmousedown","if (!this.host.disabled)                 this.host.dispatchEvent('mousedown', {htmlEvent : event});");i.setAttribute("onmouseup","if (!this.host.disabled)                 this.host.dispatchEvent('mouseup', {htmlEvent : event});");i.setAttribute("onclick","if (!this.host.disabled)                 this.host.dispatchEvent('click', {htmlEvent : event});");});this.$input=this.$getLayoutNode("main","input",this.$ext);this.$button=this.$getLayoutNode("main","button",this.$ext);if(this.type=="password"){this.$propHandlers.type.call(this,"password");}if(!apf.hasContentEditable&&"input|textarea".indexOf(this.$input.tagName.toLowerCase())==-1){var d=this.$input;this.$input=d.parentNode.insertBefore(document.createElement("textarea"),d);d.parentNode.removeChild(d);this.$input.className=d.className;if(this.$ext==d){this.$ext=this.$input;}}if(this.$button){this.$button.onmousedown=function(){c.clear();c.focus({mouse:true});};}if(this.$input.tagName.toLowerCase()=="textarea"){this.addEventListener("focus",function(g){});}this.$input.onselectstart=function(g){if(!g){g=event;}g.cancelBubble=true;};this.$input.host=this;this.$input.onkeydown=function(k){k=k||window.event;if(this.host.disabled){k.returnValue=false;return false;}if(!c.realtime){var i=c.getValue();if(k.keyCode==13&&i!=this.value){c.change(i);}}else{if(apf.isWebkit&&c.xmlRoot&&c.getValue()!=this.value){$setTimeout("var o = apf.lookup("+c.$uniqueId+");                    o.change(o.getValue())");}}if(c.multiline=="optional"&&k.keyCode==13&&!k.shiftKey||k.ctrlKey&&(k.keyCode==66||k.keyCode==73||k.keyCode==85)){k.returnValue=false;return false;}if(c.oContainer){var g=c;var j=k.keyCode;$setTimeout(function(){g.fillAutocomplete(j);});}if(!c.mask){return c.$keyHandler(k.keyCode,k.ctrlKey,k.shiftKey,k.altKey,k);}};this.$input.onkeyup=function(i){if(!i){i=event;}if(this.host.disabled){return false;}var g=i.keyCode;if(c.$button){c.$button.style.display=this.value?"block":"none";}if(c.realtime){$setTimeout(function(){var j;if(!c.mask&&(j=c.getValue())!=c.value){c.change(j);}c.dispatchEvent("keyup",{keyCode:g});});}else{c.dispatchEvent("keyup",{keyCode:g});}};if(apf.hasFocusBug){apf.sanitizeTextbox(this.$input);}if(apf.hasAutocompleteXulBug){this.$input.setAttribute("autocomplete","off");}if(!this.$input.tagName.toLowerCase().match(/input|textarea/)){this.isHTMLBox=true;this.$input.unselectable="Off";this.$input.contentEditable=true;this.$input.style.width="1px";this.$input.select=function(){var g=document.selection.createRange();g.moveToElementText(this);g.select();};}this.$input.deselect=function(){if(!document.selection){return;}var g=document.selection.createRange();g.collapse();g.select();};};this.$loadAml=function(){if(typeof this["initial-message"]=="undefined"){this.$setInheritedAttribute("initial-message");}if(typeof this.realtime=="undefined"){this.$setInheritedAttribute("realtime");}};this.addEventListener("DOMNodeRemovedFromDocument",function(){if(this.$button){this.$button.onmousedown=null;}if(this.$input){this.$input.onkeypress=this.$input.onmouseup=this.$input.onmouseout=this.$input.onmousedown=this.$input.onkeydown=this.$input.onkeyup=this.$input.onselectstart=null;}});}).call(apf.textbox.prototype=new apf.StandardBinding());apf.config.$inheritProperties["initial-message"]=1;apf.config.$inheritProperties.realtime=1;apf.input.prototype=apf.secret.prototype=apf.password.prototype=apf.textarea.prototype=apf.email.prototype=apf.textbox.prototype;apf.aml.setElement("input",apf.input);apf.aml.setElement("secret",apf.secret);apf.aml.setElement("password",apf.password);apf.aml.setElement("textarea",apf.textarea);apf.aml.setElement("textbox",apf.textbox);apf.script=function(){this.$init("script",apf.NODE_HIDDEN);};(function(){this.$propHandlers.src=function(a){if(apf.isOpera){$setTimeout(function(){apf.window.loadCodeFile(apf.hostPath+a);},1000);}else{apf.window.loadCodeFile(apf.getAbsolutePath(apf.hostPath,a));}};this.addEventListener("DOMNodeInserted",function(d){if(d.currentTarget.nodeType==3||d.currentTarget.nodeType==4){var c=d.currentTarget.nodeValue;if(!this.type||this.type=="text/javascript"){apf.jsexec(c);}else{if(this.type=="application/livemarkup"||this.type=="application/lm"){var a=apf.lm.compile(c,{event:true,parsecode:true,funcglobal:true});a(window.event);}}}});this.addEventListener("DOMNodeInsertedIntoDocument",function(n){var c=this.childNodes,g=[];for(var d=0,a=c.length;d<a;d++){g[g.length]=c[d].nodeValue;}var k=g.join("\n");if(!this.type||this.type=="text/javascript"){apf.jsexec(k);}else{if(this.type=="application/livemarkup"||this.type=="application/lm"){var j=apf.lm.compile(k,{event:true,parsecode:true,funcglobal:true});j(window.event);}}});}).call(apf.script.prototype=new apf.AmlElement());apf.aml.setElement("script",apf.script);apf.tree=function(c,a){this.$init(a||"tree",apf.NODE_VISIBLE,c);};(function(){var a=1<<1,d=1<<2,i=1<<3,j=1<<4,c=this.$treeState;this.$mode=0;this.$propHandlers.mode=function(k){if("check|radio".indexOf(k)>-1){this.implement(apf.MultiCheck);this.addEventListener("afterrename",g);this.multicheck=k=="check";this.$mode=this.multicheck?1:2;}else{this.removeEventListener("afterrename",g);this.$mode=0;}};function g(){}this.$initNode=function(F,k,B){this.$getNewContext("item");var t=k&a||this.emptyMessage&&this.$applyBindRule("empty",F),A=this.$getLayoutNode("item");A.setAttribute("onmouseover","var o = apf.lookup("+this.$uniqueId+");            o.$setStyleClass(this, 'hover', null, true);");A.setAttribute("onmouseout","var o = apf.lookup("+this.$uniqueId+");            o.$setStyleClass(this, '', ['hover'], true);");this.$setStyleClass(this.$getLayoutNode("item","class"),c[k]).setAttribute(apf.xmldb.htmlIdTag,B);this.$setStyleClass(this.$getLayoutNode("item","container"),c[k]);var s=this.$getLayoutNode("item","openclose");if(s){s.setAttribute("children",t);s.setAttribute("onmousedown","if (this.getAttribute('children') == false) return;                var o = apf.lookup("+this.$uniqueId+");                o.slideToggle(this, null, null, true);                apf.cancelBubble(event, o);");s.setAttribute("ondblclick","event.cancelBubble = true");}var n=this.opencloseaction||"ondblclick";var C=this.$getLayoutNode("item","icon");if(C&&C!=s){if(n!="ondblclick"){C.setAttribute(n,"var o = apf.lookup("+this.$uniqueId+");"+(n=="onmousedown"?"o.select(this, event.ctrlKey, event.shiftKey, -1);":"")+(true?"o.slideToggle(this, null, null, true);":""));}if(n!="onmousedown"){C.setAttribute("onmousedown","apf.lookup("+this.$uniqueId+").select(this, event.ctrlKey, event.shiftKey, -1);");}C.setAttribute("ondblclick","var o = apf.lookup("+this.$uniqueId+");              o.choose();o.stopRename();"+(true&&!n=="ondblclick"?"o.slideToggle(this, null, null, true);":"")+"apf.cancelBubble(event,o);");}var q=this.$getLayoutNode("item","select"),E;if(this.hasFeature(apf.__RENAME__)||this.hasFeature(apf.__DRAGDROP__)){E="var o = apf.lookup("+this.$uniqueId+");                 var xmlNode = apf.xmldb.findXmlNode(this);                 var isSelected = o.isSelected(xmlNode);                 this.hasPassedDown = true;                 if (!o.renaming && o.hasFocus() && isSelected == 1)                     this.dorename = true;                 if (!o.hasFeature(apf.__DRAGDROP__) || !isSelected && !event.ctrlKey)                     o.select(this, event.ctrlKey, event.shiftKey, -1);";q.setAttribute("onmouseout","this.hasPassedDown = false;"+(q.getAttribute("onmouseout")||""));q.setAttribute("onmouseup","if (!this.hasPassedDown) return;                var o = apf.lookup("+this.$uniqueId+");if (this.dorename && !o.mode)                    o.startDelayedRename(event, null, true);this.dorename = false;                 var xmlNode = apf.xmldb.findXmlNode(this);                 var isSelected = o.isSelected(xmlNode);                 if (o.hasFeature(apf.__DRAGDROP__))                     o.select(this, event.ctrlKey, event.shiftKey, -1);");}else{E="o.select(this, event.ctrlKey, event.shiftKey, -1);";}if(n!="ondblclick"){q.setAttribute(n,"var o = apf.lookup("+this.$uniqueId+");"+(n=="onmousedown"?E:"")+(true?"o.slideToggle(this, null, null, true);":""));}if(n!="onmousedown"){q.setAttribute("onmousedown","var o = apf.lookup("+this.$uniqueId+");"+E);}q.setAttribute("ondblclick","var o = apf.lookup("+this.$uniqueId+");          o.choose();o.stopRename();this.dorename=false;"+(n=="ondblclick"?"o.slideToggle(this, null, null, true);":"")+"apf.cancelBubble(event,o);");if(C){var w=this.$applyBindRule("icon",F);if(w){if(C.tagName.match(/^img$/i)){C.setAttribute("src",apf.getAbsolutePath(this.iconPath,w));}else{C.setAttribute("style","background-image:url("+apf.getAbsolutePath(this.iconPath,w)+")");}}}var D=this.$getLayoutNode("item","caption");if(D){apf.setNodeValue(D,this.$applyBindRule("caption",F));}var u=this.$applyBindRule("tooltip",F);if(u){A.setAttribute("title",u);}var G=this.$applyBindRule("css",F);if(G){this.$setStyleClass(this.$getLayoutNode("item",null,A),G);this.$setStyleClass(this.$getLayoutNode("item","container",A),G);this.$dynCssClasses.push(G);}return A;};this.$updateNode=function(q,t){var n=this.$getLayoutNode("item","icon",t),s=this.$applyBindRule("icon",q);if(n&&s){if(n.tagName&&n.tagName.match(/^img$/i)){n.src=apf.getAbsolutePath(this.iconPath,s);}else{n.style.backgroundImage="url("+apf.getAbsolutePath(this.iconPath,s)+")";}}var w=this.$getLayoutNode("item","caption",t);if(w){if(w.nodeType!=1){w=w.parentNode;}w.innerHTML=this.$applyBindRule("caption",q);}var u=this.$applyBindRule("tooltip",q);if(u){t.setAttribute("title",u);}var k=this.$applyBindRule("css",q);if(k||this.$dynCssClasses.length){this.$setStyleClass(t,k,this.$dynCssClasses);if(k&&!this.$dynCssClasses.contains(k)){this.$dynCssClasses.push(k);}}};this.$draw=function(){this.$drawBase();};}).call(apf.tree.prototype=new apf.BaseTree());apf.aml.setElement("tree",apf.tree);apf.aml.setElement("checked",apf.BindingRule);apf.section=function(c,a){this.$init(a||"section",apf.NODE_VISIBLE,c);};apf.menubar=function(c,a){this.$init(a||"menubar",apf.NODE_VISIBLE,c);};apf.bar=function(c,a){this.$init(a||"bar",apf.NODE_VISIBLE,c);};(function(){this.$focussable=false;this.$canLeechSkin=true;this.$isLeechingSkin=false;this.$propHandlers.caption=function(a){this.$int.innerHTML=a;};this.addEventListener("AMLReparent",function(a,d,c){if(!this.$amlLoaded){return;}if(this.$isLeechingSkin&&!c&&this.skinName!=d.skinName||!this.$isLeechingSkin&&this.parentNode.$hasLayoutNode&&this.parentNode.$hasLayoutNode(this.localName)){this.$isLeechingSkin=true;this.$forceSkinChange(this.parentNode.skinName.split(":")[0]+":"+skinName);}});this.$draw=function(){this.$ext=this.$getExternal(this.$isLeechingSkin?this.localName:"main");if(this.oDrag){this.oDrag.parentNode.removeChild(this.oDrag);}this.oDrag=this.$getLayoutNode(this.$isLeechingSkin?this.localName:"main","dragger",this.$ext);this.$int=this.$getLayoutNode(this.$isLeechingSkin?this.localName:"main","container",this.$ext);};this.$loadAml=function(a){};}).call(apf.bar.prototype=new apf.Presentation());apf.menubar.prototype=apf.section.prototype=apf.bar.prototype;apf.aml.setElement("bar",apf.bar);apf.aml.setElement("menubar",apf.menubar);apf.aml.setElement("section",apf.section);apf.actions=function(c,a){this.$init(a||"actions",apf.NODE_HIDDEN,c);this.$actions=new apf.ruleList();this.$amlNodes={};};(function(){this.$smartbinding=null;this.register=function(a){if(a.localName=="smartbinding"){this.$smartbinding=a;this.$smartbinding.add(this);return;}this.$amlNodes[a.$uniqueId]=a;a.$actions=this.$actions;a.dispatchEvent("actionsload",{bindings:this});};this.unregister=function(a){this.$amlNodes[a.$uniqueId]=null;delete this.$amlNodes[a.$uniqueId];delete a.$actions;a.dispatchEvent("actionsunload",{bindings:this});};this.addEventListener("DOMNodeInsertedIntoDocument",function(j){var c=this.childNodes;for(var g,d=0,a=c.length;d<a;d++){if((g=c[d]).nodeType!=1){continue;}g.dispatchEvent("DOMNodeInsertedIntoDocument");}this.register(this.parentNode);});}).call(apf.actions.prototype=new apf.AmlElement());apf.aml.setElement("actions",apf.actions);apf.radiobutton=function(d,a){this.$init(a||"radiobutton",apf.NODE_VISIBLE,d);this.$constructor=apf.radiobutton;var c=apf.aml.setElement("radiobutton",function(){this.$init(a||"radiobutton",apf.NODE_VISIBLE,d);});c.prototype=apf.radiobutton.prototype;apf.radiobutton=c;};(function(){this.implement(apf.ChildValue);this.$childProperty="label";this.$focussable=true;this.$booleanProperties.checked=true;this.$supportedProperties.push("value","background","group","label","checked","tooltip","icon");this.$propHandlers.group=function(a){if(!this.$amlLoaded){return;}if(this.$group&&this.$group.$removeRadio){this.$group.$removeRadio(this);}if(!a){this.$group=null;return;}var c=typeof a=="string"?apf.nameserver.get("radiogroup",a):a;if(!c){c=apf.nameserver.register("radiogroup",a,new apf.$group());c.setAttribute("id",a);c.dispatchEvent("DOMNodeInsertedIntoDocument");c.parentNode=this;}this.$group=c;if(this.oInput){this.oInput.setAttribute("name",a);}this.$group.$addRadio(this);};this.$propHandlers.tooltip=function(a){this.$ext.setAttribute("title",a);};this.$propHandlers.icon=function(a){if(!this.oIcon){return apf.console.warn("No icon defined in the Button skin","button");}if(a){this.$setStyleClass(this.$ext,this.$baseCSSname+"Icon");}else{this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Icon"]);}apf.skins.setIcon(this.oIcon,a,this.iconPath);};this.$propHandlers.label=function(a){if(a){this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Empty"]);}else{this.$setStyleClass(this.$ext,this.$baseCSSname+"Empty");}if(this.oLabel){this.oLabel.innerHTML=a;}};this.$propHandlers.checked=function(a){if(!this.$group){return;}if(a){this.$group.setProperty("value",this.value);}};this.addEventListener("prop.model",function(a){if(this.$group){this.$group.setProperty("model",a.value);}});this.$propHandlers.background=function(c){var d=this.$getLayoutNode("main","background",this.$ext);if(c){var a=c.split("|");this.$background=a.concat(["vertical",2,16].slice(a.length-1));d.style.backgroundImage="url("+this.mediaPath+a[0]+")";d.style.backgroundRepeat="no-repeat";}else{d.style.backgroundImage="";d.style.backgroundRepeat="";this.$background=null;}};this.setValue=function(a){this.setProperty("value",a,false,true);};this.getValue=function(){return this.value;};this.check=function(){this.setProperty("checked",true,false,true);};this.uncheck=function(){this.setProperty("checked",false,false,true);};this.getGroup=function(){return this.$group;};this.$check=function(a){this.$setStyleClass(this.$ext,this.$baseCSSname+"Checked");this.checked=true;if(this.oInput){this.oInput.checked=true;}this.doBgSwitch(2);};this.$uncheck=function(){this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Checked"]);this.checked=false;if(this.oInput){this.oInput.checked=false;}this.doBgSwitch(1);};this.$enable=function(){if(this.oInput){this.oInput.disabled=false;}var a=this;this.$ext.onclick=function(c){if(!c){c=event;}if((c.srcElement||c.target)==this){return;}a.dispatchEvent("click",{htmlEvent:c});a.$group.change(a.value);};this.$ext.onmousedown=function(c){if(!c){c=event;}if((c.srcElement||c.target)==this){return;}apf.setStyleClass(this,a.$baseCSSname+"Down");};this.$ext.onmouseover=function(c){if(!c){c=event;}if((c.srcElement||c.target)==this){return;}apf.setStyleClass(this,a.$baseCSSname+"Over");};this.$ext.onmouseout=this.$ext.onmouseup=function(){apf.setStyleClass(this,"",[a.$baseCSSname+"Down",a.$baseCSSname+"Over"]);};};this.$disable=function(){if(this.oInput){this.oInput.disabled=true;}this.$ext.onclick=null;this.$ext.onmousedown=null;};this.doBgSwitch=function(c){if(this.bgswitch&&(this.bgoptions[1]>=c||c==4)){if(c==4){c=this.bgoptions[1]+1;}var a=this.bgoptions[0]=="vertical"?"0 -"+(parseInt(this.bgoptions[2])*(c-1))+"px":"-"+(parseInt(this.bgoptions[2])*(c-1))+"px 0";this.$getLayoutNode("main","background",this.$ext).style.backgroundPosition=a;}};this.$focus=function(){if(!this.$ext){return;}if(this.oInput&&this.oInput.disabled){return false;}this.$setStyleClass(this.$ext,this.$baseCSSname+"Focus");};this.$blur=function(){if(!this.$ext){return;}this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Focus"]);};this.addEventListener("keydown",function(d){var a=d.keyCode;if(a==13||a==32){this.$group.change(this.value);return false;}else{if(a==38){var c=this;while(c&&c.previousSibling){c=c.previousSibling;if(c.localName=="radiobutton"&&!c.disabled&&c.$group==this.$group){c.check();c.focus();return;}}}else{if(a==40){var c=this;while(c&&c.nextSibling){c=c.nextSibling;if(c.localName=="radiobutton"&&!c.disabled&&c.$group==this.$group){c.check();c.focus();return;}}}}}},true);this.$draw=function(){this.$ext=this.$getExternal();this.oInput=this.$getLayoutNode("main","input",this.$ext);this.oLabel=this.$getLayoutNode("main","label",this.$ext);this.oIcon=this.$getLayoutNode("main","icon",this.$ext);if(this.oLabel&&this.oLabel.nodeType!=1){this.oLabel=this.oLabel.parentNode;}this.enable();};this.$childProperty="label";this.$loadAml=function(a){if(this.group){this.$propHandlers.group.call(this,this.group);}else{if(this.parentNode.localName=="group"){this.$propHandlers.group.call(this,this.parentNode);}}if(!this.$group){this.$propHandlers.group.call(this,"radiogroup"+this.parentNode.$uniqueId);}};this.$destroy=function(){if(this.$group){this.$group.$removeRadio(this);}};}).call(apf.radiobutton.prototype=new apf.Presentation());apf.aml.setElement("radiobutton",apf.radiobutton);apf.$group=function(g,a){this.$init(a||"radiogroup",apf.NODE_VISIBLE,g);this.implement(apf.StandardBinding,apf.DataAction);var d=[];this.$supportedProperties.push("value","selectedItem");this.$propHandlers.value=function(k){for(var j=0;j<d.length;j++){if(d[j].value==k){return this.setProperty("selectedItem",d[j]);}}return this.setProperty("selectedItem",null);};var c;this.$propHandlers.selectedItem=function(k){if(c){c.$uncheck();}if(!k){return;}k.$check();c=k;for(var j=0;j<d.length;j++){d[j].setProperty("selectedItem",k);}};this.$addRadio=function(i){var j=d.push(i)-1;if(!i.value){i.setProperty("value",j);}if(this.value&&i.value==this.value){this.setProperty("selectedItem",i);}else{if(i.checked){this.setProperty("value",i.value);}}};this.$removeRadio=function(i){d.remove(i);if(i.value===i.id){i.setProperty("value","");}if(i.selectedItem==i){this.setProperty("value",null);}};this.setValue=function(i){this.setProperty("value",i);};this.getValue=function(){return this.value;};this.$draw=function(){this.$ext=this.$int=this.$pHtmlNode;};};apf.$group.prototype=new apf.GuiElement();apf.aml.setElement("group",apf.$group);apf.style=function(c,a){this.$init(a||"style",apf.NODE_HIDDEN,c);};(function(){this.$focussable=false;this.$propHandlers.src=function(a){apf.getData(a,{callback:function(d,c){if(c==apf.SUCCESS){apf.importCssString(d);}}});};this.addEventListener("DOMNodeInsertedIntoDocument",function(a){if(this.type!="text/chartcss"&&this.firstChild){apf.importCssString(this.firstChild.nodeValue);}});}).call(apf.style.prototype=new apf.AmlElement());apf.aml.setElement("style",apf.style);apf.xhtml.setElement("style",apf.style);apf.page=function(c,a){this.$init(a||"page",apf.NODE_VISIBLE,c);};(function(){this.canHaveChildren=true;this.$focussable=false;this.buttons=false;this.closebtn=false;this.setCaption=function(a){this.setProperty("caption",a,false,true);};this.setIcon=function(a){this.setProperty("icon",a,false,true);};this.addEventListener("beforerender",function(){this.parentNode.dispatchEvent("beforerender",{page:this});});this.addEventListener("afterrender",function(){this.parentNode.dispatchEvent("afterrender",{page:this});});this.$booleanProperties.visible=true;this.$booleanProperties.fake=true;this.$booleanProperties.closebtn=true;this.$supportedProperties.push("fake","caption","icon","type","buttons","closebtn");this.$propHandlers.buttons=function(a){this.buttons=a;};this.$propHandlers.closebtn=function(a){this.closebtn=a;};this.$propHandlers.caption=function(c){if(!this.parentNode){return;}var a=this.parentNode.$getLayoutNode("button","caption",this.$button);if(a.nodeType==1){a.innerHTML=c;}else{a.nodeValue=c;}};this.$propHandlers.icon=function(c){if(!this.parentNode){return;}var a=this.parentNode.$getLayoutNode("button","icon",this.$button);if(a&&a.nodeType==1){apf.skins.setIcon(a,c,this.parentNode.iconPath);}};this.$propHandlers.visible=function(g){if(!this.parentNode){return;}if(g){this.$ext.style.display="";if(this.parentNode.$hasButtons){this.$button.style.display="block";}if(!this.parentNode.$activepage){this.parentNode.set(this);}}else{if(this.$active){this.$deactivate();var d=this.parentNode.activepagenr+1;var c=this.parentNode.getPages();var a=c.length;while(d<a&&!c[d].visible){d++;}if(d==a){d=this.parentNode.activepagenr-1;while(d>=0&&a&&!c[d].visible){d--;}}if(d>=0){this.parentNode.set(d);}else{this.parentNode.activepage=this.parentNode.activepagenr=this.parentNode.$activepage=null;}}this.$ext.style.display="none";if(this.parentNode.$hasButtons){this.$button.style.display="none";}}};this.$propHandlers.fake=function(a){if(this.$ext){apf.destroyHtmlNode(this.$ext);this.$int=this.$ext=null;}};this.$propHandlers.type=function(a){this.setProperty("fake",true);this.relPage=this.parentNode.getPage(a);if(this.$active){this.$activate();}};this.addEventListener("DOMNodeRemoved",function(a){if(a&&a.currentTarget!=this){return;}if(this.$button){if(this.$position&1){this.parentNode.$setStyleClass(this.$button,"",["firstbtn","firstcurbtn"]);}if(this.$position&2){this.parentNode.$setStyleClass(this.$button,"",["lastbtn"]);}}if(!a.$doOnlyAdmin){if(this.$button){this.$button.parentNode.removeChild(this.$button);}if(this.parentNode.$activepage==this){if(this.$button){this.parentNode.$setStyleClass(this.$button,"",["curbtn"]);}this.parentNode.$setStyleClass(this.$ext,"",["curpage"]);}}});this.addEventListener("DOMNodeInserted",function(a){if(a&&a.currentTarget!=this||!this.$amlLoaded||!a.$oldParent){return;}if(!a.$isMoveWithinParent&&this.skinName!=this.parentNode.skinName){this.$destroy();}else{if(this.$button&&a.$oldParent.$hasButtons){this.parentNode.$buttons.insertBefore(this.$button,a.$beforeNode&&a.$beforeNode.$button||null);}}},true);this.$position=0;this.$first=function(a){if(a){this.$position-=1;this.parentNode.$setStyleClass(this.$button,"",["firstbtn","firstcurbtn"]);}else{this.$position=this.$position|1;this.parentNode.$setStyleClass(this.$button,"firstbtn"+(this.parentNode.$activepage==this?" firstcurbtn":""));}};this.$last=function(a){if(a){this.$position-=2;this.parentNode.$setStyleClass(this.$button,"",["lastbtn"]);}else{this.$position=this.$position|2;this.parentNode.$setStyleClass(this.$button,"lastbtn");}};this.$deactivate=function(a){this.$active=false;if(this.parentNode.$hasButtons){if(this.$position>0){this.parentNode.$setStyleClass(this.$button,"",["firstcurbtn"]);}this.parentNode.$setStyleClass(this.$button,"",["curbtn"]);}if((!this.fake||this.relPage)&&!a){this.parentNode.$setStyleClass(this.fake?this.relPage.$ext:this.$ext,"",["curpage"]);this.dispatchEvent("prop.visible",{value:false});}};this.$activate=function(){this.$active=true;if(!this.$drawn){var c;this.addEventListener("DOMNodeInsertedIntoDocument",c=function(d){this.removeEventListener("DOMNodeInsertedIntoDocument",c);if(!this.$active){return;}this.$activate();});return;}if(this.parentNode.$hasButtons){if(this.$position>0){this.parentNode.$setStyleClass(this.$button,"firstcurbtn");}this.parentNode.$setStyleClass(this.$button,"curbtn");}if(!this.fake||this.relPage){this.parentNode.$setStyleClass(this.fake?this.relPage.$ext:this.$ext,"curpage");if(apf.layout){apf.layout.forceResize(this.fake?this.relPage.$int:this.$int);}}if(this.$render){this.$render();}if(!this.fake){if(apf.isIE){var a=this.$ext.className;this.$ext.className="rnd"+Math.random();this.$ext.className=a;}this.dispatchEvent("prop.visible",{value:true});}};this.addEventListener("$skinchange",function(){if(this.caption){this.$propHandlers.caption.call(this,this.caption);}if(this.icon){this.$propHandlers.icon.call(this,this.icon);}});this.$canLeechSkin=true;this.$draw=function(d){this.skinName=this.parentNode.skinName;var k=this.getAttribute("type");if(k){this.fake=true;this.relPage=this.parentNode.getPage(k)||null;}if(this.parentNode.$hasButtons){this.parentNode.$getNewContext("button");var i=this.parentNode.$getLayoutNode("button");i.setAttribute(this.parentNode.$getOption("main","select")||"onmousedown","var page = apf.lookup("+this.$uniqueId+");                 if (page.disabled) return;                 page.parentNode.set(page);                 page.canHaveChildren = 2;");i.setAttribute("onmouseover","var o = apf.lookup("+this.parentNode.$uniqueId+");if(apf.lookup("+this.$uniqueId+') != o.$activepage) o.$setStyleClass(this, "over", null, true);');i.setAttribute("onmouseout","var o = apf.lookup("+this.parentNode.$uniqueId+');                  o.$setStyleClass(this, "", ["over"], true);                  var page = apf.lookup('+this.$uniqueId+");                  page.canHaveChildren = true;");var g=this.getAttribute("id")||this.getAttribute("name"),a=this.getAttribute("closebtn");if((a=="true"||(this.parentNode.buttons=="close"&&a==null))&&g){var c=this.parentNode.$getLayoutNode("button","btncontainer");this.parentNode.$getNewContext("btnclose");var j=this.parentNode.$getLayoutNode("btnclose");if(!j){return;}j.setAttribute("onclick","var page = apf.lookup("+this.$uniqueId+");                     page.parentNode.remove("+g+");");c.appendChild(j);}this.$button=apf.insertHtmlNode(i,this.parentNode.$buttons);if(!d&&this.nextSibling&&this.nextSibling.$button){this.$button.parentNode.insertBefore(this.$button,this.nextSibling.$button);}this.$button.host=this;}if(this.fake){return;}if(this.$ext){this.$ext.parentNode.removeChild(this.$ext);}this.$ext=this.parentNode.$getExternal("page",this.parentNode.oPages,null,this);this.$ext.host=this;this.$int=this.parentNode.$getLayoutNode("page","container",this.$ext);};this.$loadAml=function(a){};this.$destroy=function(){if(this.$button){this.$button.host=null;this.$button=null;}};}).call(apf.page.prototype=new apf.Presentation());apf.aml.setElement("page",apf.page);apf.BindingDndRule=function(c,a){this.$init(a,apf.NODE_HIDDEN,c);};(function(){this.compile=function(c){if(!this[c]){return;}var a;if(c=="value"){a=apf.lm.compile(this[c],{xpathmode:3});}else{if(c=="match"){a=apf.lm.compile(this[c],{xpathmode:3,injectself:true});}else{if(c=="target"){a=apf.lm.compile(this[c],{xpathmode:2,injectself:true});}else{if(c=="action"){a=apf.lm.compile(this[c],{nostring:true});}else{if(c=="copy"){a=apf.lm.compile(this[c],{withopt:true,nostring:true});}else{throw new Error("Missing property handler for compile");}}}}}return(this["c"+c]=a);};this.$attrExcludePropBind=apf.extend({target:1,parent:1,action:1,dragcopy:1},this.$attrExcludePropBind);this.$propHandlers.target=this.$propHandlers.parent=this.$propHandlers.action=this.$propHandlers.dragcopy=function(a,c){delete this["c"+c];};this.$noderegister=function(a){apf.GuiElement.propHandlers.drop.call(a.amlNode,true);};this.addEventListener("DOMNodeInsertedIntoDocument",function(g){var d=this;while(d&&d.$bindingRule){d=d.parentNode;}if(!d){return;}if(d.localName=="bindings"){d.addEventListener("noderegister",this.$noderegister);var a=d.$amlNodes;for(var c=0;c<a.length;c++){apf.GuiElement.propHandlers.drop.call(a[c],true);}}else{apf.GuiElement.propHandlers.drop.call(d,true);}});}).call(apf.BindingDndRule.prototype=new apf.BindingRule());apf.aml.setElement("drag",apf.BindingDndRule);apf.aml.setElement("drop",apf.BindingDndRule);apf.toolbar=function(c,a){this.$init(a||"toolbar",apf.NODE_VISIBLE,c);};(function(){this.$focussable=false;this.$draw=function(){this.$ext=this.$getExternal();this.$int=this.$getLayoutNode("main","container",this.$ext);};}).call(apf.toolbar.prototype=new apf.Presentation());apf.aml.setElement("toolbar",apf.toolbar);apf.divider=function(c,a){this.$init(a||"divider",apf.NODE_VISIBLE,c);};(function(){this.$focussable=false;this.implement(apf.ChildValue);this.$childProperty="caption";this.addEventListener("AMLReparent",function(a,d,c){if(!this.$amlLoaded){return;}if(!c&&this.skinName!=d.skinName){this.loadAml();}});this.$supportedProperties.push("caption","value","for","textalign");this.$propHandlers.caption=function(a){if(this.$caption){this.$caption.style.display=a?"inline":"";this.$caption.innerHTML=a;}};this.show=function(){this.setProperty("visible",true);};this.hide=function(){this.setProperty("visible",false);};this.$canLeechSkin=true;this.$draw=function(){if(this.$isLeechingSkin){this.$ext=apf.insertHtmlNode(this.parentNode.$getLayoutNode("divider"),this.$pHtmlNode);}else{this.$ext=this.$getExternal("main");this.$caption=this.$getLayoutNode("main","caption",this.$ext);}};}).call(apf.divider.prototype=new apf.Presentation);apf.aml.setElement("divider",apf.divider);apf.hbox=function(c,a){this.$init(a||"hbox",apf.NODE_VISIBLE,c);this.$lastRules=[];};apf.vbox=function(c,a){this.$init(a||"vbox",apf.NODE_VISIBLE,c);this.$lastRules=[];};(function(){var a=apf.layout;this.$focussable=false;this.$update=false;this.padding=2;this.edge="5 5 5 5";this.pack="start";this.stretch=true;var d=apf.isIE?"styleFloat":"cssFloat";this.$supportedProperties.push("padding","margin","flex","pack","stretch");this.$booleanProperties.stretch=true;this.$propHandlers.padding=this.$propHandlers.edge=this.$propHandlers.pack=this.$propHandlers.stretch=function(i){if(!this.$update&&apf.loaded){a.queue(this.$ext,this.$updateObj);}this.$update=true;};function c(){var i=this.parentNode;if(!i.$update&&apf.loaded){a.queue(i.$ext,i.$updateObj);}i.$update=true;}this.register=function(i){i.$propHandlers.left=i.$propHandlers.top=i.$propHandlers.right=i.$propHandlers.bottom=apf.K;i.$propHandlers.align=i.$propHandlers.flex=i.$propHandlers.width=i.$propHandlers.height=i.$propHandlers.margin=this.$updateObj.updateTrigger;i.addEventListener("prop.visible",c);a.queue(this.$ext,this.$updateObj);this.$update=true;};this.unregister=function(i){i.$propHandlers.left=i.$propHandlers.top=i.$propHandlers.right=i.$propHandlers.bottom=i.$propHandlers.align=i.$propHandlers.flex=i.$propHandlers.width=i.$propHandlers.height=i.$propHandlers.margin=null;i.removeEventListener("prop.visible",c);i.$altExt=null;a.queue(this.$ext,this.$updateObj);this.$update=true;};this.addEventListener("DOMNodeRemoved",function(j){if(this.$isWaitingOnDisplay||!this.$updateObj||j.$doOnlyAdmin){return;}if(j.currentTarget==this){var i=this;while(i){i.unwatch("visible",this.$updateObj.propChange);i=i.parentNode;}}else{if(j.relatedNode==this){this.unregister(j.currentTarget);if(j.currentTarget.nodeFunc==apf.NODE_VISIBLE){j.currentTarget.$ext.style.display=j.currentTarget.visible?"block":"none";j.currentTarget.$ext.style.verticalAlign="";j.currentTarget.$ext.style[d]="";}}}});this.addEventListener("DOMNodeInserted",function(j){if(this.$isWaitingOnDisplay||j.currentTarget.nodeType!=1){return;}if(j.currentTarget==this){var i=this;while(i){i.watch("visible",this.$updateObj.propChange);i=i.parentNode;}}else{if(j.relatedNode==this){if(j.$isMoveWithinParent){a.queue(this.$ext,this.$updateObj);this.$update=true;}else{j.currentTarget.$setLayout(this.localName);}}}});function g(j,i){return typeof j=="string"?j.replace(apf.percentageMatch,"(("+i+" * $1)/100)"):j;}this.addEventListener("prop.height",function(i){if(!this.$update){this.$update=true;a.queue(this.$ext,this.$updateObj);}});this.addEventListener("prop.width",function(i){if(!this.$update){this.$update=true;a.queue(this.$ext,this.$updateObj);}});this.$isWaitingOnDisplay=false;this.$updateBox=function(){if(!this.$update){return;}if(this.$lastRules.length){for(var ad=0,P=this.$lastRules.length;ad<P;ad++){a.removeRule(this.$lastRules[ad][0],this.$lastRules[ad][1]);a.queue(this.$lastRules[ad][0]);}this.$lastRules=[];}if(!this.$ext.offsetWidth){this.$isWaitingOnDisplay=true;this.watch("visible",this.$updateObj.propChange);var Y=this.parentNode;while(Y){Y.watch("visible",this.$updateObj.propChange);Y=Y.parentNode;}return;}this.padding=parseInt(this.padding);var R;var N="pWidth",Z="pHeight",C=apf.getBox(String(this.edge)),t=this.childNodes,U={total:0,count:[],html:[]},L=[],B,M,ac,aa,W,af,I,H,J;this.ids=[this.$ext];var G=t.length,Q=this.localName=="vbox",ab=!Q;this.$hasPerc=false;this.$totalPerc=0;this.$totalFixed=(Q?C[2]:C[1])+((G-1)*this.padding);var K=this.$ext.style.width;var T=this.$ext.style.height;var u=this.height||this.top&&this.bottom||this.anchors;var ae=0;var A=Q?"height":"width";var V=Q?"offsetHeight":"offsetWidth";for(var S=[],ad=0,P=t.length;ad<P;ad++){H=t[ad];if(H.nodeType!=1&&H.nodeType!=7||H.nodeFunc==apf.NODE_HIDDEN||H.visible===false){continue;}aa=apf.getBox(String(H.margin));M=apf.getDiff(B=H.$ext);I=H.span;af={m:aa,weight:parseInt(H.weight)||1,align:H.align,width:H.width,height:H.height,minwidth:H.minwidth||0,minheight:H.minheight||0,oHtml:B};af.isPerc=String(af[A]).indexOf("%")>-1;if(af.width&&!String(af.width).match(/^\d+%?$/)){throw new Error("Invalid width specified:"+af.width);}if(af.height&&!String(af.height).match(/^\d+%?$/)){throw new Error("Invalid height specified:"+af.height);}S.push(af);B.style.display=ab?"inline-block":"block";if(ab){B.style.verticalAlign="top";}var D=false;if(!T&&!u&&af.isPerc){delete af[A];af.isPerc=false;}if(af.isPerc){this.$createInt();if(!H.$altExt){H.$altExt=this.$int.insertBefore(document.createElement("div"),B);H.$altExt.appendChild(B);H.$altExt.style.position="relative";if(ab){H.$altExt.style.display="inline-block";H.$altExt.style.verticalAlign="top";}D=true;}if((H.width||Q&&(this.stretch||!B.style.width))&&(H.height||ab&&this.stretch)){B.style.position="absolute";B.style.left=0;B.style.top=0;B.style.right=0;B.style.bottom=0;B.style.height="";B.style.width="";}else{B.style.position="relative";B.style.display="block";B.style.width="auto";}B.style.margin="";B=af.oHtml=H.$altExt;H.$altExt.style[A]=af[A];this.$hasPerc=true;this.$totalPerc++;if(D&&apf.isIE){apf.layout.forceResize(H.$ext);}if(ab){B.style[d]="";}}else{if(H.$altExt){if(H.$altExt.parentNode==this.$int){this.$int.insertBefore(B,H.$altExt);}H.$altExt.parentNode.removeChild(H.$altExt);H.$altExt=null;D=true;B.style.position="";B.style.display="";}if(af[A]||af[A]===0){if(parseInt(af[A])==NaN){apf.console.warn("Invalid "+A+" specific. Only                             numbers or percentage is allowed:"+af[A]);af[A]=null;}else{this.$totalFixed+=parseInt(af[A]);}B.style[A]=Math.max(0,af[A]-M[Q?1:0])+"px";}else{B.style[A]="";this.$totalFixed+=B[V];if(!B.getAttribute("id")){J="document.getElementById('"+apf.setUniqueHtmlId(B)+"')";}else{J="document.getElementById('"+B.getAttribute("id")+"')";}U.html.push(B);U.count.push(J+"."+V);U.total+=B[V];}B.style.position="relative";if(D&&apf.isIE){apf.layout.forceResize(H.$ext);}if(ab){B.style[d]=af.align&&af.align!=this.pack?(af.align=="start"?"left":"right"):"";}}if(Q){if((af.width||af.width===0)&&String(af.width).indexOf("%")==-1){ae=Math.max(ae,af.width);B.style.width=(af.width-M[0])+"px";}else{if(this.stretch){ae=Math.max(ae,af.minwidth||5);B.style.width="auto";}else{B.style.width="";ae=Math.max(ae,af.minwidth);}}ae+=aa[1]+aa[3];}else{if(ab){if((af.height||af.height===0)&&String(af.height).indexOf("%")==-1){ae=Math.max(ae,af.height);B.style.height=(af.height-M[1])+"px";}else{if(u&&this.stretch){ae=Math.max(ae,af.minheight||5);L.push([B,M[1],af.m]);}else{B.style.height="";ae=Math.max(ae,af.minheight);}}ae+=aa[0]+aa[2];}}this.$totalFixed+=(Q?aa[0]+aa[2]:aa[1]+aa[3]);}if(S.length==0){this.$update=false;return;}var E,aa,q;for(ad=0,P=S.length;ad<P;ad++){af=S[ad];aa=af.m;q=S[ad+1]&&S[ad+1].m;af.oHtml.style.margin=Q?(aa[0]+(E&&E[2]||0))+"px "+aa[1]+"px "+(aa[2]+(q&&q[0]||0)+(ad<P-1?this.padding:0))+"px "+aa[3]+"px":aa[0]+"px "+(aa[1]+(q&&q[3]||0)+(ad<P-1?this.padding:0))+"px "+aa[2]+"px "+(aa[3]+(E&&E[1]||0))+"px";E=af.m;}var O=apf.getBox(this.$ext.style.padding);if(this.$hasPerc){this.$ext.style.padding=Q?C[0]+"px "+C[1]+"px "+this.$totalFixed+"px "+C[3]+"px":C[0]+"px "+this.$totalFixed+"px "+C[2]+"px "+C[3]+"px";}else{this.$ext.style.padding=C.join("px ")+"px";}if(U.count){var F="apf.all["+this.$uniqueId+"]";U.count=U.count.join(" + ");for(var ad=0;ad<U.html.length;ad++){html=U.html[ad];if(this.$hasPerc){a.setRules(html,"boxp",F+".$ext.style.padding"+(Q?"Bottom":"Right")+" = ("+(this.$totalFixed-U.total)+" + "+U.count+") + 'px';",true);}else{a.setRules(html,"boxp",F+".$ext.style.min"+(Q?"Height":"Width")+" = -"+(Q?C[2]:C[1])+" + ("+F+"['min"+A+"'] = "+(this.$totalFixed-U.total)+" + "+U.count+") + 'px';",true);}a.queue(html);this.$lastRules.push([html,"boxp"]);}this.$totalFixed+=Q?C[0]:C[3];}var X=apf.getBox(this.$ext.style.padding);var k=parseInt(apf.getStyle(this.$ext,"width"));var n=parseInt(apf.getStyle(this.$ext,"height"));if(K&&(k||k===0)){if(this.width){this.$propHandlers.width.call(this,this.width);}else{if(this.left&&this.right){this.$propHandlers.right.call(this,this.right);}else{this.$ext.style.width=Math.max(0,k+O[1]-X[1]+O[3]-X[3])+"px";}}}if(T&&(n||n===0)){if(this.height){this.$propHandlers.height.call(this,this.height);}else{if(this.top&&this.bottom){this.$propHandlers.bottom.call(this,this.bottom);}else{this.$ext.style.height=Math.max(0,n+O[0]-X[0]+O[2]-X[2])+"px";}}}if(u&&L.length){var w=["var height = apf.all["+this.$uniqueId+"].$ext.offsetHeight"];for(ad=0;ad<L.length;ad++){html=L[ad][0];if(!html.getAttribute("id")){J="document.getElementById('"+apf.setUniqueHtmlId(html)+"')";}else{J="document.getElementById('"+html.getAttribute("id")+"')";}w.push(J+".style.height = (height - apf.getHeightDiff("+J+") - "+ +(C[0]+C[2]+L[ad][2][0]+L[ad][2][2])+") + 'px'");}a.setRules(this.$ext,"boxh",(w.length?"try{"+w.join(";}catch(e){};\ntry{")+";}catch(e){};":""),true);a.queue(this.$ext);this.$lastRules.push([this.$ext,"boxh"]);}if(ab){this.$int.style.textAlign=this.$hasPerc||!this.pack||this.pack=="start"?"left":(this.pack=="middle"?"center":"right");}else{if(this.pack||this.$ext!=this.$int){this.$createInt();if(this.$hasPerc||!this.pack||this.pack=="start"){this.$int.style.position="static";if(Q){this.$int.style.height="100%";}this.$int.style.top="";this.$int.style.marginTop="";}else{if(this.pack=="middle"){this.$int.style.position="relative";this.$int.style.top="50%";this.$int.style.height="auto";this.$int.style.marginTop="-"+(this.$int.offsetHeight/2)+"px";}else{if(this.pack=="end"){this.$int.style.position="relative";this.$int.style.top="100%";this.$int.style.height="auto";this.$int.style.marginTop="-"+this.$int.offsetHeight+"px";}}}}}this["min"+A]=this.$totalFixed+(Q?C[0]:C[3])-3+(this.$totalPerc*5);this.$ext.style["min"+A.uCaseFirst()]=((this.$hasPerc?(this.$totalPerc*5):this.$totalFixed-(Q?C[2]:C[1])-3))+"px";this["min"+(Q?"width":"height")]=ae+(Q?C[1]+C[3]:C[0]+C[2]);this.$ext.style["min"+(Q?"Width":"Height")]=(ae)+"px";this.$update=false;};this.$createInt=function(){if(this.$ext==this.$int){this.$int=this.$ext.appendChild(document.createElement("div"));this.$int.style.whiteSpace="nowrap";this.$int.className="int";var k=this.$ext.childNodes;for(var i=k.length-2;i>=0;i--){this.$int.insertBefore(k[i],this.$int.firstChild);}if(this.localName=="vbox"){this.$int.style.height="100%";}}};this.$draw=function(){var i=this;this.$updateObj={$updateLayout:function(){i.$updateBox();},updateTrigger:function(j){if(!i.$update&&i.$amlLoaded){a.queue(i.$ext,i.$updateObj);}i.$update=true;},propChange:function(k,j,n){if(i.$update&&apf.isTrue(n)&&i.$ext.offsetWidth){i.$updateBox();a.activateRules(i.$ext);var q=i;while(q){q.unwatch("visible",i.$updateObj.propChange);q=q.parentNode;}i.$isWaitingOnDisplay=false;}}};this.$ext=this.$pHtmlNode.appendChild(document.createElement("div"));this.$ext.className=this.localName+" "+(this.getAttribute("class")||"");this.$ext.style.whiteSpace="nowrap";this.$ext.style.overflow="hidden";this.$int=this.$ext;this.$ext.host=this;this.$ext.style.position="relative";this.$ext.style.minHeight="10px";if(!apf.vbox.$initedcss){apf.importCssString(".vbox>*{white-space:normal;} .hbox>*{white-space:normal;} .vbox>.int>*{white-space:normal;} .hbox>.int>*{white-space:normal;}");apf.vbox.$initedcss=true;}a.queue(this.$ext,this.$updateObj);this.$update=true;};this.$loadAml=function(i){if(!this.width&&(apf.getStyle(this.$ext,"position")=="absolute"||this.left||this.top||this.right||this.bottom||this.anchors)){this.$ext.style.width="100%";}};}).call(apf.vbox.prototype=new apf.GuiElement());apf.hbox.prototype=apf.vbox.prototype;apf.aml.setElement("hbox",apf.hbox);apf.aml.setElement("vbox",apf.vbox);apf.event=function(c,a){this.$init(a||"event",apf.NODE_HIDDEN,c);};(function(){this.$hasInitedWhen=false;this.$booleanProperties.repeat=true;this.$supportedProperties.push("when","message","icon","repeat");this.$propHandlers.when=function(c){if(this.$hasInitedWhen&&c&&this.parentNode&&this.parentNode.popup){var a=this;$setTimeout(function(){a.parentNode.popup(a.message,a.icon,a);});}this.$hasInitedWhen=true;if(this.repeat){delete this.when;}};this.$loadAml=function(a){};}).call(apf.event.prototype=new apf.AmlElement());apf.aml.setElement("event",apf.event);apf.BindingSeriesRule=function(c,a){this.$init(a||"series",apf.NODE_HIDDEN,c);};(function(){this.$attrExcludePropBind=apf.extend({formula:1},this.$attrExcludePropBind);this.$propHandlers.formula=function(a,c){delete this["c"+c];};}).call(apf.BindingSeriesRule.prototype=new apf.BindingRule());apf.aml.setElement("series",apf.BindingSeriesRule);apf.iconmap=function(){this.$init("iconmap",apf.NODE_HIDDEN);};(function(){this.$parsePrio="050";this.addEventListener("DOMNodeInsertedIntoDocument",function(a){if(!this.id){throw new Error(apf.formatErrorString(0,this,"Creating icon map","Could not create iconmap. Missing id attribute",this.$aml));}apf.skins.addIconMap({name:this.id,src:this.src,type:this.type,size:parseInt(this.size),width:parseInt(this.width),height:parseInt(this.height),offset:(this.offset||"0,0").splitSafe(",")});});}).call(apf.iconmap.prototype=new apf.AmlElement());apf.aml.setElement("iconmap",apf.iconmap);apf.BindingColumnRule=function(c,a){this.$init(a,apf.NODE_HIDDEN,c);this.$className="col"+this.$uniqueId;};(function(){this.$defaultwidth="100";this.$width=100;this.$sortable=true;this.$resizable=true;this.$movable=true;this.$cssInit=false;this.$attrExcludePropBind=apf.extend({css:1,icon:1,caption:1},this.$attrExcludePropBind);this.$supportedProperties.push("tree","icon","caption","width","options","editor","colspan","align","css");this.$booleanProperties.tree=true;this.$propHandlers.icon=function(a,c){};this.$propHandlers.caption=function(a,c){};this.$propHandlers.width=function(a,c){if(!a){a=this.$defaultwidth;}this.$isPercentage=a&&String(a).indexOf("%")>-1;this.$width=parseFloat(a);};this.$propHandlers.options=function(a,c){this.$sortable=a.indexOf("sort")>-1;this.$resizable=a.indexOf("size")>-1;this.$movable=a.indexOf("move")>-1;};this.$propHandlers.editor=function(a,c){};this.$propHandlers.colspan=function(a,c){};this.$propHandlers.align=function(a,c){};this.$propHandlers.css=function(a,c){};this.resize=function(c,E){var u;if(this.$isPercentage){var B=(this.$ext.offsetWidth-(E.$widthdiff-3)),A=c/B,w=[],k=[],C=0,d=this.$ext.nextSibling;while(d&&d.getAttribute("hid")){u=apf.all[d.getAttribute("hid")];if(u.$isPercentage){w.push(u);C+=u.$width;}else{k.push(u);}d=d.nextSibling;}if(k.length&&!w.length){return k[0].resize(k[0].$width+(B-c),E);}var j=A*this.$width,t=j-this.$width,s=(C-t)/C;if(s<0.01){if(c<20){return;}return this.resize(c-10,E);}for(var a,q=0;q<w.length;q++){a=w[q];a.$width*=s;apf.setStyleRule("."+a.$className,"width",a.$width+"%");}this.$width=j;apf.setStyleRule("."+this.$className,"width",this.$width+"%");}else{var D=c-this.$width;this.$width=c;if(apf.isIE&&E.oIframe){this.$ext.style.width=c+"px";}else{}apf.setStyleRule("."+this.$className,"width",c+"px",null,E.oWin);E.$fixed+=D;var g=(E.$fixed)+"px";if(!this.$isFixedGrid){apf.setStyleRule("."+E.$baseCSSname+" .row"+E.$uniqueId,"paddingRight",g,null,this.oWin);apf.setStyleRule("."+E.$baseCSSname+" .row"+E.$uniqueId,"marginRight","-"+g,null,E.oWin);E.$container.style.paddingRight=E.$head.style.paddingRight=g;}}};this.hide=function(){apf.setStyleRule("."+this.$baseCSSname+" .records ."+h.$className,"visibility","hidden",null,this.oWin);};this.show=function(){apf.setStyleRule("."+this.$baseCSSname+" .records ."+h.$className,"visibility","visible",null,this.oWin);};this.sort=function(a){if(a.$lastSorted==this){apf.setStyleClass(this.$int,a.toggleSortOrder()?"ascending":"descending",["descending","ascending"]);return;}var c;if(c=a.$lastSorted){apf.setStyleRule("."+c.$className,"background","white");apf.setStyleClass(c.$int,"",["descending","ascending"]);}apf.setStyleRule("."+this.$className,"background","#f3f3f3");apf.setStyleClass(this.$int,"ascending",["descending","ascending"]);if(!a.length){return;}a.resort({order:"ascending",xpath:this.cvalue2.xpaths[1]});a.$lastSorted=this;};this.move=function(d,i){if(d&&this==d){return;}var g=this,c=apf.getChildNumber(g.$int),j=d&&apf.getChildNumber(d.$int);i.$head.insertBefore(g.$int,d&&d.$int||null);if(!i.length){return;}(function a(k){for(var q,n=0;n<k.length;n++){q=k[n];if(i.$isTreeArch&&q.tagName=="BLOCKQUOTE"){a(q.childNodes);}else{q.insertBefore(q.childNodes[c],typeof j!="undefined"&&q.childNodes[j]||null);}}})(i.$container.childNodes);};this.$draw=function(i,d,k,j){var i=i||this.parentNode;while(i.$bindingRule){i=i.parentNode;}if(!i.hasFeature(apf.__PRESENTATION__)){return;}if(k){this.$propHandlers.width.call(this,k);}apf.importStylesheet([["."+this.$className,"width:"+this.$width+(this.$isPercentage?"%;":"px;")+"text-align:"+this.align]]);i.$getNewContext("headitem");var c=i.$getLayoutNode("headitem");c.setAttribute("class",this.$className+(j?" "+j:""));c.setAttribute("hid",this.$uniqueId);var g=i.$getLayoutNode("headitem","caption");g.nodeValue=this.caption||d||"";this.$ext=this.$int=apf.insertHtmlNode(c,i.$head||i.$container);var n=false;var a=this;this.$int.onmouseover=function(q){if(!q){q=event;}if(i.disabled){return;}apf.setStyleClass(this,"hover",["down"]);};this.$int.onmouseup=function(q){if(!q){q=event;}if(i.disabled||!apf.isChildOf(n,this,true)){return;}apf.setStyleClass(this,"hover",["down"]);if(a.$sortable){a.sort(i);}i.dispatchEvent("sortcolumn",a);};this.$int.onmousedown=function(w){if(!w){w=event;}n=target=this;if(i.disabled){return;}var C=apf.getAbsolutePosition(target),A=i.$head.scrollLeft;var B=w.clientX-C[0]+A;if(B<4||target.offsetWidth-B-8<3&&apf.getChildNumber(a.$int)<i.$headings.length-1){var F=B<4&&target.previousSibling||target;if(a.$resizable){C=apf.getAbsolutePosition(F);apf.setStyleClass(i.$pointer,"size_pointer",["move_pointer"]);i.$pointer.style.display="block";i.$pointer.style.left=(F.offsetLeft-A-1)+"px";i.$pointer.style.width=(F.offsetWidth-i.$widthdiff+1)+"px";apf.plane.show(i.$pointer,null,true);n=true;document.onmouseup=function(){if(!w){w=event;}document.onmouseup=document.onmousemove=null;apf.all[F.getAttribute("hid")].resize(i.$pointer.offsetWidth,i);n=false;i.$pointer.style.display="none";apf.plane.hide();};document.onmousemove=function(t){if(!t){t=event;}i.$pointer.style.width=Math.max(10,Math.min(i.$container.offsetWidth-i.$pointer.offsetLeft-20,t.clientX-C[0]-1+A))+"px";};return;}}apf.setStyleClass(target,"down",["hover"]);if(!a.$movable){document.onmouseup=function(t){document.onmouseup=null;n=false;};return;}apf.setStyleClass(i.$pointer,"move_pointer",["size_pointer"]);var E=w.clientX-target.offsetLeft,u=w.clientX,D=w.clientY-target.offsetTop,s=w.clientY,q;document.onmouseup=function(H){if(!H){H=event;}document.onmouseup=document.onmousemove=null;n=false;i.$pointer.style.display="none";if(!q){return;}q.style.top="-100px";var G=document.elementFromPoint(H.clientX,H.clientY);if(G.parentNode==q.parentNode){var I=apf.getAbsolutePosition(G);var t=(H.clientX-I[0]>G.offsetWidth/2?G.nextSibling:G);a.move(t?apf.all[t.getAttribute("hid")]:null,i);}apf.destroyHtmlNode(q);};document.onmousemove=function(H){if(!H){H=event;}if(!q){if(Math.abs(H.clientX-u)<3&&Math.abs(H.clientY-s)<3){return;}q=target.cloneNode(true);q.style.position="absolute";var G=apf.getWidthDiff(target);q.style.width=(target.offsetWidth-G-i.$widthdiff+2)+"px";q.style.left=target.offsetLeft;q.style.top=target.offsetTop;q.style.margin=0;q.removeAttribute("hid");apf.setStyleClass(q,"drag",["ascending","descending"]);target.parentNode.appendChild(q);}q.style.top="-100px";i.$pointer.style.display="none";var t=document.elementFromPoint(H.clientX,H.clientY);if(t.parentNode==q.parentNode){var I=apf.getAbsolutePosition(t);i.$pointer.style.left=(t.offsetLeft+((H.clientX-I[0]>t.offsetWidth/2)?t.offsetWidth-8:0))+"px";i.$pointer.style.display="block";}q.style.left=(H.clientX-E)+"px";q.style.top=(H.clientY-D)+"px";};};this.$int.onmouseout=function(q){if(!q){q=event;}if(i.disabled){return;}i.$ext.style.cursor="";apf.setStyleClass(this,"",["hover","down"]);};this.$int.onmousemove=function(u){if(n||i.disabled){return;}if(!u){u=event;}var A=apf.getAbsolutePosition(this),q=i.$head.scrollLeft;var w=u.clientX-A[0]+q;if(w<4||this.offsetWidth-w-i.$widthdiff<3&&apf.getChildNumber(a.$int)<i.$headings.length-1){var s=w<4?this.previousSibling:this;i.$ext.style.cursor=s&&a.$resizable?"w-resize":"default";}else{i.$ext.style.cursor="default";}};return this;};this.addEventListener("DOMNodeInsertedIntoDocument",function(a){this.$draw();});this.addEventListener("DOMNodeRemovedFromDocument",function(a){if(!this.$int){return;}this.$int.onmouseover=this.$int.onmouseup=this.$int.onmousedown=this.$int.onmousemove=this.$int.onmouseout=null;});}).call(apf.BindingColumnRule.prototype=new apf.BindingRule());apf.aml.setElement("column",apf.BindingColumnRule);apf.table=function(c,a){this.$init(a||"table",apf.NODE_VISIBLE,c);};(function(){this.$focussable=false;this.$update=false;this.columns="150,200";this.padding=2;this.$edge=[5,5,5,5];this.cellheight=19;this.$supportedProperties.push("columns","padding","edge","cellheight","span");this.$propHandlers.columns=function(w){if(!w.match(/^(\d+\%?\s*(?:,\s*|\s*$))+$/)){apf.console.warn("Invalid column string found for table: "+w);return;}var g,k=this.$columns=w.splitSafe(",");var u=0,t=this.$table.getElementsByTagName("col");if(t.length){for(var s,n=0,j=Math.min(t.length,k.length);n<j;n++){t[n].style.width=(s=k[n]).indexOf("%")>-1?s:s+"px";u+=parseInt(s);}}var d=t.length-k.length;if(d>0){for(var n=t.length-d;n<t.length;n++){t[n].parentNode.removeChild(t[n]);}}else{if(d<0){for(var n=k.length+d;n<k.length;n++){g=this.$table.appendChild(document.createElement("col"));g.style.width=(s=k[n]).indexOf("%")>-1?s:s+"px";g.setAttribute("valign","top");u+=parseInt(s);}}}this.$table.style.width=String(w).indexOf("%")>-1?"auto":(u+((k.length-1)*this.padding)+this.$edge[0]+this.$edge[2])+"px";var A=this.$tbody.firstChild.getElementsByTagName("td");for(var n=A.length-1;n>=0;n--){A[n].parentNode.removeChild(A[n]);}for(var q,n=0;n<k.length;n++){q=this.$tbody.firstChild.appendChild(document.createElement("td"));if(k[n].indexOf("%")>-1){q.appendChild(document.createElement("div")).style.width="50px";}}if(d&&this.$amlLoaded){a({sync:true,parentNode:this});}};this.$propHandlers.padding=function(t){var n=this.$table.getElementsByTagName("td");var j,s,g,d=this.$tbody.lastChild;for(var q=this.$columns.length,k=n.length;q<k;q++){j=(g=n[q]).parentNode.lastChild==g;s=g.parentNode==d;g.style.padding="0px "+(j?0:t)+"px "+(s?0:t)+"px 0px";}};this.$propHandlers.edge=function(d){this.$table.style.padding=(this.$edge=apf.getBox(d)).join("px ")+"px";};function a(J){var I=J.parentNode||this.parentNode;if(J.sync||J.value&&!this.$altExt||!J.value&&this.$altExt){var B=I.childNodes;var d=apf.getArrayFromNodelist(I.$tbody.getElementsByTagName("td"));var w=I.$tbody.getElementsByTagName("tr");var u=[],j=1,g,n,A=I.$columns.length;var s=I.$columns.length,D,G;for(var C,q,t,E=B.length,H=0;H<E;H++){if((C=B[H]).visible===false){continue;}q=C.$altExt=t=d[s++];if(!w[j]){I.$tbody.appendChild(document.createElement("tr"));}w[j].appendChild(q);q.appendChild(C.$ext);q.setAttribute("colspan",g=Math.min(A-(u[0]||0),parseInt(C.colspan||C.span||1)));q.setAttribute("rowspan",n=parseInt(C.rowspan||1));if(!u[0]){u[0]=0;}u[0]+=g;if(n>1){for(var F=1;F<n;F++){if(!u[F]){u[F]=0;}u[F]+=g;}}if(u[0]>=A){D=true;u.shift();j++;}else{D=false;}q.style.padding="0px "+(D?0:I.padding)+"px "+(H==E-1?0:I.padding)+"px 0px";}for(;s<d.length;s++){d[s].parentNode.removeChild(d[s]);}if(J.sync){return;}if(J.value){I.$addTd(B[E-1]);}else{this.$altExt=null;}}}this.$addTd=function(k){var g=this.$table.getElementsByTagName("td");var q=0;for(var d,j=0;j<g.length;j++){q+=1+(parseInt((d=g[j]).getAttribute("colspan")||1)-1)+(parseInt((d=g[j]).getAttribute("rowspan")||1)-1);}if(q%this.$columns.length==0){var s=this.$tbody.appendChild(document.createElement("tr"));}else{s=g[g.length-1].parentNode;}var n=s.appendChild(document.createElement("td"));n.style.position="relative";if(k.colspan||k.span){n.setAttribute("colspan",k.colspan||k.span);}if(k.rowspan){n.setAttribute("rowspan",k.rowspan);}n.appendChild(k.$ext);k.$altExt=n;};var c={width:function(d){this.$ext.style.width="";},height:function(d){this.$ext.style.height=d?Math.max(0,d-apf.getHeightDiff(this.$ext))+"px":"";},margin:function(d){this.$ext.style.margin=apf.getBox(d).join("px ")+"px";},colspan:function(d){if(!d){this.$altExt.removeAttribute("colspan");}else{this.$altExt.setAttribute("colspan",d);}a.call(this,{sync:true});},rowspan:function(d){if(!d){this.$altExt.removeAttribute("rowspan");}else{this.$altExt.setAttribute("rowspan",d);}a.call(this,{sync:true});},valign:function(d){this.$altExt.valign=d;},align:function(d){this.$altExt.align=d;}};c.span=c.colspan;this.register=function(d){if(d.$altExt){return;}d.$propHandlers.left=d.$propHandlers.top=d.$propHandlers.right=d.$propHandlers.bottom=apf.K;for(var g in c){d.$propHandlers[g]=c[g];}d.addEventListener("prop.visible",a);this.$addTd(d);if(d.margin){c.margin.call(d,d.margin);}if(d.$ext.tagName=="INPUT"){}else{d.$ext.style.width="auto";}if(this.lastChild==d){this.$propHandlers.padding.call(this,this.padding);}};this.unregister=function(d){d.$propHandlers.left=d.$propHandlers.top=d.$propHandlers.right=d.$propHandlers.bottom=null;for(var g in c){delete d.$propHandlers[g];}d.removeEventListener("prop.visible",a);a.call(d,{value:false});if(d.margin){d.$ext.style.margin="";}if(d.width){d.$ext.style.width="";}};this.addEventListener("DOMNodeRemoved",function(d){if(d.$doOnlyAdmin||d.currentTarget==this){return;}if(d.relatedNode==this){this.unregister(d.currentTarget);d.currentTarget.$setLayout();}});this.addEventListener("DOMNodeInserted",function(d){if(d.currentTarget==this||d.currentTarget.nodeType!=1){return;}if(d.relatedNode==this){if(d.$isMoveWithinParent){a.call(d.currentTarget,{sync:true});}else{d.currentTarget.$setLayout("table");if(d.currentTarget.nextSibling){a.call(d.currentTarget,{sync:true});}}}});this.$draw=function(){this.$pHtmlNode.insertAdjacentHTML("beforeend","<div><table cellSpacing='0' cellPadding='0'><tbody><tr class='first'></tr></tbody></table></div>");this.$ext=this.$pHtmlNode.lastChild;this.$table=this.$ext.firstChild;this.$tbody=this.$table.firstChild;this.$ext.className="table "+(this.getAttribute("class")||"");this.$int=this.$ext;this.$ext.host=this;if(this.getAttribute("class")){apf.setStyleClass(this.$ext,this.getAttribute("class"));}apf.layout.setRules(this.$ext,"table","apf.all["+this.$uniqueId+"].$resize()",true);apf.layout.queue(this.$ext);this.$originalMin=[this.minwidth||0,this.minheight||0];};this.$resize=function(){if(this.$table.offsetWidth>=this.$ext.offsetWidth){this.$ext.style.minWidth=(this.minwidth=Math.max(0,this.$table.offsetWidth-apf.getWidthDiff(this.$ext)))+"px";}else{this.$ext.style.minWidth="";this.minwidth=this.$originalMin[0];}if(this.$table.offsetHeight>=this.$ext.offsetHeight){this.$ext.style.minHeight=(this.minheight=Math.max(0,this.$table.offsetHeight-apf.getHeightDiff(this.$ext)))+"px";}else{this.$ext.style.minHeight="";this.minheight=this.$originalMin[1];}};this.$loadAml=function(d){this.$amlLoaded=false;if(!this.$columns){this.$propHandlers.columns.call(this,this.columns);}this.$amlLoaded=true;};}).call(apf.table.prototype=new apf.GuiElement());apf.aml.setElement("table",apf.table);apf["switch"]=function(c,a){this.$hasButtons=false;this.$init(a||"switch",apf.NODE_VISIBLE,c);};apf.pages=function(c,a){this.$hasButtons=false;this.$init(a||"pages",apf.NODE_VISIBLE,c);};apf.tab=function(c,a){this.$hasButtons=true;this.$init(a||"tab",apf.NODE_VISIBLE,c);};(function(){this.$focussable=apf.KEYBOARD;this.$draw=function(a){this.$ext=this.$getExternal();this.$loadChildren();};}).call(apf.tab.prototype=new apf.BaseTab());apf["switch"].prototype=apf.pages.prototype=apf.tab.prototype;apf.aml.setElement("switch",apf["switch"]);apf.aml.setElement("pages",apf.pages);apf.aml.setElement("tab",apf.tab);apf.aml.setElement("teleport",apf.AmlElement);apf.label=function(c,a){this.$init(a||"label",apf.NODE_VISIBLE,c);};(function(){this.implement(apf.DataAction,apf.ChildValue);var a=this;this.$focussable=false;var c;this.setValue=function(d){this.setProperty("value",d,false,true);};this.getValue=function(){return this.value;};this.$supportedProperties.push("caption","for","textalign");this.$propHandlers.caption=function(d){this.$caption.innerHTML=d;};this.$propHandlers["for"]=function(d){c=typeof d=="string"?self[d]:d;};this.$propHandlers.textalign=function(d){this.$caption.style.textAlign=d||"";};this.$draw=function(){this.$ext=this.$getExternal();this.$caption=this.$getLayoutNode("main","caption",this.$ext);if(this.$caption.nodeType!=1){this.$caption=this.$caption.parentNode;}this.$ext.onmousedown=function(){if(c&&c.$focussable&&c.focussable){c.focus();}};};this.$childProperty="caption";}).call(apf.label.prototype=new apf.BaseSimple());apf.aml.setElement("label",apf.label);apf.BindingLoadRule=function(c,a){this.$init(a,apf.NODE_HIDDEN,c);};(function(){this.$attrExcludePropBind=apf.extend({get:1},this.$attrExcludePropBind);this.$propHandlers.get=function(a,c){delete this["c"+c];};}).call(apf.BindingLoadRule.prototype=new apf.BindingRule());apf.aml.setElement("load",apf.BindingLoadRule);apf.aml.setElement("insert",apf.BindingLoadRule);apf.submit=function(c,a){this.$init(a||"submit",apf.NODE_VISIBLE,c);};apf.trigger=function(c,a){this.$init(a||"trigger",apf.NODE_VISIBLE,c);};apf.reset=function(c,a){this.$init(a||"reset",apf.NODE_VISIBLE,c);};apf.button=function(c,a){this.$init(a||"button",apf.NODE_VISIBLE,c);};(function(){this.$useExtraDiv;this.$childProperty="caption";this.$inited=false;this.$isLeechingSkin=false;this.$canLeechSkin=true;this.$focussable=true;this.value=null;this.$init(function(){var n,g=this;this.$propHandlers["default"]=function(q){if(!this.focussable&&q||n){this.setAttribute("focussable",n=q);}this.parentNode.removeEventListener("focus",k);this.parentNode.removeEventListener("blur",i);if(!q){return;}this.parentNode.addEventListener("focus",k);this.parentNode.addEventListener("blur",i);};function k(q){if(q.defaultButtonSet||q.returnValue===false){return;}q.defaultButtonSet=true;if(this.$useExtraDiv){g.$ext.appendChild(apf.button.$extradiv);}g.$setStyleClass(g.$ext,g.$baseCSSname+"Default");if(q.srcElement!=g&&g.$focusParent){g.$focusParent.addEventListener("keydown",j);}}function i(q){if(this.$useExtraDiv&&apf.button.$extradiv.parentNode==g.$ext){g.$ext.removeChild(apf.button.$extradiv);}g.$setStyleClass(g.$ext,"",[g.$baseCSSname+"Default"]);if(q.srcElement!=g&&g.$focusParent){g.$focusParent.removeEventListener("keydown",j);}}function j(s){var t;var q=apf.document.activeElement;if(q){if(q.hasFeature(apf.__MULTISELECT__)){return;}t=q.multiline;}if(!g.$ext.onmouseup){return;}if(t&&t!="optional"&&s.keyCode==13&&s.ctrlKey||(!t||t=="optional")&&s.keyCode==13&&!s.ctrlKey&&!s.shiftKey&&!s.altKey){g.$ext.onmouseup(s.htmlEvent,true);}}this.addEventListener("focus",k);this.addEventListener("blur",i);this.$enable=function(){if(this["default"]){k({});if(apf.document.activeElement){apf.document.activeElement.focus(true);}}if(this.state&&this.value){this.$setState("Down",{});}this.$doBgSwitch(1);};this.$disable=function(){if(this["default"]){i({});}this.$doBgSwitch(4);this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Over",this.$baseCSSname+"Down"]);};});this.$booleanProperties["default"]=true;this.$supportedProperties.push("icon","value","tooltip","state","color","caption","action","target","default","submenu","hotkye");this.$propHandlers.icon=function(g){if(!this.oIcon){return apf.console.warn("No icon defined in the Button skin","button");}if(g){this.$setStyleClass(this.$ext,this.$baseCSSname+"Icon");}else{this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Icon"]);}apf.skins.setIcon(this.oIcon,g,this.iconPath);};this.$propHandlers.value=function(g){if(!this.state&&!this.submenu){return;}if(g===undefined){g=!this.value;}this.value=g;if(this.value){this.$setState("Down",{});}else{this.$setState("Out",{});}};this.$propHandlers.state=function(g){this.$setStateBehaviour(g==1);};this.$propHandlers.color=function(g){if(this.oCaption){this.oCaption.parentNode.style.color=g;}};this.$propHandlers.caption=function(g){if(g){this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Empty"]);}else{this.$setStyleClass(this.$ext,this.$baseCSSname+"Empty");}if(this.oCaption.nodeType==1){this.oCaption.innerHTML=String(g||"").trim();}else{this.oCaption.nodeValue=String(g||"").trim();}};this.$propHandlers.hotkey=function(i){if(this.$hotkey){apf.setNodeValue(this.$hotkey,i);}if(this.$lastHotkey){apf.removeHotkey(this.$lastHotkey);}if(i){this.$lastHotkey=i;var g=this;apf.registerHotkey(i,function(){g.$setState("Over",{});$setTimeout(function(){g.$setState("Out",{});},200);if(g.$clickHandler&&g.$clickHandler()){g.$updateState(e||event,"click");}else{g.dispatchEvent("click");}});}};function a(k){return;var g=k.keyCode;var i,j=apf.getChildNumber(this);if(g==37){i=j==0?this.parentNode.childNodes.length-1:j-1;this.parentNode.childNodes[i].dispatchEvent("mouseover");}else{if(g==39){i=(j>=this.parentNode.childNodes.length-1)?0:j+1;this.parentNode.childNodes[i].dispatchEvent("mouseover");}}}function d(g){var i=self[this.submenu];this.value=!this.value;if(this.value){this.$setState("Down",{});}if(!i){throw new Error(apf.formatErrorString(0,this,"Showing submenu","Could not find submenu '"+this.submenu+"'"));}if(!this.value){i.hide();this.$setState("Over",{},"toolbarover");this.parentNode.menuIsPressed=false;if(this.parentNode.hasMoved){this.value=false;}if(apf.hasFocusBug){apf.window.$focusfix();}return false;}this.parentNode.menuIsPressed=this;i.display(null,null,false,this,null,null,this.$ext.offsetWidth-2);this.parentNode.hasMoved=false;g.htmlEvent.cancelBubble=true;return false;}function c(){var i=this.parentNode.menuIsPressed;if(!i||i==this){return;}i.setValue(false);var g=self[i.submenu];g.$propHandlers.visible.call(g,false,true);this.setValue(true);this.parentNode.menuIsPressed=this;var j=self[this.submenu];if(!j){throw new Error(apf.formatErrorString(0,this,"Showing submenu","Could not find submenu '"+this.submenu+"'"));}var k=apf.getAbsolutePosition(this.$ext,j.$ext.offsetParent);j.display(k[0],k[1]+this.$ext.offsetHeight,true,this,null,null,this.$ext.offsetWidth-2);this.$focus();this.parentNode.hasMoved=true;return false;}this.$propHandlers.submenu=function(g){if(!g){if(this.value&&this.parentNode){d.call(this);}this.$focussable=true;this.$setNormalBehaviour();this.removeEventListener("mousedown",d);this.removeEventListener("mouseover",c);this.removeEventListener("keydown",a,true);return;}this.$focussable=false;this.$setStateBehaviour();this.addEventListener("mousedown",d);this.addEventListener("mouseover",c);this.addEventListener("keydown",a,true);};this.setValue=function(g){this.setProperty("value",g,false,true);};this.setCaption=function(g){this.setProperty("caption",g,false,true);};this.setIcon=function(g){this.setProperty("icon",g,false,true);};this.$setStateBehaviour=function(g){this.value=g||false;this.isBoolean=true;this.$setStyleClass(this.$ext,this.$baseCSSname+"Bool");if(this.value){this.$setStyleClass(this.$ext,this.$baseCSSname+"Down");this.$doBgSwitch(this.states.Down);}};this.$setNormalBehaviour=function(){this.value=null;this.isBoolean=false;this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Bool"]);};this.$setState=function(i,k,j){if(j&&this.dispatchEvent(j,{htmlEvent:k})===false){return;}this.$doBgSwitch(this.states[i]);var g=this.$baseCSSname;this.$setStyleClass(this.$ext,(i!="Out"?g+i:""),[(this.value?"":g+"Down"),g+"Over"]);if(this.submenu){g=this.$baseCSSname+"menu";this.$setStyleClass(this.$ext,(i!="Out"?g+i:""),[(this.value?"":g+"Down"),g+"Over"]);}};this.$clickHandler=function(){if(this.isBoolean&&!this.submenu){this.setProperty("value",!this.value);return true;}};this.$submenu=function(g,i){if(g){this.setValue(false);this.$setState("Out",{},"mouseout");this.parentNode.menuIsPressed=false;}};this.$draw=function(){var i,g=(i=this.parentNode).localName=="toolbar"||i.parentNode&&i.parentNode.localName=="toolbar";if(g){if(typeof this.focussable=="undefined"){this.focussable=false;}this.$focussable=apf.KEYBOARD;}this.$ext=this.$getExternal();this.oIcon=this.$getLayoutNode("main","icon",this.$ext);this.oCaption=this.$getLayoutNode("main","caption",this.$ext);this.$useExtraDiv=apf.isTrue(this.$getOption("main","extradiv"));if(!apf.button.$extradiv&&this.$useExtraDiv){(apf.button.$extradiv=document.createElement("div")).className="extradiv";}if(this.localName=="submit"){this.action="submit";}else{if(this.localName=="reset"){this.action="reset";}}this.$setupEvents();};}).call(apf.button.prototype=new apf.BaseButton());apf.submit.prototype=apf.trigger.prototype=apf.reset.prototype=apf.button.prototype;apf.aml.setElement("submit",apf.submit);apf.aml.setElement("trigger",apf.trigger);apf.aml.setElement("reset",apf.reset);apf.aml.setElement("button",apf.button);apf.smartbinding=function(c,a){this.$init(a||"smartbinding",apf.NODE_HIDDEN,c);this.$bindNodes={};};(function(){this.$supportedProperties=["bindings","actions","model"];this.$handlePropSet=function(i,d,c){switch(i){case"model":if(typeof d=="string"){d=apf.nameserver.get("model",d);}this.model=apf.nameserver.register("model",this.name,d);var a;for(var g in this.$bindNodes){a=this.$bindNodes[g];this.model.unregister(a);this.model.register(a,this.$modelXpath[a.getHost?a.getHost().$uniqueId:a.$uniqueId]||this.modelBaseXpath);}break;case"bindings":if(this.$bindings){this.remove(this.$bindings);}this.$bindings=typeof d=="object"?d:apf.nameserver.lookup("bindings",d);this.add(this.$bindings);break;case"actions":if(this.$actions){this.remove(this.$actions);}this.$actions=typeof d=="object"?d:apf.nameserver.lookup("actions",d);this.add(this.$actions);break;}this[i]=d;};this.add=function(c){for(var a in this.$bindNodes){c.register(this.$bindNodes[a]);}this["$"+c.localName]=c;};this.remove=function(c){for(var a in this.$bindNodes){c.unregister(this.$bindNodes[a]);}};this.register=function(a){this.$bindNodes[a.$uniqueId]=a;if(this.$bindings){this.$bindings.register(a);}if(this.$actions){this.$actions.register(a);}if(this.$model){this.$model.register(a);}};this.unregister=function(a){this.$bindNodes[a.$uniqueId]=null;delete this.$bindNodes[a.$uniqueId];if(this.$bindings){this.$bindings.unregister(a);}if(this.$actions){this.$actions.unregister(a);}if(this.$model){this.$model.unregister(a);}};this.load=function(a){new apf.model().register(this).load(a);};this.clear=function(a){};this.addEventListener("DOMNodeInsertedIntoDocument",function(a){if(this.parentNode.hasFeature(apf.__DATABINDING__)){this.register(this.parentNode);}apf.console.info(this.name?"Creating SmartBinding ["+this.name+"]":"Creating implicitly assigned SmartBinding");});}).call(apf.smartbinding.prototype=new apf.AmlElement());apf.aml.setElement("smartbinding",apf.smartbinding);var HAS_CHILD=1<<1,IS_CLOSED=1<<2,IS_LAST=1<<3,IS_ROOT=1<<4;apf.markupedit=function(c,a){this.$init(a||"markupedit",apf.NODE_VISIBLE,c);};(function(){this.implement(apf.DataAction,apf.Rename,apf.Cache);this.$isTreeArch=true;this.$focussable=true;this.$preventRecursiveUpdate=true;this.$enableTextNodeHack=true;this.startcollapsed=true;this.$animType=0;this.$animSteps=3;this.$animSpeed=20;this.reselectable=true;this.prerender=false;this.each="node()[local-name(.) and not(@nomk = 'true')]";this.$dynCssClasses=[];this.expandAndSelect=function(u){var t=this;(function s(A){var w=t.getTraverseParent(A);if(w!=t.xmlRoot){s(w);}t.slideToggle(apf.xmldb.getHtmlNode(w,t),1,true);})(u);this.select(u);};this.setAttributeValue=function(t,s,u){if(!t){t=this.caret||this.selected;}if(!t||t.getAttribute(s)==u){return;}this.$executeAction("setAttribute",[t,s,u],"setAttributeValue",t);};this.removeAttribute=function(t,s,u){if(!t){t=this.caret||this.selected;}if(!t||t.getAttribute(s)==u){return;}this.$executeAction("removeAttribute",[t,s],"removeAttribute",t);};this.renameAttribute=function(u,t,s){if(!u){u=this.caret||this.selected;}if(!u||t==s){return;}this.$executeAction("multicall",[{func:"removeAttribute",args:[u,t]},{func:"setAttribute",args:[u,s,u.getAttribute(t)]}],"renameAttribute",u);};this.setTextNode=function(s,t){if(!s){s=this.caret||this.selected;}if(!s||apf.queryValue(s,"text()")==t){return;}this.$executeAction("setTextNode",[s,t],"setTextNode",s);};this.slideToggle=function(A,w,t){if(this.nocollapse){return;}if(!A){A=this.$selected;}var B=A.getAttribute(apf.xmldb.htmlIdTag);while(!B&&A.parentNode){var B=(A=A.parentNode).getAttribute(apf.xmldb.htmlIdTag);}var u,s=this.$getLayoutNode("item","container",A);if(apf.getStyle(s,"display")=="block"){if(w==1){return;}u=this.$getLayoutNode("item","openclose",A);u.className=u.className.replace(/min/,"plus");A.className=A.className.replace(/min/,"plus");this.slideClose(s,apf.xmldb.getNode(A),t);}else{if(w==2){return;}u=this.$getLayoutNode("item","openclose",A);u.className=u.className.replace(/plus/,"min");A.className=A.className.replace(/plus/,"min");this.slideOpen(s,apf.xmldb.getNode(A),t);}};this.isCollapsed=function(s){return(apf.getStyle(this.$getLayoutNode("item","container",apf.xmldb.getHtmlNode(s,this)),"display")=="none");};var d={};this.slideOpen=function(t,A,u){if(!A){A=this.selected;}var B=apf.xmldb.findHtmlNode(A,this);if(!t){t=this.$findContainer(B);}if(!t.innerHTML&&!this.getTraverseNodes(A).length){return;}if(this.singleopen){var w=this.getTraverseParent(A),C=(w||this.xmlRoot).getAttribute(apf.xmldb.xmlIdTag);if(d[C]&&d[C][1]!=A&&this.getTraverseParent(d[C][1])==w){this.slideToggle(d[C][0],2);}d[C]=[B,A];}t.style.display="block";if(!this.prerender&&this.$hasLoadStatus(A,"potential")){this.$extend(A,t,u);return;}if(u){t.style.height="auto";return;}var s=this;apf.tween.single(t,{type:"scrollheight",from:0,to:t.scrollHeight,anim:this.$animType,steps:this.$animOpenStep,interval:this.$animSpeed,onfinish:function(D){if(A&&s.$hasLoadStatus(A,"potential")){$setTimeout(function(){s.$extend(A,D);});D.style.height="auto";}else{D.style.height="auto";}}});};this.slideClose=function(s,t){if(this.nocollapse){return;}if(!t){t=this.selected;}if(this.singleopen){var u=(this.getTraverseParent(t)||this.xmlRoot).getAttribute(apf.xmldb.xmlIdTag);d[u]=null;}s.style.height=s.offsetHeight;s.style.overflow="hidden";apf.tween.single(s,{type:"scrollheight",from:s.scrollHeight,to:0,anim:this.$animType,steps:this.$animCloseStep,interval:this.$animSpeed,onfinish:function(w,A){w.style.display="none";}});};this.doUpdate=function(u,t){var B=this.$getBindRule("insert",u);var A=B&&B[1]?B[1](u):null;if(B&&A){this.$setLoadStatus(u,"loading");if(B.getAttribute("get")){this.getModel().$insertFrom(B.getAttribute("get"),{xmlNode:A,insertPoint:A,amlNode:this});}else{var w=this.$applyBindRule("Insert",u);if(w){this.insert(w,{insertPoint:A});}}}else{if(!this.prerender){this.$setLoadStatus(u,"loading");var s=this.$addNodes(u,t,true);c.call(this,"insert",u,s);}}};var j={};j[0]="";j[HAS_CHILD]="min";j[HAS_CHILD|IS_CLOSED]="plus";j[IS_LAST]="last";j[IS_LAST|HAS_CHILD]="minlast";j[IS_LAST|HAS_CHILD|IS_CLOSED]="pluslast";j[IS_ROOT]="root";this.fixItem=function(G,E,D,F,w){if(!E){return;}if(D){var A;if(A=this.getNextTraverse(G,true)){this.fixItem(A,this.$findHtmlNode(A.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId),null,true);}if(!this.emptyMessage&&G.parentNode.selectNodes(this.each).length==1){this.fixItem(G.parentNode,this.$findHtmlNode(G.parentNode.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId),null,false,true);}}else{var C,t=this.$getLayoutNode("item","container",E);if(w){C=false;}else{if(G.selectNodes(this.each).length>0){C=true;}else{if(this.$getBindRule("insert",G)){C=true;}else{C=false;}}}var u=C&&t.style.display!="block";var B=this.getNextTraverse(G,null,F?2:1)?false:true;var s=(C?HAS_CHILD:0)|(u?IS_CLOSED:0)|(B?IS_LAST:0);this.$setStyleClass(this.$getLayoutNode("item","openclose",E),j[s],["min","plus","last","minlast","pluslast"]);this.$setStyleClass(this.$getLayoutNode("item",null,E),j[s],["min","plus","last","minlast","pluslast"]);if(!C){t.style.display="none";}if(s&HAS_CHILD){}}};this.startRenameThis=function(B,t,A,C){if(this.renaming){this.stopRename(null,true);var s=this;return setTimeout(function(){s.startRenameThis(B,t,A);});}this.$getCaptionElement=function(){return B;};var w=B.getAttribute("aname");var u=C?a[C]:apf.xmldb.getNodeById(t);if(!u){throw new Error();}this.$multiLineRename=C&&u.nodeType!=3?true:false;this.$getCaptionXml=function(){return u.nodeType!=1?u:(w?u.getAttributeNode(w):u.firstChild);};this.getSelectFromRule=function(D,E){return[null,u.nodeType!=1?u:(w?u.getAttributeNode(w):u.firstChild)];};this.$validateRename=function(D){return !A||!D||D.match(/^[a-z]/i);};this.rename=function(D,E){this.$noanim=true;if(w){if(A){if(E==""){this.removeAttribute(u,w);}else{this.renameAttribute(u,w,E);}}else{this.setAttributeValue(u,w,E);}}else{this.setTextNode(u,E);}this.$noanim=false;};this.startRename();if(A){this.$txt[apf.hasContentEditable?"innerHTML":"value"]=w;this.$txt.className="";}else{this.$txt.className="attrvalue";}apf.selectTextHtml(this.$txt);};function q(u,t,B,A,s){this.$getNewContext("attribute");var C=this.$getLayoutNode("attribute","name");var w=this.$getLayoutNode("attribute","value");apf.setNodeValue(C,t);apf.setNodeValue(w,(B.length>50?"...":B));if(B.length>50){w.setAttribute("title",B);}C.setAttribute("aname",t);C.setAttribute("onmousedown","apf.lookup("+this.$uniqueId+").startRenameThis(this, '"+s+"', true);            event.cancelBubble=true;");C.setAttribute("onmouseup","            event.cancelBubble=true;            return false;");C.setAttribute("onkeydown","if (event.keyCode==13) {              this.blur();              return false;            };            event.cancelBubble=true;");C.setAttribute("onselectstart","event.cancelBubble = true;");C.setAttribute("ondblclick","event.cancelBubble = true;");w.setAttribute("aname",t);w.setAttribute("onmousedown","apf.lookup("+this.$uniqueId+").startRenameThis(this, '"+s+"');            event.cancelBubble=true;");w.setAttribute("onmouseup","            event.cancelBubble=true;            return false;");w.setAttribute("onkeydown","if (event.keyCode==13) {              this.blur();              return false;            };            event.cancelBubble=true;");w.setAttribute("onselectstart","event.cancelBubble = true;");w.setAttribute("ondblclick","event.cancelBubble = true;");if(u.style){this.$setStyleClass(this.$getLayoutNode("attribute"),"generated");A=apf.insertHtmlNode(this.$getLayoutNode("attribute"),u,this.$getLayoutNode("item","begintag",A).nextSibling);if(!this.$noanim){i(A);i(this.$getLayoutNode("attribute","name",A));i(this.$getLayoutNode("attribute","value",A));}}else{u.appendChild(this.$getLayoutNode("attribute"));}}function k(u,A,t){this.$getNewContext("textnode");var B=this.$getLayoutNode("textnode","text");var s=this.$getLayoutNode("textnode","tag");apf.setNodeValue(B,(A.length>50?"...":A));if(A.length>50){B.setAttribute("title",A);}B.setAttribute("onmousedown","apf.lookup("+this.$uniqueId+").startRenameThis(this, '"+t+"');");B.setAttribute("onmouseup","            event.cancelBubble=true;            return false;");B.setAttribute("onkeydown","if (event.keyCode==13) {              this.blur();              return false;            };            event.cancelBubble=true;");B.setAttribute("onselectstart","event.cancelBubble = true;");B.setAttribute("ondblclick","event.cancelBubble = true;");apf.setNodeValue(s,"&gt;");if(u.style){var w=apf.insertHtmlNode(this.$getLayoutNode("textnode"),u,u.lastChild);if(!this.$noanim){i(this.$getLayoutNode("textnode","text",w));}}else{u.appendChild(this.$getLayoutNode("textnode"));}}this.$initNode=function(G,s,F){this.$getNewContext("item");var C=(s&HAS_CHILD||this.emptyMessage&&this.$applyBindRule("empty",G));var I=this.$getLayoutNode("item");I.setAttribute(apf.xmldb.htmlIdTag,F);this.$setStyleClass(this.$getLayoutNode("item","openclose"),j[s]);this.$setStyleClass(this.$getLayoutNode("item"),j[s]);var u=this.$getLayoutNode("item","openclose");if(C){u.setAttribute(this.opencloseaction||"onmousedown","var o = apf.lookup("+this.$uniqueId+");                o.slideToggle(this);                apf.cancelBubble(event,o);");}var w=this.$getLayoutNode("item","select");if(C){var H="var o = apf.lookup("+this.$uniqueId+");                o.slideToggle(this, true);";}w.setAttribute("onmousedown","var o = apf.lookup("+this.$uniqueId+");            apf.cancelBubble(event, o);            if (o.hasFocus())                 o.select(this);"+(H&&this.opencloseaction=="onmousedown"?H:""));var L=this.$getLayoutNode("item","begintag");apf.setNodeValue(L,"&lt;"+G.tagName);var t=this.$getLayoutNode("item","attributes");var D=G.attributes.length;if(typeof D=="function"){D=G.attributes.length();}for(var B=0;B<D;B++){var E=G.attributes.item(B);if(E.nodeName.match(/a_id|a_listen|a_doc|a_loaded/)){continue;}q.call(this,t,E.nodeName,E.nodeValue,null,F);}var J=this.$getLayoutNode("item","begintail");var A=this.$getLayoutNode("item","endtag");if(!(s&HAS_CHILD)){A.setAttribute("style","display:none");if(this.$enableTextNodeHack&&(G.childNodes.length>1||G.childNodes.length==1&&G.firstChild.nodeValue.trim())){k.call(this,t,G.childNodes[0].nodeValue,F);apf.setNodeValue(J,"&lt;/"+G.tagName+"&gt;");}else{apf.setNodeValue(J," /&gt;");}}else{apf.setNodeValue(A,"&lt;/"+G.tagName+"&gt;");apf.setNodeValue(J,"&gt;");}J.parentNode.appendChild(J);A.setAttribute("onmousedown","var o = apf.lookup("+this.$uniqueId+");apf.cancelBubble(event, o);");var K=this.$applyBindRule("css",G);if(K){this.$setStyleClass(this.$getLayoutNode("item",null,this.$getLayoutNode("item")),K);if(K){this.$dynCssClasses.push(K);}}return this.$getLayoutNode("item");};this.$deInitNode=function(t,w){var s=this.$getLayoutNode("item","container",w);var u=w.parentNode;s.parentNode.removeChild(s);u.removeChild(w);if(t.parentNode!=this.xmlRoot){this.fixItem(t,w,true);}if(this.emptyMessage&&!u.childNodes.length){this.setEmpty(u);}this.fixItem(t,w,true);if(t==this.selected){this.clearSelection();}};function i(s){if(!s.offsetHeight){return;}apf.setStyleClass(s,"highlight");$setTimeout(function(){apf.setStyleClass(s,"",["highlight"]);},1000);}this.$updateNode=function(s,w){var K,J,C={};var M=this.$getLayoutNode("item","attributes",w);var L=this.$getLayoutNode("item","endtag",w);var N=this.$getLayoutNode("item","begintail",w);K=s.attributes.length;for(var J=0;J<K;J++){var G=s.attributes.item(J);if(G.nodeName.match(/a_id|a_listen|a_doc|a_loaded/)){continue;}C[G.nodeName]=G.nodeValue;}var E=false;var u=[];var F=[],I=M.childNodes;for(J=0;J<I.length;J++){F.push(I[J]);}for(J=0;J<F.length;J++){if(F[J].nodeType!=1){continue;}if(F[J].className.indexOf("textnode")>-1){if(s.childNodes.length==1&&s.childNodes[0].nodeType==3){var H=this.$getLayoutNode("textnode","text",F[J]);if(s.firstChild.nodeValue!=H.innerHTML){H.innerHTML=s.firstChild.nodeValue;i(H);}}else{F[J].parentNode.removeChild(F[J]);apf.setNodeValue(N," /&gt;");}E=true;}if(F[J].className.indexOf("attribute")==-1){continue;}var t=this.$getLayoutNode("attribute","name",F[J]);var D=this.$getLayoutNode("attribute","value",F[J]);var O=t.innerHTML;if(!O in C){u.push(F[J]);}else{if(C[O]!=D.innerHTML){D.innerHTML=C[O];i(D);delete C[O];}else{if(O in C){delete C[O];}}}t.setAttribute("aname",O);D.setAttribute("aname",O);}for(var G in C){if(u.length){var B=u.pop();var t=this.$getLayoutNode("attribute","name",B);var D=this.$getLayoutNode("attribute","value",B);t.setAttribute("aname",G);D.setAttribute("aname",G);t.innerHTML=G;D.innerHTML=C[G];i(t);}else{q.call(this,M,G,C[G],w,s.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId);}}for(var J=0;J<u.length;J++){u[J].parentNode.removeChild(u[J]);}if(this.$enableTextNodeHack&&!E&&s.childNodes.length==1&&s.childNodes[0].nodeType==3){k.call(this,M,s.childNodes[0].nodeValue);apf.setNodeValue(N,"</"+s.tagName+">");}var A=this.$applyBindRule("css",s);if(A||this.$dynCssClasses.length){this.$setStyleClass(w,A,this.$dynCssClasses);if(A&&!this.$dynCssClasses.contains(A)){this.$dynCssClasses.push(A);}}};this.clearEmpty=function(s){s.innerHTML="";};this.setEmpty=function(s){this.$getNewContext("empty");var t=this.$getLayoutNode("empty");this.$getLayoutNode("empty","caption").nodeValue=this.emptyMessage;apf.insertHtmlNode(t,s);if(!this.startcollapsed){if(s.style){}}};this.$setLoading=function(t,s){this.$getNewContext("loading");this.$setLoadStatus(t,"potential");apf.insertHtmlNode(this.$getLayoutNode("loading"),s);};this.$removeLoading=function(s){if(!s){return;}this.$getLayoutNode("item","container",s).innerHTML="";};this.$extend=function(u,s,t){var A=this.$getBindRule("insert",u),w=A&&A.match?(A.cmatch||A.compile("match"))(u):u;if(A&&w){this.$setLoadStatus(u,"loading");if(A.get){this.getModel().$insertFrom(A.getAttribute("get"),{xmlNode:w,insertPoint:w,amlNode:this});}else{if(this.$applyBindRule("insert",u)){this.insert(data,{insertPoint:w});}}}else{if(!this.prerender){this.$setLoadStatus(u,"loading");this.$removeLoading(apf.xmldb.findHtmlNode(u,this));this.$noanim=true;c.call(this,{action:"insert",xmlNode:u,result:this.$addNodes(u,s,true),anim:!t});delete this.$noanim;}}};function c(u){if(u.action=="move-away"){this.fixItem(u.xmlNode,apf.xmldb.findHtmlNode(u.xmlNode,this),true);}if(u.action!="insert"){return;}var t=this.$findHtmlNode(u.xmlNode.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId);if(!t){return;}if(this.$hasLoadStatus(u.xmlNode,"loading")&&u.result.length>0){var s=this.$getLayoutNode("item","container",t);this.slideOpen(s,u.xmlNode);}else{this.fixItem(u.xmlNode,t);}if(this.$hasLoadStatus(u.xmlNode,"loading")){this.$setLoadStatus(u.xmlNode,"loaded");}}this.addEventListener("xmlupdate",c);this.addEventListener("beforeload",function(s){this.$enableTextNodeHack=!s.xmlNode.$regbase;this.each=s.xmlNode.$regbase?"node()[not(@nomk = 'true')]":"node()[local-name(.) and not(@nomk = 'true')]";});this.addEventListener("keydown",function(D){var I=D.keyCode;var u=D.ctrlKey;var F=D.shiftKey;var E=this.$caret||this.$selected;if(!E||this.renaming){return;}var G=this.caret||this.selected;var w=this.$ext;switch(I){case 13:if(this.$tempsel){this.$selectTemp();}if(this.ctrlselect=="enter"){this.select(this.caret,true);}this.choose(E);break;case 32:if(u){this.select(this.caret,true);}break;case 46:if(this.$tempsel){this.$selectTemp();}this.remove(this.mode?this.caret:null);break;case 109:case 37:if(this.$tempsel){this.$selectTemp();}if(this.caret.selectSingleNode(this.each)){this.slideToggle(this.$caret||this.$selected,2);}break;case 107:case 39:if(this.$tempsel){this.$selectTemp();}if(this.caret.selectSingleNode(this.each)){this.slideToggle(this.$caret||this.$selected,1);}break;case 187:if(F){arguments.callee(39);}break;case 189:if(!F){arguments.callee(37);}break;case 38:if(!G&&!this.$tempsel){return;}var A=this.$tempsel?apf.xmldb.getNode(this.$tempsel):G;var C=this.getNextTraverse(A,true);if(C){var t=this.getTraverseNodes(C);do{var s=this.$getLayoutNode("item","container",this.$findHtmlNode(apf.xmldb.getID(C,this)));if(s&&apf.getStyle(s,"display")=="block"&&t.length){C=t[t.length-1];}else{break;}}while(C&&(t=this.getTraverseNodes(C)).length);}else{if(this.getTraverseParent(A)==this.xmlRoot){this.dispatchEvent("selecttop");return;}else{C=this.getTraverseParent(A);}}if(C&&C.nodeType==1){this.$setTempSelected(C,u,F);}if(this.$tempsel&&this.$tempsel.offsetTop<w.scrollTop){w.scrollTop=this.$tempsel.offsetTop;}return false;break;case 40:if(!G&&!this.$tempsel){return;}var A=this.$tempsel?apf.xmldb.getNode(this.$tempsel):G;var C=this.getFirstTraverseNode(A);if(C){var s=this.$getLayoutNode("item","container",this.$findHtmlNode(apf.xmldb.getID(A,this)));if(s&&apf.getStyle(s,"display")!="block"){C=null;}}while(!C){var H=this.getTraverseParent(A);if(!H){break;}var B=0;var t=this.getTraverseNodes(H);while(t[B]&&t[B]!=A){B++;}C=t[B+1];A=H;}if(C&&C.nodeType==1){this.$setTempSelected(C,u,F);}if(this.$tempsel&&this.$tempsel.offsetTop+this.$tempsel.offsetHeight>w.scrollTop+w.offsetHeight){w.scrollTop=this.$tempsel.offsetTop-w.offsetHeight+this.$tempsel.offsetHeight+10;}return false;break;case 33:break;case 34:break;case 36:break;case 35:break;}},true);var g=[];this.$add=function(L,E,G,M,H,C){var F=this.$getBindRule("insert",L)?true:false,K=this.getTraverseNodes(L),B=K.length?true:false,D=F||B,w=this.$hasBindRule("collapsed")?(this.$getDataNode("collapsed",L)?true:false):(this.$hasBindRule("expanded")?(this.$getDataNode("expanded",L)?false:true):this.startcollapsed),u=(D?HAS_CHILD:0)|(w&&D||F?IS_CLOSED:0)|(C?IS_LAST:0),J=this.$initNode(L,u,E),t=this.$getLayoutNode("item","container"),A;if(!w&&!this.nocollapse){t.setAttribute("style","overflow:visible;height:auto;display:block;");}if(!D||F){t.setAttribute("style","display:none;");}if(!this.prerender){A=K.length;}if(D&&!this.prerender&&A>0&&w||F&&(!this.$hasLoadStatus(L)||this.$hasLoadStatus(L,"potential"))){this.$setLoading(L,t);}else{if(!B&&(msg=this.$applyBindRule("empty",L))){this.setEmpty(t);}}if(!M&&(G==this.xmlRoot||L==this.xmlRoot)){g.push(J);if(!apf.isChildOf(J,t,true)){g.push(t);}this.$setStyleClass(J,"root");this.$setStyleClass(t,"root");}else{if(!M){M=apf.xmldb.findHtmlNode(L.parentNode,this);M=M?this.$getLayoutNode("item","container",M):this.$container;}if(M==this.$container){this.$setStyleClass(J,"root");this.$setStyleClass(t,"root");if(this.renderRoot){var I=apf.xmldb.findHtmlNode(this.xmlRoot,this);M=this.$getLayoutNode("item","container",I);}}if(!H&&this.getNextTraverse(L)){H=apf.xmldb.findHtmlNode(this.getNextTraverse(L),this);}if(H&&H.parentNode!=M){H=null;}if(M.style&&this.getTraverseNodes(L.parentNode).length==1){this.clearEmpty(M);}if(M.style){var s=apf.insertHtmlNode(J,M,H);if(!this.$noanim){i(this.$getLayoutNode("item","select",s));}if(!apf.isChildOf(J,t,true)){var t=apf.insertHtmlNode(t,M,H);}}else{M.insertBefore(J,H);if(!apf.isChildOf(M,t,true)){M.insertBefore(t,H);}}if(M.style){if(!w&&this.openOnAdd&&M!=this.$container&&M.style.display!="block"){this.slideOpen(M,G);}this.fixItem(G,apf.xmldb.findHtmlNode(G,this));if(this.getNextTraverse(L,true)){this.fixItem(this.getNextTraverse(L,true),apf.xmldb.findHtmlNode(this.getNextTraverse(L,true),this));}}}if(this.prerender||A<1||!w){this.$addNodes(L,t,false);}return t;};this.$fill=function(){var s;apf.insertHtmlNodes(g,s||this.$container);g.length=0;};var n={};n[3]="textnode";n[4]="cdata";n[7]="procinstr";n[8]="comment";var a=[null];this.$addNonElement=function(G,H,u,B,w){if(!G.$regbase){return;}if(u){E=false;}if(E){return;}if(G.nodeType==3){this.$getNewContext("textnode");var t=this.$getLayoutNode("textnode");var s=this.$getLayoutNode("textnode","text");}else{this.$getNewContext("anynode");var t=this.$getLayoutNode("anynode");var A=this.$getLayoutNode("anynode","tagstart");var C=this.$getLayoutNode("anynode","tagend");switch(G.nodeType){case 4:apf.setNodeValue(A,"&lt;![CDATA[");apf.setNodeValue(C,"]]&gt;");break;case 7:apf.setNodeValue(A,"&lt;?"+G.target);apf.setNodeValue(C,"?&gt;");break;case 8:apf.setNodeValue(A,"&lt;!--");apf.setNodeValue(C,"--&gt;");break;default:return;}this.$getLayoutNode("anynode","openclose").setAttribute("onmousedown","var o = this.parentNode;                 apf.setStyleClass(o, o.className.indexOf('open') > -1 ? '' : 'open', ['open']);");var s=this.$getLayoutNode("anynode","text");}var F=G.nodeValue;if(F.trim().indexOf("\n")>-1){F=(G.nodeValue=apf.removeStartWhitespaces(F.replace(/^ *\n/,"").replace(/\n *$/,""))).replace(/</g,"&lt;").replace(/\n/g,"<br />");}else{F=F.trim().replace(/</g,"&lt;");}apf.setNodeValue(s,F);this.$setStyleClass(t,n[G.nodeType],"");var D=G.parentNode.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId;s.setAttribute("onmousedown","apf.lookup("+this.$uniqueId+").startRenameThis(this, '"+D+"', false, "+(a.push(G)-1)+");");s.setAttribute("onmouseup","            event.cancelBubble=true;            return false;");s.setAttribute("onkeydown","if (event.keyCode==13) {              this.blur();              return false;            };            event.cancelBubble=true;");s.setAttribute("onselectstart","event.cancelBubble = true;");s.setAttribute("ondblclick","event.cancelBubble = true;");if(H.style){var E=apf.insertHtmlNode(t,H);}else{H.appendChild(t);}};this.$getParentNode=function(s){return s?this.$getLayoutNode("item","container",s):this.$container;};this.$calcSelectRange=function(t,s){return[t,s];};this.$findContainer=function(s){return this.$getLayoutNode("item","container",s);};this.multiselect=false;this.$selectDefault=function(u){if(this.select(this.getFirstTraverseNode(u),null,null,null,true)){return true;}else{var s=this.getTraverseNodes(u);for(var t=0;t<s.length;t++){if(this.$selectDefault(s[t])){return true;}}}};this.$select=function(s){if(!s||!s.style){return;}this.$setStyleClass(this.$getLayoutNode("item","class",s),"selected");return s;};this.$deselect=function(s){if(!s){return;}this.$setStyleClass(this.$getLayoutNode("item","class",s),"",["selected","indicate"]);return s;};this.$indicate=function(s){if(!s){return;}this.$setStyleClass(this.$getLayoutNode("item","class",s),"indicate");return s;};this.$deindicate=function(s){if(!s){return;}this.$setStyleClass(this.$getLayoutNode("item","class",s),"",["indicate"]);return s;};this.$draw=function(){this.$ext=this.$getExternal();this.$container=this.$getLayoutNode("main","container",this.$ext);this.opencloseaction=this.$getOption("Main","openclose");this.$ext.onclick=function(t){this.host.dispatchEvent("click",{htmlEvent:t||event});};var s=this;this.$ext.onmouseover=function(t){s.dispatchEvent("mouseover",{htmlEvent:t||event});};this.$ext.onmouseout=function(t){s.dispatchEvent("mouseover",{htmlEvent:t||event});};};this.$loadAml=function(s){this.openOnAdd=!apf.isFalse(s.getAttribute("openonadd"));this.startcollapsed=!apf.isFalse(this.getAttribute("startcollapsed")||this.$getOption("Main","startcollapsed"));this.nocollapse=apf.isTrue(this.getAttribute("nocollapse"));if(this.nocollapse){this.startcollapsed=false;}this.singleopen=apf.isTrue(this.getAttribute("singleopen"));};this.$destroy=function(){if(!this.$ext){apf.console.error("destroy is called more than once for markupedit");return;}this.$ext.onclick=null;apf.destroyHtmlNode(this.oDrag);this.oDrag=null;};}).call(apf.markupedit.prototype=new apf.MultiSelect());apf.aml.setElement("markupedit",apf.markupedit);apf.BindingEachRule=function(d,c){this.$init(c,apf.NODE_HIDDEN,d);var a=this;this.$noderegister=function(g){g.amlNode.$handleBindingRule(a.match,"each");g.amlNode.$sort=a.sort?new apf.Sort(a):null;};};(function(){this.$attrExcludePropBind=apf.extend({sort:1,"data-type":1,"date-format":1,"sort-method":1,order:1,"case-order":1},this.$attrExcludePropBind);this.$propHandlers.sort=this.$propHandlers["data-type"]=this.$propHandlers["date-format"]=this.$propHandlers.order=this.$propHandlers["case-order"]=function(c,d){delete this["c"+d];};this.addEventListener("prop.match",function(j){var g=this.parentNode;if(g.localName=="bindings"){var c=g.$amlNodes;for(var d=0;d<c.length;d++){c[d].$handleBindingRule(this.match,"each");}}else{g.$handleBindingRule(this.match,"each");}});var a;this.addEventListener("DOMNodeInserted",a=function(j){if(j.currentTarget!=this){return;}var g=this.parentNode;if(g.localName=="bindings"){g.addEventListener("noderegister",this.$noderegister);var c=g.$amlNodes;for(var d=0;d<c.length;d++){c[d].$handleBindingRule(this.match,"each");c[d].$sort=this.sort?new apf.Sort(this):null;}}else{g.$handleBindingRule(this.match,"each");g.$sort=this.sort?new apf.Sort(this):null;}});this.addEventListener("DOMNodeRemoved",function(j){if(j.currentTarget!=this){return;}var g=this.parentNode;if(g.localName=="bindings"){g.removeEventListener("noderegister",this.$noderegister);var c=g.$amlNodes;for(var d=0;d<c.length;d++){delete c[d].$sort;}}else{delete g.$sort;}});this.addEventListener("DOMNodeInsertedIntoDocument",a);}).call(apf.BindingEachRule.prototype=new apf.BindingRule());apf.aml.setElement("each",apf.BindingEachRule);apf.text=function(c,a){this.$init(a||"text",apf.NODE_VISIBLE,c);};(function(){this.implement(apf.ChildValue,apf.Cache);this.$focussable=true;this.focussable=false;this.$allowSelect=true;this.$hasStateMessages=true;this.$textTimer=this.$lastMsg=this.$lastClass=this.$changedHeight=null;this.$booleanProperties.scrolldown=true;this.$booleanProperties.secure=true;this.$supportedProperties.push("behavior","scrolldown","secure","value");this.$propHandlers.behavior=function(a){this.addOnly=a=="addonly";};this.$propHandlers.value=function(c){var a=false;if(c){this.$removeClearMessage();}if(typeof c!="string"){c=c?c.toString():"";}if(this.secure){c=c.replace(/<a /gi,"<a target='_blank' ").replace(/<object.*?\/object>/g,"").replace(/<script.*?\/script>/g,"").replace(new RegExp("ondblclick|onclick|onmouseover|onmouseout|onmousedown|onmousemove|onkeypress|onkeydown|onkeyup|onchange|onpropertychange","g"),"ona");}if(this.addOnly){if(a){a.contents+=c;}else{this.$container.insertAdjacentHTML("beforeend",c);}}else{c=c.replace(/\<\?xml version="1\.0" encoding="UTF-16"\?\>/,"");if(a){a.contents=c;}else{this.$container.innerHTML=c;}}if(apf.cannotSizeIframe&&this.oIframe){this.oIframe.style.width=this.oIframe.offsetWidth+"px";}if(this.scrolldown&&this.$scrolldown){this.oScroll.scrollTop=this.oScroll.scrollHeight;}};this.$propHandlers["empty-message"]=function(a){if(!this.childNodes.length){this.$setClearMessage(this["empty-message"]);}};this.setValue=function(a){this.setProperty("value",a,false,true);};this.getValue=function(){return this.$container.innerHTML;};this.addEventListener("keydown",function(c){var a=c.keyCode;switch(a){case 33:this.$container.scrollTop-=this.$container.offsetHeight;break;case 34:this.$container.scrollTop+=this.$container.offsetHeight;break;case 35:this.$container.scrollTop=this.$container.scrollHeight;break;case 36:this.$container.scrollTop=0;break;case 38:this.$container.scrollTop-=10;break;case 40:this.$container.scrollTop+=10;break;default:return;}return false;},true);this.$xmlUpdate=function(i,c,g,d){if(this.addOnly&&i!="add"){return;}if(d){d.xmlNode=this.addOnly?c:this.xmlRoot;}if(this.addOnly){apf.xmldb.nodeConnect(this.documentId,c,null,this);var a=this.$findHtmlNode(g.getAttribute("id")+"|"+this.$uniqueId);this.$propHandlers.value.call(this,this.$applyBindRule("value",c)||"");}else{this.$propHandlers.value.call(this,this.$applyBindRule("value",this.xmlRoot)||"");}};this.$load=function(c){apf.xmldb.addNodeListener(c,this);var d=this.$applyBindRule("value",c);if(d||typeof d=="string"){if(this.caching){var a=this.$findHtmlNode(c.getAttribute("id")+"|"+this.$uniqueId);if(a){a.contents=d;}}this.$propHandlers.value.call(this,d);}else{this.$propHandlers.value.call(this,"");}};this.$getCurrentFragment=function(){return{nodeType:1,contents:this.$container.innerHTML};};this.$setCurrentFragment=function(a){this.$container.innerHTML=a.contents;if(this.scrolldown){this.$container.scrollTop=this.$container.scrollHeight;}};this.$setClearMessage=this.$updateClearMessage=function(c,a){if(this.$lastClass){this.$removeClearMessage();}apf.setStyleClass(this.$ext,(this.$lastClass=this.$baseCSSname+(a||"Empty").uCaseFirst()));if(c){if(!this.height){if(this.$container.offsetHeight&&apf.getStyle(this.$container,"height")=="auto"&&(this.$changedHeight=true)){this.$container.style.height=(this.$container.offsetHeight-apf.getHeightDiff(this.$container))+"px";}this.$container.innerHTML=c;}this.$lastMsg=this.$container.innerHTML;}};this.$removeClearMessage=function(){if(this.$lastClass){apf.setStyleClass(this.$ext,"",[this.$lastClass]);this.$lastClass=null;}if(this.$container.innerHTML==this.$lastMsg){if(this.$changedHeight&&!(this.$changedHeight=false)){this.$container.style.height="";}this.$container.innerHTML="";}};this.caching=false;this.$draw=function(){var a=this;this.$ext=this.$getExternal();this.$container=this.$getLayoutNode("main","container",this.$ext);if(apf.hasCssUpdateScrollbarBug&&!apf.getStyle(this.$container,"padding")){this.$fixScrollBug();}this.oScroll=this.oFocus?this.oFocus.parentNode:this.$container;this.$scrolldown=true;this.oScroll.onscroll=function(){a.$scrolldown=this.scrollTop>=this.scrollHeight-this.offsetHeight+apf.getVerBorders(this);};clearInterval(this.$textTimer);this.$textTimer=setInterval(function(){if(a.oScroll&&a.$scrolldown&&a.scrolldown){a.oScroll.scrollTop=a.oScroll.scrollHeight;}},60);if(this.$container.tagName.toLowerCase()=="iframe"){if(apf.isIE){this.oIframe=this.$container;var d=this.skin.selectSingleNode("iframe_style");this.oIframe.contentWindow.document.write('<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">                    <head>                        <style>'+(d?d.firstChild.nodeValue:"")+"</style>                        <script>                            document.onkeydown = function(e){                                if (!e) e = event;                                if (top.apf.disableF5 && e.keyCode == 116) {                                    e.keyCode = 0;                                    return false;                                }                            }                        <\/script>                    </head>                    <body oncontextmenu='return false'></body>");this.$container=this.oIframe.contentWindow.document.body;}else{var c=document.createElement("div");this.$ext.parentNode.replaceChild(c,this.$ext);c.className=this.$ext.className;this.$ext=this.$container=c;}}else{this.$container.onselectstart=function(g){(g?g:event).cancelBubble=true;};this.$container.oncontextmenu=function(g){if(!this.host.contextmenus){(g?g:event).cancelBubble=true;}};this.$container.style.cursor="";this.$container.onmouseover=function(g){if(!self.STATUSBAR){return;}if(!g){g=event;}if(g.srcElement.tagName.toLowerCase()=="a"){if(!this.lastStatus){this.lastStatus=STATUSBAR.getStatus();}STATUSBAR.status("icoLink.gif",g.srcElement.getAttribute("href"));}else{if(this.lastStatus){STATUSBAR.status(this.lastStatus[0],this.lastStatus[1]);this.lastStatus=false;}}};}};this.addEventListener("DOMNodeRemovedFromDocument",function(){clearInterval(this.$textTimer);apf.destroyHtmlNode(this.oDrag);if(this.oScroll){this.oScroll.onscoll=this.oScroll=null;}this.oDrag=this.oIframe=this.oFocus=null;});}).call(apf.text.prototype=new apf.BaseSimple());apf.aml.setElement("text",apf.text);apf.propedit=function(c,a){this.$init(a||"propedit",apf.NODE_VISIBLE,c);this.$nodes=[];this.$editors={};this.$dynCssClasses=[];};(function(){this.$init(function(){this.addEventListener("keydown",a,true);});this.$focussable=true;this.$isTreeArch=true;this.$isWindowContainer=-1;this.startClosed=true;this.$animType=apf.tween.NORMAL;this.$animSteps=3;this.$animSpeed=20;this.$useiframe=0;this.$attrExcludePropBind=apf.extend({properties:3},this.$attrExcludePropBind);this.$booleanProperties.iframe=true;this.$propHandlers.properties=function(j){if(!j){return this.clear();}var d=this;var i={load:function(k){d.$loadingProps=false;if(typeof k=="string"){k=apf.getXml(k);}d.$properties=k;if(d.xmlRoot){d.load(d.xmlRoot);}},clear:function(){d.$loadingProps=false;},xmlRoot:this.xmlRoot};var g;this.$loadingProps=true;if(typeof j=="string"){if(j.substr(0,1)=="<"){i.load(j);}else{apf.setModel(j,i);}}else{if(j.$isModel){j.register(i);}else{if(this.$properties==j){return;}setTimeout(function(){i.load(j);});}}delete this.$properties;};this.$canLoadData=function(){return this.$headings?true:false;};this.$columns=["50%","50%"];this.$propHandlers.columns=function(d){this.$columns=d&&d.splitSafe(",")||["50%","50%"];if(this.$headings){this.$headings[0].setProperty("width",this.$columns[0]);this.$headings[1].setProperty("width",this.$columns[1]);}};function c(){var d=(this.current||this.$selected),g=this.$body;g.scrollTop=(d.offsetTop)-21;}this.$findHtmlNode=function(d){return this.$pHtmlDoc.getElementById(d);};function a(B){var G=B.keyCode,i=B.ctrlKey,s=B.shiftKey;var d=this.$lastEditor&&this.$lastEditor[2],E=this.$useiframe?this.oDoc.documentElement:this.$body,q,w,k,F,D,t,g;switch(G){case 36:return false;case 35:return false;case 107:break;case 37:this.$slideToggle(this.$selected.firstChild);return false;case 107:case 39:this.$slideToggle(this.$selected.firstChild);return false;case 38:var w=d;var C=d.previousSibling;while(C&&C.nodeType!=1){C=C.previousSibling;}if(C){var j=C,u;while((u=j.selectNodes("prop")).length){j=u[u.length-1];}C=j;}else{C=w.parentNode;if(C[apf.TAGNAME]!="prop"){C=C.previousSibling;while(C&&C.nodeType!=1){C=C.previousSibling;}if(C&&C[apf.TAGNAME]!="prop"){C=(u=C.selectNodes("prop"))[u.length-1];while(C&&C.nodeType!=1){C=C.previousSibling;}}}}if(!C){return;}var A=apf.xmldb.findHtmlNode(C,this);while(!A.offsetWidth){A=apf.xmldb.findHtmlNode(C=C.parentNode,this);}var n=apf.getAbsolutePosition(A,this.$body)[1]-(A.offsetHeight/2);if(n<=this.$ext.scrollTop){this.$ext.scrollTop=n;}this.select(A);return false;case 40:var w,C=(w=d).selectSingleNode("prop")||w.nextSibling;do{while(C&&(C.nodeType!=1||C[apf.TAGNAME]!="prop")){C=C.nextSibling;}if(!C){C=w.parentNode.nextSibling;if(C&&C[apf.TAGNAME]!="prop"){C=C.selectSingleNode("prop");}}}while(C&&C.nodeType!=1);if(!C){return;}var A=apf.xmldb.findHtmlNode(C,this);while(!A.offsetWidth){A=apf.xmldb.findHtmlNode(C=C.parentNode,this);}if(C==w){C=w.nextSibling;while(C&&(C.nodeType!=1||C[apf.TAGNAME]!="prop")){C=C.nextSibling;}var A=apf.xmldb.findHtmlNode(C,this);}var n=apf.getAbsolutePosition(A,this.$body)[1]+(A.offsetHeight/2);if(n>this.$ext.scrollTop+this.$ext.offsetHeight){this.$ext.scrollTop=n-this.$ext.offsetHeight;}this.select(A);return false;}}this.$focus=function(){if(!this.$ext||(apf.isIE&&this.$useiframe&&this.cssfix)){return;}this.$setStyleClass(this.oFocus||this.$ext,this.$baseCSSname+"Focus");if(this.oDoc){this.$setStyleClass(this.oDoc.documentElement,this.$baseCSSname+"Focus");}};this.$blur=function(){if(this.renaming){this.stopRename(null,true);}if(!this.$ext||(apf.isIE&&this.$useiframe&&this.cssfix)){return;}this.$setStyleClass(this.oFocus||this.$ext,"",[this.$baseCSSname+"Focus"]);if(this.oDoc){this.$setStyleClass(this.oDoc.documentElement,"",[this.$baseCSSname+"Focus"]);}};this.$slideToggle=function(d){container=d.parentNode.lastChild;if(apf.getStyle(container,"display")=="block"){d.className=d.className.replace(/min/,"plus");this.$slideClose(container);}else{d.className=d.className.replace(/plus/,"min");this.$slideOpen(container);}};this.$slideOpen=function(d){d.style.display="";apf.tween.single(d,{type:"scrollheight",from:3,diff:-2,to:d.scrollHeight,anim:this.$animType,steps:this.$animSteps,interval:this.$animSpeed,onfinish:function(g){g.style.overflow="visible";g.style.height="auto";}});};this.$slideClose=function(d){d.style.height=d.offsetHeight;d.style.overflow="hidden";apf.tween.single(d,{type:"scrollheight",from:d.scrollHeight,diff:-2,to:0,anim:this.$animType,steps:this.$animSteps,interval:this.$animSpeed,onfinish:function(g,i){g.style.display="none";}});};this.$findContainer=function(g){var d=g.nextSibling;if(!d){return g;}return d.nodeType==1?d:d.nextSibling;};this.addEventListener("bindingsload",this.$loaddatabinding=function(j){var k=j.bindings.properties;if(!k||!k.length){return;}for(var g=0,d=k.length;g<d;g++){}});this.$unloaddatabinding=function(){};this.getColumn=function(d){return this.$headings[d||this.$lastcol||0];};this.resizeColumn=function(i,g){var d=this.$headings[i];d.resize(g);};this.hideColumn=function(g){var d=this.$headings[g];d.hide();};this.showColumn=function(g){var d=this.$headings[g];d.show();};this.$getProperties=function(g){if(this.properties){return this.$properties||false;}else{if(this.$bindings.properties){var j=this.$bindings.properties;for(var d=0;d<j.length;d++){if(!j[d].match){return xx;}}}}return false;};this.$load=function(k){var q=this.$getProperties();if(!q){return false;}var i=[];var j=this.documentId=apf.xmldb.getXmlDocId(q);apf.xmldb.addNodeListener(k,this);var d=this,n=q.ownerDocument;(function g(t,G,C){for(var I,J,H,F,E,D,w,B=0,A=t.length;B<A;B++){w=t[B];d.$getNewContext("row");D=d.$getLayoutNode("row");if(w[apf.TAGNAME]=="group"){d.$getNewContext("cell");apf.setStyleClass(D,"heading");H=D.appendChild(d.$getLayoutNode("cell"));apf.setNodeValue(d.$getLayoutNode("cell","caption",H),(w.getAttribute("caption")||"").trim()||"");E=D.appendChild(n.createElement("blockquote"));g(w.selectNodes("prop"),E,C);D.insertBefore(I=n.createElement("u"),D.firstChild).appendChild(n.createTextNode(" "));I.setAttribute("class","min");}else{apf.xmldb.nodeConnect(j,w,D,d);d.$getNewContext("cell");h=d.$headings[0];H=D.appendChild(d.$setStyleClass(d.$getLayoutNode("cell"),h.$className));apf.setNodeValue(d.$getLayoutNode("cell","caption",H),(w.getAttribute("caption")||"").trim()||"");if(C){H.firstChild.setAttribute("style","padding-left:"+(C*15)+"px");}d.$getNewContext("cell");h=d.$headings[1];H=D.appendChild(d.$setStyleClass(d.$getLayoutNode("cell"),h.$className));apf.setNodeValue(d.$getLayoutNode("cell","caption",H),((apf.lm.compile(w.getAttribute("value"),{nostring:true}))(d.xmlRoot)||"")||"");if((J=w.selectNodes("prop")).length){E=D.appendChild(n.createElement("blockquote"));E.setAttribute("style","display:none;overflow:hidden;height:0;");g(J,d.$getLayoutNode("heading","container",E),C+1);D.insertBefore(I=n.createElement("u"),D.firstChild).appendChild(n.createTextNode(" "));I.setAttribute("class","plus");}}if(!G){i.push(D);}else{G.appendChild(D);}}})(q.selectNodes("group|prop"),null,0);apf.insertHtmlNodes(i,this.$body);this.setProperty("root",this.xmlRoot);var s=q.selectSingleNode(".//prop");if(s){this.select(this.$findHtmlNode(s.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId));}};this.$xmlUpdate=function(q,w,j,t){if(w!=this.xmlRoot){return;}if(t&&this.$lastEditor[0]==t.amlNode){this.$lastEditor[1].firstChild.innerHTML=((apf.lm.compile(this.$lastEditor[2].getAttribute("value"),{nostring:true}))(this.xmlRoot)||"")||"";}else{var g=this.$getProperties();var k,u,d=g.selectNodes(".//prop");for(var s=0,n=d.length;s<n;s++){k=d[s];u=this.$findHtmlNode(k.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId);u.childNodes[u.firstChild.tagName=="U"?2:1].firstChild.innerHTML=((apf.lm.compile(k.getAttribute("value"),{nostring:true}))(this.xmlRoot)||"")||"";}}};this.$hideEditor=function(d){if(this.$lastEditor){this.$lastEditor[0].setProperty("visible",false);if(d){var n=this.$lastEditor[0].$ext.parentNode;n.removeChild(this.$lastEditor[0].$ext);n.removeAttribute("id");delete n.onresize;}var j=this.$lastEditor[1].childNodes;for(var k=0,g=j.length;k<g;k++){if(!j[k].host){j[k].style.display="";}}delete this.$lastEditor;}};this.select=function(D){if(this.$selected==D){return;}if(this.$selected){this.$setStyleClass(this.$selected,"",["selected"]);}this.$setStyleClass(D,"selected");this.$selected=D;this.$hideEditor();var g=apf.xmldb.getNode(D);var w=this;this.setProperty("selected",g);var A=this.$selected.childNodes[this.$selected.firstChild.tagName=="U"?2:1];var C,u=g.getAttribute("editor");var n=apf.lm.compile(u,{xpathmode:2});if(n.type==2){if(!u){if(g.childNodes.length){return;}else{throw new Error("Missing editor attribute on property element: "+g.xml);}}if(!this.$editors[u]){var B=apf.namespaces[apf.ns.aml].elements[u];var j={htmlNode:A,width:"100%+2",height:19,style:"position:relative;z-index:10000",value:"[{"+this.id+".root}::"+(v=g.getAttribute("value")).substr(1,v.length-2)+"]",focussable:false,realtime:true};if(B.prototype.hasFeature(apf.__MULTISELECT__)){j.caption="[text()]";j.eachvalue="[@value]";j.each="item";j.model="{apf.xmldb.getElementById('"+g.getAttribute(apf.xmldb.xmlIdTag)+"')}";}C=this.$editors[u]=new B(j);var t=apf.getBox(apf.getStyle(C.$ext,"margin"));if(t[1]||t[3]){C.setAttribute("width","100%+2-"+(t[1]+t[3]));}else{if(!t[3]){C.$ext.style.marginLeft="-1px";}}C.parentNode=this;C.$focusParent=this;C.setAttribute("focussable","true");C.$parentId=A.getAttribute("id");C.$parentRsz=A.onresize;}else{C=this.$editors[u];if(C.hasFeature(apf.__MULTISELECT__)){C.setAttribute("model","{apf.xmldb.getElementById('"+g.getAttribute(apf.xmldb.xmlIdTag)+"')}");}C.setAttribute("value","[{"+this.id+".root}::"+(v=g.getAttribute("value")).substr(1,v.length-2)+"]");C.setProperty("visible",true);if(C.$ext.parentNode&&C.$ext.parentNode.nodeType==1){if(!C.$parentRsz){C.$parentRsz=C.$ext.parentNode.onresize;}C.$ext.parentNode.removeAttribute("id");delete C.$ext.parentNode.onresize;}A.appendChild(C.$ext);A.setAttribute("id",A.$parentId);if(C.$parentRsz){A.onresize=C.$parentRsz;A.onresize();}}}else{var s=n.call(this,this.xmlRoot);if(s.localName=="template"){}else{}}var d=A.childNodes;for(var q=0,k=d.length;q<k;q++){if(!d[q].host){d[q].style.display="none";}}this.$lastEditor=[C,A,g];};this.addEventListener("$clear",function(d){this.$hideEditor(true);});this.$draw=function(){this.$ext=this.$getExternal();this.$body=this.$getLayoutNode("main","body",this.$ext);this.$head=this.$getLayoutNode("main","head",this.$ext);this.$pointer=this.$getLayoutNode("main","pointer",this.$ext);this.$container=this.$body;if(this.$head.firstChild){this.$head.removeChild(this.$head.firstChild);}if(this.$body.firstChild){this.$body.removeChild(this.$body.firstChild);}var g=this.$widthdiff=this.$getOption("main","widthdiff")||0;this.$defaultwidth=this.$getOption("main","defaultwidth")||"100";this.$useiframe=apf.isIE&&(apf.isTrue(this.$getOption("main","iframe"))||this.iframe);var d=this;if(this.$useiframe&&!this.oIframe){var i=this.$body.className;this.oIframe=this.$body.appendChild(document.createElement(apf.isIE?"<iframe frameborder='0'></iframe>":"iframe"));this.oIframe.frameBorder=0;this.oWin=this.oIframe.contentWindow;this.oDoc=this.oWin.document;this.oDoc.write('<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">                <html xmlns="http://www.w3.org/1999/xhtml">                    <head><script>                        apf = {                            lookup : function(uid){                                return window.parent.apf.lookup(uid);                            },                            Init : {add:function(){},run:function(){}}                        };<\/script>                    </head>                    <body></body>                </html>');this.$body=this.oDoc.body;this.$body.className=i;this.oDoc.documentElement.className=this.$ext.className;apf.skins.loadCssInWindow(this.skinName,this.oWin,this.mediaPath,this.iconPath);if(apf.isIE){this.$setStyleClass(this.oDoc.documentElement,this.$baseCSSname+"Focus");}apf.convertIframe(this.oIframe,true);if(apf.getStyle(this.oDoc.documentElement,apf.isIE?"overflowY":"overflow-y")=="auto"){this.oIframe.onresize=function(){d.$head.style.marginRight=d.oDoc.documentElement.scrollHeight>d.oDoc.documentElement.offsetHeight?"16px":"0";};this.addEventListener("afterload",this.oIframe.onresize);this.addEventListener("xmlupdate",this.oIframe.onresize);}this.oDoc.documentElement.onmousedown=function(j){if(!j){j=d.oWin.event;}if((j.srcElement||j.target).tagName=="HTML"){apf.popup.forceHide();}};this.oDoc.documentElement.onscroll=function(){if(d.$isFixedGrid){d.$head.scrollLeft=d.oDoc.documentElement.scrollLeft;}};}else{if(apf.getStyle(this.$body,apf.isIE?"overflowY":"overflow-y")=="auto"){this.$resize=function(){d.$head.style.marginRight=d.$body.scrollHeight>d.$body.offsetHeight?"16px":"0";};apf.layout.setRules(this.$ext,this.$uniqueId+"_datagrid","var o = apf.all["+this.$uniqueId+"];                     if (o) o.$resize()");apf.layout.queue(this.$ext);this.addEventListener("afterload",this.$resize);this.addEventListener("xmlupdate",this.$resize);}this.$body.onmousedown=function(j){if(!j){j=event;}if((j.srcElement||j.target)==this){apf.popup.forceHide();}};this.$body.onscroll=function(){if(d.$isFixedGrid){d.$head.scrollLeft=d.$body.scrollLeft;}};}var d=this;this.$body.onmousedown=function(k){if(!k){k=event;}var j=k.srcElement||k.target;if(j==this){return;}if(j.tagName=="U"){d.$slideToggle(j);return;}while(j.host||(j.getAttribute(apf.xmldb.htmlIdTag)||"").indexOf("|")==-1){j=j.parentNode;if(j==this){return;}}d.select(j);};};this.$loadAml=function(d){this.$headings=[new apf.BindingColumnRule().$draw(this,"Property",this.$columns[0],"first"),new apf.BindingColumnRule().$draw(this,"Value",this.$columns[1])];};this.$destroy=function(){apf.popup.removeContent(this.$uniqueId);for(var d in this.$editors){this.$editors[d].destroy();}this.$ext.onclick=this.$body.onresize=null;apf.layout.removeRule(this.$body,"dg"+this.$uniqueId);apf.layout.activateRules(this.$body);};}).call(apf.propedit.prototype=new apf.DataBinding());apf.aml.setElement("propedit",apf.propedit);apf.aml.setElement("column",apf.BindingColumnRule);apf.aml.setElement("description",apf.BindingRule);apf.aml.setElement("color",apf.BindingRule);apf.checkbox=function(c,a){this.$init(a||"checkbox",apf.NODE_VISIBLE,c);};(function(){this.implement(apf.DataAction);this.$notfromext=true;this.$focussable=true;this.checked=false;this.$values=[1,0];this.$booleanProperties.checked=true;this.$supportedProperties.push("value","checked","label","values");this.$propHandlers.value=function(a){a=(typeof a=="string"?a.trim():a);this.checked=(typeof a!="undefined"&&a!==null&&a.toString()==this.$values[0].toString());if(this.checked){apf.setStyleClass(this.$ext,this.$baseCSSname+"Checked");}else{apf.setStyleClass(this.$ext,"",[this.$baseCSSname+"Checked"]);}};this.$propHandlers.checked=function(a){if(!this.$values){if(this.getAttribute("values")){this.$propHandler.values.call(this,this.getAttribute("values"));}else{this.$values=[false,true];}}this.setProperty("value",this.$values[a?0:1]);};this.$propHandlers.label=function(c){if(!this.$ext){return;}var a=this.$getLayoutNode("main","label",this.$ext);if(a.nodeType==1){a.innerHTML=c;}else{a.nodeValue=c;}};this.$propHandlers.values=function(a){this.$values=typeof a=="string"?a.split("|"):(a||[1,0]);};this.setValue=function(a){if(!this.$values){return;}this.setProperty("value",a,false,true);};this.getValue=function(){return this.xmlRoot?this.$values[this.checked?0:1]:this.value;};this.check=function(){this.setProperty("value",this.$values[0],false,true);};this.uncheck=function(){this.setProperty("value",this.$values[1],false,true);};this.addEventListener("$clear",function(){this.setProperty("value",this.$values[1]);});this.$enable=function(){if(this.$input){this.$input.disabled=false;}this.$doBgSwitch(1);};this.$disable=function(){if(this.$input){this.$input.disabled=true;}this.$doBgSwitch(4);};this.$setState=function(a,d,c){this.$doBgSwitch(this.states[a]);this.$setStyleClass(this.$ext,(a!="Out"?this.$baseCSSname+a:""),[this.$baseCSSname+"Down",this.$baseCSSname+"Over"]);this.state=a;if(c){this.dispatchEvent(c,d);}};this.$clickHandler=function(){this.change(this.$values[(!this.checked)?0:1]);return true;};this.$draw=function(){this.$ext=this.$getExternal();this.$input=this.$getLayoutNode("main","input",this.$ext);this.$setupEvents();};this.$childProperty="label";}).call(apf.checkbox.prototype=new apf.BaseButton());apf.aml.setElement("checkbox",apf.checkbox);apf.application=function(){this.$init("application",apf.NODE_HIDDEN);if(!apf.isO3){this.$int=document.body;this.$tabList=[];this.$focussable=apf.KEYBOARD;this.focussable=true;this.visible=true;this.$isWindowContainer=true;this.focus=function(){this.dispatchEvent("focus");};this.blur=function(){this.dispatchEvent("blur");};apf.window.$addFocus(this);}};apf.application.prototype=new apf.AmlElement();apf.aml.setElement("application",apf.application);apf.loader=function(){this.$init("loader",apf.NODE_HIDDEN);this.show=function(){this.$ext.style.display="block";};this.hide=function(){this.$ext.style.display="none";};this.addEventListener("DOMNodeInsertedIntoDocument",function(c){var d;if(!(d=this.parentNode.$int)){return;}this.$ext=apf.insertHtmlNode(null,d,null,this.$aml?(this.$aml.serialize?this.$aml.serialize():this.$aml.xml):this.serialize());if(!apf.loaded){var a=this;apf.addEventListener("load",function(){if(apf.config.autoHideLoading){apf.queue.empty();a.hide();}});}});};apf.loader.prototype=new apf.AmlElement();apf.aml.setElement("loader",apf.loader);apf.AmlConfig=function(){this.$init("config",apf.NODE_VISIBLE);};(function(){this.focussable=false;this.$canLeechSkin=true;this.$draw=function(){this.$ext=this.$int=this.$getExternal(this.$isLeechingSkin?this.localName:"main");};}).call(apf.AmlConfig.prototype=new apf.Presentation());apf.aml.setElement("config",apf.AmlConfig);apf.bindings=function(c,a){this.$init(a||"bindings",apf.NODE_HIDDEN,c);this.$bindings=new apf.ruleList();this.$amlNodes={};};(function(){this.$smartbinding=null;this.register=function(a){if(a.localName=="smartbinding"){this.$smartbinding=a;this.$smartbinding.add(this);return;}if(!a.hasFeature(apf.__DATABINDING__)){return;}this.$amlNodes[a.$uniqueId]=a;if(!this.$amlLoaded){return;}if(!this.$bindings.$isCompiled){this.$cbindings=this.$bindings.compile();}a.$bindings=this.$bindings;a.$cbindings=this.$cbindings;a.dispatchEvent("bindingsload",{bindings:this.$bindings,compiled:this.$cbindings});this.dispatchEvent("noderegister",{amlNode:a});a.$checkLoadQueue();};this.unregister=function(){this.$amlNodes[this.amlNode.$uniqueId]=null;delete this.$amlNodes[this.amlNode.$uniqueId];this.amlNode.$bindings=this.amlNode.$cbindings=false;this.amlNode.dispatchEvent("bindingsunload",{bindings:this.$bindings,compiled:this.$cbindings});};this.reload=function(){for(var a in this.$amlNodes){this.$amlNodes[a].reload();}};this.addEventListener("DOMNodeInsertedIntoDocument",function(j){var c=this.childNodes;for(var g,d=0,a=c.length;d<a;d++){if(!(g=c[d]).$amlLoaded&&g.nodeType==1){g.dispatchEvent("DOMNodeInsertedIntoDocument");}}this.register(this.parentNode);for(var k in this.$amlNodes){this.register(this.$amlNodes[k]);}});}).call(apf.bindings.prototype=new apf.AmlElement());apf.ruleList=function(){this.$compiled={};};apf.ruleList.prototype={$isCompiled:false,getRule:function(c,g){var n=this[c];if(!n){return false;}for(var j,k,d=0,a=n.length;d<a;d++){k=n[d];if(!k.match){return k;}j=k.cmatch||k.compile("match",{injectself:true,xpathmode:2});if(j&&j(g)){return k;}}},compile:function(d){var n,j,q=this.$compiled;if(d){j=[];n=this[d];for(var k,g=0,a=n.length;g<a;g++){if(!(k=n[g]).match&&!k.value){continue;}j.push(k.match,k.value);}q[d]=apf.lm.compileMatch(j);return q;}for(d in this){if(d=="each"){continue;}n=this[d];if(n.dataType!=apf.ARRAY){continue;}j=[];for(var k,g=0,a=n.length;g<a;g++){if(!(k=n[g]).match&&!k.value){continue;}j.push(k.match,k.value);}q[d]=apf.lm.compileMatch(j);}this.$isCompiled=true;return q;},getRuleIndex:function(c,a){var d=this[c][a];if(d.value){if(!d.cvalue){d.compile("value");}}else{if(d.match){if(!d.cmatch){d.compile("match");}}}return d;},getDataNode:function(a,s,q,j,u){var k,g,d,c,n,t=this[a];if(!t){return;}for(n,k=0,g=t.length;k<g;k++){n=t[k];d=n.cvaluematch;if(!d){if(n.match&&n.value){n.valuematch="{_n = "+n.match+"; %[child::"+n.value.substr(1,n.value.length-2).split("|").join("|child::")+"]}";}else{n.valuematch=n.match||n.value;}d=n.$compile("valuematch",{xpathmode:u?4:3,injectself:n.match?true:false});}if(d&&(c=d(s,q))){if(j){j.push(n);}return c;}}return false;}};apf.aml.setElement("bindings",apf.bindings);apf.appsettings=function(c,a){this.$init(a||"appsettings",apf.NODE_HIDDEN,c);};(function(){this.$parsePrio="001";this.$attrExcludePropBind={language:1,login:1,logout:1,layout:1};this.$supportedProperties=["debug","name","baseurl","resource-path","disable-right-click","allow-select","allow-blur","auto-disable-actions","auto-disable","disable-f5","auto-hide-loading","disable-space","disable-backspace","undokeys","initdelay","default-page","query-append","outline","drag-outline","resize-outline","resize-outline","iepngfix","iepngfix-elements","iphone-fullscreen","iphone-statusbar","iphone-icon","iphone-icon-is-glossy","iphone-fixed-viewport","layout","skinset","language","storage","offline","login"];this.$booleanProperties={debug:1,"disable-right-click":1,"allow-select":1,"allow-blur":1,"auto-disable-actions":1,"auto-disable":1,"disable-f5":1,"auto-hide-loading":1,"disable-space":1,"disable-backspace":1,undokeys:1,initdelay:1,outline:1,iepngfix:1,"iphone-fullscreen":1,"iphone-icon-is-glossy":1,"iphone-fixed-viewport":1};this.$handlePropSet=function(d,c,a){if(this.$booleanProperties[d]){c=apf.isTrue(c);}this[d]=c;apf.config.setProperty(d,c);};this.addEventListener("DOMNodeInsertedIntoDocument",function(a){if(apf.isIphone&&apf.runIphone){apf.runIphone();delete apf.runIphone;}});}).call(apf.appsettings.prototype=new apf.AmlElement());apf.aml.setElement("appsettings",apf.appsettings);apf.BindingColorRule=function(c,a){this.$init(a,apf.NODE_HIDDEN,c);};(function(){this.addEventListener("DOMNodeInsertedIntoDocument",function(c){if(this.$bindings&&this.$bindings.color){var a=this.$bindings.color[0];apf.setStyleRule("."+this.$baseCSSname+(apf.isIE?" .records .highlight SPAN":" .records .highlight span"),"color",a.getAttribute("text"),null,this.oWin);apf.setStyleRule("."+this.$baseCSSname+(apf.isIE?" .records .highlight SPAN":" .records .highlight span"),"backgroundColor",a.getAttribute("row"),null,this.oWin);apf.setStyleRule("."+this.$baseCSSname+(apf.isIE?" .records .highlight":" .records .highlight"),"backgroundColor",a.getAttribute("row"),null,this.oWin);}apf.importStylesheet([["."+this.className,"width:"+this.$width+(this.$isPercentage?"%;":"px;")+"text-align:"+h.align],["."+this.className,"width:"+this.$width+(this.$isPercentage?"%;":"px;")+"text-align:"+h.align]]);this.$draw();});}).call(apf.BindingColorRule.prototype=new apf.BindingRule());apf.aml.setElement("color",apf.BindingColorRule);apf.rpc=function(c,a){this.$init(a||"rpc",apf.NODE_HIDDEN,c);if(!this.supportMulticall){this.multicall=false;}this.stack={};this.urls={};this.$methods={};};(function(){this.useHTTP=true;this.namedArguments=false;this["route-server"]=apf.host+"/cgi-bin/rpcproxy.cgi";this.autoroute=false;this.$auth=false;this.$booleanProperties.multicall=true;this.$supportedProperties.push("protocol","type","multicall","http-method");this.$propHandlers["route-server"]=function(c){this.autoroute=c?true:false;};this.$propHandlers.protocol=function(c){if(!c){return;}if(!apf[c]){throw new Error(apf.formatErrorString(1025,null,"Teleport baseclass","Could not find Ajax.org Teleport RPC Component '"+c+"'",this));return;}this.implement(apf[c]);};this.$propHandlers.type=function(c){this.$useXml=(typeof c=="string"&&c.toUpperCase()=="XML");};this.setCallback=function(c,d){if(!this.$methods[c]){throw new Error(apf.formatErrorString(0,this,"Teleport RPC","Trying to set callback: method not found."));}this.$methods[c].callback=d;};this.setUrl=function(d,c){if(!this.$methods[d]){throw new Error(apf.formatErrorString(0,this,"Teleport RPC","Trying to set callback: method not found."));}this.$methods[d].setProperty("url",c);};this.$convertArgs=function(q,n){if(!this.namedArguments){return Array.prototype.slice.call(n);}var g=this.$methods[q].names;if(!g||!g.length){return{};}var t,k,s,d,c={};for(k=0,s=0,d=g.length;s<d;s++){q=g[s].name;t=g[s].value;if(t){t=apf.parseExpression(t);}else{t=n[k++];if(apf.isNot(t)&&g[s]["default"]){t=apf.parseExpression(g[s]["default"]);}}t=apf.isTrue(g[s].encoded)?encodeURIComponent(t):t;c[q]=t;}return c;};function a(c){var g,d;if(typeof c.callback=="string"){g=c.callback.split("."),d=self[g.shift()];while(d&&g.length){d=d[g.shift()];}}else{d=c.callback;}return d||apf.K;}this.call=function(d,q,u){var t,k=this.$methods[d];if(typeof q[q.length-1]=="function"){q=Array.prototype.slice.call(q);t=q.pop();}else{t=a(k);}q=this.$convertArgs(d,q);if(this.multicall){if(!this.stack[this.url]){this.stack[this.url]=this.getMulticallObject?this.getMulticallObject():[];}this.getSingleCall(d,q,this.stack[this.url]);return true;}var s=this,n=this.createMessage(k["method-name"]||d,q);function i(B,A,w){w.data=B;if(A!=apf.SUCCESS){t.call(s,null,A,w);}else{if(s.isValid&&!s.isValid(w)){t.call(s,null,apf.ERROR,w);}else{t.call(s,s.unserialize(w.data),A,w);}}}var j,c=apf.getAbsolutePath(this.baseurl||apf.config.baseurl,this.url),g=apf.extend({callback:i,async:k.async,userdata:k.userdata,nocache:(this.nocache===false)?false:true,data:n,useXML:this.$useXml||k.type=="xml",caching:k.caching,ignoreOffline:k["ignore-offline"]},u);return this.$get(c,g);};this.purge=function(s,q,g,t){if(!this.stack[this.url]||!this.stack[this.url].length){throw new Error(apf.formatErrorString(0,null,"Executing a multicall","No RPC calls where executed before calling purge()."));}var j=this.createMessage("multicall",[this.stack[this.url]]),c=apf.getAbsolutePath(this.baseurl||apf.config.baseurl,this.url);if(t){for(var n=[],k=0;k<t.length;k++){n.push(encodeURIComponent(t[k][0])+"="+encodeURIComponent(t[k][1]||""));}c=c+(c.match(/\?/)?"&":"?")+n.join("&");}var d=this.$get(c,{callback:s,async:g,userdata:q,nocache:true,data:j,useXML:this.$useXml});this.stack[this.url]=this.getMulticallObject?this.getMulticallObject():[];};this.revert=function(c){this.stack[c.url]=this.getMulticallObject?this.getMulticallObject():[];};this.getStackLength=function(){return this.stack[this.url]?this.stack[this.url].length:0;};this.$addMethod=function(k){if(k.localName!="method"){throw new Error(apf.formatErrorString(0,this,"Parsing RPC Teleport node","Found element which is not a method",this));return false;}var g=k.name,c=k.receive||this.receive,j=0,d=k.childNodes.length,n;this[g]=function(){return this.call(g,arguments);};if(c){k.callback=c;}this.$methods[g]=k;if(!k.names){k.names=[];}for(;j<d;j++){n=k.childNodes[j];if(n.localName=="param"||n.localName=="variable"){k.names.push(n);}}return true;};this.$removeMethod=function(d){var c=d.name;delete this[c];delete this.$methods[c];};this.$setAuth=function(c){this.$auth=c;};this.exec=function(k,g,j,d){if(!d){d={};}if(d.multicall){this.forceMulticall=true;}if(!this[k]){throw new Error(apf.formatErrorString(0,null,"Saving/Loading data","Could not find RPC function by name '"+k+"' in data instruction '"+d.instruction+"'"));}var i=this.$methods[k];if(d.userdata){i.userdata=d.userdata;}if(!this.multicall){i.callback=j;}var c=this.call(k,g,d);if(this.multicall){return this.purge(j,"&@^%!@");}else{if(d.multicall){this.forceMulticall=false;return this;}}if(!this.multicall&&!i.async&&j){j(c,apf.SUCCESS,{tpModule:this});}};}).call(apf.rpc.prototype=new apf.Teleport());apf.config.$inheritProperties.baseurl=1;apf.aml.setElement("rpc",apf.rpc);apf.method=function(c,a){this.$init(a||"method",apf.NODE_HIDDEN,c);this.async=true;this.caching=false;this["ignore-offline"]=false;};(function(){this.$parsePrio="002";this.$booleanProperties.async=true;this.$booleanProperties.caching=true;this.$booleanProperties["ignore-offline"]=true;this.$supportedProperties.push("name","receive","async","caching","ignore-offline","method-name","type","url");this.$propHandlers["ignore-offline"]=function(a){this.ignoreOffline=a;};this.$propHandlers["method-name"]=function(a){this.methodName=a;};this.addEventListener("DOMNodeInserted",function(a){if(this.parentNode.$addMethod&&a.currentTarget==this){this.parentNode.$addMethod(this);}});this.addEventListener("DOMNodeRemoved",function(a){if(this.parentNode.$removeMethod&&a.currentTarget==this){this.parentNode.$removeMethod(this);}});this.addEventListener("DOMNodeInsertedIntoDocument",function(a){if(this.parentNode.$addMethod){this.parentNode.$addMethod(this);}});}).call(apf.method.prototype=new apf.AmlElement());apf.aml.setElement("method",apf.method);apf.cgi=function(){this.supportMulticall=false;this.namedArguments=true;this.unserialize=function(a){return a;};this.getSingleCall=function(c,a,d){d.push(a);};this.createMessage=function(g,a){var k,j=[];function d(q,i){if(q&&q.dataType==apf.ARRAY){for(var n=0;n<q.length;n++){d(q[n],i+"%5B"+n+"%5D");}}else{if(typeof q=="object"){for(k in q){if(typeof q[k]=="function"){continue;}d(q[k],i+"%5B"+encodeURIComponent(k)+"%5D");}}else{if(typeof q!="undefined"&&q!==null){j.push(i+"="+encodeURIComponent(q));}}}}if(this.multicall){j.push("func="+this.mcallname);for(var c=0;c<a[0].length;c++){d(a[0][c],"f%5B"+c+"%5D");}}else{for(k in a){d(a[k],k);}}if(!this.baseUrl){this.baseUrl=this.url;}this.url=this.$methods[g].url?this.$methods[g].url:this.baseUrl;if(this.method!="GET"){return j.join("&");}this.url=this.url+(j.length?(this.url.indexOf("?")>-1?"&":"?")+j.join("&"):"");return"";};this.addEventListener("DOMNodeInsertedIntoDocument",function(){this.method=(this["http-method"]||"GET").toUpperCase();this.contentType=this.method=="GET"?null:"application/x-www-form-urlencoded";});this.submitForm=function(k,q){if(!this["postform"]){this.addMethod("postform",q);}var d=[];for(var g=0,a=k.elements.length;g<a;g++){if(!k.elements[g].name){continue;}if(k.elements[g].tagname=="input"&&(k.elements[g].type=="checkbox"||k.elements[g].type=="radio")&&!k.elements[g].checked){continue;}if(k.elements[g].tagname="select"&&k.elements[g].multiple){for(var c=0;c<k.elements[g].options.length;c++){if(k.elements[g].options[c].selected){d.push(k.elements[g].name+"="+encodeURIComponent(k.elements[g].options[c].value));}}}else{d.push(k.elements[g].name+"="+encodeURIComponent(k.elements[g].value));}}var n=(k.action||location.href);this.urls.postform=n+(n.indexOf("?")>-1?"&":"?")+d.join("&");this["postform"].call(this);return false;};};apf.UndoData=function(g,c){this.localName="UndoData";this.extra={};apf.extend(this,g);if(c){this.at=c;}else{if(g&&g.tagName=="UndoData"){this.args=g.args.slice();}else{this.selNode=this.selNode||(this.action=="removeNode"?this.args[0]:(this.amlNode?this.amlNode.selected:null));}}var d,a=this;this.saveChange=function(j,i,q){if(this.action=="group"){var n=this.args[1];i.$addToQueue(n,j,true);return i.$queueNext(this);}var k;if(this.xmlActionNode){k=this.xmlActionNode.getAttribute(j?"undo":"set");if(j&&!k){k=this.xmlActionNode.getAttribute("set");}}if(!k){return i.$queueNext(this);}this.state=j?"restoring":"saving";if(!d||d._pc===true){throw new Error("Error in data instruction:"+k);}if(d._pc==-2){return i.$receive(null,apf.SUCCESS,{amlNode:this.amlNode},this,q);}d.callback=function(u,t,s){s.amlNode=a.amlNode;return i.$receive(u,t,s,a,q);};d.ignoreOffline=true;apf.saveData(k,d);};this.preparse=function(j,i,k){var n;if(this.xmlActionNode){n=this.xmlActionNode.getAttribute(j?"undo":"set");if(j&&!n){n=this.xmlActionNode.getAttribute("set");}}if(!n){return this;}d=apf.extend({xmlNode:this.action=="multicall"?this.args[0].xmlNode:this.selNode||this.xmlNode,userdata:apf.isTrue(this.xmlActionNode.getAttribute("ignore-fail")),multicall:k,undo:j,_pc:true,callback:function(t,s,q){d._pc=-2;}},this.extra);apf.saveData(n,d);if(d._pc===true){d._pc=-1;}return this;};};apf.actiontracker.actions={setTextNode:function(d,a){var c=d.args;if(!a){apf.xmldb.setTextNode(c[0],c[1],c[2],d);}else{apf.xmldb.setTextNode(c[0],d.extra.oldValue,c[2]);}},setAttribute:function(d,a){var c=d.args;if(!a){d.extra.name=c[1];d.extra.oldValue=c[0].getAttribute(c[1]);apf.xmldb.setAttribute(c[0],c[1],c[2],c[3],d);}else{if(!d.extra.oldValue){apf.xmldb.removeAttribute(c[0],c[1]);}else{apf.xmldb.setAttribute(c[0],c[1],d.extra.oldValue,c[3]);}}},removeAttribute:function(d,a){var c=d.args;if(!a){d.extra.name=c[1];d.extra.oldValue=c[0].getAttribute(c[1]);apf.xmldb.removeAttribute(c[0],c[1],c[2],d);}else{apf.xmldb.setAttribute(c[0],c[1],d.extra.oldValue,c[2]);}},replaceNode:function(d,a){var c=d.args;if(!a){apf.xmldb.replaceNode(c[1],c[0],c[2],d);}else{apf.xmldb.replaceNode(c[0],c[1],c[2],d);}},addChildNode:function(d,a){var c=d.args;if(!a){apf.xmldb.addChildNode(c[0],c[1],c[2],c[3],d);}else{apf.xmldb.removeNode(d.extra.addedNode);}},appendChild:function(d,a){var c=d.args;if(!a){apf.xmldb.appendChild(c[0],c[1],c[2],c[3],c[4],d);}else{apf.xmldb.removeNode(d.xmlNode);}},moveNode:function(d,a){var c=d.args;if(!a){apf.xmldb.moveNode(c[0],c[1],c[2],c[3],d);}else{apf.xmldb.moveNode(d.extra.oldParent,c[1],d.extra.beforeNode,c[3]);}},removeNode:function(d,a){var c=d.args;if(!a){apf.xmldb.removeNode(c[0],c[1],d);}else{apf.xmldb.appendChild(d.extra.parent,d.extra.removedNode,d.extra.beforeNode);}},removeNodeList:function(g,a){if(a){var j=g.extra.removeList;for(var c=j.length-1;c>=0;c--){apf.xmldb.appendChild(j[c].pNode,j[c].removedNode,j[c].beforeNode);}}else{apf.xmldb.removeNodeList(g.args,g);}},group:function(g,d,a){if(!g.$undostack){var c=g.args[0];g.$undostack=c;g.$redostack=[];}a[d?"undo":"redo"](g.$undostack.length,false,g.$undostack,g.$redostack);},setValueByXpath:function(g,a){var d=g.args;if(!a){if(g.extra.newNode){apf.xmldb.appendChild(g.extra.parentNode,g.extra.newNode);}else{var c=[];apf.setNodeValue(d[0],d[1],true,{undoObj:g,xpath:d[2],newNodes:c,forceNew:d[3]});g.extra.newNode=c[0];}}else{if(g.extra.newNode){g.extra.parentNode=g.extra.newNode.parentNode;apf.xmldb.removeNode(g.extra.newNode);}else{apf.setNodeValue(g.extra.appliedNode,g.extra.oldValue,true);}}},multicall:function(k,c,a){var j=k.args;var g=apf.xmldb.delayUpdate;apf.xmldb.delayUpdate=true;if(!c){for(var d=0;d<j.length;d++){if(!j[d].extra){j[d].extra={};}apf.actiontracker.actions[j[d].action](j[d],false,a);}}else{for(var d=j.length-1;d>=0;d--){apf.actiontracker.actions[j[d].action](j[d],true,a);}}apf.xmldb.delayUpdate=g;}};apf.LiveMarkupPi=function(){this.$init();};(function(){this.mainBind="data";this.implement(apf.StandardBinding);this.getDocument=function(){return this.$data&&this.$data.ownerDocument;};this.clear=function(a){if(a=="loading"&&apf.getInheritedAttribute(this,"loading-message")){this.$propHandlers.calcdata.call(this,"<span class='loading'>Loading...</span>");this.calcdata="";}};this.$propHandlers.calcdata=function(d){if(this.$data){var a=this.$data.childNodes;for(var c=a.length-1;c>=0;c--){a[c].destroy(true);}}if(typeof d=="string"&&d.indexOf("<a:")>-1){this.$ext.innerHTML="";this.$data=this.ownerDocument.$domParser.parseFromString("<a:application xmlns:a='"+apf.ns.apf+"'>"+d+"</a:application>","text/xml",{htmlNode:this.$ext}).documentElement;}else{if(this.$data){var a=this.$data.childNodes;for(var c=0;c<a.length;c++){a[c].destroy(true);}}this.$ext.innerHTML=d||"";}};}).call(apf.LiveMarkupPi.prototype=new apf.AmlProcessingInstruction(true));apf.aml.setProcessingInstruction("lm",apf.LiveMarkupPi);apf.aml.setProcessingInstruction("lm-debug",apf.LiveMarkupPi);apf.aml.setProcessingInstruction("livemarkup",apf.LiveMarkupPi);apf.LiveTextPi=function(){this.$init();};(function(){this.mainBind="data";this.implement(apf.StandardBinding);this.$propHandlers.calcdata=function(a){this.$ext.innerHTML=a&&apf.htmlentities(a)||"";};}).call(apf.LiveTextPi.prototype=new apf.AmlProcessingInstruction(true));apf.aml.setProcessingInstruction("lt",apf.LiveTextPi);apf.aml.setProcessingInstruction("livetext",apf.LiveTextPi);if(document.all){var oldWinError=window.onerror,z;window.onerror=z=function(a){apf.console.error("Error caught from early startup. Might be a html parser syntax error (not your fault). "+a);if(!arguments.caller){return true;}};}apf.Init.addConditional(function(){if(document.all&&window.onerror==z){window.onerror=oldWinError;}apf.dispatchEvent("domready");},null,["body","class"]);apf.addDomLoadEvent(function(){apf.Init.run("body");});apf.start();