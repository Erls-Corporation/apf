var apf={VERSION:"3.3beta",CDN:"",READY:false,NODE_HIDDEN:101,NODE_VISIBLE:102,NODE_O3:103,KEYBOARD:2,KEYBOARD_MOUSE:true,SUCCESS:1,TIMEOUT:2,ERROR:3,OFFLINE:4,debug:true,debugType:"Memory",debugFilter:"!teleport",includeStack:[],initialized:false,AppModules:[],autoLoadSkin:false,started:false,crypto:{},config:{},_GET:{},$asyncObjects:{"apf.oHttp":1,"apf.ajax":1},basePath:"",ns:{apf:"http://ajax.org/2005/aml",aml:"http://ajax.org/2005/aml",xsd:"http://www.w3.org/2001/XMLSchema",xhtml:"http://www.w3.org/1999/xhtml",xslt:"http://www.w3.org/1999/XSL/Transform",xforms:"http://www.w3.org/2002/xforms",ev:"http://www.w3.org/2001/xml-events"},availHTTP:[],releaseHTTP:function(b){if(apf.brokenHttpAbort){return;}if(self.XMLHttpRequestUnSafe&&b.constructor==XMLHttpRequestUnSafe){return;}b.onreadystatechange=function(){};b.abort();this.availHTTP.push(b);},browserDetect:function(){if(this.$bdetect){return;}this.$bdetect=true;var k=navigator.userAgent.toLowerCase()||"";this.isOpera=(self.opera&&Object.prototype.toString.call(self.opera)=="[object Opera]");this.isKonqueror=k.indexOf("konqueror")!=-1;this.isSafari=/a/.__proto__=="//";this.isSafariOld=false;this.isIphone=k.indexOf("iphone")!=-1||k.indexOf("aspen simulator")!=-1;this.isChrome=Boolean(/source/.test((/a/.toString+"")))||k.indexOf("chrome")!=-1;this.isWebkit=this.isSafari||this.isChrome||this.isKonquerer;if(this.isWebkit){var g=k.match(/applewebkit\/(\d+)/);if(g){this.webkitRev=parseInt(g[1]);this.isSafariOld=parseInt(g[1])<420;}}this.isGecko=(function(m){m[m]=m+"";return m[m]!=m+"";})(new String("__count__"));this.isGecko3=this.isGecko&&(function b(){})[-5]=="x";this.isGecko35=this.isGecko&&(/a/[-1]&&Object.getPrototypeOf)?true:false;this.versionGecko=this.isGecko?parseFloat(k.match(/(?:gecko)\/([\d\.]+)/i)[1]):-1;this.versionFF=this.isGecko?parseFloat(k.match(/(?:firefox)\/([\d\.]+)/i)[1]):-1;var d;this.isIE=!+"\v1";if(this.isIE){this.isIE=parseFloat(k.match(/msie ([\d\.]*)/)[1]);}this.isIE8=this.isIE==8&&(d=true);this.isIE7=!d&&this.isIE==7&&(d=true);if(this.isIE==7&&document.documentMode==7){apf.isIE7=true;apf.isIE8=false;apf.isIE7Emulate=true;apf.isIE=7;}this.isIE6=!d&&this.isIE==6&&(d=true);var c=(navigator.platform.match(/mac|win|linux/i)||["other"])[0].toLowerCase();this.isWin=(c=="win");this.isMac=(c=="mac");this.isLinux=(c=="linux");this.isAIR=k.indexOf("adobeair")!=-1;try{}catch(j){this.isDeskrun=false;}},setCompatFlags:function(){this.TAGNAME=apf.isIE?"baseName":"localName";this.styleSheetRules=apf.isIE?"rules":"cssRules";this.brokenHttpAbort=apf.isIE6;this.canUseHtmlAsXml=apf.isIE;this.supportNamespaces=!apf.isIE;this.cannotSizeIframe=apf.isIE;this.hasConditionCompilation=apf.isIE;this.supportOverflowComponent=apf.isIE;this.hasEventSrcElement=apf.isIE;this.canHaveHtmlOverSelects=!apf.isIE6&&!apf.isIE5;this.hasInnerText=apf.isIE;this.hasMsRangeObject=apf.isIE;this.descPropJs=apf.isIE;this.hasClickFastBug=apf.isIE;this.hasExecScript=window.execScript?true:false;this.canDisableKeyCodes=apf.isIE;this.hasTextNodeWhiteSpaceBug=apf.isIE||apf.isIE>=8;this.hasCssUpdateScrollbarBug=apf.isIE;this.canUseInnerHtmlWithTables=!apf.isIE;this.hasSingleResizeEvent=!apf.isIE;this.hasStyleFilters=apf.isIE;this.supportOpacity=!apf.isIE;this.supportPng24=!apf.isIE6&&!apf.isIE5;this.cantParseXmlDefinition=apf.isIE50;this.hasDynamicItemList=!apf.isIE||apf.isIE>=7;this.canImportNode=apf.isIE;this.hasSingleRszEvent=!apf.isIE;this.hasXPathHtmlSupport=!apf.isIE;this.hasFocusBug=apf.isIE;this.hasHeightAutoDrawBug=apf.isIE&&apf.isIE<8;this.hasIndexOfNodeList=!apf.isIE;this.hasReadyStateBug=apf.isIE50;this.dateSeparator=apf.isIE?"-":"/";this.canCreateStyleNode=!apf.isIE;this.supportFixedPosition=!apf.isIE||apf.isIE>=7;this.hasHtmlIdsInJs=apf.isIE&&apf.isIE<8||apf.isWebkit;this.needsCssPx=!apf.isIE;this.hasCSSChildOfSelector=!apf.isIE||apf.isIE>=8;this.styleAttrIsObj=apf.isIE<8;this.hasAutocompleteXulBug=apf.isGecko;this.loadsLocalFilesSync=apf.isIE||apf.isGecko;this.mouseEventBuffer=apf.isIE?20:6;this.hasComputedStyle=typeof document.defaultView!="undefined"&&typeof document.defaultView.getComputedStyle!="undefined";this.supportCSSAnim=apf.isWebkit&&(apf.webkitRev>525);this.w3cRange=Boolean(window.getSelection);this.locale=(apf.isIE?navigator.userLanguage:navigator.language).toLowerCase();this.characterSet=document.characterSet||document.defaultCharset||"utf-8";var j=document.createElement("div");this.hasContentEditable=(typeof j.contentEditable=="string"||typeof j.contentEditable=="boolean");var k=["transform","OTransform","KhtmlTransform","MozTransform","WebkitTransform"],m=["","O","Khtml","Moz","Webkit"],c=["","o-","khtml-","moz-","webkit-"],g=["transitionend","transitionend","transitionend","transitionend","webkitTransitionEnd"],d=0,b=5;this.supportCSSAnim=false;this.supportCSSTransition=false;for(;d<b&&!this.supportCSSAnim;++d){if(typeof j.style[k[d]]=="undefined"){continue;}this.supportCSSAnim=k[d];this.runtimeStylePrefix=m[d];this.classNamePrefix=c[d];this.cssAnimEvent=g[d];}j=null;delete j;this.supportVML=apf.isIE;this.supportSVG=!apf.isIE;this.hasHtml5XDomain=apf.versionGecko>=3.5;this.supportCanvas=!!document.createElement("canvas").getContext;this.supportCanvasText=!!(this.supportCanvas&&typeof document.createElement("canvas").getContext("2d").fillText=="function");this.hasVideo=!!document.createElement("video")["canPlayType"];this.hasAudio=!!document.createElement("audio")["canPlayType"];this.hasGeolocation=!!navigator.geolocation;this.supportHashChange=("onhashchange" in self)&&(!apf.isIE||apf.isIE>=8);this.windowHorBorder=this.windowVerBorder=apf.isIE8&&(!self.frameElement||parseInt(self.frameElement.frameBorder))?4:0;this.maxHttpRetries=apf.isOpera?0:3;this.percentageMatch=new RegExp();this.percentageMatch.compile("([\\-\\d\\.]+)\\%","g");this.reMatchXpath=new RegExp();this.reMatchXpath.compile("(^|\\|)(?!\\@|[\\w-]+::)","g");apf.isGears=!!apf.initGears()||0;},reboot:function(){apf.console.info("Restarting application...");location.href=location.href;},extend:function(c,g){var j,d,b=!c.notNull;if(arguments.length==2){for(j in g){if(b||g[j]){c[j]=g[j];}}return c;}for(d=1;d<arguments.length;d++){g=arguments[d];for(j in g){if(b||g[j]){c[j]=g[j];}}}return c;},$extend:function(b,c){for(var d in c){b[d]=c[d];}return b;},ajax:(function(){var b=function(){return this.oHttp.get.apply(this.oHttp,arguments);};b.exec=function(k,d,j,c){if(k=="ajax"&&d[0]){var g=d[1]||{};return this.oHttp.exec(g.method||"GET",[d[0]],g.callback,apf.extend(c||{},g));}};return b;})(),start:function(){this.started=true;var c=location.href.split("#")[0].split("?")[0];this.host=location.hostname&&c.replace(/(\/\/[^\/]*)\/.*$/,"$1");this.hostPath=c.replace(/\/[^\/]*$/,"")+"/";apf.console.info("Starting Ajax.org Platform Application...");apf.console.warn("Debug build of Ajax.org Platform "+(apf.VERSION?"version "+apf.VERSION:""));this.setCompatFlags();apf.$debugwin.start();if(this.isIE){apf.runIE();}if(apf.isWebkit){apf.runWebkit();}if(this.isOpera){apf.runOpera();}if(this.isGecko||!this.isIE&&!apf.isWebkit&&!this.isOpera){apf.runGecko();}this.oHttp=new this.http();this.Init.addConditional(this.parseAppMarkup,apf,["body"]);try{if(apf.isIE){document.execCommand("BackgroundImageCache",false,true);}}catch(d){}this.started=true;if(this.load_done){this.execDeferred();}this.root=true;for(var b=0;b<apf.$required.length;b++){apf.include(apf.$required[b]);}apf.require=apf.include;},nsqueue:{},findPrefix:function(c,g){var d;if(c.nodeType==9){if(!c.documentElement){return false;}if(c.documentElement.namespaceURI==g){return c.prefix||c.scopeName;}d=c.documentElement;}else{if(c.namespaceURI==g){return c.prefix||c.scopeName;}d=c.ownerDocument.documentElement;if(d&&d.namespaceURI==g){return c.prefix||c.scopeName;}while(c.parentNode){c=c.parentNode;if(c.namespaceURI==g){return c.prefix||c.scopeName;}}}if(d){for(var b=0;b<d.attributes.length;b++){if(d.attributes[b].nodeValue==g){return d.attributes[b][apf.TAGNAME];}}}return false;},importClass:function(c,b,g){if(!c){throw new Error(apf.formatErrorString(1018,null,"importing class","Could not load reference. Reference is null"));}if(!b){return apf.jsexec(c.toString(),g);}var d=c.toString().replace(/^\s*function\s*\w*\s*\([^\)]*\)\s*\{/,"").replace(/\}\s*$/,"");return apf.jsexec(d,g);},toString:function(){return"[Ajax.org Platform (apf)]";},all:[],implement:function(d){if(arguments.length==1){if(!d){throw new Error(apf.formatErrorString(0,this,"Implementing class","Could not implement from '"+d[g]+"'",this));}d.call(this);}else{for(var c,g=0,b=arguments.length;g<b;g++){c=arguments[g];if(!c){throw new Error(apf.formatErrorString(0,this,"Implementing class","Could not implement from '"+arguments[g]+"'",this));}arguments[g].call(this);}}return this;},uniqueHtmlIds:0,setUniqueHtmlId:function(b){var c;b.setAttribute("id",c="q"+this.uniqueHtmlIds++);return c;},getUniqueId:function(){return this.uniqueHtmlIds++;},lookup:function(b){return this.all[b];},findHost:function(c){while(c&&c.parentNode){try{if(c.host||c.host===false){break;}}catch(b){}c=c.parentNode;}return(c&&c.host&&typeof c.host!="string")?c.host:false;},setReference:function(b,c){return self[b]&&self[b].hasFeature?0:(self[b]=c);},console:{data:{time:{messages:{}},log:{messages:{}},custom:{messages:{}},warn:{messages:{}},error:{messages:{}},repeat:{messages:{}}},toggle:function(d,j){var b=apf.$debugwin?apf.$debugwin.resPath:apf.basePath+"core/debug/resources/";if(d.style.display=="block"){d.style.display="none";d.parentNode.style.backgroundImage="url("+b+"splus.gif)";d.innerHTML="";}else{d.style.display="block";d.parentNode.style.backgroundImage="url("+b+"smin.gif)";d.innerHTML=this.cache[j].replace(/\&/g,"&amp;").replace(/\t/g,"&nbsp;&nbsp;&nbsp;").replace(/ /g,"&nbsp;").replace(/\</g,"&lt;").replace(/\n/g,"<br />");var g=d.parentNode.parentNode.parentNode,c=d.parentNode.parentNode;if(g.scrollTop+g.offsetHeight<c.offsetTop+c.offsetHeight){g.scrollTop=c.offsetTop+c.offsetHeight-g.offsetHeight;}}},cache:[],history:[],typeLut:{time:"log",repeat:"log"},$lastmsg:"",$lastmsgcount:0,$detectSameMessage:function(){apf.console.$lastmsg="";if(apf.console.$lastmsgcount){var b=apf.console.$lastmsgcount+" times the same message";apf.console.$lastmsgcount=0;apf.console.write(b,"repeat");clearTimeout(apf.console.$timer);}},teleportList:[],teleport:function(b){if(this.teleportModel){b.setXml(this.teleportModel.data);}this.teleportList.push(b);},setTeleportModel:function(d){if(this.teleportModel==d){return;}this.teleportModel=d;var b=apf.getXml("<teleport />");for(var c=0;c<this.teleportList.length;c++){this.teleportList[c].setXml(b);}d.load(b);},write:function(d,q,n,m,o,k){clearTimeout(this.$timer);if(d==this.$lastmsg){this.$lastmsgcount++;this.$timer=$setTimeout(this.$detectSameMessage,1000);return;}this.$detectSameMessage();this.$lastmsg=d;this.$timer=$setTimeout(this.$detectSameMessage,1000);if(!Number.prototype.toPrettyDigit){Number.prototype.toPrettyDigit=function(){var r=this.toString();return(r.length==1)?"0"+r:r;};}var c=new Date(),b=String(c.getMilliseconds());while(b.length<3){b+="0";}var g=c.getHours().toPrettyDigit()+":"+c.getMinutes().toPrettyDigit()+":"+c.getSeconds().toPrettyDigit()+"."+b;d=(!k?"<span class='console_date'>["+g+"]</span> ":"")+String(d).replace(/(<[^>]+>)| /g,function(s,r,t){if(r){return r;}return"&nbsp;";}).replace(/\t/g,"&nbsp;&nbsp;&nbsp;");var j=apf.$debugwin&&apf.$debugwin.resPath?apf.$debugwin.resPath:apf.basePath+"core/debug/resources/";if(m){d+="<blockquote style='margin:2px 0 0 0;background:url("+j+"splus.gif) no-repeat 2px 3px'><strong style='width:120px;cursor:default;display:block;padding:0 0 0 17px' onmousedown='(self.apf || window.opener.apf).console.toggle(this.nextSibling, "+(this.cache.push(m)-1)+")'>More information</strong><div style='display:none;background-color:#EEEEEE;padding:3px 3px 20px 3px;overflow:auto;max-height:200px'></div></blockquote>";}d="<div class='console_line console_"+q+"' >"+d+"</div>";if(!n){n="default";}this.history.push([this.typeLut[q]||q,d]);if(this.win&&!this.win.closed){this.showWindow(d);}this.debugInfo.push(d);if(apf.dispatchEvent){apf.dispatchEvent("debug",{message:d,type:q});}},clear:function(){this.history=[];},getAll:function(k,g,j){var m={error:k,warn:g,log:j,custom:1};var c=[];for(var d=0,b=this.history.length;d<b;d++){if(m[this.history[d][0]]){c.push(this.history[d][1]);}}return c.join("");},debug:function(d,b,c){this.write(d,"time",b,c);},time:function(d,b,c){this.write(d,"time",b,c);},log:function(d,b,c){this.write(apf.htmlentities(d).replace(/\n/g,"<br />"),"log",b,c);},info:function(d,b,c){this.log(apf.htmlentities(d).replace(/\n/g,"<br />"),b,c);},warn:function(d,b,c){this.write(apf.htmlentities(d).replace(/\n/g,"<br />"),"warn",b,c);},error:function(d,b,c){this.write(d.replace(/\n/g,"<br />"),"error",b,c);},dir:function(c){var b=apf.$debugwin.$serializeObject(c,"Inspected via apf.console.dir");if(typeof b=="string"){this.write(b,"custom",null,null,null,true);}else{this.write(c?"Could not serialize object: "+b.message:c,"error",null,null,null,true);}},debugInfo:[],debugType:"",showWindow:function(b){if(!this.win||this.win.closed){this.win=window.open("","debug");this.win.document.write('<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><body style="margin:0;font-family:Verdana;font-size:8pt;"></body>');}if(!this.win){if(!this.haspopupkiller){alert("Could not open debug window, please check your popupkiller");}this.haspopupkiller=true;}else{this.win.document.write((b||this.debugInfo.join("")).replace(/\{imgpath\}/g,apf.debugwin?apf.debugwin.resPath:apf.basePath+"core/debug/resources/"));}}},htmlentities:function(b){return b;},formatErrorString:function(k,n,d,t,m,c,g){var o=[];if(m&&m.ownerDocument){if(m.nodeType==9){m=m.documentElement;}if(m.ownerDocument.documentElement){var j=m.ownerDocument.documentElement.getAttribute("filename");if(!j&&m.ownerDocument.documentElement.tagName=="html"){j=location.href;}j=j?apf.removePathContext(apf.hostPath,j):"Unkown filename";}else{j="Unknown filename";}if(apf.$debugwin){var s=apf.$debugwin.$serializeObject(m);}else{var s=(m.outerHTML||m.xml||m.serialize()).replace(/\<\?xml\:namespace prefix = j ns = "http\:\/\/ajax.org\/2005\/aml" \/\>/g,"").replace(/xmlns:a="[^"]*"\s*/g,"");}var r,b=0,q=m.previousSibling||m.parentNode&&m.parentNode.previousSibling;while(q&&q[apf.TAGNAME]!="body"){r=(q.outerHTML||q.xml||q.serialize()).split("\n").length;b+=r-1;q=q.previousSibling||q.parentNode&&q.parentNode.previousSibling;}if(q&&q[apf.TAGNAME]!="body"){b="unknown";}else{if(m.ownerDocument&&m.ownerDocument.documentElement.tagName=="html"){b+=apf.lineBodyStart;}}o.push("aml file: [line: "+b+"] "+j);}if(n){o.push("Element: "+(apf.$debugwin&&!apf.isDebugWindow?apf.$debugwin.$serializeObject(n):"'"+(n.name||(n.$aml?n.getAttribute("id"):null)||"{Anonymous}")+"' ["+n.tagName+"]"));}if(d){o.push("Process: "+d.replace(/ +/g," "));}if(t){o.push("Message: ["+k+"] "+t.replace(/ +/g," "));}if(c){o.push(c+": "+g);}if(m&&s){o.push("Related Markup: "+s);}return(apf.lastErrorMessage=o.join("\n"));},getDirname:function(b){return((b||"").match(/^([^#]*\/)[^\/]*(?:$|\#)/)||{})[1];},getFilename:function(b){return((b||"").split("?")[0].match(/(?:\/|^)([^\/]+)$/)||{})[1];},getAbsolutePath:function(c,b){return b&&b.charAt(0)=="/"?b:(!b||!c||b.match(/^\w+\:\/\//)?b:c.replace(/\/$/,"")+"/"+b.replace(/^\//,""));},include:function(g,b,k,m,n){if(apf.started){apf.console.info("including js file: "+g);}var c=b?apf.getAbsolutePath(apf.basePath||"",g):g;var j=document.getElementsByTagName("head")[0],d=document.createElement("script");if(k){d.setAttribute("_apf_type",k);}if(m){d.text=m;}else{d.src=c;}j.appendChild(d);if(n){d[apf.isIE?"onreadystatechange":"onload"]=n;}return d;},$required:[],require:function(){var c=apf.getDirname(location.href),d=0,b=arguments.length;for(;d<b;d++){this.$required.push(apf.getAbsolutePath(c,arguments[d]));}},Init:{queue:[],cond:{combined:[]},done:{},add:function(b,c){if(this.inited){b.call(c);}else{if(b){this.queue.push([b,c]);}}},addConditional:function(c,d,b){if(typeof b!="string"){if(this.checkCombined(b)){return c.call(d);}this.cond.combined.push([c,d,b]);}else{if(self[b]){c.call(d);}else{if(!this.cond[b]){this.cond[b]=[];}this.cond[b].push([c,d]);this.checkAllCombined();}}},checkAllCombined:function(){for(var b=0;b<this.cond.combined.length;b++){if(!this.cond.combined[b]){continue;}if(this.checkCombined(this.cond.combined[b][2])){this.cond.combined[b][0].call(this.cond.combined[b][1]);this.cond.combined[b]=null;}}},checkCombined:function(b){for(var c=0;c<b.length;c++){if(!this.done[b[c]]){return false;}}return true;},run:function(b){this.inited=this.done[b]=true;this.checkAllCombined();var d=b?this.cond[b]:this.queue;if(!d){return;}for(var c=0;c<d.length;c++){d[c][0].call(d[c][1]);}}},parseStrategy:0,parseAppMarkup:function(b){var c=false;if(c&&document.documentElement.outerHTML.split(">",1)[0].indexOf(apf.ns.aml)==-1){apf.console.warn("The aml namespace declaration wasn't found. No aml elements were found in the body. Exiting");return false;}if(this.parseStrategy==21||!this.parseStrategy&&!b){return apf.oHttp.get((apf.alternativeAml||document.body&&document.body.getAttribute("xmlurl")||location.href).split(/#/)[0],{type:"markup",callback:function(m,k,d){if(k!=apf.SUCCESS){var o=new Error(apf.formatErrorString(0,null,"Loading XML application data","Could not load XML from remote source: "+d.message));if(d.tpModule.retryTimeout(d,k,null,o)===true){return true;}throw o;}apf.lineBodyStart=(m.replace(/\n/g,"\\n").match(/(.*)<body/)||[""])[0].split("\\n").length;var n=m.replace(/\<\!DOCTYPE[^>]*>/,"").replace(/^[\r\n\s]*/,"");if(!apf.supportNamespaces){n=n.replace(/xmlns\=\"[^"]*\"/g,"");}if(self.ERROR_HAS_OCCURRED){return;}if(apf.isIE){document.body.innerHTML="";}else{var g=document.body.childNodes;for(var j=g.length-1;j>=0;j--){g[j].parentNode.removeChild(g[j]);}}document.documentElement.style.display="block";document.body.style.display="block";apf.initialize(n);},ignoreOffline:true});}else{document.body.style.display="block";if(!self.ERROR_HAS_OCCURRED){apf.initialize(b.outerHTML||b.xml);}}},namespaces:{},setNamespace:function(b,c){this.namespaces[b]=c;c.namespaceURI=b;},initialize:function(c){if(apf.initialized){return;}apf.initialized=true;apf.console.info("Initializing...");clearInterval(apf.Init.interval);apf.Init.run();var b=parseFloat(apf.getStyle(document.body,"marginTop"));apf.doesNotIncludeMarginInBodyOffset=(document.body.offsetTop!==b);apf.window.init(c);},execDeferred:function(){var b=apf.load_events.length;while(b--){(apf.load_events.shift())();}},load_events:[],load_timer:null,load_done:false,load_init:null,addDomLoadEvent:function(k){if(!this.$bdetect){this.browserDetect();}if(apf.load_done){return k();}if(!apf.load_init){apf.load_init=function(){if(apf.load_done){return;}clearInterval(apf.load_timer);apf.load_timer=null;apf.load_done=true;if(apf.started){apf.execDeferred();}};}apf.load_events.push(k);if(k&&apf.load_events.length==1){var m=document,d="undefined";if((typeof m.readyState!=d&&m.readyState=="complete")||(typeof m.readyState==d&&(m.getElementsByTagName("body")[0]||m.body))){return apf.load_init();}if(m.addEventListener&&!apf.isOpera){window.addEventListener("DOMContentLoaded",apf.load_init,false);}else{if(apf.isIE&&window==top){apf.load_timer=setInterval(function(){try{m.documentElement.doScroll("left");}catch(n){$setTimeout(arguments.callee,0);return;}apf.load_init();},10);}else{if(apf.isOpera){m.addEventListener("DOMContentLoaded",function(){apf.load_timer=setInterval(function(){for(var o=0,n=m.styleSheets.length;o<n;o++){if(m.styleSheets[o].disabled){return;}}apf.load_init();},10);},false);}else{if(apf.isWebkit&&!apf.isIphone){var j=m.getElementsByTagName("link"),c=j.length,g;for(;c>=0;c++){if(!j[c]||j[c].getAttribute("rel")!="stylesheet"){j.splice(c,0);}}g=j.length;apf.load_timer=setInterval(function(){if(/loaded|complete/.test(m.readyState)&&m.styleSheets.length==g){apf.load_init();}},10);}else{var b=window.onload;window.onload=function(){apf.load_init();if(b){b();}};}}}}}},fireEvent:function(d,c,g,b){if(d.dispatchEvent){d.dispatchEvent(c,g,b);}else{d.fireEvent("on"+c,g);}},addListener:function(d,c,b){if(d.addEventListener){d.addEventListener(c,b,false);}else{if(d.attachEvent){d.attachEvent("on"+c,b);}}return this;},removeListener:function(d,c,b){if(d.removeEventListener){d.removeEventListener(c,b,false);}else{if(d.detachEvent){d.detachEvent("on"+c,b);}}return this;},stopEvent:function(b){this.stopPropagation(b).preventDefault(b);return false;},stopPropagation:function(b){if(b.stopPropagation){b.stopPropagation();}else{b.cancelBubble=true;}return this;},preventDefault:function(b){if(b.preventDefault){b.preventDefault();}else{b.returnValue=false;}return this;},unload:function(c){apf.console.info("Initiating self destruct...");this.isDestroying=true;this.popup.destroy();var g,d=0,b=this.all.length;for(;d<b;d++){g=this.all[d];if(g&&g!=c&&g.destroy&&!g.apf){g.destroy(false);}}for(d=0,b=this.availHTTP.length;d<b;d++){this.availHTTP[d]=null;}this.availHTTP.length=0;if(apf.xmldb){apf.xmldb.unbind(apf.window);}this.isDestroying=false;}};var $xmlns=function(c,b,g,d){if(!apf.supportNamespaces){if(!d){d=apf.findPrefix(c,g);}if(c.style||c==document){return c.getElementsByTagName(b);}else{if(d){(c.nodeType==9?c:c.ownerDocument).setProperty("SelectionNamespaces","xmlns:"+d+"='"+g+"'");}return c.selectNodes(".//"+(d?d+":":"")+b);}}return c.getElementsByTagNameNS(g,b);};var $setTimeout=setTimeout;var $setInterval=setInterval;apf.setTimeout=function(c,b){apf.$eventDepth++;return $setTimeout(function(){c();if(--apf.$eventDepth==0){apf.queue.empty();}},b);};document.documentElement.className+=" has_apf";document.documentElement.style.display="none";apf.browserDetect();apf.Init.run("apf");apf.getShortestPath=function(j,g){if(j.charAt(0)=="/"){return j;}var d=j.split("/");var b=g.split("/");b.pop();for(var c=0;c<d.length;c++){if(d[0]==".."){b.pop();d.shift();}else{break;}}return b.join("/")+"/"+d.join("/");};if(!apf.basePath){var snodes=document.getElementsByTagName("script");for(var src,i=0;i<snodes.length;i++){src=snodes[i].getAttribute("src");if(src&&src.match(/^(.*)apf(?:_debug|_release)?\.js$/)){apf.basePath=RegExp.$1;break;}}apf.basePath=apf.basePath?apf.getShortestPath(apf.basePath,apf.getDirname(location.href)):"./";}apf.Class=function(){};apf.Class.prototype=new (function(){var FUN="function",OBJ="object",UNDEF="undefined",SEL="model",PROP="prop.",MODEL="model",VALUE="value";this.$regbase=0;this.hasFeature=function(test){return this.$regbase&test;};this.$initStack=[];this.$bufferEvents=[];this.$init=function(callback,nodeFunc,struct){if(typeof callback==FUN||callback===true){this.$bufferEvents=this.$bufferEvents.slice();if(callback===true){return this;}this.$initStack=this.$initStack.slice();this.$initStack.push(callback);return this;}this.addEventListener=realAddEventListener;if(this.nodeType!=2){this.$uniqueId=apf.all.push(this)-1;}this.$captureStack={};this.$eventsStack={};this.$funcHandlers={};var i=0,l=this.$initStack.length;for(;i<l;i++){this.$initStack[i].apply(this,arguments);}for(i=0,l=this.$bufferEvents.length;i<l;i++){this.addEventListener.apply(this,this.$bufferEvents[i]);}delete realAddEventListener;delete this.$initStack;delete this.$bufferEvents;if(struct&&struct.htmlNode){this.$pHtmlNode=struct.htmlNode;this.ownerDocument.$domParser.$continueParsing(this);apf.queue.empty();}return this;};this.implement=apf.implement;this.$handlePropSet=function(prop,value){this[prop]=value;};this.$bindProperty=function(myProp,bObject,bProp,fParsed){if(!fParsed){return bObject.$handlePropSet(bProp,this[myProp]);}var eventName=PROP+myProp,eFunc,isBeingCalled,isLang;(this.$eventsStack[eventName]||(this.$eventsStack[eventName]=[])).push(eFunc=function(e){if(isBeingCalled){return;}isBeingCalled=true;try{if(fParsed.asyncs){return fParsed.call(bObject,bObject.xmlRoot,function(value){bObject.setProperty(bProp,value,true,false,10);isBeingCalled=false;});}else{var value=fParsed.call(bObject,bObject.xmlRoot);}}catch(e){apf.console.warn("[331] Could not execute binding for property "+bProp+"\n\n"+e.message);isBeingCalled=false;return;}bObject.setProperty(bProp,value,true,false,10);isBeingCalled=false;});return eFunc;};this.$attrExcludePropBind=false;this.$setDynamicProperty=function(prop,pValue){var exclNr=this.$attrExcludePropBind[prop],options;if(SEL.indexOf(prop)>-1||exclNr==3){options={xpathmode:2};}else{if(exclNr==2){options={nostring:true};}else{if(exclNr===0){options={parsecode:true,nothrow:this.target.match(/-debug$/)?true:false};}}}if(apf.config.debugLm){(options||(options={})).nothrow=true;}if(pValue&&pValue.dataType==apf.FUNCTION){var fParsed=pValue;pValue="";}else{var fParsed=apf.lm.compile(pValue,options);}if(prop==MODEL){(this.$modelParsed=fParsed).instruction=pValue;}else{if(exclNr===0){this.$lastFParsed=fParsed;}}if(fParsed.type==2){this[prop]=!pValue;return this.setProperty(prop,fParsed.str);}if(exclNr==2||fParsed.xpaths.length&&exclNr!=1){if(!this.hasFeature(apf.__DATABINDING__)){this.implement(apf.StandardBinding);}this.$addAttrBind(prop,fParsed,pValue);}var matches=exclNr&&exclNr!=3&&prop!=MODEL?{}:fParsed.props,found=false,_self=this,o,node,bProp,p;for(p in matches){o=p.split(".");if(o.length>2){bProp=o.pop();try{node=eval(o.join("."));}catch(e){if(arguments[2]){apf.console.warn("[287] Could not execute binding test : "+pValue.replace(/</g,"&lt;")+"\n\n"+e.message);}else{apf.queue.add(prop+":"+this.$uniqueId,function(){_self.$clearDynamicProperty(prop);_self.$setDynamicProperty(prop,pValue,true);});}continue;}if(!node||typeof node!=OBJ||(!node.$regbase&&node.$regbase!==0)){bProp=o[1];node=self[o[0]];}else{o.push(bProp);}}else{bProp=o[1];node=self[o[0]]||o[0]=="this"&&this;}if(!node){if(arguments[2]){apf.console.warn("[287] Could not execute binding test : "+pValue.replace(/</g,"&lt;")+"\n\n"+o[0]+" does not exist");}else{apf.queue.add(prop+":"+this.$uniqueId,function(){_self.$clearDynamicProperty(prop);_self.$setDynamicProperty(prop,pValue,true);});return;}}if(!node.$bindProperty){continue;}if(!this.$funcHandlers[prop]){this.$funcHandlers[prop]=[];}this.$funcHandlers[prop].push({amlNode:node,prop:bProp,handler:node.$bindProperty(bProp,this,prop,fParsed)});found=true;}if(found){this.$funcHandlers[prop][0].handler({initial:true});}else{if(exclNr){return this.setProperty(prop,pValue);}try{if(fParsed.asyncs){return fParsed.call(this,this.xmlRoot,function(value){_self.setProperty(prop,value,true);});}else{var value=fParsed.call(this,this.xmlRoot);}}catch(e){apf.console.warn("[331] Could not execute binding test or: "+pValue.replace(/</g,"&lt;")+"\n\n"+e.message);return;}this[prop]=!value;this.setProperty(prop,value,true);}};this.$clearDynamicProperty=function(prop){if(this.$removeAttrBind){this.$removeAttrBind(prop);}if(prop==MODEL){this.$modelParsed=null;}var f,i,l,h=this.$funcHandlers[prop];if(h&&typeof h!=FUN){for(i=0,l=h.length;i<l;i++){(f=h[i]).amlNode.removeEventListener(PROP+f.prop,f.handler);}delete this.$funcHandlers[prop];}};this.watch=function(propName,callback){var eventName=PROP+propName,wrapper=function(e){callback.call(this,propName,e.oldvalue,e.value);};wrapper.callback=callback;(this.$eventsStack[eventName]||(this.$eventsStack[eventName]=[])).push(wrapper);};this.unwatch=function(propName,callback){var list,eventName=PROP+propName;if(!(list=this.$eventsStack[eventName])){return;}for(var i=0,l=list.length;i<l;i++){if(list[i].callback==callback){list.remove(i);return;}}};this.getAvailableProperties=function(){return this.$supportedProperties.slice();};this.setProperty=function(prop,value,forceOnMe,setAttr,inherited){var s,r,arr,e,i,l,oldvalue=this[prop],eventName=PROP+prop;try{var isChanged=(typeof value==OBJ)?value!=(typeof oldvalue==OBJ?oldvalue:null):String(oldvalue)!==String(value);}catch(e){var isChanged=true;}if(isChanged){if(!forceOnMe){if(this.xmlRoot&&typeof value!=OBJ&&(!(s=this.$attrExcludePropBind[prop]))&&(r=(this.$attrBindings&&this.$attrBindings[prop]||prop!=VALUE&&this.$bindings[prop]&&this.$bindings[prop][0]))){if(r.cvalue.type==3){return apf.setNodeValue(this.$getDataNode(prop.toLowerCase(),this.xmlRoot,true),value,true);}}}if(this.$handlePropSet(prop,value,forceOnMe)===false){return;}value=this[prop];if(setAttr){this.setAttribute(prop,value,true);}}if(arr=this.$eventsStack[eventName]){if(this.dispatchEvent(eventName,{prop:prop,value:value,oldvalue:oldvalue})===false){e.returnValue=false;}}if((aci||(aci=apf.config.$inheritProperties))[prop]&&this.$amlLoaded){if(inherited!=10&&!value){delete this.$inheritProperties[prop];if(this.$setInheritedAttribute(prop)){return;}}else{if(inherited!=10){this.$inheritProperties[prop]=inherited||-1;}}if((!e||e.returnValue!==false)&&this.childNodes){var inheritType=aci[prop];(function recur(nodes){var i,l,node,n;for(i=0,l=nodes.length;i<l;i++){node=nodes[i];if(node.nodeType!=1){continue;}if(inheritType==1&&!(n=node.$inheritProperties[prop])){recur(node.childNodes);}else{if(!(n<0)){node.setProperty(prop,value,false,false,2);}}}})(this.childNodes);}}return value;};var aci;this.getProperty=function(prop){return this[prop];};apf.$eventDepth=0;this.$eventDepth=0;this.dispatchEvent=function(eventName,options,e){var arr,result,rValue,i,l;apf.$eventDepth++;this.$eventDepth++;e=options&&options.name?options:e;if(options&&!options.bubbles&&options.currentTarget&&options.currentTarget!=this){throw new Error("Invalid use of options detected in dispatch Event");}if((!e||!e.currentTarget)&&(!options||!options.currentTarget)){if(!(options||(options={})).currentTarget){options.currentTarget=this;}if(arr=this.$captureStack[eventName]){for(i=0,l=arr.length;i<l;i++){rValue=arr[i].call(this,e||(e=new apf.AmlEvent(eventName,options)));if(typeof rValue!=UNDEF){result=rValue;}}}}if(options&&options.captureOnly){return e&&typeof e.returnValue!=UNDEF?e.returnValue:result;}else{if(this["on"+eventName]){result=this["on"+eventName].call(this,e||(e=new apf.AmlEvent(eventName,options)));}if(arr=this.$eventsStack[eventName]){for(i=0,l=arr.length;i<l;i++){if(!arr[i]){continue;}rValue=arr[i].call(this,e||(e=new apf.AmlEvent(eventName,options)));if(typeof rValue!=UNDEF){result=rValue;}}}}if((e&&e.bubbles&&!e.cancelBubble||!e&&options&&options.bubbles)&&this!=apf){rValue=(this.parentNode||this.ownerElement||apf).dispatchEvent(eventName,options,e);if(typeof rValue!=UNDEF){result=rValue;}}if(--apf.$eventDepth==0&&this.ownerDocument&&!this.ownerDocument.$domParser.$parseContext&&!apf.isDestroying&&eventName!="debug"&&apf.queue){apf.queue.empty();}this.$eventDepth--;if(options){delete options.currentTarget;}return e&&typeof e.returnValue!=UNDEF?e.returnValue:result;};this.addEventListener=function(a,b,c){this.$bufferEvents.push([a,b,c]);};var realAddEventListener=function(eventName,callback,useCapture){if(eventName.substr(0,2)=="on"){eventName=eventName.substr(2);}var s,stack=useCapture?this.$captureStack:this.$eventsStack;if(!(s=stack[eventName])){s=stack[eventName]=[];}if(s.indexOf(callback)==-1){s.unshift(callback);}var f;if(f=this.$eventsStack["$event."+eventName]){f[0].call(this,callback);}};this.removeEventListener=function(eventName,callback,useCapture){var stack=(useCapture?this.$captureStack:this.$eventsStack)[eventName];if(stack){if(this.$eventDepth){((useCapture?this.$captureStack:this.$eventsStack)[eventName]=stack.slice()).remove(callback);}else{stack.remove(callback);}}};this.hasEventListener=function(eventName){return(this.$eventsStack[eventName]&&this.$eventsStack[eventName].length>0);};this.destroy=function(deep,clean){if(typeof this.$uniqueId==UNDEF&&this.nodeType!=2){return;}this.$amlLoaded=false;this.$amlDestroyed=true;if(this.$destroy){this.$destroy();}this.dispatchEvent("DOMNodeRemoved",{bubbles:!apf.isDestroying});this.dispatchEvent("DOMNodeRemovedFromDocument");apf.all[this.$uniqueId]=undefined;if(!this.nodeFunc&&this.nodeType!=2){try{if(this.id||this.name){self[this.id||this.name]=null;}}catch(ex){}return;}if(this.$ext&&!this.$ext.isNative&&this.$ext.nodeType==1&&this.localName!="a"){this.$ext.oncontextmenu=this.$ext.host=null;if(clean){if(this.localName!="collection"){this.$ext.parentNode.removeChild(this.$ext);}}}if(this.$int&&!this.$int.isNative&&this.$int.nodeType==1&&this.localName!="a"){this.$int.host=null;}this.$aml=null;if(deep&&this.childNodes){var nodes=this.childNodes;for(i=nodes.length-1;i>=0;i--){if(nodes[i].destroy){nodes[i].destroy(true,clean&&this.localName=="collection");}}this.childNodes=null;}if(this.parentNode&&this.removeNode){this.removeNode();}else{if(this.ownerElement&&!this.ownerElement.$amlDestroyed){this.ownerElement.removeAttributeNode(this);}}if(this.$focussable&&this.focussable){apf.window.$removeFocus(this);}if(this.attributes){var attr=this.attributes;for(var i=attr.length-1;i>=0;i--){this.$clearDynamicProperty(attr[i].nodeName);attr[i].destroy();}}if(deep!==false&&this.childNodes&&this.childNodes.length){apf.console.warn("You have destroyed an Aml Node without destroying it's children. Please be aware that if you don't maintain a reference, memory might leak");}try{if(this.id||this.name){self[this.id||this.name]=null;}}catch(ex){}apf.nameserver.remove(this.localName,this);};})();apf.extend(apf,new apf.Class().$init());apf.Init.run("class");apf.color={colors:{aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgrey:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},fixHSB:function(b){return{h:Math.min(360,Math.max(0,b.h)),s:Math.min(100,Math.max(0,b.s)),b:Math.min(100,Math.max(0,b.b))};},fixRGB:function(b){return{r:Math.min(255,Math.max(0,b.r)),g:Math.min(255,Math.max(0,b.g)),b:Math.min(255,Math.max(0,b.b))};},fixHex:function(d){var b=6-d.length;if(b>0){var g=[],c=0;for(;c<b;c++){g.push("0");}g.push(d);d=g.join("");}return d;},hexToRGB:function(b){b=parseInt(((b.indexOf("#")>-1)?b.substring(1):b),16);return{r:b>>16,g:(b&65280)>>8,b:(b&255)};},hexToHSB:function(b){return this.RGBToHSB(this.hexToRGB(b));},RGBToHSB:function(d){var c={h:0,s:0,b:0};var g=Math.min(d.r,d.g,d.b),b=Math.max(d.r,d.g,d.b),j=b-g;c.b=b;if(b!=0){}c.s=b!=0?255*j/b:0;if(c.s!=0){if(d.r==b){c.h=(d.g-d.b)/j;}else{if(d.g==b){c.h=2+(d.b-d.r)/j;}else{c.h=4+(d.r-d.g)/j;}}}else{c.h=-1;}c.h*=60;if(c.h<0){c.h+=360;}c.s*=100/255;c.b*=100/255;return c;},HSBToRGB:function(b){var d={},m=Math.round(b.h),k=Math.round(b.s*255/100),c=Math.round(b.b*255/100);if(k==0){d.r=d.g=d.b=c;}else{var n=c,j=(255-k)*c/255,g=(n-j)*(m%60)/60;if(m==360){m=0;}if(m<60){d.r=n,d.b=j,d.g=j+g;}else{if(m<120){d.g=n,d.b=j,d.r=n-g;}else{if(m<180){d.g=n,d.r=j,d.b=j+g;}else{if(m<240){d.b=n,d.r=j,d.g=n-g;}else{if(m<300){d.b=n,d.g=j,d.r=j+g;}else{if(m<360){d.r=n,d.g=j,d.b=n-g;}else{d.r=0,d.g=0,d.b=0;}}}}}}}return{r:Math.round(d.r),g:Math.round(d.g),b:Math.round(d.b)};},RGBToHex:function(b){var d=[b.r.toString(16),b.g.toString(16),b.b.toString(16)],c=0;for(;c<3;c++){if(d[c].length==1){d[c]="0"+d[c];}}return d.join("");},HSBToHex:function(b){return this.RGBToHex(this.HSBToRGB(b));}};if(typeof isFinite=="undefined"){function isFinite(b){return b+1!=b;}}apf.NUMBER=1;apf.BOOLEAN=2;apf.STRING=3;apf.ARRAY=4;apf.DATE=5;apf.REGEXP=6;apf.FUNCTION=7;Array.prototype.dataType=apf.ARRAY;Number.prototype.dataType=apf.NUMBER;Date.prototype.dataType=apf.DATE;Boolean.prototype.dataType=apf.BOOLEAN;String.prototype.dataType=apf.STRING;RegExp.prototype.dataType=apf.REGEXP;Function.prototype.dataType=apf.FUNCTION;apf.getCgiString=function(b,g,d){var k=[];function j(q,m){var r;if(apf.isArray(q)){for(var n=0;n<q.length;n++){j(q[n],m+"%5B%5D");}}else{if(typeof q=="object"){for(r in q){if(apf.isSafariOld&&(!q[r]||typeof p[r]!="object")){continue;}if(typeof q[r]=="function"){continue;}j(q[r],m+"%5B"+encodeURIComponent(r)+"%5D");}}else{k.push(m+"="+encodeURIComponent(q));}}}if(g){k.push("func="+d);for(var c=0;c<b[0].length;c++){j(b[0][c],"f%5B"+c+"%5D");}}else{for(prop in b){if(apf.isSafariOld&&(!b[prop]||typeof b[prop]=="function")){continue;}j(b[prop],prop);}}return k.join("&");};apf.fromCgiString=function(c){if(!c){return false;}var n={};c=c.split("&");for(var k,g=0;g<c.length;g++){k=c[g].split("=");k[0]=decodeURIComponent(k[0]);var m=k[0].replace(/\]/g,"").split("[");var d=n;for(var b=0;b<m.length;b++){if(d[m[b]]){d=d[m[b]];}else{if(m.length==b+1){if(m[b]){d[m[b]]=decodeURIComponent(k[1]);}else{d.push(decodeURIComponent(k[1]));}break;}else{d[m[b]]=!m[b+1]?[]:{};d=d[m[b]];}}}}return n;};Function.prototype.extend=function(){apf.extend.apply(this,[this].concat(Array.prototype.slice.call(arguments)));return this;};Function.prototype.bindWithEvent=function(){var b=this,c=Array.prototype.slice.call(arguments),g=c.shift(),d=c.shift();return function(j){if(!j){j=window.event;}return b.apply(g,[j].concat(c).concat(Array.prototype.slice.call(arguments)));};};Array.prototype.copy=function(){var b=[];for(var d=0,c=this.length;d<c;d++){b[d]=this[d]&&this[d].copy?this[d].copy():this[d];}return b;};Array.prototype.merge=function(){for(var g=0,c=arguments.length;g<c;g++){for(var d=0,b=arguments[g].length;d<b;d++){this.push(arguments[g][d]);}}};Array.prototype.arrayAdd=function(){var m=this.copy();for(var g=0,c=arguments.length;g<c;g++){for(var d=0,b=m.length;d<b;d++){m[d]+=arguments[g][d];}}return m;};Array.prototype.equals=function(d){for(var c=0,b=this.length;c<b;c++){if(this[c]!=d[c]){return false;}}return true;};Array.prototype.makeUnique=function(){var b,d,c=[];for(b=0,d=this.length;b<d;b++){if(c.indexOf(this[b])==-1){c.push(this[b]);}}this.length=0;for(b=0,d=c.length;b<d;b++){this.push(c[b]);}return this;};Array.prototype.contains=function(b,c){return this.indexOf(b,c)!=-1;};Array.prototype.indexOf=Array.prototype.indexOf||function(d,g){var b=this.length;for(var c=(g<0)?Math.max(0,b+g):g||0;c<b;c++){if(this[c]===d){return c;}}return -1;};Array.prototype.lastIndexOf=Array.prototype.lastIndexOf||function(d,g){var b=this.length;for(var c=(g>=b)?b-1:(g<0)?g+b:b-1;c>=0;c--){if(this[c]===d){return c;}}return -1;};Array.prototype.pushUnique=function(){var d,c=0,b=arguments.length;for(;c<b;++c){d=arguments[c];if(this.indexOf(d)==-1){this.push(d);}}return this;};Array.prototype.search=function(){for(var c=0,d=arguments.length;c<d;c++){if(typeof this[c]!="array"){continue;}for(var b=0;b<d;b++){if(this[c][b]!=arguments[b]){break;}else{if(b==(d-1)){return this[c];}}}}};Array.prototype.each=Array.prototype.forEach=Array.prototype.forEach||function(d){for(var c=0,b=this.length;c<b;c++){d.call(this,this[c],c,this);}return this;};Array.prototype.remove=function(c){for(var b=this.length-1;b>=0;b--){if(this[b]!=c){continue;}this.splice(b,1);}return this;};Array.prototype.removeIndex=function(b){if(!this.length){return null;}return this.splice(b,1);};Array.prototype.insertIndex=function(c,b){this.splice(b,0,c);};Array.prototype.invert=Array.prototype.reverse=Array.prototype.reverse||function(){var b=this.length-1;for(var c,d=0;d<Math.ceil(0.5*b);d++){c=this[d];this[d]=this[b-d];this[b-d]=c;}return this;};Array.prototype.filter=Array.prototype.filter||function(g,j){var d=[];for(var c=0,b=this.length;c<b;c++){if(g.call(j,this[c],c,this)){d.push(this[c]);}}return d;};Array.prototype.every=Array.prototype.every||function(d,g){for(var c=0,b=this.length;c<b;c++){if(!d.call(g,this[c],c,this)){return false;}}return true;};Array.prototype.map=Array.prototype.map||function(g,j){var d=[];for(var c=0,b=this.length;c<b;c++){d[c]=g.call(j,this[c],c,this);}return d;};Array.prototype.some=Array.prototype.some||function(d,g){for(var c=0,b=this.length;c<b;c++){if(d.call(g,this[c],c,this)){return true;}}return false;};Number.prototype.toPrettyDigit=Number.prototype.toPrettyDigit||function(){var b=this.toString();return(b.length==1)?"0"+b:b;};RegExp.prototype.getNativeFlags=function(){return(this.global?"g":"")+(this.ignoreCase?"i":"")+(this.multiline?"m":"")+(this.extended?"x":"")+(this.sticky?"y":"");};RegExp.prototype.addFlags=function(b){return new RegExp(this.source,(b||"")+this.getNativeFlags());};String.prototype.uCaseFirst=function(){return this.substr(0,1).toUpperCase()+this.substr(1);};String.prototype.trim=function(){return this.replace(/[\s\n\r]*$/,"").replace(/^[\s\n\r]*/,"");};String.prototype.repeat=function(b){return Array(b+1).join(this);};String.prototype.count=function(b){return this.split(b).length-1;};String.prototype.stripTags=function(){return this.replace(/<\/?[^>]+>/gi,"");};String.prototype.escape=function(){return escape(this);};String.prototype.toXml=function(){var d=apf.getXml("<root>"+this+"</root>");if(d.childNodes.length==1){return d.childNodes[0];}else{var c=d.ownerDocument.createDocumentFragment(),b=d.childNodes;while(b.length){c.appendChild(b[0]);}return c;}};if(typeof window!="undefined"&&typeof window.document!="undefined"&&typeof window.document.createElement=="function"){String.prototype.escapeHTML=function(){this.escapeHTML.text.data=this;return this.escapeHTML.div.innerHTML;};String.prototype.unescapeHTML=function(){var d=document.createElement("div");d.innerHTML=this.stripTags();if(d.childNodes[0]){if(d.childNodes.length>1){var b=[];for(var c=0;c<d.childNodes.length;c++){b.push(d.childNodes[c].nodeValue);}return b.join("");}else{return d.childNodes[0].nodeValue;}}return"";};String.prototype.escapeHTML.div=document.createElement("div");String.prototype.escapeHTML.text=document.createTextNode("");String.prototype.escapeHTML.div.appendChild(String.prototype.escapeHTML.text);if("<\n>".escapeHTML()!=="&lt;\n&gt;"){String.prototype.escapeHTML=null;}if("&lt;\n&gt;".unescapeHTML()!=="<\n>"){String.prototype.unescapeHTML=null;}}if(!String.prototype.escapeHTML){String.prototype.escapeHTML=function(){return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");};}if(!String.prototype.unescapeHTML){String.prototype.unescapeHTML=function(){return this.stripTags().replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&");};}String.prototype.truncate=function(c,b){return this.length>=c?this.substring(0,c-(b?4:1))+(b?"...":""):this;};String.prototype.pad=function(b,d,c){return c?(this+Array(b).join(d)).slice(0,b):(Array(b).join(d)+this).slice(-b);};apf.PAD_LEFT=false;apf.PAD_RIGHT=true;String.prototype.splitSafe=function(d,b,c){return(c&&this.toLowerCase()||this).replace(/(?:^\s+|\n|\s+$)/g,"").split(new RegExp("[\\s ]*"+d+"[\\s ]*","g"),b||999);};String.prototype.appendRandomNumber=function(d){for(var b=[],c=1;c<=d;c++){b.push(apf.randomGenerator.generate(1,9));}return this.toString()+b.join("");};String.prototype.prependRandomNumber=function(d){for(var b=[],c=1;c<=d;c++){b.push(apf.randomGenerator.generate(1,9));}return b.join("")+this.toString();};String.prototype.sprintf=function(){var g=this.toString(),b=0,d=g.indexOf("%s");while(d>=0){var c=arguments[b++]||" ";g=g.substr(0,d)+c+g.substr(d+2);d=g.indexOf("%s");}return g;};apf.isJson=(function(){var c=/\\["\\\/bfnrtu@]/g,b=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,g=/(?:^|:|,)(?:\s*\[)+/g,d=/^[\],:{}\s]*$/;return function(j){if(!j){return false;}return d.test(j.replace(c,"@").replace(b,"]").replace(g,""));};})();if(!self.JSON){self.JSON=(function(){var j=new RegExp('(?:false|true|null|[\\{\\}\\[\\]]|(?:-?\\b(?:0|[1-9][0-9]*)(?:\\.[0-9]+)?(?:[eE][+-]?[0-9]+)?\\b)|(?:"(?:[^\\0-\\x08\\x0a-\\x1f"\\\\]|\\\\(?:["/\\\\bfnrt]|u[0-9A-Fa-f]{4}))*"))',"g"),q=new RegExp("\\\\(?:([^u])|u(.{4}))","g"),m={'"':'"',"/":"/","\\":"\\",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"},n=function(r,s,t){return s?m[s]:String.fromCharCode(parseInt(t,16));},c=new String(""),b="\\",k={"{":Object,"[":Array},d=Object.hasOwnProperty,o=function(r,t){r=t+r;return r.substring(r.length-t.length);},g={0:function(s){if(s.nodeType&&s.ownerDocument&&s.cloneNode(true)){return"apf.xmldb.getXml("+JSON.stringify(apf.getXmlString(s))+")";}var r=[];for(var t in s){r.push('"'+t.replace(/(["\\])/g,"\\$1")+'": '+JSON.stringify(s[t]));}return"{"+r.join(", ")+"}";},5:function(r){r='"'+r.replace(/(["\\])/g,"\\$1")+'"';return r.replace(/(\n)/g,"\\n").replace(/\r/g,"");},2:function(r){return r.toString();},4:function(r){return r.toString();},3:function(r){return'{"jsonclass":["sys.ISODate", ["'+o(r.getUTCFullYear(),"0000")+o(r.getUTCMonth()+1,"00")+o(r.getUTCDate(),"00")+"T"+o(r.getUTCHours(),"00")+":"+o(r.getUTCMinutes(),"00")+":"+o(r.getUTCSeconds(),"00")+'"]]}';},1:function(r){for(var t=[],s=0;s<r.length;s++){t.push(JSON.stringify(r[s]));}return"["+t.join(", ")+"]";},7:function(r){return;}};return{parse:function(C,u){var t=C.match(j),E;var D=t[0];if("{"==D){E={};}else{if("["==D){E=[];}else{throw new Error(D);}}var B,F,w=[E];for(var s=1,r=t.length;s<r;++s){D=t[s];switch(D.charCodeAt(0)){default:F=w[0];F[B||F.length]=+(D);B=void 0;break;case 34:D=D.substring(1,D.length-1);if(D.indexOf(b)!==-1){D=D.replace(q,n);}F=w[0];if(!B){if(F instanceof Array){B=F.length;}else{B=D||c;break;}}F[B]=D;B=void 0;break;case 91:F=w[0];w.unshift(F[B||F.length]=[]);B=void 0;break;case 93:w.shift();break;case 102:F=w[0];F[B||F.length]=false;B=void 0;break;case 110:F=w[0];F[B||F.length]=null;B=void 0;break;case 116:F=w[0];F[B||F.length]=true;B=void 0;break;case 123:F=w[0];w.unshift(F[B||F.length]={});B=void 0;break;case 125:w.shift();break;}}if(w.length){throw new Error();}if(u){var A=function(L,K){var M=L[K];if(M&&typeof M=="object"){var G=null;for(var I in M){if(d.call(M,I)&&M!==L){var H=A(M,I);if(H!==void 0){M[I]=H;}else{if(!G){G=[];}G.push(I);}}}if(G){for(var J=G.length;--J>=0;){delete M[G[J]];}}}return u.call(L,K,M);};E=A({"":E},"");}return E;},stringify:function(r){if(typeof args=="function"||apf.isNot(r)){return"null";}return g[r.dataType||0](r);}};})();}apf.serialize=function(b){return self.JSON.stringify(b);};apf.unserialize=function(b){if(!b){return b;}return self.JSON.parse(b);};apf.hotkeys={};apf.keyMods={ctrl:1,alt:2,shift:4,meta:8};apf.keyNames={"32":"Spacebar","13":"Enter","9":"Tab","27":"Esc","46":"Del","36":"Home","35":"End","107":"+","37":"Left Arrow","38":"Up Arrow","39":"Right Arrow","40":"Down Arrow","33":"Page Up","34":"Page Down","112":"F1","113":"F2","114":"F3","115":"F4","116":"F5","117":"F6","118":"F7","119":"F8","120":"F9","121":"F10","122":"F11","123":"F12"};apf.registerHotkey=function(b,g){var m=0,d;var k=b.splitSafe("\\-|\\+",null,true),j=false,n=false;for(var c=0;c<k.length;c++){if(apf.keyMods[k[c]]){m=m|apf.keyMods[k[c]];if(apf.isMac){j=(apf.keyMods[k[c]]===apf.keyMods.ctrl);n=(apf.keyMods[k[c]]===apf.keyMods.meta);}}else{d=k[c];}}if(j&&!n){m=m|apf.keyMods.meta;}if(!d){throw new Error("missing key for hotkey: "+b);}(apf.hotkeys[m]||(apf.hotkeys[m]={}))[d]=g;if(!apf.initHotkey){apf.initHotkey=true;apf.addEventListener("hotkey",function(s){if(apf.isMac&&s.metaKey){s.ctrlKey=true;}var r=0|(s.ctrlKey?1:0)|(s.shiftKey?4:0)|(s.metaKey?8:0);var o=apf.keyNames[s.keyCode];if(!r&&!o){return;}var q=(apf.hotkeys[r]||{})[(o||String.fromCharCode(s.keyCode)).toLowerCase()];if(q){q();s.returnValue=false;apf.queue.empty();}});}};apf.removeHotkey=function(b){apf.registerHotkey(b,null);};apf.setStyleRule=function(c,o,q,b,m){c=c.toLowerCase();if(!b){var k=(m||self).document.styleSheets;for(var d=k.length-1;d>=0;d--){try{var r=k[d][apf.styleSheetRules];for(var g=0;g<r.length;g++){if(r.item(g).selectorText.toLowerCase()==c){r.item(g).style[o]=q;return true;}}}catch(n){}}}else{var r=(m||self).document.styleSheets[b||0][apf.styleSheetRules];for(var g=0;g<r.length;g++){if(r.item(g).selectorText.toLowerCase()==c){r.item(g).style[o]=q;return true;}}}return false;};apf.getStyleRule=function(c,o,b,m){c=c.toLowerCase();if(!b){var k=(m||self).document.styleSheets;for(var d=k.length-1;d>=0;d--){try{var q=k[d][apf.styleSheetRules];for(var g=0;g<q.length;g++){if(q.item(g).selectorText.toLowerCase()==c){return q.item(g).style[o];}}}catch(n){}}}else{var q=(m||self).document.styleSheets[b||0][apf.styleSheetRules];for(var g=0;g<q.length;g++){if(q.item(g).selectorText.toLowerCase()==c){return q.item(g).style[o];}}}return false;};apf.setStyleClass=function(d,c,g,j){if(!d||j&&this.disabled){return;}if(d.nodeFunc){throw new Error(apf.formatErrorString(0,this,"Setting style class","Trying to set style class on aml node. Only xml or html nodes can              be passed to this function"));}if(c){if(g){g[g.length]=c;}else{g=[c];}}var b=new RegExp("(^| +)(?:"+(g?g.join("|"):"")+")","gi");d.className!=null?(d.className=d.className.replace(b," ")+(c?" "+c:"")):d.setAttribute("class",(d.getAttribute("class")||"").replace(b," ")+(c?" "+c:""));return d;};apf.importCssString=function(c,j,g){j=j||document;var d=j.getElementsByTagName("head")[0];if(!apf.supportOpacity){c=c.replace(/opacity[ \s]*\:[ \s]*([\d\.]+)/g,function(k,n){return"filter:progid:DXImageTransform.Microsoft.Alpha(opacity="+(n*100)+")";});}if(apf.canCreateStyleNode){var b=j.createElement("style");b.appendChild(j.createTextNode(c));if(g){b.setAttribute("media",g);}d.appendChild(b);}else{d.insertAdjacentHTML("beforeend",".<style media='"+(g||"all")+"'>"+c+"</style>");}};apf.getStyleRecur=function(b,d){var c=apf.hasComputedStyle?document.defaultView.getComputedStyle(b,"").getPropertyValue(d.replace(/([A-Z])/g,function(g,j){return"-"+j.toLowerCase();})):b.currentStyle[d];return((!c||c=="transparent"||c=="inherit")&&b.parentNode&&b.parentNode.nodeType==1)?this.getStyleRecur(b.parentNode,d):c;};apf.importStylesheet=function(c,d){for(var b=0;b<c.length;b++){if(!c[b][1]){continue;}if(apf.isIE){(d||window).document.styleSheets[0].addRule(c[b][0],c[b][1]);}else{(d||window).document.styleSheets[0].insertRule(c[b][0]+" {"+c[b][1]+"}",0);}}};apf.isInRect=function(c,b,g){var d=this.getAbsolutePosition(c);if(b<d[0]||g<d[1]||b>c.offsetWidth+d[0]-10||g>c.offsetHeight+d[1]-10){return false;}return true;};apf.getOverflowParent=function(b){b=b.offsetParent;while(b&&(this.getStyle(b,"overflow")!="hidden"||"absolute|relative".indexOf(this.getStyle(b,"position"))==-1)){b=b.offsetParent;}return b||document.documentElement;};apf.getPositionedParent=function(b){b=b.offsetParent;while(b&&b.tagName.toLowerCase()!="body"&&"absolute|relative".indexOf(this.getStyle(b,"position"))==-1){b=b.offsetParent;}return b||document.documentElement;};apf.getAbsolutePosition=function(c,n,d){if("getBoundingClientRect" in document.documentElement){if(apf.doesNotIncludeMarginInBodyOffset&&c==document.body){return[c.offsetLeft+(parseFloat(apf.getStyle(c,"marginLeft"))||0),+(c.scrollLeft||0),c.offsetTop+(parseFloat(apf.getStyle(c,"marginTop"))||0)+(c.scrollTop||0)];}var k=c.getBoundingClientRect(),w=k.top,g=k.left,s=(apf.isIE&&apf.isIE<8);if(n&&n!=document.body){var u=apf.getAbsolutePosition(n,null,true);w-=u[1];g-=u[0];}if(!(apf.isIE&&c==document.documentElement)){g+=document.body.scrollLeft||document.documentElement.scrollLeft||0;w+=document.body.scrollTop||document.documentElement.scrollTop||0;}if(d&&!n){g+=parseInt(apf.getStyle(c,"borderLeftWidth"))||0;w+=parseInt(apf.getStyle(c,"borderTopWidth"))||0;}return[g-(s?2:0),w-(s?2:0)];}var m=d?0:c.offsetLeft,A=d?0:c.offsetTop;c=d?c:c.offsetParent||c.parentNode;if(apf.isIE8&&n){t=this.getStyle(c,"borderLeftWidth");m-=(apf.isIE&&c.currentStyle.borderLeftStyle!="none"&&t=="medium"?2:parseInt(t)||0);j=this.getStyle(c,"borderTopWidth");A-=(apf.isIE&&c.currentStyle.borderTopStyle!="none"&&j=="medium"?2:parseInt(j)||0);}var t,j,B;while(c&&c!=n){t=apf.isOpera||apf.isIE8?0:this.getStyle(c,"borderLeftWidth");m+=(apf.isIE&&c.currentStyle.borderLeftStyle!="none"&&t=="medium"?2:parseInt(t)||0)+c.offsetLeft;if(apf.isIE&&!apf.isIE8&&apf.getStyle(c,"styleFloat")=="none"&&apf.getStyle(c,"position")=="relative"){var b=c.previousSibling;while(b){if(b.nodeType==1){B=apf.getStyle(b,"styleFloat");if(B=="left"){m-=parseInt(apf.getStyle(c,"marginLeft"))||0;break;}else{if(B=="right"){break;}}}b=b.previousSibling;}}j=apf.isOpera||apf.isIE8?0:this.getStyle(c,"borderTopWidth");A+=(apf.isIE&&c.currentStyle.borderTopStyle!="none"&&j=="medium"?2:parseInt(j)||0)+c.offsetTop;if(!apf.isGecko&&c!=n&&(c.tagName!="HTML"||c.ownerDocument!=document)){m-=c.scrollLeft;A-=c.scrollTop;}if(c.tagName.toLowerCase()=="table"){A-=parseInt(c.border||0)+parseInt(c.cellSpacing||0);m-=parseInt(c.border||0)+parseInt(c.cellSpacing||0)*2;}else{if(c.tagName.toLowerCase()=="tr"){var r;A-=(r=parseInt(c.parentNode.parentNode.cellSpacing));while(c.previousSibling){A-=(c=c.previousSibling).offsetHeight+r;}}}if(apf.isIE&&!c.offsetParent&&c.parentNode.nodeType==1){m-=c.parentNode.scrollLeft;A-=c.parentNode.scrollTop;}c=c.offsetParent;}return[m,A];};apf.getHorBorders=function(b){return Math.max(0,(parseInt(apf.getStyle(b,"borderLeftWidth"))||0)+(parseInt(apf.getStyle(b,"borderRightWidth"))||0));};apf.getVerBorders=function(b){return Math.max(0,(parseInt(apf.getStyle(b,"borderTopWidth"))||0)+(parseInt(apf.getStyle(b,"borderBottomWidth"))||0));};apf.getWidthDiff=function(b){return Math.max(0,(parseInt(apf.getStyle(b,"paddingLeft"))||0)+(parseInt(apf.getStyle(b,"paddingRight"))||0)+(parseInt(apf.getStyle(b,"borderLeftWidth"))||0)+(parseInt(apf.getStyle(b,"borderRightWidth"))||0));};apf.getHeightDiff=function(b){return Math.max(0,(parseInt(apf.getStyle(b,"paddingTop"))||0)+(parseInt(apf.getStyle(b,"paddingBottom"))||0)+(parseInt(apf.getStyle(b,"borderTopWidth"))||0)+(parseInt(apf.getStyle(b,"borderBottomWidth"))||0));};apf.getDiff=function(b){return[Math.max(0,(parseInt(apf.getStyle(b,"paddingLeft"))||0)+(parseInt(apf.getStyle(b,"paddingRight"))||0)+(parseInt(apf.getStyle(b,"borderLeftWidth"))||0)+(parseInt(apf.getStyle(b,"borderRightWidth"))||0)),Math.max(0,(parseInt(apf.getStyle(b,"paddingTop"))||0)+(parseInt(apf.getStyle(b,"paddingBottom"))||0)+(parseInt(apf.getStyle(b,"borderTopWidth"))||0)+(parseInt(apf.getStyle(b,"borderBottomWidth"))||0))];};apf.getMargin=function(b){return[Math.max(0,(parseInt(apf.getStyle(b,"marginLeft"))||0)+(parseInt(apf.getStyle(b,"marginRight"))||0)),Math.max(0,(parseInt(apf.getStyle(b,"marginTop"))||0)+(parseInt(apf.getStyle(b,"marginBottom"))||0))];};apf.getHtmlInnerWidth=function(b){return(b.offsetWidth-(parseInt(apf.getStyle(b,"borderLeftWidth"))||0)-(parseInt(apf.getStyle(b,"borderRightWidth"))||0));};apf.getHtmlInnerHeight=function(b){return(b.offsetHeight-(parseInt(apf.getStyle(b,"borderTopWidth"))||0)-(parseInt(apf.getStyle(b,"borderBottomWidth"))||0));};apf.getViewPort=function(c){c=c||window;var b=(!c.document.compatMode||c.document.compatMode=="CSS1Compat")?c.document.html||c.document.documentElement:c.document.body;return{x:c.pageXOffset||b.scrollLeft,y:c.pageYOffset||b.scrollTop,width:c.innerWidth||b.clientWidth,height:c.innerHeight||b.clientHeight};};apf.plane={init:function(){if(!this.plane){this.plane=document.createElement("DIV");document.body.appendChild(this.plane);this.plane.style.background="url(images/spacer.gif)";this.plane.style.position="fixed";this.plane.style.zIndex=100000000;this.plane.style.left=0;this.plane.style.top=0;}},lastCursor:null,show:function(n,j,g,d){this.init();var c=this.plane;if(n){this.current=n;if(!j){this.lastZ=this.current.style.zIndex;this.current.style.zIndex=100000;}else{this.plane.appendChild(n);}}var b=(c.parentNode==document.body?d?document.documentElement.offsetWidth:apf.getWindowWidth():c.parentNode.offsetWidth);var k=(c.parentNode==document.body?d?document.documentElement.offsetHeight:apf.getWindowHeight():c.parentNode.offsetHeight);if(g){if(this.lastCursor===null){this.lastCursor=document.body.style.cursor;}document.body.style.cursor=apf.getStyle(n,"cursor");}this.plane.style.display="block";var m=apf.getDiff(c.parentNode);this.plane.style.width=(b-m[0])+"px";this.plane.style.height=(k-m[1])+"px";return c;},hide:function(){if(!this.plane){return;}var b=apf.isChildOf(this.plane,document.activeElement);if(this.current){if(this.lastZ!==null){if(this.current.style.zIndex==100000){this.current.style.zIndex=this.lastZ;}this.lastZ=null;}if(this.current.parentNode==this.plane){this.plane.parentNode.appendChild(this.current);}}this.plane.style.display="none";if(b){if(!apf.isIE){document.activeElement.focus();}apf.document.activeElement.$focus();}this.current=null;if(this.lastCursor!==null){document.body.style.cursor=this.lastCursor;this.lastCursor=null;}return this.plane;}};apf.highlightXml=apf.highlightCode=function(j){var c=j.split(/\n\r?/);for(var g=1000,d=0,b=c.length;d<b;d++){g=Math.min(g,c[d].match(/^(\s+)?[^\s]/)&&RegExp.$1.length||1000);if(!g){break;}}j=j.replace(new RegExp("^ {"+g+"}","gm"),"").replace(/<!doctype([\s\S]+?)>|<!--([\s\S]+?)-->|<\?([\w\-]+)([\s\S]+?)\?>|<\!\[CDATA\[([\s\S]*?)\]\]>|<(\w+:)?script([\s\S]*?)>([\s\S]*?)<\/(?:\w+:)?script>|<([\/\w\:\-]+)([\s\S]*?)(\/?)>/g,function(q,s,t,r,w,A,k,u,C,o,B,n){if(s){return'<span style="color:gray">&lt;!doctype'+s.replace(/</g,"&lt;")+"&gt;</span>";}else{if(t){return'<span style="color:green">&lt;!--'+t.replace(/</g,"&lt;")+"--&gt;</span>";}else{if(r){return'<span style="color:orange">&lt;?'+r+"</span>"+apf.highlightJs(w,true)+'<span style="color:orange">?&gt;</span>';}else{if(A){return'<span style="color:gray">&lt;![CDATA['+A+"]]&gt;</span>";}else{if(k){return'<span style="color:#127ac6">&lt;'+k+"script"+(B?"</span>"+B.replace(/("[\s\S]*?")|([\w\-\:]+)/g,function(D,F,E){if(F){return F;}return'<span style="color:red">'+E+"</span>";})+'<span style="color:#127ac6">&gt;</span>':"&gt;</span>")+apf.highlightJs(C,true)+'<span style="color:#127ac6">&lt;/'+k+"script&gt;</span>";}else{if(o){return'<span style="color:#127ac6">&lt;'+(o.substr(0,2)=="a:"?"<a href='element."+o.substr(2)+"'>"+o+"</a>":o)+(B?"</span>"+B.replace(/("[\s\S]*?")|([\w\-\:]+)/g,function(D,F,E){if(F){return F;}return'<span style="color:red">'+E+"</span>";})+'<span style="color:#127ac6">'+n+"&gt;</span>":"&gt;</span>");}}}}}}});return j;};apf.removeStartWhitespaces=function(j){var c=j.split(/\n\r?/);for(var g=1000,d=0,b=c.length;d<b;d++){g=Math.min(g,c[d].match(/^(\s+)?[^\s]/)&&RegExp.$1.length||1000);if(!g){break;}}return j.replace(new RegExp("^ {"+g+"}","gm"),"");};apf.convertAmlToJson=function(k){var g=apf.getXml("<a:app xmlns:a='"+apf.ns.apf+"'>"+k+"</a:app>",null,true);var d=[],c={"true":1,"false":1};var b=(function j(n,B,u){var r=new Array(B+2).join("  "),o=[];for(var q,C=0,t=n.length;C<t;C++){q=n[C];if(q.nodeType==3||q.nodeType==4){if(q.nodeValue.replace(/[\s]*$/,"").replace(/^[\s]*/,"")){(u||o).push("data",'"'+q.nodeValue.trim().replace(/"/g,'\\"').replace(/\n/g,"\\\n")+'"');}continue;}else{if(q.nodeType==8){o.push(r+"//"+q.nodeValue);continue;}else{if(q.nodeType!=1){continue;}else{if(q[apf.TAGNAME]=="script"){var I=q.childNodes;for(var w=0,A=I.length;w<A;w++){if(I[w].nodeValue.trim()!="//"){d.push(I[w].nodeValue.replace(/^ {16}/gm,"").replace(/\/\/$/,"")+"\n");}}continue;}}}}var E,D=q.childNodes.length+(E=q.attributes).length;var G=0,m=[];o.push(r+"new apf."+q[apf.TAGNAME]+(D||!B?"({":"()"+(B==0?";":(C==t-1?"":","))));if(!B){m.push("htmlNode","document.body");G=Math.max(8,G);}for(var H,w=0,A=E.length;w<A;w++){m.push((H=E[w]).nodeName,H.nodeName.substr(0,2)=="on"?"function(){"+H.nodeValue+"}":(parseInt(H.nodeValue)==H.nodeValue||c[H.nodeValue]?H.nodeValue:'"'+H.nodeValue.replace(/"/g,'\\"')+'"'));G=Math.max(H.nodeName.length,G);}var F="";if(q[apf.TAGNAME]=="model"&&q.childNodes.length){m.push("data",'"'+apf.serializeChildren(q).trim().replace(/"/g,'\\"').replace(/\r?\n/g,"\\\n")+'"');}else{if(D){var F=j(q.childNodes,B+2,m);}}G=Math.max(F?10:4,G);G++;for(w=0,A=m.length;w<A;w+=2){o.push(r+"  "+m[w].pad(G," ",apf.PAD_RIGHT)+": "+m[w+1]+(w!=A-2||F?",":""));}if(F){o.push(r+"  "+"childNodes".pad(G," ",apf.PAD_RIGHT)+": [");o.push(F.substr(0,F.length-1));o.push(r+"  ]");}if(D||!B){o.push(r+"})"+(B==0?";":(C==t-1?"":",")));}}return o.join("\n")+(B==0?"\n\n"+d.join("").trim():"");})(g.childNodes,0);return b+"\n\n";};apf.highlightJs=function(b,k){if(!k){var d=b.split(/\n\r?/);for(var j=1000,g=0,c=d.length;g<c;g++){j=Math.min(j,d[g].match(/^(\s+)?[^\s]/)&&RegExp.$1.length||1000);if(!j){break;}}b=b.replace(new RegExp("^ {"+j+"}","gm"),"");}return b.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/(\/\*[\s\S]+\*\/)|(\/\/.*)$|("(?:[^"\\]+|\\[\s\S])*")|('(?:[^'\\]+|\\[\s\S])*')|(\W)(apf|break|continue|do|for|import|new|this|void|case|default|else|function|in|return|typeof|while|comment|delete|export|if|label|switch|var|with|abstract|implements|protected|boolean|instanceOf|public|byte|int|short|char|interface|static|double|long|synchronized|false|native|throws|final|null|transient|float|package|true|goto|private|catch|enum|throw|class|extends|try|const|finally|debugger|super)(\W)|(\W)(\w+)(\s*\()/gm,function(n,C,A,r,q,t,u,o,w,s,B){if(s){return w+'<span style="color:#ff8000">'+s+"</span>"+B;}else{if(A||C){return'<span style="color:green">'+(A||C)+"</span>";}else{if(r||q){return'<span style="color:#808080">'+(r||q)+"</span>";}else{if(t){return t+'<span style="color:#127ac6">'+u+"</span>"+o;}}}}});};apf.highlightCode2=function(b){var d=[],c=[];return b.replace(/(\/\*[\s\S]*?\*\/|\/\/.*)/g,function(g){d.push(g);return"###n"+(d.length-1)+"###";}).replace(/\"([\s\S]*?)\"/g,function(j,g){c.push(g);return"###s"+(c.length-1)+"###";}).replace(/\'([\s\S]*?)\'/g,function(j,g){c.push(g);return"###q"+(c.length-1)+"###";}).replace(/(\<)|(\>)/g,function(k,j,g){return"<span stylecolorwhite>"+(j?"@lt@":"@gt@")+"</span>";}).replace(/(\W)-?([\d\.]+)(\W)/g,"$1<span stylecolor#127ac6>$2</span>$3").replace(/([\|\&\=\;\,\:\?\+\*\-]+)/g,"<span stylecolorwhite>$1</span>").replace(/(\W)(break|continue|do|for|import|new|this|void|case|default|else|function|in|return|typeof|while|comment|delete|export|if|label|switch|var|with|abstract|implements|protected|boolean|instanceOf|public|byte|int|short|char|interface|static|double|long|synchronized|false|native|throws|final|null|transient|float|package|true|goto|private|catch|enum|throw|class|extends|try|const|finally|debugger|super)(\W)/g,"$1<span stylecolorgreen>$2</span>$3").replace(/([\(\)\{\}\[\]])/g,"<span stylecoloryellow>$1</span>").replace(/###n(\d+)###/g,function(j,g){return"<span stylecolorpurple>"+d[g].escapeHTML()+"</span>";}).replace(/###s(\d+)###/g,function(j,g){return'<span stylecolorgray>"'+c[g].escapeHTML()+'"</span>';}).replace(/###q(\d+)###/g,function(j,g){return"<span stylecolorgray>'"+c[g].escapeHTML()+"'</span>";}).replace(/stylecolor(.*?)\>/g,"style='color:$1'>").replace(/@(.*?)@/g,"&$1;");};apf.formatJS=function(c){var j=0,b=0;var k=[],g=[];return c.replace(/(\/\*[\s\S]*?\*\/|\/\/.*)/g,function(d){k.push(d);return"###n"+(k.length-1)+"###";}).replace(/\"([\s\S]*?)\"/g,function(m,d){g.push(d);return"###s"+(g.length-1)+"###";}).replace(/\'([\s\S]*?)\'/g,function(m,d){g.push(d);return"###q"+(g.length-1)+"###";}).replace(/;+/g,";").replace(/{;/g,"{").replace(/({)|(})|(\()|(\))|(;)/g,function(d,u,w,q,r,s){if(u){j++;}if(w){j--;}if(q){b++;return q;}if(r){b--;return r;}var t="";for(var n=0;n<j;n++){t+="\t";}if(u){return"{\n"+t;}if(w){return"\n"+t+"}";}if(s){return(b>0)?s:(";\n"+t);}}).replace(/;\s*\n\s*\n/g,";\n").replace(/}var/g,"}\nvar").replace(/([\n\s]*)###n(\d+)###[\n\s]*/g,function(m,d,n){return d+k[n]+d;}).replace(/###s(\d+)###/g,function(m,d,n){return'"'+g[d]+'"';}).replace(/###q(\d+)###/g,function(m,d,n){return"'"+g[d]+"'";});};apf.flash=(function(){function getControlVersion(){var version,axo;try{axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7");version=axo.GetVariable("$version");}catch(e){}if(!version){try{axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");version="WIN 6,0,21,0";axo.AllowScriptAccess="always";version=axo.GetVariable("$version");}catch(e){}}if(!version){try{axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.3");version=axo.GetVariable("$version");}catch(e){}}if(!version){try{axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.3");version="WIN 3,0,18,0";}catch(e){}}if(!version){try{axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");version="WIN 2,0,0,11";}catch(e){version=-1;}}return version;}function getSwfVersion(){var flashVer=-1,sAgent=navigator.userAgent.toLowerCase();if(navigator.plugins!=null&&navigator.plugins.length>0){if(navigator.plugins["Shockwave Flash 2.0"]||navigator.plugins["Shockwave Flash"]){var swVer2=navigator.plugins["Shockwave Flash 2.0"]?" 2.0":"",swfDescr=navigator.plugins["Shockwave Flash"+swVer2].description,aDescr=swfDescr.split(" "),aTempMaj=aDescr[2].split("."),nMajor=aTempMaj[0],nMinor=aTempMaj[1],sRev=aDescr[3];if(sRev==""){sRev=aDescr[4];}if(sRev[0]=="d"){sRev=sRev.substring(1);}else{if(sRev[0]=="r"){sRev=sRev.substring(1);if(sRev.indexOf("d")>0){sRev=sRev.substring(0,sRev.indexOf("d"));}}}flashVer=nMajor+"."+nMinor+"."+sRev;}}else{if(sAgent.indexOf("webtv/2.6")!=-1){flashVer=4;}else{if(sAgent.indexOf("webtv/2.5")!=-1){flashVer=3;}else{if(sAgent.indexOf("webtv")!=-1){flashVer=2;}else{if(apf.isIE&&!apf.isOpera){flashVer=getControlVersion();}}}}}return flashVer;}function detectFlashVersion(reqMajorVer,reqMinorVer,reqRevision){var versionStr=getSwfVersion();if(versionStr==-1){return false;}if(versionStr!=0){var aVersions;if(apf.isIE&&!apf.isOpera){var aTemp=versionStr.split(" "),sTemp=aTemp[1];aVersions=sTemp.split(",");}else{aVersions=versionStr.split(".");}var nMajor=aVersions[0],nMinor=aVersions[1],sRev=aVersions[2];if(nMajor>parseFloat(reqMajorVer)){return true;}if(nMajor==parseFloat(reqMajorVer)){if(nMinor>parseFloat(reqMinorVer)){return true;}if(nMinor==parseFloat(reqMinorVer)&&sRev>=parseFloat(reqRevision)){return true;}}return false;}}function generateObj(objAttrs,params,embedAttrs,stdout){if(stdout=="undefined"){stdout=false;}var i,str=[];if(apf.isIE&&!apf.isOpera){str.push("<object ");for(i in objAttrs){str.push(i,'="',objAttrs[i],'" ');}str.push(">");for(i in params){str.push('<param name="',i,'" value="',params[i],'" />');}str.push("</object>");}else{str.push("<embed ");for(i in embedAttrs){str.push(i,'="',embedAttrs[i],'" ');}str.push("></embed>");}var sOut=str.join("");if(stdout===true){document.write(sOut);}return sOut;}function AC_FL_RunContent(options){var ret=AC_GetArgs(options,"movie","clsid:d27cdb6e-ae6d-11cf-96b8-444553540000","application/x-shockwave-flash");return generateObj(ret.objAttrs,ret.params,ret.embedAttrs);}function buildContent(options){var v=isEightAvailable();if(isAvailable()&&!v){return buildInstaller(options||{});}if(v){return AC_FL_RunContent(options);}return'This content requires the             <a href="http://www.adobe.com/go/getflash/">Adobe Flash Player</a>.';}function embed(options){var obj=options.context,node=options.htmlNode,prop=options.property||"$player";delete options.context,delete options.htmlNode,delete options.property;var content=buildContent(options),cb=function(){$setTimeout(function(){node.innerHTML=content;obj[prop]=getElement(options.id);$setTimeout(function(){var fail=null;if(!obj[prop].parentNode){fail="File Uploader error: The movie has to be enabled manually because of Flashblock. No browser refresh is required.";}else{if(obj[prop].style.display=="none"){fail="File Uploader error: Adblock Plus blocks or hides the movie. Please enable it and refresh your browser.";}else{if(!obj[prop].offsetWidth){fail="File Uploader error: The Flash movie failed to load. Please check if the file exists and the path is correct.";}}}if(fail){apf.console.error(fail,"audio");obj.dispatchEvent("error",{message:fail});}},1000);},200);};return apf.loaded?cb():apf.addEventListener("load",cb);}function buildInstaller(options){if(!options){options={};}var ret=AC_GetArgs(options,"movie","clsid:d27cdb6e-ae6d-11cf-96b8-444553540000","application/x-shockwave-flash"),MMPlayerType=(apf.isIE==true)?"ActiveX":"PlugIn",MMredirectURL=window.location;document.title=document.title.slice(0,47)+" - Flash Player Installation";var MMdoctitle=document.title;return AC_FL_RunContent({src:"playerProductInstall",FlashVars:"MMredirectURL="+MMredirectURL+"&MMplayerType="+MMPlayerType+"&MMdoctitle="+MMdoctitle+"",width:"100%",height:"100%",align:"middle",id:ret.embedAttrs.name,quality:"high",bgcolor:"#000000",name:ret.embedAttrs.name,allowScriptAccess:"always",type:"application/x-shockwave-flash",pluginspage:"http://www.adobe.com/go/getflashplayer"});}var sSrc="src|movie",sObj="onafterupdate|onbeforeupdate|onblur|oncellchange|onclick|ondblclick|ondrag|ondragend|ondragenter|ondragleave|ondragover|ondrop|onfinish|onfocus|onhelp|onmousedown|onmouseup|onmouseover|onmousemove|onmouseout|onkeypress|onkeydown|onkeyup|onload|onlosecapture|onpropertychange|onreadystatechange|onrowsdelete|onrowenter|onrowexit|onrowsinserted|onstart|onscroll|onbeforeeditfocus|onactivate|onbeforedeactivate|ondeactivate|type|codebase|id",sEmb="width|height|align|vspace|hspace|class|title|accesskey|name|tabindex";function AC_GetArgs(options,srcParamName,classid,mimeType){var i,name,ret={embedAttrs:{},params:{},objAttrs:{}};for(i in options){name=i.toLowerCase();if(name=="classid"){continue;}if(name=="pluginspage"){ret.embedAttrs[i]=options[i];}else{if(sSrc.indexOf(name)>-1){ret.embedAttrs.src=options[i];ret.params[srcParamName]=options[i];}else{if(sObj.indexOf(name)>-1){ret.objAttrs[i]=options[i];}else{if(sEmb.indexOf(name)>-1){ret.embedAttrs[i]=ret.objAttrs[i]=options[i];}else{ret.embedAttrs[i]=ret.params[i]=options[i];}}}}}ret.objAttrs.classid=classid;if(mimeType){ret.embedAttrs.type=mimeType;}return ret;}function getElement(id){var elem;if(typeof id=="object"){return id;}if(apf.isIE){return self[id];}else{elem=document[id]?document[id]:document.getElementById(id);if(!elem){elem=apf.lookup(id);}return elem;}}var hash={},uniqueID=1;function addPlayer(player){hash[++uniqueID]=player;return uniqueID;}function getPlayer(id){return hash[id];}function callMethod(id,methodName){var player=hash[id];if(player==null){throw new Error(apf.formatErrorString(0,this,"Player with id: "+id+" not found"));}if(player[methodName]==null){throw new Error(apf.formatErrorString(0,this,"Method "+methodName+" Not found"));}apf.console.info("[FLASH] received method call for player '"+id+"', '"+methodName+"'");var args=[],i=2,l=arguments.length;for(;i<l;i++){args.push(decode(arguments[i]));}player[methodName].apply(player,args);}function remote(o,fn){if(typeof o=="string"){o=hash[o];}var rs=o.CallFunction('<invoke name="'+fn+'" returntype="javascript">'+__flash__argumentsToXML(arguments,2)+"</invoke>");return eval(rs);}function encode(data){if(!data||typeof data!="string"){return data;}return data.replace(/\&([^;]*)\;/g,"&amp;$1;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace("\\","&custom_backslash;").replace(/\0/g,"\\0").replace(/\"/g,"&quot;");}function decode(data){if(data&&data.length&&typeof data!="string"){data=data[0];}if(!data||typeof data!="string"){return data;}return data.replace(/\&custom_lt\;/g,"<").replace(/\&custom_gt\;/g,">").replace(/\&custom_backslash\;/g,"\\").replace(/\\0/g,"\0");}var aIsAvailable={};function isAvailable(sVersion){if(typeof sVersion!="string"){sVersion="6.0.65";}var aVersion=sVersion.split(".");while(aVersion.length<3){aVersion.push("0");}if(typeof aIsAvailable[sVersion]=="undefined"){aIsAvailable[sVersion]=detectFlashVersion(parseInt(aVersion[0]),parseInt(aVersion[1]),parseInt(aVersion[2]));}return aIsAvailable[sVersion];}function isEightAvailable(){return isAvailable("8.0.0");}var oSandboxTypes={remote:"remote (domain-based) rules",localwithfile:"local with file access (no internet access)",localwithnetwork:"local with network (internet access only, no local access)",localtrusted:"local, trusted (local + internet access)"};function getSandbox(sType){var oSandbox={type:null,description:null,noRemote:false,noLocal:false,error:null};oSandbox.type=sType.toLowerCase();oSandbox.description=oSandboxTypes[(typeof oSandboxTypes[oSandbox.type]!="undefined"?oSandbox.type:"unknown")];if(oSandbox.type=="localwithfile"){oSandbox.noRemote=true;oSandbox.noLocal=false;oSandbox.error="Flash security note: Network/internet URLs will not                                  load due to security restrictions.                                 Access can be configured via Flash Player Global Security                                 Settings Page:                                  http://www.macromedia.com/support/documentation/en/flashplayer/help/settings_manager04.html";}else{if(oSandbox.type=="localwithnetwork"){oSandbox.noRemote=false;oSandbox.noLocal=true;}else{if(oSandbox.type=="localtrusted"){oSandbox.noRemote=false;oSandbox.noLocal=false;}}}return oSandbox;}return{isAvailable:isAvailable,isEightAvailable:isEightAvailable,buildContent:buildContent,embed:embed,encode:encode,decode:decode,getElement:getElement,addPlayer:addPlayer,getPlayer:getPlayer,callMethod:callMethod,getSandbox:getSandbox,remote:remote};})();apf.setcookie=function(d,j,c,m,g,k){var b=d+"="+escape(j)+";";if(c){b+="expires="+new Date(c+new Date().getTimezoneOffset()*60).toGMTString()+";";}if(m){b+="path="+m+";";}if(g){b+="domain="+g+";";}if(k){b+="secure";}document.cookie=b;return j;};apf.getcookie=function(d){var c=document.cookie.split("; ");for(var g=0;g<c.length;g++){var b=c[g].split("=");if(d==b[0]){return unescape(b[1]);}}return"";};apf.delcookie=function(b,c){document.cookie=b+"=blah; expires=Fri, 31 Dec 1999 23:59:59 GMT;"+(c?"domain="+c:"");};apf.pasteWindow=function(c){var b=window.open("about:blank");b.document.write(c);};apf.xmlEntityMap={quot:"34",amp:"38",apos:"39",lt:"60",gt:"62",nbsp:"160",iexcl:"161",cent:"162",pound:"163",curren:"164",yen:"165",brvbar:"166",sect:"167",uml:"168",copy:"169",ordf:"170",laquo:"171",not:"172",shy:"173",reg:"174",macr:"175",deg:"176",plusmn:"177",sup2:"178",sup3:"179",acute:"180",micro:"181",para:"182",middot:"183",cedil:"184",sup1:"185",ordm:"186",raquo:"187",frac14:"188",frac12:"189",frac34:"190",iquest:"191",agrave:"192",aacute:"193",acirc:"194",atilde:"195",auml:"196",aring:"197",aelig:"198",ccedil:"199",egrave:"200",eacute:"201",ecirc:"202",euml:"203",igrave:"204",iacute:"205",icirc:"206",iuml:"207",eth:"208",ntilde:"209",ograve:"210",oacute:"211",ocirc:"212",otilde:"213",ouml:"214",times:"215",oslash:"216",ugrave:"217",uacute:"218",ucirc:"219",uuml:"220",yacute:"221",thorn:"222",szlig:"223",agrave:"224",aacute:"225",acirc:"226",atilde:"227",auml:"228",aring:"229",aelig:"230",ccedil:"231",egrave:"232",eacute:"233",ecirc:"234",euml:"235",igrave:"236",iacute:"237",icirc:"238",iuml:"239",eth:"240",ntilde:"241",ograve:"242",oacute:"243",ocirc:"244",otilde:"245",ouml:"246",divide:"247",oslash:"248",ugrave:"249",uacute:"250",ucirc:"251",uuml:"252",yacute:"253",thorn:"254",yuml:"255",oelig:"338",oelig:"339",scaron:"352",scaron:"353",yuml:"376",fnof:"402",circ:"710",tilde:"732",alpha:"913",beta:"914",gamma:"915",delta:"916",epsilon:"917",zeta:"918",eta:"919",theta:"920",iota:"921",kappa:"922",lambda:"923",mu:"924",nu:"925",xi:"926",omicron:"927",pi:"928",rho:"929",sigma:"931",tau:"932",upsilon:"933",phi:"934",chi:"935",psi:"936",omega:"937",alpha:"945",beta:"946",gamma:"947",delta:"948",epsilon:"949",zeta:"950",eta:"951",theta:"952",iota:"953",kappa:"954",lambda:"955",mu:"956",nu:"957",xi:"958",omicron:"959",pi:"960",rho:"961",sigmaf:"962",sigma:"963",tau:"964",upsilon:"965",phi:"966",chi:"967",psi:"968",omega:"969",thetasym:"977",upsih:"978",piv:"982",ensp:"8194",emsp:"8195",thinsp:"8201",zwnj:"8204",zwj:"8205",lrm:"8206",rlm:"8207",ndash:"8211",mdash:"8212",lsquo:"8216",rsquo:"8217",sbquo:"8218",ldquo:"8220",rdquo:"8221",bdquo:"8222",dagger:"8224",dagger:"8225",bull:"8226",hellip:"8230",permil:"8240",prime:"8242",prime:"8243",lsaquo:"8249",rsaquo:"8250",oline:"8254",frasl:"8260",euro:"8364",image:"8465",weierp:"8472",real:"8476",trade:"8482",alefsym:"8501",larr:"8592",uarr:"8593",rarr:"8594",darr:"8595",harr:"8596",crarr:"8629",larr:"8656",uarr:"8657",rarr:"8658",darr:"8659",harr:"8660",forall:"8704",part:"8706",exist:"8707",empty:"8709",nabla:"8711",isin:"8712",notin:"8713",ni:"8715",prod:"8719",sum:"8721",minus:"8722",lowast:"8727",radic:"8730",prop:"8733",infin:"8734",ang:"8736",and:"8743",or:"8744",cap:"8745",cup:"8746","int":"8747",there4:"8756",sim:"8764",cong:"8773",asymp:"8776",ne:"8800",equiv:"8801",le:"8804",ge:"8805",sub:"8834",sup:"8835",nsub:"8836",sube:"8838",supe:"8839",oplus:"8853",otimes:"8855",perp:"8869",sdot:"8901",lceil:"8968",rceil:"8969",lfloor:"8970",rfloor:"8971",lang:"9001",rang:"9002",loz:"9674",spades:"9824",clubs:"9827",hearts:"9829",diams:"9830"};apf.htmlentities=function(b){return b.escapeHTML();};apf.xmlentities=function(b){return b.replace(/&([a-z]+);/gi,function(d,c){if(apf.xmlEntityMap[c=c.toLowerCase()]){return"&#"+apf.xmlEntityMap[c]+";";}return d;});};apf.html_entity_decode=function(b){return(b||"").replace(/\&\#38;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&nbsp;/g," ");};apf.isCharacter=function(b){return(b<112||b>122)&&(b==32||b>42||b==8);};apf.randomGenerator={d:new Date(),seed:null,A:48271,M:2147483647,Q:null,R:null,oneOverM:null,generate:function(c,b){if(this.seed==null){this.seed=2345678901+(this.d.getSeconds()*16777215)+(this.d.getMinutes()*65535);}this.Q=this.M/this.A;this.R=this.M%this.A;this.oneOverM=1/this.M;return Math.floor((b-c+1)*this.next()+c);},next:function(){var b=this.seed/this.Q;var c=this.seed%this.Q;var d=this.A*c-this.R*b;if(d>0){this.seed=d;}else{this.seed=d+this.M;}return(this.seed*this.oneOverM);}};apf.getNoCacheUrl=function(b){return b+(b.indexOf("?")==-1?"?":"&")+"nocache="+new Date().getTime();};apf.parseExpression=function(str){if(!apf.parseExpression.regexp.test(str)){return str;}try{return eval(RegExp.$1);}catch(e){throw new Error(apf.formatErrorString(0,null,"Parsing Expression","Invalid expression given '"+str+"'"));}};apf.parseExpression.regexp=/^\{([\s\S]*)\}$/;apf.formatNumber=function(b,d){var c=parseFloat(b);if(!c){return b;}var g=new String(Math.round(c*100)/100).replace(/(\.\d?\d?)$/,function(j){return j.pad(3,"0",apf.PAD_RIGHT);});if(g.indexOf(".")==-1){g+=".00";}return d+g;};apf.jsexec=function(str,win){if(!str){return str;}if(!win){win=self;}if(apf.isO3){eval(str,self);}else{if(apf.hasExecScript){win.execScript(str);}else{var head=win.document.getElementsByTagName("head")[0];if(head){var script=win.document.createElement("script");script.setAttribute("type","text/javascript");script.text=str;head.appendChild(script);head.removeChild(script);}else{eval(str,win);}}}return str;};apf.K=function(){};apf.isNumber=function(b){return parseFloat(b)==b;};apf.isArray=function(b){return Object.prototype.toString.call(b)==="[object Array]";};apf.isTrue=function(b){return(b===true||b==="true"||b==="on"||typeof b=="number"&&b>0||b==="1");};apf.isFalse=function(b){return(b===false||b==="false"||b==="off"||b===0||b==="0");};apf.isNot=function(b){return(!b&&typeof b!="string"&&b!==0||(typeof b=="number"&&!isFinite(b)));};apf.removePathContext=function(c,b){if(!b){return"";}if(b.indexOf(c)>-1){return b.substr(c.length);}return b;};apf.cancelBubble=function(c,d,b){if(c.stopPropagation){c.stopPropagation();}else{c.cancelBubble=true;}if(!b){if(d&&d.$ext&&d.$ext["on"+(c.type||c.name)]){d.$ext["on"+(c.type||c.name)](c);}apf.window.$mousedown(c);}};apf.destroyHtmlNode=function(b){if(!b){return;}if(!apf.isIE||b.ownerDocument!=document){if(b.parentNode){b.parentNode.removeChild(b);}return;}var c=document.getElementById("IELeakGarbageBin");if(!c){c=document.createElement("DIV");c.id="IELeakGarbageBin";c.style.display="none";document.body.appendChild(c);}c.appendChild(b);c.innerHTML="";};apf.getRules=function(c){var d={};for(var b=c.firstChild;b;b=b.nextSibling){if(b.nodeType!=1){continue;}else{if(!d[b[apf.TAGNAME]]){d[b[apf.TAGNAME]]=[];}d[b[apf.TAGNAME]].push(b);}}return d;};apf.isCoord=function(b){return b||b===0;};apf.getCoord=function(c,b){return c||c===0?c:b;};apf.getBox=function(g,d){if(!d){d=0;}if(g==null||(!parseInt(g)&&parseInt(g)!=0)){return[0,0,0,0];}var b=String(g).split(" ");for(var c=0;c<b.length;c++){b[c]=parseInt(b[c])||0;}switch(b.length){case 1:b[1]=b[0];b[2]=b[0];b[3]=b[0];break;case 2:b[2]=b[0];b[3]=b[1];break;case 3:b[3]=b[1];break;}return b;};apf.getNode=function(d,b){var g=0;if(d!=null){for(var c=0;c<d.childNodes.length;c++){if(d.childNodes[c].nodeType==1){if(g==b[0]){d=d.childNodes[c];if(b.length>1){b.shift();d=this.getNode(d,b);}return d;}g++;}}}return null;};apf.getFirstElement=function(b){try{b.firstChild.nodeType==1?b.firstChild:b.firstChild.nextSibling;}catch(c){throw new Error(apf.formatErrorString(1052,null,"Xml Selection","Could not find element:\n"+(b?b.xml:"null")));}return b.firstChild.nodeType==1?b.firstChild:b.firstChild.nextSibling;};apf.getLastElement=function(b){try{b.lastChild.nodeType==1?b.lastChild:b.lastChild.nextSibling;}catch(c){throw new Error(apf.formatErrorString(1053,null,"Xml Selection","Could not find last element:\n"+(b?b.xml:"null")));}return b.lastChild.nodeType==1?b.lastChild:b.lastChild.previousSibling;};apf.selectTextHtml=function(c){if(!apf.hasMsRangeObject){return;}var b=document.selection.createRange();try{b.moveToElementText(c);}catch(d){}b.select();};apf.isChildOf=function(b,g,c){if(!b||!g){return false;}if(g.nodeType==2){g=g.ownerElement||g.selectSingleNode("..");}if(c&&b==g){return true;}var d=g.parentNode;while(d){if(d==b){return true;}d=d.parentNode;}return false;};apf.isOnlyChild=function(k,c){if(!k||!k.parentNode||c&&c.indexOf(k.nodeType)==-1){return false;}var g,b,j,d=k.parentNode.childNodes;for(g=0,b=d.length;g<b;g++){j=d[g];if(j.nodeType==1&&j!=k){return false;}if(j.nodeType==3&&!j.nodeValue.trim()){return false;}}return true;};apf.getChildNumber=function(g,m){var k=g.parentNode,c=0;if(!k){return 0;}if(!m){m=k.childNodes;}if(apf.hasIndexOfNodeList){return m.indexOf(g);}for(var d=0,b=m.length;d<b;d++){if(m[d]==g){return c;}c++;}return c;};apf.mergeXml=function(n,k,q){if(typeof k!="object"){k=getElementById(k);}if(q&&q.clearContents){var c,d,g,b=k.selectNodes("descendant::node()[@"+apf.xmldb.xmlListenTag+"]");for(g=b.length-1;g>=0;g--){var o=b[g].getAttribute(apf.xmldb.xmlListenTag).split(";");for(d=o.length-1;d>=0;d--){c=apf.all[o[d]];if(c.dataParent&&c.dataParent.xpath){c.dataParent.parent.signalXmlUpdate[c.$uniqueId]=true;}else{if(c.$model){c.$model.$waitForXml(c);}}}}b=k.childNodes;for(g=b.length-1;g>=0;g--){k.removeChild(b[g]);}}beforeNode=q&&q.beforeNode?q.beforeNode:apf.getNode(k,[0]);b=n.childNodes;if(k.ownerDocument.importNode){doc=k.ownerDocument;for(g=0,l=b.length;g<l;g++){k.insertBefore(doc.importNode(b[g],true),beforeNode);}}else{for(g=b.length-1;g>=0;g--){k.insertBefore(b[0],beforeNode);}}if(q&&q.copyAttributes){var m=n.attributes;for(g=0;g<m.length;g++){if(m[g].nodeName!=apf.xmldb.xmlIdTag){k.setAttribute(m[g].nodeName,m[g].nodeValue);}}}return k;};apf.setNodeValue=function(k,j,n,g){if(!k){return;}var m,b,d;if(g){m=g.undoObj;b=g.xpath;d=g.newNodes;m.extra.oldValue=g.forceNew?"":apf.queryValue(k,b);m.xmlNode=k;if(b){k=apf.createNodeFromXpath(k,b,d,g.forceNew);}m.extra.appliedNode=k;}if(k.nodeType==1){if(!k.firstChild){k.appendChild(k.ownerDocument.createTextNode("-"));}k.firstChild.nodeValue=apf.isNot(j)?"":j;if(n){apf.xmldb.applyChanges("synchronize",k,m);}}else{var c=k.nodeValue;k.nodeValue=apf.isNot(j)?"":j;if(k.$triggerUpdate){k.$triggerUpdate(null,c);}if(n){apf.xmldb.applyChanges("synchronize",k.parentNode||k.ownerElement||k.selectSingleNode(".."),m);}}};apf.setQueryValue=function(c,b,g){var d=apf.createNodeFromXpath(c,b);if(!d){return null;}apf.setNodeValue(d,g,true);return d;};apf.queryValue=function(c,b){if(!c){return"";}if(c.nodeType==2){return c.nodeValue;}if(b){c=c.selectSingleNode(b);if(!c){return"";}}return c.nodeType==1?(!c.firstChild?"":c.firstChild.nodeValue):c.nodeValue;};apf.queryValues=function(j,c){var d=[];if(!j){return d;}var b=j.selectNodes(c);if(!b.length){return d;}for(var g=0;g<b.length;g++){var k=b[g];if(k.nodeType==1){k=k.firstChild;}d.push(k.nodeValue||"");}return d;};apf.queryNodes=function(c,b){if(b&&(apf.hasXPathHtmlSupport&&b.selectSingleNode||!b.style)){return b.selectNodes(c);}return apf.XPath.selectNodes(c,b);};apf.queryNode=function(c,b){if(b&&(apf.hasXPathHtmlSupport&&b.selectSingleNode||!b.style)){return b.selectSingleNode(c);}var d=apf.queryNodes(c+(apf.isIE?"":"[1]"),b?b:null);return d.length>0?d[0]:null;};apf.getInheritedAttribute=function(g,d,j){var c,b;if(g.nodeValue!=1){g=g.parentNode;}while(g&&(g.nodeType!=1||!(c=d&&((b=g.getAttribute(d))||typeof b=="string")||j&&j(g)))){g=g.parentNode;}if(b==""){return"";}return !c&&d&&apf.config?apf.config[d]:c;};apf.createNodeFromXpath=function(j,w,k,n){var t,s="",A=w.replace(/('.*?')|(".*?")|\|/g,function(B,D,C){if(D||C){return D||C;}return"-%-|-%-";}).split("-%-|-%-")[0].split("/");if(!n&&(t=j.selectSingleNode(w))){return t;}var m=A.length-1;if(n){if(A[m].trim().match(/^\@(.*)$|^text\(\)$/)){m--;}}for(var b,o=false,d=0;d<m;d++){if(!o&&j.selectSingleNode(s+(d!=0?"/":"")+A[d])){s+=(d!=0?"/":"")+A[d];continue;}var c=A[d].match(/(\w+)\[@([\w-]+)=(\w+)\]/);if(!c&&A[d].match(/\@|\[.*\]|\(.*\)/)){throw new Error(apf.formatErrorString(1041,this,"Select via xPath","Could not use xPath to create xmlNode: "+w));}if(!c&&A[d].match(/\/\//)){throw new Error(apf.formatErrorString(1041,this,"Select via xPath","Could not use xPath to create xmlNode: "+w));}if(c){A[d]=c[1];}o=true;b=j.selectSingleNode(s||".").appendChild(j.ownerDocument.createElement(A[d]));if(c){b.setAttribute(c[2],c[3]);s+=(s?"/":"")+c[0];}else{s+=(s?"/":"")+A[d];}if(k){k.push(b);}}if(!s){s=".";}var r,g=A[m],q=j.nodeType==9?j:j.ownerDocument;do{if(g.match(/^\@(.*)$/)){(r||j.selectSingleNode(s)).setAttributeNode(r=j.ownerDocument.createAttribute(RegExp.$1));}else{if(g.trim()=="text()"){r=(r||j.selectSingleNode(s)).appendChild(j.ownerDocument.createTextNode(""));}else{var u=g.match(/(\w+)\[@([\w-]+)=(\w+)\]/);if(u){g=u[1];}r=(r||j.selectSingleNode(s)).appendChild(q.createElement(g));if(u){r.setAttribute(u[2],u[3]);}if(k){k.push(r);}}}s+=(s?"/":"")+A[m];}while((g=A[++m]));return r;};apf.convertMethods={json:function(b){return JSON.stringify(apf.xml2json(b));},cgivars:function(q,t){if(!t){t="";}var u,c,k,n,d,s=[],b=q.childNodes,m={},o=0,g=b.length;for(;o<g;++o){if(b[o].nodeType!=1){continue;}c=b[o].tagName;if(m[c]){continue;}k=q.selectNodes(c);if(k.length>1){m[c]=true;for(n=0,d=k.length;n<d;n++){u=this.cgivars(k[n],t+c+"["+n+"]");if(u){s.push(u);}}}else{u=this.cgivars(b[o],t+c);if(u){s.push(u);}}}var r=q.attributes;for(o=0,g=r.length;o<g;o++){if(r[o].nodeValue){if(t){s.push(t+"["+r[o].nodeName+"]="+escape(r[o].nodeValue));}else{s.push(r[o].nodeName+"="+escape(r[o].nodeValue));}}}if(s.length){return s.join("&");}u=apf.queryValue(q,"text()");if(t&&u){return t+"="+escape(u);}return"";},cgiobjects:function(o,s,A,B){if(!s){s="";}var d=o.childNodes,k;var g=[],w={};var C="",c,u;var t,n,m;var q,b;var r;for(n=0;n<d.length;n++){k=d[n];if(k.nodeType==1){c=k.tagName;r=k.parentNode.selectNodes(c).length==1?true:false;if(typeof w[c]=="undefined"){w[c]=0;}C=s+(A?"[":"")+c+(A?"]":"")+(r?"":"["+w[c]+"]");q=k.attributes;b=k.attributes.length;if(b>0){for(m=0;m<b;m++){if(!(t=q[m]).nodeValue){continue;}g.push(C+"[_"+t.nodeName+"]="+escape(t.nodeValue.trim()));}}u=this.cgiobjects(k,C,true);if(u.dataType!==1){g.push(u);}else{if(k.firstChild&&k.firstChild.nodeValue.trim()){g.push(C+(b>0?"[_]=":"=")+escape(k.firstChild.nodeValue.trim()));}else{if(b==0){if(B){g.push(C);}}}}w[c]++;}}if(!A&&o.getAttribute("id")){g.push("id="+escape(o.getAttribute("id")));}if(g.length){return g.join("&");}return g;}};apf.convertXml=function(b,c){return apf.convertMethods[c](b);};apf.getTextNode=function(b){for(var d=0,c=b.childNodes.length;d<c;++d){if(b.childNodes[d].nodeType==3||b.childNodes[d].nodeType==4){return b.childNodes[d];}}return false;};apf.getBoundValue=function(c,g,d){if(!g&&!c.xmlRoot){return"";}var b=c.$getDataNode("value",c.xmlRoot);return b?apf.queryValue(b):"";};apf.getArrayFromNodelist=function(g){for(var c=[],d=0,b=g.length;d<b;++d){c.push(g[d]);}return c;};apf.serializeChildren=function(g){var k,j=[],c=g.childNodes,d=0,b=c.length;for(;d<b;++d){j[d]=(k=c[d]).nodeType==1?k.xml||k.serialize():(k.nodeType==8?"":k.nodeValue);}return j.join("");};apf.getXmlString=function(c){var b=apf.xmldb.cleanNode(c.cloneNode(true));return b.xml||b.serialize();};apf.getXml=function(d,b,c){return apf.getXmlDom(d,b,c).documentElement;};apf.formatXml=function(j){j=j.trim();var c=j.split("\n"),g=0,d=0,b=c.length;for(;d<b;++d){c[d]=c[d].trim();}c=c.join("\n").replace(/\>\n/g,">").replace(/\>/g,">\n").replace(/\n\</g,"<").replace(/\</g,"\n<").split("\n");c.removeIndex(0);c.removeIndex(c.length);for(d=0,b=c.length;d<b;d++){c[d]="    ".repeat((c[d].match(/^\s*\<\//)?(g==0)?0:--g:(c[d].match(/^\s*\<[^\?][^>]+[^\/]\>/)?g++:g)))+c[d];}if(!j){return"";}return c.join("\n");};apf.xmlToXpath=function(o,q,n){if(!o){return"";}if(n===true&&o.nodeType==1&&o.getAttribute(apf.xmldb.xmlIdTag)){return"//node()[@"+apf.xmldb.xmlIdTag+"='"+o.getAttribute(apf.xmldb.xmlIdTag)+"']";}if(apf!=this&&this.lookup&&this.select){var j,c=this.lookup[o.tagName];if(c){j=o.selectSingleNode(c).nodeValue;return"//"+o.tagName+"["+c+"='"+j+"']";}for(var k=0,g=this.select.length;k<g;k++){if(o.selectSingleNode(this.select[k][0])){j=o.selectSingleNode(this.select[k][1]).nodeValue;return"//"+this.select[k][0]+"["+this.select[k][1]+"='"+j+"']";}}}if(o==q){return".";}if(!o.parentNode&&!o.ownerElement){throw new Error(apf.formatErrorString(0,null,"Converting XML to Xpath","Error xml node without parent and non matching context cannot             be converted to xml.",o));return false;}var m=[],d=o;if(d.nodeType==2){m.push("@"+d.nodeName);d=d.ownerElement||o.selectSingleNode("..");}var b;do{m.unshift((d.nodeType==1?d.tagName:"text()")+"["+(n&&(b=d.nodeType==1&&d.getAttribute(apf.xmldb.xmlIdTag))?"@"+apf.xmldb.xmlIdTag+"='"+b+"'":(apf.getChildNumber(d,d.parentNode.selectNodes(d.tagName))+1))+"]");d=d.parentNode;}while(d&&d.nodeType==1&&d!=q);return m.join("/");};apf.xpathToXml=function(b,c){if(!c){throw new Error(apf.formatErrorString(0,null,"Converting Xpath to XML","Error context xml node is empty, thus xml node cannot              be found for '"+b+"'"));return false;}return c.selectSingleNode(b);};apf.popup={cache:{},focusFix:{INPUT:1,TEXTAREA:1,SELECT:1},setContent:function(j,g,d,c,b){if(!this.popup){this.init();}this.cache[j]={content:g,style:d,width:c,height:b};g.style.position="absolute";g.onmousedown=function(k){if(!k){k=event;}if(apf.hasFocusBug&&!apf.popup.focusFix[(k.srcElement||k.target).tagName]){apf.window.$focusfix();}apf.cancelBubble(k,null,true);};return g.ownerDocument;},removeContent:function(b){this.cache[b]=null;delete this.cache[b];},init:function(){this.popup={};apf.addEventListener("hotkey",function(b){if(b.keyCode=="27"||b.altKey){apf.popup.forceHide();}});},show:function(r,s){s=apf.extend({x:0,y:0,animate:false,ref:null,width:null,height:null,callback:null,draggable:false,resizable:false,allowTogether:false,autoCorrect:true},s);if(!this.popup){this.init();}if((!s.allowTogether||s.allowTogether!=this.last)&&this.last!=r){this.hide();}var d=this.cache[r];d.options=s;var b=d.content,j=false;if(!d.content.style.zIndex){d.content.style.zIndex=10000000;}if(d.content.style.display&&d.content.style.display.indexOf("none")>-1){d.content.style.display="";}if(s.ref){var m=apf.getAbsolutePosition(s.ref,d.content.offsetParent||d.content.parentNode),n=(s.y||0)+m[1],c=apf.getOverflowParent(d.content);if(s.width||d.width){b.style.width=((s.width||d.width)-3)+"px";}j=s.autoCorrect&&(n+(s.height||d.height||d.content.offsetHeight))>(c==document.documentElement?(apf.isIE?c.offsetHeight:(window.innerHeight+window.pageYOffset))+c.scrollTop:c.offsetHeight+c.scrollTop);b.style.top=(j?(n-(s.height||d.height||d.content.offsetHeight)-(s.y||0)):n)+"px";b.style.left=((s.x||0)+m[0])+"px";}apf.setStyleClass(b,j?"upward":"downward",[j?"downward":"upward"]);if(s.animate){if(s.animate=="fade"){apf.tween.single(b,{type:"fade",from:0,to:1,anim:apf.tween.NORMAL,steps:apf.isIE?5:5,onfinish:function(){if(apf.isIE){b.style.filter="";}}});}else{var q,k=apf.isIE8?5:7,g=0;q=setInterval(function(){var o=++g*((s.height||d.height)/k);b.style.height=o+"px";if(j){b.style.top=(n-o-(s.y||0))+"px";}else{b.scrollTop=-1*(g-k)*((s.height||d.height)/k);}b.style.display="block";if(g>=k){clearInterval(q);if(s.callback){s.callback(b);}}},10);}}else{if(s.height||d.height){b.style.height=(s.height||d.height)+"px";}b.style.top=(n)+"px";b.style.display="block";if(s.callback){s.callback(b);}}$setTimeout(function(){apf.popup.last=r;});if(s.draggable){s.id=r;this.makeDraggable(s);}},hide:function(){if(this.isDragging){return;}var b=this.cache[this.last];if(b){if(b.content){b.content.style.display="none";}if(b.options&&b.options.onclose){b.options.onclose(apf.extend(b.options,{htmlNode:b.content}));b.options.onclose=false;}}},isShowing:function(b){return this.last&&this.last==b&&this.cache[this.last]&&this.cache[this.last].content.style.display!="none";},isDragging:false,makeDraggable:function(b){if(!apf.Interactive||this.cache[b.id].draggable){return;}var c=this.cache[b.id].content;this.cache[b.id].draggable=true;var d={$propHandlers:{},minwidth:10,minheight:10,maxwidth:10000,maxheight:10000,dragOutline:false,resizeOutline:false,draggable:true,resizable:b.resizable,$ext:c,oDrag:c.firstChild};c.onmousedown=c.firstChild.onmousedown=function(g){if(!g){g=event;}if(apf.hasFocusBug&&!apf.popup.focusFix[(g.srcElement||g.target).tagName]){apf.window.$focusfix();}(g||event).cancelBubble=true;};apf.implement.call(d,apf.Interactive);d.$propHandlers.draggable.call(d,true);d.$propHandlers.resizable.call(d,true);},forceHide:function(){if(this.last&&!apf.plane.current&&this.isShowing(this.last)){var b=apf.lookup(this.last);if(!b){this.last=null;}else{if(b.dispatchEvent("popuphide")!==false){this.hide();}}}},destroy:function(){for(var b in this.cache){if(this.cache[b]){this.cache[b].content.onmousedown=null;apf.destroyHtmlNode(this.cache[b].content);this.cache[b].content=null;this.cache[b]=null;}}if(!this.popup){return;}}};apf.nameserver={lookup:{},add:function(b,c){if(!this.lookup[b]){this.lookup[b]=[];}if(this.onchange){this.onchange(b,c);}return this.lookup[b].push(c)-1;},register:function(b,d,c){if(!this.lookup[b]){this.lookup[b]={};}if(this.onchange){this.onchange(b,c,d);}return(this.lookup[b][d]=c);},remove:function(b,c){var d=this.lookup[b];if(d){for(var g in d){if(d[g]==c){delete d[g];}}}},get:function(b,c){return this.lookup[b]?this.lookup[b][c]:null;},getAll:function(j){var d,b=[],c=this.lookup[j];if(!c){return b;}if(c.dataType==apf.ARRAY){for(var g=0;g<c.length;g++){b.push(c[g]);}}else{for(d in c){b.push(c[d]);}}return b;},getAllNames:function(d){var c,b=[];for(c in this.lookup[d]){if(parseInt(c)==c){continue;}b.push(c);}return b;}};apf.config=new apf.Class().$init();apf.extend(apf.config,{disableRightClick:false,allowSelect:false,allowBlur:true,autoDisableActions:true,autoDisable:false,disableF5:true,autoHideLoading:true,disableSpace:true,defaultPage:"home",disableBackspace:true,undokeys:false,outline:false,dragOutline:false,resizeOutline:false,autoDisableNavKeys:true,disableTabbing:false,resourcePath:null,initdelay:true,liveText:false,iphoneFullscreen:true,iphoneStatusbar:"default",iphoneIcon:null,iphoneIconIsGlossy:false,iphoneFixedViewport:true,skinset:"default",name:self.window&&window.location.href.replace(/[^0-9A-Za-z_]/g,"_"),tags:{},defaults:{},baseurl:"",model:"@default","empty-message":"No items","loading-message":"Loading...","offline-message":"You are currently offline.",setDefaults:function(){},getDefault:function(c,j){var g=this.defaults[c];if(!g){return;}for(var b=g.length-1;b>=0;b--){if(g[b][0]==j){return g[b][1];}}},setProperty:function(b,c){this[b.replace(/-(\w)/g,function(d,g){return g.toUpperCase();})]=this[b]=c;(this.$propHandlers&&this.$propHandlers[b]||apf.GuiElement.propHandlers[b]||apf.K).call(this,c);},$inheritProperties:{},$propHandlers:{baseurl:function(b){this.baseurl=apf.parseExpression(b);},language:function(b){},layout:function(b){apf.queue.add("layout",function(){apf.setModel(apf.config.layout,apf.layout);});},"resource-path":function(b){this.resourcePath=apf.parseExpression(b||"").replace(/resources\/?|\/$/g,"");},skinset:function(b){if(this.$amlLoaded){apf.skins.changeSkinset(b);}},outline:function(b){this.dragOutline=this.resizeOutline=this.outline=apf.isTrue(b);},"drag-outline":function(b){this.dragOutline=b?apf.isTrue(b):false;},"resize-outline":function(b){this.resizeOutline=b?!apf.isFalse(b):false;},storage:function(b){if(b){apf.storage.init(b);}},"disable-f5":function(b){if(apf.isDeskrun&&b){shell.norefresh=true;}},debug:function(b){if(b){apf.$debugwin.activate();apf.addEventListener("load",function(){apf.removeEventListener("load",arguments.callee);});}apf.debug=b;}}});apf.offline={onLine:true};apf.tween=(function(D){var P={left:function(T,S){T.style.left=S+r;},right:function(T,S){T.style.left="";T.style.right=S+r;},top:function(T,S){T.style.top=S+r;},bottom:function(T,S){T.style.top="";T.style.bottom=S+r;},width:function(U,T,S){U.style.width=T+r;},height:function(U,T,S){U.style.height=T+r;},scrollTop:function(U,T,S){U.scrollTop=T;},scrollLeft:function(U,T,S){U.scrollLeft=T;},"height-rsz":function(U,T,S){U.style.height=T+r;if(D.hasSingleResizeEvent){window.onresize();}},mwidth:function(T,S,V){var U=D.getDiff(T);T.style.width=S+r;T.style.marginLeft=-1*(S/2+(parseInt(D.getStyle(T,"borderLeftWidth"))||U[0]/2)+(V.margin||0))+r;},mheight:function(T,S,V){var U=D.getDiff(T);T.style.height=S+r;T.style.marginTop=(-1*S/2-(parseInt(D.getStyle(T,"borderTopWidth"))||U[1]/2)+(V.margin||0))+r;},scrollwidth:function(T,S){T.style.width=S+r;T.scrollLeft=T.scrollWidth;},scrollheight_old:function(T,S){try{T.style.height=S+r;T.scrollTop=T.scrollHeight;}catch(U){alert(S);}},scrollheight:function(U,T,W){var V=D.getHeightDiff(U),S=W.$int||U;U.style.height=Math.max((T+(W.diff||0)),0)+r;S.scrollTop=S.scrollHeight-S.offsetHeight-V+(W.diff||0);},scrolltop:function(T,S){T.style.height=S+r;T.style.top=(-1*S-2)+r;T.scrollTop=0;},clipright:function(U,T,S){U.style.clip="rect(auto, auto, auto, "+T+"px)";U.style.marginLeft=(-1*T)+r;},fade:function(T,S){if(!D.supportOpacity&&D.hasStyleFilters){T.style.filter="alpha(opacity="+parseInt(S*100)+")";}else{T.style.opacity=S;}},bgcolor:function(T,S){T.style.backgroundColor=S;},textcolor:function(T,S){T.style.color=S;},htmlcss:function(T,S,U){if(D.hasStyleFilters&&U.type=="filter"){T.style.filter="progid:DXImageTransform.Microsoft.Alpha(opacity="+S+")";}else{T.style[U.type]=S+(U.needsPx?r:"");}},transformscale:function(T,S,U){T.style[U.type]=q+parseFloat(S)+m;},transformrotate:function(T,S,U){T.style[U.type]=M+parseFloat(S)+L;},transformvalscale:function(S){return q+parseFloat(S)+m;},transformvalrotate:function(S){return M+parseFloat(S)+L;}};var s="id",r="px",u="number",B="transformval",o="transform",C="scale",q="scale(",M="rotate(",m=")",L="deg)",Q=["linear","ease-in","ease-out","ease","ease-in-out","cubic-bezier"],t={left:"left",right:"right",top:"top",bottom:"bottom",width:"width",height:"height",scrollTop:false,scrollLeft:false,mwidth:false,mheight:false,scrollwidth:false,scrollheight:false,fade:"opacity",opacity:"opacity",bgcolor:"background-color",textcolor:"color",transform:"transform"},R=Math.pow,N=Math.round,k=0,I=1,J=2,H={},F=null,g=function(S,T){if(!S.getAttribute(s)){D.setUniqueHtmlId(S);}if(!H[S.getAttribute(s)]){H[S.getAttribute(s)]=[];}H[S.getAttribute(s)].push(T);if(H[S.getAttribute(s)].length==1){T(0);}},K=function(T){var S=H[T.getAttribute(s)];if(!S){return;}S.shift();if(S.length){S[0](0);}},d=function(U,S){var T=H[U.getAttribute(s)];if(!T){return;}if(S&&F&&F.control){F.control.stop=true;}T.length=0;},n=function(X,Y,U,T){var W=0,S=T-1,V=[Y];if(typeof X==u){if(!X){X=D.tween.linear;}else{if(X==1){X=D.tween.easeInCubic;}else{if(X==2){X=D.tween.easeOutCubic;}}}}for(W=0;W<S;++W){V.push(X(W/T,Y,U-Y));}V.push(U);return V;},j=function(Y,S,X,Z){var T,U,aa=D.color.colors,ac=parseInt((aa[S]||S).slice(1),16),ab=parseInt((aa[X]||X).slice(1),16),W=0,V=[];for(;W<Z;W++){U=W/(Z-1),T=1-U;V[V.length]="#"+("000000"+((N((ac&255)*T+(ab&255)*U)&255)|(N((ac&65280)*T+(ab&65280)*U)&65280)|(N((ac&16711680)*T+(ab&16711680)*U)&16711680)).toString(16)).slice(-6);}return V;},O=function(S,T){T=D.extend({steps:3,interval:20,anim:D.tween.linear,control:{}},T);if(S.nodeFunc>100){T.$int=S.$int;S=S.$ext;}try{if("fixed|absolute|relative".indexOf(D.getStyle(S,"position"))==-1){S.style.position="relative";}}catch(W){}var aa=(D.supportCSSAnim&&D.supportCSSTransition&&t[T.type]),V=(T.type==o);T.method=aa?T.type:V?P[o+(T.subType||C)]:P[T.type]||P.htmlcss;if(!T.method){throw new Error(D.formatErrorString(0,this,"Single Value Tween","Could not find method for tweening operation '"+T.type+"'"));}if(aa){var X=t[T.type];if(X===false){return D.tween;}T.type=X||T.type;if(V){if(!T.subType){T.subType=C;}T.type=D.supportCSSAnim;}var U=(V)?P[B+(T.subType||C)]:null;S.style[T.type]=V?U(T.from):T.from+(A[T.type]?r:"");$setTimeout(function(){S.style[T.type]=V?U(T.to):T.to+(A[T.type]?r:"");S.offsetTop;S.style[D.cssPrefix+"Transition"]=T.type+" "+((T.steps*T.interval)/1000)+"s "+Q[T.anim||0];var ab=function(){if(T.onfinish){T.onfinish(S,T.userdata);}S.style[D.cssPrefix+"Transition"]="";S.removeEventListener(D.cssAnimEvent,ab);};S.addEventListener(D.cssAnimEvent,ab);});return D.tween;}if(T.control){T.control.stop=function(){T.control.state=I;d(S);if(T.onstop){T.onstop(S,T.userdata);}};}var Z=T.color?j(T.anim,T.from,T.to,T.steps):n(T.anim,parseFloat(T.from),parseFloat(T.to),T.steps),Y=function(ab){if(T.control&&T.control.state){T.control.state=J;return;}F=T;if(T.onbeforeeach&&T.onbeforeeach(S,T.userdata)===false){return;}try{T.method(S,Z[ab],T);}catch(ac){}if(T.oneach){T.oneach(S,T.userdata);}if(ab<T.steps){return $setTimeout(function(){Y(ab+1);},T.interval);}F=null;if(T.control){T.control.state=J;}if(T.onfinish){T.onfinish(S,T.userdata);}K(S);};g(S,Y);return D.tween;},G=function(V,al){al=D.extend({steps:3,interval:20,anim:D.tween.linear,control:{}},al);if(V.nodeFunc>100){al.$int=V.$int;V=V.$ext;}var ak,Y,ac=D.supportCSSAnim&&D.supportCSSTransition,aa=false,S=((al.steps*al.interval)/1000),T=Q[al.anim||0],aj=[],ae=[],ai=0,af=al.tweens.length;for(;ai<af;ai++){var am=al.tweens[ai];if(am.oHtml&&am.oHtml.nodeFunc>100){am.$int=am.oHtml.$int;am.oHtml=am.oHtml.$ext;}ak=(ac&&t[am.type]);Y=(am.type==o);if(Y){if(!am.subType){am.subType=C;}am.type=D.supportCSSAnim;}am.method=ak?am.type:Y?P[o+(am.subType)]:P[am.type]||P.htmlcss;if(!am.method){throw new Error(D.formatErrorString(0,this,"Multi Value Tween","Could not find method for tweening operation '"+am.type+"'"));}if(ak){var U=Y?am.type:t[am.type];am.type=U||am.type;var ab=P[B+(am.subType)];V.style[am.type]=Y?ab(am.from):am.from+(A[am.type]?r:"");ae.push([am.type,Y?ab(am.to):am.to+(A[am.type]?r:"")]);aj.push(am.type+" "+S+"s "+T+" 0");aa=true;}else{aj.push(am.color?j(al.anim,am.from,am.to,al.steps):n(al.anim,parseFloat(am.from),parseFloat(am.to),al.steps));}}if(aa){V.style[D.cssPrefix+"Transition"]=aj.join(",");V.offsetTop;var X=0,W=function(){X++;if(X==ae.length){if(al.onfinish){al.onfinish(V,al.userdata);}V.style[D.cssPrefix+"Transition"]="";V.removeEventListener(D.cssAnimEvent,W);}};V.addEventListener(D.cssAnimEvent,W,false);for(var ag=0,ah=ae.length;ag<ah;ag++){V.style[ae[ag][0]]=ae[ag][1];}return D.tween;}if(al.control){al.control.stop=function(){al.control.state=I;d(V);if(al.onstop){al.onstop(V,al.userdata);}};}var ad=al.tweens,Z=function(ao){if(al.control&&al.control.state){al.control.state=J;return;}F=al;try{for(var an=0;an<aj.length;an++){ad[an].method(ad[an].oHtml||V,aj[an][ao],ad[an]);}}catch(ap){}if(al.oneach){al.oneach(V,al.userdata);}if(ao<al.steps){return $setTimeout(function(){Z(ao+1);},al.interval);}F=null;if(al.control){al.control.state=J;}if(al.onfinish){al.onfinish(V,al.userdata);}K(V);};g(V,Z);return D.tween;},w=function(W,T,ai,aj){(ai=ai||{}).tweens=[];if(W.nodeFunc>100){W=W.$ext;}if(aj){D.setStyleClass(W,"",[T]);}var ae=function(ak,am){if(ak){D.setStyleClass(W,"",[T]);}else{D.setStyleClass(W,T);}for(var al=0;al<ai.tweens.length;al++){if(ai.tweens[al].type=="filter"){continue;}W.style[ai.tweens[al].type]="";}if(am){am.apply(this,arguments);}};var S=ai.onfinish,V=ai.onstop;ai.onfinish=function(){ae(aj,S);};ai.onstop=function(){ae(!aj,V);};var aa,X,ab,ad,ah,ag,Z,af,ac={};for(af=0;af<document.styleSheets.length;af++){Z=document.styleSheets[af][D.styleSheetRules];for(ad=Z.length-1;ad>=0;ad--){var Y=Z[ad];if(!Y.style||!Y.selectorText.match("."+T+"$")){continue;}for(ag in Y.style){if(!Y.style[ag]||c.indexOf("|"+ag+"|")==-1){continue;}if(ag=="filter"){if(!Y.style[ag].match(/opacity\=([\d\.]+)/)){continue;}X=RegExp.$1;aa=(D.getStyleRecur(W,ag)||"").match(/opacity\=([\d\.]+)/);ab=aa?RegExp.$1:100;ah=false;if(X==ab){if(aj){ab=100;}else{X=100;}}}else{X=aj&&W.style[ag]||Y.style[ag];if(aj){W.style[ag]="";}ab=D.getStyleRecur(W,ag);ah=ag.match(/color/i)?true:false;}ac[ag]={type:ag,from:(ah?String:parseFloat)(aj?X:ab),to:(ah?String:parseFloat)(aj?ab:X),color:ah,needsPx:A[ag.toLowerCase()]||false};}}}for(var U in ac){ai.tweens.push(ac[U]);}if(aj){D.setStyleClass(W,T);}return G(W,ai);},b=function(T,S,U){w(T,S,U,true);},A={left:true,top:true,bottom:true,right:true,width:true,height:true,fontSize:true,lineHeight:true,textIndent:true},c="|backgroundColor|backgroundPosition|color|width|filter|height|left|top|bottom|right|fontSize|letterSpacing|lineHeight|textIndent|opacity|paddingLeft|paddingTop|paddingRight|paddingBottom|borderLeftWidth|borderTopWidth|borderRightWidth|borderBottomWidth|borderLeftColor|borderTopColor|borderRightColor|borderBottomColor|marginLeft|marginTop|marginRight|marginBottom|transform|",E="|scale|rotate|";return{single:O,multi:G,css:w,cssRemove:b,clearQueue:d,addModule:function(S,T,U){if(typeof S!="string"||typeof T!="function"||(P[S]&&!U)){return this;}P[S]=T;return this;},NORMAL:0,EASEIN:1,EASEOUT:2,linear:function(T,U,S){return S*T+U;},easeInQuad:function(T,U,S){return S*R(T,2)+U;},easeOutQuad:function(T,U,S){return -S*T*(T-2)+U;},easeInOutQuad:function(T,U,S){if((T/=0.5)<1){return S/2*T*T+U;}return -S/2*((--T)*(T-2)-1)+U;},easeInCubic:function(T,U,S){return S*R(T,3)+U;},easeOutCubic:function(T,U,S){return S*(R(T-1,3)+1)+U;},easeInOutCubic:function(T,U,S){if((T/=0.5)<1){return S/2*R(T,3)+U;}return S/2*(R(T-2,3)+2)+U;},easeInQuart:function(T,U,S){return S*R(T,4)+U;},easeOutQuart:function(T,U,S){return -S*(R(T-1,4)-1)+U;},easeInOutQuart:function(T,U,S){if((T/=0.5)<1){return S/2*R(T,4)+U;}return -S/2*(R(T-2,4)-2)+U;},easeInQuint:function(T,U,S){return S*R(T,5)+U;},easeOutQuint:function(T,U,S){return S*(R(T-1,5)+1)+U;},easeInOutQuint:function(T,U,S){if((T/=0.5)<1){return S/2*R(T,5)+U;}return S/2*(R(T-2,5)+2)+U;},easeInSine:function(T,U,S){return -S*Math.cos(T*(Math.PI/2))+S+U;},easeOutSine:function(T,U,S){return S*Math.sin(T*(Math.PI/2))+U;},easeInOutSine:function(T,U,S){return -S/2*(Math.cos(Math.PI*T)-1)+U;},easeInExpo:function(T,U,S){return(T==0)?U:S*R(2,10*(T-1))+U;},easeOutExpo:function(T,U,S){return(T==1)?U+S:S*(-R(2,-10*T)+1)+U;},easeInOutExpo:function(T,U,S){if(T==0){return U;}if(T==1){return U+S;}if((T/=0.5)<1){return S/2*R(2,10*(T-1))+U;}return S/2*(-R(2,-10*--T)+2)+U;},easeInCirc:function(T,U,S){return -S*(Math.sqrt(1-T*T)-1)+U;},easeOutCirc:function(T,U,S){return S*Math.sqrt(1-(T-=1)*T)+U;},easeInOutCirc:function(T,U,S){if((T/=0.5)<1){return -S/2*(Math.sqrt(1-T*T)-1)+U;}return S/2*(Math.sqrt(1-(T-=2)*T)+1)+U;},easeInElastic:function(U,X,T){var V=1.70158,W=0.3,S=T;if(U==0){return X;}if(U==1){return X+T;}if(!S||S<Math.abs(T)){S=T;V=W/4;}else{V=W/(2*Math.PI)*Math.asin(T/S);}return -(S*R(2,10*(U-=1))*Math.sin((U*1-V)*(2*Math.PI)/W))+X;},easeOutElastic:function(U,X,T){var V=1.70158,W=0.3,S=T;if(U==0){return X;}if(U==1){return X+T;}if(S<Math.abs(T)){S=T;V=W/4;}else{V=W/(2*Math.PI)*Math.asin(T/S);}return S*R(2,-10*U)*Math.sin((U-V)*(2*Math.PI)/W)+T+X;},easeInOutElastic:function(U,X,T){var V=1.70158,W=0,S=T;if(U==0){return X;}if((U/2)==2){return X+T;}if(!W){W=0.3*1.5;}if(S<Math.abs(T)){S=T;V=W/4;}else{V=W/(2*Math.PI)*Math.asin(T/S);}if(U<1){return -0.5*(S*R(2,10*(U-=1))*Math.sin((U-V)*(2*Math.PI)/W))+X;}return S*R(2,-10*(U-=1))*Math.sin((U-V)*(2*Math.PI)/W)*0.5+T+X;},easeInBack:function(T,V,S){var U=1.70158;return S*R(T,2)*((U+1)*T-U)+V;},easeOutBack:function(T,V,S){var U=1.70158;return S*((T-=1)*T*((U+1)*T+U)+1)+V;},easeInOutBack:function(T,V,S){var U=1.70158;if((T/2)<1){return S/2*(T*T*(((U*=(1.525))+1)*T-U))+V;}return S/2*((T-=2)*T*(((U*=(1.525))+1)*T+U)+2)+V;},easeInBounce:function(T,U,S){return S-D.tween.easeOutBounce(1-T,0,S)+U;},easeOutBounce:function(T,U,S){if(T<(1/2.75)){return S*(7.5625*T*T)+U;}else{if(T<(2/2.75)){return S*(7.5625*(T-=(1.5/2.75))*T+0.75)+U;}else{if(T<(2.5/2.75)){return S*(7.5625*(T-=(2.25/2.75))*T+0.9375)+U;}else{return S*(7.5625*(T-=(2.625/2.75))*T+0.984375)+U;}}}},easeInOutBounce:function(T,U,S){if(T<1/2){return D.tween.easeInBounce(T*2,0,S)*0.5+U;}return D.tween.easeOutBounce(T*2-1,0,S)*0.5+S*0.5+U;}};})(apf);apf.date=(function(){return{masks:{"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"},i18n:{beginWeekday:1,dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNumbers:{Sun:0,Mon:1,Tue:2,Wed:3,Thu:4,Fri:5,Sat:6,Sunday:0,Monday:1,Tuesday:2,Wednesday:3,Thursday:4,Friday:5,Saturday:6},monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"],monthNumbers:{Jan:0,Feb:1,Mar:2,Apr:3,May:4,Jun:5,Jul:6,Aug:7,Sep:8,Oct:9,Nov:10,Dec:11}}};})();apf.date.dateFormat=(function(){var b=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,c=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,g=/[^-+\dA-Z]/g,d=function(k,j){k=String(k);j=j||2;while(k.length<j){k="0"+k;}return k;};return function(r,I,C){var n=apf.date;if(arguments.length==1&&(typeof r=="string"||r instanceof String)&&!/\d/.test(r)){I=r;r=undefined;}r=r?new Date(r):new Date();if(isNaN(r)){return"NaN";}I=String(n.masks[I]||I||n.masks["default"]);if(I.slice(0,4)=="UTC:"){I=I.slice(4);C=true;}var F=C?"getUTC":"get",w=r[F+"Date"](),j=r[F+"Day"](),t=r[F+"Month"](),B=r[F+"FullYear"](),E=r[F+"Hours"](),u=r[F+"Minutes"](),G=r[F+"Seconds"](),A=r[F+"Milliseconds"](),k=C?0:r.getTimezoneOffset(),q={d:w,dd:d(w),ddd:n.i18n.dayNames[j],dddd:n.i18n.dayNames[j+7],m:t+1,mm:d(t+1),mmm:n.i18n.monthNames[t],mmmm:n.i18n.monthNames[t+12],yy:String(B).slice(2),yyyy:B,h:E%12||12,hh:d(E%12||12),H:E,HH:d(E),M:u,MM:d(u),s:G,ss:d(G),l:d(A,3),L:d(A>99?Math.round(A/10):A),t:E<12?"a":"p",tt:E<12?"am":"pm",T:E<12?"A":"P",TT:E<12?"AM":"PM",Z:C?"UTC":(String(r).match(c)||[""]).pop().replace(g,""),o:(k>0?"-":"+")+d(Math.floor(Math.abs(k)/60)*100+Math.abs(k)%60,4),S:["th","st","nd","rd"][w%10>3?0:(w%100-w%10!=10)*w%10]};return I.replace(b,function(m){return m in q?q[m]:m.slice(1,m.length-1);});};})();apf.date.getDateTime=function(r,w){var j=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g;var n=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC:)(?:[-+]\d{4})?)\b/g;var b=0;var c,u=new Date().getFullYear(),g=1,q=1,k=12,o=0,B=0;var A=apf.date.i18n;if(!w){throw new Error(apf.formatErrorString(0,null,"date-format","Date format is null"));}w=w.replace(n,"");var t=w.replace(j,function(E,D,C){var d=r.substring(C+b,C+b+E.length);switch(E){case"d":case"m":case"h":case"H":case"M":case"s":if(!/[\/, :\-](d|m|h|H|M|s)$|^(d|m|h|H|M|s)[\/, :\-]|[\/, :\-](d|m|h|H|M|s)[\/, :\-]/.test(w)){throw new Error(apf.formatErrorString(0,null,"date-format","Dates without leading zero needs separators"));}var s=parseInt(r.substring(C+b,C+b+2));if(s.toString().length==2){b++;}return E=="d"?q=s:(E=="m"?g=s:(E=="M"?o=s:(E=="s"?B=s:k=s)));case"dd":return q=d;case"dddd":b+=A.dayNames[A.dayNumbers[d.substring(0,3)]+7].length-4;break;case"mm":return g=d;case"mmm":return g=A.monthNumbers[d]+1;case"mmmm":var m=A.monthNumbers[d.substring(0,3)];b+=A.monthNames[m+12].length-4;return g=m+1;case"yy":return u=parseInt(d)<70?"20"+d:d;case"yyyy":return u=d;case"hh":return k=d;case"HH":return k=d;case"MM":return o=d;case"ss":return B=d;case"'T'":case"'Z'":b-=2;break;}});return new Date(u,g-1,q,k,o,B);};Date.prototype.format=function(b,c){return apf.date.dateFormat(this,b,c);};Date.parse=function(c,b){return apf.date.getDateTime(c,b);};apf.xmldb=new (function(){this.xmlDocTag="a_doc";this.xmlIdTag="a_id";this.xmlListenTag="a_listen";this.htmlIdTag="id";this.disableRDB=false;this.$xmlDocLut=[];this.$nodeCount={};this.getElementById=function(g,d){if(!d){d=this.$xmlDocLut[g.split("|")[0]];}if(!d){return false;}return d.selectSingleNode("descendant-or-self::node()[@"+this.xmlIdTag+"='"+g+"']");};this.getNode=function(d){if(!d||!d.getAttribute(this.htmlIdTag)){return false;}return this.getElementById(d.getAttribute(this.htmlIdTag).split("|",2).join("|"));};this.getNodeById=function(j,g){var d=j.split("|");d.pop();return this.getElementById(d.join("|"),g);};this.getDocumentById=function(d){return this.$xmlDocLut[d];};this.getDocument=function(d){return this.$xmlDocLut[d.getAttribute(this.xmlIdTag).split("|")[0]];};this.getID=function(d,g){return d.getAttribute(this.xmlIdTag)+"|"+g.$uniqueId;};this.getElement=function(m,n){var d=m.childNodes;for(var g=0,k=0;k<d.length;k++){if(d[k].nodeType!=1){continue;}if(g++==n){return d[k];}}};this.setModel=function(d){apf.nameserver.register("model",d.data.ownerDocument.documentElement.getAttribute(this.xmlDocTag),d);};this.findModel=function(d){return apf.nameserver.get("model",d.ownerDocument.documentElement.getAttribute(this.xmlDocTag));};this.getXmlId=function(d){return d.getAttribute(this.xmlIdTag)||this.nodeConnect(apf.xmldb.getXmlDocId(d),d);};this.getHtmlNode=function(d,g){if(d&&d.nodeType==1&&d.getAttribute(this.xmlIdTag)){return g.$findHtmlNode(d.getAttribute(this.xmlIdTag)+"|"+g.$uniqueId);}return null;};this.findHtmlNode=function(d,g){do{if(d.nodeType==1&&d.getAttribute(this.xmlIdTag)){return g.$findHtmlNode(d.getAttribute(this.xmlIdTag)+"|"+g.$uniqueId);}if(d==g.xmlRoot){return null;}d=d.parentNode;}while(d&&d.nodeType!=9);return null;};this.findXmlNode=function(d){if(!d){return false;}var g;while(d&&d.nodeType==1&&(d.tagName.toLowerCase()!="body"&&!(g=d.getAttribute(this.htmlIdTag))||(g||(g=d.getAttribute(this.htmlIdTag)))&&g.match(/^q/))){if(d.host&&d.host.$ext==d){return d.host.xmlRoot;}d=d.parentNode;}if(!d||d.nodeType!=1){return false;}if(d.tagName.toLowerCase()=="body"){return false;}return this.getNode(d);};this.getXml=apf.getXml;this.nodeConnect=function(j,g,m,n){if(!this.$nodeCount[j]){this.$nodeCount[j]=0;}var k;k=g.getAttribute(this.xmlIdTag)||g.setAttribute(this.xmlIdTag,(k=j+"|"+ ++this.$nodeCount[j]))||k;if(!n){return k;}var d=k+"|"+n.$uniqueId;if(m){m.setAttribute(this.htmlIdTag,d);}return d;};this.$listeners=[];this.addNodeListener=function(g,m,j){if(!m||(!m.$xmlUpdate&&!m.setProperty)){throw new Error(apf.formatErrorString(1040,null,"Adding Node listener","Interface not supported."));}var n,d=String(g.getAttribute(this.xmlListenTag)||"");if(!j){j=String(m.$uniqueId);}if(j.charAt(0)=="p"){var k=j.split("|");n=this.$listeners.push(function(){var o=apf.all[k[1]];if(o){o.$execProperty(k[2],g);}})-1;this.$listeners[j]=n;}else{n="e"+j;if(!this.$listeners[n]){this.$listeners[n]=function(o){var q=apf.all[j];if(q){q.$xmlUpdate.apply(q,o);}};}}if(!d||d.indexOf(n+";")==-1){g.setAttribute(this.xmlListenTag,(d?d+n:n)+";");}return g;};this.removeNodeListener=function(k,n,q){var j=k.getAttribute(this.xmlListenTag);var d=(j?j.split(";"):[]);if(q&&q.charAt(0)=="p"){q=this.$listeners[q];delete this.$listeners[q];}else{q="e"+n.$uniqueId;}for(var m=[],g=0;g<d.length;g++){if(d[g]!=q){m.push(d[g]);}}k.setAttribute(this.xmlListenTag,m.join(";"));return k;};this.setTextNode=apf.setTextNode=function(g,k,d,m){var j;if(d){j=g.selectSingleNode(d);if(!j){return;}g=j.nodeType==1?j:null;}if(g.nodeType!=1){j=g;}else{if(g||!j){j=g.selectSingleNode("text()");if(!j){j=g.appendChild(g.ownerDocument.createTextNode(""));}}}if(m){m.extra.oldValue=j.nodeValue;}j.nodeValue=k;if(j.$regbase){j.$setValue(k);}this.applyChanges("text",j.parentNode,m);};this.setAttribute=apf.setAttribute=function(j,g,k,d,m){(d?j.selectSingleNode(d):j).setAttribute(g,k);this.applyChanges("attribute",j,m);};this.removeAttribute=apf.removeAttribute=function(j,g,d,k){if(k){k.name=g;}(d?j.selectSingleNode(d):j).removeAttribute(g);this.applyChanges("attribute",j,k);};this.replaceNode=apf.replaceNode=function(j,k,g,m){if(g){k=k.selectSingleNode(g);}if(m){m.oldNode=k;m.xmlNode=j;}var d=k.parentNode;d.replaceChild(j,k);this.copyConnections(k,j);this.applyChanges("replacechild",j,m);return j;};this.addChildNode=apf.addChildNode=function(n,m,d,g,o){var k=n.insertBefore(n.ownerDocument.createElement(m),g);for(var j=0;j<d.length;j++){k.setAttribute(d[j][0],d[j][1]);}if(o){o.extra.addedNode=k;}this.applyChanges("add",k,o);return k;};this.appendChild=apf.appendChild=function(m,k,g,o,d,n){if(o&&m.selectSingleNode(k.tagName)){return false;}if(n){this.cleanNode(k);}if(m.ownerDocument.importNode&&m.ownerDocument!=k.ownerDocument){k=m.ownerDocument.importNode(k,true);}if(d){var j=[];var m=apf.createNodeFromXpath(m,d,j);if(j.length){m.appendChild(k);while(j.length){if(m==j.pop()&&j.length){m=m.parentNode;}}}}else{if(k.parentNode){this.removeNode(k);}}m.insertBefore(k,g);this.applyChanges("add",k,n);return k;};this.moveNode=apf.moveNode=function(k,j,g,d,m){if(!m){m={extra:{}};}m.extra.oldParent=j.parentNode;m.extra.beforeNode=j.nextSibling;m.extra.parent=(d?k.selectSingleNode(d):k);this.applyChanges("move-away",j,m);if(!apf.isWebkit&&apf.xmldb.getXmlDocId(j)!=apf.xmldb.getXmlDocId(k)){j.removeAttributeNode(j.getAttributeNode(this.xmlIdTag));this.nodeConnect(apf.xmldb.getXmlDocId(k),j);}if(apf.isWebkit&&k.ownerDocument!=j.ownerDocument){j=k.ownerDocument.importNode(j,true);}m.extra.parent.insertBefore(j,g);this.applyChanges("move",j,m);};this.removeNode=apf.removeNode=function(g,d,k){if(d){g=g.selectSingleNode(d);}if(k){k.extra.parent=g.parentNode;k.extra.removedNode=g;k.extra.beforeNode=g.nextSibling;}this.applyChanges("remove",g,k);var j=g.parentNode;j.removeChild(g);this.applyChanges("redo-remove",g,null,j);};this.removeNodeList=apf.removeNodeList=function(d,m){for(var j=[],g=0;g<d.length;g++){if(m){j.push({pNode:d[g].parentNode,removedNode:d[g],beforeNode:d[g].nextSibling});}this.applyChanges("remove",d[g],m);var k=d[g].parentNode;k.removeChild(d[g]);this.applyChanges("redo-remove",d[g],null,k);}if(m){m.extra.removeList=j;}};var c={},b;this.$hasQueue=false;this.applyChanges=function(o,A,C,k){if(C&&C.$dontapply){return;}if(C&&!C.xmlNode){C.xmlNode=A;}var d=k,B=(A.nodeType==1?A:A.parentNode);if(!this.delayUpdate&&"|remove|move-away|".indexOf("|"+o+"|")>-1){this.notifyQueued();}var n,w,t,s,q,r,g,m,u,D;while(B&&B.nodeType==1){n=B.getAttribute(this.xmlListenTag);if(n){t=n.split(";");for(s=0;s<t.length;s++){w=t[s];r=c[w];if(!r){c[w]=r=[];}if("|update|attribute|text|".indexOf("|"+o+"|")>-1){D=false;for(q=0;q<r.length;q++){if(r[q]&&A==r[q][1]&&"|update|attribute|text|".indexOf("|"+r[q][0]+"|")>-1){r[q]=null;D=true;continue;}}r.push(["update",A,B,C,d]);u=true;continue;}if("|remove|move-away|move|add|".indexOf("|"+o+"|")>-1){if(this.$listeners[w]){this.$listeners[w]([o,A,B,C,d]);}}else{r.push([o,A,B,C,d]);u=true;}}}B=B.parentNode||k;if(B==k){k=null;}}if(C&&!this.delayUpdate){apf.xmldb.notifyQueued();}else{if(u){clearTimeout(b);this.$hasQueue=true;b=$setTimeout(function(){apf.xmldb.notifyQueued();});}}};this.notifyQueued=function(){this.$hasQueue=false;clearTimeout(b);for(var j in c){if(!j){continue;}var k=c[j];var g=this.$listeners[j];if(!k){continue;}for(var d=0;d<k.length;d++){if(!k[d]){continue;}g(k[d]);}}c={};};this.notifyListeners=function(k){var g=k.getAttribute(apf.xmldb.xmlListenTag);if(g){g=g.split(";");for(var d=0;d<g.length;d++){apf.all[g[d]].$xmlUpdate("synchronize",k,k);}}};this.copyConnections=function(g,d){try{d.setAttribute(this.xmlListenTag,g.getAttribute(this.xmlListenTag));}catch(j){}try{d.setAttribute(this.xmlIdTag,g.getAttribute(this.xmlIdTag));}catch(j){}};this.cleanNode=function(j){try{var g,d=j.selectNodes("descendant-or-self::node()[@"+this.xmlListenTag+"]");for(g=d.length-1;g>=0;g--){d[g].removeAttribute(this.xmlListenTag);}d=j.selectNodes("descendant-or-self::node()[@"+this.xmlIdTag+"]");for(g=d.length-1;g>=0;g--){d[g].removeAttribute(this.xmlIdTag);}d=j.selectNodes("descendant-or-self::node()[@"+this.xmlDocTag+"]");for(g=d.length-1;g>=0;g--){d[g].removeAttribute(this.xmlDocTag);}d=j.selectNodes("descendant-or-self::node()[@a_loaded]");for(g=d.length-1;g>=0;g--){d[g].removeAttribute("a_loaded");}}catch(k){}return j;};this.copy=this.getCleanCopy=apf.getCleanCopy=function(d){return apf.xmldb.cleanNode(d.cloneNode(true));};this.unbind=function(q){for(var s={},n=0;n<q.apf.all.length;n++){if(q.apf.all[n]&&q.apf.all[n].unloadBindings){s[q.apf.all[n].unloadBindings()]=true;}}for(var d=0;d<this.$xmlDocLut.length;d++){if(!this.$xmlDocLut[d]){continue;}var r=this.$xmlDocLut[d].selectNodes("//self::node()[@"+this.xmlListenTag+"]");if(!r){continue;}for(var n=0;n<r.length;n++){var m=r[n].getAttribute(this.xmlListenTag).split(";");for(var o=[],g=0;g<m.length;g++){if(!s[m[g]]){o.push(m[g]);}}if(o.length!=m.length){r[n].setAttribute(this.xmlListenTag,o.join(";"));}}}};this.getXmlDocId=function(j,d){var k=j.ownerDocument.documentElement;if(!apf.isChildOf(k,j)){k=j;}var g=(k||j).getAttribute(this.xmlDocTag)||this.$xmlDocLut.indexOf(k||j.ownerDocument||j);if(!g||g==-1){g=this.$xmlDocLut.push(k||j.ownerDocument||j)-1;if(k){k.setAttribute(this.xmlDocTag,g);}}if(d){apf.nameserver.register("model",g,d);}return g;};});apf.queue={q:{},timer:null,add:function(c,b){this.q[c]=b;if(!this.timer){this.timer=$setTimeout("apf.queue.empty()");}},remove:function(b){delete this.q[b];},empty:function(d){clearTimeout(this.timer);this.timer=null;if(apf.layout&&apf.layout.$hasQueue){apf.layout.processQueue();}if(apf.xmldb&&apf.xmldb.$hasQueue){apf.xmldb.notifyQueued();}var c=this.q;for(var d in c){var b=c[d];if(b){delete c[d];b();}}}};apf.storage={modules:{},init:function(b){if(!b){b=this.autodetect();}var c=this.getProvider(b);apf.storage=apf.extend(this,c);apf.storage.init=null;apf.console.info("Installed storage provider '"+b+"'");return c;},getProvider:function(b){var c=apf.storage.modules[b];if(!c||typeof c!="object"){apf.console.warn("Could not find storage provider '"+b+"'");return false;}if(!c.isAvailable()){apf.console.warn("Storage provider '"+b+"' is not available");return false;}if(!c.initialized&&(!c.init||c.init()===false)){apf.console.warn("Could not install storage provider '"+b+"");return false;}c.name=b;apf.extend(c,this.base);return c;},autodetect:function(){for(var b in this.modules){if("memory|cookie".indexOf(b)>-1){continue;}if(this.modules[b].isAvailable()){return b;}}return !location.host&&this.modules.cookie?"cookie":(this.modules.memory?"memory":null);},base:{namespace:"default",isValidKeyArray:function(b){return(!b||!b.join)?false:/^[0-9A-Za-z_\.\-]*$/.test(b.join(""));},isValidKey:function(b){return(b===null||b===undefined)?false:/^[0-9A-Za-z_\.\-]*$/.test(b);},getAllPairs:function(g,c){var j=this.getKeys(g);if(!j||!j.length){return;}var b=this.getMultiple(j,g);for(var d=0;d<j.length&&b;d++){if(b[d]){c[j[d]]=b[d];}}return j.length;}}};apf.Sort=function(c){var d={};this.parseXml=function(n,k){if(k){d={};}d.order=n.order;d.getValue=n.csort||n.$compile("sort");d.getNodes=self[n["nodes-method"]];d.ascending=(d.order||"").indexOf("desc")==-1;d.order=null;if(n["data-type"]){d.method=g[n["data-type"]];}else{if(n["sort-method"]){d.method=self[n["sort-method"]];if(!d.method){throw new Error(apf.formatErrorString(0,null,"Sorting nodes","Invalid or missing sort function name provided '"+n["sort-method"]+"'",n));}}else{d.method=g.alpha;}}var o=n["date-format"];if(o){d.sort_dateFmtStr=o;d.method=g.date;var j=o.match(/(D+|Y+|M+|h+|m+|s+)/g);if(j){for(var q={},m=0;m<j.length;m++){q[j[m].substr(0,1)]=m+1;}d.dateFormat=new RegExp(o.replace(/([^\sDYMhms])/g,"\\$1").replace(/YYYY/,"(\\d\\d\\d\\d)").replace(/(DD|YY|MM|hh|mm|ss)/g,"(\\d\\d)"));d.dateReplace="$"+q.M+"/$"+q.D+"/$"+q.Y;if(q.h){d.dateReplace+=" $"+q.h+":$"+q.m+":$"+q.s;}}}};this.set=function(k,j){if(j){d={};}apf.extend(d,k);if(!d.ascending){d.ascending=k.order?k.order.indexOf("desc")==-1:true;}d.order=null;if(k.type){d.method=g[k.type];}else{if(k.method){d.method=self[k.method];}else{if(!d.method){d.method=g.alpha;}}}if(!d.getValue){d.getValue=function(m){return apf.queryValue(m,d.xpath);};}};this.get=function(){return apf.extend({},d);};this.findSortSibling=function(n,m){var j=getNodes?getNodes(n,m):this.getTraverseNodes(n);for(var k=0;k<j.length;k++){if(!compare(m,j[k],true,sortSettings)){return j[k];}}return null;};var b=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000"];var g={alpha:function(j){return j.toString().toLowerCase();},number:function(j){return(j.length<b.length?b[b.length-j.length]:"")+j;},date:function(k,j){var m=d.dateFormat;var o=d.dateReplace;var q=d.sort_dateFmtStr;var n;if(!m){n=new Date(k);}else{if(q=="*"){n=Date.parse(k);}else{n=(new Date(k.replace(m,o))).getTime();}}k=""+n.getTime();if(k=="NaN"){k="0";}return(k.length<b.length?b[b.length-k.length]:"")+k;}};this.apply=function(k,t,m,j,r){var u=[],q=k.length;while(q--){var w=d.getValue(k[q]);if(k){u[u.length]={toString:function(){return this.v;},xmlNode:k[q],v:(d.method||g.alpha)(w||"",t,k[q])};}}u.sort();var o=r?Math.min(u.length,j+r):u.length;if(!j){j=0;}if(m){if(d.ascending){for(q=j;q<o;q++){f(q,o,u[q].xmlNode,u[q].v);}}else{for(q=o-1;q>=j;q--){f(o-q-1,o,u[q].xmlNode,u[q].v);}}}else{var s=[];if(d.ascending){for(q=j;q<o;q++){s[s.length]=u[q].xmlNode;}}else{for(q=o-1;q>=j;q--){s[s.length]=u[q].xmlNode;}}return s;}};if(c){this.parseXml(c);}};apf.skins={skins:{},css:[],events:["onmousemove","onmousedown","onmouseup","onmouseout","onclick","ondragcopy","ondragstart"],Init:function(q,m,r){var d=(m?m.getAttribute("id"):null)||q.getAttribute("id");var g=(m?m.getAttribute("src").match(/\//)||r:"")?(r||m.getAttribute("src")).replace(/\/[^\/]*$/,"")+"/":"";var j=null,n=null;j=q.getAttribute("media-path");if(j!==null){j=apf.getAbsolutePath(g||apf.hostPath,j);}else{if(m){j=m.getAttribute("media-path");if(j!==null){j=apf.getAbsolutePath(apf.hostPath,j);}else{j=apf.getAbsolutePath(g||apf.hostPath,"images/");}}}n=q.getAttribute("icon-path");if(n!==null){n=apf.getAbsolutePath(g||apf.hostPath,n);}else{if(m){n=m.getAttribute("icon-path");if(n!==null){n=apf.getAbsolutePath(apf.hostPath,n);}else{n=apf.getAbsolutePath(g||apf.hostPath,"icons/");}}}if(!d){d="default";}if(q.getAttribute("id")){document.body.className+=" "+q.getAttribute("id");}var o=d.split("|");d=o[0];if(!this.skins[d]||d=="default"){this.skins[d]={base:g,name:d,iconPath:n,mediaPath:j,templates:{},originals:{},xml:q};if(o.length>1){for(var k=0;k<o.length;k++){this.skins[o[k]]=this.skins[d];}}}if(!this.skins["default"]&&this.$first==m){this.skins["default"]=this.skins[d];}var c=q.childNodes;for(var k=c.length-1;k>=0;k--){if(c[k].nodeType!=1){continue;}this.skins[d].templates[c[k].getAttribute("name")]=c[k];if(c[k].ownerDocument){this.importSkinDef(c[k],g,d);}}this.purgeCss(j,n);if(this.queue[d]){for(var b in this.queue[d]){this.queue[d][b]();}}},loadStylesheet:function(filename,title){var o;with(o=document.getElementsByTagName("head")[0].appendChild(document.createElement("LINK"))){rel="stylesheet";type="text/css";href=filename;title=title;}return o;},importSkinDef:function(xmlNode,basepath,name){var i,l,nodes=$xmlns(xmlNode,"style",apf.ns.aml),tnode,node;for(i=0,l=nodes.length;i<l;i++){node=nodes[i];if(node.getAttribute("src")){this.loadStylesheet(node.getAttribute("src").replace(/src/,basepath+"/src"));}else{var test=true;if(node.getAttribute("condition")){try{test=eval(node.getAttribute("condition"));}catch(e){test=false;}}if(test){tnode=node.firstChild;while(tnode){this.css.push(tnode.nodeValue);tnode=tnode.nextSibling;}}}}nodes=$xmlns(xmlNode,"alias",apf.ns.apf);var t=this.skins[name].templates;for(i=0;i<nodes.length;i++){if(!nodes[i].firstChild){continue;}t[nodes[i].firstChild.nodeValue.toLowerCase()]=xmlNode;}},loadedCss:"",purgeCss:function(b,d){if(!this.css.length){return;}var c=this.css.join("\n").replace(/images\//g,b).replace(/icons\//g,d);apf.importCssString(c);this.css=[];},loadCssInWindow:function(b,n,d,k){this.css=[];var c=b.split(":");var m=this.skins[c[0]];var g=m.templates[c[1]];this.importSkinDef(g,m.base,m.name);var j=this.css.join("\n").replace(/images\//g,d).replace(/icons\//g,k);apf.importCssString(j);this.css=[];},setSkinPaths:function(b,d){b=b.split(":");var c=b[0];var g=b[1];if(!this.skins[c]){throw new Error(apf.formatErrorString(1076,null,"Retrieving Skin","Could not find skin '"+c+"'",d.$aml));}d.iconPath=this.skins[c].iconPath;d.mediaPath=this.skins[c].mediaPath;},getTemplate:function(d,c){d=d.split(":");var j=d[0];var m=d[1];if(!this.skins[j]){if(c){return false;}throw new Error(apf.formatErrorString(1077,null,"Retrieving Template","Could not find skin '"+j+"'"));return false;}if(!this.skins[j].templates[m]){return false;}var n=this.skins[j].templates[m];var b=this.skins[j].originals[m];if(!b){b=this.skins[j].originals[m]={};if(!$xmlns(n,"presentation",apf.ns.aml)[0]){throw new Error(apf.formatErrorString(1078,null,"Retrieving Template","Missing presentation tag in '"+j+"'"));}var g=$xmlns(n,"presentation",apf.ns.aml)[0].childNodes;for(var k=0;k<g.length;k++){if(g[k].nodeType!=1){continue;}b[g[k].baseName||g[k][apf.TAGNAME]]=g[k];}}return b;},getCssString:function(b){return apf.queryValue($xmlns(this.skins[b.split(":")[0]].xml,"style",apf.ns.aml)[0],"text()");},queue:{},waitForSkin:function(b,d,c){if(this.skins[b]){return;}(this.queue[b]||(this.queue[b]={}))[d]=c;return true;},iconMaps:{},addIconMap:function(b){this.iconMaps[b.name]=b;if(b.size){b.width=b.height=b.size;}else{if(!b.width){b.width=1;}if(!b.height){b.height=1;}}},setIcon:function(d,n,b){if(!n){d.style.backgroundImage="";return;}if(d.tagName.toLowerCase()=="img"){d.setAttribute("src",n?(b||"")+n:"");return;}var m=n.split(":");var k=this.iconMaps[m[0]];if(k){var j,g,c=m[1].split(",");j=(c[(k.type=="vertical")?1:0]||0)*k.width;g=(c[(k.type=="vertical")?0:1]||0)*k.height;d.style.backgroundImage="url("+(b||"")+k.src+")";d.style.backgroundPosition=((-1*j)-k.offset[0])+"px "+((-1*g)-k.offset[1])+"px";}else{d.style.backgroundImage="url("+(b||"")+n+")";}}};apf.layout={layouts:{},addParent:function(c,b){var d;if(!(d=c.getAttribute("id"))){d=apf.setUniqueHtmlId(c);}return this.layouts[d]={layout:new apf.layoutParser(c,b),controls:[]};},splitters:{},freesplitters:[],vars:{},getSplitter:function(b){if(!this.splitters[this.getHtmlId(b.parentNode)]){this.splitters[this.getHtmlId(b.parentNode)]=[];}if(this.freesplitters.length){var c=this.freesplitters.pop();}else{var c=new apf.splitter();var d=apf.findHost(b.parentNode)||apf.document.documentElement;c.parentNode=d;c.skinset=apf.getInheritedAttribute(d,"skinset");c.dispatchEvent("DOMNodeInsertedIntoDocument");}this.splitters[this.getHtmlId(b.parentNode)].push(c);return c;},clearSplitters:function(d){var b=this.splitters[this.getHtmlId(d.parentNode)];if(!b){return;}for(var c=0;c<b.length;c++){this.freesplitters.push(b[c]);if(!b[c].$ext.parentNode){continue;}b[c].$ext.parentNode.removeChild(b[c].$ext);}b.length=0;},get:function(d,b){var c=this.layouts[d.getAttribute("id")];if(!c){c=this.addParent(d,b);}return c;},isLoadedXml:function(j){var b=j.childNodes;var k=j.selectSingleNode(".//node[@name]");var g=k?self[k.getAttribute("name")]:null;if(!g){throw new Error(apf.formatErrorString(0,null,"Loading Alignment from XML","Could not find AML node"+(k?" by name '"+k.getAttribute("name")+"'":""),j));}var d=g.$ext.parentNode;var c=this.getHtmlId(d);return(this.loadedXml[c]==j);},$loadFrom:function(b){apf.getData(b,{callback:function(c){if(!c){return;}if(!c){throw new Error(apf.formatErrorString(0,null,"Loading default layout","Could not find default layout using processing                      instruction: '"+b+"'"));return;}apf.layout.loadXml(c);}});},loadedXml:{},cacheXml:{},loadXml:function(k){var b=k.childNodes;var n=k.selectSingleNode(".//node[@name]");var j=n?self[n.getAttribute("name")]:null;if(!j){throw new Error(apf.formatErrorString(0,null,"Loading Alignment from XML","Could not find AML node"+(n?" by name '"+n.getAttribute("name")+"'":""),k));}var g=j.$ext.parentNode;var m=this.get(g,apf.getBox(k.getAttribute("margin")||""));var d=this.getHtmlId(g);this.metadata=[];for(var c=0;c<b.length;c++){if(b[c].nodeType!=1){continue;}m.root=this.parseXml(b[c],m);break;}this.compile(g);if(apf.window.inited){this.activateRules(g);}this.loadedXml[d]=k;},metadata:[],getData:function(b,c){return{vbox:(b=="vbox"),hbox:(b=="hbox"),node:"vbox|hbox".indexOf(b)==-1,children:[],isRight:false,isBottom:false,edgeMargin:0,splitter:null,minwidth:0,minheight:0,weight:1,pHtml:c.parentNode,size:[300,200],position:[0,0],last:{},toString:function(){var g=apf.vardump(this,null,false);for(var d=0;d<this.children.length;d++){g+="\n{Child "+d+"\n===========\n"+this.children[d].toString()+"}";}return g;},copy:function(){var g=apf.extend({},this);g.toString=this.toString;if(!this.node){g.children=[];for(var d=0;d<this.children.length;d++){g.children[d]=this.children[d].copy();g.children[d].parent=g;}}return g;},hidden:false,hiddenChildren:[],prehide:function(j){if(this.hidden==3){this.hidden=true;if(this.hid){apf.lookup(this.hid).visible=false;}if(this.oHtml){this.oHtml.style.display="none";}return;}if(this.hidden&&!j){return;}if(!this.parent){return;}this.hidepos={prev:this.parent.children[this.stackId-1],next:this.parent.children[this.stackId+1]};this.hidden=true;var g,o,n=0,k,d,m=["children","hiddenChildren"];while(m.length){g=this.parent[m.pop()];for(k=0,d=g.length;k<d;k++){o=g[k];if(o!=this&&!o.hidden){n=1;break;}}}if(!n){this.parent.prehide(j);}if(j){return this.hide(true);}if(apf.layout.dlist.contains(this)){apf.layout.dlist.remove(this);return false;}else{apf.layout.dlist.pushUnique(this);}},preshow:function(d){if(!this.hidden){return;}this.hidden=false;if(d){return this.show(true);}if(this.parent.hidden){this.parent.preshow();}if(apf.layout.dlist.contains(this)){apf.layout.dlist.remove(this);return false;}else{apf.layout.dlist.pushUnique(this);}},hide:function(g){var d=this.parent.children;d.removeIndex(this.stackId);for(var j=0;j<d.length;j++){d[j].stackId=j;}this.parent.hiddenChildren.push(this);if(g){return;}if(this.hidden!=3){if(this.hid){apf.lookup(this.hid).visible=false;}if(this.oHtml){this.oHtml.style.display="none";}}},show:function(g){var d=this.parent.children;if(this.hidepos.prev&&this.hidepos.prev.parent==this.parent&&!this.hidepos.prev.hidden&&!apf.layout.dlist.contains(this.hidepos.prev)){if(d.length<this.hidepos.prev.stackId+1){d.push(this);}else{d.insertIndex(this,this.hidepos.prev.stackId+1);}}else{if(this.hidepos.next&&this.hidepos.next.parent==this.parent&&!this.hidepos.next.hidden&&!apf.layout.dlist.contains(this.hidepos.next)){if(this.hidepos.next.stackId==0){d.unshift(this);}else{if(d.length<this.hidepos.next.stackId-1){d.push(this);}else{d.insertIndex(this,this.hidepos.next.stackId-1);}}}else{if(!this.hidepos.prev){d.unshift(this);}else{if(!this.hidepos.next){d.push(this);}else{if(this.stackId<d.length){d.insertIndex(this,this.stackId);}else{d.push(this);}}}}}for(var j=0;j<d.length;j++){if(d[j]){d[j].stackId=j;}}this.parent.hiddenChildren.remove(this);if(!g){if(this.hidden!=3){if(this.hid){apf.lookup(this.hid).visible=true;}if(this.oHtml){this.oHtml.style.display="block";}}}this.hidden=false;this.hidepos=null;},remove:function(){var j=this.parent;if(!j){return;}if(this.hidden||j.hiddenChildren.contains(this)){j.hiddenChildren.remove(this);apf.layout.dlist.remove(this);}else{var d=j.children;d.remove(this);for(var g=0;g<d.length;g++){d[g].stackId=g;}}for(var k in this.last){if(k=="splitter"){if(j.originalMargin){if(j.parent.pOriginalMargin){j.parent.splitter=null;j.parent.edgeMargin=j.parent.pOriginalMargin[0];j.parent.pOriginalMargin=null;delete j.last.splitter;}j.splitter=null;j.edgeMargin=j.originalMargin[0];j.originalMargin=null;}}this[k]=j[k]||this.last[k];}this.last={};if(!j.children.length&&!j.hiddenChildren.length){j.remove();}this.parent=null;},add:function(j){this.parent=j;if(this.hidden){var d=j.hiddenChildren;d.push(this);}else{var d=j.children;d.push(this);for(var g=0;g<d.length;g++){if(d[g]){d[g].stackId=g;}}}}};},parseXml:function(x,layout,amlNode,norecur){var aData=this.getData(typeof amlNode=="string"?amlNode:x.localName||x[apf.TAGNAME],layout.layout);if(aData.node){if(!amlNode){amlNode=self[x.getAttribute("name")];if(!amlNode){throw new Error(apf.formatErrorString(0,null,"Parsing Alignment from XML","Could not find AML node"+x.getAttribute("name"),x));}}aData.oHtml=amlNode.$ext;amlNode.aData=aData;amlNode.$setLayout("alignment");var aml=amlNode;if(aml.getAttribute("width")){aData.fwidth=aml.getAttribute("width");}if(aml.getAttribute("height")){aData.fheight=aml.getAttribute("height");}if(!this.getHtmlId(aData.oHtml)){apf.setUniqueHtmlId(aData.oHtml);}aData.id=this.getHtmlId(aData.oHtml);if(aData.oHtml.style){aData.oHtml.style.position="absolute";}aData.hid=amlNode.$uniqueId;}else{aData.id=this.metadata.push(aData)-1;}if(x.getAttribute("align")){aData.template=x.getAttribute("align");}if(x.getAttribute("lean")){aData.isBottom=x.getAttribute("lean").match(/bottom/);}if(x.getAttribute("lean")){aData.isRight=x.getAttribute("lean").match(/right/);}if(x.getAttribute("edge")&&x.getAttribute("edge")!="splitter"){aData.edgeMargin=x.getAttribute("edge");}if(x.getAttribute("weight")){aData.weight=parseFloat(x.getAttribute("weight"));}if(x.getAttribute("splitter")||x.getAttribute("edge")=="splitter"){aData.splitter=x.getAttribute("splitter")||(x.getAttribute("edge")=="splitter"?4:false);}if(x.getAttribute("width")){aData.fwidth=String(apf.parseExpression(x.getAttribute("width")));}if(x.getAttribute("height")){aData.fheight=String(apf.parseExpression(x.getAttribute("height")));}if(x.getAttribute("lastsplitter")){aData.lastsplitter=x.getAttribute("lastsplitter");}if(x.getAttribute("hidden")){aData.hidden=(x.getAttribute("hidden")==3)?x.getAttribute("hidden"):apf.isTrue(x.getAttribute("hidden"));}else{if(x.getAttribute("visible")=="false"){aData.hidden=true;}}if(x.getAttribute("state")){aData.state=x.getAttribute("state");}if(x.getAttribute("stack")){aData.stackId=parseInt(x.getAttribute("stack"));}if(x.getAttribute("position")){aData.position=x.getAttribute("position").split(",");}if(x.getAttribute("size")){aData.size=x.getAttribute("size").split(",");}if(aData.fwidth&&aData.fwidth.indexOf("/")>-1){aData.fwidth=eval(aData.fwidth);if(aData.fwidth<=1){aData.fwidth=(aData.fwidth*100)+"%";}}if(aData.fheight&&aData.fheight.indexOf("/")>-1){aData.fheight=eval(aData.fheight);if(aData.fheight<=1){aData.fheight=(aData.fheight*100)+"%";}}aData.edgeMargin=Math.max(aData.splitter||0,aData.edgeMargin||0);aData.xml=x;return aData;},checkInheritance:function(j){var g=j.children[j.children.length-1];if(j.originalMargin){if(j.parent.pOriginalMargin){j.parent.splitter=null;j.parent.edgeMargin=j.parent.pOriginalMargin[0];j.parent.pOriginalMargin=null;j.splitter=j.last.splitter;delete j.last.splitter;}j.splitter=null;var b=j.originalMargin[1];j.edgeMargin=j.originalMargin[0];b.splitter=b.splitter===false?false:b.last.splitter;j.originalMargin=null;delete b.last.splitter;}if(g&&g.template&&(g.splitter||g.splitter===null&&j.originalMargin)&&j.parent){if(!j.splitter){g.last.splitter=j.splitter=g.splitter;j.originalMargin=[j.edgeMargin,g];j.edgeMargin=Math.max(j.edgeMargin,j.splitter);}g.splitter=null;if(j.parent&&j.stackId==j.parent.children.length-1&&(j.parent.parent&&j.parent.parent.children.length>1)){if(!j.parent.splitter){j.last.splitter=j.parent.splitter=j.splitter;j.parent.last.splitter=null;j.parent.edgeMargin=Math.max(j.parent.edgeMargin,j.parent.splitter);j.parent.pOriginalMargin=[j.parent.edgeMargin];}j.splitter=null;}else{if(j.parent.pOriginalMargin){j.parent.splitter=null;j.parent.edgeMargin=j.parent.pOriginalMargin[0];j.parent.pOriginalMargin=null;j.splitter=j.last.splitter;delete j.last.splitter;}}}for(var d=0;d<j.children.length;d++){if(!j.children[d].node){this.checkInheritance(j.children[d]);}}var k=j.children[0];if(k&&j.parent){if(j.vbox){if(!j.fwidth&&k.fwidth||k.last.fwidth&&k.fwidth!==null&&k.last.fwidth==j.fwidth){k.last.fwidth=j.fwidth=k.fwidth;k.fwidth=null;}var c=j.parent;if((c&&!c.fheight&&k.fheight||k.last.fheight&&k.fheight!==null&&k.last.fheight==c.fheight)&&j.children.length==1){k.last.fheight=c.fheight=k.fheight;k.fheight=null;}}else{if((!j.fheight&&k.fheight||k.last.fheight&&k.fheight!==null&&k.last.fheight==j.fheight)&&j.children.length==1){k.last.fheight=j.fheight=k.fheight;k.fheight=null;}}if(k.weight||k.last.weight&&k.last.weight==j.weight){k.last.weight=j.weight=k.weight;}}},compileAlignment:function(c){if(!c.children.length){this.removeRule(c.pHtml,"layout");var b=this.layouts[c.pHtml.getAttribute("id")];if(b){apf.layout.clearSplitters(b.layout);}return;}var j=c.children;for(var g=false,d=0;d<j.length;d++){if(j[d].template=="bottom"){if(j[d].splitter){j[d-1].splitter=j[d].splitter;j[d].splitter=null;}j[d-1].edgeMargin=Math.max(j[d].edgeMargin,j[d-1].edgeMargin||0,j[d-1].splitter||0);j[d].edgeMargin=null;}if(j[d].hidden){j[d].prehide(true);}}this.checkInheritance(c);var b=this.layouts[c.pHtml.getAttribute("id")];b.layout.compile(c.copy());b.layout.reset();},addAlignNode:function(j,b){var u=(typeof j.align=="undefined"?j.getAttribute("align"):j.align).split("-");var B=b.children;var w=j.aData;if(typeof j.splitter=="undefined"){if(u[1]=="splitter"){w.splitter=u[2]||4;}else{w.splitter=false;}}w.edgeMargin=Math.max(w.edgeMargin,w.splitter||0);u=u[0];w.template=u;if(u=="top"){for(var c=B.length,o=0;o<B.length;o++){if(B[o].template!="top"){c=o;break;}}for(var o=B.length-1;o>=c;o--){B[o+1]=B[o];B[o].stackId=o+1;}B[c]=w;B[c].stackId=c;w.parent=b;}else{if(u=="bottom"){w.stackId=B.push(w)-1;w.parent=b;}else{var m=null;for(var c=-1,o=0;o<B.length;o++){if(B[o].hbox){m=B[o];break;}else{if(B[o].node&&B[o].template=="top"){c=o;}}}if(!m){var k=apf.layout.get(b.pHtml);m=apf.layout.parseXml(apf.xmldb.getXml("<hbox />"),k,null,true);m.parent=b;if(c>-1){for(var o=B.length-1;o>c;o--){B[o+1]=B[o];B[o].stackId++;}B[c+1]=m;m.stackId=c+1;}else{m.stackId=B.unshift(m)-1;}}var g,d=m.children.concat(m.hiddenChildren);for(var o=0;o<d.length;o++){if(d[o].template==u){g=d[o];break;}}d=m.children;if(!g){var k=apf.layout.get(b.pHtml);g=apf.layout.parseXml(apf.xmldb.getXml("<vbox />"),k,null,true);g.parent=m;g.template=u;if(u=="left"){if(!w.fwidth){var r;for(var A=false,o=0;o<d.length;o++){if(d[o].template=="middle"){A=d[o];break;}}if(A&&!A.children.length){d.remove(A);for(var o=0;o<d.length;o++){d[o].stackId=o;}}}d.unshift(g);for(var o=0;o<d.length;o++){d[o].stackId=o;}}else{if(u=="right"){if(w.fwidth){var r;for(var A=false,o=0;o<d.length;o++){if(d[o].template=="middle"||d[o].template=="left"&&!d[o].fwidth){A=true;break;}}if(!A){r=apf.layout.parseXml(apf.xmldb.getXml("<vbox />"),k,null,true);r.parent=m;r.template="middle";r.stackId=d.push(r)-1;}}g.stackId=d.push(g)-1;}else{if(u=="middle"){for(var t,o=0;o<d.length;o++){if(d[o].template=="right"){t=o;}}var q=d[t];if(q){d[t]=g;g.stackId=t;q.stackId=d.push(q)-1;}else{g.stackId=d.push(g)-1;}}}}}w.stackId=g.children.push(w)-1;w.parent=g;if(g.hidden){g.preshow(true);}}}},compile:function(d){var c=this.layouts[d.getAttribute("id")];if(!c){return false;}var b=c.root.copy();c.layout.compile(b);c.layout.reset();},removeAll:function(c){c.children.length=null;this.compileAlignment(c);var b=this.getHtmlId(c.pHtml);if(!this.rules[b]){delete this.qlist[b];}},timer:null,qlist:{},dlist:[],$hasQueue:false,queue:function(c,d,b){this.$hasQueue=true;var g;if(!(g=this.getHtmlId(c))){g=apf.setUniqueHtmlId(c);}if(this.qlist[g]){if(d){this.qlist[g][2].push(d);}if(b){this.qlist[g][1]=b;}return;}this.qlist[g]=[c,b,[d]];if(!this.timer){this.timer=$setTimeout("apf.layout.processQueue()");}},processQueue:function(){var d,k,b,j,g;for(d=0;d<this.dlist.length;d++){if(this.dlist[d].hidden){this.dlist[d].hide();}else{this.dlist[d].show();}}do{var c=this.qlist;this.qlist={};this.$hasQueue=false;for(k in c){j=c[k];if(j[1]){apf.layout.compileAlignment(j[1]);}g=j[2];for(d=0,b=g.length;d<b;d++){if(g[d]){g[d].$updateLayout();}}apf.layout.activateRules(j[0]);}}while(this.$hasQueue);if(apf.hasSingleRszEvent){apf.layout.forceResize();}this.dlist=[];clearTimeout(this.timer);this.timer=null;},rules:{},onresize:{},getHtmlId:function(b){return b.getAttribute?b.getAttribute("id"):1;},setRules:function(d,j,g,c){if(!this.getHtmlId(d)){apf.setUniqueHtmlId(d);}if(!this.rules[this.getHtmlId(d)]){this.rules[this.getHtmlId(d)]={};}var b=this.rules[this.getHtmlId(d)][j];if(!c&&b){this.rules[this.getHtmlId(d)][j]=g+"\n"+b;}else{this.rules[this.getHtmlId(d)][j]=g;}},getRules:function(b,c){return c?this.rules[this.getHtmlId(b)][c]:this.rules[this.getHtmlId(b)];},removeRule:function(g,m){var c=this.getHtmlId(g);if(!this.rules[c]){return;}var d=this.rules[c][m]||false;delete this.rules[c][m];var k;for(k in this.rules[c]){}if(!k){delete this.rules[c];}if(apf.hasSingleRszEvent){if(this.onresize[c]){this.onresize[c]=null;}else{var j=g.parentNode;while(j&&j.nodeType==1&&!this.onresize[j.getAttribute("id")]){j=j.parentNode;}if(j&&j.nodeType==1){var b=this.onresize[j.getAttribute("id")];if(b.children){delete b.children[c];}}}}return d;},activateRules:function(j,o){if(!j){var b,k;for(b in this.rules){k=document.getElementById(b);if(!k||k.onresize){continue;}this.activateRules(k);}if(apf.hasSingleRszEvent&&window.onresize){window.onresize();}return;}var m,g,q,t,s=[];if(!apf.hasSingleRszEvent){t=this.rules[this.getHtmlId(j)];if(!t){j.onresize=null;return false;}for(g in t){if(typeof t[g]!="string"){continue;}s.push(t[g]);}m=apf.needsCssPx?new Function(s.join("\n")):new Function(s.join("\n").replace(/ \+ 'px'|try\{\}catch\(e\)\{\}\n/g,""));j.onresize=m;if(!o){m();}}else{var d=this.getHtmlId(j);t=this.rules[d];if(!t){return false;}for(g in t){if(typeof t[g]!="string"){continue;}s.push(t[g]);}var c=j.parentNode;while(c&&c.nodeType==1&&!this.onresize[c.getAttribute("id")]){c=c.parentNode;}var n=new Function(s.join("\n"));if(this.onresize[d]){n.children=this.onresize[d].children;}if(c&&c.nodeType==1){var r=this.onresize[c.getAttribute("id")];(r.children||(r.children={}))[d]=n;}else{this.onresize[d]=n;}if(!o){n();}if(!window.onresize){var m=function(A){try{var C=[];for(var u in A){C.unshift(A[u]);}for(var w=0;w<C.length;w++){C[w]();if(C[w].children){m(C[w].children);}}}catch(B){}};window.onresize=function(){m(apf.layout.onresize);};}}},forceResize:function(j){if(apf.hasSingleRszEvent){return window.onresize&&window.onresize();}var c=j.onresize;if(c){c();}var g=j.getElementsByTagName("*");for(var d=0,b=g.length;d<b;d++){if(g[d].onresize){g[d].onresize();}}},paused:{},pause:function(c,d){if(apf.hasSingleRszEvent){var b=this.getHtmlId(c);this.paused[b]=this.onresize[b]||true;if(d){this.onresize[b]=d;this.onresize[b].children=this.paused[b].children;d();}else{delete this.onresize[b];}}else{this.paused[this.getHtmlId(c)]=c.onresize||true;if(d){c.onresize=d;d();}else{c.onresize=null;}}},play:function(c){if(!this.paused[this.getHtmlId(c)]){return;}if(apf.hasSingleRszEvent){var b=this.getHtmlId(c);var d=this.paused[b];if(typeof d=="function"){this.onresize[b]=d;}else{delete this.onresize[b];}if(window.onresize){window.onresize();}this.paused[this.getHtmlId(c)]=null;}else{var d=this.paused[this.getHtmlId(c)];if(typeof d=="function"){c.onresize=d;d();}else{c.onresize=null;}this.paused[this.getHtmlId(c)]=null;}}};apf.layout.load=apf.layout.loadXml;apf.getWindowWidth=function(){return apf.isIE?document.documentElement.offsetWidth-apf.windowHorBorder:window.innerWidth;};apf.getWindowHeight=function(){return apf.isIE?document.documentElement.offsetHeight-apf.windowVerBorder:window.innerHeight;};apf.layoutParser=function(b,d){d=(d&&d.length==4)?d:[0,0,0,0];this.pMargin=d;this.RULES=[];this.parentNode=b;if(!this.parentNode.getAttribute("id")){apf.setUniqueHtmlId(this.parentNode);}var k={};var g=0;var j=0;this.createSplitters=true;this.setMargin=function(m){d=m;};this.reset=function(){this.RULES=[];k={};this.lastType=this.globalEdge=this.globalSplitter=null;};this.compile=function(m,n){this.addRule("var v = apf.layout.vars");this.globalSplitter=m.splitter;this.globalEdge=m.edgeMargin;if(this.globalSplitter||this.globalEdge){this.setglobals(m);}this.preparse(m);this.parserules(m);if(this.createSplitters){apf.layout.clearSplitters(this);this.parsesplitters(m);}this.RULES=new c().calc(this.RULES);var o=("try{"+this.RULES.join("}catch(e){}\ntry{")+"}catch(e){}\n").replace(/([^=]+\.style[^=]+) = (.*?)\}/g,"$1 = ($2) + 'px'}");if(!apf.hasHtmlIdsInJs){o=o.replace(/q([\w|]+)\.(offset|style)/g,'document.getElementById("q$1").$2');}this.lastRoot=m;if(!n){apf.layout.setRules(this.parentNode,"layout",o,true);apf.layout.queue(this.parentNode);}else{return o;}return false;};this.addRule=function(m){this.RULES.push(m);};this.setglobals=function(n,o){if(!o&&this.globalEdge&&!n.edgeMargin&&(!n.xml||!n.xml.getAttribute("edge"))){if(!n.splitter){n.splitter=this.globalSplitter;}n.edgeMargin=Math.max(this.globalSplitter,this.globalEdge);}if(n.node){return;}for(var m=0;m<n.children.length;m++){this.setglobals(n.children[m],m==n.children.length-1);}};this.preparse=function(n){if(n.node){return;}else{var A=n.vbox?"height":"width";var q=0;var w=0;var F=0;n.childweight=0;n.childminwidth=0;n.childminheight=0;var E=["v."+A+"_"+n.id],o=[];var m=n.children;for(var s=0;s<m.length;s++){if(s<m.length-1){E.push(" - "+m[s].edgeMargin);}var u=m[s]["f"+A];if(u){o.push((u.indexOf("%")>-1)?" - ("+(m[s]["calc"+A]="v.innerspace_"+n.id+" * "+parseFloat(u)/100)+")":" - ("+u+")");}else{n.childweight+=m[s].weight;m[s]["calc"+A]="Math."+(s%2==0?"ceil":"floor")+"(v.restspace_"+n.id+" * ("+m[s].weight+"/v.weight_"+n.id+"))";}var t=(n.vbox?"width":"height");var C=m[s]["f"+t];if(!C){m[s]["calc"+t]=(n.vbox?"v.width_":"v.height_")+n.id;}else{m[s]["calc"+t]=C.indexOf("%")>-1?"v.innerspace_"+n.id+" * "+parseFloat(C)/100:C;}if(m[s].node&&m[s].xml.visible!==false){m[s].oHtml.style.display="block";}else{this.preparse(m[s]);}if(n.vbox){n.childminheight+=Math.max(m[s].childminheight||0,m[s].minheight||0,10)+m[s].edgeMargin;n.childminwidth=Math.max(n.childminwidth,m[s].minwidth||m[s].childminwidth||10);}else{n.childminwidth+=Math.max(m[s].minwidth||0,m[s].childminwidth||0,10)+m[s].edgeMargin;n.childminheight=Math.max(n.childminheight,m[s].minheight||m[s].childminheight||10);}}n.innerspace=E.join("");n.restspace=n.innerspace+" "+o.join("");if(!n.parent){var r=0,H=0;if(this.parentNode.tagName.toLowerCase()!="body"){var B=apf.getDiff(this.parentNode);H=B[0];r=B[1];}var G=(this.parentNode.tagName.toLowerCase()=="body"?"apf.getWindowWidth()":"document.getElementById('"+this.parentNode.id+"').offsetWidth");var D=(this.parentNode.tagName.toLowerCase()=="body"?"apf.getWindowHeight()":"document.getElementById('"+this.parentNode.id+"').offsetHeight");n.calcwidth="Math.max("+g+", "+G+" - "+(d[1])+" - "+d[3]+" - "+r+")";n.calcheight="Math.max("+j+", "+D+" - "+(d[2])+" - "+d[0]+" - "+H+")";}}};this.parserules=function(s){if(!s.node){this.addRule("v.width_"+s.id+" = Math.max("+s.childminwidth+","+s.minwidth+","+(s.calcwidth||s.fwidth)+")");this.addRule("v.height_"+s.id+" = Math.max("+s.childminheight+","+s.minheight+","+(s.calcheight||s.fheight)+")");this.addRule("v.weight_"+s.id+" = "+s.childweight);this.addRule("v.innerspace_"+s.id+" = "+s.innerspace);this.addRule("v.restspace_"+s.id+" = "+s.restspace);var n=apf.layout.metadata[s.id];n.calcData=s;s.original=n;if(!s.parent){this.addRule("v.left_"+s.id+" = "+d[3]);this.addRule("v.top_"+s.id+" = "+d[0]);for(var q=0;q<s.children.length;q++){this.parserules(s.children[q]);}return;}else{var w=["v.top_"+s.id," = "];var B=["v.left_"+s.id," = "];}}else{var w=[s.id,".style.top = "];var B=[s.id,".style.left = "];if(s.hid){var n=apf.lookup(s.hid).aData;n.calcData=s;s.original=n;}var r=s.oHtml;var u=apf.getDiff(r);var A=u[1];var o=u[0];if(s.calcwidth){this.addRule(s.id+".style.width = -"+o+" + Math.max( "+s.calcwidth+", "+s.minwidth+")");}else{r.style.width=Math.max(0,s.fwidth-o)+"px";}if(s.calcheight){this.addRule(s.id+".style.height = -"+A+" + Math.max( "+s.calcheight+", "+s.minheight+")");}else{r.style.height=Math.max(0,s.fheight-A)+"px";}}var m=s.parent.children[s.stackId-1];var t=s.parent.children[s.stackId+1];if(s.parent.vbox){if(s.parent.isBottom){if(!t){w.push("v.top_",s.parent.id," + v.height_",s.parent.id," - ",s.id,".offsetHeight");}else{if(t.node){w.push(t.id,".offsetTop - ",t.edgeMargin," - ",s.id,".offsetHeight");}else{w.push("v.top_"+t.id," - ",t.edgeMargin," - ",(s.node?s.id+".offsetHeight":"v.height_"+s.id));}}}else{if(!s.stackId){w.push("v.top_"+s.parent.id);}else{if(m){if(m.node){w.push(m.id,".offsetTop + ",m.id,".offsetHeight + ",m.edgeMargin);}else{w.push("v.top_",m.id," + v.height_",m.id," + ",m.edgeMargin);}}}}}else{w.push("v.top_"+s.parent.id);}if(s.parent.hbox){if(s.parent.isRight){if(!t){B.push("v.left_",s.parent.id," + v.width_",s.parent.id," - ",(s.node?s.id+".offsetWidth":"v.width_"+s.id),null);}else{if(t.node){B.push(t.id,".offsetLeft - ",t.edgeMargin," - ",(s.node?s.id+".offsetWidth":"v.width_"+s.id));}else{B.push("v.left_"+t.id," - ",t.edgeMargin," - ",(s.node?s.id+".offsetWidth":"v.width_"+s.id));}}}else{if(!s.stackId){B.push("v.left_"+s.parent.id);}else{if(m){if(m.node){B.push(m.id,".offsetLeft + ",m.id,".offsetWidth + ",m.edgeMargin);}else{B.push("v.left_",m.id," + v.width_",m.id," + ",m.edgeMargin);}}}}}else{B.push("v.left_"+s.parent.id);}if(B.length>2){this.addRule(B.join(""));}if(w.length>2){this.addRule(w.join(""));}if(!s.node){for(var q=0;q<s.children.length;q++){this.parserules(s.children[q]);}}};this.parsesplitters=function(n){if(n.parent&&n.splitter>0){apf.layout.getSplitter(this).init(n.splitter,n.hid,n);}if(!n.node){for(var m=0;m<n.children.length;m++){this.parsesplitters(n.children[m]);}}};function c(){this.parselookup={};this.nRules=[];this.doneRules={};this.maskText=function(q,o,n,m){return o+".offset"+n.toUpperCase();};this.handleVar=function(q,o,n,m){var r="a"+o.replace(/\|/g,"_")+"_style_"+n.toLowerCase();return k[r]?r:q;};this.parseRule=function(s){var o=s.split(" = "),u=o[0].replace(/^([_\w\d\|]+)\.style\.(\w)/,this.maskText),r="a"+o[0].replace(/[\.\|]/g,"_");k[r]=true;var q=o[1].split(/[ \(\)]/),t=[],m;for(var n=0;n<q.length;n++){if(q[n].match(/^([_\w\d\|]+)\.offset(\w+)$/)&&!q[n].match(/PNODE/)){t.push(q[n]);}}if(r.match(/width|height/i)){o[1]=o[1].replace(/^(\s*[\-\d]+[\s\-\+]+)/,"");m=o[0]+" = "+RegExp.$1+r;}else{m=o[0]+" = "+r;}if(s.match(/^v\./)){return{id:u,rule_p1:o[0]+" = ",rule_p2:o[1],ruleb:null,deps:t,processed:false};}return{id:u,rule_p1:"var "+r+" = ",rule_p2:o[1],ruleb:m,deps:t,processed:false};};this.calc=function(q){var n,t,s="";for(n=0;n<q.length;n++){if(q[n].match(/^var/)){this.nRules.push(q[n]);continue;}var r=this.parseRule(q[n],n);this.parselookup[r.id]=r;}for(t in this.parselookup){this.processNode(this.parselookup[t]);}for(t in this.parselookup){var m=this.parselookup[t];this.walkRules(m);}for(t in this.parselookup){this.nRules.push(this.parselookup[t].ruleb);}return this.nRules;};this.walkRules=function(m){if(this.doneRules[m.id]){return;}for(var n=0;n<m.deps.length;n++){if(m.deps[n]&&!m.deps[n].walked&&!this.doneRules[m.deps[n].id]){m.deps[n].walked=true;this.walkRules(m.deps[n]);}}this.doneRules[m.id]=true;this.nRules.push(m.rule_p1+m.rule_p2.replace(/([_\w\d\|]+)\.offset(\w+)/g,this.handleVar));};this.processNode=function(q){for(var n=0;n<q.deps.length;n++){var m=typeof q.deps[n]=="string"?this.parselookup[q.deps[n]]:q.deps[n];if(!m){q.deps[n]=null;continue;}q.deps[n]=m;if(!m.processed){m.processed=true;this.processNode(m);}}};}};apf.saveData=apf.getData=function(c,u){if(!c){return false;}var w,n=c.charAt(0),t=u.callback;var k=function(C,B,A){var m=this;$setTimeout(function(){s.call(m,C,B,A);});};var s=function(B,A,m){var C=u.callback;if(A!=apf.SUCCESS){return C(B,A,m||{});}return C(B,A,m||{});};if(!u){u={};}var j=u.fParsed||(c.indexOf("{")>-1||c.indexOf("[")>-1?apf.lm.compile(c,{withopt:true,precall:u.precall,alwayscb:true,simplexpath:true}):{str:c,type:2});if(u.precall){u.asyncs=j.asyncs;}if(j.type==3){if(j.xpaths[0]){var q=j.xpaths[0],r=j.xpaths[1];if(q=="#"||r=="#"){var g=(apf.lm.compile(c,{xpathmode:5}))();if(typeof g!="string"){q=g.model&&g.model.$isModel&&g.model;if(q){r=g.xpath;}else{if(g.model){q=apf.xmldb.findModel(g.model);r=apf.xmlToXpath(g.model,q.data)+(g.xpath?"/"+g.xpath:"");}else{throw new Error();}}}else{q=null;}}else{q=apf.nameserver.get("model",q);}if(!q){throw new Error("Could not find model '"+q+"' in "+c);}return k(q.data.selectSingleNode(r),apf.SUCCESS,{});}else{if(!u.xmlNode){throw new Error(apf.formatErrorString(0,null,"Loading data","Xpath found without model and no xmlNode specified"+c));}return k(u.xmlNode.data.selectSingleNode(j.xpaths[1]),apf.SUCCESS,{});}}if(n=="<"){if(j.type==2){w=j.str;}else{return j(u.xmlNode,k,u);}}else{if((n=="["||n=="{")){return j(u.xmlNode,k,u);}else{if(j.type==1||j.type==3){var o=t;t=u.callback=function(C,B,m){if(u._pc===true){return;}if(B!=apf.SUCCESS){return o.apply(this,arguments);}var A=C.split(" "),D="get";if(A.length>1&&A[0].length<10){D=A.shift();A=A.join(" ");}else{A=C;}t=u.callback=o;apf.oHttp.exec(D,[A],k,u);};j(u.xmlNode,k,u);}else{if(u._pc===true){return;}var d=c.split(" "),b="get";if(d.length>1&&d[0].length<10){b=d.shift();d=d.join(" ");}else{d=c;}apf.oHttp.exec(b,[d.replace(/\\/g,"")],k,u);}}}if(w){if(t){k(w,apf.SUCCESS,{});}else{return w;}}};apf.setModel=function(b,g){if(!b){return;}var d=b.indexOf("{")>-1||b.indexOf("[")>-1?apf.lm.compile(b,{alwayscb:true}):{type:2,str:b};if(b=="@default"||d.type==2){var c=apf.nameserver.get("model",b);if(c){return c.register(g);}else{if(b=="@default"){return;}}if(b.indexOf(".")==-1&&b.indexOf("/")==-1){apf.console.warn("Could not find model '"+b+"'");return;}}if(d.type==3){if(d.models){if(d.xpaths.length==2&&d.xpaths[0]!="#"&&d.xpaths[1]!="#"){if(!apf.nameserver.get("model",d.xpaths[0])){throw new Error("Could not find model '"+d.xpaths[0]+"' in "+b);}apf.nameserver.get("model",d.xpaths[0]).register(g,d.xpaths[1]);return;}}else{apf.console.warn("Xpath found without model. This might fail if no                context is specified using local(): "+b);}}if(g.clear){g.clear("loading");}apf.getData(b,{parsed:d,xmlNode:g&&g.xmlRoot,callback:function(n,m,j){if(m!=apf.SUCCESS){throw new Error(apf.formatErrorString(0,null,"Loading new data","Could not load data into model.                 \nMessage: "+j.message+"                \nInstruction: '"+b+"'"));}if(!n){return g.clear&&g.clear();}if(typeof n=="string"){if(n.charAt(0)=="<"){n=apf.getXml(n);}else{if(n.indexOf("http://")==0){return apf.setModel(n,g);}else{throw new Error("Invalid data from server");}}}var k=apf.xmldb.findModel(n);if(k){k.register(g,apf.xmlToXpath(n,k.data));}else{new apf.model().register(g).load(n);}}});};apf.storage.modules.gears=apf.storage.modules["gears.sql"]={table_name:"STORAGE",initialized:false,$available:null,$db:null,init:function(){this.factory=apf.nameserver.get("google","gears");this.database_name=apf.config.name.substr(0,46)+".apf.offline.gears";this.$db=this.factory.create("beta.database","1.0");this.$db.open(this.database_name);try{this.$sql("CREATE TABLE IF NOT EXISTS "+this.table_name+"(  namespace TEXT,  key TEXT,  value TEXT )");this.$sql("CREATE UNIQUE INDEX IF NOT EXISTS namespace_key_index ON "+this.table_name+" (namespace, key)");this.initialized=true;}catch(b){apf.console.warn(b.message);return false;}},$sql:function(c,d){var b=this.$db.execute(c,d);return this.$normalizeResults(b);},destroy:function(){this.$db.close();},$normalizeResults:function(b){var d=[];if(!b){return[];}while(b.isValidRow()){var j={};for(var c=0;c<b.fieldCount();c++){var k=b.fieldName(c);var g=b.field(c);j[k]=g;}d.push(j);b.next();}b.close();return d;},isAvailable:function(){return apf.isGears;},put:function(b,d,c){if(this.isValidKey(b)==false){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Invalid key given: "+b));}if(!c){c=this.namespace;}if(this.isValidKey(c)==false){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Invalid namespace given: "+c));}d=apf.serialize(d);try{this.$sql("DELETE FROM "+this.table_name+" WHERE namespace = ? AND key = ?",[c,b]);this.$sql("INSERT INTO "+this.table_name+" VALUES (?, ?, ?)",[c,b,d]);}catch(g){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Error setting name/value pair: "+g.message));return false;}return true;},get:function(c,d){if(this.isValidKey(c)==false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid key given: "+c));}if(!d){d=this.namespace;}if(this.isValidKey(d)==false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid namespace given: "+d));}var b=this.$sql("SELECT * FROM "+this.table_name+" WHERE namespace = ? AND  key = ?",[d,c]);if(!b.length){return null;}return apf.unserialize(b[0].value);},getNamespaces:function(){var d=[this.namespace];var b=this.$sql("SELECT namespace FROM "+this.table_name+" DESC GROUP BY namespace");for(var c=0;c<b.length;c++){if(b[c].namespace!=this.namespace){d.push(b[c].namespace);}}return d;},getKeys:function(g){if(!g){g=this.namespace;}if(this.isValidKey(g)==false){throw new Error(apf.formatErrorString(0,null,"Retrieving keys","Invalid namespace given: "+g));}var b=this.$sql("SELECT key FROM "+this.table_name+" WHERE namespace = ?",[g]);var d=[];for(var c=0;c<b.length;c++){d.push(b[c].key);}return d;},clear:function(b){if(!b){b=this.namespace;}if(this.isValidKey(b)==false){throw new Error(apf.formatErrorString(0,null,"Clearing storage","Invalid namespace given: "+b));}this.$sql("DELETE FROM "+this.table_name+" WHERE namespace = ?",[b]);},remove:function(b,c){if(!c){c=this.namespace;}if(this.isValidKey(c)==false){throw new Error(apf.formatErrorString(0,null,"Removing key","Invalid namespace given: "+c));}this.$sql("DELETE FROM "+this.table_name+" WHERE namespace = ? AND key = ?",[c,b]);},putMultiple:function(g,b,d){if(this.isValidKeyArray(g)===false||!b instanceof Array||g.length!=b.length){throw new Error(apf.formatErrorString(0,null,"Setting multiple name/value pairs","Invalid arguments: keys = ["+g+"],                                     values = ["+b+"]"));}if(!d){d=this.namespace;}if(this.isValidKey(d)==false){throw new Error(apf.formatErrorString(0,null,"Setting multiple name/value pairs","Invalid namespace given: "+d));}try{this.$sql.open();this.$sql.db.execute("BEGIN TRANSACTION");var k="REPLACE INTO "+this.table_name+" VALUES (?, ?, ?)";for(var c=0;c<g.length;c++){var j=apf.serialize(b[c]);this.$sql.db.execute(k,[d,g[c],j]);}this.$sql.db.execute("COMMIT TRANSACTION");this.$sql.close();}catch(m){throw new Error(apf.formatErrorString(0,null,"Writing multiple name/value pair","Error writing file: "+m.message));return false;}return true;},getMultiple:function(j,g){if(this.isValidKeyArray(j)===false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid key array given: "+j));}if(!g){g=this.namespace;}if(this.isValidKey(g)==false){throw new Error(apf.formatErrorString(0,null,"Getting multiple name/value pairs","Invalid namespace given: "+g));}var k="SELECT * FROM "+this.table_name+" WHERE namespace = ? AND  key = ?";var d=[];for(var c=0;c<j.length;c++){var b=this.$sql(k,[g,j[c]]);d[c]=b.length?apf.unserialize(b[0].value):null;}return d;},removeMultiple:function(d,c){if(this.isValidKeyArray(d)===false){throw new Error(apf.formatErrorString(0,null,"Removing name/value pair","Invalid key array given: "+d));}if(!c){c=this.namespace;}if(this.isValidKey(c)==false){throw new Error(apf.formatErrorString(0,null,"Removing multiple name/value pairs","Invalid namespace given: "+c));}this.$sql.open();this.$sql.db.execute("BEGIN TRANSACTION");var g="DELETE FROM "+this.table_name+" WHERE namespace = ? AND key = ?";for(var b=0;b<d.length;b++){this.$sql.db.execute(g,[c,d[b]]);}this.$sql.db.execute("COMMIT TRANSACTION");this.$sql.close();},isPermanent:function(){return true;},getMaximumSize:function(){return this.SIZE_NO_LIMIT;},hasSettingsUI:function(){return false;},showSettingsUI:function(){throw new Error(this.declaredClass+" does not support a storage settings user-interface");},hideSettingsUI:function(){throw new Error(this.declaredClass+" does not support a storage settings user-interface");}};apf.storage.modules.air={init:function(){this.ByteArray=window.runtime.flash.utils.ByteArray;this.EncryptedLocalStore=window.runtime.flash.data.EncryptedLocalStore;},isAvailable:function(){return apf.isAIR;},_getItem:function(b){var c=this.EncryptedLocalStore.getItem("__apf_"+b);return c?c.readUTFBytes(c.length):"";},_setItem:function(c,d){var b=new this.ByteArray();b.writeUTFBytes(d);this.EncryptedLocalStore.setItem("__apf_"+c,b);},_removeItem:function(b){this.EncryptedLocalStore.removeItem("__apf_"+b);},put:function(b,j,c){if(this.isValidKey(b)==false){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Invalid key given: "+b));}if(!c){c=this.namespace;}if(this.isValidKey(c)==false){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Invalid namespace given: "+c));}try{var g=this._getItem("namespaces")||"";if(g.indexOf("|"+c+"|")==-1){this._setItem("namespaces",g+c+"|");}var d=this._getItem(c+"_keys")||"";if(d.indexOf("|"+b+"|")==-1){this._setItem(c+"_keys",d+b+"|");}this._setItem("_"+c+"_"+b,j);}catch(k){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Error writing: "+k.message));return false;}return true;},get:function(b,c){if(this.isValidKey(b)==false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid key given: "+b));}if(!c){c=this.namespace;}if(this.isValidKey(c)==false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid namespace given: "+c));}return this._getItem("_"+c+"_"+b);},getNamespaces:function(){var c=[this.namespace];var d=(this._getItem("namespaces")||"").split("|");for(var b=0;b<d.length;b++){if(d[b]&&d[b]!=this.namespace){c.push(d[b]);}}return c;},getKeys:function(d){if(!d){d=this.namespace;}if(this.isValidKey(d)==false){throw new Error(apf.formatErrorString(0,null,"Getting keys","Invalid namespace given: "+d));}var c=[];var g=(this._getItem(d+"_keys")||"").split("|");for(var b=0;b<g.length;b++){if(g[b]){c.push(g[b]);}}return c;},clear:function(c){if(!c){c=this.namespace;}if(this.isValidKey(c)==false){throw new Error(apf.formatErrorString(0,null,"Clearing storage","Invalid namespace given: "+c));}var g=this._getItem("namespaces")||"";if(g.indexOf("|"+c+"|")!=-1){this._setItem("namespaces",g.replace("|"+c+"|","|"));}var d=(this._getItem(c+"_keys")||"").split("|");for(var b=0;b<d.length;b++){if(d[b].length){this._removeItem(c+"_"+d[b]);}}this._removeItem(c+"_keys");},remove:function(b,c){if(!c){c=this.namespace;}if(this.isValidKey(c)==false){throw new Error(apf.formatErrorString(0,null,"Removing key","Invalid namespace given: "+c));}var d=this._getItem(c+"_keys")||"";if(d.indexOf("|"+b+"|")!=-1){this._setItem(c+"_keys",d.replace("|"+b+"|","|"));}this._removeItem("_"+c+"_"+b);},putMultiple:function(g,b,d){if(this.isValidKeyArray(g)===false||!b instanceof Array||g.length!=b.length){throw new Error(apf.formatErrorString(0,null,"Setting multiple name/value pairs","Invalid arguments: keys = ["+g+"], values = ["+b+"]"));}if(!d){d=this.namespace;}if(this.isValidKey(d)==false){throw new Error(apf.formatErrorString(0,null,"Setting multiple name/value pairs","Invalid namespace given: "+d));}try{for(var c=0;c<g.length;c++){this.put(g[c],value[c],null,d);}}catch(j){throw new Error(apf.formatErrorString(0,null,"Writing multiple name/value pair","Error writing file: "+j.message));return false;}return true;},getMultiple:function(g,d){if(this.isValidKeyArray(g)===false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid key array given: "+g));}if(!d){d=this.namespace;}if(this.isValidKey(d)==false){throw new Error(apf.formatErrorString(0,null,"Getting multiple name/value pairs","Invalid namespace given: "+d));}var c=[];for(var b=0;b<g.length;b++){c[b]=this.get(g[b],d);}return c;},removeMultiple:function(d,c){if(this.isValidKeyArray(d)===false){throw new Error(apf.formatErrorString(0,null,"Removing name/value pair","Invalid key array given: "+d));}if(!c){c=this.namespace;}if(this.isValidKey(c)==false){throw new Error(apf.formatErrorString(0,null,"Removing multiple name/value pairs","Invalid namespace given: "+c));}for(var b=0;b<d.length;b++){this.remove(d[b],c);}},isPermanent:function(){return true;},getMaximumSize:function(){return this.SIZE_NO_LIMIT;},hasSettingsUI:function(){return false;},showSettingsUI:function(){throw new Error(this.declaredClass+" does not support a storage settings user-interface");},hideSettingsUI:function(){throw new Error(this.declaredClass+" does not support a storage settings user-interface");}};apf.storage.modules.memory={initialized:true,store:{},isAvailable:function(){return true;},put:function(b,d,c){if(this.isValidKey(b)==false){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Invalid key given: "+b));}if(!c){c=this.namespace;}if(this.isValidKey(c)==false){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Invalid namespace given: "+c));}d=apf.serialize(d);if(!this.store[c]){this.store[c]={};}this.store[c][b]=d;},get:function(b,c){if(this.isValidKey(b)==false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid key given: "+b));}if(!c){c=this.namespace;}if(this.isValidKey(c)==false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid namespace given: "+c));}if(!this.store[c]||!this.store[c][b]){return null;}return apf.unserialize(this.store[c][b]);},getNamespaces:function(){var b=[this.namespace];for(var c in this.store){b.push(c);}return b;},getKeys:function(c){if(!c){c=this.namespace;}if(this.isValidKey(c)==false){throw new Error(apf.formatErrorString(0,null,"Clearing storage","Invalid namespace given: "+c));}var b=[];for(var d in this.store[c]){b.push(d);}return b;},clear:function(b){if(!b){b=this.namespace;}if(this.isValidKey(b)==false){throw new Error(apf.formatErrorString(0,null,"Clearing storage","Invalid namespace given: "+b));}delete this.store[b];},remove:function(b,c){if(!c){c=this.namespace;}if(this.isValidKey(c)==false){throw new Error(apf.formatErrorString(0,null,"Removing key","Invalid namespace given: "+c));}if(this.store[c]){delete this.store[c][b];}},putMultiple:function(g,b,d){if(this.isValidKeyArray(g)===false||!b instanceof Array||g.length!=b.length){throw new Error(apf.formatErrorString(0,null,"Setting multiple name/value pairs","Invalid arguments: keys = ["+g+"],                                     values = ["+b+"]"));}if(!d){d=this.namespace;}if(this.isValidKey(d)==false){throw new Error(apf.formatErrorString(0,null,"Setting multiple name/value pairs","Invalid namespace given: "+d));}if(!this.store[d]){this.store[d]={};}for(var c=0;c<g.length;c++){this.store[d][g[c]]=apf.serialize(b[c]);}return true;},getMultiple:function(g,d){if(this.isValidKeyArray(g)===false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid key array given: "+g));}if(!d){d=this.namespace;}if(this.isValidKey(d)==false){throw new Error(apf.formatErrorString(0,null,"Getting multiple name/value pairs","Invalid namespace given: "+d));}if(!this.store[d]){return[];}var c=[];for(var b=0;b<g.length;b++){if(this.store[d][g[b]]){c.push(apf.unserialize(this.store[d][g[b]]));}}return c;},removeMultiple:function(d,c){if(this.isValidKeyArray(d)===false){throw new Error(apf.formatErrorString(0,null,"Removing name/value pair","Invalid key array given: "+d));}if(!c){c=this.namespace;}if(this.isValidKey(c)==false){throw new Error(apf.formatErrorString(0,null,"Removing multiple name/value pairs","Invalid namespace given: "+c));}if(!this.store[c]){return;}for(var b=0;b<d.length;b++){delete this.store[c][d[b]];}},isPermanent:function(){return false;},getMaximumSize:function(){return this.SIZE_NO_LIMIT;},hasSettingsUI:function(){return false;},showSettingsUI:function(){throw new Error(this.declaredClass+" does not support a storage settings user-interface");},hideSettingsUI:function(){throw new Error(this.declaredClass+" does not support a storage settings user-interface");}};apf.storage.modules.flash={initialized:false,asyncInit:true,_available:null,_statusHandler:null,_flashReady:false,_pageReady:false,delayCalls:[],init:function(){this.name="flashStorage";this.id=apf.flash.addPlayer(this);this.STORAGE_SWF=(apf.config.resourcePath||apf.basePath)+"resources/apfStorage.swf?cachebust="+new Date().getTime();var flash=apf.flash.buildContent("src",this.STORAGE_SWF,"width","215","height","138","align","middle","id",this.name,"quality","high","bgcolor","#ffffff","allowFullScreen","true","name",this.name,"flashvars","playerID="+this.id,"allowScriptAccess","always","type","application/x-shockwave-flash","pluginspage","http://www.adobe.com/go/getflashplayer","menu","true");this.container=document.createElement("div");this.container.id=this.name+"_Container";this.container.className="apfVideo";with(this.container.style){width=height="0px";overflow="hidden";}document.body.appendChild(this.container);this.container.innerHTML=flash;this.player=apf.flash.getElement(this.name);this._allNamespaces=this.getNamespaces();this._flashReady=this._pageReady=true;},setVisible:function(visible){if(visible==true){this.container.style.position="absolute";this.container.style.visibility="visible";}else{with(this.container.style){position="absolute";x="-1000px";y="-1000px";visibility="hidden";}}return this;},callMethod:function(){if(!this.initialized||typeof this.player.callMethod!="function"){this.delayCalls.push(arguments);}else{var c=[this.player,"callMethod"],g=apf.flash,d=0,b=arguments.length;for(;d<b;d++){c.push(g.encode(c[d]));}g.remote.apply(null,c);}},delayedCallTimer:null,makeDelayCalls:function(){clearTimeout(this.delayedCallTimer);if(!this.delayCalls.length){if(typeof this["onready"]=="function"){this.onready();}return this;}this.callMethod.apply(this,this.delayCalls[0]);this.delayCalls.splice(0,1);var b=this;this.delayedCallTimer=window.setTimeout(function(){b.makeDelayCalls();},1);return this;},ready:function(b){if(this.initialized){b();}else{this.onready=b;}},event:function(c,d){if(c=="status"){var b=apf.storage;if(statusResult==b.PENDING){this.setVisible(true);}else{this.setVisible(false);}if(b._statusHandler){b._statusHandler.call(null,d.status,d.keyName,d.namespace);}}else{if(c=="loaded"){this.initialized=true;this.setVisible(false).makeDelayCalls();}}},setFlushDelay:function(b){if(b===null||typeof b==="undefined"||isNaN(b)){throw new Error("Invalid argunment: "+b);}this.callMethod("setFlushDelay",String(b));},getFlushDelay:function(){return Number(this.callMethod("getFlushDelay"));},flush:function(b){if(b==null||typeof b=="undefined"){b=apf.storage.namespace;}this.callMethod("flush",b);},isAvailable:function(){return location.protocol!="file:"&&apf.flash.isEightAvailable();},put:function(b,d,c){if(this.isValidKey(b)==false){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Invalid key given: "+b));}if(!c){c=this.namespace;}if(this.isValidKey(c)==false){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Invalid namespace given: "+c));}this.callMethod("put",b,apf.serialize(d),c);},putMultiple:function(k,c,g){if(this.isValidKeyArray(k)===false||!c instanceof Array||k.length!=c.length){throw new Error(apf.formatErrorString(0,null,"Setting multiple name/value pairs","Invalid arguments: keys = ["+k+"], values = ["+c+"]"));}if(!g){g=this.namespace;}if(this.isValidKey(g)==false){throw new Error(apf.formatErrorString(0,null,"Setting multiple name/value pairs","Invalid namespace given: "+g));}var m=k.join(",");var n=[];for(var d=0;d<c.length;d++){c[d]=apf.unserialize(c[d]);n[d]=c[d].length;}var b=c.join("");var j=n.join(",");this.callMethod("putMultiple",m,b,j,g);},get:function(c,d){if(this.isValidKey(c)==false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid key given: "+c));}if(!d){d=this.namespace;}if(this.isValidKey(d)==false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid namespace given: "+d));}var b=this.callMethod("get",c,d);if(b==""){return null;}return apf.unserialize(apf.flash.decode(b));},getMultiple:function(keys,namespace){if(this.isValidKeyArray(keys)===false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid key array given: "+keys));}if(!namespace){namespace=this.namespace;}if(this.isValidKey(namespace)==false){throw new Error(apf.formatErrorString(0,null,"Getting multiple name/value pairs","Invalid namespace given: "+namespace));}var metaKey=keys.join(",");var metaResults=this.callMethod("getMultiple",metaKey,namespace);if(!metaResults){return null;}var results=eval("("+metaResults.replace(/""([^",\]]+)/g,'"\\"$1').replace(/([^",]+)""/g,'$1\\""')+")");for(var i=0;i<results.length;i++){results[i]=(results[i]=="")?null:apf.unserialize(apf.flash.decode(results[i]));}return results;},_destringify:function(results){if(typeof results=="string"&&(/^string:/.test(results))){results=results.substring("string:".length);}else{results=eval(results);}return results;},getKeys:function(c){if(!c){c=this.namespace;}if(this.isValidKey(c)==false){throw new Error(apf.formatErrorString(0,null,"Clearing storage","Invalid namespace given: "+c));}var b=this.callMethod("getKeys",c);if(b==this||b==null||b=="null"){b="";}b=b.split(",");b.sort();return b;},getNamespaces:function(){var b=this.callMethod("getNamespaces");if(b==this||b==null||b=="null"){b=apf.storage.namespace||"default";}b=b.split(",");b.sort();return b;},clear:function(b){if(!b){b=this.namespace;}if(this.isValidKey(b)==false){throw new Error(apf.formatErrorString(0,null,"Clearing storage","Invalid namespace given: "+b));}this.callMethod("clear",b);},remove:function(b,c){if(!c){c=this.namespace;}if(this.isValidKey(c)==false){throw new Error(apf.formatErrorString(0,null,"Removing key","Invalid namespace given: "+c));}this.callMethod("remove",b,c);},removeMultiple:function(c,b){if(this.isValidKeyArray(c)===false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid key array given: "+c));}if(!b){b=this.namespace;}if(this.isValidKey(b)==false){throw new Error(apf.formatErrorString(0,null,"Getting multiple name/value pairs","Invalid namespace given: "+b));}var d=c.join(",");this.callMethod("removeMultiple",d,b);},isPermanent:function(){return true;},getMaximumSize:function(){return this.SIZE_NO_LIMIT;},hasSettingsUI:function(){return false;},showSettingsUI:function(){throw new Error(apf.formatErrorString(0,null,this.declaredClass+" does not support a storage settings user-interface"));},hideSettingsUI:function(){throw new Error(apf.formatErrorString(0,null,this.declaredClass+" does not support a storage settings user-interface"));},getResourceList:function(){return[];}};apf.storage.modules.cookie={initialized:true,isAvailable:function(){return true;},put:function(b,d,c){if(this.isValidKey(b)==false){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Invalid key given: "+b));}if(!c){c=this.namespace;}if(this.isValidKey(c)==false){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Invalid namespace given: "+c));}d=apf.serialize(d);apf.setcookie(c+"~"+b,d,new Date().getTime()+(60*60*24*365*10000));},get:function(b,c){if(this.isValidKey(b)==false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid key given: "+b));}if(!c){c=this.namespace;}if(this.isValidKey(c)==false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid namespace given: "+c));}var d=apf.getcookie(c+"~"+b);return d?apf.unserialize(d):null;},getNamespaces:function(){throw new Error("Not Implemented");var b=[this.namespace];for(var c in this.store){b.push(c);}return b;},getKeys:function(c){throw new Error("Not Implemented");if(!c){c=this.namespace;}if(this.isValidKey(c)==false){throw new Error(apf.formatErrorString(0,null,"Clearing storage","Invalid namespace given: "+c));}var b=[];for(var d in this.store[c]){b.push(d);}return b;},clear:function(b){throw new Error("Not Implemented");if(!b){b=this.namespace;}if(this.isValidKey(b)==false){throw new Error(apf.formatErrorString(0,null,"Clearing storage","Invalid namespace given: "+b));}delete this.store[b];},remove:function(b,c){if(!c){c=this.namespace;}if(this.isValidKey(c)==false){throw new Error(apf.formatErrorString(0,null,"Removing key","Invalid namespace given: "+c));}apf.delcookie(c+"~"+b);},putMultiple:function(g,b,d){throw new Error("Not Implemented");if(this.isValidKeyArray(g)===false||!b instanceof Array||g.length!=b.length){throw new Error(apf.formatErrorString(0,null,"Setting multiple name/value pairs","Invalid arguments: keys = ["+g+"],                                     values = ["+b+"]"));}if(!d){d=this.namespace;}if(this.isValidKey(d)==false){throw new Error(apf.formatErrorString(0,null,"Setting multiple name/value pairs","Invalid namespace given: "+d));}if(!this.store[d]){this.store[d]={};}for(var c=0;c<g.length;c++){this.store[d][g[c]]=apf.serialize(b[c]);}return true;},getMultiple:function(g,d){throw new Error("Not Implemented");if(this.isValidKeyArray(g)===false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid key array given: "+g));}if(!d){d=this.namespace;}if(this.isValidKey(d)==false){throw new Error(apf.formatErrorString(0,null,"Getting multiple name/value pairs","Invalid namespace given: "+d));}if(!this.store[d]){return[];}var c=[];for(var b=0;b<g.length;b++){if(this.store[d][g[b]]){c.push(apf.unserialize(this.store[d][g[b]]));}}return c;},removeMultiple:function(d,c){throw new Error("Not Implemented");if(this.isValidKeyArray(d)===false){throw new Error(apf.formatErrorString(0,null,"Removing name/value pair","Invalid key array given: "+d));}if(!c){c=this.namespace;}if(this.isValidKey(c)==false){throw new Error(apf.formatErrorString(0,null,"Removing multiple name/value pairs","Invalid namespace given: "+c));}if(!this.store[c]){return;}for(var b=0;b<d.length;b++){delete this.store[c][d[b]];}},isPermanent:function(){return false;},getMaximumSize:function(){return this.SIZE_NO_LIMIT;},hasSettingsUI:function(){return false;},showSettingsUI:function(){throw new Error(this.declaredClass+" does not support a storage settings user-interface");},hideSettingsUI:function(){throw new Error(this.declaredClass+" does not support a storage settings user-interface");}};apf.storage.modules.html5={domain:(location.hostname=="localhost")?"localhost.localdomain":location.hostname,initialized:true,storage:apf.isIE?self.localStorage:self.globalStorage,isAvailable:function(){try{var c=this.storage[location.href];}catch(b){return false;}return true;},put:function(b,d,c){if(this.isValidKey(b)==false){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Invalid key given: "+b));}b=this.getFullKey(b,c);d=apf.serialize(d);try{var j=this.storage[this.domain];j.setItem(b,d);}catch(g){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Could not set name/value pair"));}},get:function(c,d){if(this.isValidKey(c)==false){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Invalid key given: "+c));}c=this.getFullKey(c,d);var g=this.storage[this.domain];var b=g.getItem(c);if(b==null||b==""){return null;}return apf.unserialize(b);},getNamespaces:function(){var d=[this.namespace];var j={};var k=this.storage[this.domain];var b=/^__([^_]*)_/;for(var c=0;c<k.length;c++){var m=k.key(c);if(b.test(m)==true){var g=m.match(b)[1];if(typeof j[g]=="undefined"){j[g]=true;d.push(g);}}}return d;},getKeys:function(d){if(!d){d=this.namespace;}if(this.isValidKey(d)==false){throw new Error(apf.formatErrorString(0,null,"Getting keys","Invalid namespace given: "+d));}var k=new RegExp(d==this.namespace?"^([^_]{2}.*)$":"^__"+d+"_(.*)$");var g=this.storage[this.domain];var b=[];for(var c=0;c<g.length;c++){var j=g.key(c);if(k.test(j)==true){j=j.match(k)[1];b.push(j);}}return b;},clear:function(c){if(!c){c=this.namespace;}if(this.isValidKey(c)==false){throw new Error(apf.formatErrorString(0,null,"Clearing storage","Invalid namespace given: "+c));}var g=new RegExp(c==this.namespace?"^[^_]{2}":"^__"+c+"_");var d=this.storage[this.domain];for(var b=d.length-1;b>=0;b--){if(g.test(d.key(b))==true){d.removeItem(d.key(b));}}},remove:function(b,c){b=this.getFullKey(b,c);var d=this.storage[this.domain];d.removeItem(b);},isPermanent:function(){return true;},getMaximumSize:function(){return 0;},hasSettingsUI:function(){return false;},showSettingsUI:function(){throw new Error(apf.formatErrorString(0,null,this.declaredClass+" does not support a storage settings user-interface"));},hideSettingsUI:function(){throw new Error(apf.formatErrorString(0,null,this.declaredClass+" does not support a storage settings user-interface"));},getFullKey:function(b,c){if(!c){c=this.namespace;}if(this.isValidKey(c)==false){throw new Error(apf.formatErrorString(0,null,"Clearing storage","Invalid namespace given: "+c));}return c==this.namespace?b:"__"+c+"_"+b;}};apf.storage.modules["air.file"]={initialized:false,init:function(){this.File=window.runtime.flash.filesystem.File;this.FileStream=window.runtime.flash.filesystem.FileStream;this.FileMode=window.runtime.flash.filesystem.FileMode;this.storagePath="__APF_"+(apf.config.name?apf.config.name.toUpperCase():"STORAGE")+"/";try{var b=this.File.applicationStorageDirectory.resolvePath(this.storagePath);if(!b.exists){b.createDirectory();}this.initialized=true;}catch(c){apf.console.warn(c.message);return false;}},isAvailable:function(){return apf.isAIR;},put:function(d,j,g){if(this.isValidKey(d)==false){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Invalid key given: "+d));}if(!g){g=this.namespace;}if(this.isValidKey(g)==false){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Invalid namespace given: "+g));}try{this.remove(d,g);var b=this.File.applicationStorageDirectory.resolvePath(this.storagePath+g);if(!b.exists){b.createDirectory();}var c=b.resolvePath(d);var m=new this.FileStream();m.open(c,this.FileMode.WRITE);m.writeObject(j);m.close();}catch(k){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Error writing file: "+k.message));return false;}return true;},get:function(d,g){if(this.isValidKey(d)==false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid key given: "+d));}if(!g){g=this.namespace;}if(this.isValidKey(g)==false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid namespace given: "+g));}var c=this.File.applicationStorageDirectory.resolvePath(this.storagePath+g+"/"+d);if(!c.exists||c.isDirectory){return false;}var j=new this.FileStream();j.open(c,this.FileMode.READ);var b=j.readObject();j.close();return b;},getNamespaces:function(){var d=[this.namespace];var b=this.File.applicationStorageDirectory.resolvePath(this.storagePath);var g=b.getDirectoryListing();for(var c=0;c<g.length;c++){if(g[c].isDirectory&&g[c].name!=this.namespace){d.push(g[c].name);}}return d;},getKeys:function(g){if(!g){g=this.namespace;}if(this.isValidKey(g)==false){throw new Error(apf.formatErrorString(0,null,"Clearing storage","Invalid namespace given: "+g));}var d=[];var b=this.File.applicationStorageDirectory.resolvePath(this.storagePath+g);if(b.exists&&b.isDirectory){var j=b.getDirectoryListing();for(var c=0;c<j.length;c++){d.push(j[c].name);}}return d;},clear:function(c){if(!c){c=this.namespace;}if(this.isValidKey(c)==false){throw new Error(apf.formatErrorString(0,null,"Clearing storage","Invalid namespace given: "+c));}var b=this.File.applicationStorageDirectory.resolvePath(this.storagePath+c);if(b.exists&&b.isDirectory){b.deleteDirectory(true);}},remove:function(c,d){if(!d){d=this.namespace;}if(this.isValidKey(d)==false){throw new Error(apf.formatErrorString(0,null,"Removing key","Invalid namespace given: "+d));}var b=this.File.applicationStorageDirectory.resolvePath(this.storagePath+d+"/"+c);if(b.exists&&!b.isDirectory){b.deleteFile();}},putMultiple:function(g,b,d){if(this.isValidKeyArray(g)===false||!b instanceof Array||g.length!=b.length){throw new Error(apf.formatErrorString(0,null,"Setting multiple name/value pairs","Invalid arguments: keys = ["+g+"], values = ["+b+"]"));}if(!d){d=this.namespace;}if(this.isValidKey(d)==false){throw new Error(apf.formatErrorString(0,null,"Setting multiple name/value pairs","Invalid namespace given: "+d));}try{for(var c=0;c<g.length;c++){this.put(g[c],b[c],null,d);}}catch(j){throw new Error(apf.formatErrorString(0,null,"Writing multiple name/value pair","Error writing file: "+j.message));return false;}return true;},getMultiple:function(g,d){if(this.isValidKeyArray(g)===false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid key array given: "+g));}if(!d){d=this.namespace;}if(this.isValidKey(d)==false){throw new Error(apf.formatErrorString(0,null,"Getting multiple name/value pairs","Invalid namespace given: "+d));}var c=[];for(var b=0;b<g.length;b++){c[b]=this.get(g[b],d);}return c;},removeMultiple:function(d,c){if(this.isValidKeyArray(d)===false){throw new Error(apf.formatErrorString(0,null,"Removing name/value pair","Invalid key array given: "+d));}if(!c){c=this.namespace;}if(this.isValidKey(c)==false){throw new Error(apf.formatErrorString(0,null,"Removing multiple name/value pairs","Invalid namespace given: "+c));}for(var b=0;b<d.length;b++){this.remove(d[b],c);}},isPermanent:function(){return true;},getMaximumSize:function(){return this.SIZE_NO_LIMIT;},hasSettingsUI:function(){return false;},showSettingsUI:function(){throw new Error(this.declaredClass+" does not support a storage settings user-interface");},hideSettingsUI:function(){throw new Error(this.declaredClass+" does not support a storage settings user-interface");}};apf.storage.modules["air.sql"]={database_file:"apf.db",initialized:false,_db:null,init:function(){this.File=window.runtime.flash.filesystem.File;this.SQLConnection=window.runtime.flash.data.SQLConnection;this.SQLStatement=window.runtime.flash.data.SQLStatement;this.table_name="__APF_"+(apf.config.name?apf.config.name.toUpperCase():"STORAGE");try{this._db=new this.SQLConnection();this._db.open(this.File.applicationStorageDirectory.resolvePath(this.database_file));this._sql("CREATE TABLE IF NOT EXISTS "+this.table_name+"(namespace TEXT, key TEXT, value TEXT)");this._sql("CREATE UNIQUE INDEX IF NOT EXISTS namespace_key_index ON "+this.table_name+" (namespace, key)");this.initialized=true;}catch(b){apf.console.warn(b.message);return false;}},_sql:function(c,d){var b=new this.SQLStatement();b.sqlConnection=this._db;b.text=c;if(d){apf.extend(b.parameters,d);}b.execute();return b.getResult();},isAvailable:function(){return apf.isAIR;},put:function(b,d,c){if(this.isValidKey(b)==false){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Invalid key given: "+b));}if(!c){c=this.namespace;}if(this.isValidKey(c)==false){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Invalid namespace given: "+c));}try{this._sql("DELETE FROM "+this.table_name+" WHERE namespace = :namespace AND key = :key",{":namespace":c,":key":b});this._sql("INSERT INTO "+this.table_name+" VALUES (:namespace, :key, :value)",{":namespace":c,":key":b,":value":d});}catch(g){throw new Error(apf.formatErrorString(0,null,"Setting name/value pair","Error writing file: "+g.message));return false;}return true;},get:function(c,d){if(this.isValidKey(c)==false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid key given: "+c));}if(!d){d=this.namespace;}if(this.isValidKey(d)==false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid namespace given: "+d));}var b=this._sql("SELECT * FROM "+this.table_name+" WHERE namespace = :namespace AND key = :key",{":namespace":d,":key":c});if(b.data&&b.data.length){return b.data[0].value;}return null;},getNamespaces:function(){var d=[this.namespace];var b=this._sql("SELECT namespace FROM "+this.table_name+" DESC GROUP BY namespace");if(b.data){for(var c=0;c<b.data.length;c++){if(b.data[c].namespace!=this.namespace){d.push(b.data[c].namespace);}}}return d;},getKeys:function(g){if(!g){g=this.namespace;}if(this.isValidKey(g)==false){throw new Error(apf.formatErrorString(0,null,"Clearing storage","Invalid namespace given: "+g));}var d=[];var b=this._sql("SELECT key FROM "+this.table_name+" WHERE namespace = :namespace",{":namespace":g});if(b.data){for(var c=0;c<b.data.length;c++){d.push(b.data[c].key);}}return d;},clear:function(b){if(!b){b=this.namespace;}if(this.isValidKey(b)==false){throw new Error(apf.formatErrorString(0,null,"Clearing storage","Invalid namespace given: "+b));}this._sql("DELETE FROM "+this.table_name+" WHERE namespace = :namespace",{":namespace":b});},remove:function(b,c){if(!c){c=this.namespace;}if(this.isValidKey(c)==false){throw new Error(apf.formatErrorString(0,null,"Removing key","Invalid namespace given: "+c));}this._sql("DELETE FROM "+this.table_name+" WHERE namespace = :namespace AND key = :key",{":namespace":c,":key":b});},putMultiple:function(g,b,d){if(this.isValidKeyArray(g)===false||!b instanceof Array||g.length!=b.length){throw new Error(apf.formatErrorString(0,null,"Setting multiple name/value pairs","Invalid arguments: keys = ["+g+"], values = ["+b+"]"));}if(!d){d=this.namespace;}if(this.isValidKey(d)==false){throw new Error(apf.formatErrorString(0,null,"Setting multiple name/value pairs","Invalid namespace given: "+d));}try{this._db.begin();for(var c=0;c<g.length;c++){this._sql("DELETE FROM "+this.table_name+" WHERE namespace = :namespace AND key = :key",{":namespace":d,":key":key[c]});this._sql("INSERT INTO "+this.table_name+" VALUES (:namespace, :key, :value)",{":namespace":d,":key":key[c],":value":value});}this._db.commit();}catch(j){throw new Error(apf.formatErrorString(0,null,"Writing multiple name/value pair","Error writing file: "+j.message));return false;}return true;},getMultiple:function(j,g){if(this.isValidKeyArray(j)===false){throw new Error(apf.formatErrorString(0,null,"Getting name/value pair","Invalid key array given: "+j));}if(!g){g=this.namespace;}if(this.isValidKey(g)==false){throw new Error(apf.formatErrorString(0,null,"Getting multiple name/value pairs","Invalid namespace given: "+g));}var d=[];for(var c=0;c<j.length;c++){var b=this._sql("SELECT * FROM "+this.table_name+" WHERE namespace = :namespace AND key = :key",{":namespace":g,":key":j[c]});d[c]=b.data&&b.data.length?b.data[0].value:null;}return d;},removeMultiple:function(d,c){if(this.isValidKeyArray(d)===false){throw new Error(apf.formatErrorString(0,null,"Removing name/value pair","Invalid key array given: "+d));}if(!c){c=this.namespace;}if(this.isValidKey(c)==false){throw new Error(apf.formatErrorString(0,null,"Removing multiple name/value pairs","Invalid namespace given: "+c));}this._db.begin();for(var b=0;b<d.length;b++){this._sql("DELETE FROM "+this.table_name+" WHERE namespace = namespace = :namespace AND key = :key",{":namespace":c,":key":d[b]});}this._db.commit();},isPermanent:function(){return true;},getMaximumSize:function(){return this.SIZE_NO_LIMIT;},hasSettingsUI:function(){return false;},showSettingsUI:function(){throw new Error(this.declaredClass+" does not support a storage settings user-interface");},hideSettingsUI:function(){throw new Error(this.declaredClass+" does not support a storage settings user-interface");}};apf.http=function(){this.queue=[null];this.callbacks={};this.cache={};this.timeout=this.timeout||10000;this.autoroute=this.autoroute||false;this["route-server"]=this["route-server"]||null;if(!this.$uniqueId){this.$uniqueId=apf.all.push(this)-1;}this.toString=this.toString||function(){return"[Ajax.org Teleport Component : (HTTP)]";};this.getXml=function(c,d,b){if(!b){b={};}b.useXML=true;b.callback=d;return this.get(c,b);};this.get=this.$get=function(j,c){if(!c){c={};}var g=this;var o=c.id;var k=c.async=(c.async||typeof c.async=="undefined"||apf.isOpera||false);if(apf.isWebkit){j=apf.html_entity_decode(j);}var B=c.data||"";if(apf.isNot(o)){var r=apf.getHttpReq();o=this.queue.push({http:r,url:j,callback:c.callback,retries:0,options:c})-1;}else{var r=this.queue[o].http;r.abort();}if(k){r.onreadystatechange=function(){if(!g.queue[o]||r.readyState!=4){return;}if(k&&arguments.callee.caller){setTimeout(function(){g.receive(o);});}else{g.receive(o);}};}var q=this.autoroute&&apf.isOpera?true:(c.autoroute||this.shouldAutoroute),s=q?this["route-server"]:j;if(!c.hideLogMessage){apf.console.teleport(this.queue[o].log=new apf.teleportLog({id:o,tp:this,type:c.type,method:this.method||c.method||"GET",url:j,route:q?s:"",data:new String(B&&B.xml?B.xml:B),start:new Date()}));}var b=[];function A(D,E){b.push(D+": "+E);r.setRequestHeader(D,E);}var d=false;try{if(c.nocache){s=apf.getNoCacheUrl(s);}try{netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");}catch(t){if(apf.hasHtml5XDomain&&s.match(/^http:\/\//)&&!new apf.url(s).isSameLocation()){throw new Error(apf.formatErrorString(0,this,"Communication error","Url: "+s+"\nReason: Same origin policy in effect"));}}r.open(this.method||c.method||"GET",s,k);if(c.username){A("Authorization","Basic "+apf.crypto.Base64.encode(c.username+":"+c.password));}if(!apf.isWebkit){A("User-Agent","Ajax.org Teleport 3.0");}A("X-Requested-With","XMLHttpRequest");if(!c.headers||!c.headers["Content-type"]){A("Content-type",this.contentType||(this.useXML||c.useXML?"text/xml":"text/plain"));}if(q){A("X-Route-Request",j);A("X-Proxy-Request",j);A("X-Compress-Response","gzip");}}catch(t){d=t.message;}if(d){var w=false;if(self.XMLHttpRequestUnSafe){try{r=new XMLHttpRequestUnSafe();r.onreadystatechange=function(){if(!g.queue[o]||r.readyState!=4){return;}g.receive(o);};r.open(this.method||c.method||"GET",(c.nocache?apf.getNoCacheUrl(s):s),k);A("X-Requested-With","XMLHttpRequest");if(!c.headers||!c.headers["Content-type"]){A("Content-type",this.contentType||(this.useXML||c.useXML?"text/xml":"text/plain"));}this.queue[o].http=r;c.async=true;w=true;}catch(t){}}if(!w&&this.autoroute&&!q){this.shouldAutoroute=true;c.autoroute=true;return this.get(j,c);}if(!w){var u=c.callback?c.callback(null,apf.ERROR,{userdata:c.userdata,http:r,url:j,tpModule:this,id:o,message:"Permission denied accessing remote resource: "+j+"\nMessage: "+d}):false;if(!u){this.clearQueueItem(o);}return;}}if(this.$headerHook){this.$headerHook(r);}if(c.headers){for(var C in c.headers){A(C,c.headers[C]);}}if(!c.hideLogMessage){this.queue[o].log.request(b);}function n(){var F=self.navigator.onLine?"File or Resource not available "+j:"Browser is currently working offline";apf.console.warn(F,"teleport");if(!c.hideLogMessage){g.queue[o].log.response({end:new Date(),message:F,http:r});}var D=self.navigator&&navigator.onLine?apf.ERROR:apf.TIMEOUT;var E=c.callback?c.callback(null,D,{userdata:c.userdata,http:r,url:j,tpModule:g,id:o,message:F}):false;if(!E){g.clearQueueItem(o);}}function m(F){var D;if(apf.isIE&&F){var E=window.onerror;window.onerror=function(){if(arguments.caller.callee==m){window.onerror=E;return true;}else{window.onerror=E;if(E){return E.apply(window,arguments);}}};r.send(B);window.onerror=E;}else{try{r.send(B);}catch(G){D=true;}}if(D){n();return;}}if(!k){m.call(this);return this.receive(o);}else{if(apf.loadsLocalFilesSync&&location.protocol=="file:"&&j.indexOf("http://")==-1){$setTimeout(function(){m.call(g,true);});}else{m.call(g);}return o;}};if(!this.exec){this.exec=function(k,d,j,c){if(!c){c={};}var b=d[0],g="";if(!c.method){c.method=k.toUpperCase();}if(!c.callback){c.callback=j;}this.contentType="application/x-www-form-urlencoded";this.$get(apf.getAbsolutePath(apf.config.baseurl,b),c.method=="GET"?c:apf.extend({data:g},c));};}this.receive=function(b){if(!this.queue[b]){return false;}var d=this.queue[b],m=d.http,n=d.callback;if(self.navigator&&navigator.onLine===false&&(location.protocol!="file:"||d.url.indexOf("http://")>-1)){return false;}if(d.async){try{if(m.status){}}catch(j){var k=this;return $setTimeout(function(){k.receive(b);},10);}}if(!d.options.hideLogMessage){apf.console.info("[HTTP] Receiving ["+b+"]"+(m.isCaching?"[<span style='color:orange'>cached</span>]":"")+" from "+d.url,"teleport",m.responseText);}var g=[],c={end:new Date(),tpModule:this,http:m,url:d.url,callback:n,id:b,retries:d.retries||0,userdata:d.options.userdata};if(m.status>600){return this.$timeout(b);}c.data=m.responseText;if(m.status>=400&&m.status<600||m.status<10&&m.status!=0){g.push("HTTP error ["+b+"]:"+m.status+"\n"+m.responseText);}if(d.options.useXML||this.useXML){if((m.responseText||"").replace(/^[\s\n\r]+|[\s\n\r]+$/g,"")==""){g.push("Received an empty XML document (0 bytes)");}else{try{var o=(m.responseXML&&m.responseXML.documentElement)?apf.xmlParseError(m.responseXML):apf.getXmlDom(m.responseText);if(!apf.supportNamespaces){o.setProperty("SelectionLanguage","XPath");}c.data=o.documentElement;}catch(j){g.push("Received invalid XML\n\n"+j.message);}}}if(g.length){c.message=g.join("\n");if(d.log){d.log.response(c);}if(!n||!n(c.data,apf.ERROR,c)){this.clearQueueItem(b);}return;}if(d.log){d.log.response(c);}if(!n||!n(c.data,apf.SUCCESS,c)){this.clearQueueItem(b);}return c.data;};this.$timeout=function(n){if(!this.queue[n]){return false;}var m=this.queue[n],d=m.http;try{if(d.status){}}catch(g){var c=this;return $setTimeout(function(){c.$timeout(n);},10);}var k=m.callback;d.abort();apf.console.info("HTTP Timeout ["+n+"]","teleport");var b;var j=k?k(null,apf.TIMEOUT,b={end:new Date(),userdata:m.options.userdata,http:d,url:m.url,tpModule:this,id:n,message:"HTTP Call timed out",retries:m.retries||0}):false;if(m.log){m.log.response(b);}if(!j){this.clearQueueItem(n);}};this.retryTimeout=function(b,d,c,j,g){if(d==apf.TIMEOUT&&b.retries<(g||apf.maxHttpRetries)){return b.tpModule.retry(b.id);}j=j||new Error(apf.formatErrorString(0,this,"Communication "+(d==apf.TIMEOUT?"timeout":"error"),"Url: "+b.url+"\nInfo: "+b.message));if((c||apf).dispatchEvent("error",apf.extend({error:j,state:d,bubbles:true},b))===false){return true;}};this.clearQueueItem=function(b){if(!this.queue[b]){return false;}if(apf.releaseHTTP){apf.releaseHTTP(this.queue[b].http);}this.queue[b]=null;delete this.queue[b];return true;};this.retry=function(c){if(!this.queue[c]){return false;}var b=this.queue[c];apf.console.info("[HTTP] Retrying request ["+c+"]","teleport");b.retries++;b.options.id=c;this.get(b.url,b.options);return true;};this.cancel=function(b){if(b===null){b=this.queue.length-1;}if(!this.queue[b]){return false;}this.clearQueueItem(b);};if(!this.$loadAml&&!this.instantiate&&!this.call){this.$loadAml=function(b){var k=this["receive"];for(var j=0,c=this.childNodes.length;j<c;j++){if(this.childNodes[j].nodeType!=1){continue;}var g=this.childNodes[j].getAttribute("url"),m=self[this.childNodes[j].getAttribute("receive")||k],d={useXML:this.childNodes[j].getAttribute("type")=="XML",async:!apf.isFalse(this.childNodes[j].getAttribute("async"))};this[this.childNodes[j].getAttribute("name")]=function(o,n){d.userdata=n;d.data=o;return this.get(g,d);};}};this.instantiate=function(b){var g=b.getAttribute("src"),d={async:b.getAttribute("async")!="false",nocache:true};this.getURL=function(k,j){d.data=k;d.userdata=j;d.callback=this.callbacks.getURL;return this.get(g,d);};var c="http"+Math.round(Math.random()*100000);apf.setReference(c,this);return c+".getURL()";};this.call=function(c,b){this[c].call(this,b);};}};apf.teleportLog=function(b){var d,g=b.method+" "+b.url+" HTTP/1.1\n\n"+b.data;this.setXml=function(j){if(!d){var k=j.ownerDocument;d=k.createElement(b.tp.localName||b.type||"http");d.appendChild(k.createElement("request")).appendChild(k.createTextNode(g||"-"));d.appendChild(k.createElement("response")).appendChild(k.createTextNode(c||"-"));}apf.xmldb.appendChild(j,d);};this.request=function(j){g=g.replace(/\n\n/,"\n"+j.join("\n")+"\n\n");if(d){apf.setQueryValue(d,"request/text()",g);}this.request=function(){};};var c="";this.response=function(j){var k=j.http.getAllResponseHeaders();c="HTTP/1.1 "+j.http.status+" "+j.http.statusText+"\n"+(k?k+"\n":"\n")+j.http.responseText;if(d){apf.setQueryValue(d,"response/text()",c);}};};apf.Init.run("http");apf.USEIFRAME=false;function runTpIframe(){function c(){this.$uniqueId=apf.all.push(this);var d=this;if(apf.USEIFRAME){this.iframe=document.body.appendChild(document.createElement("iframe"));this.iframe.style.width="400px";this.iframe.style.height="300px";this.iframe.style.position="absolute";this.iframe.style.left="0";this.iframe.style.top="0";this.iframe.style.zIndex=1000000000;document.body.style.display="block";}else{var j=document.body.appendChild(document.createElement("xml"));this.xmlDocument=j.XMLDocument;this.xmlDocument.setProperty("SelectionLanguage","XPath");document.body.removeChild(j);}this.readyState=0;this.status=null;this.responseText=null;this.responseXML=null;this.setRequestHeader=function(){};this.send=function(){this.done=false;if(apf.USEIFRAME){this.iframe.src=this.url;}else{this.xmlDocument.load(this.url);}};this.open=function(q,n,o){this.method=q;this.url=n;this.async=o;if(apf.USEIFRAME){if(!o){throw new Error(apf.formatErrorString(1081,null,"Iframe callback","Compatibility mode prevents possibility of non-async calls"));}this.iframe.onload=g;}else{this.xmlDocument.async=o;this.xmlDocument.onreadystatechange=k;}};this.abort=function(){if(apf.USEIFRAME){this.iframe.onreadystatechange=null;this.iframe.src="about:blank";d.done=false;d.readyState="";}else{this.xmlDocument.abort();}};var m=this;function k(){m.receive();}this.receive=function(){this.readyState=this.xmlDocument.readyState;if(this.readyState==4){this.status=200;this.responseText=this.xmlDocument.responseText||this.xmlDocument.xml;this.responseXML=this.xmlDocument;}if(this.onreadystatechange){this.onreadystatechange();}};function g(){if(d.done){return;}d.done=true;d.receiveIframe();}this.receiveIframe=function(){var o=this.iframe.contentWindow.document.body.innerText;o=o.replace(/^- /gm,"");try{this.responseXML=apf.getXmlDom(o);this.responseXML.setProperty("SelectionLanguage","XPath");this.responseXML.loadXML(o);}catch(n){this.responseXML=null;}this.responseText=this.responseXML?this.responseXML.xml:o;this.status=200;this.readyState=4;if(this.onreadystatechange){this.onreadystatechange();}};}function b(k,j){var d=document.body.appendChild(document.createElement("xml"));var g=d.XMLDocument;document.body.removeChild(d);g.setProperty("SelectionLanguage","XPath");if(k){g.loadXML(k);}if(!j){apf.xmlParseError(g);}return g;}}apf.DOMParser=function(){};apf.DOMParser.prototype=new (function(){this.caseInsensitive=true;this.preserveWhiteSpace=true;this.$shouldWait=0;var c=[/\<\!(DOCTYPE|doctype)[^>]*>/,/&nbsp;/g,/<\s*\/?\s*(?:\w+:\s*)[\w-]*[\s>\/]/g],b="//@*[not(contains(local-name(), '.')) and not(translate(local-name(), 'ABCDEFGHIJKLMNOPQRSTUVWXYZ', 'abcdefghijklmnopqrstuvwxyz') = local-name())]";this.parseFromString=function(j,m,d){var g;if(this.caseInsensitive){var k=j.replace(c[0],"").replace(c[2],function(n){return n.toLowerCase();});if(!this.supportNamespaces){k=k.replace(/xmlns\=\"[^"]*\"/g,"");}var g=apf.getXmlDom(k);if(apf.xmlParseError){apf.xmlParseError(g);}g=g.documentElement;}else{g=apf.getXmlDom(j,null,this.preserveWhiteSpace||apf.debug).documentElement;}return this.parseFromXml(g,d);};this.parseFromXml=function(g,k){var J,d,C,B;if(!k){k={};}if(!k.delayedRender&&!k.include){if(k.doc){J=k.doc;d=k.docFrag||J.createDocumentFragment();}else{J=new apf.AmlDocument();J.$aml=g;J.$domParser=this;}C=this.$createNode(J,g.nodeType,g);(d||J).appendChild(C);if(k.htmlNode){C.$int=k.htmlNode;}}else{C=k.amlNode;J=k.doc;if(k.include){var D=C.childNodes;var u=D.indexOf(k.beforeNode);var s=u?D.splice(u,D.length-u):[];}}this.$parseContext=[C,k];var E,A={},r=[],m=this;(function t(L,j){var M,Q,K,P,n=L.childNodes,O=0,N=j.length;for(;O<N;O++){Q=m.$createNode(J,(K=j[O]).nodeType,K);if(!Q){continue;}n[M=n.length]=Q;Q.parentNode=L;if(M>0){(Q.previousSibling=n[M-1]).nextSibling=Q;}if(!Q.render&&Q.canHaveChildren&&(P=K.childNodes).length){t(Q,P);}if(Q.$parsePrio){if(Q.$parsePrio=="001"){Q.dispatchEvent("DOMNodeInsertedIntoDocument");continue;}(A[Q.$parsePrio]||(r.push(Q.$parsePrio)&&(A[Q.$parsePrio]=[]))).push(Q);}}L.firstChild=n[0];L.lastChild=n[M];})(C,g.childNodes);if(k.include&&s.length){var o=D.length-1;D.push.apply(D,s);var q=D[o];var w=D[o+1];(w.previousSibling=q).nextSibling=w;C.lastChild=D[D.length-1];}if(k.delay){C.$parseOptions={prios:r,nodelist:A};return(d||J);}r.sort();var I,H,G,F;for(I=0,G=r.length;I<G;I++){E=A[r[I]];for(H=0,F=E.length;H<F;H++){E[H].dispatchEvent("DOMNodeInsertedIntoDocument");}}if(this.$shouldWait){return(d||J);}if(k.timeout){$setTimeout(function(){m.$continueParsing(C,k);});}else{this.$continueParsing(C,k);}return(d||J);};this.$callCount=0;this.$continueParsing=function(g,t){if(this.$shouldWait&&--this.$shouldWait!=0){return;}if(!t){t={};}this.$callCount++;if(g.$parseOptions){var q=g.$parseOptions.prios,s=g.$parseOptions.nodelist,o,n,m,k,d;delete g.$parseOptions;q.sort();for(o=0,m=q.length;o<m;o++){nodes=s[q[o]];for(n=0,k=nodes.length;n<k;n++){if(!(d=nodes[n]).parentNode||d.$amlLoaded){continue;}nodes[n].dispatchEvent("DOMNodeInsertedIntoDocument");}}}if(!t.ignoreSelf&&!g.$amlLoaded){g.dispatchEvent("DOMNodeInsertedIntoDocument");}(function r(u){var A,B;for(var w=0,j=u.length;w<j;w++){if(!(A=u[w]).$parsePrio&&!A.$amlLoaded){A.dispatchEvent("DOMNodeInsertedIntoDocument");}if(!A.render&&(B=A.childNodes).length){r(B);}}})(g.childNodes);if(!--this.$callCount&&!t.delay){apf.queue.empty();}if(t.callback){t.callback.call(g.ownerDocument);}delete this.$parseContext;};this.$createNode=function(D,r,E,j,C,u){var g;switch(r){case 1:var d,t;if(E){if((j=E.namespaceURI||apf.ns.xhtml)&&!(t=D.$prefixes[j])){D.$prefixes[t=E.prefix||E.scopeName||""]=j;D.$namespaceURIs[j]=t;if(!D.namespaceURI&&!t){D.namespaceURI=j;D.prefix=t;}}C=E.baseName||E.localName||E.tagName.split(":").pop();}else{t=D.$prefixes[j]||"";}if(!j){throw new Error("Missing namespace definition.");}if(!apf.namespaces[j]){if(this.allowAnyElement){j=apf.ns.xhtml;}else{throw new Error("Missing namespace handler for '"+j+"'");}}var q=apf.namespaces[j].elements;if(!(q[C]||q["@default"])){throw new Error("Missing element constructor: "+C);}g=new (q[C]||q["@default"])(null,C);g.prefix=t||"";g.namespaceURI=j;g.tagName=t?t+":"+C:C;if(E){if(d=E.getAttribute("id")){g.$propHandlers.id.call(g,g.id=d);}var A=E.attributes,k;for(var B,s=0,m=A.length;s<m;s++){g.attributes.push(new apf.AmlAttr(g,(k=(B=A[s]).nodeName),B.nodeValue));if(k=="render"){g.render=true;}}}break;case 2:g=new apf.AmlAttr();g.name=g.nodeName=C;if(u||(u=E&&E.nodeValue)){g.value=g.nodeValue=u;}if(E){if(E.namespaceURI&&!(g.prefix=D.$namespaceURIs[g.namespaceURI=E.namespaceURI])){D.$prefixes[g.prefix=E.prefix||E.scopeName]=g.namespaceURI;}}else{g.prefix=D.$prefixes[j];}break;case 3:if(E){u=E&&E.nodeValue;}if(!this.preserveWhitespace&&!(u||"").trim()){return;}g=new apf.AmlText();g.nodeValue=u||E&&E.nodeValue;break;case 7:var w=C||E&&E.nodeName;if(!apf.aml.processingInstructions[w]){throw new Error(apf.formatErrorString(0,null,"The processing instruction does not exist","Could not find the processing instruction with target: "+w));}g=new apf.aml.processingInstructions[w]();g.target=g.nodeName=w;g.data=g.nodeValue=u||E&&E.nodeValue;break;case 4:g=new apf.AmlCDATASection();g.nodeValue=u||E&&E.nodeValue;break;case 5:g=new apf.AmlNode();g.nodeType=r;break;case 6:g=new apf.AmlNode();g.nodeType=r;break;case 8:g=new apf.AmlComment();g.nodeValue=u||E&&E.nodeValue;break;case 9:g=new apf.AmlDocument();g.$domParser=this;break;case 10:g=new apf.AmlNode();g.nodeType=r;break;case 11:g=new apf.AmlDocumentFragment();break;}g.$aml=E;g.ownerDocument=D;return g;};})();apf.AmlNamespace=function(){this.elements={};this.processingInstructions={};};apf.AmlNamespace.prototype={setElement:function(b,c){return this.elements[b]=c;},setProcessingInstruction:function(c,b){this.processingInstructions[c]=b;}};apf.aml=new apf.AmlNamespace();apf.setNamespace("http://ajax.org/2005/aml",apf.aml);apf.__AMLNODE__=1<<14;apf.AmlNode=function(){this.$init(function(){this.childNodes=[];});};(function(){this.$regbase=this.$regbase|apf.__AMLNODE__;this.NODE_ELEMENT=1;this.NODE_ATTRIBUTE=2;this.NODE_TEXT=3;this.NODE_CDATA_SECTION=4;this.NODE_ENTITY_REFERENCE=5;this.NODE_ENTITY=6;this.NODE_PROCESSING_INSTRUCTION=7;this.NODE_COMMENT=8;this.NODE_DOCUMENT=9;this.NODE_DOCUMENT_TYPE=10;this.NODE_DOCUMENT_FRAGMENT=11;this.NODE_NOTATION=12;this.ownerDocument=null;this.nodeValue="";this.namespaceURI="";this.appendChild=this.insertBefore=function(g,q,d){if(!g||!g.hasFeature||!g.hasFeature(apf.__AMLNODE__)){throw new Error(apf.formatErrorString(1072,this,"Insertbefore DOM operation","Invalid argument passed. Expecting an AmlElement."));}if(this.nodeType==this.NODE_DOCUMENT){if(this.childNodes.length){throw new Error(apf.formatErrorString(0,this,"Insertbefore DOM operation","Only one top level element is allowed in an AML document."));}else{this.documentElement=g;}}if(this==g){throw new Error(apf.formatErrorString(0,this,"Insertbefore DOM operation","Cannot append node as a child of itself."));}if(g.nodeType==this.NODE_DOCUMENT_FRAGMENT){var b=g.childNodes.slice(0);for(var k=0,j=b.length;k<j;k++){this.insertBefore(b[k],q);}return g;}var c=g.parentNode==this,n=g.$pHtmlNode,s=g.parentNode,m=-1,o=this;if(q){m=this.childNodes.indexOf(q);if(m<0){if(q==this){throw new Error(apf.formatErrorString(1072,this,"Insertbefore DOM operation","Before node is the same node as inserted node"));}else{throw new Error(apf.formatErrorString(1072,this,"Insertbefore DOM operation","Before node is not a child of the parent node specified"));}return false;}}if(!g.ownerDocument){g.ownerDocument=this.ownerDocument||apf.ownerDocument;}if(g.parentNode){g.removeNode(c,d);}g.parentNode=this;if(q){m=this.childNodes.indexOf(q);}if(q){g.nextSibling=q;g.previousSibling=q.previousSibling;q.previousSibling=g;if(g.previousSibling){g.previousSibling.nextSibling=g;}}if(m>=0){this.childNodes=this.childNodes.slice(0,m).concat(g,this.childNodes.slice(m));}else{m=this.childNodes.push(g)-1;g.nextSibling=null;if(m>0){g.previousSibling=this.childNodes[m-1];g.previousSibling.nextSibling=g;}else{g.previousSibling=null;}}this.firstChild=this.childNodes[0];this.lastChild=this.childNodes[this.childNodes.length-1];function t(){g.$pHtmlNode=o.canHaveChildren?o.$int:document.body;var u;var w=(g.$ext&&g.$ext.nodeType==1&&(u=g.$ext.getElementsByTagName("iframe")).length>0&&apf.findHost(u[0].parentNode)==g);if(!d&&g.$ext&&!g.$coreHtml){if(!g.$altExt||g.$altExt.parentNode==g.$pHtmlNode){g.$pHtmlNode.insertBefore(c&&g.$altExt||g.$ext,q&&(q.$altExt||q.$ext)||null);}}g.dispatchEvent("DOMNodeInserted",{$beforeNode:q,relatedNode:o,$isMoveWithinParent:c,$oldParentHtmlNode:n,$oldParent:s,bubbles:true});}var r=this.nodeType==this.NODE_DOCUMENT?this:this.ownerDocument;if(!r||r.$domParser.$shouldWait){return g;}if(this.nodeType==this.NODE_DOCUMENT_FRAGMENT){return;}if(!g.$amlLoaded){(this.ownerDocument||this).$domParser.$continueParsing(g,{delay:true});}t();return g;};this.removeNode=function(c,b){if(c&&typeof c!="boolean"){throw new Error(apf.formatErrorString(0,this,"Removing node from parent","Invalid DOM Call. removeNode() does not take any arguments."));}if(!this.parentNode||!this.parentNode.childNodes){return this;}if(!this.parentNode.childNodes.contains(this)){return false;}if(this.$amlLoaded&&!apf.isDestroying){this.dispatchEvent("DOMNodeRemoved",{relatedNode:this.parentNode,bubbles:true,$doOnlyAdmin:c});if(!b&&!c&&this.$ext&&this.$ext.parentNode){this.$ext.parentNode.removeChild(this.$ext);}}this.parentNode.childNodes.remove(this);if(this.parentNode.firstChild==this){this.parentNode.firstChild=this.nextSibling;}if(this.parentNode.lastChild==this){this.parentNode.lastChild=this.previousSibling;}if(this.nextSibling){this.nextSibling.previousSibling=this.previousSibling;}if(this.previousSibling){this.previousSibling.nextSibling=this.nextSibling;}this.$pHtmlNode=this.parentNode=this.previousSibling=this.nextSibling=null;return this;};this.removeChild=function(b){if(!b||!b.hasFeature||!b.hasFeature(apf.__AMLNODE__)){throw new Error(apf.formatErrorString(0,this,"Removing a child node","Invalid Argument. removeChild() requires one argument of type AMLElement."));}b.removeNode();return this;};this.replaceChild=function(){};this.cloneNode=function(b){if(b&&this.nodeType==1){return this.ownerDocument.$domParser.parseFromXml(this,{doc:this.ownerDocument,delay:true}).childNodes[0];}else{return this.ownerDocument.$domParser.$createNode(this.ownerDocument,this.nodeType,this);}};this.canDispatch=function(b,c){};this.compareDocumentPosition=function(b){};this.hasAttributes=function(){return this.attributes&&this.attributes.length;};this.hasChildNodes=function(){return this.childNodes&&this.childNodes.length;};this.isDefaultNamespace=function(b){if(c.nodeType==1){if(!this.prefix){return this.namespaceURI==b;}}var c=this.parentNode||this.ownerElement;return c&&c.isDefaultNamespace(b);};this.lookupNamespaceURI=function(c){if(b.nodeType==1){if(this.namespaceURI&&c==this.prefix){return this.namespaceURI;}}var b=this.parentNode||this.ownerElement;return b&&b.lookupNamespaceURI(c);};this.lookupPrefix=function(b){if(this.nodeType==1){if(b==this.namespaceURI&&this.prefix){return this.prefix;}}var c=this.parentNode||this.ownerElement;return c&&c.lookupPrefix(b);};this.normalize=function(){};this.selectNodes=function(c,b){if(!apf){return;}if(!apf.XPath){apf.runXpath();}return apf.XPath.selectNodes(c,b||(this.nodeType==9?this.documentElement:this));};this.selectSingleNode=function(c,b){if(!apf){return;}if(!apf.XPath){apf.runXpath();}return apf.XPath.selectNodes(c,b||(this.nodeType==9?this.documentElement:this))[0];};}).call(apf.AmlNode.prototype=new apf.Class());apf.AmlElement=function(d,b){var c=this.$init;this.$init=function(j,g,n){this.$supportedProperties=this.$supportedProperties.slice();var o,m,k;m=this.$propHandlers;k=this.$propHandlers={};for(o in m){k[o]=m[o];}m=this.$booleanProperties;k=this.$booleanProperties={};for(o in m){k[o]=m[o];}c.call(this,j,g,n);};this.$init(function(n,k,o){this.$events={};this.$inheritProperties={};this.attributes=new apf.AmlNamedNodeMap(this);this.nodeFunc=k;this.localName=n;if(o){var j,q,m,g;if(o.childNodes){j=o.childNodes;delete o.childNodes;}for(q in o){if(q=="htmlNode"){continue;}this.attributes.push(new apf.AmlAttr(this,q,o[q]));}if(!this.ownerDocument){this.ownerDocument=apf.document;this.prefix="";this.namespaceURI=null;this.tagName=n;}if(j){this.childNodes=j;for(m=0,g=j.length;m<g;m++){j[m].nextSibling=j[m+1]||null;j[m].previousSibling=j[m-1]||null;j[m].parentNode=this;}this.firstChild=j[0]||null;this.lastChild=j[j.length-1]||null;}this.$aml=apf.$emptyNode||(apf.$emptyNode=apf.getXml("<empty />"));}});if(b){c.call(this,b,apf.NODE_HIDDEN,d);}};(function(){this.nodeType=this.NODE_ELEMENT;this.canHaveChildren=true;this.$propHandlers={id:function(d){if(d=="apf"){throw new Error(apf.formatErrorString(0,this,"Setting Name of Element","Cannot set name of element to 'apf'"));}if(this.name==d){return;}if(self[this.name]==this){self[this.name]=null;}if(!self[d]||!self[d].hasFeature){try{self[d]=this;}catch(c){var b=true;}}if(b&&d in self){apf.console.warn("trying to set a value in the global scope with a reserved name '"+d+"'.\nNothing wrong with that, except that you will not be able to reference\nthe object from the global scope in JS.");}apf.nameserver.register(this.localName,d,this);this.name=d;}};this.$booleanProperties={};this.$inheritProperties={};this.$supportedProperties=[];this.getElementsByTagName=function(j,m){j=j.toLowerCase();var k,g,c,d=this.childNodes,b=[];for(g=0,c=d.length;g<c;g++){if((k=d[g]).nodeType!=1){continue;}if(k.tagName==j||j=="*"){b.push(k);}if(!m&&k.nodeType==1){b=b.concat(k.getElementsByTagName(j));}}return b;};this.getElementsByTagNameNS=function(j,g,n){g=g.toLowerCase();var m,k,c,d=this.childNodes,b=[];for(k=0,c=d.length;k<c;k++){if((m=d[k]).nodeType!=1){continue;}if(m.namespaceURI==j&&(m.localName==g||g=="*")){b.push(m);}if(!n&&m.nodeType==1){b=b.concat(m.getElementsByTagNameNS(j,g));}}return b;};this.setAttribute=function(d,j,g){d=d.toLowerCase();var b=this.attributes.getNamedItem(d);if(!b){this.attributes.push(b=new apf.AmlAttr(this,d,j));if(!this.$amlLoaded){return;}if(g){b.$setValue(j);}else{b.dispatchEvent("DOMNodeInsertedIntoDocument",{relatedNode:this});b.dispatchEvent("DOMNodeInserted",{relatedNode:this,bubbles:true});}return;}var c=b.nodeValue;b.$setValue(j);if(g||!this.$amlLoaded){return;}b.$triggerUpdate(null,c);};this.setAttributeNode=function(b){this.attributes.setNamedItem(b);};this.setAttributeNS=function(c,b,d){return this.setAttribute(b,d);};this.hasAttribute=function(b){return this.getAttributeNode(b)?true:false;};this.hasAttributeNS=function(c,b){return this.hasAttribute(b);};this.removeAttribute=function(b){this.attributes.removeNamedItem(b);return this;};this.removeAttributeNS=function(c,b){return this.removeAttribute(b);};this.removeAttributeNode=function(b){this.attributes.removeNamedItem(b.name);};this.getAttribute=function(c,b){var d=this.attributes.getNamedItem(c);return d?(b?d.inheritedValue||d.nodeValue:d.nodeValue):null;};this.getAttributeNode=function(b){return this.attributes.getNamedItem(b);};this.getBoundingClientRect=function(){return new apf.AmlTextRectangle(this);};this.querySelector=function(){};this.querySelectorAll=function(){};this.scrollIntoView=function(){};this.replaceMarkup=function(b,c){apf.console.info("Remove all children from element");if(!c){c={};}if(!c.$intAML){c.$intAML=this.$aml;}if(!c.$int){c.$int=this.$int;}c.clear=true;for(var d=this.childNodes.length-1;d>=0;d--){var g=this.childNodes[d];if(g.destroy){g.destroy(true);}if(g.$ext!=this.$int){apf.destroyHtmlNode(g.$ext);}}this.childNodes.length=0;this.$int.innerHTML="<div class='loading'>loading...</div>";this.insertMarkup(b,c);};this.insertMarkup=function(c,d){apf.console.info("Loading sub markup from external source");var b=new apf.XiInclude();b.setAttribute("href",c);if(d&&d.clear){b.setAttribute("clear",true);}b.options=d;b.callback=d&&d.callback;this.appendChild(b);};this.serialize=function(c){if(c||!this.firstChild){return"<"+(this.prefix?this.prefix+":"+this.localName+" xmlns:"+this.prefix+'="'+this.namespaceURI+'"':this.localName)+(this.attributes.length?" ":"")+this.attributes.join(" ")+"/>";}else{var d=["<"+(this.prefix?this.prefix+":"+this.localName+" xmlns:"+this.prefix+'="'+this.namespaceURI+'"':this.localName)+(this.attributes.length?" ":"")+this.attributes.join(" ")+">"];for(var b=this.firstChild;b;b=b.nextSibling){d.push(b.serialize());}return d.join("")+"</"+(this.prefix?this.prefix+":"+this.localName:this.localName)+">";}};this.$setInheritedAttribute=function(d){var c,b=this;c=b.getAttribute(d);if(!c){b=b.parentNode;while(b&&b.nodeType==1&&!(c=b.getAttribute(d,true))){b=b.parentNode;}}if(!c&&apf.config&&d){c=apf.config[d];}if(c){this.$clearDynamicProperty(d);if(typeof c=="string"&&(c.indexOf("{")>-1||c.indexOf("[")>-1)){this.$setDynamicProperty(d,c);this.$inheritProperties[d]=2;}else{this.setProperty(d,c,false,false,2);}}return c;};this.$handlePropSet=function(g,d,c){if(d&&this.$booleanProperties[g]){d=apf.isTrue(d);}if(typeof this[g]=="function"){throw new Error("Could not set property/attribute '"+g+"' which has the same name as a method on this object: '"+this.toString()+"'");}this[g]=d;var b;return(b=this.$propHandlers&&this.$propHandlers[g]||this.nodeFunc==apf.NODE_VISIBLE&&apf.GuiElement&&apf.GuiElement.propHandlers[g]||null)&&b.call(this,d,g,c);};this.addEventListener("DOMNodeInsertedIntoDocument",function(j){var d,g,c,b=this.attributes;for(g=0,c=b.length;g<c;g++){b[g].dispatchEvent("DOMNodeInsertedIntoDocument");}this.$amlLoaded=true;},true);}).call(apf.AmlElement.prototype=new apf.AmlNode());apf.AmlCharacterData=function(){this.data="";this.length=0;this.$init(true);this.appendData=function(b){this.dispatchEvent("DOMCharacterDataModified",{value:b});};this.deleteData=function(c,b){this.dispatchEvent("DOMCharacterDataModified",{offset:c,count:b});};this.insertData=function(c,b){this.dispatchEvent("DOMCharacterDataModified",{offset:c,count:b});};this.replaceData=function(d,b,c){this.dispatchEvent("DOMCharacterDataModified",{offset:d,count:b,value:c});};this.substringData=function(c,b){};};apf.AmlCharacterData.prototype=new apf.AmlNode();apf.AmlText=function(b){this.$init(b);};(function(){this.nodeType=this.NODE_TEXT;this.nodeName="#text";this.serialize=function(){return apf.xmlentities(this.nodeValue).replace(/</g,"&lt;").replace(/>/g,"&gt;");};this.$setValue=function(b){this.dispatchEvent("DOMCharacterDataModified",{bubbles:true,prevValue:this.nodeValue,newValue:this.nodeValue=b});if(this.$amlLoaded&&this.$ext){this.$ext.nodeValue=b;}};this.addEventListener("DOMNodeInsertedIntoDocument",function(c){var d;if(!(d=this.parentNode.$int)||this.parentNode.hasFeature(apf.__CHILDVALUE__)){return;}this.$amlLoaded=true;var b=this.nodeValue;if(apf.config.liveText&&!this.parentNode.hasFeature(apf.__CHILDVALUE__)&&(b.indexOf("{")>-1||b.indexOf("[")>-1)){this.$supportedProperties=[];this.$propHandlers={};this.$booleanProperties={};this.$inheritProperties={};this.$propHandlers.calcdata=apf.LiveMarkupPi.prototype.$propHandlers.calcdata;this.$setInheritedAttribute=apf.AmlElement.prototype.$setInheritedAttribute;this.implement(apf.StandardBinding);d.appendChild(this.$ext=document.createElement("span"));this.$setDynamicProperty("calcdata",this.nodeValue);return;}if(apf.hasTextNodeWhiteSpaceBug){var b=b.replace(/[\t\n\r ]+/g," ");if(b&&b!=" "){this.$ext=d.appendChild(d.ownerDocument.createTextNode(b));}}else{this.$ext=d.appendChild(d.ownerDocument.createTextNode(b));}},true);}).call(apf.AmlText.prototype=new apf.AmlCharacterData());apf.AmlTextRectangle=function(d){var b=this;function c(){var g=b.getAbsolutePosition(b.$ext);b.setProperty("left",g[0]);b.setProperty("top",g[1]);b.setProperty("right",document.documentElement.offsetWidth-g[0]);b.setProperty("bottom",document.documentElement.offsetWidth-g[1]);}d.addEventListener("prop.width",c);d.addEventListener("prop.height",c);d.addEventListener("prop.left",c);d.addEventListener("prop.top",c);c.call(d);};apf.AmlTextRectangle.prototype=new apf.Class();apf.AmlProcessingInstruction=function(b){this.$init(b);this.$supportedProperties=[];this.$propHandlers={};this.$booleanProperties={};this.$inheritProperties={};};(function(){this.nodeType=this.NODE_PROCESSING_INSTRUCTION;this.data=null;this.target=null;this.serialize=function(){return"<?"+this.target+"\n"+apf.xmlentities(this.nodeValue)+"\n?>";};this.reload=function(){this.$handlePropSet("data",this.data);};this.$attrExcludePropBind=apf.extend({calcdata:0},this.$attrExcludePropBind);this.getAttribute=function(){};this.$setInheritedAttribute=apf.AmlElement.prototype.$setInheritedAttribute;this.$setValue=function(b){this.setProperty("data",b);};this.$handlePropSet=function(d,c,b){this[d]=c;if(d=="data"){this.$clearDynamicProperty("calcdata");this.$setDynamicProperty("calcdata",c);}else{if(d=="target"){}else{if(this.$propHandlers[d]){this.$propHandlers[d].call(this,c,d);}}}};this.addEventListener("DOMNodeInsertedIntoDocument",function(b){var c=b.pHtmlNode;if(!c&&(this.parentNode.$bindingRule||!(c=this.parentNode.$int))){return;}c.appendChild(this.$ext=document.createElement("span"));this.$ext.host=this;this.$setDynamicProperty("calcdata",this.data);if(this.target.match(/\-debug$/)){apf.console.info(this.$lastFParsed.toString());}},true);this.$destroy=function(){this.$clearDynamicProperty("calcdata");this.$propHandlers.calcdata.call(this,"");};}).call(apf.AmlProcessingInstruction.prototype=new apf.AmlNode());apf.AmlDocument=function(){this.$prefixes={};this.$namespaceURIs={};this.domConfig=new apf.AmlConfiguration();this.$init();};(function(){this.nodeType=this.NODE_DOCUMENT;this.nodeFunc=apf.NODE_HIDDEN;this.nodeName="#document";this.$amlLoaded=true;this.activeElement=null;this.doctype=null;this.domConfig=null;this.implementation=null;this.characterSet=apf.characterSet;this.documentElement=null;this.getElementById=function(b){return self[b];};this.getElementsByTagName=function(c){var d,b=(d=this.documentElement).getElementsByTagName(c);if(c=="*"||d.tagName==c){b.unshift(d);}return b;};this.getElementsByTagNameNS=function(d,c){var g,b=(g=this.documentElement).getElementsByTagNameNS(d,c);if(c=="*"||g.tagName==c&&g.namespaceURI==d){b.unshift(g);}return b;};this.createElement=function(b){return this.$domParser.$createNode(this,this.NODE_ELEMENT,null,this.namespaceURI,b);};this.createElementNS=function(b,c){return this.$domParser.$createNode(this,this.NODE_ELEMENT,null,b,c);};this.importNode=function(c,b){if(b&&c.nodeType==1){return this.$domParser.parseFromXml(c,{doc:this,delay:true}).childNodes[0];}else{return this.$domParser.$createNode(this,c.nodeType,c);}};this.createAttribute=function(b){return this.$domParser.$createNode(this,this.NODE_ATTRIBUTE,null,this.nameSpaceURI,b);};this.createAttributeNS=function(b,c){return this.$domParser.$createNode(this,this.NODE_ATTRIBUTE,null,b,c);};this.createEvent=function(){return new apf.AmlEvent();};this.createComment=function(b){return this.$domParser.$createNode(this,this.NODE_COMMENT,null,null,null,b);};this.createProcessingInstruction=function(c,b){return this.$domParser.$createNode(this,this.NODE_PROCESSING_INSTRUCTION,null,null,c,b);};this.createCDATASection=function(b){return this.$domParser.$createNode(this,this.NODE_CDATA_SECTION,null,null,null,b);};this.createTextNode=function(b){return this.$domParser.$createNode(this,this.NODE_TEXT,null,null,null,b);};this.createDocumentFragment=function(){return this.$domParser.$createNode(this,this.NODE_DOCUMENT_FRAGMENT);};this.querySelector=function(){};this.querySelectorAll=function(){};this.evaluate=function(j,g,d,k,c){var b=apf.XPath.selectNodes(j,g||this.documentElement);return{snapshotLength:b.length,snapshotItem:function(m){return b[m];}};};this.createNSResolver=function(b){return{};};this.hasFocus=function(){};}).call(apf.AmlDocument.prototype=new apf.AmlNode());apf.AmlComment=function(b){this.nodeType=this.NODE_COMMENT;this.nodeName="#comment";this.$init(b);};(function(){this.serialize=function(){return"<!--"+this.nodeValue+"-->";};this.$setValue=function(b){this.dispatchEvent("DOMCharacterDataModified",{bubbles:true,newValue:b,prevValue:this.nodeValue});};}).call(apf.AmlComment.prototype=new apf.AmlCharacterData());apf.AmlNamedNodeMap=function(b){this.$host=b;};(function(){this.getNamedItem=function(b){for(var c=0;c<this.length;c++){if(this[c].name==b){return this[c];}}return false;};this.setNamedItem=function(g){var b=g.name;for(var d,c=this.length-1;c>=0;c--){if(this[c].name==b){this[c].ownerElement=null;this.splice(c,1);break;}}this.push(g);g.ownerElement=this.$host;g.ownerDocument=this.$host.ownerDocument;g.$triggerUpdate();};this.removeNamedItem=function(c){for(var g,d=this.length-1;d>=0;d--){if(this[d].name==c){g=this[d];this.splice(d,1);break;}}if(!g){return false;}var b=g.nodeValue;g.nodeValue=g.value="";g.$triggerUpdate(null,b);g.ownerElement=null;g.nodeValue=g.value=b;return g;};this.item=function(b){return this[b];};this.length=0;this.splice=function(g,d){for(var c=g,b=this.length-d;c<b;c++){this[c]=this[c+1];}delete this[c];this.length-=d;};this.push=function(b){this[this.length++]=b;return this.length;};this.join=function(j){var b=[];for(var k,d,g=0,c=this.length;g<c;g++){if((k=(d=this[g]).ownerElement)&&!k.$inheritProperties[d.nodeName]){b.push(this[g]);}}return b.join(j);};}).call(apf.AmlNamedNodeMap.prototype={});apf.AmlEvent=function(b,c){this.name=b;var d;for(d in c){this[d]=c[d];}};apf.AmlEvent.prototype={bubbles:false,cancelBubble:false,preventDefault:function(){this.returnValue=false;},stopPropagation:function(){this.cancelBubble=true;},stop:function(){this.returnValue=false;this.cancelBubble=true;}};apf.AmlAttr=function(d,b,c){this.$init();if(d){this.ownerElement=d;this.ownerDocument=d.ownerDocument;}this.nodeName=this.name=b;this.nodeValue=this.value=c;};(function(){this.nodeType=this.NODE_ATTRIBUTE;this.MODIFICATION=1;this.ADDITION=2;this.REMOVAL=3;this.serialize=this.toString=function(){return this.name+'="'+apf.xmlentities(String(this.value)).replace(/</g,"&lt;").replace(/>/g,"&gt;")+'"';};this.$setValue=function(b){this.nodeValue=this.value=b;this.specified=true;this.ownerElement.dispatchEvent("DOMAttrModified",{relatedNode:this,attrChange:this.MODIFICATION,attrName:this.name,newValue:b,prevValue:this.$lastValue||"",bubbles:true});this.$lastValue=b;};this.$triggerUpdate=function(j,c){var b=this.name,g=this.value||this.nodeValue,d=this.ownerElement;if(b=="id"&&!this.specified&&d.id){this.specified=true;return;}if(b.substr(0,2)=="on"){if(d.$events[b]){d.removeEventListener(b.replace(/^on/,""),d.$events[b]);}if(g){d.addEventListener(b,(d.$events[b]=(typeof g=="string"?apf.lm.compile(g,{event:true,parsecode:true}):g)));}return;}else{if(this.specified){d.$clearDynamicProperty(b);}if(typeof g=="string"&&(d.$attrExcludePropBind[b]||(g.indexOf("{")>-1||g.indexOf("[")>-1))){d.$setDynamicProperty(b,g);this.specified=true;return;}}d.setProperty(b,g);if(this.specified){d.dispatchEvent("DOMAttrModified",{relatedNode:this,attrChange:this.MODIFICATION,attrName:b,newValue:g,prevValue:this.$lastValue||"",bubbles:true});}else{this.specified=true;}this.$lastValue=g;};this.addEventListener("DOMNodeInsertedIntoDocument",this.$triggerUpdate);}).call(apf.AmlAttr.prototype=new apf.AmlNode());apf.AmlCDATASection=function(b){this.nodeType=this.NODE_CDATA_SECTION;this.nodeName="#cdata-section";this.$init(b);};apf.AmlCDATASection.prototype=new apf.AmlText(true);apf.AmlCDATASection.prototype.serialize=function(){return"<![CDATA["+this.nodeValue+"]]>";};apf.AmlConfiguration=function(b){this.parameterNames=[];this.$init(b);};(function(){this.setParameter=this.setProperty;this.getParameter=this.getProperty;this.canSetParameter=function(b,c){return this.parameterNames.indexOf(b)>-1;};}).call(apf.AmlConfiguration.prototype=new apf.Class());apf.AmlDocumentFragment=function(b){this.$init(b);};apf.AmlDocumentFragment.prototype=new apf.AmlNode();apf.AmlDocumentFragment.prototype.nodeName="#document-fragment";apf.AmlDocumentFragment.prototype.nodeType=apf.AmlDocumentFragment.prototype.NODE_DOCUMENT_FRAGMENT;apf.xhtml=new apf.AmlNamespace();apf.setNamespace("http://www.w3.org/1999/xhtml",apf.xhtml);apf.XhtmlElement=function(d,c){this.$init(c||true,apf.NODE_VISIBLE,d);this.$xoe=this.addEventListener;this.addEventListener=this.$xae;this.removeEventListener=this.$xre;var b=this;this.$de=function(g){b.dispatchEvent(g.type,g);};};(function(){this.$xae=function(c,b){this.$xoe.apply(this,arguments);if(this.$ext){apf.addListener(this.$ext,c,this.$de);}};this.$xre=function(c,b){apf.AmlElement.prototype.removeEventListener.apply(this,arguments);if(this.$ext){apf.removeListener(this.$ext,c,this.$de);}};this.$handlePropSet=function(b,g,d){if(this.$booleanProperties[b]){g=apf.isTrue(g);}this[b]=g;var c=this.$propHandlers&&this.$propHandlers[b]||apf.GuiElement.propHandlers[b];if(c){c.call(this,g,null,b);}else{if(this.$int){this.$int.setAttribute(apf.isIE&&b=="class"?"className":b,g);}}};this.addEventListener("DOMNodeInsertedIntoDocument",function(b){var c;if(!(c=this.parentNode.$int)){return;}if(this.$aml){this.$ext=this.$int=apf.insertHtmlNode(this.$aml.serialize?this.$aml:this.$aml.cloneNode(false),c);}else{this.$ext=this.$int=c.appendChild(document.createElement(this.localName));}},true);}).call(apf.XhtmlElement.prototype=new apf.AmlElement());apf.xhtml.setElement("@default",apf.XhtmlElement);apf.XhtmlOptionElement=function(c,b){this.$init(b||"option",apf.NODE_VISIBLE,c);};(function(){this.addEventListener("DOMNodeInsertedIntoDocument",function(b){this.$ext=this.$int=this.parentNode.$int.appendChild(this.parentNode.$int.ownerDocument.createElement("option"));if(this.value){this.$int.setAttribute("value",this.value);}},true);}).call(apf.XhtmlOptionElement.prototype=new apf.AmlElement());apf.xhtml.setElement("option",apf.XhtmlOptionElement);apf.XhtmlInputElement=function(c,b){this.$init(b||"input",apf.NODE_VISIBLE,c);};(function(){this.$xae=apf.XhtmlElement.prototype.$xae;this.$xre=apf.XhtmlElement.prototype.$xre;this.$handlePropSet=function(b,d,c){if(b=="type"){return;}return apf.XhtmlElement.prototype.$handlePropSet.call(this,b,d,c);};this.addEventListener("DOMNodeInsertedIntoDocument",function(b){var c;if(!(c=this.parentNode.$int)){return;}if(this.$aml){this.$ext=this.$int=apf.insertHtmlNode(this.$aml.serialize?this.$aml:this.$aml.cloneNode(false),c);}else{this.$ext=this.$int=document.createElement(this.localName);if(this.getAttribute("type")){this.$int.setAttribute("type",this.getAttribute("type"));}c.appendChild(this.$int);}},true);}).call(apf.XhtmlInputElement.prototype=new apf.AmlElement());apf.xhtml.setElement("input",apf.XhtmlInputElement);apf.XhtmlHtmlElement=function(c,b){this.$init(b||"html",apf.NODE_VISIBLE,c);this.$int=document.body;this.$tabList=[];this.$focussable=apf.KEYBOARD;this.focussable=true;this.visible=true;this.$isWindowContainer=true;this.focus=function(){this.dispatchEvent("focus");};this.blur=function(){this.dispatchEvent("blur");};apf.window.$addFocus(this);this.addEventListener("DOMNodeInsertedIntoDocument",function(o){var k,j,r,g,q,d=this.attributes,m=this.ownerDocument;for(k=0,j=d.length;k<j;k++){r=(g=d[k]).nodeName.split(":");if(r[0]=="xmlns"){if(q=r[1]){m.$prefixes[q]=g.nodeValue;m.$namespaceURIs[g.nodeValue]=q;}else{m.namespaceURI=g.nodeValue;}}}if(!m.namespaceURI){m.namespaceURI=apf.ns.xhtml;}});};apf.XhtmlHtmlElement.prototype=new apf.XhtmlElement();apf.xhtml.setElement("html",apf.XhtmlHtmlElement);apf.XhtmlSkipChildrenElement=function(c,b){this.$init(b,apf.NODE_VISIBLE,c);};(function(){this.canHaveChildren=false;this.$redraw=function(){var b=this;apf.queue.add("redraw"+this.$uniqueId,function(){var d=b.$ext.parentNode;var c=b.$ext.nextSibling;d.removeChild(b.$ext);b.$ext=apf.insertHtmlNode(null,d,c,b.$aml?(b.$aml.serialize?b.$aml.serialize():b.$aml.xml):b.serialize());});};this.addEventListener("DOMNodeInsertedIntoDocument",function(b){var c;if(!(c=this.parentNode.$int)){return;}this.$ext=apf.insertHtmlNode(null,c,null,this.$aml?(this.$aml.serialize?this.$aml.serialize():this.$aml.xml):this.serialize());},true);}).call(apf.XhtmlSkipChildrenElement.prototype=new apf.AmlElement());apf.xhtml.setElement("object",apf.XhtmlSkipChildrenElement);apf.xhtml.setElement("embed",apf.XhtmlSkipChildrenElement);apf.xhtml.setElement("table",apf.XhtmlSkipChildrenElement);apf.xhtml.setElement("pre",apf.XhtmlSkipChildrenElement);apf.XhtmlBodyElement=function(c,b){this.$init(b||"body",apf.NODE_VISIBLE,c);};(function(){this.addEventListener("DOMNodeInsertedIntoDocument",function(b){if(!this.ownerDocument.body){this.ownerDocument.body=this;}this.$ext=this.$int=document.body;},true);}).call(apf.XhtmlBodyElement.prototype=new apf.AmlElement());apf.xhtml.setElement("body",apf.XhtmlBodyElement);apf.XhtmlIgnoreElement=function(c,b){this.$init(b,apf.NODE_VISIBLE,c);};apf.XhtmlIgnoreElement.prototype=new apf.AmlElement();apf.xhtml.setElement("script",apf.XhtmlIgnoreElement);apf.xhtml.setElement("noscript",apf.XhtmlIgnoreElement);apf.xhtml.setElement("head",apf.XhtmlIgnoreElement);apf.xhtml.setElement("meta",apf.XhtmlIgnoreElement);apf.xinclude=new apf.AmlNamespace();apf.setNamespace("http://www.w3.org/2001/XInclude",apf.xinclude);apf.XiInclude=function(c,b){this.$init(b||"include",apf.NODE_HIDDEN,c);};apf.xinclude.setElement("include",apf.XiInclude);apf.aml.setElement("include",apf.XiInclude);(function(){this.$parsePrio="002";this.$propHandlers.href=this.$propHandlers.src=function(g){if(typeof g!="string"){return c.call(this,g);}this.$path=g.charAt(0)=="{"?g:apf.getAbsolutePath(apf.hostPath,g);var j=this.ownerDocument.$domParser;if(!this.defer){j.$shouldWait++;this.$parseContext=j.$parseContext||[this.parentNode];}d.call(this,this.$path);};function b(g){if(this.callback){this.callback({xmlNode:g,amlNode:this.parentNode});}this.parentNode.removeChild(this);}function c(m){var r=this.ownerDocument.$domParser;if(this.clear){this.parentNode.$int.innerHTML="";}if(m){r.parseFromXml(m,{doc:this.ownerDocument,amlNode:this.parentNode,beforeNode:this,include:true});if(!this.defer){var q=(this.$parseContext[1]||(this.$parseContext[1]={})),j=q.callback,g=this;q.callback=function(){b.call(g,m);if(j){j.call(g.ownerDocument);}};if(r.$continueParsing.apply(r,this.$parseContext)===false){var n=(r.$parseContext[1]||(r.$parseContext[1]={})),k=q.callback;n.callback=function(){if(j){j.call(g.ownerDocument);}r.$continueParsing.apply(r,g.$parseContext);};}}else{b.call(this,m);}}else{if(!this.defer){r.$continueParsing.apply(r,this.$parseContext);}b.call(this,m);}}function d(j){apf.console.info("Loading include file: "+j);var g=this;apf.getData(j,apf.extend(this.options||{},{type:"markup",callback:function(o,n,k){if(n!=apf.SUCCESS){var q=new Error(apf.formatErrorString(1007,g,"Loading Includes","Could not load Include file '"+(j||g.src)+"'\nReason: "+k.message));if(k.tpModule.retryTimeout(k,n,null,q)===true){return true;}apf.console.error(q.message);c.call(g,null);return;}o=o.replace(/\<\!DOCTYPE[^>]*>/,"").replace(/^[\r\n\s]*/,"");if(!apf.supportNamespaces){o=o.replace(/xmlns\=\"[^"]*\"/g,"");}if(o.indexOf("<a:application")==-1){o="<a:application xmlns:a='"+apf.ns.aml+"'>"+o+"</a:application>";}var m=apf.getXml(o,null,true);if(!m){throw new Error(apf.formatErrorString(0,null,"Loading include","Could not parse include file. Maybe the file does not exist?",m));}m.setAttribute("filename",k.url);apf.console.info("Loading of "+m[apf.TAGNAME].toLowerCase()+" include done from file: "+k.url);c.call(g,m);},async:true,ignoreOffline:true}));}}).call(apf.XiInclude.prototype=new apf.AmlElement());apf.__ANCHORING__=1<<13;apf.Anchoring=function(){this.$regbase=this.$regbase|apf.__ANCHORING__;this.$anchors=[];var k=1;var d=2;this.$updateQueue=0;this.$inited=this.$parsed=this.$anchoringEnabled=false;this.$hordiff=this.$verdiff=0;this.$rule_v=this.$rule_h=this.$rule_header="";var g=apf.layout;this.$supportedProperties.push("anchors");var c={right:function(q,r){if(!this.$anchoringEnabled&&!this.$setLayout("anchoring")){return;}if(!q&&q!==0){this.$ext.style[r]="";}if(!this.$updateQueue){g.queue(this.$pHtmlNode,this);}this.$updateQueue=this.$updateQueue|d;},bottom:function(q,r){if(!this.$anchoringEnabled&&!this.$setLayout("anchoring")){return;}if(!q&&q!==0){this.$ext.style[r]="";}if(!this.$updateQueue){g.queue(this.$pHtmlNode,this);}this.$updateQueue=this.$updateQueue|k;}};c.left=c.width=c.right;c.top=c.height=c.bottom;this.$propHandlers.anchors=function(q){this.$anchors=q?q.splitSafe("(?:, *| )"):[];if(!this.$anchoringEnabled&&!this.$setLayout("anchoring")){return;}if(!this.$updateQueue&&apf.loaded){g.queue(this.$pHtmlNode,this);}this.$updateQueue=this.$updateQueue|d|k;};this.$disableAnchoring=function(q){if(!this.$inited||!this.$anchoringEnabled||!this.$pHtmlNode){return;}g.removeRule(this.$pHtmlNode,this.$uniqueId+"_anchors");if(g.queue){g.queue(this.$pHtmlNode);}for(var r in c){delete this.$propHandlers[r];}this.removeEventListener("DOMNodeRemoved",m);this.removeEventListener("DOMNodeInserted",b);if(this.right){this.$ext.style.left=apf.getHtmlLeft(this.$ext)+"px";}if(this.bottom){this.$ext.style.top=apf.getHtmlTop(this.$ext)+"px";}this.removeEventListener("prop.visible",j);this.$inited=false;this.$anchoringEnabled=false;};this.$enableAnchoring=function(){if(this.$inited){return;}apf.extend(this.$propHandlers,c);this.addEventListener("DOMNodeRemoved",m);this.addEventListener("DOMNodeInserted",b);this.addEventListener("prop.visible",j);this.$updateQueue=0|((this.left||this.width||this.right||this.anchors)&&d)|((this.top||this.height||this.bottom||this.anchors)&&k);if(this.$updateQueue){g.queue(this.$pHtmlNode,this);}this.$inited=true;this.$anchoringEnabled=true;};function j(q){if(!(this.$rule_header||this.$rule_v||this.$rule_h)){return;}if(q.value){if(this.$rule_v||this.$rule_h){var r=this.$rule_header+"\n"+this.$rule_v+"\n"+this.$rule_h;g.setRules(this.$pHtmlNode,this.$uniqueId+"_anchors",r);g.queue(this.$pHtmlNode,this);}g.processQueue();}else{g.removeRule(this.$pHtmlNode,this.$uniqueId+"_anchors");g.queue(this.$pHtmlNode);}}function m(q){if(q&&(q.$doOnlyAdmin||q.currentTarget!=this)){return;}if(g.queue&&this.$pHtmlNode){g.removeRule(this.$pHtmlNode,this.$uniqueId+"_anchors");g.queue(this.$pHtmlNode);}}function b(q){if(!this.$amlLoaded||q.currentTarget!=this){return;}if(!q.$isMoveWithinParent&&this.$parsed){this.$moveAnchoringRules(q.$oldParentHtmlNode);}}this.$moveAnchoringRules=function(q,r){var s=q&&g.removeRule(q,this.$uniqueId+"_anchors");if(s){g.queue(q);}if(!this.$rule_v&&!this.$rule_h&&!this.$rule_header){return;}this.$rule_header=o.call(this);s=this.$rule_header+"\n"+this.$rule_v+"\n"+this.$rule_h;g.setRules(this.$pHtmlNode,this.$uniqueId+"_anchors",s);g.queue(this.$pHtmlNode,this);};this.$hasAnchorRules=function(){return this.$rule_v||this.$rule_h?true:false;};function o(){return"try{            var oHtml = "+(apf.hasHtmlIdsInJs?this.$ext.getAttribute("id"):"document.getElementById('"+this.$ext.getAttribute("id")+"')")+";                        var pWidth = "+(this.$pHtmlNode==this.$pHtmlDoc.body?"apf.getWindowWidth()":"apf.getHtmlInnerWidth(oHtml.parentNode)")+";                        var pHeight = "+(this.$pHtmlNode==this.$pHtmlDoc.body?"apf.getWindowHeight()":"apf.getHtmlInnerHeight(oHtml.parentNode)")+";            }catch(e){            }";}function n(r,q){return String(r).replace(apf.percentageMatch,"(("+q+" * $1)/100)");}this.$updateLayout=function(){if(!this.$ext.offsetHeight&&!this.$ext.offsetWidth){var C=this;var u=function(L,K,M){if(C.$updateQueue&&apf.isTrue(M)&&(C.$ext.offsetWidth||C.$ext.offsetHeight)){C.$updateLayout();apf.layout.activateRules(C.$ext.parentNode);var N=C;while(N){N.unwatch("visible",u);N=N.parentNode;}C.$isWaitingOnDisplay=false;}};this.$isWaitingOnDisplay=true;this.watch("visible",u);var s=this.parentNode;while(s){s.watch("visible",u);s=s.parentNode;}return;}if(!this.$parsed){if(!this.$ext.getAttribute("id")){apf.setUniqueHtmlId(this.$ext);}this.$rule_header=o.call(this);this.$parsed=true;}if(!this.$updateQueue){if(this.visible&&this.$ext.style.display=="none"){this.$ext.style.display="";}return;}if(this.draggable=="relative"){if("absolute|fixed|relative".indexOf(apf.getStyle(this.$ext,"position"))==-1){this.$ext.style.position="absolute";}}else{if(this.left||this.left===0||this.top||this.top===0||this.right||this.right===0||this.bottom||this.bottom===0||this.$anchors.length){if("absolute|fixed".indexOf(apf.getStyle(this.$ext,"position"))==-1){this.$ext.style.position="absolute";}}else{this.$ext.style.position="relative";if(!this.width){this.$ext.style.width="";}if(!this.height){this.$ext.style.height="";}}}var H;if(this.$updateQueue&d){H=[];this.$hordiff=apf.getWidthDiff(this.$ext);var B=this.$anchors[3]||this.left,F=this.$anchors[1]||this.right,t=this.width,E=B||B===0,J=F||F===0,A=t||t===0;if(F&&typeof F=="string"){F=n(F,"pWidth");}if(E){if(parseInt(B)!=B){B=n(B,"pWidth");H.push("oHtml.style.left = ("+B+") + 'px'");}else{this.$ext.style.left=B+"px";}}if(!E&&J){if(parseInt(F)!=F){F=n(F,"pWidth");H.push("oHtml.style.right = ("+F+") + 'px'");}else{this.$ext.style.right=F+"px";}}if(E&&J){H.push("oHtml.style.width = (pWidth - ("+F+") - ("+B+") - "+this.$hordiff+") + 'px'");}else{if(A){if(parseInt(t)!=t){t=n(t,"pWidth");H.push("oHtml.style.width = Math.max("+(this.minwidth-this.$hordiff)+", Math.min("+(this.maxwidth-this.$hordiff)+", "+t+" - "+this.$hordiff+")) + 'px'");}else{this.$ext.style.width=((t>this.minwidth?(t<this.maxwidth?t:this.maxwidth):this.minwidth)-this.$hordiff)+"px";}}}this.$rule_h=(H.length?"try{"+H.join(";}catch(e){};try{")+";}catch(e){};":"");}if(this.$updateQueue&k){H=[];this.$verdiff=apf.getHeightDiff(this.$ext);var D=this.$anchors[0]||this.top,q=this.$anchors[2]||this.bottom,G=this.height,w=D||D===0,r=q||q===0,I=G||G===0;if(q&&typeof q=="string"){q=n(q,"pHeight");}if(w){if(parseInt(D)!=D){D=n(D,"pHeight");H.push("oHtml.style.top = ("+D+") + 'px'");}else{this.$ext.style.top=D+"px";}}if(!w&&r){if(parseInt(q)!=q){H.push("oHtml.style.bottom = ("+q+") + 'px'");}else{this.$ext.style.bottom=q+"px";}}if(w&&r){H.push("oHtml.style.height = (pHeight - ("+q+") - ("+D+") - "+this.$verdiff+") + 'px'");}else{if(I){if(parseInt(G)!=G){G=n(G,"pHeight");H.push("oHtml.style.height = Math.max("+(this.minheight-this.$verdiff)+", Math.min("+(this.maxheight-this.$verdiff)+", "+G+" - "+this.$verdiff+")) + 'px'");}else{this.$ext.style.height=((G>this.minheight?(G<this.maxheight?G:this.maxheight):this.minheight)-this.$verdiff)+"px";}}}this.$rule_v=(H.length?"try{"+H.join(";}catch(e){};try{")+";}catch(e){};":"");}if(this.$rule_v||this.$rule_h){g.setRules(this.$pHtmlNode,this.$uniqueId+"_anchors",this.$rule_header+"\n"+this.$rule_v+"\n"+this.$rule_h,true);}else{g.removeRule(this.$pHtmlNode,this.$uniqueId+"_anchors");}this.$updateQueue=0;};this.addEventListener("DOMNodeInsertedIntoDocument",function(q){});this.addEventListener("DOMNodeRemovedFromDocument",function(q){this.$disableAnchoring();});};apf.__ALIGNMENT__=1<<12;apf.Alignment=function(){this.$regbase=this.$regbase|apf.__ALIGNMENT__;var l=apf.layout;if(typeof this.dock=="undefined"){this.dock=false;}if(typeof this.dockable=="undefined"){this.dockable=false;}this.$booleanProperties.dock=true;this.$booleanProperties.dockable=true;this.$supportedProperties.push("dock","dockable","align","lean","edge","weight","splitter","minwidth","minheight");this.$disableAlignment=function(purge){if(!this.aData||!this.$alignmentEnabled){return;}for(var prop in propHandlers){delete this.$propHandlers[prop];}this.removeEventListener("DOMNodeRemoved",remove);this.removeEventListener("DOMNodeInserted",reparent);this.removeEventListener("prop.visible",visibleHandler);remove.call(this);this.$alignmentEnabled=false;};this.$enableAlignment=function(purge){this.$alignmentEnabled=true;var buildParent="vbox|hbox".indexOf(this.parentNode.tagName)==-1&&!this.parentNode.pData;apf.extend(this.$propHandlers,propHandlers);this.addEventListener("DOMNodeRemoved",remove);this.addEventListener("DOMNodeInserted",reparent);this.addEventListener("prop.visible",visibleHandler);var layout=l.get(this.$pHtmlNode,buildParent?apf.getBox(this.parentNode.margin||this.$pHtmlNode.getAttribute("margin")||""):null);if(buildParent){this.parentNode.pData=l.parseXml(this.parentNode||apf.getXml("<vbox />"),layout,"vbox",true);layout.root=this.parentNode.pData;}if(!this.aData){this.aData=l.parseXml(this,layout,this,true);}if(this.align){l.addAlignNode(this,layout.root);if(this.aData.hidden||this.visible===false){this.aData.prehide(true);}this.$purgeAlignment();}else{var pData=this.parentNode.aData||this.parentNode.pData;this.aData.stackId=pData.children.push(this.aData)-1;this.aData.parent=pData;}};function visibleHandler(e){if(!this.aData){return;}if(!this.aData.hidden==e.value){return;}if(e.value){if(this.aData.preshow()!==false){this.$ext.style.display="none";}this.$purgeAlignment();}else{this.$ext.style.display="block";this.aData.prehide();this.$purgeAlignment();}apf.layout.processQueue();}this.$purgeAlignment=function(){var layout=l.get(this.$pHtmlNode);if(this.$ext&&this.$ext.style.display=="block"&&!this.$ext.offsetHeight&&!this.$ext.offsetWidth){var _self=this;var propChange=function(name,old,value){if(_self.$ext.offsetWidth||_self.$ext.offsetHeight){l.queue(_self.$pHtmlNode,null,layout.root);var p=_self;while(p){p.unwatch("visible",propChange);p=p.parentNode;}_self.$isWaitingOnDisplay=false;}};this.$isWaitingOnDisplay=true;this.watch("visible",propChange);var p=this.parentNode;while(p){p.watch("visible",propChange);p=p.parentNode;}return;}l.queue(this.$pHtmlNode,null,layout.root);};function remove(e){if(e&&(e.$doOnlyAdmin||e.currentTarget!=this)){return;}if(this.aData){this.aData.remove();this.$purgeAlignment();if(this.parentNode.pData&&!this.parentNode.pData.children.length){l.removeAll(this.parentNode.pData);this.parentNode.pData=null;}if(this.$ext){this.$ext.style.display="none";}}}function reparent(e){if(!this.$amlLoaded||e.currentTarget!=this){return;}if(!e.$isMoveWithinParent&&this.aData&&this.aData.pHtml!=this.$pHtmlNode){this.aData.pHtml=this.$pHtmlNode;this.$enableAlignment();}}var propHandlers={align:function(value){if(value){this.$setLayout("alignment");}else{this.$setLayout("anchoring");this.$ext.style.display="block";}},lean:function(value){this.aData.isBottom=(value||"").indexOf("bottom")>-1;this.aData.isRight=(value||"").indexOf("right")>-1;this.$purgeAlignment();},edge:function(value){this.aData.edgeMargin=Math.max(this.aData.splitter||0,value!="splitter"?value:0);this.aData.splitter=value=="splitter"?5:false;this.$purgeAlignment();},weight:function(value){this.aData.weight=parseFloat(value);this.$purgeAlignment();},splitter:function(value){this.aData.splitter=value?5:false;this.aData.edgeMargin=Math.max(this.aData.splitter||0,this.edge||0);if(!value&&this.align&&this.align.indexOf("-splitter")){this.align=this.aData.template=this.align.replace("-splitter","");}this.$purgeAlignment();},width:function(value){this.width=null;this.aData.fwidth=value||false;if(this.aData.fwidth&&this.aData.fwidth.indexOf("/")>-1){this.aData.fwidth=eval(this.aData.fwidth);if(this.aData.fwidth<=1){this.aData.fwidth=(this.aData.fwidth*100)+"%";}}this.$purgeAlignment();},height:function(value){this.height=null;this.aData.fheight=String(value)||false;if(this.aData.fheight&&this.aData.fheight.indexOf("/")>-1){this.aData.fheight=eval(this.aData.fheight);if(this.aData.fheight<=1){this.aData.fheight=(this.aData.fheight*100)+"%";}}this.$purgeAlignment();},minwidth:function(value){this.aData.minwidth=value;this.$purgeAlignment();},minheight:function(value){this.aData.minheight=value;this.$purgeAlignment();}};this.addEventListener("DOMNodeRemovedFromDocument",function(e){this.$disableAlignment();this.aData=null;});};apf.__CONTENTEDITABLE__=1<<24;apf.__GUIELEMENT__=1<<15;apf.__VALIDATION__=1<<6;apf.GuiElement=function(){this.$init(true);};(function(){this.$regbase=this.$regbase|apf.__GUIELEMENT__;this.$focussable=apf.KEYBOARD_MOUSE;this.visible=true;this.minwidth=5;this.minheight=5;this.maxwidth=10000;this.maxheight=10000;this.$booleanProperties["disable-keyboard"]=true;this.$booleanProperties.visible=true;this.$booleanProperties.focussable=true;this.$supportedProperties.push("draggable","resizable");this.$supportedProperties.push("focussable","zindex","disabled","tabindex","disable-keyboard","contextmenu","visible","autosize","loadaml","actiontracker","alias","width","left","top","height","tooltip");this.$setLayout=function(c){if(!this.$drawn||!this.$pHtmlNode){return false;}if(this.parentNode){if(this.parentNode.localName=="table"){if(this.$disableCurrentLayout){this.$disableCurrentLayout();}this.parentNode.register(this);this.$disableCurrentLayout=null;return c=="table";}else{if("vbox|hbox".indexOf(this.parentNode.localName)>-1){if(this.$disableCurrentLayout){this.$disableCurrentLayout();}this.parentNode.register(this);this.$disableCurrentLayout=null;return c==this.parentNode.localName;}else{if(this.align){if(!this.$alignmentEnabled){if(this.$disableCurrentLayout){this.$disableCurrentLayout();}this.$enableAlignment();this.$disableCurrentLayout=this.$disableAlignment;}return c=="alignment";}}}}if(!this.$anchoringEnabled){if(this.$disableCurrentLayout){this.$disableCurrentLayout();}this.$enableAnchoring();this.$disableCurrentLayout=this.$disableAnchoring;}return c=="anchoring";};this.addEventListener("DOMNodeInserted",function(c){if(c.currentTarget==this&&"vbox|hbox|table".indexOf(this.parentNode.localName)==-1){this.$setLayout();}});this.implement(apf.Anchoring,apf.Alignment);this.setWidth=function(c){this.setProperty("width",c,false,true);return this;};this.setHeight=function(c){this.setProperty("height",c,false,true);return this;};this.setLeft=function(c){this.setProperty("left",c,false,true);return this;};this.setTop=function(c){this.setProperty("top",c,false,true);return this;};if(!this.show){this.show=function(){this.setProperty("visible",true,false,true);return this;};}if(!this.hide){this.hide=function(){this.setProperty("visible",false,false,true);return this;};}this.getWidth=function(){return(this.$ext||{}).offsetWidth;};this.getHeight=function(){return(this.$ext||{}).offsetHeight;};this.getLeft=function(){return(this.$ext||{}).offsetLeft;};this.getTop=function(){return(this.$ext||{}).offsetTop;};this.enable=function(){this.setProperty("disabled",false,false,true);return this;};this.disable=function(){this.setProperty("disabled",true,false,true);return this;};this.sendToBack=function(){this.setProperty("zindex",0,false,true);return this;};this.bringToFront=function(){this.setProperty("zindex",apf.all.length+1,false,true);return this;};this.sendBackwards=function(){this.setProperty("zindex",this.zindex-1,false,true);return this;};this.bringForward=function(){this.setProperty("zindex",this.zindex+1,false,true);return this;};this.hasFocus=function(){};this.addEventListener("DOMNodeInsertedIntoDocument",function(d){var c=this.$aml;if(this.parentNode){if(this.localName=="item"&&this.parentNode.hasFeature(apf.__MULTISELECT__)){this.$pHtmlNode=this.parentNode.$container;}else{this.$pHtmlNode=this.parentNode.$int;}}if(!this.$pHtmlNode){return;}this.$pHtmlDoc=this.$pHtmlNode.ownerDocument||document;if(this.$initSkin){this.$initSkin(c);}if(this.$draw){this.$draw();}if(d.id){this.$ext.setAttribute("id",d.id);}if(typeof this.visible=="undefined"){this.visible=true;}if(apf.debug&&this.$ext&&this.$ext.nodeType){this.$ext.setAttribute("uniqueId",this.$uniqueId);}if(this.$focussable&&typeof this.focussable=="undefined"){apf.GuiElement.propHandlers.focussable.call(this);}this.$drawn=true;},true);this.addEventListener("DOMNodeInsertedIntoDocument",function(c){if(!this.$pHtmlNode){return;}this.$setLayout();if(this.$loadAml){this.$loadAml(this.$aml);}});var b;this.addEventListener("$event.resize",b=function(d){apf.layout.setRules(this.$ext,"resize","var o = apf.all["+this.$uniqueId+"];            if (o) o.dispatchEvent('resize');",true);apf.layout.queue(this.$ext);this.removeEventListener("$event.resize",b);});this.addEventListener("contextmenu",function(o){if(!this.contextmenus){return;}if(this.hasFeature(apf.__DATABINDING__)){var c;var s=this.hasFeature(apf.__MULTISELECT__)?this.selected:this.xmlRoot;var n,k,j,d,g,q,r,t;for(n=0,k=this.contextmenus.length;n<k;n++){d=(typeof(r=this.contextmenus[n])=="string");t=null;if(!d&&r.match&&s){t=(r.cmatch||(r.cmatch=apf.lm.compile(r.match,{xpathmode:3,injectself:true})))(s);}if(d||s&&t||!r.match){q=d?r:r.menu;if(!self[q]){throw new Error(apf.formatErrorString(0,this,"Showing contextmenu","Could not find contextmenu by name: '"+q+"'"),this.$aml);return;}self[q].display(o.x,o.y,null,this,s);o.returnValue=false;o.cancelBubble=true;break;}}}else{q=typeof this.contextmenus[0]=="string"?this.contextmenus[0]:this.contextmenus[0].getAttribute("menu");if(!self[q]){throw new Error(apf.formatErrorString(0,this,"Showing contextmenu","Could not find contextmenu by name: '"+q+"'",this.$aml));return;}self[q].display(o.x,o.y,null,this);o.returnValue=false;o.cancelBubble=true;}});}).call(apf.GuiElement.prototype=new apf.AmlElement());apf.GuiElement.propHandlers={focussable:function(b){this.focussable=typeof b=="undefined"||b;if(!this.hasFeature(apf.__FOCUSSABLE__)){this.implement(apf.Focussable);}if(this.focussable){apf.window.$addFocus(this,this.tabindex);}else{apf.window.$removeFocus(this);}},zindex:function(b){this.$ext.style.zIndex=b;},visible:function(b){if(apf.isFalse(b)||typeof b=="undefined"){this.$ext.style.display="none";if(apf.document.activeElement==this||this.canHaveChildren&&apf.isChildOf(this,apf.document.activeElement,false)){if(apf.config.allowBlur&&this.hasFeature(apf.__FOCUSSABLE__)){this.blur();}else{apf.window.moveNext();}}this.visible=false;}else{this.$ext.style.display="block";if(apf.layout&&this.$int){apf.layout.forceResize(this.$int);}this.visible=true;}},disabled:function(k){if(!this.$drawn){var b=this;this.disabled=false;apf.queue.add("disable"+this.$uniqueId,function(m){b.disabled=k;apf.GuiElement.propHandlers.disabled.call(b,k);});return;}if(this.canHaveChildren){if(k!=-1){k=this.disabled=apf.isTrue(k);}var d=this.childNodes;for(var j,g=0,c=d.length;g<c;g++){j=d[g];if(j.nodeFunc==apf.NODE_VISIBLE){if(k&&j.disabled!=-1){j.$disabled=j.disabled||false;}j.setProperty("disabled",k?-1:false);}}if(this.$isWindowContainer){return;}}if(k==-1||k==false){}else{if(typeof this.$disabled=="boolean"){if(k===null){k=this.$disabled;this.$disabled=null;}else{this.$disabled=k||false;return;}}}if(apf.isTrue(k)||k==-1){this.disabled=false;if(apf.document.activeElement==this){apf.window.moveNext(true);if(apf.document.activeElement==this){this.$blur();}}if(this.hasFeature(apf.__PRESENTATION__)){this.$setStyleClass(this.$ext,this.$baseCSSname+"Disabled");}if(this.$disable){this.$disable();}this.disabled=k;}else{if(this.hasFeature(apf.__DATABINDING__)&&apf.config.autoDisable&&!(!this.$bindings||this.xmlRoot)){return false;}this.disabled=false;if(apf.document.activeElement==this){this.$focus();}if(this.hasFeature(apf.__PRESENTATION__)){this.$setStyleClass(this.$ext,null,[this.$baseCSSname+"Disabled"]);}if(this.$enable){this.$enable();}}},enabled:function(b){this.setProperty("disabled",!b);},"disable-keyboard":function(b){this.disableKeyboard=apf.isTrue(b);},tooltip:function(b){this.$ext.setAttribute("title",b);},align:function(b){if(b){this.$setLayout("alignment");}},contextmenu:function(b){this.contextmenus=[b];},actiontracker:function(b){if(!b){this.$at=null;}else{if(b.tagName=="actiontracker"){this.$at=b;}else{this.$at=typeof b=="string"&&self[b]?apf.nameserver.get("actiontracker",b)||self[b].getActionTracker():apf.setReference(b,apf.nameserver.register("actiontracker",b,new apf.actiontracker()));if(!this.$at.name){this.$at.name=b;}}}},aml:function(b){this.insertMarkup(b);}};apf.__PRESENTATION__=1<<9;apf.Presentation=function(){this.$init(true);};(function(){this.$regbase=this.$regbase|apf.__PRESENTATION__;this.$supportedProperties.push("skin");this.$propHandlers.skinset=this.$propHandlers.style=function(d){if(!this.styleAttrIsObj&&this.$amlLoaded){this.$ext.setAttribute("style",d);}};this.$propHandlers.border=function(d){if(!d){this.$ext.style.borderWidth="";}else{this.$ext.style.borderWidth=apf.getBox(d).join("px ")+"px";}};var b;this.$propHandlers["class"]=function(d){this.$setStyleClass(this.$ext,d,[b||""]);};this.$setStyleClass=apf.setStyleClass;function c(n){if(!this.$amlLoaded||n&&(n.$isMoveWithinParent||n.currentTarget!=this)){return;}this.$setInheritedAttribute(this,"skinset");if(this.attributes.getNamedItem("skin")){return;}var d,j=this.parentNode,g;if((d=this.$canLeechSkin.dataType==apf.STRING?this.$canLeechSkin:this.localName)&&j.$originalNodes&&(g=j.$originalNodes[d])&&g.getAttribute("inherit")){var k=g.getAttribute("link");this.$isLeechingSkin=true;if(k){this.$forceSkinChange(k);}else{var m=j.skinName.split(":");this.$forceSkinChange(m[1],m[0]);}}else{if(this.$isLeechingSkin){delete this.kin;this.$forceSkinChange();}}}this.$initSkin=function(d){if(this.$canLeechSkin){this.addEventListener("DOMNodeInserted",c);}if(!this.skin){this.skin=this.getAttribute("skin");}var g,k=this.parentNode,j;if(this.$canLeechSkin&&!this.skin&&(g=this.$canLeechSkin.dataType==apf.STRING?this.$canLeechSkin:this.localName)&&k.$originalNodes&&(j=k.$originalNodes[g])&&j.getAttribute("inherit")){var m=j.getAttribute("link");this.$isLeechingSkin=true;if(m){this.skin=m;this.$loadSkin();}else{this.$loadSkin(k.skinName);}}else{if(!this.skinset){this.skinset=this.getAttribute("skinset");}this.$loadSkin(null,this.$canLeechSkin);}};this.$loadSkin=function(j,g){this.baseSkin=j||(this.skinset||this.$setInheritedAttribute("skinset"))+":"+(this.skin||this.localName);clearTimeout(this.$skinTimer);if(this.skinName){this.$blur();this.$baseCSSname=null;}this.skinName=this.baseSkin;this.$pNodes={};this.$originalNodes=apf.skins.getTemplate(this.skinName,true);if(!this.$originalNodes){var k=this.skin;if(k){var d=this.skinName.split(":")[0];this.baseName=this.skinName="default:"+k;this.$originalNodes=apf.skins.getTemplate(this.skinName);if(!this.$originalNodes&&d!="default"){this.baseName=this.skinName=d+":"+this.localName;this.$originalNodes=apf.skins.getTemplate(this.skinName,true);}}if(!this.$originalNodes){this.baseName=this.skinName="default:"+this.localName;this.$originalNodes=apf.skins.getTemplate(this.skinName);}if(!this.$originalNodes){if(g){return(this.baseName=this.skinName=this.originalNode=null);}throw new Error(apf.formatErrorString(1077,this,"Presentation","Could not load skin: "+this.baseSkin));}}if(this.$originalNodes){apf.skins.setSkinPaths(this.skinName,this);}};this.$getNewContext=function(g,d){if(g!=g.toLowerCase()){throw new Error("Invalid layout node name ('"+g+"'). lowercase required");}if(!this.$originalNodes[g]){throw new Error(apf.formatErrorString(0,this,"Getting new skin item","Missing node in skin description '"+g+"'"));}this.$pNodes[g]=this.$originalNodes[g].cloneNode(true);};this.$hasLayoutNode=function(d){if(d!=d.toLowerCase()){throw new Error("Invalid layout node name ('"+d+"'). lowercase required");}return this.$originalNodes[d]?true:false;};this.$getLayoutNode=function(d,k,j){if(d!=d.toLowerCase()){throw new Error("Invalid layout node name ('"+d+"'). lowercase required");}if(!this.$pNodes){throw new Error("Skin not loaded for :"+this.serialize(true));}var g=this.$pNodes[d]||this.$originalNodes[d];if(!g){if(!this.$dcache){this.$dcache={};}if(!this.$dcache[d+"."+this.skinName]){this.$dcache[d+"."+this.skinName]=true;apf.console.info("Could not find node '"+d+"' in '"+this.skinName+"'","skin");}return false;}if(!k){return apf.getFirstElement(g);}var m=g.selectSingleNode("@"+k);if(!m){return null;}return(j?apf.queryNode(m.nodeValue,j):apf.getFirstElement(g).selectSingleNode(m.nodeValue));};this.$getOption=function(g,k){g=g.toLowerCase();var j=this.$pNodes[g]||this.$originalNodes[g];if(!k||!j){return j;}var d=j.selectSingleNode("@"+k);return d?d.nodeValue:"";};this.$getExternal=function(d,g,k,m){if(!g){g=this.$pHtmlNode;}if(!d){d="main";}d=d.toLowerCase();this.$getNewContext(d);var n=this.$getLayoutNode(d);var j;if(j=(m||this).getAttributeNode("style")){n.setAttribute("style",j.nodeValue);}if(j=(m||this).getAttributeNode("class")){this.$setStyleClass(n,(b=j.nodeValue));}if(k){k.call(this,n);}n=apf.insertHtmlNode(n,g);n.host=this;if(j=(m||this).getAttributeNode("bgimage")){n.style.backgroundImage="url("+apf.getAbsolutePath(this.mediaPath,j.nodeValue)+")";}if(!this.$baseCSSname){this.$baseCSSname=n.className.trim().split(" ")[0];}this.minwidth=apf.getCoord(parseInt(this.$getOption("main","minwidth")),5);this.minheight=apf.getCoord(parseInt(this.$getOption("main","minheight")),5);this.maxwidth=apf.getCoord(parseInt(this.$getOption("main","maxwidth")),10000);this.maxheight=apf.getCoord(parseInt(this.$getOption("main","maxheight")),10000);return n;};this.$focus=function(){if(!this.$ext){return;}this.$setStyleClass(this.oFocus||this.$ext,this.$baseCSSname+"Focus");};this.$blur=function(){if(this.renaming){this.stopRename(null,true);}if(!this.$ext){return;}this.$setStyleClass(this.oFocus||this.$ext,"",[this.$baseCSSname+"Focus"]);};this.$fixScrollBug=function(){if(this.$int!=this.$ext){this.oFocus=this.$int;}else{this.oFocus=this.$int=this.$ext.appendChild(document.createElement("div"));this.$int.style.height="100%";this.$int.className="focusbug";}};}).call(apf.Presentation.prototype=new apf.GuiElement());apf.config.$inheritProperties.skinset=1;apf.__VALIDATION__=1<<6;apf.validator={macro:{pattern:"value.match(",pattern_:")",custom:"(",custom_:")",min:"parseInt(value) >= ",max:"parseInt(value) <= ",maxlength:"value.toString().length <= ",minlength:"value.toString().length >= ",notnull:"value.toString().length > 0",checkequal:"!(temp = ",checkequal_:").isValid() || temp.getValue() == value"},compile:function(c){var b=this.macro,d=["var temp, valid = true;             if (!validityState)                 validityState = new apf.validator.validityState(); "];if(c.required){d.push("if (checkRequired && (!value || value.toString().trim().length == 0)) {                validityState.$reset();                validityState.valueMissing = true;                valid = false;            }");}d.push("validityState.$reset();            if (value) {");for(prop in c){if(!b[prop]){continue;}d.push("if (!(",b[prop],c[prop],b[prop+"_"]||"",")){                validityState.$set('",prop,"');                valid = false;            }");}d.push("};validityState.valid = valid; return validityState;");return new Function("value","checkRequired","validityState",d.join(""));}};apf.validator.validityState=function(){this.valueMissing=false,this.typeMismatch=false,this.patternMismatch=false,this.tooLong=false,this.rangeUnderflow=false,this.rangeOverflow=false,this.stepMismatch=false,this.customError=false,this.valid=true,this.$reset=function(){for(var b in this){if(b.substr(0,1)=="$"){continue;}this[b]=false;}this.valid=true;},this.$set=function(b){switch(b){case"min":this.rangeUnderflow=true;break;case"max":this.rangeOverflow=true;break;case"minlength":this.tooShort=true;break;case"maxlength":this.tooLong=true;break;case"pattern":this.patternMismatch=true;break;case"datatype":this.typeMismatch=true;break;case"notnull":this.typeMismatch=true;break;case"checkequal":this.typeMismatch=true;break;}};};apf.Validation=function(){this.$regbase=this.$regbase|apf.__VALIDATION__;this.isValid=function(c){if(!this.$vOptions){return true;}(this.$vOptions.isValid||(this.$vOptions.isValid=apf.validator.compile(this.$vOptions))).call(this,typeof this.getValue=="function"?this.getValue(null,true):null,c,this.validityState||(this.validityState=new apf.validator.validityState()));var b=this.validityState.valid;if(!b){this.dispatchEvent("invalid",this.validityState);}return b;};this.setCustomValidity=function(b){};this.showMe=function(){var b=this.parentNode;while(b){if(b.show){b.show();}b=b.parentNode;}};this.validate=function(b,d,c){if(c||!this.isValid(!b)&&!d){this.setError();return false;}else{this.clearError();return true;}};this.setError=function(c){if(!this.$validgroup){this.$propHandlers.validgroup.call(this,"vg"+this.parentNode.$uniqueId);}var b=this.$validgroup.getErrorBox(this);if(!this.$validgroup.allowMultipleErrors){this.$validgroup.hideAllErrors();}b.setMessage(this.invalidmsg);apf.setStyleClass(this.$ext,this.$baseCSSname+"Error");this.showMe();b.display(this);if(apf.document.activeElement&&apf.document.activeElement!=this){this.focus(null,{mouse:true});}};this.clearError=function(c){if(this.$setStyleClass){this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Error"]);}if(this.$validgroup){var b=this.$validgroup.getErrorBox(null,true);if(!b||b.host!=this){return;}b.hide();}};this.addEventListener("DOMNodeRemovedFromDocument",function(b){if(this.$validgroup){this.$validgroup.unregister(this);}});this.addEventListener("DOMNodeInsertedIntoDocument",function(b){if(!this.validgroup){this.$setInheritedAttribute("validgroup");}});this.$attrExcludePropBind=apf.extend({pattern:1,validtest:3},this.$attrExcludePropBind);this.$booleanProperties.required=true;this.$supportedProperties.push("validgroup","required","datatype","pattern","min","max","maxlength","minlength","validtest","notnull","checkequal","invalidmsg","requiredmsg");this.$fValidate=function(){if(this.contenteditable){return;}if(!this.$validgroup){this.validate(true);}else{var b=this.$validgroup.getErrorBox(this);if(!b.visible||b.host!=this){this.validate(true);}}};this.addEventListener("blur",this.$fValidate);this.$propHandlers.validgroup=function(c){if(c){var b;if(typeof c!="string"){this.$validgroup=c.name;b=c;}else{b=apf.nameserver.get("validgroup",c);}this.$validgroup=b||new apf.ValidationGroup(c);this.$validgroup.register(this);}else{this.$validgroup.unregister(this);this.$validgroup=null;}};this.$propHandlers.pattern=function(b,c){if(b.substr(0,1)!="/"){b="/"+b+"/";}(this.$vOptions||(this.$vOptions={}))[c]=b;delete this.$vOptions.isValid;};this.$propHandlers.required=this.$propHandlers.custom=this.$propHandlers.min=this.$propHandlers.max=this.$propHandlers.maxlength=this.$propHandlers.minlength=this.$propHandlers.notnull=this.$propHandlers.checkequal=function(b,c){(this.$vOptions||(this.$vOptions={}))[c]=b;delete this.$vOptions.isValid;};this.$propHandlers.validtest=function(d){var b=this,c={};this.removeValidationCache=function(){c={};};this.$checkRemoteValidation=function(){var g=this.getValue();if(typeof c[g]=="boolean"){return c[g];}if(c[g]==-1){return true;}c[g]=-1;apf.getData(this.validtest,{xmlNode:this.xmlRoot,value:this.getValue(),callback:function(n,m,j){if(m!=apf.SUCCESS){if(m==apf.TIMEOUT&&j.retries<apf.maxHttpRetries){return j.tpModule.retry(j.id);}else{var k=new Error(apf.formatErrorString(0,b,"Validating entry at remote source","Communication error: \n\n"+j.message));if(b.dispatchEvent("error",apf.extend({error:k,state:status},j))!==false){throw k;}return;}}c[g]=apf.isTrue(n);if(!c[g]){if(!b.hasFocus()){b.setError();}}else{b.clearError();}}});return true;};(this.$vOptions||(this.$vOptions={})).custom="apf.lookup("+this.$uniqueId+").$checkRemoteValidation()";delete this.$vOptions.isValid;};};apf.GuiElement.propHandlers.required=apf.GuiElement.propHandlers.pattern=apf.GuiElement.propHandlers.min=apf.GuiElement.propHandlers.max=apf.GuiElement.propHandlers.maxlength=apf.GuiElement.propHandlers.minlength=apf.GuiElement.propHandlers.notnull=apf.GuiElement.propHandlers.checkequal=apf.GuiElement.propHandlers.validtest=function(b,c){this.implement(apf.Validation);this.$propHandlers[c].call(this,b,c);};apf.ValidationGroup=function(b){this.$init();this.childNodes=[];if(b){apf.setReference(b,this);}this.name=b||"validgroup"+this.$uniqueId;apf.nameserver.register("validgroup",this.name,this);};(function(){this.validateVisibleOnly=false;this.allowMultipleErrors=false;this.register=function(o){if(o.hasFeature(apf.__VALIDATION__)){this.childNodes.push(o);}};this.unregister=function(o){this.childNodes.remove(o);};this.toString=function(){return"[APF Validation Group]";};var errbox;this.getErrorBox=function(o,no_create){if(this.allowMultipleErrors||!errbox&&!no_create){errbox=new apf.errorbox();errbox.$pHtmlNode=o.$ext.parentNode;errbox.skinset=apf.getInheritedAttribute(o.parentNode,"skinset");errbox.dispatchEvent("DOMNodeInsertedIntoDocument");}return errbox;};this.hideAllErrors=function(){if(errbox&&errbox.host){errbox.host.clearError();}};function checkValidChildren(oParent,ignoreReq,nosetError){var found;for(var v,i=0;i<oParent.childNodes.length;i++){var oEl=oParent.childNodes[i];if(!oEl){continue;}if(!oEl.disabled&&(!this.validateVisibleOnly&&oEl.visible||!oEl.$ext||oEl.$ext.offsetHeight)&&(oEl.hasFeature(apf.__VALIDATION__)&&oEl.isValid&&!oEl.isValid(!ignoreReq))){if(!nosetError){if(!found){oEl.validate(true,null,true);found=true;if(!this.allowMultipleErrors){return true;}}else{if(oEl.errBox&&oEl.errBox.host==oEl){oEl.errBox.hide();}}}else{if(!this.allowMultipleErrors){return true;}}}if(oEl.canHaveChildren&&oEl.childNodes.length){found=checkValidChildren.call(this,oEl,ignoreReq,nosetError)||found;if(found&&!this.allowMultipleErrors){return true;}}}return found;}this.validate=this.isValid=function(ignoreReq,nosetError,page){var found=checkValidChildren.call(this,page||this,ignoreReq,nosetError);if(page){try{if(page.validation&&!eval(page.validation)){alert(page.invalidmsg);found=true;}}catch(e){throw new Error(apf.formatErrorString(0,this,"Validating Page","Error in javascript validation string of page: '"+page.validation+"'",page.$aml));}}return !found;};}).call(apf.ValidationGroup.prototype=new apf.Class());apf.config.$inheritProperties.validgroup=1;apf.__DATABINDING__=1<<1;apf.DataBinding=function(){this.$init(true);this.$loadqueue=this.$dbTimer=null;this.$regbase=this.$regbase|apf.__DATABINDING__;this.$mainBind="value";this.$bindings=this.$cbindings=this.$attrBindings=false;this.$attrExcludePropBind=apf.extend({model:1,each:1},this.$attrExcludePropBind);this.setQueryValue=function(j,n,k){var m=apf.createNodeFromXpath(this[k||"xmlRoot"],j);if(!m){return null;}apf.setNodeValue(m,n,true);return m;};this.queryValue=function(j,k){return apf.queryValue(this[k||"xmlRoot"],j);};this.queryValues=function(j,k){return apf.queryValues(this[k||"xmlRoot"],j);};this.queryNode=function(j,k){var m=this[k||"xmlRoot"];return m?m.selectSingleNode(j):null;};this.queryNodes=function(j,k){var m=this[k||"xmlRoot"];return m?m.selectNodes(j):[];};this.$checkLoadQueue=function(){if(this.$loadqueue){this.xmlRoot=null;var j=this.load(this.$loadqueue[0],{cacheId:this.$loadqueue[1]});if(!j||j.dataType!=apf.ARRAY||j!=this.$loadqueue){this.$loadqueue=null;}}};this.$execProperty=function(o,m){var k=this.$attrBindings[o];if(k.cvalue.asyncs){var j=this;return k.cvalue.call(this,m,function(q){j.setProperty(o,q,true);});}else{var n=k.cvalue.call(this,m);}this.setProperty(o,n,true);};this.$applyBindRule=function(k,m,j,q,o){var n=this.$attrBindings[k]&&this.$attrBindings[k].cvalue||this.$cbindings[k];return n?n.call(this,m,q):j||"";};var d;this.addEventListener("afterload",d=function(){var j;if(!this.$cbindings.queue||!this.$cbindings.queue.caption||!(j=this.$cbindings.queue.caption)){return;}var q,o=this.ownerDocument;for(var n,m=0,k=j.length;m<k;m++){q=document.getElementById("placeholder_"+this.$uniqueId+"_"+m);n=o.createProcessingInstruction("lm",this.$cbindings.caption);n.$model=this.$model;n.xmlRoot=j[m];n.$noInitModel=true;n.$useXmlDiff=true;n.$focusParent=this;n.parentNode=this;n.dispatchEvent("DOMNodeInsertedIntoDocument",{pHtmlNode:q});delete j[m];j[n.xmlRoot.getAttribute(apf.xmldb.xmlIdTag)]=n;}});this.addEventListener("xmlupdate",function(m){if("insert|add|synchronize|move".indexOf(m.action)>-1){d.call(this,m);}else{if("remove|move-away".indexOf(m.action)>-1){var j;if(!this.$cbindings.queue||!this.$cbindings.queue.caption||!(j=this.$cbindings.queue.caption)){return;}var k=j[m.xmlNode.getAttribute(apf.xmldb.xmlIdTag)];k.parentNode=k.$focusParent=k.$model=k.xmlRoot=null;k.destroy();}}});this.$hasBindRule=function(j){return this.$attrBindings[j]||this.$bindings&&this.$bindings[j];};this.$getBindRule=function(j,k){return this.$attrBindings[j]||this.$bindings&&this.$bindings.getRule(j,k);};var c={drag:1,drop:1,dragcopy:1};this.$getDataNode=function(m,n,s,k,j){var q,r=this.$attrBindings[m];if(r){if(r.cvalue.type!=3){return false;}var o=r.cvalue2||r.compile("value",{xpathmode:j?4:3,parsecode:1,injectself:c[m]});if(o&&(q=o(n,s))){if(k){k.push(r);}return q;}return false;}return this.$bindings&&this.$bindings.getDataNode(m,n,s,k,j);};this.setModel=function(j){this.setAttribute("model",j,false,true);};this.getModel=function(j){if(j&&!this.$model){return this.dataParent?this.dataParent.parent.getModel(true):null;}return this.$model;};this.reload=this.reload||function(){this.load(this.xmlRoot,{cacheId:this.cacheId,force:true});};this.load=function(k,j){if(j){var o=j.cacheId,n=j.force,q=j.noClearMsg;}if(o&&o==this.cacheId&&!n){return;}if(apf.popup.isShowing(this.$uniqueId)){apf.popup.forceHide();}if(k){if(typeof k=="string"){if(k.charAt(0)=="<"){k=apf.getXmlDom(k).documentElement;}else{return apf.model.prototype.$loadFrom.call(this,k,j);}}else{if(k.nodeType==9){k=k.documentElement;}else{if(k.nodeType==3||k.nodeType==4){k=k.parentNode;}else{if(k.nodeType==2){k=k.ownerElement||k.parentNode||k.selectSingleNode("..");}}}}}if(this.$preventDataLoad||!this.$canLoadData&&((!this.$bindings&&!this.$canLoadDataAttr)||!this.$amlLoaded)&&(!this.hasFeature(apf.__MULTISELECT__)||!(this.each||this.$template))||this.$canLoadData&&!this.$canLoadData()){this.xmlRoot=k;if(this.$amlLoaded&&!this.$attrBindings){apf.console.warn("Could not load data yet in "+(this.localName?this.localName+"["+(this.name||"")+"]":this.nodeName)+". The loaded data is queued until smartbinding rules are loaded or set manually.");}return this.$loadqueue=[k,o];}if(this.dataParent&&this.dataParent.xpath){this.dataParent.parent.signalXmlUpdate[this.$uniqueId]=!k;}if(!k&&(!o||!this.$isCached||!this.$isCached(o))){apf.console.warn("No xml root node was given to load in "+this.localName+"["+(this.name||"")+"]. Clearing any loaded xml in this component");this.clear(q);if(apf.config.autoDisable&&this.$createModel===false){this.setProperty("disabled",true);}return;}var m=this.disabled;this.disabled=false;if(this.dispatchEvent("beforeload",{xmlNode:k})===false){return false;}apf.console.info("Loading XML data in "+(this.localName?this.localName+"["+(this.name||"")+"]":this.nodeName));if(this.caching&&!n&&k&&k==this.xmlRoot){return;}this.clear(true,true);this.cacheId=o;if(this.dispatchEvent("$load",{forceNoCache:n,xmlNode:k})===false){delete this.cacheId;return;}this.documentId=apf.xmldb.getXmlDocId(k);this.xmlRoot=k;this.setProperty("root",this.xmlRoot);this.$load(k);this.$loadSubData(k);if(this.$createModel===false){this.disabled=true;this.setProperty("disabled",false);}else{this.disabled=m;}this.dispatchEvent("afterload",{xmlNode:k});};this.$loadSubData=function(j){if(this.$hasLoadStatus(j)){return;}var o,n=this.$getBindRule("load",j);if(n&&(!n[1]||n[1](j))){this.$setLoadStatus(j,"loading");if(this.$setClearMessage){this.$setClearMessage(this["loading-message"],"loading");}var m=this.getModel(true);if(!m){throw new Error("Could not find model");}var k=this;if(m.$insertFrom(n.getAttribute("get"),{xmlNode:o,insertPoint:j,amlNode:this,callback:function(){k.setProperty(k.hasFeature(apf.__MULTISELECT__)?"selected":"root",j);}})===false){this.clear(true);if(apf.config.autoDisable){this.setProperty("disabled",true);}}}};this.clear=function(m,o,k){if(!this.$container){return;}if(this.clearSelection){this.clearSelection(true);}var n=this.$container.offsetHeight;if(this.dispatchEvent("$clear")!==false){this.$container.innerHTML="";}if(typeof m=="string"){var j=m;m=false;if(!this[j+"-message"]){this.$setInheritedAttribute(j+"-message");}}this.$lastClearType=j||null;if(!m&&this.$setClearMessage){this.$setClearMessage(j?this[j+"-message"]:this["empty-message"],j||"empty",n);}else{if(this.$removeClearMessage){this.$removeClearMessage();}}if(!k){this.documentId=this.xmlRoot=this.cacheId=null;}if(!m){if(this.hasFeature(apf.__MULTISELECT__)){this.setProperty("length",0);}}};this.clearMessage=function(j){this.customMsg=j;this.clear("custom");};this.$setLoadStatus=function(k,n,j){var m=k.getAttribute("a_loaded");m=m?m.replace(new RegExp("\\|\\w+\\:"+this.$uniqueId+"\\|","g"),""):"";if(!j){m+="|"+n+":"+this.$uniqueId+"|";}k.setAttribute("a_loaded",m);};this.$removeLoadStatus=function(j){this.$setLoadStatus(j,null,true);};this.$hasLoadStatus=function(j,m){var k=j.getAttribute("a_loaded");if(!k){return false;}return(k.indexOf((m||"")+":"+this.$uniqueId+"|")!=-1);};this.insert=function(m,j){if(typeof m=="string"){if(m.charAt(0)=="<"){m=apf.getXmlDom(m).documentElement;}else{if(!j.insertPoint){j.insertPoint=this.xmlRoot;}return apf.model.prototype.$insertFrom.call(this,m,j);}}var n=j.insertPoint||this.xmlRoot;if(this.dispatchEvent("beforeinsert",{xmlParentNode:n})===false){return false;}if(typeof j.copyAttributes=="undefined"){j.copyAttributes=true;}var k=apf.mergeXml(m,n,j);apf.xmldb.applyChanges("insert",n);if(this.selectable&&this.autoselect){if(this.xmlNode==k){this.$selectDefault(this.xmlNode);}}else{if(this.xmlNode==k){this.setProperty("root",this.xmlNode);}}if(this.$hasLoadStatus(n,"loading")){this.$setLoadStatus(n,"loaded");}this.dispatchEvent("afterinsert");};this.$booleanProperties["render-root"]=true;this.$supportedProperties.push("empty-message","loading-message","offline-message","render-root","smartbinding","bindings","actions");this.$propHandlers["render-root"]=function(j){this.renderRoot=j;};this.$propHandlers["empty-message"]=function(j){this["empty-message"]=j;if(this.$updateClearMessage){this.$updateClearMessage(this["empty-message"],"empty");}};this.$propHandlers["loading-message"]=function(j){this["loading-message"]=j;if(this.$updateClearMessage){this.$updateClearMessage(this["loading-message"],"loading");}};this.$propHandlers["offline-message"]=function(j){this["offline-message"]=j;if(this.$updateClearMessage){this.$updateClearMessage(this["offline-message"],"offline");}};this.$propHandlers.smartbinding=this.$propHandlers.actions=this.$propHandlers.bindings=function(k,m){var j="$"+m;if(this[j]){this[j].unregister(this);}if(!k){return;}if(!apf.nameserver.get(m,k)){throw new Error(apf.formatErrorString(1064,this,"Setting "+m,"Could not find "+m+" by name '"+k+"'"));}apf.nameserver.get(m,k).register(this);if(m!="actions"){this.$checkLoadQueue();}};var g={caption:1,icon:1,select:1,css:1,sort:1,drop:2,drag:2,dragcopy:2,eachvalue:1};this.$addAttrBind=function(j,n,t){if(n.models){if(this.hasFeature(apf.__MULTISELECT__)){if(g[j]){throw new Error("Cannot use external model inside "+j+" rule");}}}var o,r,w,q,A=n.xpaths,s={};for(o=0;o<A.length;o+=2){if(!s[(w=A[o])]){s[w]=1;}else{s[w]++;}}if(!this.$propsUsingMainModel){this.$propsUsingMainModel={};}var u=(this.$attrBindings||(this.$attrBindings={}))[j]={cvalue:n,value:t,compile:apf.BindingRule.prototype.$compile,models:[]};delete this.$propsUsingMainModel[j];for(r,o=0;o<A.length;o+=2){w=A[o];if(s[w]==-1){continue;}r=A[o+1];if(w=="#"||r=="#"){var k=(u.cvalue3||(u.cvalue3=apf.lm.compile(u.value,{xpathmode:5})))(this.xmlRoot);if(typeof k!="string"){q=k.model&&k.model.$isModel&&k.model;if(q){r=k.xpath;}else{if(k.model){q=apf.xmldb.findModel(k.model);r=apf.xmlToXpath(k.model,q.data)+(k.xpath?"/"+k.xpath:"");}else{this.addEventListener("prop."+j,function(D){var C=(u.cvalue3||(u.cvalue3=apf.lm.compile(u.value,{xpathmode:5})))(this.xmlRoot);if(C.model){this.removeEventListener("prop."+j,arguments.callee);var B=this;setTimeout(function(){B.$clearDynamicProperty(j);B.$setDynamicProperty(j,t);},10);}});continue;}}}else{q=null;}}else{q=null;}if(!q){if(w){q=apf.nameserver.get("model",w)||apf.setReference(w,apf.nameserver.register("model",w,new apf.model()));}else{if(!this.$model&&!this.$initingModel){b.call(this);}q=this.$model;if(!this.hasFeature(apf.__MULTISELECT__)&&g[j]!=2||!g[j]){this.$propsUsingMainModel[j]={xpath:r,optimize:s[w]==1};}}}if(q&&(!this.hasFeature(apf.__MULTISELECT__)&&g[j]!=2||!g[j])){q.$bindXmlProperty(this,j,r,s[w]==1,t.indexOf("*[")>-1);u.models.push(q);}s[w]=-1;}u.xpath=r;this.$canLoadDataAttr=g[j]==1;this.$checkLoadQueue();};this.$removeAttrBind=function(n){var k=this.$attrBindings[n];if(!k){return;}delete this.$attrBindings[n];delete this.$propsUsingMainModel[n];var m=k.models;for(var j=0;j<m.length;j++){m[j].$unbindXmlProperty(this,n);}};this.$initingModel;function b(){this.$initingModel=true;this.$setInheritedAttribute("model");}this.addEventListener("DOMNodeInsertedIntoDocument",function(j){if(!this.model&&this.$setClearMessage&&!this.value){this.$setClearMessage(this["empty-message"],"empty");}this.$amlLoaded=true;this.$checkLoadQueue();});this.$propHandlers.model=function(r){if(!r&&!this.$modelParsed){if(this.$model){this.clear();this.$model.unregister(this);this.$model=null;this.lastModelId="";}else{if(this.dataParent){this.dataParent.parent=null;}}return;}this.$initingModel=true;var n;if((n=this.$modelParsed)&&n.type!=2){var q,o=n.props;if(this.dataParent){this.dataParent=null;}for(var s in o){this.dataParent={parent:self[s.split(".")[0]],xpath:null,model:this.$modelParsed.instruction};q=true;break;}if(q){if(this.dataParent&&!this.dataParent.signalXmlUpdate){this.dataParent.signalXmlUpdate={};}}this.$modelParsed=null;}var m;if(typeof r=="object"){if(r.dataType==apf.ARRAY){m=apf.nameserver.get("model",r[0]);m.register(this,r[1]);return;}else{if(r.$isModel){m=r;r=this.model=m.name;if(!r){m.setProperty("id",r=this.model="model"+m.$uniqueId);}}else{if(this.dataParent){this.model=this.dataParent.model;m=apf.xmldb.findModel(r);var k=apf.xmlToXpath(r,m.data,true)||".";if(m.queryNode(k)!=r){throw new Error("xml data node is not attached to model");}m.register(this,k);return;}else{}}}}clearTimeout(this.$dbTimer);if(!this.$amlLoaded&&this.nodeType==1){var j=this;this.$dbTimer=$setTimeout(function(){if(!j.$amlDestroyed){apf.setModel(r,j);}});}else{apf.setModel(r,this);}};};apf.DataBinding.prototype=new apf.Presentation();apf.config.$inheritProperties.model=1;apf.config.$inheritProperties["empty-message"]=1;apf.config.$inheritProperties["loading-message"]=1;apf.config.$inheritProperties["offline-message"]=1;apf.config.$inheritProperties.noloading=1;apf.Init.run("databinding");apf.MultiselectBinding=function(){if(!this.setQueryValue){this.implement(apf.DataBinding);}this.$init(function(){this.$selectTimer={};});};(function(){this.length=0;this.$attrExcludePropBind=apf.extend({caption:2,icon:2,eachvalue:2,select:2,css:2,sort:2,drag:2,drop:2,dragcopy:2,selected:3,each:1,selection:3,"selection-unique":3,"selection-constructor":3},this.$attrExcludePropBind);this.resort=function(j,d,g){if(!this.$sort){this.$sort=new apf.Sort();}this.$sort.set(j,d);if(this.clearAllCache){this.clearAllCache();}if(g){return;}var c=this;(function k(o,s){var q=c.$sort.apply(apf.getArrayFromNodelist(o.selectNodes(c.each)));for(var n=0;n<q.length;n++){if(c.$isTreeArch||c.$withContainer){var r=apf.xmldb.findHtmlNode(q[n],c);if(!c.$findContainer){throw new Error(apf.formatErrorString(c,"Sorting Nodes","This component does not                              implement _self.$findContainer"));}var m=c.$findContainer(r);s.appendChild(r);if(!apf.isChildOf(r,m,true)){s.appendChild(m);}k(q[n],m);}else{s.appendChild(apf.xmldb.findHtmlNode(q[n],c));}}})(this.xmlRoot,this.$container);return j;};this.toggleSortOrder=function(){return this.resort({ascending:!this.$sort.get().ascending}).ascending;};this.getSortSettings=function(){return this.$sort.get();};this.getTraverseNodes=function(d){if(!this.each){throw new Error("Could not render bound data. Missing 'each' rule for "+this.localName+(this.id&&"["+this.id+"]"||""));}if(this.$sort){var c=apf.getArrayFromNodelist((d||this.xmlRoot).selectNodes(this.each));return this.$sort.apply(c);}return(d||this.xmlRoot).selectNodes(this.each);};this.getFirstTraverseNode=function(d){if(this.$sort){var c=(d||this.xmlRoot).selectNodes(this.each);return this.$sort.apply(c)[0];}return(d||this.xmlRoot).selectSingleNode(this.each);};this.getLastTraverseNode=function(d){var c=this.getTraverseNodes(d||this.xmlRoot);return c[c.length-1];};this.isTraverseNode=function(g){var c=this.getTraverseNodes(this.getTraverseParent(g)||this.xmlRoot);for(var d=0;d<c.length;d++){if(c[d]==g){return true;}}return false;};this.getNextTraverseSelected=function(j,c,m){if(!j){j=this.selected;}if(!m){m=1;}var g=0;var d=this.getTraverseNodes(this.getTraverseParent(j)||this.xmlRoot);while(d[g]&&d[g]!=j){g++;}var k=(c==null)?d[g+m]||d[g-m]:(c?d[g+m]:d[g-m]);return k||m&&(g<m||(g+1)>Math.floor(d.length/m)*m)?k:(c?d[d.length-1]:d[0]);};this.getNextTraverse=function(j,c,k){if(!k){k=1;}if(!j){j=this.selected;}var g=0;var d=this.getTraverseNodes(this.getTraverseParent(j)||this.xmlRoot);while(d[g]&&d[g]!=j){g++;}return d[g+(c?-1*k:k)];};this.getTraverseParent=function(d){if(!d.parentNode||d==this.xmlRoot){return false;}if(d.$regbase){return d.parentNode;}var c,g=d.getAttribute(apf.xmldb.xmlIdTag);if(!g){d.setAttribute(apf.xmldb.xmlIdTag,"temp");g="temp";}c=d.selectSingleNode("ancestor::node()[(("+this.each+")/@"+apf.xmldb.xmlIdTag+")='"+g+"']");if(g=="temp"){d.removeAttribute(apf.xmldb.xmlIdTag);}return c;};if(!this.$findHtmlNode){this.$findHtmlNode=function(c){return this.$pHtmlDoc.getElementById(c);};}this.$setClearMessage=function(m,g,k){if(!this.$empty){if(!this.$hasLayoutNode("empty")){return;}this.$getNewContext("empty");var d=this.$getLayoutNode("empty");if(!d){return;}this.$empty=apf.insertHtmlNode(d,this.$container);}else{this.$container.appendChild(this.$empty);}var j=this.$getLayoutNode("empty","caption",this.$empty);if(j){apf.setNodeValue(j,m||"");}this.$empty.setAttribute("id","empty"+this.$uniqueId);apf.setStyleClass(this.$empty,g,["loading","empty","offline"]);var c=apf.getStyle(this.$ext,"height");this.$empty.style.height=(k&&(!c||c=="auto")&&g!="empty")?(Math.max(10,(k-apf.getHeightDiff(this.$empty)-apf.getHeightDiff(this.$ext)))+"px"):"";};this.$updateClearMessage=function(g,c){if(!this.$empty||this.$empty.parentNode!=this.$container||this.$empty.className.indexOf(c)==-1){return;}var d=this.$getLayoutNode("empty","caption",this.$empty);if(d){apf.setNodeValue(d,g||"");}};this.$removeClearMessage=function(){if(!this.$empty){this.$empty=document.getElementById("empty"+this.$uniqueId);}if(this.$empty&&this.$empty.parentNode){this.$empty.parentNode.removeChild(this.$empty);}};this.$load=function(c){apf.xmldb.addNodeListener(c,this);var j=this.getTraverseNodes(c).length;if(!this.renderRoot&&!j){return this.clear(null,null,true);}var d=this.$addNodes(c,null,null,this.renderRoot);this.$fill(d);if(this.selectable){if(this.autoselect){if(!this.selected){if(this.renderRoot){this.select(c,null,null,null,true);}else{if(d.length){this.$selectDefault(c);}}}}else{this.clearSelection(true);var g=this.renderRoot?this.xmlRoot:this.getFirstTraverseNode();if(g){this.setCaret(g);}if(this.selected){this.setProperty("selected",null);}if(this.choosen){this.setProperty("choosen",null);}}}if(this.focussable){apf.document.activeElement==this?this.$focus():this.$blur();}if(j!=this.length){this.setProperty("length",j);}};var b={insert:127,add:123,remove:46,"redo-remove":79,synchronize:127,"move-away":105,move:77};this.$xmlUpdate=function(E,j,r,A,D){if(!this.xmlRoot){return;}var u,m,c,s,H=j;if(!r){r=this.xmlRoot;}if(E=="redo-remove"){D.appendChild(j);var G=this.isTraverseNode(j);D.removeChild(j);if(!G){j=D;}}do{if(E=="add"&&this.isTraverseNode(j)&&H==j){break;}if(j.getAttribute(apf.xmldb.xmlIdTag)){s=this.$findHtmlNode(j.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId);if(s&&(H!=j||j==this.xmlRoot)&&b[E]&1){E="update";}if(j==r&&!this.renderRoot){if(j==this.xmlRoot&&E!="insert"){this.dispatchEvent("xmlupdate",{action:E,xmlNode:j,UndoObj:A});return;}break;}if(s&&b[E]&2&&!this.isTraverseNode(j)){E="remove";}if(!s&&b[E]&4&&this.isTraverseNode(j)){E="add";break;}if(s||E=="move"){break;}}else{if(b[E]&8&&this.isTraverseNode(j)){E="add";break;}}if(j==r){break;}j=j.parentNode;}while(j&&j.nodeType!=9);var g=j;if(j&&j.nodeType==9){j=H;}if(E=="replacechild"&&(A?A.args[0]==this.xmlRoot:!this.xmlRoot.parentNode)){return this.load(A?A.args[1]:r);}if(A&&j&&!A.xmlNode){A.xmlNode=j;}if(E=="move"&&g==H){var w=apf.isChildOf(this.xmlRoot,j.parentNode,true);var q=apf.isChildOf(this.xmlRoot,A.extra.parent,true);if(w&&q){this.$moveNode(j,s,A.extra.oldParent);}else{if(w){E="add";}else{if(q){E="remove";}}}}else{if(E=="move-away"){var B=apf.isChildOf(this.xmlRoot,A.extra.parent,true);if(!B){E="remove";}}}if(this.$removeClearMessage&&this.$setClearMessage){if(this.getFirstTraverseNode()){this.$removeClearMessage();}else{this.$setClearMessage(this["empty-message"],"empty");}}if(E=="insert"&&(this.$isTreeArch||j==this.xmlRoot)){if(!j){return;}if(this.$hasLoadStatus(j)&&this.$removeLoading){this.$removeLoading(s);}if(this.$container.firstChild&&!apf.xmldb.getNode(this.$container.firstChild)){this.$container.innerHTML="";if(!this.renderRoot){m=this.getTraverseNodes().length;if(!m){this.clear();}}}u=this.$addNodes(j,(this.$getParentNode?this.$getParentNode(s):s),true,false);this.$fill(u);if(this.selectable&&!this.xmlRoot.selectSingleNode(this.each)){apf.console.warn("No traversable nodes were found for "+this.name+" ["+this.localName+"]\n                                  Traverse Rule : "+this.$getBindRule("each")[4].getAttribute("match"));}if(this.selectable&&(m===0||!this.xmlRoot.selectSingleNode(this.each))){return;}}else{if(E=="add"){var F;c=this.getTraverseParent(j);if(c==this.xmlRoot){F=this.$container;}if(!F&&this.$isTreeArch){F=this.$findHtmlNode(c.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId);}if(F||this.$isTreeArch&&apf.isChildOf(this.xmlRoot,j)){F=(this.$findContainer&&F?this.$findContainer(F):F)||this.$container;u=this.$addNodes(j,F,true,true,apf.xmldb.getHtmlNode(this.getNextTraverse(j),this));if(F){this.$fill(u);}}}else{if(E=="remove"){if(!j||H!=j){return;}if(s){this.$deInitNode(j,s);}else{if(j==this.xmlRoot){return this.load({noClearMsg:!this.dataParent||!this.dataParent.autoselect});}}}else{if(s){this.$updateNode(j,s);if(E=="replacechild"&&this.hasFeature(apf.__MULTISELECT__)&&this.selected&&j.getAttribute(apf.xmldb.xmlIdTag)==this.selected.getAttribute(apf.xmldb.xmlIdTag)){this.selected=j;}}else{if(E=="redo-remove"){var d=this.xmlRoot;while(d&&d.nodeType!=9){d=d.parentNode;}if(!d){var k=this.getModel(true);if(!k){throw new Error(apf.formatErrorString(0,this,"Setting change notifier on component","Component without a model is listening for changes",this.$aml));}return k.$waitForXml(this);}}}}}}c=j?j.parentNode:D;if(this.$isTreeArch&&!this.$preventRecursiveUpdate&&c&&c.nodeType==1){do{s=this.$findHtmlNode(c.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId);if(s){this.$updateNode(c,s);}}while((c=this.getTraverseParent(c))&&c.nodeType==1);}if(b[E]&32&&this.selectable&&H==j&&(E!="insert"||j==this.xmlRoot)){clearTimeout(this.$selectTimer.timer);if(E=="remove"&&apf.isChildOf(j,this.selected,true)||j==this.$selectTimer.nextNode){this.$selectTimer.nextNode=this.getDefaultNext(j,this.$isTreeArch);}var n=this;this.$selectTimer.timer=$setTimeout(function(){n.$checkSelection(n.$selectTimer.nextNode);n.$selectTimer.nextNode=null;});}if(b[E]&64){if(!m){m=this.xmlRoot.selectNodes(this.each).length;}if(m!=this.length){this.setProperty("length",m);}}if(this.signalXmlUpdate&&b[E]&16){var t;for(t in this.signalXmlUpdate){if(parseInt(t)!=t){continue;}var C=apf.lookup(t);if(!this.selected){continue;}j=this.selected.selectSingleNode(C.dataParent.xpath);if(!j){continue;}C.load(j);}}this.dispatchEvent("xmlupdate",{action:E,xmlNode:j,result:u,UndoObj:A});};this.$addNodes=function(u,t,j,g,o,m){if(!this.each){throw new Error(apf.formatErrorString(1060,this,"adding Nodes for load","No each SmartBinding rule was specified. This rule is                  required for a "+this.localName+" component.",this.$aml));}var s,d;g=(g&&(this.renderRoot&&u==this.xmlRoot||this.isTraverseNode(u)));var c=g?[u]:this.getTraverseNodes(u);for(var k=0;k<c.length;k++){if(c[k].nodeType!=1){continue;}if(j){s=this.$findHtmlNode(c[k].getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId);}if(!s){var q=apf.xmldb.nodeConnect(this.documentId,c[k],null,this);var r=g?o:(d?d.nextSibling:null),n=this.$add(c[k],q,g?u.parentNode:u,r?t||this.$container:t,r,(!r&&k==c.length-1),m);if(n===false){break;}}if(j){d=s;}}return c;};this.$handleBindingRule=function(d,g){if(!d){this[g]=null;}if(g=="each"){if(d.indexOf("::")>-1){d=d.replace(/^\[|\]$/g,"").split("::");this.setProperty("model",d[0]);this.each=d[1];}else{this.each=d.replace(/^\[|\]$/g,"");}}if(this.xmlRoot&&!this.$bindRuleTimer&&this.$amlLoaded){var c=this;apf.queue.add("reload"+this.$uniqueId,function(){apf.console.log("Reloading multiselect based on                                  attribute bind change: "+c.serialize(true));c.reload();});}};this.$select=function(c){if(this.renaming){this.stopRename(null,true);}if(!c||!c.style){return;}return this.$setStyleClass(c,"selected");};this.$deselect=function(c){if(this.renaming){this.stopRename(null,true);if(this.ctrlselect){return false;}}if(!c){return;}return this.$setStyleClass(c,"",["selected","indicate"]);};this.$indicate=function(c){if(this.renaming){this.stopRename(null,true);}if(!c){return;}return this.$setStyleClass(c,"indicate");};this.$deindicate=function(c){if(this.renaming){this.stopRename(null,true);}if(!c){return;}return this.$setStyleClass(c,"",["indicate"]);};this.$propHandlers.each=this.$propHandlers.caption=this.$propHandlers.eachvalue=this.$propHandlers.icon=this.$propHandlers.tooltip=this.$handleBindingRule;this.$propHandlers.sort=function(c){if(c){this.$sort=new apf.Sort();this.$sort.set({getValue:apf.lm.compile(c)});}else{this.$sort=null;}};}).call(apf.MultiselectBinding.prototype=new apf.DataBinding());apf.StandardBinding=function(){this.$init(true);if(apf.Validation){this.implement(apf.Validation);}if(!this.setQueryValue){this.implement(apf.DataBinding);}if(!this.defaultValue){this.defaultValue="";}this.$load=function(d){apf.xmldb.addNodeListener(d,this);var c,k,m,j,n,g;if(c=this.$bindings){for(m in c){k=m.toLowerCase();if(this.$supportedProperties.indexOf(k)>-1){n=(j=c[k]).length==1?j[0]:this.$getBindRule(k,d);g=n.value||n.match;this.$clearDynamicProperty(k);if(g.indexOf("{")>-1||g.indexOf("[")>-1){this.$setDynamicProperty(k,g);}else{if(this.setProperty){this.setProperty(k,g,true);}}}}}if(this.errBox&&this.isValid&&this.isValid()){this.clearError();}};this.$xmlUpdate=function(j,u,c,o){if(j=="redo-remove"){var d=false,k=this.getModel(true);if(k){var n=k.getXpathByAmlNode(this);if(n){u=k.data.selectSingleNode(n);if(u!=this.xmlRoot){d=true;}}}if(d||this.xmlRoot==u){if(!k){throw new Error(apf.formatErrorString(0,this,"Setting change notifier on component","Component without a model is listening for changes",this.$aml));}return k.$waitForXml(this);}}if(o&&!o.xmlNode){o.xmlNode=this.xmlRoot;}var r,g,q,s,m,t;if(r=this.$bindings){for(q in r){g=q.toLowerCase();if(this.$supportedProperties.indexOf(g)>-1){m=(s=r[g]).length==1?s[0]:this.$getBindRule(g,u);t=m.value||m.match;this.$clearDynamicProperty(g);if(t.indexOf("{")>-1||t.indexOf("[")>-1){this.$setDynamicProperty(g,t);}else{if(this.setProperty){this.setProperty(g,t);}}}}}if(this.errBox&&this.isValid&&this.isValid()){this.clearError();}this.dispatchEvent("xmlupdate",{action:j,xmlNode:u,UndoObj:o});};this.addEventListener("$clear",function(c,b){if(this.$propHandlers&&this.$propHandlers.value){this.value=-99999;this.$propHandlers.value.call(this,"");}});};apf.StandardBinding.prototype=new apf.DataBinding();apf.Init.run("standardbinding");apf.__MULTISELECT__=1<<8;apf.MultiSelect=function(){this.$init(function(){this.$valueList=[];this.$selectedList=[];});};(function(){this.$regbase=this.$regbase|apf.__MULTISELECT__;this.sellength=0;this.selected=null;this.$selected=null;this.caret=null;this.$caret=null;this.useindicator=true;this.remove=function(c){if(!c){c=this.$valueList;}if(c.nodeType){c=[c];}if(!c||!c.length){return;}if(c.contains(this.xmlRoot)){throw new Error(apf.formatErrorString(0,"Removing nodes","You are trying to delete the xml root of this                  element. This is not allowed."));}var g=[];for(var d=0;d<c.length;d++){g.push({action:"removeNode",args:[c[d]]});}if(this.$actions.removegroup){return this.$executeAction("multicall",g,"removegroup",c[0]);}else{return this.$executeAction("multicall",g,"remove",c[0],null,null,c.length>1?c:null);}};this.add=function(o,q,n,c){var m;if(this.$actions){if(o&&o.nodeType){m=this.$actions.getRule("add",o);}else{if(typeof o=="string"){if(o.trim().charAt(0)=="<"){o=apf.getXml(o);m=this.$actions.getRule("add",o);}else{var s=this.$actions.add;for(var j=0,g=s.length;j<g;j++){if(s[j].getAttribute("type")==o){o=null;m=s[j];break;}}}}}if(!m){m=(this.$actions.add||{})[0];}}else{m=null;}var k=this.$isTreeArch?this.selected||this.xmlRoot:this.xmlRoot,d=this,r=function(w,A,t){if(A!=apf.SUCCESS){var B;B=new Error(apf.formatErrorString(1032,d,"Loading xml data","Could not add data for control "+d.name+"["+d.tagName+"] \nUrl: "+t.url+"\nInfo: "+t.message+"\n\n"+o));if(t.tpModule.retryTimeout(t,A,d,B)===true){return true;}throw B;}if(typeof w!="object"){w=apf.getXmlDom(w).documentElement;}if(w.getAttribute(apf.xmldb.xmlIdTag)){w.setAttribute(apf.xmldb.xmlIdTag,"");}var u=d.$actions&&d.$actions.getRule("add",d.$isTreeArch?d.selected:d.xmlRoot);if(!q){if(u&&u.parent){q=(u.cparent||u.compile("parent",{xpathmode:2,injectself:true}))(d.$isTreeArch?d.selected||d.xmlRoot:d.xmlRoot);}else{q=d.$isTreeArch?d.selected||d.xmlRoot:d.xmlRoot;}}if(!q){q=d.xmlRoot;}if(apf.isWebkit&&q.ownerDocument!=w.ownerDocument){w=q.ownerDocument.importNode(w,true);}if(!q){throw new Error(apf.formatErrorString(0,d,"Executing add action","Missing parent node. You can only add nodes to a list if it                     has data loaded. Unable to perform action."));}if(d.$executeAction("appendChild",[q,w,n],"add",w)!==false&&d.autoselect){d.select(w);}if(c){c.call(d,w);}return w;};if(o){return r(o,apf.SUCCESS);}else{if(m.get){return apf.getData(m.get,{xmlNode:k,callback:r});}else{throw new Error(apf.formatErrorString(0,this,"Executing add action","Missing add action defined in action rules. Unable to                      perform action."));}}return addXmlNode;};if(!this.setValue){this.setValue=function(d,c){noEvent=c;this.setProperty("value",d,false,true);noEvent=false;};}this.findXmlNodeByValue=function(j){var d=this.getTraverseNodes(),c=this.$attrBindings.eachvalue&&"eachvalue"||this.$bindings.value&&"value"||this.$hasBindRule("caption")&&"caption";if(!c){return false;}for(var g=0;g<d.length;g++){if(this.$applyBindRule(c,d[g])==j){return d[g];}}};if(!this.getValue){this.getValue=function(d,c){return this.value;};}this.reselect=function(){if(this.selected){this.select(this.selected,null,this.ctrlselect,null,true);}};this.select=function(u,d,s,k,g,n,w){if(!this.selectable||w&&this.disabled||this.editable){return;}if(k==-1){k=false;w=true;}if(this.$skipSelect){this.$skipSelect=false;return;}if(this.ctrlselect&&!s){d=true;}if(!this.multiselect){d=s=false;}if(!this.xmlRoot){if(!this.$buffered){var o;this.addEventListener("afterload",o=function(){this.select.apply(this,this.$buffered);this.removeEventListener("afterload",o);delete this.$buffered;});}this.$buffered=Array.prototype.slice.call(arguments);return;}var t;if(!u){throw new Error(apf.formatErrorString(1075,this,"Making a selection","No selection was specified"));return false;}if(typeof u!="object"){var r=u;u=null;if(typeof u=="string"){u=apf.xmldb.getNodeById(r);}if(!u){u=this.findXmlNodeByValue(r);if(!u){this.clearSelection(n);return;}}}if(!u.style){t=this.$findHtmlNode(u.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId);}else{var c=(t=u).getAttribute(apf.xmldb.htmlIdTag);while(!c&&t.parentNode){c=(t=t.parentNode).getAttribute(apf.xmldb.htmlIdTag);}u=apf.xmldb.getNodeById(c);}if(!s&&!d&&!g&&!this.reselectable&&this.$valueList.length<=1&&this.$valueList.indexOf(u)>-1){return;}if(this.dispatchEvent("beforeselect",{selected:u,htmlNode:t,ctrlKey:d,shiftKey:s,force:g,captureOnly:n})===false){return false;}var j=this.caret;this.caret=u;if(s){var m=this.$calcSelectRange(this.$valueList[0]||j,u);if(this.$caret){this.$deindicate(this.$caret);}this.selectList(m);this.$selected=this.$caret=this.$indicate(t);}else{if(d){if(this.$valueList.contains(u)){if(this.selected==u){this.$deselect(this.$findHtmlNode(this.selected.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId));this.$deindicate(this.$caret);if(this.$valueList.length&&!k){this.selected=this.$valueList[0];}}else{this.$deselect(t,u);}if(!k){this.$selectedList.remove(t);this.$valueList.remove(u);}if(t!=this.$caret){this.$deindicate(this.$caret);}this.$selected=this.$caret=this.$indicate(t);}else{if(this.$caret){this.$deindicate(this.$caret);}this.$caret=this.$indicate(t,u);this.$selected=this.$select(t,u);this.selected=u;if(!k){this.$selectedList.push(t);this.$valueList.push(u);}}}else{if(k&&t&&this.$selectedList.contains(t)){return;}else{if(this.$selected){this.$deselect(this.$selected);}if(this.$caret){this.$deindicate(this.$caret);}if(this.selected){this.clearSelection(true);}this.$caret=this.$indicate(t,u);this.$selected=this.$select(t,u);this.selected=u;this.$selectedList.push(t);this.$valueList.push(u);}}}if(this.delayedselect&&(typeof d=="boolean")){var q=this;$setTimeout(function(){q.dispatchEvent("afterselect",{selection:q.$valueList,selected:u,caret:q.caret,captureOnly:n});},10);}else{this.dispatchEvent("afterselect",{selection:this.$valueList,selected:u,caret:this.caret,captureOnly:n});}return true;};this.choose=function(c,d){if(!this.selectable||d&&this.disabled){return;}if(this.dispatchEvent("beforechoose",{xmlNode:c})===false){return false;}if(c&&!c.style){this.select(c);}if(this.hasFeature(apf.__DATABINDING__)&&this.dispatchEvent("afterchoose",{xmlNode:this.selected})!==false){this.setProperty("chosen",this.selected);}};this.clearSelection=function(d,j){if(!this.selectable||j&&this.disabled||!this.$valueList.length){return;}if(!d){if(this.dispatchEvent("beforeselect",{selection:[],selected:null,caret:this.caret})===false){return false;}}var g;for(var c=this.$valueList.length-1;c>=0;c--){g=this.$findHtmlNode(this.$valueList[c].getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId);this.$deselect(g);}this.$selectedList.length=0;this.$valueList.length=0;this.$selected=this.selected=null;if(this.caret){g=this.$findHtmlNode(this.caret.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId);this.$caret=this.$indicate(g);}if(!d){this.dispatchEvent("afterselect",{selection:this.$valueList,selected:null,caret:this.caret});}};this.selectList=function(c,j,k,o){if(!this.selectable||o&&this.disabled){return;}if(this.dispatchEvent("beforeselect",{selection:c,selected:k||c[0],caret:this.caret,captureOnly:j})===false){return false;}this.clearSelection(true);for(var n,g=0;g<c.length;g++){if(!c[g]||c[g].nodeType!=1){continue;}var m,d=c[g];if(typeof d!="object"){d=apf.xmldb.getNodeById(d);}if(!d.style){m=this.$pHtmlDoc.getElementById(d.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId);}else{m=d;d=apf.xmldb.getNodeById(m.getAttribute(apf.xmldb.htmlIdTag));}if(!d){apf.console.warn("Component : "+this.name+" ["+this.localName+"]\nMessage : xmlNode whilst selecting a list of xmlNodes could not be found. Ignoring.");continue;}if(m){if(!n&&k==m){n=m;}this.$select(m,d);this.$selectedList.push(m);}this.$valueList.push(d);}this.$selected=n||this.$selectedList[0];this.selected=k||this.$valueList[0];this.dispatchEvent("afterselect",{selection:this.$valueList,selected:this.selected,caret:this.caret,captureOnly:j});};this.setCaret=function(c){if(!c){if(this.$caret){this.$deindicate(this.$caret);}this.caret=this.$caret=null;return;}var d;if(typeof c!="object"){c=apf.xmldb.getNodeById(c);}if(!c.style){d=this.$findHtmlNode(c.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId);}else{var g=(d=c).getAttribute(apf.xmldb.htmlIdTag);while(!g&&d.parentNode){g=(d=d.parentNode).getAttribute(apf.xmldb.htmlIdTag);}c=apf.xmldb.getNodeById(g);}if(this.$caret){this.$deindicate(this.$caret);}this.$caret=this.$indicate(d);this.setProperty("caret",this.caret=c);};this.$setTempSelected=function(g,j,d,m){clearTimeout(this.timer);if(this.$bindings.selectable){while(g&&!this.$getDataNode("selectable",g)){g=this.getNextTraverseSelected(g,!m);}if(!g){return;}}if(!this.multiselect){j=d=false;}if(j||this.ctrlselect){if(this.$tempsel){this.select(this.$tempsel);this.$tempsel=null;}this.setCaret(g);}else{if(d){if(this.$tempsel){this.$selectTemp();this.$deselect(this.$tempsel);this.$tempsel=null;}this.select(g,null,d);}else{if(!this.bufferselect||this.$valueList.length>1){this.select(g);}else{var k=apf.xmldb.getID(g,this);this.$deselect(this.$tempsel||this.$selected);this.$deindicate(this.$tempsel||this.$caret);this.$tempsel=this.$indicate(document.getElementById(k));this.$select(this.$tempsel);var c=this;this.timer=$setTimeout(function(){c.$selectTemp();},400);}}}};this.$selectTemp=function(){if(!this.$tempsel){return;}clearTimeout(this.timer);this.select(this.$tempsel);this.$tempsel=null;this.timer=null;};this.selectAll=function(d){if(!this.multiselect||!this.selectable||d&&this.disabled||!this.xmlRoot){return;}var c=this.$isTreeArch?this.xmlRoot.selectNodes(".//"+this.each.split("|").join("|.//")):this.xmlRoot.selectNodes(this.each);this.selectList(c);};this.getSelection=function(c){var d,g;if(c){g=this.xmlRoot?this.xmlRoot.ownerDocument.createDocumentFragment():apf.getXmlDom().createDocumentFragment();for(d=0;d<this.$valueList.length;d++){apf.xmldb.cleanNode(g.appendChild(this.$valueList[d].cloneNode(true)));}}else{for(g=[],d=0;d<this.$valueList.length;d++){g.push(this.$valueList[d]);}}return g;};this.$getSelection=function(c){return c?this.$selectedList:this.$valueList;};this.defaultSelectNext=function(d,c){var g=this.getNextTraverseSelected(d);if(g||!c){this.select(g?g:this.getTraverseParent(d));}else{this.clearSelection(true);}};this.selectNext=function(){var c=this.getNextTraverse();if(c){this.select(c);}};this.selectPrevious=function(){var c=this.getNextTraverse(null,-1);if(c){this.select(c);}};this.getDefaultNext=function(d,c){var g=this.getNextTraverseSelected(d);return(g&&g!=d)?g:(c?this.getTraverseParent(d):null);};this.isSelected=function(d){if(!d){return false;}for(var c=0;c<this.$valueList.length;c++){if(this.$valueList[c]==d){return this.$valueList.length;}}return false;};this.$checkSelection=function(d){if(this.$valueList.length>1){for(var c=[],j=0,g=this.$valueList.length;j<g;j++){if(apf.isChildOf(this.xmlRoot,this.$valueList[j])){c.push(this.$valueList[j]);}}if(c.length>1){this.selectList(c);if(this.caret&&!apf.isChildOf(this.xmlRoot,this.caret)){this.setCaret(d||this.selected);}return;}else{if(c.length){d=c[0];}}}if(!d){if(this.selected&&!apf.isChildOf(this.xmlRoot,this.selected)){d=this.getFirstTraverseNode();}else{if(this.selected&&this.caret&&!apf.isChildOf(this.xmlRoot,this.caret)){this.setCaret(this.selected);}else{if(!this.selected){d=this.xmlRoot?this.getFirstTraverseNode():null;}else{return;}}}}if(d){if(this.autoselect){this.select(d);}else{if(!this.multiselect){this.clearSelection();}this.setCaret(d);}}else{this.clearSelection();}};this.selectable=true;if(typeof this.ctrlselect=="undefined"){this.ctrlselect=false;}if(typeof this.multiselect=="undefined"){this.multiselect=true;}if(typeof this.autoselect=="undefined"){this.autoselect=true;}if(typeof this.delayedselect=="undefined"){this.delayedselect=true;}if(typeof this.allowdeselect=="undefined"){this.allowdeselect=true;}this.reselectable=false;this.$booleanProperties.selectable=true;this.$booleanProperties.multiselect=true;this.$booleanProperties.autoselect=true;this.$booleanProperties.delayedselect=true;this.$booleanProperties.allowdeselect=true;this.$booleanProperties.reselectable=true;this.$supportedProperties.push("selectable","ctrlselect","multiselect","autoselect","delayedselect","allowdeselect","reselectable","selection","selected","default","value","caret");this.$propHandlers.value=function(d){if(this.$lastValue==d){delete this.$lastValue;return;}if(!this.$attrBindings.eachvalue&&!this.$amlLoaded&&this.getAttribute("eachvalue")){var c=this;return apf.queue.add("value"+this.$uniqueId,function(){c.$propHandlers.value.call(c,d);});}var g=this.$getBindRule("value",this.xmlRoot);if(g){if(g.models[0]==this.$model&&g.cvalue.xpaths[0]!="#"){throw new Error(apf.formatErrorString(0,this,"Setting value attribute",'Value should not point to the same model where the items                     are loaded from. Please use value="[mdlName::xpath]" to                     specify the value. Use selected="[xpath]" to just select                     a node without making a databinding to it.'));}}if(d||d===0||this["default"]){this.select(String(d)||this["default"]);}else{this.clearSelection();}};this.$propHandlers["default"]=function(c,d){if(!this.value||!this.$amlLoaded&&!(this.getAttribute("value")||this.getAttribute("selected")||this.getAttribute("selection"))){this.$propHandlers.value.call(this,"");}};this.$propHandlers.caret=function(c,d){if(c){this.setCaret(c);}};this.$propHandlers.selection=this.$propHandlers.selected=function(A,q){if(!A){A=this[q]=null;}if(q=="selected"&&typeof A!="string"){if(A&&A.nodeType!=1){A=A.nodeValue;}else{return;}}if(q=="selection"&&(this.getAttribute("selection")||"*").substr(0,1)!="*"){apf.console.warn("Selection attribute ("+this.getAttributeNode("selection")+") should select multiple nodes. Please prefix xpath query with a * (ex.: *[item]).");}if(this.$isSelecting){this.selection=this.$valueList;return false;}var w,o,n,E,D,H,G;if(q=="selection"){if(typeof A=="object"&&A==this.$valueList){var g;if((H=this.$attrBindings[q])&&H.cvalue.models){this.$isSelecting=true;o=this.$attrBindings.eachvalue&&"eachvalue"||this.$bindings.value&&"value"||this.$hasBindRule("caption")&&"caption";if(!o){throw new Error("Missing bind rule set: eachvalue, value or caption");}var k=this.$getDataNode(q,this.xmlRoot);w=A;n=(G=this.$attrBindings["selection-unique"])&&G.cvalue;if(k.length){g=k[0].parentNode;}else{var t,u;if(H.cvalue.xpaths[0]=="#"||H.cvalue.xpaths[1]=="#"){var B=(H.cvalue3||(H.cvalue3=apf.lm.compile(H.value,{xpathmode:5})))(this.xmlRoot);t=B.model&&B.model.$isModel&&B.model;if(t){u=B.xpath;}else{if(B.model){t=apf.xmldb.findModel(B.model);u=apf.xmlToXpath(B.model,t.data)+(B.xpath?"/"+B.xpath:"");}else{}}}else{t=apf.nameserver.get("model",H.cvalue.xpaths[0]);u=H.cvalue.xpaths[1];}if(!t||!t.data){this.$isSelecting=false;return false;}g=t.queryNode(u.replace(/\/[^\/]+$|^[^\/]*$/,"")||".");if(!g){throw new Error("Missing parent node");}}remove_loop:for(E=0;E<k.length;E++){A=n?n(k[E]):this.$applyBindRule(o,k[E]);for(D=0;D<w.length;D++){if(this.$applyBindRule(o,w[D])==A){continue remove_loop;}}apf.xmldb.removeNode(k[E]);}add_loop:for(E=0;E<w.length;E++){A=this.$applyBindRule(o,w[E]);for(D=0;D<k.length;D++){if(n?n(k[D]):this.$applyBindRule(o,k[D])==A){continue add_loop;}}var C=this.$attrBindings["selection-constructor"]&&this.$getDataNode("selection-constructor",w[E])||apf.getCleanCopy(w[E]);apf.xmldb.appendChild(g,C);}this.$isSelecting=false;}return;}this.selection=this.$valueList;}else{this.selected=null;}if(!this.xmlRoot){if(!this.$buffered){var F;this.addEventListener("afterload",F=function(){this.removeEventListener("afterload",F);this.$propHandlers.selected.call(this,A,q);delete this.$buffered;});this.$buffered=true;}this[q]=null;return false;}if(!A||typeof A!="object"){if(this.$attrBindings[q]){w=this.$getDataNode(q,this.xmlRoot);if(w&&(w.length||w.nodeType==1)){this.setProperty("selection",w);return;}if(!w||w.length===0){return;}}if(!A){this.clearSelection();}else{this.select(A);}return false;}else{if(typeof A.length=="number"){w=A;if(!w.length){this.selected=null;if(this.$valueList.length){this.clearSelection();return false;}else{return;}}if(this.isTraverseNode(w[0])&&apf.isChildOf(this.xmlRoot,w[0])){if(!this.multiselect){this.select(w[0]);}else{this.selectList(w);}return false;}if(this.$attrBindings[q]){o=this.$attrBindings.eachvalue&&"eachvalue"||this.$bindings.value&&"value"||this.$hasBindRule("caption")&&"caption";if(!o){throw new Error("Missing bind rule set: eachvalue, value or caption");}var s=!this.each?this.getTraverseNodes():this.xmlRoot.selectNodes("//"+this.each.split("|").join("|//"));n=(H=this.$attrBindings["selection-unique"])&&H.cvalue;var r=[];for(E=0;E<w.length;E++){A=n?n(w[E]):this.$applyBindRule(o,w[E]);for(D=0;D<s.length;D++){if(this.$applyBindRule(o,s[D])==A){r.push(s[D]);}}}this.selectList(r,true);return false;}throw new Error("Show me which case this is");}else{if(this.$valueList.indexOf(A)==-1){this.select(A);}}}};this.$propHandlers.allowdeselect=function(d){if(d){var c=this;this.$container.onmousedown=function(j){if(!j){j=event;}if(j.ctrlKey||j.shiftKey){return;}var g=j.srcElement||j.target;if(c.allowdeselect&&(g==this||g.getAttribute(apf.xmldb.htmlIdTag))){c.clearSelection();}};}else{this.$container.onmousedown=null;}};this.$propHandlers.ctrlselect=function(c){if(c!="enter"){this.ctrlselect=apf.isTrue(c);}};function b(){this.selectAll();}this.$propHandlers.autoselect=function(c){if(c=="all"&&this.multiselect){this.addEventListener("afterload",b);}else{this.removeEventListener("afterload",b);}};this.$propHandlers.multiselect=function(c){if(!c&&this.$valueList.length>1){this.select(this.selected);}};this.addEventListener("beforeselect",function(c){if(this.$bindings.selectable&&!this.$getDataNode("selectable",c.selected)){return false;}},true);this.addEventListener("afterselect",function(j){var g=null;this.setProperty("caret",j.caret);if(this.sellength!=j.selection.length){this.setProperty("sellength",j.selection.length);}delete this.selection;this.setProperty("selection",j.selection);if(!j.selection.length){this.setProperty("selected",j.selected);if(this.value){this.setProperty("value","");}}else{this.$chained=true;if(!j.force&&(!this.dataParent||!this.dataParent.parent.$chained)){var c=this;$setTimeout(function(){c.setProperty("selected",g||j.selected);delete c.$chained;},10);}else{this.setProperty("selected",g||j.selected);delete this.$chained;}var d=this.$attrBindings.eachvalue&&"eachvalue"||this.$bindings.value&&"value"||this.$hasBindRule("caption")&&"caption";if(d){this.$lastValue=this.$applyBindRule(d,j.selected);if(this.$lastValue!=(d!="value"&&(this.xmlRoot&&this.$applyBindRule("value",this.xmlRoot,null,true))||this.value)){if(d=="eachvalue"||this.xmlRoot!=this){this.change(this.$lastValue);}else{this.setProperty("value",this.$lastValue);}}delete this.$lastValue;}}},true);}).call(apf.MultiSelect.prototype=new apf.MultiselectBinding());apf.__CONTENTEDITABLE__=1<<23;apf.__CHILDVALUE__=1<<27;apf.ChildValue=function(){if(!this.$childProperty){this.$childProperty="value";}this.$regbase=this.$regbase|apf.__CHILDVALUE__;var b;this.addEventListener("DOMCharacterDataModified",b=function(g){if(g&&(g.currentTarget==this||g.currentTarget.nodeType==2&&g.relatedNode==this)){return;}if(this.getAttribute(this.$childProperty)){return;}var c=this.serialize().match(/^[\s\S]*?>([\s\S]*)<[\s\S]*?$/),d=c&&c[1]||"";if(d.indexOf("{")>-1||d.indexOf("[")>-1){this.$setDynamicProperty(this.$childProperty,d);}else{if(this[this.$childProperty]!=d){this.setProperty(this.$childProperty,d);}}});this.addEventListener("DOMAttrModified",b);this.addEventListener("DOMNodeInserted",b);this.addEventListener("DOMNodeRemoved",b);this.$init(function(){this.addEventListener("prop."+this.$childProperty,function(c){if(!c.value){b.call(this);}});});this.addEventListener("DOMNodeInsertedIntoDocument",function(g){var j=typeof this[this.$childProperty]=="undefined";if(j&&!this.getElementsByTagNameNS(this.namespaceURI,"*",true).length&&(this.childNodes.length>1||this.firstChild&&(this.firstChild.nodeType==1||this.firstChild.nodeType!=7&&this.firstChild.nodeValue.trim().length))){var c=(this.$aml&&this.$aml.xml||this.serialize()).match(/^[\s\S]*?>([\s\S]*)<[\s\S]*?$/),d=c&&c[1]||"";if(d.indexOf("{")>-1||d.indexOf("[")>-1){this.$setDynamicProperty(this.$childProperty,d);}else{this.setProperty(this.$childProperty,d);}}else{if(j){this.$propHandlers[this.$childProperty].call(this,"");}}});};apf.__DATAACTION__=1<<25;apf.DataAction=function(){this.$regbase=this.$regbase|apf.__DATAACTION__;this.getActionTracker=function(g){if(!apf.AmlNode){return apf.window.$at;}var c=this,d=g?null:this.$at;if(!d&&this.dataParent){d=this.dataParent.parent.$at;}while(!d){if(!c.parentNode){var b;return(b=this.getModel&&this.getModel(true))&&b.$at||apf.window.$at;}d=(c=c.parentNode).$at;}return d;};this.$actionsLog={};this.$actions=false;this.$startAction=function(c,g,j){if(this.disabled||this.contenteditable&&c!="edit"){return false;}var d=this.$actions&&this.$actions.getRule(c,g);if(!d&&apf.config.autoDisableActions&&this.$actions){if(!g){apf.console.warn("Tried starting new action but no xml                     context was specified.");}else{apf.console.warn("Tried starting new action but no '"+c+"' action rule was found.");}return false;}var b=typeof apf.offline!="undefined";if(this.dispatchEvent(c+"start",{xmlContext:g})===false){return false;}this.$actionsLog[c]=g;return true;};this.$stopAction=function(c,d,b){delete this.$actionsLog[c];};this.$executeAction=function(s,j,c,r,m,d,t){if(this.disabled||this.contenteditable&&c!="edit"){return;}apf.console.info("Executing action '"+c+"' for "+(this.name||"")+" ["+(this.localName||"")+"]");var o=this.$actions&&this.$actions.getRule(c,r);if(!o&&this.$actions&&apf.config.autoDisableActions&&"action|change".indexOf(c)==-1){apf.console.warn("Could not execute action '"+c+"'.               No valid action rule was found and auto-disable-actions is enabled");return false;}var q;if(t){q=[];for(var b=t.length-1;b>=0;b--){q.unshift({xmlActionNode:o&&o[4],amlNode:this,selNode:t[b],xmlNode:t[b]});}}var n=new apf.AmlEvent("before"+c.toLowerCase(),{action:s,args:j,xmlActionNode:o,amlNode:this,selNode:d,multiple:q||false});if(!m){if(this.dispatchEvent(n.name,null,n)===false){return false;}delete n.currentTarget;}var g=this.getActionTracker().execute(n);n.xmlNode=g.xmlNode;n.undoObj=g;if(!m){n.name="after"+c.toLowerCase();n.cancelBubble=false;delete n.returnValue;delete n.currentTarget;this.dispatchEvent(n.name,null,n);}return g;};this.$executeSingleValue=function(b,q,w,u,n){var o,r,t=this.$getBindRule(q,w);if(!t){if(this.$getBindRule(q)){throw new Error("There is no rule that matches the xml node for this operation.                                 Please make sure you are matching a node and using the value to                                  specify it's value <a:"+q+" match='person'                                  value='[@name]' /> : "+w.xml);}else{return false;}}var s=t.value?t.cvalue:t.cmatch;if(!s){if(t.value){s=t.compile("value");}else{return false;}}if(s.type!=3){throw new Error("Cannot create from rule that isn't a single xpath");}var A,c=s.xpaths,j=false;if(c[0]=="#"||c[1]=="#"){var g=(t.cvalue3||(t.cvalue3=apf.lm.compile(t.value,{xpathmode:5})))(w);var k=g.model&&g.model.$isModel&&g.model;if(k){var d=k.queryNode(g.xpath);w=k.data;}else{k=apf.xmldb.findModel(g.model);var d=g.model.selectSingleNode(g.xpath);w=g.model;}c[1]=g.xpath;}else{var k=c[0]&&apf.nameserver.get("model",c[0])||this.$model,d=k?k.queryNode(c[1]):(w||this.xmlRoot).selectSingleNode(c[1]);}if(d){if(apf.queryValue(d)==u){return;}A=(d.nodeType==1||d.nodeType==3||d.nodeType==4)?"setTextNode":"setAttribute";r=(d.nodeType==1)?[d,u]:(d.nodeType==3||d.nodeType==4?[d.parentNode,u]:[d.ownerElement||d.selectSingleNode(".."),d.nodeName,u]);}else{if(!this.$createModel){return false;}A="setValueByXpath";o=c[1];if(!w){if(!k){k=this.getModel();}if(k){if(!k.data){k.load("<data />");}o=(k.getXpathByAmlNode(this)||".")+(o&&o!="."?"/"+o:"");w=k.data;}else{if(!this.dataParent){return false;}w=this.dataParent.parent.selected||this.dataParent.parent.xmlRoot;if(!w){return false;}o=(this.dataParent.xpath||".")+(o&&o!="."?"/"+o:"");j=true;}}r=[w,u,o];}if(n){return{func:A,args:r};}this.$executeAction(A,r,b,w);if(j){this.load(w.selectSingleNode(o));}};this.change=function(d,c){if(this.errBox&&this.errBox.visible&&this.isValid&&this.isValid()){this.clearError();}if(!this.xmlRoot&&!this.$createModel||!(this.$mainBind=="value"&&this.hasFeature(apf.__MULTISELECT__)?this.$attrBindings.value:this.$hasBindRule(this.$mainBind))){if(!c&&d===this.value||this.dispatchEvent("beforechange",{value:d})===false){return false;}this.setProperty("value",d);return this.dispatchEvent("afterchange",{value:d});}var b=this.$attrBindings.eachvalue&&"eachvalue"||this.$bindings.value&&"value"||this.$hasBindRule("caption")&&"caption";if(d==(b!="value"&&(this.xmlRoot&&this.$applyBindRule("value",this.xmlRoot,null,true))||this.value)){return false;}this.$executeSingleValue("change",this.$mainBind,this.xmlRoot,d);};this.$booleanProperties["render-root"]=true;this.$supportedProperties.push("create-model","actions");this.$propHandlers["create-model"]=function(b){this.$createModel=b;};this.addEventListener("DOMNodeInsertedIntoDocument",function(b){if(typeof this["create-model"]=="undefined"&&!this.$setInheritedAttribute("create-model")){this.$createModel=true;}});};apf.config.$inheritProperties["create-model"]=1;apf.__CACHE__=1<<2;apf.__RENAME__=1<<10;apf.Rename=function(){this.$regbase=this.$regbase|apf.__RENAME__;this.canrename=true;this.$renameSubject=this.renameTimer=this.lastCursor=null;this.$booleanProperties.canrename=true;this.$booleanProperties.autorename=true;this.$supportedProperties.push("canrename","autorename");this.rename=function(b,c){if(!b){b=this.caret||this.selected;}if(!b){return;}this.$executeSingleValue("rename","caption",b,c);};this.startDelayedRename=function(c,b,d){if(c&&(c.button==2||c.ctrlKey||c.shiftKey)||d&&this.disabled){return;}clearTimeout(this.renameTimer);this.renameTimer=$setTimeout("apf.lookup("+this.$uniqueId+").startRename()",b||400);};this.startRename=function(g,b,m){if(!g&&(this.renaming||!this.canrename||!this.$startAction("rename",this.caret||this.selected,this.stopRename))||m&&this.disabled){return false;}if(!this.hasFocus()){this.focus(null,null,true);}clearTimeout(this.renameTimer);var n=this.$getCaptionElement?this.$getCaptionElement():this.$caret||this.$selected;if(!n){return this.stopRename();}this.renaming=true;this.$renameSubject=this.caret||this.selected;var c=n.offsetWidth;this.lastCursor=n.style.cursor;n.style.cursor="text";n.parentNode.replaceChild(this.$txt,n);n.host=this;if(apf.isTrue(this.$getOption("main","scalerename"))){var k=apf.getWidthDiff(this.$txt);this.$txt.style.width=(c-k-3)+"px";}this.$replacedNode=n;var d=this.$getCaptionXml?this.$getCaptionXml(this.$renameSubject):this.$getDataNode("caption",this.$renameSubject);value=b||!d?"":(d.nodeType!=1?unescape(d.nodeValue):(apf.isOnlyChild(d.firstChild,[3,4])?apf.queryValue(d):this.$applyBindRule("caption",this.$renameSubject)))||"";if(apf.hasContentEditable){if(this.$multiLineRename){this.$txt.innerHTML=apf.htmlCleaner.prepare(value.trim().replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br />"));}else{this.$txt.innerHTML=value.replace(/</g,"&lt;");}}else{this.$txt.value=value;}this.$txt.unselectable="Off";this.$txt.host=this;try{this.$txt.focus();this.$txt.select();}catch(j){}};this.stopRename=function(b,d){clearTimeout(this.renameTimer);if(!this.renaming||b&&b!=this.$renameSubject||!this.$replacedNode){return false;}if(this.$txt.parentNode&&this.$txt.parentNode.nodeType==1){if(apf.isIE8||apf.isIE7Emulate){this.$txt.blur();}this.$txt.parentNode.replaceChild(this.$replacedNode,this.$txt);}this.renaming=false;if(this.$replacedNode){this.$replacedNode.style.cursor=this.lastCursor||"";this.$replacedNode.host=null;}if(this.$multiLineRename){var c=apf.html_entity_decode(apf.htmlCleaner.parse(this.$txt.innerHTML,true).replace(/<br \/>/g,"").replace(/<\/?p>/g,""));}else{var c=this.$txt[apf.hasContentEditable?"innerText":"value"].replace(/<.*?nobr>/gi,"");}if(!d||(this.$validateRename&&!this.$validateRename(c))){this.dispatchEvent("stoprename");this.$stopAction("rename");}else{if(this.$replacedNode){this.$replacedNode.innerHTML=c.replace(/</g,"&lt;").replace(/\r?\n/g,"<br />");}this.rename(this.$renameSubject,c);}if(!this.renaming){this.$renameSubject=null;this.$replacedNode=null;this.$txt.style.width="";}return true;};this.addEventListener("keydown",function(c){var b=c.keyCode;if(this.renaming){if(b==27||this.$multiLineRename&&c.ctrlKey&&b==13||!this.$multiLineRename&&b==13){this.stopRename(null,b==13&&!this.$autocomplete);c.cancelBubble=true;return false;}return;}if(b==113){if(this.$tempsel){this.$selectTemp();}if(this.caret!=this.selected){if(this.multiselect||this.isSelected(this.caret)){this.selected=this.caret;this.$selected=this.$caret;}else{this.select(this.caret,true);}}this.startRename();return false;}},true);this.addEventListener("DOMNodeRemovedFromDocument",function(b){this.$txt.refCount--;if(!this.$txt.refCount){this.$txt.host=this.$txt.onmouseover=this.$txt.onmousedown=this.$txt.select=this.$txt.onfocus=this.$txt.onblur=null;}this.$txt=null;});this.$init(apf.Rename.initEditableArea);};apf.Rename.initEditableArea=function(){if(!(this.$txt=document.getElementById("txt_rename"))){if(apf.hasContentEditable){this.$txt=document.createElement("DIV");this.$txt.contentEditable=true;if(apf.isIE6){this.$txt.style.width="1px";}}else{this.$txt=document.createElement("input");this.$txt.id="txt_rename";this.$txt.autocomplete=false;}if(apf.hasFocusBug){apf.sanitizeTextbox(this.$txt);}this.$txt.refCount=0;this.$txt.id="txt_rename";apf.importCssString("#txt_rename{white-space:nowrap}");this.$txt.onselectstart=function(b){(b||event).cancelBubble=true;};apf.sanitizeTextbox(this.$txt);this.$txt.onmouseover=this.$txt.onmouseout=this.$txt.oncontextmenu=this.$txt.onmousedown=function(b){(b||event).cancelBubble=true;};this.$txt.onkeyup=function(b){if(!this.host.$autocomplete){return;}this.host.$lookup(this[apf.hasContentEditable?"innerHTML":"value"]);};this.$txt.select=function(){if(!apf.hasMsRangeObject){return this.focus();}var b=document.selection.createRange();try{b.moveToElementText(this);if(apf.isFalse(this.host.$getOption("main","selectrename"))||typeof this.host.$renameStartCollapse!="undefined"){b.collapse(this.host.$renameStartCollapse);}}catch(c){}b.select();};if(apf.hasFocusBug){this.$txt.onfocus=function(){if(apf.window){apf.window.$focusfix2();}};}this.$txt.onblur=function(){if(apf.isGecko){return;}if(apf.hasFocusBug){apf.window.$blurfix();}if(this.host.$autocomplete){return;}this.host.stopRename(null,true);};}this.$txt.refCount++;};apf.__DOCKING__=1<<18;apf.BaseButton=function(){this.$init(true);};(function(){this.implement(apf.ChildValue);this.refKeyDown=this.refMouseDown=0;this.mouseOver=this.mouseLeft=false;this.$propHandlers.background=function(d){var g=this.$getLayoutNode("main","background",this.$ext);if(!g){return apf.console.warn("No background defined in the Button skin","button");}if(d){var c=d.split("|");this.$background=c.concat(["vertical",2,16].slice(c.length-1));g.style.backgroundImage="url("+this.mediaPath+c[0]+")";g.style.backgroundRepeat="no-repeat";}else{g.style.backgroundImage="";g.style.backgroundRepeat="";this.$background=null;}};this.addEventListener("keydown",function(c){var b=c.keyCode;switch(b){case 13:if(this.localName!="checkbox"){this.$ext.onmouseup(c.htmlEvent,true);}break;case 32:if(!c.htmlEvent.repeat){this.refKeyDown++;this.$updateState(c.htmlEvent);}return false;}},true);this.addEventListener("keyup",function(c){var b=c.keyCode;switch(b){case 32:this.refKeyDown--;if(this.refKeyDown<0){this.refKeyDown=0;return false;}if(this.refKeyDown+this.refMouseDown==0&&!this.disabled){this.$ext.onmouseup(c,true);}this.$updateState(c);return false;}},true);this.states={Out:1,Over:2,Down:3};this.$updateState=function(c,b){if(c.reset){this.refKeyDown=0;this.refMouseDown=0;this.mouseOver=false;return false;}if(this.refKeyDown>0||(this.refMouseDown>0&&this.mouseOver)||(this.isBoolean&&this.value)){this.$setState("Down",c,b);}else{if(this.mouseOver){this.$setState("Over",c,b);}else{this.$setState("Out",c,b);}}};this.$setupEvents=function(){if(this.editable){return;}var b=this;this.$ext.onmousedown=function(c){c=c||window.event;if(b.disabled||b.$notfromext&&(c.srcElement||c.target)==this){return;}b.refMouseDown=1;b.mouseLeft=false;b.$updateState(c,"mousedown");};this.$ext.onmouseup=function(d,c){d=d||window.event;if(b.disabled||!c&&(!b.mouseOver||!b.refMouseDown)){return;}b.refMouseDown=0;b.$updateState(d,"mouseup");if(b.disabled||(d&&d.type=="click"&&b.mouseLeft==true)){return false;}if(b.refMouseDown+b.refKeyDown){return false;}if(b.$clickHandler&&b.$clickHandler()){b.$updateState(d||event,"click");}else{b.dispatchEvent("click",{htmlEvent:d});}return false;};this.$ext.onmousemove=function(c){if(!b.mouseOver&&!b.disabled){c=c||window.event;if(b.$notfromext&&(c.srcElement||c.target)==this){return;}b.mouseOver=true;b.$updateState(c,"mouseover");}};this.$ext.onmouseout=function(d){d=d||window.event;var c=d.explicitOriginalTarget||d.toElement;if(b.disabled||this==c||apf.isChildOf(this,c)){return;}b.mouseOver=false;b.refMouseDown=0;b.mouseLeft=true;b.$updateState(d,"mouseout");};if(apf.isIphone){apf.iphone.linkEvents(this.$ext,true);}if(apf.hasClickFastBug){this.$ext.ondblclick=this.$ext.onmouseup;}};this.$doBgSwitch=function(c){if(this.background&&(this.$background[2]>=c||c==4)){if(c==4){c=this.$background[2]+1;}var b=this.$background[1]=="vertical"?"0 -"+(parseInt(this.$background[3])*(c-1))+"px":"-"+(parseInt(this.$background[3])*(c-1))+"px 0";this.$getLayoutNode("main","background",this.$ext).style.backgroundPosition=b;}};this.$focus=function(){if(!this.$ext){return;}this.$setStyleClass(this.$ext,this.$baseCSSname+"Focus");};this.$blur=function(b){if(!this.$ext){return;}this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Focus"]);if(b){this.$updateState({});}};this.$destroy=function(b){if(!b&&this.$ext){this.$ext.onmousedown=this.$ext.onmouseup=this.$ext.onmouseover=this.$ext.onmouseout=this.$ext.onclick=this.$ext.ondblclick=null;}};}).call(apf.BaseButton.prototype=new apf.StandardBinding());apf.BaseTab=function(){this.$init(true);};(function(){this.isPaged=true;this.$focussable=apf.KEYBOARD;this.length=0;this.isLoading={};this.inited=this.ready=false;this.set=function(c,d,b){if(b||this.src&&!this.$findPage(c,{})){return this.$propHandlers.activepage.call(this,c,null,null,d,b);}if(d&&this.activepage==c){return d();}this.$lastCallback=d;this.setProperty("activepage",c);};this.$supportedProperties.push("activepage","activepagenr","length","src","loading");this.$propHandlers.activepagenr=this.$propHandlers.activepage=function(g,b,c,o,j){if(!this.inited||apf.isNot(g)){return;}if(!o){o=this.$lastCallback;delete this.$lastCallback;}var k,d={};k=this.$findPage(g,d);if(!k){if(this.src){if(this.isLoading[g]){return;}if(this.$findPage("loading",{})){this.$propHandlers.activepage.call(this,"loading");}this.setProperty("loading",true);this.isLoading[g]=true;k=this.ownerDocument.createElementNS(apf.ns.apf,"page");k.setAttribute("id",g);this.appendChild(k);var m=this;k.insertMarkup(this.src,{page:g,callback:function(q){if(!q.xmlNode){var r=new Error(apf.formatErrorString(0,null,"Loading new page","Could not load new page: "+m.src));m.setProperty("loading",false);if(this.dispatchEvent("error",apf.extend({error:r,bubbles:true},q))===false){return true;}throw r;}else{m.setProperty("activepage",g);if(o){o();}m.setProperty("loading",false);}}});return;}apf.console.warn("Setting tab page which doesn't exist,                               referenced by name: '"+g+"'");return false;}if(k.parentNode!=this){apf.console.warn("Setting active page on page component which                               isn't a child of this tab component. Cancelling.");return false;}if(!k.visible||k.disabled){apf.console.warn("Setting active page on page component which                               is not visible or disabled. Cancelling.");return false;}if(g.tagName){g=d.position;this.activepage=k.name||g;}if(!j){var n={previous:this.activepage,previousId:this.activepagenr,previousPage:this.$activepage,next:g,nextId:d.position,nextpage:k};if(this.dispatchEvent("beforeswitch",n)===false){if(this.hideLoader){this.hideLoader();}return false;}}this.activepagenr=d.position;this.setProperty("activepagenr",d.position);if(this.$activepage){this.$activepage.$deactivate();}k.$activate();this.$activepage=k;if(this.hideLoader){if(k.$rendered!==false){this.hideLoader();}else{k.addEventListener("afterrender",function(){this.parentNode.hideLoader();});}}if(!j){if(k.$rendered!==false){this.dispatchEvent("afterswitch",n);}else{k.addEventListener("afterrender",function(){this.parentNode.dispatchEvent("afterswitch",n);});}}if(typeof o=="function"){o();}return true;};this.getPages=function(){var g=[],c=this.childNodes;for(var d=0,b=c.length;d<b;d++){if("page|case".indexOf(c[d].localName)>-1){g.push(c[d]);}}return g;};this.getPage=function(b){if(apf.isNot(b)){return this.$activepage;}else{return this.$findPage(b);}};this.add=function(b,c,d){var g=apf.document.createElement(d||"page");if(c){g.setAttribute("id",c);}if(b){g.setAttribute("caption",b);}this.appendChild(g);return g;};this.remove=function(b){var c=this.$findPage(b);if(!c){return false;}c.removeNode();return c;};this.addEventListener("DOMNodeRemoved",function(c){var b=c.currentTarget;if(c.$doOnlyAdmin||c.relatedNode!=this||b.localName!="page"){return;}if(this.firstChild==b&&b.nextSibling){b.nextSibling.$first();}if(this.lastChild==b&&b.previousSibling){b.previousSibling.$last();}if(this.$activepage==b){if(b.nextSibling||b.previousSibling){this.set(b.nextSibling||b.previousSibling);}else{this.$activepage=this.activepage=this.activepagenr=null;}}this.setProperty("length",this.childNodes.length);});this.addEventListener("DOMNodeInserted",function(g){var b=g.currentTarget;if(b.localName!="page"||g.relatedNode!=this||b.nodeType!=1){return;}if(!g.$beforeNode){var c;if(c=this.lastChild){if(c.nodeType!=1){c=c.previousSibling;}if(c){c.$last(true);}}b.$last();}if(!this.firstChild||g.$beforeNode==this.firstChild){if(this.firstChild){this.firstChild.$first(true);}b.$first();}if(this.$activepage){var d={};this.$findPage(this.$activepage,d);if(this.activepagenr!=d.position){if(parseInt(this.activepage)==this.activepage){this.activepage=d.position;this.setProperty("activepage",d.position);}this.activepagenr=d.position;this.setProperty("activepagenr",d.position);}}else{if(!this.$activepage){this.set(b);}}this.setProperty("length",this.childNodes.length);});this.$findPage=function(k,m){var j,c=this.childNodes;for(var g=0,d=0,b=c.length;d<b;d++){j=c[d];if("page|case".indexOf(j.localName)>-1&&(g++==k||(k.localName&&j||j.name)==k)){if(m){m.position=g-1;}return j;}}return null;};this.$enable=function(){var c=this.childNodes;for(var d=0,b=c.length;d<b;d++){if(c[d].enable){c[d].enable();}}};this.$disable=function(){var c=this.childNodes;for(var d=0,b=c.length;d<b;d++){if(c[d].disable){c[d].disable();}}};this.addEventListener("keydown",function(d){if(!this.$hasButtons){return;}var c,b=d.keyCode;switch(b){case 9:break;case 13:break;case 32:break;case 37:c=this.getPage().previousSibling;while(c&&(c.nodeType!=1||"page|case".indexOf(c.localName)==-1||!c.visible)){c=c.previousSibling;}if(c){this.setProperty("activepage",c);}break;case 39:c=this.getPage().nextSibling;while(c&&(c.nodeType!=1||"page|case".indexOf(c.localName)==-1||!c.visible)){c=c.nextSibling;}if(c){this.setProperty("activepage",c);}break;default:return;}},true);this.$loadChildren=function(o){var n=false,b=this,k,g,c,m,d;this.inited=true;if(this.$hasButtons){this.$buttons=this.$getLayoutNode("main","buttons",this.$ext);this.$buttons.setAttribute("id",this.$uniqueId+"_buttons");}this.oPages=this.$getLayoutNode("main","pages",this.$ext);if(this.$int){this.$int=this.oPages;n=true;d=this.childNodes;for(k=0;k<d.length;k++){m=d[k];if(m.nodeType!=1){continue;}m.$draw(true);if(m.$skinchange){m.$skinchange();}m.$loadAml();}}else{this.$int=this.oPages;d=this.childNodes;for(g=0,k=0,c=d.length;k<c;k++){if("page|case".indexOf((m=d[k]).localName)>-1){if(g++==0){m.$first();}if(g==c){m.$last();}}}}if(m){this.activepage=(typeof this.activepage!="undefined"?this.activepage:this.activepagenr)||0;n=this.getPage(this.activepage);if(n.render!="runtime"||n.$rendered){this.$propHandlers.activepage.call(this,this.activepage);}}else{this.isPages=false;}this.setProperty("length",g);this.ready=true;if(!this.activepage&&this.getAttribute("src")){this.src=this.getAttribute("src");this.$propHandlers.activepage.call(this);}};this.$destroy=function(b){if(b||!this.oScroller){return;}};}).call(apf.BaseTab.prototype=new apf.Presentation());apf.__XFORMS__=1<<17;apf.__FOCUSSABLE__=1<<26;apf.Focussable=function(){this.$regbase=this.$regbase|apf.__FOCUSSABLE__;this.setTabIndex=function(b){apf.window.$removeFocus(this);apf.window.$addFocus(this,b);return this;};this.focus=function(b,d,c){if(!b){if(this.$isWindowContainer>-1){apf.window.$focusLast(this,d,true);}else{apf.window.$focus(this,d);if(!c&&apf.hasFocusBug){apf.window.$focusfix();}}return this;}if(this.$focus&&!this.editable){this.$focus(d);}this.dispatchEvent("focus",apf.extend({bubbles:true},d));return this;};this.blur=function(b,c){if(apf.popup.isShowing(this.$uniqueId)){apf.popup.forceHide();}if(this.$blur){this.$blur(c);}if(!b){apf.window.$blur(this);}this.dispatchEvent("blur",apf.extend({bubbles:!c||!c.cancelBubble},c));return this;};this.hasFocus=function(){return apf.document.activeElement==this||this.$isWindowContainer&&(apf.document.activeElement||{}).$focusParent==this;};};apf.__MEDIA__=1<<20;apf.BaseSimple=function(){this.$init(true);};(function(){this.implement(apf.DataAction);this.getValue=function(){return this.value;};}).call(apf.BaseSimple.prototype=new apf.StandardBinding());apf.__ALIGNMENT__=1<<29;apf.BaseTree=function(){this.$init(true);this.$dynCssClasses=[];this.$nodes=[];};(function(){this.implement(apf.Rename,apf.DataAction,apf.K);this.$isTreeArch=true;this.$focussable=true;this.multiselect=false;this.bufferselect=true;this.startcollapsed=true;this.$animType=apf.tween.NORMAL;this.$animOpenStep=3;this.$animCloseStep=1;this.$animSpeed=10;var b=1<<1,d=1<<2,g=1<<3,m=1<<4;var c=this.$treeState={};this.$treeState[0]="";this.$treeState[b]="min";this.$treeState[b|d]="plus";this.$treeState[g]="last";this.$treeState[g|b]="minlast";this.$treeState[g|b|d]="pluslast";this.$treeState[m]="root";this.$booleanProperties.openadd=true;this.$booleanProperties.startcollapsed=true;this.$booleanProperties.nocollapse=true;this.$booleanProperties.singleopen=true;this.$booleanProperties.prerender=true;this.$booleanProperties.removecontainer=true;this.$supportedProperties.push("openadd","startcollapsed","nocollapse","singleopen","prerender","removecontainer");this.openadd=true;this.startcollapsed=1;this.prerender=true;this.expandAll=function(){if(!this.xmlRoot){return;}var o=this.each.split("|").join("["+this.each.replace(/\|/g," or ")+"]|.//"),n=this;(function(s){var q=s.selectNodes(o);for(var t,r=0;r<q.length;r++){if(t=apf.xmldb.getHtmlNode(q[r],n)){n.slideToggle(t,1,true);}arguments.callee(q[r]);}})(this.xmlRoot);};this.collapseAll=function(){if(!this.xmlRoot){return;}var q=this.xmlRoot.selectNodes(".//"+this.each.split("|").join("["+this.each.replace(/\|/g," or ")+"]|.//"));for(var r,n=q.length-1;n>=0;n--){if(r=apf.xmldb.getHtmlNode(q[n],this)){this.slideToggle(r,2,true);}}};this.expandAndSelect=function(q){if(!this.xmlRoot){return;}var o=this;if((function n(s){var r=o.getTraverseParent(s);if(!r||r!=o.xmlRoot&&n(r)===false){return false;}o.slideToggle(apf.xmldb.getHtmlNode(r,o),1,true);})(q)!==false){this.select(q);}};this.selectPath=function(n){};this.slideToggle=function(r,q,o,s){if(this.nocollapse||s&&this.disabled){return;}if(!r){r=this.$selected;}var t=r.getAttribute(apf.xmldb.htmlIdTag);while(!t&&r.parentNode){t=(r=r.parentNode).getAttribute(apf.xmldb.htmlIdTag);}var n=this.$getLayoutNode("item","container",r);if(!n){return;}if(apf.getStyle(n,"display")=="block"){if(q==1){return;}r.className=r.className.replace(/min/,"plus");this.slideClose(n,apf.xmldb.getNode(r),o);}else{if(q==2){return;}r.className=r.className.replace(/plus/,"min");this.slideOpen(n,apf.xmldb.getNode(r),o);}};this.isCollapsed=function(n){return(apf.getStyle(this.$getLayoutNode("item","container",apf.xmldb.getHtmlNode(n,this)),"display")=="none");};var j={};this.slideOpen=function(o,s,q){if(!s){s=this.selected;}var t=apf.xmldb.findHtmlNode(s,this);if(!o){o=this.$findContainer(t);}if(!o.innerHTML&&!this.getTraverseNodes(s).length){return;}if(this.singleopen){var r=this.getTraverseParent(s),u=(r||this.xmlRoot).getAttribute(apf.xmldb.xmlIdTag);if(j[u]&&j[u][1]!=s&&this.getTraverseParent(j[u][1])==r){this.slideToggle(j[u][0],2);}j[u]=[t,s];}if(!this.nocollapse){o.style.display="block";}if(!this.prerender&&this.$hasLoadStatus(s,"potential")&&!o.innerHTML){this.$extend(s,o,q);return;}if(q||o.scrollHeight>1000){if(!this.nocollapse){o.style.height="auto";o.style.overflow="visible";}this.dispatchEvent("expand",{xmlNode:s});return;}var n=this;apf.tween.single(o,{type:"scrollheight",from:0,to:o.scrollHeight,anim:this.$animType,steps:this.$animOpenStep,interval:this.$animSpeed,onfinish:function(w){if(s&&n.$hasLoadStatus(s,"potential")){$setTimeout(function(){w.style.height=w.scrollHeight+"px";w.style.overflow="hidden";n.$extend(s,w);});w.style.height=apf.hasHeightAutoDrawBug?"100%":"auto";w.style.overflow="visible";}else{w.style.overflow="visible";w.style.height=apf.hasHeightAutoDrawBug?"100%":"auto";}n.dispatchEvent("expand",{xmlNode:s});}});};this.slideClose=function(o,r,q){if(this.nocollapse){return;}if(!r){r=this.selected;}if(this.singleopen){var t=(this.getTraverseParent(r)||this.xmlRoot).getAttribute(apf.xmldb.xmlIdTag);j[t]=null;}if(!o){var s=apf.xmldb.findHtmlNode(r,this);o=this.$findContainer(s);}o.style.height=o.offsetHeight;o.style.overflow="hidden";if(q){o.style.height=0;o.style.display="none";this.dispatchEvent("collapse",{xmlNode:r});return;}var n=this;apf.tween.single(o,{type:"scrollheight",from:o.scrollHeight,to:0,anim:this.$animType,steps:this.$animCloseStep,interval:this.$animSpeed,onfinish:function(u,w){u.style.display="none";n.dispatchEvent("collapse",{xmlNode:r});}});};this.$add=function(o,F,n,B,E,A,L){if(this.$isTreeArch&&this.$needsDepth&&typeof L=="undefined"){var u=n;L=0;while(u!=this.xmlRoot){L++;u=u.parentNode;}}var t=this.$getBindRule("insert",o)?true:false,K=this.getTraverseNodes(o),J=K.length?true:false,G=t||J,D=this.$hasBindRule("collapsed")?(this.$getDataNode("collapsed",o)?true:false):(this.$hasBindRule("expanded")?(this.$getDataNode("expanded",o)?false:true):this.startcollapsed),q=(G?b:0)|(D&&G||t?d:0)|(A?g:0),w=this.$initNode(o,q,F,L),C=this.$getLayoutNode("item","container",w),I;if(!D&&!this.nocollapse){C.setAttribute("style","overflow:visible;height:auto;display:block;");}var r,H=(!this.removecontainer||G);if(!G||t){C.setAttribute("style","display:none;");}if(!this.prerender){I=K.length;}if(G&&!this.prerender&&I>2&&D||t&&(!this.$hasLoadStatus(o)||this.$hasLoadStatus(o,"potential"))){this.$setLoading(o,C);}else{if(!J&&(r=this.$applyBindRule("empty",o))){this.$setEmptyMessage(C,r);}}if((!B||B==this.$container)&&n==this.xmlRoot&&!E){this.$nodes.push(w);if(!apf.isChildOf(w,C,true)&&H){this.$nodes.push(C);}this.$setStyleClass(w,"root");this.$setStyleClass(C,"root");}else{if(!B){B=apf.xmldb.findHtmlNode(o.parentNode,this);B=B?this.$getLayoutNode("item","container",B):this.$container;}if(B==this.$container){this.$setStyleClass(w,"root");this.$setStyleClass(C,"root");}if(!E&&this.getNextTraverse(o)){E=apf.xmldb.findHtmlNode(this.getNextTraverse(o),this);}if(E&&E.parentNode!=B){E=null;}if(B.style&&this.getTraverseNodes(o.parentNode).length==1){this.$removeEmptyMessage(B);}if(B.style){var s=!apf.isChildOf(w,C,true);w=apf.insertHtmlNode(w,B,E);if(s&&H){var C=apf.insertHtmlNode(C,B,E);}else{var C=this.$getLayoutNode("item","container",w);}}else{B.insertBefore(w,E);if(!apf.isChildOf(w,C,true)&&H){B.insertBefore(C,E);}}if(B.style){if(!D&&this.openadd&&B!=this.$container&&B.style.display!="block"){this.slideOpen(B,n,true);}this.$fixItem(n,apf.xmldb.findHtmlNode(n,this));if(this.getNextTraverse(o,true)){this.$fixItem(this.getNextTraverse(o,true),apf.xmldb.findHtmlNode(this.getNextTraverse(o,true),this));}}}if((this.prerender||I<3||!D)&&(o.namespaceURI!=apf.ns.apf||o.localName!="item")){this.$addNodes(o,C,false,null,null,(L||0)+1);}return C;};this.$fill=function(){if(this.$useiframe){this.$pHtmlDoc=this.oDoc;}if(this.$useTable){apf.insertHtmlNodes(this.$nodes,this.$container,null,"<table class='records' cellpadding='0' cellspacing='0'><tbody>","</tbody></table>");}else{apf.insertHtmlNodes(this.$nodes,this.$container);}this.$nodes.length=0;};this.$getParentNode=function(n){return n?this.$getLayoutNode("item","container",n):this.$container;};this.$fixItem=function(C,A,w,B,r){if(!A){return;}if(w){var s;if(s=this.getNextTraverse(C,true)){this.$fixItem(s,this.$findHtmlNode(s.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId),null,true);}if(!this.emptyMessage&&C.parentNode.selectNodes(this.each).length==1){this.$fixItem(C.parentNode,this.$findHtmlNode(C.parentNode.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId),null,false,true);}}else{var o=this.$getLayoutNode("item","container",A),u=false;if(r){u=false;}else{if(this.getTraverseNodes(C).length>0){u=true;}else{if(this.$hasLoadStatus(C,"potential")){u=true;}else{u=false;}}}var q=u&&o.style.display!="block",t=this.getNextTraverse(C,null,B?2:1)?false:true,n=(u?b:0)|(q?d:0)|(t?g:0);this.$setStyleClass(this.$getLayoutNode("item","class",A),c[n],["min","plus","last","minlast","pluslast"]);this.$setStyleClass(this.$getLayoutNode("item","container",A),c[n],["min","plus","last","minlast","pluslast"]);if(this.$getLayoutNode("item","openclose",A)){this.$getLayoutNode("item","openclose",A).setAttribute("children",u);}if(!u&&o){o.style.display="none";}}};this.$deInitNode=function(o,r){var n=this.$getLayoutNode("item","container",r),q=r.parentNode;n.parentNode.removeChild(n);q.removeChild(r);if(this.$withContainer){r.parentNode.removeChild(r.nextSibling);}if(o.parentNode!=this.xmlRoot){this.$fixItem(o,r,true);}var s;if(!q.childNodes.length&&(s=this.$applyBindRule("empty",o))){this.$setEmptyMessage(q,s);}this.$fixItem(o,r,true);};this.$moveNode=function(A,w,s){if(!self.apf.debug&&!w){return;}var q;if(this.$hasLoadStatus(A.parentNode,"potential")){q=this.$getLayoutNode("item","container",w);w.parentNode.removeChild(w);q.parentNode.removeChild(q);this.$extend(A.parentNode);return;}var B=w.parentNode,n=this.getTraverseParent(A),o=apf.xmldb.findHtmlNode(A.parentNode,this),C=this.getNextTraverse(A),u=C?apf.xmldb.findHtmlNode(C,this):null,t=o?this.$getLayoutNode("item","container",o):this.$container;q=this.$getLayoutNode("item","container",w);if(t!=B&&this.getTraverseNodes(A.parentNode).length==1){this.$removeEmptyMessage(t);}t.insertBefore(w,u);if(q){t.insertBefore(q,u);}var r;if(!this.getTraverseNodes(s).length&&(r=this.$applyBindRule("empty",s))){this.$setEmptyMessage(B,r);}if(this.openadd&&o!=this.$container&&t.style.display!="block"){this.slideOpen(t,o,true);}this.$fixItem(A,w);this.$fixItem(n,apf.xmldb.findHtmlNode(n,this));this.$updateNode(s,apf.xmldb.findHtmlNode(s,this));if(this.getNextTraverse(A,true)){this.$fixItem(this.getNextTraverse(A,true),apf.xmldb.findHtmlNode(this.getNextTraverse(A,true),this));}};this.$setLoading=function(q,o){this.$setLoadStatus(q,"potential");var n=this.getTraverseNodes(q).length;if(!n||n>20){this.$getNewContext("loading");apf.insertHtmlNode(this.$getLayoutNode("loading"),o);}};this.$removeLoading=function(n){if(!n){return;}this.$getLayoutNode("item","container",n).innerHTML="";};this.$extend=function(q,n,o){var s=this.$getBindRule("insert",q),r=s&&s.match?(s.cmatch||s.compile("match"))(q):q;if(s&&r){this.$setLoadStatus(q,"loading");if(s.get){this.getModel().$insertFrom(s.getAttribute("get"),{xmlNode:r,insertPoint:r,amlNode:this});}else{if(this.$applyBindRule("insert",q)){this.insert(data,{insertPoint:r});}}}else{if(!this.prerender){this.$setLoadStatus(q,"loading");this.$removeLoading(apf.xmldb.findHtmlNode(q,this));k.call(this,{action:"insert",xmlNode:q,result:this.$addNodes(q,n,true),anim:!o});}}};function k(q){if(q.action=="move-away"){this.$fixItem(q.xmlNode,apf.xmldb.findHtmlNode(q.xmlNode,this),true);}if(q.action!="insert"){return;}var o=this.$findHtmlNode(q.xmlNode.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId);if(!o){return;}if(q.action=="insert"&&q.result.length>0){if(this.$hasLoadStatus(q.xmlNode,"loaded")){var n=this.$getLayoutNode("item","container",o);this.slideOpen(n,q.xmlNode);}else{if(this.$hasLoadStatus(q.xmlNode,"potential")){this.$setLoadStatus(q.xmlNode,"loaded");}}}else{this.$fixItem(q.xmlNode,o);}}this.addEventListener("xmlupdate",k);this.addEventListener("beforerename",function(){if(this.$tempsel){clearTimeout(this.timer);this.select(this.$tempsel);this.$tempsel=null;this.timer=null;}});this.addEventListener("keydown",function(H){var J=H.keyCode,s=H.ctrlKey,C=H.shiftKey,G=this.$caret||this.$selected,u,B,r,E,D,I,n,A;if(!G||this.renaming){return;}var o=this.caret||this.selected,q=this.$ext;switch(J){case 13:if(this.$tempsel){this.$selectTemp();}if(this.ctrlselect=="enter"){this.select(this.caret,true);}this.choose(G);break;case 32:if(this.$tempsel){this.$selectTemp();}if(s||!this.isSelected(this.caret)){this.select(this.caret,true);}return false;case 46:if(this.$tempsel){this.$selectTemp();}this.remove(this.caret);break;case 36:this.$setTempSelected(this.getFirstTraverseNode(),false,C);q.scrollTop=0;return false;case 35:var t=this.getLastTraverseNode();while(!this.isCollapsed(t)){t=this.getLastTraverseNode(t);}this.$setTempSelected(t,false,C,true);q.scrollTop=q.scrollHeight;return false;case 37:if(this.$tempsel){this.$selectTemp();}if(this.caret.selectSingleNode(this.each)&&!this.isCollapsed(this.caret)){this.slideToggle(this.$caret||this.$selected,2);}else{if(n=this.getTraverseParent(this.caret)){this.select(n);}}return false;case 107:case 187:case 39:if(this.$tempsel){this.$selectTemp();}if(this.$hasLoadStatus(this.caret,"potential")||this.getFirstTraverseNode(this.caret)){this.slideToggle(this.$caret||this.$selected,1);}break;case 109:case 189:if(this.getFirstTraverseNode(this.caret)){this.slideToggle(this.$caret||this.$selected,2);}break;case 38:if(!o&&!this.$tempsel){return;}E=this.$tempsel?apf.xmldb.getNode(this.$tempsel):o;I=this.getNextTraverse(E,true);if(I){D=this.getTraverseNodes(I);do{A=this.$getLayoutNode("item","container",this.$findHtmlNode(apf.xmldb.getID(I,this)));if(A&&apf.getStyle(A,"display")=="block"&&D.length){I=D[D.length-1];}else{break;}}while(I&&(D=this.getTraverseNodes(I)).length);}else{if(this.getTraverseParent(E)==this.xmlRoot){this.dispatchEvent("selecttop");return;}else{I=this.getTraverseParent(E);}}if(I&&I.nodeType==1){this.$setTempSelected(I,s,C,true);}else{return false;}G=apf.xmldb.findHtmlNode(I,this);B=apf.getAbsolutePosition(G,this.$container)[1]-(G.offsetHeight/2);if(B<=q.scrollTop){q.scrollTop=B;}return false;case 40:if(!o&&!this.$tempsel){return;}E=this.$tempsel?apf.xmldb.getNode(this.$tempsel):o;I=this.getFirstTraverseNode(E);if(I){A=this.$getLayoutNode("item","container",this.$findHtmlNode(apf.xmldb.getID(E,this)));if(A&&apf.getStyle(A,"display")!="block"){I=null;}}while(!I){n=this.getTraverseParent(E);if(!n){break;}var F=0;D=this.getTraverseNodes(n);while(D[F]&&D[F]!=E){F++;}I=D[F+1];E=n;}if(I&&I.nodeType==1){this.$setTempSelected(I,s,C);}else{return false;}G=apf.xmldb.findHtmlNode(I,this);B=apf.getAbsolutePosition(G,this.$container)[1]+(G.offsetHeight/2);if(B>q.scrollTop+q.offsetHeight){q.scrollTop=B-q.offsetHeight;}return false;case 33:u=apf.getAbsolutePosition(this.$container);r=document.elementFromPoint(u[0]+this.$container.offsetWidth-2,u[1]+2);I=apf.xmldb.findXmlNode(r);if(I==this.selected){q.scrollTop-=q.offsetHeight-apf.getHeightDiff(q);r=document.elementFromPoint(u[0]+this.$container.offsetWidth-2,u[1]+2);I=apf.xmldb.findXmlNode(r);}this.select(I);G=apf.xmldb.findHtmlNode(I,this);B=apf.getAbsolutePosition(G,this.$container)[1]-(G.offsetHeight/2);if(B<=q.scrollTop){q.scrollTop=B;}break;case 34:u=apf.getAbsolutePosition(this.$container);r=document.elementFromPoint(u[0]+this.$container.offsetWidth-2,u[1]+this.$ext.offsetHeight-4);I=apf.xmldb.findXmlNode(r);if(I==this.selected){q.scrollTop+=q.offsetHeight-apf.getHeightDiff(q);r=document.elementFromPoint(u[0]+this.$container.offsetWidth-2,u[1]+this.$ext.offsetHeight-4);I=apf.xmldb.findXmlNode(r);}this.select(I);G=apf.xmldb.findHtmlNode(I,this);B=apf.getAbsolutePosition(G,this.$container)[1]+(G.offsetHeight/2);if(B>q.scrollTop+q.offsetHeight){q.scrollTop=B-q.offsetHeight;}break;default:if(this.celledit){if(!s&&!H.altKey&&(J>46&&J<112||J>123)){this.startRename(null,true);}return;}else{if(J==65&&s){this.selectAll();return false;}else{if(this.caption||(this.bindingRules||{})["caption"]){if(!this.xmlRoot){return;}if(!this.lookup||new Date().getTime()-this.lookup.date.getTime()>300){this.lookup={str:"",date:new Date()};}this.lookup.str+=String.fromCharCode(J);var D=this.getTraverseNodes();for(var w,F=0;F<D.length;F++){w=this.$applyBindRule("caption",D[F]);if(w&&w.substr(0,this.lookup.str.length).toUpperCase()==this.lookup.str){if(!this.isSelected(D[F])){if(this.mode=="check"){this.setCaret(D[F]);}else{this.select(D[F]);}}if(G){this.$container.scrollTop=G.offsetTop-(this.$container.offsetHeight-G.offsetHeight)/2;}return;}}return;}}}break;}},true);this.$getCaptionElement=function(){if(!this.$selected){return false;}var n=this.$getLayoutNode("item","caption",this.$selected);return n.nodeType==1?n:n.parentNode;};this.$calcSelectRange=function(q,n){var t=[],u=false,s=0,o=this.hasFeature(apf.__VIRTUALVIEWPORT__)?this.xmlRoot.selectNodes(this.$isTreeArch?this.each:".//"+this.each.split("|").join("|.//")):this.getTraverseNodes();for(;s<o.length;s++){if(o[s]==q){u=true;}if(u){t.push(o[s]);}if(o[s]==n){u=false;}}if(!t.length||u){t=[];for(u=false,s=o.length-1;s>=0;s--){if(o[s]==q){u=true;}if(u){t.push(o[s]);}if(o[s]==n){u=false;}}}return t;};this.$findContainer=function(n){return this.$getLayoutNode("item","container",n);};this.$selectDefault=function(q){if(this.select(this.getFirstTraverseNode(q),null,null,null,true)){return true;}else{var n=this.getTraverseNodes(q);for(var o=0;o<n.length;o++){if(this.$selectDefault(n[o])){return true;}}}};this.$setEmptyMessage=function(r,s){this.$getNewContext("empty");var o=this.$getLayoutNode("empty");if(!o){return;}var q=apf.insertHtmlNode(o,r);q.setAttribute("empty","true");var n=this.$getLayoutNode("empty","caption",q);if(n){apf.setNodeValue(n,s||"");}if(r.style){this.slideOpen(r,null,true);}else{if(this.nocollapse){r.setAttribute("style","display:inline-block;");}else{r.setAttribute("style","overflow:visible;height:auto;display:block;");}}};this.$removeEmptyMessage=function(o){var n=o.firstChild;if(!n){return;}do{if(n.getAttribute("empty")){o.removeChild(n);return;}n=n.nextSibling;}while(n);};this.$drawBase=function(){this.$ext=this.$getExternal();this.$container=this.$getLayoutNode("main","container",this.$ext);this.opencloseaction=this.$getOption("main","openclose");if(apf.hasCssUpdateScrollbarBug&&!this.mode){this.$fixScrollBug();}var n=this;this.$ext.onclick=function(o){n.dispatchEvent("click",{htmlEvent:o||event});};};this.addEventListener("DOMNodeInsertedIntoDocument",function(){if(this.nocollapse){this.startcollapsed=false;}else{if(this.startcollapsed===1){this.startcollapsed=!apf.isFalse(this.$getOption("main","startcollapsed"));}}});this.addEventListener("DOMNodeRemovedFromDocument",function(){this.$ext.onclick=null;apf.destroyHtmlNode(this.oDrag);this.oDrag=null;});}).call(apf.BaseTree.prototype=new apf.MultiSelect());apf.__TRANSACTION__=1<<3;apf.BaseList=function(){this.$init(true);this.$dynCssClasses=[];this.listNodes=[];};(function(){this.implement(apf.DataAction,apf.K);this.$focussable=true;this.$isWindowContainer=-1;this.multiselect=true;this.mode="normal";this.$propHandlers.fill=function(b){if(b){this.loadFillData(this.getAttribute("fill"));}else{this.clear();}};this.$propHandlers.template=function(d){this.$template=typeof d=="object"?d:apf.nameserver.get("template",d);if(!this.$template){var c;apf.addEventListener("parsestop",c=function(){_self.$propHandlers.template.call(_self,d);apf.removeEventListener("parsestop",c);});return;}this.$deInitNode=function(j,k){var g=j.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId;this.$template.destroyInstance(g);if(k){k.parentNode.removeChild(k);}};this.$updateNode=function(g,k,j){};this.$moveNode=function(g,j){};var b=document.createDocumentFragment();this.$add=function(k,j,m,o,g){var n=document.createElement("div");n.setAttribute("id",j);b.appendChild(n);this.$template.getNewInstance(this.$getLayoutNode("item","container",n),j,k,true);};this.$fill=function(){this.$container.appendChild(b);apf.queue.empty();};this.$checkLoadQueue();};this.$keyHandler=function(o){var A=o.keyCode,c=o.ctrlKey,s=o.shiftKey,r=this.$selected||this.$caret;if(o.returnValue==-1||!r||this.renaming){return;}var u=this.caret||this.selected,d=this.$ext,g,j,q,B,t,n,m;switch(A){case 13:if(this.$tempsel){this.$selectTemp();}if(this.ctrlselect=="enter"){this.select(this.caret,true);}this.choose(this.selected);break;case 32:if(c||this.mode!="normal"||!this.isSelected(this.caret)){this.select(this.caret,c);}break;case 109:case 46:if(this.disableremove){return;}if(this.$tempsel){this.$selectTemp();}this.remove(this.mode!="normal"?this.caret:null);break;case 36:if(this.hasFeature(apf.__VIRTUALVIEWPORT__)){this.viewport.change(0,null,true,true);}this.select(this.getFirstTraverseNode(),false,s);this.$container.scrollTop=0;break;case 35:if(this.hasFeature(apf.__VIRTUALVIEWPORT__)){this.viewport.change(this.viewport.length,null,true,true);}this.select(this.getLastTraverseNode(),false,s);this.$container.scrollTop=this.$container.scrollHeight;break;case 107:if(this.more){this.startMore();}break;case 37:if(!u&&!this.$tempsel){return;}g=this.$tempsel?apf.xmldb.getNode(this.$tempsel):u;j=apf.getBox(apf.getStyle(r,"margin"));q=r.offsetWidth?Math.floor((d.offsetWidth-(t?15:0))/(r.offsetWidth+j[1]+j[3])):1;g=this.getNextTraverseSelected(g,false);if(g){this.$setTempSelected(g,c,s,true);}else{return;}r=apf.xmldb.findHtmlNode(g,this);if(r.offsetTop<d.scrollTop){d.scrollTop=Array.prototype.indexOf.call(this.getTraverseNodes(),g)<q?0:r.offsetTop-j[0];}break;case 38:if(!u&&!this.$tempsel){return;}g=this.$tempsel?apf.xmldb.getNode(this.$tempsel):u;j=apf.getBox(apf.getStyle(r,"margin"));t=d.scrollHeight>d.offsetHeight;q=r.offsetWidth?Math.floor((d.offsetWidth-(t?15:0))/(r.offsetWidth+j[1]+j[3])):1;g=this.getNextTraverseSelected(g,false,q);if(g){this.$setTempSelected(g,c,s,true);}else{return;}r=apf.xmldb.findHtmlNode(g,this);if(r.offsetTop<d.scrollTop){d.scrollTop=Array.prototype.indexOf.call(this.getTraverseNodes(),g)<q?0:r.offsetTop-j[0];}break;case 39:if(!u&&!this.$tempsel){return;}g=this.$tempsel?apf.xmldb.getNode(this.$tempsel):u;j=apf.getBox(apf.getStyle(r,"margin"));g=this.getNextTraverseSelected(g,true);if(g){this.$setTempSelected(g,c,s);}else{return;}r=apf.xmldb.findHtmlNode(g,this);if(r.offsetTop+r.offsetHeight>d.scrollTop+d.offsetHeight){d.scrollTop=r.offsetTop-d.offsetHeight+r.offsetHeight+j[0];}break;case 40:if(!u&&!this.$tempsel){return;}g=this.$tempsel?apf.xmldb.getNode(this.$tempsel):u;j=apf.getBox(apf.getStyle(r,"margin"));t=d.scrollHeight>d.offsetHeight;q=r.offsetWidth?Math.floor((d.offsetWidth-(t?15:0))/(r.offsetWidth+j[1]+j[3])):1;g=this.getNextTraverseSelected(g,true,q);if(g){this.$setTempSelected(g,c,s);}else{return;}r=apf.xmldb.findHtmlNode(g,this);if(r.offsetTop+r.offsetHeight>d.scrollTop+d.offsetHeight){d.scrollTop=r.offsetTop-d.offsetHeight+r.offsetHeight+j[0];}break;case 33:if(!u&&!this.$tempsel){return;}g=this.$tempsel?apf.xmldb.getNode(this.$tempsel):u;j=apf.getBox(apf.getStyle(r,"margin"));m=d.scrollHeight>d.offsetHeight;n=d.scrollWidth>d.offsetWidth;q=Math.floor((d.offsetWidth-(m?15:0))/(r.offsetWidth+j[1]+j[3]));B=Math.floor((d.offsetHeight-(n?15:0))/(r.offsetHeight+j[0]+j[2]));g=this.getNextTraverseSelected(g,false,q*B);if(!g){g=this.getFirstTraverseNode();}if(g){this.$setTempSelected(g,c,s,true);}else{return;}r=apf.xmldb.findHtmlNode(g,this);if(r.offsetTop<d.scrollTop){d.scrollTop=Array.prototype.indexOf.call(this.getTraverseNodes(),g)<q?0:r.offsetTop-j[0];}break;case 34:if(!u&&!this.$tempsel){return;}g=this.$tempsel?apf.xmldb.getNode(this.$tempsel):u;j=apf.getBox(apf.getStyle(r,"margin"));m=d.scrollHeight>d.offsetHeight;n=d.scrollWidth>d.offsetWidth;q=Math.floor((d.offsetWidth-(m?15:0))/(r.offsetWidth+j[1]+j[3]));B=Math.floor((d.offsetHeight-(n?15:0))/(r.offsetHeight+j[0]+j[2]));g=this.getNextTraverseSelected(u,true,q*B);if(!g){g=this.getLastTraverseNode();}if(g){this.$setTempSelected(g,c,s);}else{return;}r=apf.xmldb.findHtmlNode(g,this);if(r.offsetTop+r.offsetHeight>d.scrollTop+d.offsetHeight){d.scrollTop=r.offsetTop-d.offsetHeight+r.offsetHeight+j[0];}break;default:if(A==65&&c){this.selectAll();}else{if(this.$hasBindRule("caption")){if(!this.xmlRoot||this.autorename){return;}if(!this.lookup||new Date().getTime()-this.lookup.date.getTime()>300){this.lookup={str:"",date:new Date()};}this.lookup.str+=String.fromCharCode(A);var b=this.getTraverseNodes();for(var w,k=0;k<b.length;k++){w=this.$applyBindRule("caption",b[k]);if(w&&w.substr(0,this.lookup.str.length).toUpperCase()==this.lookup.str){if(!this.isSelected(b[k])){if(this.mode=="check"){this.setCaret(b[k]);}else{this.select(b[k]);}}if(r){this.$container.scrollTop=r.offsetTop-(this.$container.offsetHeight-r.offsetHeight)/2;}return;}}return;}}break;}this.lookup=null;return false;};this.$deInitNode=function(b,c){if(!c){return;}c.parentNode.removeChild(c);};this.$updateNode=function(d,k,g){var c=this.$getLayoutNode("item","icon",k);if(c){if(c.nodeType==1){c.style.backgroundImage="url("+apf.getAbsolutePath(this.iconPath,this.$applyBindRule("icon",d))+")";}else{c.nodeValue=apf.getAbsolutePath(this.iconPath,this.$applyBindRule("icon",d));}}else{var j=this.$getLayoutNode("item","image",k);if(j){if(j.nodeType==1){j.style.backgroundImage="url("+apf.getAbsolutePath(apf.hostPath,this.$applyBindRule("image",d))+")";}else{j.nodeValue=apf.getAbsolutePath(apf.hostPath,this.$applyBindRule("image",d));}}}var m=this.$getLayoutNode("item","caption",k);if(m){if(m.nodeType==1){if(!this.$cbindings.caption||!this.$cbindings.caption.hasAml){m.innerHTML=this.$applyBindRule("caption",d);}}else{m.nodeValue=this.$applyBindRule("caption",d);}}k.title=this.$applyBindRule("title",d)||"";var b=this.$applyBindRule("css",d);if(b||this.$dynCssClasses.length){this.$setStyleClass(k,b,this.$dynCssClasses);if(b&&!this.$dynCssClasses.contains(b)){this.$dynCssClasses.push(b);}}if(!g&&this.$updateModifier){this.$updateModifier(d,k);}};this.$moveNode=function(g,j){if(!j){return;}var b=j.parentNode;var d=this.getNextTraverse(g);var c=d?apf.xmldb.findHtmlNode(d,this):null;b.insertBefore(j,c);};this.$add=function(t,m,o,u,r){this.$getNewContext("item");var k=this.$getLayoutNode("item"),g=this.$getLayoutNode("item","select"),n=this.$getLayoutNode("item","icon"),c=this.$getLayoutNode("item","image"),s=this.$getLayoutNode("item","caption");k.setAttribute("id",m);g.setAttribute("onmouseover","var o = apf.lookup("+this.$uniqueId+"); o.$setStyleClass(this, 'hover', null, true);");g.setAttribute("onselectstart","return false;");g.setAttribute("style",(g.getAttribute("style")||"")+";user-select:none;-moz-user-select:none;-webkit-user-select:none;");if(this.hasFeature(apf.__RENAME__)||this.hasFeature(apf.__DRAGDROP__)){g.setAttribute("ondblclick","var o = apf.lookup("+this.$uniqueId+"); o.stopRename(); o.choose()");g.setAttribute("onmouseout","var o = apf.lookup("+this.$uniqueId+");            	  o.$setStyleClass(this, '', ['hover'], true);                this.hasPassedDown = false;");g.setAttribute(this.itemSelectEvent||"onmousedown","var o = apf.lookup("+this.$uniqueId+');                 var xmlNode = apf.xmldb.findXmlNode(this);                 var isSelected = o.isSelected(xmlNode);                 this.hasPassedDown = true;                 if (!o.renaming && o.hasFocus() && isSelected == 1)                     this.dorename = true;                 if (!o.hasFeature(apf.__DRAGDROP__) || o.mode != "normal" || !isSelected && !event.ctrlKey)                     o.select(this, event.ctrlKey, event.shiftKey, -1)');g.setAttribute("onmouseup","if (!this.hasPassedDown) return;                var o = apf.lookup("+this.$uniqueId+');if (o.hasFeature(apf.__RENAME__) && this.dorename && o.mode == "normal")                    o.startDelayedRename(event, null, true);this.dorename = false;                 var xmlNode = apf.xmldb.findXmlNode(this);                 var isSelected = o.isSelected(xmlNode);                 if (o.mode == "normal" && o.hasFeature(apf.__DRAGDROP__))                     o.select(this, event.ctrlKey, event.shiftKey, -1)');}else{g.setAttribute("onmouseout","apf.setStyleClass(this, '', ['hover']);");g.setAttribute("ondblclick","var o = apf.lookup("+this.$uniqueId+"); o.choose(null, true)");g.setAttribute(this.itemSelectEvent||"onmousedown","var o = apf.lookup("+this.$uniqueId+"); o.select(this, event.ctrlKey, event.shiftKey, -1)");}this.$listGrid=this.$getOption("main","list-mode")=="grid";if(this.$listGrid){k.setAttribute("onmouseover",k.getAttribute("onmouseover")+"var o = apf.lookup("+this.$uniqueId+");o.$selectSeries(event);");}if(n){if(n.nodeType==1){n.setAttribute("style","background-image:url("+apf.getAbsolutePath(this.iconPath,this.$applyBindRule("icon",t))+")");}else{n.nodeValue=apf.getAbsolutePath(this.iconPath,this.$applyBindRule("icon",t));}}else{if(c){if(c.nodeType==1){if((c.tagName||"").toLowerCase()=="img"){c.setAttribute("src",apf.getAbsolutePath(apf.hostPath,this.$applyBindRule("image",t)));}else{c.setAttribute("style","background-image:url("+apf.getAbsolutePath(apf.hostPath,this.$applyBindRule("image",t))+")");}}else{if(apf.isSafariOld){var d=c.ownerElement.parentNode,j=d.appendChild(d.ownerDocument.createElement("img"));j.setAttribute("src",apf.getAbsolutePath(apf.hostPath,this.$applyBindRule("image",t)));}else{c.nodeValue=apf.getAbsolutePath(apf.hostPath,this.$applyBindRule("image",t));}}}}if(s){if(s.nodeType==1&&this.$cbindings.caption&&this.$cbindings.caption.hasAml){var b=(this.$cbindings.queue||(this.$cbindings.queue={}));s.setAttribute("id","placeholder_"+this.$uniqueId+"_"+((b.caption||(b.caption=[])).push(t)-1));apf.setNodeValue(s,"");}else{apf.setNodeValue(s,this.$applyBindRule("caption",t));}}k.setAttribute("title",this.$applyBindRule("tooltip",t)||"");var w=this.$applyBindRule("css",t);if(w){this.$setStyleClass(k,w);if(w){this.$dynCssClasses.push(w);}}if(this.$addModifier){this.$addModifier(t,k);}if(u){apf.insertHtmlNode(k,u,r);}else{this.listNodes.push(k);}};this.$fill=function(){if(this.more&&!this.moreItem){this.$getNewContext("item");var c=this.$getLayoutNode("item"),d=this.$getLayoutNode("item","caption"),b=this.$getLayoutNode("item","select");c.setAttribute("class","more");b.setAttribute("onmousedown","var o = apf.lookup("+this.$uniqueId+');o.clearSelection();o.$setStyleClass(this, "more_down", null, true);');b.setAttribute("onmouseout","apf.lookup("+this.$uniqueId+').$setStyleClass(this, "", ["more_down"], true);');b.setAttribute("onmouseup","apf.lookup("+this.$uniqueId+").startMore(this, true)");if(d){apf.setNodeValue(d,this.more.match(/caption:(.*)(;|$)/i)[1]);}this.listNodes.push(c);}apf.insertHtmlNodes(this.listNodes,this.$container);this.listNodes.length=0;if(this.more&&!this.moreItem){this.moreItem=this.$container.lastChild;}};this.startMore=function(d,c){if(c&&this.disabled){return;}this.$setStyleClass(d,"",["more_down"]);var b;if(!this.$actions.add){if(this.each&&!this.each.match(/[\/\[]/)){b="<"+this.each+(this.each.match(/^a:/)?" xmlns:a='"+apf.ns.aml+"'":"")+" custom='1' />";}else{throw new Error(apf.formatErrorString(0,this,"Could not start more","No add action rule is defined for this component",this.$aml));return false;}}this.add(b,null,null,function(g){this.select(g,null,null,null,null,true);this.$container.appendChild(this.moreItem);var j=function(){this.getActionTracker().undo(this.autoselect?2:1);this.removeEventListener("stoprename",j);this.removeEventListener("beforerename",m);this.removeEventListener("afterrename",k);};var k=function(){this.removeEventListener("afterrename",k);};var m=function(o){this.removeEventListener("stoprename",j);this.removeEventListener("beforerename",m);var n=this.findXmlNodeByValue(o.args[1]);if(n||!o.args[1]){if(o.args[1]&&this.dispatchEvent("notunique",{value:o.args[1]})===false){this.startRename();this.addEventListener("stoprename",j);this.addEventListener("beforerename",m);}else{this.removeEventListener("afterrename",k);this.getActionTracker().undo();if(!this.isSelected(n)){this.select(n);}}return false;}};this.addEventListener("stoprename",j);this.addEventListener("beforerename",m);this.addEventListener("afterrename",k);this.startDelayedRename({},1);});};this.$calcSelectRange=function(d,b){var j=[],c=this.hasFeature(apf.__VIRTUALVIEWPORT__)?this.xmlRoot.selectNodes(this.each):this.getTraverseNodes(),k,g;for(k=false,g=0;g<c.length;g++){if(c[g]==d){k=true;}if(k){j.push(c[g]);}if(c[g]==b){k=false;}}if(!j.length||k){j=[];for(k=false,g=c.length-1;g>=0;g--){if(c[g]==d){k=true;}if(k){j.push(c[g]);}if(c[g]==b){k=false;}}}return j;};this.$selectDefault=function(b){this.select(this.getTraverseNodes()[0],null,null,null,true);};this.loadFillData=function(r){var q,b,g,m=r.splitSafe(","),o=[];for(var c,d,n=0;n<m.length;n++){if((d=m[n]).match(/^\d+-\d+$/)){c=d.split("-");b=parseInt(c[0]);g=parseInt(c[1]);if(c[0].length==c[1].length){q=Math.max(c[0].length,c[1].length);for(var k=b;k<g+1;k++){o.push("<item>"+(k+"").pad(q,"0")+"</item>");}}else{for(var k=b;k<g+1;k++){o.push("<item>"+k+"</item>");}}}else{o.push("<item>"+d+"</item>");}}this.$initingModel=true;this.each="item";this.$setDynamicProperty("caption","[label/text()|@caption|text()]");this.$setDynamicProperty("eachvalue","[value/text()|@value|text()]");this.$canLoadDataAttr=false;this.load("<data>"+o.join("")+"</data>");};}).call(apf.BaseList.prototype=new apf.MultiSelect());apf.__VIRTUALVIEWPORT__=1<<19;apf.BaseStateButtons=function(){this.state="normal";this.edit=false;this.animate=true;var k={min:["minimized","minimize","restore"],max:["maximized","maximize","restore"],edit:["edit","edit","closeedit"],close:["closed","close","show"]};this.$lastheight=null;this.$lastpos=null;this.$lastzindex=null;this.$lastState={normal:true};this.$booleanProperties.animate=true;this.$supportedProperties.push("buttons","animate","state");this.close=function(){this.setProperty("state",this.state.split("|").pushUnique("closed").join("|"),false,true);return this;};this.minimize=function(){this.setProperty("state",this.state.split("|").remove("maximized").remove("normal").pushUnique("minimized").join("|"),false,true);return this;};this.maximize=function(){this.setProperty("state",this.state.split("|").remove("minimized").remove("normal").pushUnique("maximized").join("|"),false,true);return this;};this.restore=function(){this.setProperty("state",this.state.split("|").remove("minimized").remove("maximized").pushUnique("normal").join("|"),false,true);return this;};this.edit=function(m){this.setProperty("state",this.state.split("|").pushUnique("edit").join("|"),false,true);return this;};this.closeedit=function(m){this.setProperty("state",this.state.split("|").remove("edit").join("|"),false,true);return this;};this.$toggle=function(m){var n=k[m][0];this[k[m][this.state.indexOf(n)>-1?2:1]]();};this.$propHandlers.refparent=function(m){if(typeof m=="string"){this.$refParent=self[m]&&self[m].$ext||document.getElementById(m);}else{this.$refParent=m;}};this.$propHandlers.state=function(D,E,K,r){var n=this;if(!this.$amlLoaded){apf.queue.add("state"+this.$uniqueId,function(){n.$propHandlers.state.call(n,D,E);});return;}var I,m,M,F,A,C={},B=D.split("|"),H=this.$lastState,w=[];for(I=0;I<B.length;I++){C[B[I]]=true;}C.value=D;if(!C.maximized&&!C.minimized){C.normal=true;}if(!r&&this.dispatchEvent("beforestatechange",{from:H,to:C})===false){this.state=H.value;return false;}if(C.closed==this.visible){this.setProperty("visible",!C.closed);}if(C.normal!=H.normal||!C.normal&&(C.minimized!=H.minimized||C.maximized!=H.maximized)){if(this.$lastheight){this.$ext.style.height=this.$lastheight;}if(this.$lastpos){if(this.animate&&!E){var u=this.$ext;M=apf.getStyle(u,"position");if(M!="absolute"){F=parseInt(apf.getStyle(u,"left"))||0;A=parseInt(apf.getStyle(u,"top"))||0;}else{F=u.offsetLeft;A=u.offsetTop;}this.animstate=1;apf.tween.multi(u,{steps:5,interval:10,tweens:[{type:"left",from:F,to:this.$lastpos.px[0]},{type:"top",from:A,to:this.$lastpos.px[1]},{type:"width",from:this.$ext.offsetWidth-j,to:this.$lastpos.px[2]},{type:"height",from:this.$ext.offsetHeight-c,to:this.$lastpos.px[3]}],oneach:function(){if(apf.hasSingleRszEvent){apf.layout.forceResize(n.$int);}},onfinish:function(){n.$propHandlers.state.call(n,D,true,null,true);}});return;}this.$ext.style.left=this.$lastpos.css[0];this.$ext.style.top=this.$lastpos.css[1];this.$ext.style.width=this.$lastpos.css[2];this.$ext.style.height=this.$lastpos.css[3];m=this.$lastpos.parentNode;m.style.width=this.$lastpos.parent[0];m.style.height=this.$lastpos.parent[1];m.style.overflow=this.$lastpos.parent[2];}if(this.aData&&this.aData.restore){this.aData.restore();}if(apf.layout){apf.layout.play(this.$pHtmlNode);}if(this.$lastzindex){this.$ext.style.zIndex=this.$lastzindex[0];if(this.oCover){this.oCover.style.zIndex=this.$lastzindex[1];}}this.$lastheight=this.$lastpos=this.$lastzindex=null;if(C.normal){w.push("",this.$baseCSSname+"Max",this.$baseCSSname+"Min");}}if(C.minimized!=H.minimized){if(C.minimized){w.unshift(this.$baseCSSname+"Min",this.$baseCSSname+"Max",this.$baseCSSname+"Edit");if(this.aData&&this.aData.minimize){this.aData.minimize(this.collapsedHeight);}if(!this.aData||!this.aData.minimize){this.$lastheight=apf.getStyle(this.$ext,"height");this.$ext.style.height=Math.max(0,this.collapsedHeight-apf.getHeightDiff(this.$ext))+"px";}if(this.hasFocus()){apf.window.moveNext(null,this,true);}}else{w.push(this.$baseCSSname+"Min");$setTimeout(function(){apf.window.$focusLast(n);});}}if(C.maximized!=H.maximized){if(C.maximized){w.unshift(this.$baseCSSname+"Max",this.$baseCSSname+"Min",this.$baseCSSname+"Edit");m=this.$refParent;if(!m){m=(this.$ext.offsetParent==document.body?document.documentElement:this.$ext.parentNode);}n.animstate=0;var L=false,u=this.$ext;var M=apf.getStyle(u,"position");if(M=="absolute"){m.style.overflow="hidden";F=u.offsetLeft;A=u.offsetTop;}else{var q=apf.getAbsolutePosition(u,m);F=q[0];A=q[1];}this.$lastpos={css:[this.$ext.style.left,this.$ext.style.top,this.$ext.style.width,this.$ext.style.height],px:[F,A,this.$ext.offsetWidth-j,this.$ext.offsetHeight-c],parent:[m.style.width,m.style.height,m.style.overflow],parentNode:m};var G=[u.offsetWidth,u.offsetHeight];function J(){var o=!apf.isIE&&m==document.documentElement?window.innerWidth:m.offsetWidth,s=!apf.isIE&&m==document.documentElement?window.innerHeight:m.offsetHeight;if(M!="absolute"){var O=apf.getDiff(m);o-=O[0]+(!n.$refParent&&apf.isIE8?4:0);s-=O[0]+(!n.$refParent&&apf.isIE8?4:0);}else{if(!n.$refParent&&apf.isIE8){o-=4;s-=4;}}var N=n.$refParent?[0,0,0,0]:g,P=m!=u.offsetParent?apf.getAbsolutePosition(m,u.offsetParent):[0,0],t=apf.getDiff(m);m.style.width=(m.offsetWidth-t[0])+"px";m.style.height=(m.offsetHeight-t[1])+"px";if(n.animate&&!L){n.animstate=1;L=true;apf.tween.multi(u,{steps:5,interval:10,tweens:[{type:"left",from:F,to:P[0]-N[3]},{type:"top",from:A,to:P[1]-N[0]},{type:"width",from:G[0]-j,to:(o-j+N[1]+N[3])},{type:"height",from:G[1]-c,to:(s-c+N[0]+N[2])}],oneach:function(){if(apf.hasSingleRszEvent){apf.layout.forceResize(n.$int);}},onfinish:function(){n.animstate=0;n.dispatchEvent("afterstatechange",{from:H,to:C});}});}else{if(!n.animstate){u.style.left=(P[0]-N[3])+"px";u.style.top=(P[1]-N[0])+"px";u.style.width=(o-j+N[1]+N[3])+"px";u.style.height=(s-c+N[0]+N[2])+"px";}}}if(apf.layout){apf.layout.pause(this.$pHtmlNode,J);}this.$lastzindex=[this.$ext.style.zIndex||1,this.oCover&&this.oCover.style.zIndex||1];if(this.oCover){this.oCover.style.zIndex=apf.WinServer.count+1;}this.$ext.style.zIndex=apf.WinServer.count+2;}else{w.push(this.$baseCSSname+"Max");}}if(C.edit!=H.edit){if(C.edit){w.unshift(this.$baseCSSname+"Edit",this.$baseCSSname+"Max",this.$baseCSSname+"Min");if(this.btnedit){d.edit.innerHTML="close";}this.dispatchEvent("editstart");}else{if(this.dispatchEvent("editstop")===false){return false;}w.push(this.$baseCSSname+"Edit");if(w.length==1){w.unshift("");}if(this.btnedit){d.edit.innerHTML="edit";}}}if(w.length||C.closed!=H.closed){if(w.length){this.$setStyleClass(this.$ext,w.shift(),w);}if(C.edit){this.dispatchEvent("prop.visible",{value:true});if(n.oSettings){apf.layout.forceResize(n.oSettings);}}if(!C.maximized||H.maximized&&n.animate){n.dispatchEvent("afterstatechange",{from:H,to:C});}this.$lastState=C;if(this.aData&&!C.maximized){this.$purgeAlignment();}if(!this.animate&&apf.hasSingleRszEvent&&apf.layout){apf.layout.forceResize(n.$int);}}};var g,j,c,d={};this.$propHandlers.buttons=function(s){if(apf.isIphone){return;}if(!this.$hasLayoutNode("button")){return;}var q=s&&(s=s.replace(/(\|)\||\|$/,"$1")).split("|")||[],m=this.$buttons.childNodes,u=s&&new RegExp("("+s+")"),w={},t=[];for(var o=0;o<m.length;o++){if(m[o].nodeType!=1||m[o].tagName!="DIV"){continue;}if(m[o].getAttribute("button")&&(!s||!m[o].className||!m[o].className.match(u))){m[o].style.display="none";this.$setStyleClass(m[o],"",["min","max","close","edit"]);t.push(m[o]);}else{w[RegExp.$1]=m[o];}}for(o=0;o<q.length;o++){if(!q[o]){continue;}if(w[q[o]]){this.$buttons.insertBefore(w[q[o]],this.$buttons.firstChild);continue;}var n=t.pop();if(!n){this.$getNewContext("button");n=this.$getLayoutNode("button");n.setAttribute("button","button");b.call(this,n);n=apf.insertHtmlNode(n,this.$buttons);}this.$setStyleClass(n,q[o],["min","max","close","edit"]);n.onclick=new Function("apf.lookup("+this.$uniqueId+").$toggle('"+q[o]+"')");n.style.display="block";d[q[o]]=n;this.$buttons.insertBefore(n,this.$buttons.firstChild);}var r=apf.getDiff(this.$ext);j=r[0];c=r[1];g=apf.getBox(apf.getStyle(this.$ext,"borderWidth"));};function b(m){m.setAttribute("onmousedown","var o = apf.all["+this.$uniqueId+"];             o.$setStyleClass(this, 'down', null, true);             apf.cancelBubble(event, o);              var o = apf.findHost(this).$ext;             if (o.onmousedown) o.onmousedown(event);             apf.cancelBubble(event, o);             apf.window.$mousedown(event);");m.setAttribute("onmouseup","var o = apf.all["+this.$uniqueId+"];             o.$setStyleClass(this, '', ['down'], true);");m.setAttribute("onmouseover","var o = apf.all["+this.$uniqueId+"];             o.$setStyleClass(this, 'hover', null, true);");m.setAttribute("onmouseout","var o = apf.all["+this.$uniqueId+"];             o.$setStyleClass(this, '', ['hover', 'down'], true);");}this.$initButtons=function(r){this.collapsedHeight=this.$getOption("Main","collapsed-height");var q=this.$getLayoutNode("main","buttons",r);if(!q||apf.isIphone||!this.getAttribute("buttons")||!this.$hasLayoutNode("button")){return;}var m=(this.getAttribute("buttons")||"").split("|").length;for(var o,n=0;n<m;n++){this.$getNewContext("button");o=q.appendChild(this.$getLayoutNode("button"));o.setAttribute("button","button");b.call(this,o);}};this.addEventListener("DOMNodeRemovedFromDocument",function(n){for(var m in d){d[m].onclick=null;}});};apf.Teleport=function(){this.$init(true);};apf.__TELEPORT__=1<<28;(function(){this.$parsePrio="002";this.$regbase=this.$regbase|apf.__TELEPORT__;this.$booleanProperties.autoroute=true;this.$supportedProperties.push("url","timeout","protocol","route-server","autoroute");this.$propHandlers.url=function(c){var b=new apf.url(c);if(!b.protocol){throw new Error(apf.formatErrorString(0,this,"Communication (Teleport) initialization error","Invalid server url provided."));}this.$domain=b.host;this.$rootPath=b.path;this.$server=c.replace(new RegExp(this.$rootPath+"$"),"");};this.$propHandlers.timeout=function(b){this.timeout=parseInt(b)||10000;};this.$propHandlers.protocol=function(c){var b=c.toLowerCase();if(!apf[b]){throw new Error(apf.formatErrorString(1025,null,"Teleport baseclass","Could not find Ajax.org Teleport RPC Component '"+b+"'",this));}this.implement(apf[b]);};this.toString=function(){return"[Ajax.org Teleport Component : "+(this.name||"")+" ("+this.type+")]";};this.addEventListener("DOMNodeInsertedIntoDocument",function(){if(!apf.http){throw new Error(apf.formatErrorString(1024,null,"Teleport baseclass","Could not find Ajax.org Teleport HTTP Component",this.$aml));}this.implement(apf.http);if(this.id){apf.$asyncObjects[this.id]=1;}});}).call(apf.Teleport.prototype=new apf.AmlElement());apf.Init.run("teleport");apf.__INTERACTIVE__=1<<21;apf.Interactive=function(){var q,o,Z,X,d,L=null,Y,Q,T,ag,G,R,ai,u,M,ab,g,ad,c,B,k,F,P,O,aa,s=this,ac,W,V,J,S,A,j;this.$regbase=this.$regbase|apf.__INTERACTIVE__;this.$propHandlers.draggable=function(r){if(apf.isFalse(r)){this.draggable=r=false;}else{if(apf.isTrue(r)){this.draggable=r=true;}}var t=this.editable?this.$ext:this.oDrag||this.$ext;if(t.interactive&1){return;}var b=t.onmousedown;t.onmousedown=function(aj,w){if(!s.editable&&b&&b.apply(this,arguments)===false){return;}if(!w&&(aj||event).button==2){return;}m.apply(this,arguments);};t.interactive=(t.interactive||0)+1;};this.$propHandlers.resizable=function(t){if(apf.isFalse(t)){this.resizable=t=false;}else{if(apf.isTrue(t)){this.resizable=t=true;}}this.$ext.style.cursor="";var w=this.oResize||this.$ext;if(w.interactive&2){return;}if(!s.editable){var b=w.onmousedown;var r=w.onmousemove;w.onmousedown=function(){if(b&&b.apply(this,arguments)===false){return;}K.apply(this,arguments);};w.onmousemove=function(){if(r&&r.apply(this,arguments)===false){return;}E.apply(this,arguments);};}w.interactive=(w.interactive||0)+2;k=this.$getOption&&parseInt(this.$getOption("Main","resize-border"))||3;F=this.$getOption&&parseInt(this.$getOption("Main","resize-corner"))||12;P=apf.getBox(apf.getStyle(this.$ext,apf.isIE?"borderWidth":"border-width"));};this.$cancelInteractive=function(){document.onmouseup(null,true);};function m(t,r){if(!t){t=event;}if(!r&&(!s.draggable||apf.dragMode)){return;}S=false;if(s.dispatchEvent("beforedragstart",{htmlEvent:t})===false){return;}apf.dragMode=true;if(r){s.dispatchEvent("beforedrag");J=true;}else{J=false;}apf.popup.forceHide();ac="absolute|fixed".indexOf(apf.getStyle(s.$ext,"position"))>-1;if(!ac){s.$ext.style.position=ac?"absolute":"relative";}if(s.editable){ac=true;}if(ac&&!s.aData){apf.plane.show(S?oOutline:s.$ext);}var b=(r||oOutline.self)&&S?oOutline:s.$ext;var w=ac?apf.getAbsolutePosition(b,b.offsetParent,true):[parseInt(apf.getStyle(b,"left"))||0,parseInt(apf.getStyle(b,"top"))||0];q=w[0]-(W=t.clientX);o=w[1]-(V=t.clientY);if(!(r||oOutline.self)){if(s.$ext.style.right){s.$ext.style.left=w[0]+"px";s.$ext.style.right="";}if(s.$ext.style.bottom){s.$ext.style.top=w[1]+"px";s.$ext.style.bottom="";}}document.onmousemove=n;document.onmouseup=function(al,aj){document.onmousemove=document.onmouseup=null;if(ac&&!s.aData){apf.plane.hide();}var ak=S?oOutline:s.$ext;if(J&&!s.$multidrag){if(aj){Y=s.left;Q=s.top;T=s.right;ag=s.bottom;M=s.width;ab=s.height;}if(s.setProperty){U();}else{if(S){s.$ext.style.left=Y+"px";s.$ext.style.top=Q+"px";}}}Y=Q=M=ab=null;if(!ac){s.$ext.style.position="relative";}if(s.showdragging){apf.setStyleClass(s.$ext,"",["dragging"]);}if(ac&&S&&!oOutline.self){oOutline.style.display="none";}apf.dragMode=false;if(s.dispatchEvent&&J){s.dispatchEvent("afterdrag",{htmlNode:ak});}};if(r){document.onmousemove(t);}return false;}function n(w){if(!w){w=event;}if(!J&&s.showdragging){apf.setStyleClass(s.$ext,"dragging");}var r=w.clientX-W,b=w.clientY-V,ak;if(!J&&(ak=r*r>b*b?r:b)*ak<2){return;}else{if(!J){if(S&&oOutline.style.display!="block"){oOutline.style.display="block";}if(s.dispatchEvent&&s.dispatchEvent("beforedrag")===false){document.onmouseup();return;}}}var t=S?oOutline:s.$ext;t.style.left=(Y=w.clientX+q)+"px";t.style.top=(Q=w.clientY+o)+"px";if(s.realtime){var aj=s.$stick={};s.$showDrag(Y,Q,t,w,aj);if(typeof aj.l!="undefined"){Y=aj.l,t.style.left=Y+"px";}if(typeof aj.t!="undefined"){Q=aj.t,t.style.top=Q+"px";}}J=true;}this.$resizeStart=K;function K(al,w){if(!al){al=event;}if(!s.resizable||String(s.height).indexOf("%")>-1&&s.parentNode.localName=="vbox"||String(s.width).indexOf("%")>-1&&s.parentNode.localName=="hbox"){return;}A=false;if(!A){var ak=apf.getDiff(s.$ext);aa=ak[0];O=ak[1];}d=apf.getAbsolutePosition(s.$ext);d.push(s.$ext.offsetWidth);d.push(s.$ext.offsetHeight);j=apf.getAbsolutePosition(s.$ext,s.$ext.offsetParent,true);var t=0,r=0,b=(W=al.clientX)-d[0]+t+document.documentElement.scrollLeft,am=(V=al.clientY)-d[1]+r+document.documentElement.scrollTop,aj;if(w&&w.resizeType){ac="absolute|fixed".indexOf(apf.getStyle(s.$ext,"position"))>-1;aj=w.resizeType;}else{aj=N.call(s.$ext,b,am);}Z=b;X=am;if(!aj){return;}if(s.dispatchEvent&&s.dispatchEvent("beforeresize",{type:aj,setType:function(an){aj=an;}})===false){return;}apf.popup.forceHide();apf.dragMode=true;J=false;g=aj.indexOf("w")>-1;ad=aj.indexOf("n")>-1;c=aj.indexOf("e")>-1;B=aj.indexOf("s")>-1;if(!s.minwidth){s.minwidth=0;}if(!s.minheight){s.minheight=0;}if(!s.maxwidth){s.maxwidth=10000;}if(!s.maxheight){s.maxheight=10000;}if(ac){G=j[0]+d[2];R=j[1]+d[3];ai=j[0]+d[2];u=j[1]+d[3];}if(ac){apf.plane.show(A?oOutline:s.$ext);}if(s.$ext.style.right){s.$ext.style.left=j[0]+"px";}if(s.$ext.style.bottom){s.$ext.style.top=j[1]+"px";}if(!w||!w.nocursor){if(L===null){L=document.body.style.cursor;}document.body.style.cursor=aj+"-resize";}document.onmousemove=C;document.onmouseup=function(ap,an){document.onmousemove=document.onmouseup=null;if(ac){apf.plane.hide();}clearTimeout(I);if(A){var ao=apf.getDiff(s.$ext);aa=ao[0];O=ao[1];}if(an){Y=s.left;Q=s.top;T=s.right;ag=s.bottom;M=s.width;ab=s.height;}else{af(ap||event,true);}if(s.setProperty){U();}document.body.style.cursor=L||"";L=null;if(A){oOutline.style.display="none";}apf.dragMode=false;if(s.dispatchEvent){s.dispatchEvent("afterresize",{l:Y,t:Q,w:M+aa,h:ab+O});}Y=Q=M=ab=null;};return false;}function U(aj,al,t,aq,am,ak,ap,b){if(typeof aj=="undefined"){aj=Y,al=Q,t=M,aq=ab,ak=O,am=aa;}else{ac=true;}var ao=s.left||s.left===0;var ar=s.right||s.right===0;var r=s.bottom||s.bottom===0;var w=s.top||s.top===0;if(ac){var an=oOutline.style.display=="block"?oOutline:s.$ext;if(ar&&!(ap||ap===0)){ap=apf.getHtmlRight(an);}if(r&&!(b||b===0)){b=apf.getHtmlBottom(an);}if(ar){s.setProperty("right",ap,0,s.editable);if(!s.left){an.style.left="";}}if(r){s.setProperty("bottom",b,0,s.editable);if(!s.top){an.style.top="";}}if((aj||aj===0)&&(!ar||ao)){s.setProperty("left",aj,0,s.editable);}if((al||al===0)&&(!r||w)){s.setProperty("top",al,0,s.editable);}}if(t&&(!ao||!ar)){s.setProperty("width",t+am,0,s.editable);}if(aq&&(!s.top||!r)){s.setProperty("height",aq+ak,0,s.editable);}}this.$updateProperties=U;var ae=Math.min,D=Math.max,ah,I;function C(b){if(!b){b=event;}clearTimeout(I);if(ah&&new Date().getTime()-ah<(A?6:apf.mouseEventBuffer)){var r={clientX:b.clientX,clientY:b.clientY};I=setTimeout(function(){af(r);},10);return;}ah=new Date().getTime();af(b);}function af(aj,w){var t=A&&!w?oOutline:s.$ext;var r=document.documentElement.scrollLeft,b=document.documentElement.scrollTop;if(g){if(ac){t.style.left=(Y=D((ai-s.maxwidth),ae((G-s.minwidth),j[0]+aj.clientX-W+r)))+"px";}t.style.width=(M=ae(s.maxwidth-aa,D(aa,s.minwidth,d[2]-(aj.clientX-W)+r)-aa))+"px";}if(ad){if(ac){t.style.top=(Q=D((u-s.maxheight),ae((R-s.minheight),j[1]+aj.clientY-V+b)))+"px";}t.style.height=(ab=ae(s.maxheight-O,D(O,s.minheight,d[3]-(aj.clientY-V)+b)-O))+"px";}if(c){t.style.width=(M=ae(s.maxwidth-aa,D(aa,s.minwidth,aj.clientX-d[0]+(d[2]-Z)+r)-aa))+"px";}if(B){t.style.height=(ab=ae(s.maxheight-O,D(O,s.minheight,aj.clientY-d[1]+(d[3]-X)+b)-O))+"px";}if(s.parentNode&&s.parentNode.localName=="table"){U();apf.layout.processQueue();}if(s.realtime){var ak=s.$stick={};s.$showResize(Y||apf.getHtmlLeft(t),Q||apf.getHtmlTop(t),M&&M+aa||t.offsetWidth,ab&&ab+O||t.offsetHeight,aj,ak,g,ad,c,B);if(ac&&g&&typeof ak.l!="undefined"){t.style.left=(Y=D((ai-s.maxwidth),ae((G-s.minwidth),ak.l)))+"px";}if(ac&&ad&&typeof ak.t!="undefined"){t.style.top=(Q=D((u-s.maxheight),ae((R-s.minheight),ak.t)))+"px";}if(typeof ak.w!="undefined"){t.style.width=(M=ae(s.maxwidth-aa,D(aa,s.minwidth,ak.w)-aa))+"px";}if(typeof ak.h!="undefined"){t.style.height=(ab=ae(s.maxheight-O,D(O,s.minheight,ak.h)-O))+"px";}}if(apf.hasSingleRszEvent){apf.layout.forceResize(s.$int);}}function N(b,w){var t="",r="";ac="absolute|fixed".indexOf(apf.getStyle(s.$ext,"position"))>-1;if(s.resizable==true||s.resizable=="vertical"){if(w<k+P[0]){t=ac?"n":"";}else{if(w>this.offsetHeight-k){t="s";}else{if(w>this.offsetHeight-F){r="s";}}}}if(s.resizable==true||s.resizable=="horizontal"){if(b<(t?F:k)+P[0]){t+=r+(ac?"w":"");}else{if(b>this.offsetWidth-(t||r?F:k)){t+=r+"e";}}}return t;}var H;function E(w){if(!w){w=event;}if(!s.resizable||s.editable||document.onmousemove){return;}var al=apf.getAbsolutePosition(s.$ext),t=0,r=0,b=w.clientX-al[0]+t+document.documentElement.scrollLeft,ak=w.clientY-al[1]+r+document.documentElement.scrollTop;if(!H){H=apf.getStyle(this,"cursor");}var aj=N.call(s.$ext,b,ak);this.style.cursor=aj?aj+"-resize":H||"default";}};apf.GuiElement.propHandlers.resizable=function(b){this.implement(apf.Interactive);this.$propHandlers.resizable.apply(this,arguments);};apf.GuiElement.propHandlers.draggable=function(b){this.implement(apf.Interactive);this.$propHandlers.draggable.apply(this,arguments);};apf.__DELAYEDRENDER__=1<<11;apf.DelayedRender=function(){this.$regbase=this.$regbase|apf.__DELAYEDRENDER__;this.$rendered=false;this.$render=function(c){if(this.$rendered){return;}if(this.dispatchEvent("beforerender")===false){return;}if(this["render-delay"]||c){$setTimeout("apf.lookup("+this.$uniqueId+").$renderparse()",10);}else{this.$renderparse();}};this.$renderparse=function(){if(this.$rendered){return;}var c=this.ownerDocument.$domParser;c.parseFromXml(this.$aml,{amlNode:this,doc:this.ownerDocument,delayedRender:true});c.$continueParsing(this);this.$rendered=true;this.dispatchEvent("afterrender");};var b;this.addEventListener("prop.visible",b=function(){if(arguments[0].value){this.$render();this.removeEventListener("prop.visible",b);}});};apf.GuiElement.propHandlers.render=function(b){if(!this.hasFeature(apf.__DELAYEDRENDER__)&&b=="runtime"){this.implement(apf.DelayedRender);if(this.localName!="page"){this.visible=false;this.$ext.style.display="none";}if(typeof this["render-delay"]=="undefined"){this.$setInheritedAttribute("render-delay");}}};apf.config.$inheritProperties["render-delay"]=1;apf.__DRAGDROP__=1<<5;apf.DragDrop=function(){this.$regbase=this.$regbase|apf.__DRAGDROP__;this.$dragInited=false;this.copy=function(k,n,j,g){if(k.nodeType){k=[k];}var d,o=[],m=0,c=k.length;for(;m<c;m++){o.push({action:g?"moveNode":"appendChild",args:[n,g?k[m]:k[m]=k[m].cloneNode(true),j]});}if(this.$actions[(g?"movegroup":"copygroup")]){d=this.$executeAction("multicall",o,(g?"movegroup":"copygroup"),k[0]);}else{d=this.$executeAction("multicall",o,(g?"move":"copy"),k[0],null,null,k.length>1?k:null);}if(d!==false){return k;}return false;};this.move=function(d,g,c){return this.copy(d,g,c,true);};this.isDragAllowed=function(g,n){if(this.disabled||!g||!g.length||!g[0]){return false;}if(this.drag||this.dragcopy){if(n){n.merge(g);}return true;}var o,c=[],m=0,k=g.length;for(;m<k;m++){o=this.$getDataNode("drag",g[m],null,c);if(!o){return false;}if(n){n.push(o);}}return c.length?c:false;};this.isDropAllowed=function(s,o){if(this.disabled||!s||!s.length||!o){return false;}var m,d,n=this.$attrBindings&&this.$attrBindings.drop;if(this.drop&&(!n||n.value=="true")){this.$setDynamicProperty("drop",this.hasFeature(apf.__MULTISELECT__)?"["+this.each+"]":"[node()]");n=true;}if(n){for(var g=0,c=s.length;g<c;g++){m=this.$getDataNode("drop",s[g]);if(!m){break;}}if(g==c&&o&&!apf.isChildOf(m,o,true)){return[o,null];}}var u=this.$bindings.drop;if(!u||!u.length){return false;}var r,t,k=0,q=u.length;for(;k<q;k++){r=this.$bindings.getRuleIndex("drop",k);for(var g=0,c=s.length;g<c;g++){m=r.cvalue?r.cvalue(s[g]):r.cmatch(s[g]);if(!m){break;}}if(g!=c){continue;}t=r.target;if(!t||t=="."){d=o;}else{d=(r.ctarget||r.compile("target"))(o);}if(d&&!apf.isChildOf(m,d,true)){return[d,r];}}return false;};this.$dragDrop=function(A,g,t,u,r,w,c){if(n=="tree-append"&&r){return false;}var n=t&&t.action;if(n){n=(t.caction||t.compile("action"))(g[0]);}else{n=u;}var d={internal:apf.DragServer.dragdata.host==this,ctrlKey:c.ctrlKey,keyCode:c.keyCode},q=t&&t.copy;if(q){q=!apf.isFalse((t.ccopy||t.compile("copy"))(g[0],d));}else{if(typeof this.dragcopy=="boolean"||typeof this.dropcopy=="boolean"){if(this.dropcopy){q=this.dropcopy;}else{if(this.dragcopy){q=c.ctrlKey;}else{var k=this.$attrBindings&&this.$attrBindings.dragcopy;if(k){q=!apf.isFalse((k.cvalue2||k.compile("value",{withopt:true}))(g[0],d));}}}}}if(!q){for(var o=0,j=w.length;o<j;o++){q=typeof w[o]=="object"&&w[o].copy?!apf.isFalse((w[o].ccopy||w[o].compile("copy"))(g[0],d)):c.ctrlKey;if(q){break;}}}var s,B=q?"copy":"move",m=t?t.getAttribute("parent"):null;switch(n){case"list-append":A=(r?A:this.getTraverseParent(A));if(m){if(A.selectSingleNode(m)){A=A.selectSingleNode(m);}else{A.appendChild(A.ownerDocument.createElement(m));A=A.selectSingleNode(m);}}s=this[B](g,A);break;case"insert-before":s=r?this[B](g,A):this[B](g,A.parentNode,A);break;case"tree-append":if(m){if(A.selectSingleNode(m)){A=A.selectSingleNode(m);}else{A.appendChild(A.ownerDocument.createElement(m));A=A.selectSingleNode(m);}}s=this[B](g,A);break;}if(this.selectable&&s){this.selectList(s);this.setCaret(s[0]);this.focus();}return s;};this.enableDragDrop=function(){apf.console.info("Initializing Drag&Drop for "+this.localName+"["+(this.name||"")+"]");this.icoAllowed="";this.icoDenied="";this.$ext.dragdrop=false;var c=this;this.$ext[apf.isIphone?"ontouchstart":"onmousedown"]=function(n){if(c.disabled){return;}n=n||window.event;if(apf.isIphone){if(n.touches.length==1){return;}var m=n;n=n.touches[0];var o=apf.getAbsolutePosition(n.target,this);n.offsetX=o[0];n.offsetY=o[1];}var k,g=n.originalTarget||n.srcElement||n.target,d=c.hasFeature(apf.__MULTISELECT__);if(d&&g==c.$container){return;}c.dragging=0;if(!apf.isIphone&&c.allowdeselect&&(g==this||g.getAttribute(apf.xmldb.htmlIdTag)&&c.$getLayoutNode("item","select",this)!=this)){return c.clearSelection();}if(c.$findValueNode){k=c.$findValueNode(g);}var j=(k?apf.xmldb.getNode(k):apf.xmldb.findXmlNode(g));if(d&&(!c.selected||!j||j==c.xmlRoot)){return;}if(c.isDragAllowed(d?c.$getSelection():j)){if(apf.isIphone){m.preventDefault();}apf.DragServer.start(c,g,n);}};this.$ext[apf.isIphone?"ontouchmove":"onmousemove"]=function(d){if(this.host.dragging!=1||c.disabled){return;}};if(apf.isIphone){this.$ext.ontouchend=this.$ext.ontouchcancel=function(){if(c.disabled){return;}this.host.dragging=0;};}else{this.$ext.onmouseup=function(){if(c.disabled){return;}this.host.dragging=0;};this.$ext.ondragcopy=this.$ext.ondragstart=function(){return false;};}if(document.elementFromPointAdd){document.elementFromPointAdd(this.$ext);}if(this.$initDragDrop&&!this.$dragInited){this.$initDragDrop();this.$dragInited=2;}else{this.$dragInited=true;}};function b(){this.$dragInited=false;if(apf.isIphone){this.$ext.ontouchstart=this.$ext.ontouchmove=this.$ext.ontouchend=this.$ext.ontouchcancel=null;}else{this.$ext.onmousedown=this.$ext.onmousemove=this.$ext.onmouseup=null;}if(document.elementFromPointRemove){document.elementFromPointRemove(this.$ext);}}this.implement(this.hasFeature(apf.__MULTISELECT__)?apf.MultiselectDragDrop:apf.StandardDragDrop);this.$supportedProperties.push("drop","drag","dragcopy");this.$propHandlers.dragcopy=this.$propHandlers.dropcopy=this.$propHandlers.drag=this.$propHandlers.drop=function(c,d){this[d]=apf.isTrue(c);if(this.$dragInited&&d=="drag"&&c&&this.$dragInited!=2){this.$initDragDrop();this.$dragInited=2;return;}if(d=="dragcopy"||d=="dropcopy"){return;}if(!c&&!this.drag&&!this.drop&&!this.$bindings&&(this.$attrBindings&&(!this.$attrBindings.drag||!this.$attrBindings.drop))){b.call(this);}else{if(c&&!this.$dragInited){this.enableDragDrop();}}};this.addEventListener("DOMNodeRemovedFromDocument",function(c){b.call(this);if(this.oDrag){apf.destroyHtmlNode(this.oDrag);this.oDrag=null;}});};apf.GuiElement.propHandlers.dragcopy=apf.GuiElement.propHandlers.dropcopy=apf.GuiElement.propHandlers.drop=apf.GuiElement.propHandlers.drag=function(b,c){if(!apf.isFalse(b)){if(!this.hasFeature(apf.__DRAGDROP__)){this.implement(apf.DragDrop);this.enableDragDrop();}this[c]=apf.isTrue(b);}};apf.DragServer={Init:function(){if(apf.isIphone){this.ontouchmove=this.onmousemove;this.ontouchend=this.ontouchcancel=this.onmouseup;}apf.addEventListener("hotkey",function(b){if(apf.window.dragging&&b.keyCode==27){if(document.body.lastHost&&document.body.lastHost.dragOut){document.body.lastHost.dragOut(apf.dragHost);}return apf.DragServer.stopdrag();}});},start:function(m,c,o){if(document.elementFromPointReset){document.elementFromPointReset();}m.dragging=1;var q=window.document;q=(!q.compatMode||q.compatMode=="CSS1Compat")?q.html||q.documentElement:q.body;var u=(apf.isIE?q.scrollLeft:window.pageXOffset),t=(apf.isIE?q.scrollTop:window.pageYOffset),b=m.$ext.offsetParent,r;while(b&&b!=q&&b.tagName!="BODY"){u-=b.scrollLeft;t-=b.scrollTop;b=b.offsetParent;}var k=c,j;while(k&&k.nodeType==1&&!(j=k.getAttribute(apf.xmldb.htmlIdTag))){k=k.parentNode;}if(!j){return;}r=apf.getAbsolutePosition(k);apf.DragServer.coordinates={srcElement:c,doc:q,scrollX:u,scrollY:t,offsetX:o.clientX-r[0],offsetY:o.clientY-r[1],clientX:o.pageX?o.pageX-window.pageXOffset:o.clientX,clientY:o.pageY?o.pageY-window.pageYOffset:o.clientY};var s=m.hasFeature(apf.__MULTISELECT__)?m.getSelection():[m.xmlRoot],n=[],g=m.isDragAllowed(s,n);if(!g){return;}if(m.hasEventListener("dragdata")){n=m.dispatchEvent("dragdata",{data:n});}this.dragdata={rules:g,selection:s,data:n,indicator:m.$showDragIndicator(s,this.coordinates),host:m};if(m.dispatchEvent("dragstart",this.dragdata)===false){return false;}m.dragging=2;apf.dragMode=true;document.onmousemove=this.onmousemove;document.onmouseup=this.onmouseup;},stop:function(b,c){if(this.last){this.dragout();}this.dragdata.host.dragging=0;this.dragdata.host.$hideDragIndicator(c);apf.dragMode=false;document.onmousemove=document.onmouseup=null;this.dragdata=null;},dragover:function(k,d,j){j=j||window.event;var g;if(k.$findValueNode){g=k.$findValueNode(d);}if(this.lastFel&&this.lastFel==g||!this.lastFel&&this.last==k){return;}var m=(g?apf.xmldb.getNode(g):apf.xmldb.findXmlNode(d)),b=k.isDropAllowed&&k.xmlRoot?k.isDropAllowed(this.dragdata.data,m||k.xmlRoot):apf.isTrue(apf.getInheritedAttribute(k,"",function(n){if(n.drop){k=n;if(k==apf.DragServer.last){return false;}return true;}}));if(this.last&&this.last!=k){this.dragout(this.last,j);}this.last=k;this.lastFel=g;if(!b){return;}if(k.dispatchEvent("dragover",this.dragdata)===false){b=false;}var c=j.originalTarget||j.srcElement||j.target;if(k&&k.$dragover){k.$dragover(d,this.dragdata,b);}},dragout:function(c,b){this.lastFel=null;if(c){this.dragdata.htmlEvent=b;c.dispatchEvent("dragout",this.dragdata);}if(this.last&&this.last.$dragout){this.last.$dragout(null,this.dragdata);}this.last=null;},dragdrop:function(b,c,t,q){var n,s,j=(b.$findValueNode?apf.xmldb.getNode(b.$findValueNode(c)):apf.xmldb.findXmlNode(c)),d=(b.isDropAllowed&&b.xmlRoot)?b.isDropAllowed(this.dragdata.data,j||b.xmlRoot):false;if(this.dragdata.indicator){s=this.dragdata.indicator.style.top;this.dragdata.indicator.style.top="10000px";}if(!d){d=apf.isTrue(apf.getInheritedAttribute(b,"",function(m){if(m.drop){b=m;return true;}}));}if(d){if(b.dispatchEvent("dragdrop",apf.extend({candrop:d,htmlEvent:q,top:s},this.dragdata))===false){d=false;}else{if(!b.xmlRoot){var g=b.getModel?b.getModel(true):apf.nameserver.get("model",b.model);if(g){g.load(this.dragdata.data[0]);}return true;}else{var k=d[1]&&d[1].action||(b.$isTreeArch?"tree-append":"list-append");if(k=="list-append"&&(!b.$isTreeArch&&b==this.dragdata.host)){d=false;}}}}if(this.dragdata.indicator){this.dragdata.indicator.style.top=s;}if(!d){this.dragout(b,q);return false;}if(b.$dragDrop){var r=b.$dragDrop(d[0],this.dragdata.data,d[1],k,n||d[0]==b.xmlRoot,this.dragdata.rules,q);this.dragdata.resultNode=r;}if(b.$dragdrop){b.$dragdrop(c,apf.extend({htmlEvent:q,xmlNode:r},this.dragdata),d);}this.last=null;this.lastFel=null;return true;},onmousemove:function(k){if(!apf.DragServer.dragdata){return;}k=k||window.event;if(apf.isIphone){k.preventDefault();if(!k.touches){return apf.DragServer.stop(true);}k=k.touches[0];}var d=apf.DragServer.dragdata,m={clientX:k.pageX?k.pageX-window.pageXOffset:k.clientX,clientY:k.pageY?k.pageY-window.pageYOffset:k.clientY};if(!d.started&&Math.abs(apf.DragServer.coordinates.clientX-m.clientX)<6&&Math.abs(apf.DragServer.coordinates.clientY-m.clientY)<6){return;}if(!d.started){if(d.host.$dragstart){d.host.$dragstart(null,d);}d.started=true;}var b=d.indicator.style.top;d.indicator.style.display="block";if(d.indicator){d.indicator.style.top="10000px";}apf.DragServer.dragdata.x=k.pageX?k.pageX-(apf.isGecko?window.pageXOffset:0):m.clientX;apf.DragServer.dragdata.y=k.pageY?k.pageY-(apf.isGecko?window.pageYOffset:0):m.clientY;var g=document.elementFromPoint(apf.DragServer.dragdata.x,apf.DragServer.dragdata.y);if(!g){g=document.elementFromPoint(apf.DragServer.dragdata.x,apf.DragServer.dragdata.y);}d.indicator.style.top=b;d.host.$moveDragIndicator(m);var j=apf.findHost(g);if(j){apf.DragServer.dragover(j,g,k);}else{if(apf.DragServer.last){apf.DragServer.dragout(apf.DragServer.last,k);}}apf.DragServer.lastTime=new Date().getTime();},onmouseup:function(k){k=k||window.event;if(apf.isIphone){k.preventDefault();if(!k.changedTouches){return apf.DragServer.stop(true);}k=k.changedTouches[0];}var n={clientX:k.pageX?k.pageX-window.pageXOffset:k.clientX,clientY:k.pageY?k.pageY-window.pageYOffset:k.clientY};if(!apf.DragServer.dragdata.started&&Math.abs(apf.DragServer.coordinates.clientX-n.clientX)<6&&Math.abs(apf.DragServer.coordinates.clientY-n.clientY)<6){apf.DragServer.stop(true);return;}var d=apf.DragServer.dragdata.indicator,b=d.style.top;if(d){d.style.top="10000px";}apf.DragServer.dragdata.x=k.pageX?k.pageX-(apf.isGecko?window.pageXOffset:0):n.clientX;apf.DragServer.dragdata.y=k.pageY?k.pageY-(apf.isGecko?window.pageYOffset:0):n.clientY;var g=document.elementFromPoint(apf.DragServer.dragdata.x,apf.DragServer.dragdata.y);if(!g){g=document.elementFromPoint(apf.DragServer.dragdata.x,apf.DragServer.dragdata.y);}d.style.top=b;var j=apf.findHost(g);if(apf.DragServer.host&&j!=apf.DragServer.host){apf.DragServer.dragout(apf.DragServer.host,k);}var m=apf.DragServer.dragdrop(j,g,apf.DragServer.dragdata.host,k);apf.DragServer.stop(true,m);}};apf.MultiselectDragDrop=function(){this.diffX=this.diffY=0;this.multiple=false;this.lastDragNode=null;this.lastel=null;this.$showDragIndicator=function(g,m){this.multiple=g.length>1;if(this.multiple){this.diffX=m.scrollX;this.diffY=m.scrollY;}else{this.diffX=-1*m.offsetX;this.diffY=-1*m.offsetY;}var d=this.oDrag.className.split(" ")[0];this.$setStyleClass(this.oDrag,this.multiple?d+"_multiple":"",[d+"_multiple"]);if(this.multiple){document.body.appendChild(this.oDrag);return this.oDrag;}else{if(this.localName=="datagrid"){if(this.lastDragNode){apf.destroyHtmlNode(this.lastDragNode);}g=this.$selected||this.$caret;var k=g.cloneNode(true);k.removeAttribute("onmousedown");k.onmousedown=null;k.removeAttribute("onmouseup");k.onmouseup=null;k.removeAttribute("onmouseout");k.onmouseout=null;k.removeAttribute("ondblclick");k.ondblclick=null;document.body.appendChild(k);k.style.position="absolute";k.style.width=g.offsetWidth+"px";k.style.display="none";k.style.zIndex=10000000;k.removeAttribute("id");this.$setStyleClass(k,"draggrid");var b=g.childNodes;var j=k.childNodes;for(var c=b.length-1;c>=0;c--){if(j[c].nodeType==1){j[c].style.width=apf.getStyle(b[c],"width");}}return(this.lastDragNode=k);}else{var g=this.$selected||this.$caret;this.oDrag.style.width=(g.offsetWidth-apf.getWidthDiff(this.oDrag))+"px";this.$updateNode(this.selected,this.oDrag);}}return this.oDrag;};this.$hideDragIndicator=function(d){var c=this.lastDragNode||this.oDrag,b=this;if(!this.multiple&&!d&&c.style.display=="block"){var g=apf.getAbsolutePosition(this.$selected||this.$caret);apf.tween.multi(c,{anim:apf.tween.EASEIN,steps:15,interval:10,tweens:[{type:"left",from:c.offsetLeft,to:g[0]},{type:"top",from:c.offsetTop,to:g[1]}],onfinish:function(){if(b.lastDragNode){apf.destroyHtmlNode(b.lastDragNode);b.lastDragNode=null;}else{b.oDrag.style.display="none";}}});}else{if(this.lastDragNode){apf.destroyHtmlNode(this.lastDragNode);this.lastDragNode=null;}else{this.oDrag.style.display="none";}}};this.$moveDragIndicator=function(c){var b=this.lastDragNode||this.oDrag;b.style.left=(c.clientX+this.diffX)+"px";b.style.top=(c.clientY+this.diffY+(this.multiple?15:0))+"px";};this.$initDragDrop=function(){if(!this.$hasLayoutNode("dragindicator")){return;}this.oDrag=apf.insertHtmlNode(this.$getLayoutNode("dragindicator"),document.body);this.oDrag.style.zIndex=10000000;this.oDrag.style.position="absolute";this.oDrag.style.cursor="default";this.oDrag.style.display="none";};this.$findValueNode=function(b){if(!b){return null;}while(b&&b.nodeType==1&&!b.getAttribute(apf.xmldb.htmlIdTag)){if(this.$isTreeArch&&b.previousSibling&&b.previousSibling.nodeType==1){b=b.previousSibling;}else{b=b.parentNode;}}return(b&&b.nodeType==1&&b.getAttribute(apf.xmldb.htmlIdTag))?b:null;};this.$dragout=function(j,c,b){if(this.lastel){this.$setStyleClass(this.lastel,"",["dragDenied","dragInsert","dragAppend","selected","indicate"]);}var k=this.$getSelection(true);for(var g=0,d=k.length;g<d;g++){this.$setStyleClass(k[g],"selected",["dragDenied","dragInsert","dragAppend","indicate"]);}this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Drop"]);this.lastel=null;};if(!this.$dragdrop){this.$dragdrop=this.$dragout;}this.$dragover=function(j,c,b){this.$setStyleClass(this.$ext,this.$baseCSSname+"Drop");var n=this.$getSelection(true);for(var g=0,d=n.length;g<d;g++){this.$setStyleClass(n[g],"",["dragDenied","dragInsert","dragAppend","selected","indicate"]);}if(this.lastel){this.$setStyleClass(this.lastel,"",["dragDenied","dragInsert","dragAppend","selected","indicate"]);}var m=b[1]&&b[1].action;this.lastel=this.$findValueNode(j);if(this.$isTreeArch&&m=="list-append"){var k=apf.xmldb.findHtmlNode(this.getTraverseParent(apf.xmldb.getNode(this.lastel)),this);this.lastel=k?this.$getLayoutNode("item","container",k):this.$container;this.$setStyleClass(this.lastel,"dragInsert");}else{this.$setStyleClass(this.lastel,b?(m=="insert-before"?"dragInsert":"dragAppend"):"dragDenied");}};};apf.StandardDragDrop=function(){this.$showDragIndicator=function(d,g){var b=g.offsetX+22,j=g.offsetY;this.oDrag.startX=b;this.oDrag.startY=j;document.body.appendChild(this.oDrag);var c=this.$getLayoutNode("main","caption",this.oDrag);if(c.nodeType!=1){c=c.parentNode;}c.innerHTML=this.$applyBindRule("caption",this.xmlRoot)||"";return this.oDrag;};this.$hideDragIndicator=function(){this.oDrag.style.display="none";};this.$moveDragIndicator=function(b){this.oDrag.style.left=(b.clientX-this.oDrag.startX+document.documentElement.scrollLeft)+"px";this.oDrag.style.top=(b.clientY-this.oDrag.startY+document.documentElement.scrollTop)+"px";};this.$initDragDrop=function(){if(!this.getAttribute("drag")){return;}this.oDrag=document.body.appendChild(this.$ext.cloneNode(true));this.oDrag.style.zIndex=1000000;this.oDrag.style.position="absolute";this.oDrag.style.cursor="default";this.oDrag.style.filter="progid:DXImageTransform.Microsoft.Alpha(opacity=50)";this.oDrag.style.MozOpacity=0.5;this.oDrag.style.opacity=0.5;this.oDrag.style.display="none";};};apf.DragServer.Init();apf.__MULTICHECK__=1<<22;apf.window=function(){this.$uniqueId=apf.all.push(this);this.apf=apf;this.toString=function(){return"[apf.window]";};this.getActionTracker=function(){return this.$at;};this.loadCodeFile=function(B){if(self[B]){apf.importClass(self[B],true,this.win);}else{apf.include(B);}};this.show=function(){if(apf.isDeskrun){k.Show();}};this.hide=function(){if(apf.isDeskrun){k.Hide();}else{this.loaded=false;if(this.win){this.win.close();}}};this.focus=function(){if(apf.isDeskrun){k.SetFocus();}else{window.focus();}};this.setIcon=function(B){if(apf.isDeskrun){k.icon=parseInt(B)==B?parseInt(B):B;}};this.setTitle=function(B){this.title=B||"";if(apf.isDeskrun){k.caption=B;}else{document.title=(B||"");}};this.loadAml=function(B){if(B[apf.TAGNAME]=="deskrun"){this.loadDeskRun(B);}};var k=apf.isDeskrun?window.external:null,r=apf.isDeskrun?k.shell:null;this.loadDeskRun=function(G){k.style=G.getAttribute("style")||"ismain|taskbar|btn-close|btn-max|btn-min|resizable";apf.config.drRegName=G.getAttribute("record");if(G.getAttribute("minwidth")){k.setMin(G.getAttribute("minwidth"),G.getAttribute("minheight"));}if(G.getAttribute("record")&&r.RegGet(apf.config.drRegName+"/window")){var F=r.RegGet(apf.config.drRegName+"/window");if(F){F=F.split(",");window.external.width=Math.max(G.getAttribute("minwidth"),Math.min(parseInt(F[2]),window.external.shell.GetSysValue("deskwidth")));window.external.height=Math.max(G.getAttribute("minheight"),Math.min(parseInt(F[3]),window.external.shell.GetSysValue("deskheight")));window.external.left=Math.max(0,Math.min(parseInt(F[0]),screen.width-window.external.width));window.external.top=Math.max(0,Math.min(parseInt(F[1]),screen.height-window.external.height));}}else{k.left=G.getAttribute("left")||200;k.top=G.getAttribute("top")||200;k.width=G.getAttribute("width")||800;k.height=G.getAttribute("height")||600;}k.caption=G.getAttribute("caption")||"DeskRun";k.icon=G.getAttribute("icon")||100;var D=$xmlns(G,"context",apf.ns.aml);if(D.length){D=D[0];if(!apf.config.tray){apf.config.tray=window.external.CreateWidget("trayicon");}var E=apf.config.tray;E.icon=G.getAttribute("tray")||100;E.tip=G.getAttribute("tooltip")||"DeskRun";E.PopupClear();E.PopupItemAdd("Exit",3);E.PopupItemAdd("SEP",function(){});var B=D.childNodes;for(var C=B.length-1;C>=0;C--){if(B[C].nodeType!=1){continue;}if(B[C][apf.TAGNAME]=="divider"){E.PopupItemAdd("SEP",function(){});}else{E.PopupItemAdd(apf.queryValue(B[C],"."),B[C].getAttribute("href")?new Function("window.open('"+B[C].getAttribute("href")+"')"):new Function(B[C].getAttribute("onclick")));}}}k.shell.debug=apf.debug?7:0;k.Show();k.SetFocus();};this.$tabList=[];this.$addFocus=function(C,D,B){if(!B){C.addEventListener("DOMNodeInserted",A);C.addEventListener("DOMNodeRemoved",o);if(C.$isWindowContainer>-2){C.addEventListener("focus",w);C.addEventListener("blur",w);C.$focusParent=C;if(C.$isWindowContainer>-1){if(!C.$tabList){C.$tabList=[C];}this.$tabList.push(C);return;}else{C.$tabList=[C];}}}var E=t(C),F=E.$tabList;if(F[D]){apf.console.warn("Aml node already exist for tabindex "+D+". Will insert "+C.tagName+" ["+(C.name||"")+"] before existing one");}if(!C.$isWindowContainer){C.$focusParent=E;}if(F[D]){F.insertIndex(C,D);}else{F.push(C);}};this.$removeFocus=function(B){if(!B.$focusParent){return;}B.$focusParent.$tabList.remove(B);if(!B.$isWindowContainer){B.removeEventListener("DOMNodeInserted",A);B.removeEventListener("DOMNodeRemoved",o);}if(B.$isWindowContainer>-2){B.removeEventListener("focus",w);B.removeEventListener("blur",w);}};var b;this.$focus=function(C,F,E){var B=this.document.activeElement;if(B==C&&!E){return;}var D=B==C;this.$settingFocus=C;if(!F){F={};}F.toElement=C;F.fromElement=B;if(B&&B!=C&&b!=B){b=B;B.blur(true,F);if(b!=B){return false;}}(apf.activeElement=this.document.activeElement=C).focus(true,F);this.$settingFocus=null;apf.dispatchEvent("movefocus",{toElement:C});if(!D){apf.console.info("Focus given to "+C.localName+" ["+(C.name||"")+"]");}};this.$blur=function(C){var B=this.document.activeElement;if(B!=C){return false;}apf.console.info(B.localName+" ["+(B.name||"")+"] was blurred.");B.$focusParent.$lastFocussed=null;apf.activeElement=this.document.activeElement=null;apf.dispatchEvent("movefocus",{fromElement:C});};var n;this.$focusDefault=function(B,D){var C=t(B);this.$focusLast(C,D);};this.$focusRoot=function(B){var C=apf.document.documentElement;if(this.$focusLast(C,B)===false){}};this.$focusLast=function(D,H,C){var B=D.$lastFocussed;if(B&&B.parentNode&&B.$focussable===true&&(C||B.$ext.offsetHeight)){this.$focus(B,H,true);}else{var E,G=D,F;while(G){if(!F&&G.focussable!==false&&G.$focussable===true&&!G.$tabList&&(C||G.$ext&&G.$ext.offsetHeight)&&!G.disabled){this.$focus(G,H,true);break;}if((E=!F&&G.firstChild||!(F=false)&&G.nextSibling)){G=E;if(G.$isWindowContainer>0){F=true;}}else{if(G==D){if(G.$isWindowContainer){this.$focus(G,H,true);}return;}else{do{G=G.parentNode;}while(G&&!G.nextSibling&&G!=D&&!G.$isWindowContainer);if(G==D){if(G.$isWindowContainer){this.$focus(G,H,true);}return;}if(G){if(G.$isWindowContainer){this.$focus(G,H,true);break;}G=G.nextSibling;}}}}if(!G){this.$focus(apf.document.documentElement);}}};function w(B){if(B.name=="blur"){if(B.srcElement!=this&&this.$blur){this.$blur();}return;}if(B.srcElement!=this&&this.$focus){this.$focus();}if(B.srcElement==this||B.trackedChild){B.trackedChild=true;return;}this.$lastFocussed=B.srcElement;if(this.localName.indexOf("window")>-1){B.trackedChild=true;}}function t(B){var C=B;do{C=C.parentNode;}while(C&&!C.$isWindowContainer);return C||apf.document.documentElement;}function A(B){if(B&&B.currentTarget!=this){return;}if(this.$isWindowContainer){apf.window.$tabList.pushUnique(this);}else{apf.window.$addFocus(this,this.tabindex,true);}}function o(B){if(B&&(B.currentTarget!=this||B.$doOnlyAdmin)){return;}if(apf.document.activeElement==this){apf.window.moveNext();}if(this.$isWindowContainer){apf.window.$tabList.remove(this);return;}if(!this.$focusParent){return;}this.$focusParent.$tabList.remove(this);}this.hasFocus=function(B){return this.document.activeElement==B;};this.moveNext=function(L,E,B,K){if(B&&apf.document.activeElement){var D=apf.document.activeElement.$focusParent;if(D.visible&&D.modal){return false;}}var G,C,I,F=E||apf.document.activeElement,H=F?(B&&F.$isWindowContainer&&F.$isWindowContainer!=-1?apf.window:F.$focusParent):apf.document.documentElement,J=H.$tabList;if(F&&(B||F!=apf.document.documentElement)){C=(J||[]).indexOf(F);if(C==-1){apf.console.warn("Moving focus from element which isn't in the list                                  of it's parent. This should never happen.");return;}}else{C=-1;}if(this.document.activeElement&&this.document.activeElement==F&&J.length==1||J.length==0){return false;}G=(L?-1:1);I=C;if(C<0){C=0;}do{I+=G;if(I>=J.length){I=0;}else{if(I<0){I=J.length-1;}}if(C==I&&F){if(J[0].$isWindowContainer){this.$focus(J[0],K);}return false;}F=J[I];}while(!F||F.disabled||F==apf.document.activeElement||(B?!F.visible:F.$ext&&!F.$ext.offsetHeight)||F.focussable===false||B&&!F.$tabList.length);if(H==apf.window&&F.$isWindowContainer!=-2){this.$focusLast(F,{mouse:true},B);}else{(K||(K={})).shiftKey=L;this.$focus(F,K);}};this.focusDefault=function(){if(this.moveNext()===false){this.moveNext(null,apf.document.documentElement,true);}};apf.addListener(window,"beforeunload",function(){return apf.dispatchEvent("exit");});apf.addListener(window,"unload",function(){if(!apf){return;}apf.window.isExiting=true;apf.window.destroy();});var g,d="",s="";this.$focusfix=function(){if(apf.isIphone){return;}d+="a";clearTimeout(g);$setTimeout("window.focus();");g=$setTimeout(c);};this.$focusfix2=function(){if(apf.isIphone){return;}d+="b";clearTimeout(g);g=$setTimeout(c);};this.$blurfix=function(){if(apf.isIphone){return;}d+="c";clearTimeout(g);g=$setTimeout(c);};function c(){clearTimeout(g);if(d=="e"||d=="c"||d.charAt(0)=="x"&&!d.match(/eb$/)||d=="ce"||d=="de"){if(s!="blur"){s="blur";apf.window.dispatchEvent("blur");}}else{if(s!="focus"){s="focus";apf.window.dispatchEvent("focus");}}d="";g=null;}apf.addListener(window,"focus",this.$focusevent=function(){if(apf.isIphone){return apf.window.dispatchEvent("focus");}if(apf.hasFocusBug){d+="d";clearTimeout(g);g=$setTimeout(c);}else{clearTimeout(u);j.newState="focus";u=$setTimeout(j,10);}});apf.addListener(window,"blur",this.$blurevent=function(){if(!apf){return;}if(apf.isIphone){return apf.window.dispatchEvent("blur");}if(apf.hasFocusBug){d+="e";clearTimeout(g);g=$setTimeout(c);}else{clearTimeout(u);j.newState="blur";u=$setTimeout(j,10);}});var u;function j(){clearTimeout(u);var B=j.newState;if(s==B){return;}s=B;apf.dispatchEvent(s);}this.hasFocus=function(){return(s=="focus");};apf.addListener(document,"contextmenu",function(D){if(!D){D=event;}var E,C,B=apf.findHost(D.srcElement||D.target)||apf.document.activeElement||apf.document&&apf.document.documentElement;if(B&&B.localName=="menu"){return false;}if(apf.contextMenuKeyboard){if(B){E=B.selected?apf.getAbsolutePosition(B.$selected):apf.getAbsolutePosition(B.$ext||B.$pHtmlNode);}else{E=[0,0];}C={x:E[0]+10+document.documentElement.scrollLeft,y:E[1]+10+document.documentElement.scrollTop,amlNode:B,htmlEvent:D};}else{if(D.htmlEvent){C=D;}else{C={x:D.clientX+document.documentElement.scrollLeft,y:D.clientY+document.documentElement.scrollTop,htmlEvent:D};}}C.bubbles=true;apf.contextMenuKeyboard=null;if((B||apf).dispatchEvent("contextmenu",C)===false||C.returnValue===false){if(D.preventDefault){D.preventDefault();}return false;}if(apf.config.disableRightClick){if(D.preventDefault){D.preventDefault();}return false;}});apf.addListener(document,"mouseup",function(B){B=B||window.event;apf.dispatchEvent("mouseup",{htmlEvent:B});});var m={INPUT:1,TEXTAREA:1,SELECT:1};apf.addListener(document,"mousedown",this.$mousedown=function(G){G=G||window.event;var F,D=apf.findHost(G.srcElement||G.target),C=D&&D.$editable;if(apf.popup.last&&(!D||apf.popup.last!=D.$uniqueId)&&!apf.isChildOf(apf.popup.cache[apf.popup.last].content,G.srcElement||G.target,true)){apf.popup.forceHide();}if((!D||!D.$focussable||D.focussable===false)&&apf.config.allowBlur&&D.canHaveChildren!=2&&!D.$focusParent){n=null;if(apf.document.activeElement){apf.document.activeElement.blur();}}else{if(D){if((F=apf.document.activeElement&&apf.document.activeElement.$focusParent||n)&&F.visible&&F.modal&&D.$focusParent!=F){apf.window.$focusLast(F,{mouse:true,ctrlKey:G.ctrlKey});}else{if(!D&&apf.document.activeElement){apf.window.$focusRoot();}else{if(D.$isWindowContainer==-1){if(D.$tabList.length){apf.window.moveNext(null,D.$tabList[0],null,{mouse:true});}else{apf.window.$focus(D);}}else{if(!D.disabled&&D.focussable!==false){if(D.$focussable===apf.KEYBOARD_MOUSE){apf.window.$focus(D,{mouse:true,ctrlKey:G.ctrlKey});}else{if(D.canHaveChildren==2){if(!apf.config.allowBlur||!apf.document.activeElement||apf.document.activeElement.$focusParent!=D){apf.window.$focusLast(D,{mouse:true,ctrlKey:G.ctrlKey});}}else{apf.window.$focusDefault(D,{mouse:true,ctrlKey:G.ctrlKey});}}}else{apf.window.$focusDefault(D,{mouse:true,ctrlKey:G.ctrlKey});}}}}if(apf.hasFocusBug){var B=m[(G.srcElement||G.target).tagName]&&!(G.srcElement||G.target).disabled||(G.srcElement&&G.srcElement.isContentEditable)||D.$isContentEditable&&D.$isContentEditable(G)&&!D.disabled;if(!D||!B){apf.window.$focusfix();}}else{if(!s){apf.window.$focusevent();}}}}apf.dispatchEvent("mousedown",{htmlEvent:G,amlNode:D||apf.document.documentElement});if(apf.isIE||apf.isIphone){return;}var E=!((!apf.document&&(!apf.isParsingPartial||D)||apf.dragMode)&&!m[G.target.tagName]);if(E&&D){var B=m[(G.srcElement||G.target).tagName]&&!(G.srcElement||G.target).disabled||(G.srcElement&&G.srcElement.isContentEditable)||D.$isContentEditable&&D.$isContentEditable(G)&&!D.disabled;if(!B&&!apf.config.allowSelect&&D.nodeType!=D.NODE_PROCESSING_INSTRUCTION&&!D.$allowSelect&&(!D.$int||D.$focussable)){E=false;}}if(!E&&!C){if(G.preventDefault){G.preventDefault();}return false;}});apf.addListener(document,"selectstart",function(D){if(!D){D=event;}var C=!(!apf.document||apf.dragMode);var B=apf.findHost(D.srcElement);if(C){if(!apf.config.allowSelect&&B&&B.nodeType!=B.NODE_PROCESSING_INSTRUCTION&&!B.$allowSelect&&!B.$int){C=false;}}if(!C){D.returnValue=false;return false;}});apf.addListener(document,"keyup",this.$keyup=function(B){if(!B){B=event;}if(apf.document&&apf.document.activeElement&&!apf.document.activeElement.disableKeyboard&&apf.document.activeElement.dispatchEvent("keyup",{keyCode:B.keyCode,ctrlKey:B.ctrlKey,shiftKey:B.shiftKey,altKey:B.altkey,htmlEvent:B})===false){B.returnValue=false;return false;}apf.dispatchEvent("keyup",null,B);});function q(F){if(!F){F=event;}var H=null;if(F.wheelDelta){H=F.wheelDelta/120;if(apf.isOpera){H*=-1;}}else{if(F.detail){H=-F.detail/3;}}if(H!==null){if(apf.isIE){var D=F.srcElement||F.target;while(D&&D.scrollHeight<=D.offsetHeight){D=D.parentNode;}if(!D){return;}if(D.nodeType==9){D=D.documentElement;}if(D&&D.tagName=="BODY"&&"auto|scroll".indexOf(apf.getStyle(D,"overflowY"))==-1){D=document.documentElement;}if(D&&"auto|scroll".indexOf(apf.getStyle(D,"overflowY"))>-1){var B,G=0.35*D.offsetHeight*H;if(H<0){if(D&&D.scrollTop>=(B=D.scrollHeight-D.offsetHeight+apf.getVerBorders(D))+G){D.scrollTop=B;F.returnValue=false;}}else{if(D&&D.scrollTop<=G){D.scrollTop=0;F.returnValue=false;}}}}var E={delta:H,target:F.target||F.srcElement,button:F.button,ctrlKey:F.ctrlKey,shiftKey:F.shiftKey,altKey:F.altKey},C=apf.dispatchEvent("mousescroll",E);if(C===false||E.returnValue===false){if(F.preventDefault){F.preventDefault();}F.returnValue=false;}}}if(document.addEventListener){document.addEventListener("DOMMouseScroll",q,false);}window.onmousewheel=document.onmousewheel=q;apf.addListener(document,"keyup",function(C){C=C||event;if(C.ctrlKey&&C.keyCode==9&&apf.document.activeElement){var B=apf.document.activeElement.$focusParent;if(B.modal){if(C.preventDefault){C.preventDefault();}return false;}apf.window.moveNext(C.shiftKey,apf.document.activeElement.$focusParent,true);B=apf.document.activeElement.$focusParent;if(B&&B.bringToFront){B.bringToFront();}if(C.preventDefault){C.preventDefault();}return false;}});apf.addListener(document,"keydown",this.$keydown=function(G){G=G||event;if(G.keyCode==120||G.ctrlKey&&G.altKey&&G.keyCode==68){apf.$debugwin.activate();}if(G.keyCode==93){apf.contextMenuKeyboard=true;}var D=apf.findHost(G.srcElement||G.target),C=m[(G.explicitOriginalTarget||G.srcElement||G.target).tagName]||(G.srcElement&&G.srcElement.isContentEditable);var I,H=apf.isMac?G.metaKey:G.ctrlKey;if(!C&&apf.config.undokeys&&H){if(G.keyCode==90){I=apf.document.activeElement;while(I&&!I.getActionTracker&&!I.$at){I=I.parentNode;}if(!I){I=apf.window;}(I.$at||I.getActionTracker()).undo();}else{if(G.keyCode==89){I=apf.document.activeElement;while(I&&!I.getActionTracker&&!I.$at){I=I.parentNode;}if(!I){I=apf.window;}(I.$at||I.getActionTracker()).redo();}}}var E={ctrlKey:G.ctrlKey,metaKey:G.metaKey,shiftKey:G.shiftKey,altKey:G.altKey,keyCode:G.keyCode,htmlEvent:G,bubbles:true};if(!C&&apf.dispatchEvent("hotkey",E)===false||E.returnValue===false){G.returnValue=false;G.cancelBubble=true;if(G.stopPropagation){G.stopPropagation();}if(apf.canDisableKeyCodes){try{G.keyCode=0;}catch(G){}}if(G.preventDefault){G.preventDefault();}return false;}delete E.currentTarget;if((apf.document.activeElement&&!apf.document.activeElement.disableKeyboard&&!apf.document.activeElement.editable&&apf.document.activeElement.dispatchEvent("keydown",E)||apf.dispatchEvent("keydown",E))===false){G.returnValue=false;G.cancelBubble=true;if(apf.canDisableKeyCodes){try{G.keyCode=0;}catch(G){}}if(G.preventDefault){G.preventDefault();}return false;}else{if((!apf.config.disableTabbing||apf.document.activeElement)&&G.keyCode==9){if(G.ctrlKey&&apf.document.activeElement){var B=apf.document.activeElement.$focusParent;if(B.modal){if(G.preventDefault){G.preventDefault();}return false;}apf.window.moveNext(G.shiftKey,apf.document.activeElement.$focusParent,true);B=apf.document.activeElement.$focusParent;if(B&&B.bringToFront){B.bringToFront();}}else{if(!apf.document.activeElement||apf.document.activeElement.tagName!="menu"){apf.window.moveNext(G.shiftKey);}}if(G.preventDefault){G.preventDefault();}return false;}}var F=apf.isMac?G.metaKey:G.altKey;if(apf.config.disableBackspace&&G.keyCode==8&&!C){if(apf.canDisableKeyCodes){try{G.keyCode=0;}catch(G){}}G.returnValue=false;}if(apf.config.disableF5&&(G.keyCode==116||G.keyCode==117)){if(apf.canDisableKeyCodes){try{G.keyCode=0;}catch(G){}}else{G.preventDefault();G.stopPropagation();}}if(G.keyCode==27){G.returnValue=false;}if(!apf.config.allowSelect&&G.shiftKey&&(G.keyCode>32&&G.keyCode<41)&&!C){G.returnValue=false;}if(G.returnValue===false&&G.preventDefault){G.preventDefault();}return G.returnValue;});apf.document={};this.init=function(B){if(apf.actiontracker){this.$at=new apf.actiontracker();this.$at.name="default";apf.nameserver.register("actiontracker","default",this.$at);}apf.console.info("Start parsing main application");apf.Latometer.start();this.$domParser=new apf.DOMParser();this.document=apf.document=this.$domParser.parseFromString(B,"text/xml",{timeout:apf.config.initdelay,callback:function(E){if(apf.parsed!=2){var D=apf.parsed;apf.parsed=2;apf.dispatchEvent("parse",{initial:D});apf.parsed=true;}if(!apf.loaded){if(apf.isDeskrun){apf.window.deskrun.Show();}if(!apf.document.activeElement&&!apf.config.allowBlur){apf.window.focusDefault();}apf.loaded=true;$setTimeout(function(){apf.dispatchEvent("load");});}apf.console.info("Initialization finished");apf.Latometer.end();apf.Latometer.addPoint("Total load time");apf.Latometer.start(true);}});var C;this.addEventListener("focus",function(D){if(!apf.document.activeElement&&n&&!apf.isIphone){C.focus();}});this.addEventListener("blur",function(D){if(!apf.document.activeElement||apf.isIphone){return;}apf.document.activeElement.blur(true,{srcElement:this});n=apf.document.activeElement.$focusParent;C=apf.document.activeElement;apf.activeElement=apf.document.activeElement=null;});};this.destroy=function(){this.$at=null;apf.unload(this);apf=this.win=this.window=this.document=null;window.onfocus=window.onerror=window.onunload=window.onbeforeunload=window.onbeforeprint=window.onafterprint=window.onmousewheel=window.onblur=null;document.oncontextmenu=document.onmousedown=document.onmousemove=document.onmouseup=document.onselectstart=document.onmousewheel=document.onkeyup=document.onkeydown=null;if(document.body){document.body.onmousedown=document.body.onmousemove=document.body.onmouseup=null;document.body.innerHTML="";}};};apf.window.prototype=new apf.Class().$init();apf.window=new apf.window();apf.sanitizeTextbox=function(b){b.onfocus=function(){if(apf.window){apf.window.$focusfix2();}};b.onblur=function(){if(apf.window){apf.window.$blurfix();}};};apf.runGecko=function(){if(apf.runNonIe){apf.runNonIe();}HTMLDocument.prototype.selectNodes=XMLDocument.prototype.selectNodes=function(g,d){try{var n=this.evaluate(g,(d||this),this.createNSResolver(this.documentElement),7,null);}catch(m){var o=m.message;if(m.code==m.INVALID_EXPRESSION_ERR){o=o.replace(/the expression/i,"'"+g+"'");}throw new c(m.lineNumber,"XPath error: "+o);}var j=new Array(n.snapshotLength);j.expr=g;for(var k=j.length-1;k>=0;k--){j[k]=n.snapshotItem(k);}return j;};Text.prototype.selectNodes=Element.prototype.selectNodes=function(d){return this.ownerDocument.selectNodes(d,this);};HTMLDocument.prototype.selectSingleNode=XMLDocument.prototype.selectSingleNode=function(g,d){var j=this.selectNodes(g+"[1]",d||null);return j[0]||null;};Text.prototype.selectSingleNode=Element.prototype.selectSingleNode=function(d){return this.ownerDocument.selectSingleNode(d,this);};var b=new XMLSerializer();apf.insertHtmlNodes=function(j,n,g){var q=document.createElement("div"),r=document.createDocumentFragment(),k=j.length-1,d,m;for(;k>=0;k--){m=j[k];r.insertBefore(m,r.firstChild);}q.innerHTML=apf.html_entity_decode(b.serializeToString(r)).replace(/<([^>]+)\/>/g,"<$1></$1>");r=document.createDocumentFragment();for(k=0,d=q.childNodes.length;k<d;k++){m=q.childNodes[0];r.appendChild(m);}if(g){n.insertBefore(r,g);}n.appendChild(r);};apf.insertHtmlNode=function(g,k,d,j){if(k.nodeType!=11&&!k.style){return k.appendChild(g);}var m=document.createElement("div");if(!j){j=apf.html_entity_decode(g.serialize?g.serialize(true):((g.nodeType==3||g.nodeType==4||g.nodeType==2)?g.nodeValue:b.serializeToString(g)));}m.innerHTML=j.replace(/<([^>]+)\/>/g,"<$1></$1>");if(d){k.insertBefore(m.firstChild,d);}k.appendChild(m.firstChild);return d?d.previousSibling:k.lastChild;};function c(d,g){if(!apf.$debugwin.nativedebug){apf.$debugwin.errorHandler(g,"",0);}this.message=g;this.nr=d;}apf.getHtmlLeft=function(d){return(d.offsetLeft+(parseInt(apf.getStyle(d.parentNode,"borderLeftWidth"))||0));};apf.getHtmlRight=function(d){var g;return(((g=d.offsetParent).tagName=="BODY"?apf.getWindowWidth():g.offsetWidth)-d.offsetLeft-d.offsetWidth-(2*(parseInt(apf.getStyle(g,"borderLeftWidth"))||0))-(parseInt(apf.getStyle(g,"borderRightWidth"))||0));};apf.getHtmlTop=function(d){return(d.offsetTop+(parseInt(apf.getStyle(d.parentNode,"borderTopWidth"))||0));};apf.getHtmlBottom=function(d){var g;return(((g=d.offsetParent).tagName=="BODY"?apf.getWindowHeight():g.offsetHeight)-d.offsetTop-d.offsetHeight-(2*(parseInt(apf.getStyle(g,"borderTopWidth"))||0))-(parseInt(apf.getStyle(g,"borderBottomWidth"))||0));};apf.getBorderOffset=function(d){return[-1*(parseInt(apf.getStyle(d,"borderLeftWidth"))||0),-1*(parseInt(apf.getStyle(d,"borderTopWidth"))||0)];};};apf.initGears=function(){var b,c;var g=apf.nameserver.get("google","gears");if(g){return g;}if(typeof GearsFactory!="undefined"){b=new GearsFactory();}else{if(apf.isIE){try{b=new ActiveXObject("Gears.Factory");}catch(d){}}else{if(navigator.mimeTypes["application/x-googlegears"]){b=document.createElement("object");b.setAttribute("type","application/x-googlegears");b.setAttribute("width",0);b.setAttribute("height",0);b.style.display="none";document.documentElement.appendChild(b);}}}if(!b){return null;}return apf.nameserver.register("google","gears",b);};apf.runIphone=function(){if(!apf.isIphone){return;}$setTimeout(function(){apf.importCssString('html, body {                margin: 0;                font-family: Helvetica;                background: #fff;                color: #000000;                overflow-x: hidden;                -webkit-user-select: none;                -webkit-text-size-adjust: none;                -webkit-touch-callout: none;            }            body > *:not(.toolbar) {                min-height: 372px;            }            body[orient="landscape"] > *:not(.toolbar) {                min-height: 268px;            }            body > *[selected="true"] {                display: block;            }',"screen");var o=document.getElementsByTagName("head")[0];if(apf.config.iphoneIcon){var q=document.createElement("link");q.setAttribute("rel","apple-touch-icon"+(apf.config.iphoneIconIsGlossy?"":"-precomposed"));q.setAttribute("href","apf.config.iphoneIcon");o.appendChild(q);}function r(s,t){var u=document.createElement("meta");u.setAttribute("name",s);u.setAttribute("content",t);o.appendChild(u);}if(apf.config.iphoneFixedViewport){r("viewport","width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0;");}if(apf.config.iphoneFullScreen){r("apple-mobile-web-app-capable","yes");if(apf.config.iphoneStatusBar){r("apple-mobile-web-app-status-bar-style","apf.config.iphoneStatusBar");}}});var b=false,d=0,k="portrait",g="landscape",j=null;apf.addDomLoadEvent(function(){$setTimeout(c,0);j=setInterval(c,300);});function n(){switch(window.orientation){case 0:m(k);break;case 90:case -90:m(g);break;}}if(typeof window.onorientationchange=="object"){window.onorientationchange=n;b=true;$setTimeout(n,0);}function c(){if(!b){if(window.innerWidth!=d){d=window.innerWidth;var o=d==320?k:g;m(o);}}}function m(o){document.body.setAttribute("orient",o);$setTimeout("scrollTo(0,1)",100);}["gesturestart","gesturechange","gestureend","orientationchange"].forEach(function(o){document["on"+o]=function(q){if(apf.dispatchEvent){apf.dispatchEvent(o,q);}};});apf.iphone={titleNode:null,linkEvents:function(r,q){return;r[q?"onclick":"ontouchstart"]=function(s){if(!s.touches||s.touches.length!=1){return;}var t=s.touches[0];if(typeof this.onmousedown=="function"){this.onmousedown(t);if(this!=document){return false;}}};r.ontouchmove=function(s){if(!s.touches||s.touches.length!=1){return;}var t=s.touches[0];if(typeof this.onmousemove=="function"){this.onmousemove(t);if(this!=document){return false;}}};var o=false;r.ontouchend=r.ontouchcancel=function(s){if(o){return;}var t=s.touches&&s.touches.length?s.touches[0]:s.changedTouches[0];if(!t){return;}o=true;$setTimeout(function(){o=false;});if(typeof this.onmouseup=="function"){this.onmouseup(t);if(this!=document){return false;}}};return this;},nav:{sections:null,active:null,def:"home",divideChar:"/",levelTwoChar:"-",go:function(w,t){var u,q,A=apf.iphone.nav;A.update();if(!(q=A.sections[w.page])){return;}scrollTo(0,1);apf.dispatchEvent("pagechange",w);var C=q.getAttribute("title");if(apf.iphone.titleNode&&C){apf.iphone.titleNode.innerHTML=C;}if(t){for(u in A.sections){A.sections[u].hide();}q.show();}else{for(u in A.sections){if(!A.sections[u].visible||u==w.page){continue;}var B=A.sections[u];B.setProperty("zindex",0);apf.tween.single(B.$ext,{steps:5,interval:10,from:B.$ext.offsetLeft,to:(w.index<0)?1000:-1000,type:"left",anim:apf.tween.EASEOUT,onfinish:function(){B.setProperty("visible",false);}});}var s=10,r=q.$ext,o=(w.index<0)?-(r.offsetWidth)-s:window.innerWidth+r.offsetLeft+s;q.setProperty("visible",true);q.setProperty("zindex",apf.all.length+1);apf.tween.single(r,{steps:5,interval:10,from:o,to:0,type:"left",anim:apf.tween.EASEIN});}},update:function(q){if(this.sections&&!q){return;}this.sections={};for(var o in window){if(window[o]&&window[o]["tagName"]&&window[o].tagName=="section"){this.sections[o]=window[o];}}}}};$setTimeout(function(){apf.addEventListener("hashchange",apf.iphone.nav.go);if(location.href.match(/#(.*)$/)){apf.history.init(decodeURI(RegExp.$1));}else{if(apf._GET.page){apf.history.init(apf._GET.page);}else{apf.history.init();}}});document.ontouchstart=function(o){if(!o.touches||o.touches.length!=1){return;}var s=o.touches[0],r=s.target,q=apf.findHost(s.target);if(!q){return;}while(typeof r.onmousedown!="function"&&r!=document.body){r=r.parentNode;}if(typeof r.onmousedown=="function"){if(typeof r.onmouseover=="function"){r.onmouseover(s);}else{if(typeof r.onmousemove=="function"){r.onmousemove(s);}}r.onmousedown(s);return false;}};document.ontouchmove=function(o){if(!o.touches||o.touches.length!=1){return;}var s=o.touches[0],r=s.target,q=apf.findHost(s.target);if(!q){return;}while(typeof r.onmousemove!="function"&&r!=document.body){r=r.parentNode;}if(typeof r.onmousemove=="function"){r.onmousemove(s);return false;}else{if(typeof document.onmousemove=="function"){return document.onmousemove(s);}}};document.ontouchend=document.ontouchcancel=function(o){var s=o.touches&&o.touches.length?o.touches[0]:o.changedTouches[0];if(!s){return;}var r=s.target,q=apf.findHost(s.target);if(!q){return;}while(typeof r.onmouseup!="function"&&r!=document.body){r=r.parentNode;}if(typeof r.onmouseup=="function"){if(typeof r.onmouseout=="function"){r.onmouseout(s);}r.onmouseup(s,true);return false;}else{if(typeof document.onmouseup=="function"){return document.onmouseup(s);}}};};apf.runIE=function(){var b=false,d=false;if(self.XMLHttpRequest){try{new XMLHttpRequest();}catch(c){b=true;}}try{new ActiveXObject("microsoft.XMLHTTP");}catch(c){d=true;}if(d){apf.importClass(runTpIframe,true,self);}apf.getHttpReq=d?function(){if(apf.availHTTP.length){return apf.availHTTP.pop();}return new XMLHttpRequest();}:function(){if(apf.availHTTP.length){return apf.availHTTP.pop();}return new ActiveXObject("microsoft.XMLHTTP");};apf.getXmlDom=d?function(k,g){var j=getDOMParser(k,g);return j;}:function(m,g,k){var j=new ActiveXObject("microsoft.XMLDOM");j.setProperty("SelectionLanguage","XPath");if(k){j.preserveWhiteSpace=true;}if(m){if(apf.cantParseXmlDefinition){m=m.replace(/\] \]/g,"] ]").replace(/^<\?[^>]*\?>/,"");}j.loadXML(m);if(!g){this.xmlParseError(j);}}return j;};apf.xmlParseError=function(j){var g=j.parseError;if(g!=0){throw new Error(apf.formatErrorString(1050,null,"XML Parse error on line "+g.line,g.reason+"Source Text:\n"+g.srcText.replace(/\t/gi," ")));}return j;};apf.getStyle=function(g,j){return g.currentStyle[j];};apf.insertHtmlNodes=function(m,o,k){for(var r=[],n=0,j=m.length;n<j;n++){r[n]=m[n].xml;}r=apf.html_entity_decode(r.join(""));if(apf.isIE<7){r=r.replace(/style="background-image:([^"]*)"/g,"find='$1' style='background-image:$1'");}try{(k||o).insertAdjacentHTML(k?"beforebegin":"beforeend",r);}catch(q){document.body.insertAdjacentHTML("beforeend","<table><tr>"+r+"</tr></table>");var g=document.body.lastChild.firstChild.firstChild;for(n=g.childNodes.length-1;n>=0;n--){o.appendChild(g.childNodes[apf.hasDynamicItemList?0:n]);}}if(apf.isIE<7){$setTimeout(function(){var u=o.getElementsByTagName("*");for(var A,w=0,t=u.length;w<t;w++){if(A=u[w].getAttribute("find")){u[w].style.backgroundImage=A.trim();}}});}};apf.insertHtmlNode=function(k,m,g,o){if(m.nodeType!=11&&!m.style){return m.appendChild(k);}var j=g||m;if(!o){o=apf.html_entity_decode(k.serialize?k.serialize(true):k.xml||k.outerHTML||k.nodeValue);}try{j.insertAdjacentHTML(g?"beforeBegin":"beforeEnd",o);}catch(n){apf.console.warn("Warning found block element inside a "+j.tagName+" element. Rendering will give unexpected results");j.insertAdjacentHTML("afterEnd",o);return j.nextSibling;}if(g){return g.previousSibling;}else{return m.lastChild.nodeType==1?m.lastChild:m.lastChild.previousSibling;}};apf.getHtmlLeft=function(g){return(g.offsetLeft-(apf.isIE>7&&parseInt(g.parentNode.currentStyle.borderLeftWidth)||0));};apf.getHtmlRight=function(g){var j;return(((j=g.offsetParent).tagName=="BODY"?apf.getWindowWidth():j.offsetWidth)-g.offsetLeft-g.offsetWidth-(apf.isIE<8&&parseInt(j.currentStyle.borderLeftWidth)||0)-(parseInt(j.currentStyle.borderRightWidth)||0));};apf.getHtmlTop=function(g){return(g.offsetTop-(apf.isIE>7&&parseInt(g.offsetParent.currentStyle.borderTopWidth)||0));};apf.getHtmlBottom=function(g){var j;return(((j=g.offsetParent).tagName=="BODY"?apf.getWindowHeight():j.offsetHeight)-g.offsetTop-g.offsetHeight-(apf.isIE<8&&parseInt(j.currentStyle.borderTopWidth)||0)-(parseInt(j.currentStyle.borderBottomidth)||0));};apf.getBorderOffset=function(g){return apf.isIE<8&&[0,0]||[parseInt(g.currentStyle.borderLeftWidth)||0,parseInt(g.currentStyle.borderTopWidth)||0];};apf.getOpacity=function(g){return parseInt(((g.currentStyle.filter||"").match(/alpha\(opacity=(\d*)\)/)||[0,0])[1])/100;};apf.setOpacity=function(j,g){j.style.filter="alpha(opacity="+Math.round(g*100)+")";};apf.popup2={cache:{},setContent:function(n,m,k,j,g){if(!this.popup){this.init();}this.cache[n]={content:m,style:k,width:j,height:g};if(m.parentNode){m.parentNode.removeChild(m);}if(k){apf.importCssString(k,this.popup.document);}return this.popup.document;},removeContent:function(g){this.cache[g]=null;delete this.cache[g];},init:function(){this.popup=window.createPopup();this.popup.document.write('<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">                <html xmlns="http://www.w3.org/1999/xhtml" xmlns:a='+apf.ns.aml+' xmlns:xsl="http://www.w3.org/1999/XSL/Transform">                <head>                    <script>                    var apf = {                        all: [],                        lookup:function(uniqueId){                            return this.all[uniqueId] || {                                $setStyleClass:function(){}                            };                        }                    };                    function destroy(){                        apf.all=null;                    }                    <\/script>                    <style>                    HTML{border:0;overflow:hidden;margin:0}                    BODY{margin:0}                    </style>                </head>                <body onmouseover="if(!self.apf) return;if(this.c){apf.all = this.c.all;this.c.Popup.parentDoc=self;}"></body>                </html>');var g=apf;this.popup.document.body.onmousemove=function(){this.c=g;};},show:function(B,t,s,k,n,j,A,w){if(!this.popup){this.init();}var m=this.cache[B];this.popup.document.body.innerHTML=m.content.outerHTML;if(k){var u,r=7,q=0,g=this.popup;u=setInterval(function(){var o=++q*((A||m.height)/r);g.show(t,s,j||m.width,o,n);g.document.body.firstChild.style.marginTop=(q-r-1)*((A||m.height)/r);if(q>r){clearInterval(u);w(g.document.body.firstChild);}},10);}else{this.popup.show(t,s,j||m.width,A||m.height,n);}this.last=B;},hide:function(){if(this.popup){this.popup.hide();}},forceHide:function(){if(this.last){apf.lookup(this.last).dispatchEvent("popuphide");}},destroy:function(){if(!this.popup){return;}this.popup.document.body.c=null;this.popup.document.body.onmouseover=null;}};apf.importClass(apf.runXpath,true,self);};apf.runNonIe=function(){DocumentFragment.prototype.getElementById=function(g){return this.childNodes.length?this.childNodes[0].ownerDocument.getElementById(g):null;};if(XMLDocument.prototype.__defineGetter__){XMLDocument.prototype.__defineGetter__("xml",function(){return(new XMLSerializer()).serializeToString(this);});XMLDocument.prototype.__defineSetter__("xml",function(){throw new Error(apf.formatErrorString(1042,null,"XML serializer","Invalid assignment on read-only property 'xml'."));});Node.prototype.__defineGetter__("xml",function(){if(this.nodeType==3||this.nodeType==4||this.nodeType==2){return this.nodeValue;}return(new XMLSerializer()).serializeToString(this);});Element.prototype.__defineGetter__("xml",function(){return(new XMLSerializer()).serializeToString(this);});}if(typeof HTMLElement!="undefined"){if(!HTMLElement.prototype.insertAdjacentElement){Text.prototype.insertAdjacentElement=HTMLElement.prototype.insertAdjacentElement=function(g,j){switch(g.toLowerCase()){case"beforebegin":this.parentNode.insertBefore(j,this);break;case"afterbegin":this.insertBefore(j,this.firstChild);break;case"beforeend":this.appendChild(j);break;case"afterend":if(this.nextSibling){this.parentNode.insertBefore(j,this.nextSibling);}else{this.parentNode.appendChild(j);}break;}};}if(!HTMLElement.prototype.insertAdjacentHTML){Text.prototype.insertAdjacentHTML=HTMLElement.prototype.insertAdjacentHTML=function(j,m){var k=this.ownerDocument.createRange();k.setStartBefore(apf.isWebkit?document.body:(self.document?document.body:this));var g=k.createContextualFragment(m);this.insertAdjacentElement(j,g);};}if(!HTMLBodyElement.prototype.insertAdjacentHTML){HTMLBodyElement.prototype.insertAdjacentHTML=HTMLElement.prototype.insertAdjacentHTML;}if(!HTMLElement.prototype.insertAdjacentText){Text.prototype.insertAdjacentText=HTMLElement.prototype.insertAdjacentText=function(j,k){var g=document.createTextNode(k);this.insertAdjacentElement(j,g);};}HTMLElement.prototype.removeNode=function(){if(!this.parentNode){return;}this.parentNode.removeChild(this);};if(HTMLElement.prototype.__defineSetter__){HTMLElement.prototype.__defineSetter__("innerText",function(g){var j=""+g;this.innerHTML=j.replace(/\&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");});HTMLElement.prototype.__defineGetter__("innerText",function(){return this.innerHTML.replace(/<[^>]+>/g,"").replace(/\s\s+/g," ").replace(/^\s*|\s*$/g," ");});HTMLElement.prototype.__defineGetter__("outerHTML",function(){return(new XMLSerializer()).serializeToString(this);});}}var c=false;try{XMLDocument.prototype.async=true;c=true;}catch(d){}Document.prototype.onreadystatechange=null;Document.prototype.parseError=0;Array.prototype.item=function(g){return this[g];};Array.prototype.expr="";try{XMLDocument.prototype.readyState=0;}catch(d){}XMLDocument.prototype.$clearDOM=function(){while(this.hasChildNodes()){this.removeChild(this.firstChild);}};XMLDocument.prototype.$copyDOM=function(g){this.$clearDOM();if(g.nodeType==9||g.nodeType==11){var k=g.childNodes;for(var j=0;j<k.length;j++){this.appendChild(this.importNode(k[j],true));}}else{if(g.nodeType==1){this.appendChild(this.importNode(g,true));}}};XMLDocument.prototype.loadXML=function(k){apf.xmldb.setReadyState(this,1);var j=this.xml||this.serialize();var g=(new DOMParser()).parseFromString(k,"text/xml");apf.xmldb.setReadyState(this,2);this.$copyDOM(g);apf.xmldb.setReadyState(this,3);apf.xmldb.loadHandler(this);return j;};Node.prototype.getElementById=function(g){};HTMLElement.prototype.replaceNode=Element.prototype.replaceNode=function(g){if(!this.parentNode){return;}this.parentNode.insertBefore(g,this);this.parentNode.removeChild(this);};XMLDocument.prototype.$load=XMLDocument.prototype.load;XMLDocument.prototype.load=function(m){var g=document.implementation.createDocument("","",null);g.$copyDOM(this);this.parseError=0;apf.xmldb.setReadyState(this,1);try{if(this.async==false&&c){var j=new XMLHttpRequest();j.open("GET",m,false);j.overrideMimeType("text/xml");j.send(null);apf.xmldb.setReadyState(this,2);this.$copyDOM(j.responseXML);apf.xmldb.setReadyState(this,3);}else{this.$load(m);}}catch(k){this.parseError=-1;}finally{apf.xmldb.loadHandler(this);}return g;};var b=apf.getStyle=function(g,j){return(window.getComputedStyle(g,"")||{})[j]||"";};HTMLDocument.prototype.setProperty=XMLDocument.prototype.setProperty=function(g,j){};apf.getHttpReq=function(){if(apf.availHTTP.length){return apf.availHTTP.pop();}return new XMLHttpRequest();};apf.getXmlDom=function(k,g){var j;if(k){j=new DOMParser();j=j.parseFromString(k,"text/xml");if(!g){this.xmlParseError(j);}}else{j=document.implementation.createDocument("","",null);}return j;};apf.xmlParseError=function(j){if(j.getElementsByTagName("parsererror").length){var n=j.documentElement.firstChild.nodeValue.split("\n"),k=n[2].match(/\w+ (\d+)/)[1],m=n[0].replace(/\w+ \w+ \w+: (.*)/,"$1"),g=j.documentElement.lastChild.firstChild.nodeValue.split("\n")[0];throw new Error(apf.formatErrorString(1050,null,"XML Parse Error on line "+k,m+"\nSource Text : "+g.replace(/\t/gi," ")));}return j;};apf.xmldb.setReadyState=function(g,j){g.readyState=j;if(g.onreadystatechange!=null&&typeof g.onreadystatechange=="function"){g.onreadystatechange();}};apf.xmldb.loadHandler=function(g){if(!g.documentElement||g.documentElement.tagName=="parsererror"){g.parseError=-1;}apf.xmldb.setReadyState(g,4);};apf.Init.add(function(){var j,g=document.getElementsByTagName("form");for(j=0;j<g.length;j++){g[j].removeNode();}g=document.getElementsByTagName("xml");for(j=0;j<g.length;j++){g[j].removeNode();}g=null;});if(document.body){document.body.focus=function(){};}apf.getOpacity=function(g){return apf.getStyle(g,"opacity");};apf.setOpacity=function(j,g){j.style.opacity=g;};};apf.runOpera=function(){if(apf.runNonIe){apf.runNonIe();}Document.prototype.selectNodes=XMLDocument.prototype.selectNodes=HTMLDocument.prototype.selectNodes=function(d,c){var k=this.evaluate(d,(c?c:this),this.createNSResolver(this.documentElement),XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);var g=new Array(k.snapshotLength);g.expr=d;for(var j=0;j<g.length;j++){g[j]=k.snapshotItem(j);}return g;};Text.prototype.selectNodes=Element.prototype.selectNodes=function(c){var d=this.ownerDocument;if(!d.selectSingleNode){d.selectSingleNode=HTMLDocument.prototype.selectSingleNode;d.selectNodes=HTMLDocument.prototype.selectNodes;}if(d.selectNodes){return d.selectNodes(c,this);}else{throw new Error(apf.formatErrorString(1047,null,"XPath Selection","Method selectNodes is only supported by XML Nodes"));}};Document.prototype.selectSingleNode=XMLDocument.prototype.selectSingleNode=HTMLDocument.prototype.selectSingleNode=function(d,c){var g=this.selectNodes(d+"[1]",c?c:null);return g.length>0?g[0]:null;};Text.prototype.selectSingleNode=Element.prototype.selectSingleNode=function(c){var d=this.ownerDocument;if(!d.selectSingleNode){d.selectSingleNode=HTMLDocument.prototype.selectSingleNode;d.selectNodes=HTMLDocument.prototype.selectNodes;}if(d.selectSingleNode){return d.selectSingleNode(c,this);}else{throw new Error(apf.formatErrorString(1048,null,"XPath Selection","Method selectSingleNode is only supported by XML Nodes. \nInfo : "+e));}};var b=new XMLSerializer();apf.insertHtmlNodes=function(g,m,d){var k,n=document.createDocumentFragment(),j=0,c=g.length;for(;j<c;j++){if(!(k=g[j])){continue;}n.appendChild(k);}(d||m).insertAdjacentHTML(d?"beforebegin":"beforeend",apf.html_entity_decode(b.serializeToString(n)).replace(/<([^>]+)\/>/g,"<$1></$1>"));};apf.insertHtmlNode=function(d,j,c,g){if(j.nodeType!=11&&!j.style){return j.appendChild(d);}if(!g){g=apf.html_entity_decode(d.serialize?d.serialize(true):((d.nodeType==3||d.nodeType==4||d.nodeType==2)?d.nodeValue:b.serializeToString(d)));}(c||j).insertAdjacentHTML(c?"beforebegin":"beforeend",g.replace(/<([^>]+)\/>/g,"<$1></$1>"));return c?c.previousSibling:j.lastChild;};apf.getHtmlLeft=function(c){return(c.offsetLeft-(parseInt(apf.getStyle(c.parentNode,"borderLeftWidth"))||0));};apf.getHtmlRight=function(c){var d;return(((d=c.offsetParent).tagName=="BODY"?apf.getWindowWidth():d.offsetWidth)-c.offsetLeft-c.offsetWidth-(parseInt(apf.getStyle(d,"borderRightWidth"))||0));};apf.getHtmlTop=function(c){return(c.offsetTop-(parseInt(apf.getStyle(c.offsetParent,"borderTopWidth"))||0));};apf.getHtmlBottom=function(c){var d;return(((d=c.offsetParent).tagName=="BODY"?apf.getWindowHeight():d.offsetHeight)-c.offsetTop-c.offsetHeight-(parseInt(apf.getStyle(d,"borderBottomWidth"))||0));};apf.getBorderOffset=function(c){return[parseInt(apf.getStyle(c,"borderLeftWidth"))||0,parseInt(apf.getStyle(c,"borderTopWidth"))||0];};};apf.runWebkit=function(){HTMLDocument.prototype.selectNodes=XMLDocument.prototype.selectNodes=function(d,c){if(d.substr(0,2)=="//"){d="."+d;}try{var m=this.evaluate(d,(c||this),this.createNSResolver(this.documentElement),7,null);}catch(k){try{var m=this.evaluate("child::"+d,(c||this),this.createNSResolver(this.documentElement),7,null);}catch(k){throw new Error("XPath error: "+k.message+"\nLine: "+k.lineNumber+"\nExpression: '"+d+"'");}}var g=new Array(m.snapshotLength);g.expr=d;for(var j=g.length-1;j>=0;j--){g[j]=m.snapshotItem(j);}return g;};Text.prototype.selectNodes=Element.prototype.selectNodes=function(c){return this.ownerDocument.selectNodes(c,this);};HTMLDocument.prototype.selectSingleNode=XMLDocument.prototype.selectSingleNode=function(d,c){var g=this.selectNodes(d,c||null);return g[0]||null;};Text.prototype.selectSingleNode=Element.prototype.selectSingleNode=function(c){return this.ownerDocument.selectSingleNode(c,this);};var b=new XMLSerializer();apf.insertHtmlNodes=function(j,n,g){var m,o=document.createDocumentFragment(),d=[],k=0,c=j.length;for(;k<c;k++){if(!(m=j[k])){continue;}o.appendChild(m);}(g||n).insertAdjacentHTML(g?"beforebegin":"beforeend",apf.html_entity_decode(b.serializeToString(o)).replace(/<([^>]+)\/>/g,"<$1></$1>"));};apf.insertHtmlNode=function(d,j,c,g){if(j.nodeType!=11&&!j.style){return j.appendChild(d);}if(!g){g=apf.html_entity_decode(d.serialize?d.serialize(true):((d.nodeType==3||d.nodeType==4||d.nodeType==2)?d.nodeValue:b.serializeToString(d)));}(c||j).insertAdjacentHTML(c?"beforebegin":"beforeend",g.replace(/<([^>]+)\/>/g,"<$1></$1>"));return c?c.previousSibling:j.lastChild;};apf.getHtmlLeft=function(c){return c.offsetLeft;};apf.getHtmlRight=function(c){var d;return(((d=c.offsetParent).tagName=="BODY"?apf.getWindowWidth():d.offsetWidth)-c.offsetLeft-c.offsetWidth-(parseInt(apf.getStyle(d,"borderLeftWidth"))||0)-(parseInt(apf.getStyle(d,"borderRightWidth"))||0));};apf.getHtmlTop=function(c){return c.offsetTop;};apf.getHtmlBottom=function(c){var d;return(((d=c.offsetParent).tagName=="BODY"?apf.getWindowHeight():d.offsetHeight)-c.offsetTop-c.offsetHeight-(parseInt(apf.getStyle(d,"borderTopWidth"))||0)-(parseInt(apf.getStyle(d,"borderBottomWidth"))||0));};apf.getBorderOffset=function(c){return[0,0];};if(apf.runNonIe){apf.runNonIe();}};apf.lm=new (function(){var bD={"var":1,"for":1,"while":1,"do":1,"if":1,"else":1,"switch":1,"case":1,"break":1,"continue":1,"default":1,"function":2,"return":1,"try":1,"catch":1,"throw":1,"debugger":1,alert:1,confirm:1,setTimeout:1,setInterval:1,"delete":1,"export":1,"import":1,label:1,foreach:1,each:1,node:1,local:1,yield:1,let:1,"finally":1,"delete":1},aC={"\n":1,"\r\n":1,"==":2,"++":2,"--":2,'"':5,"'":5,"<!--":6,"-->":6,"/*":6,"//":6,"*/":6,"{":7,"}":8,"[":9,"]":10,"(":11,")":12,"<":13,">":14,"+=":2,"-=":2,"/=":2,"*=":2,"!=":2},aU={"{":"}","[":"]","(":")","{{":"}"},aX={ancestor:1,"ancestor-or-self":1,attribute:1,child:1,descendant:1,"descendant-or-self":1,following:1,"following-sibling":1,namespace:1,parent:1,preceding:1,self:1},a5={";":1,",":2,"^":3,"=":4,"+=":4,"-=":4,"/=":4,"*=":4,"/":5,":":6},aW={"~":"_val(_n,","%":"_nod(_n,","*":"_nods(_n,","#":"_cnt(_n,","$":"_lng("},q={"~":"_val(_n,","%":"_xml(_n,","*":"_xmls(_n,","#":"_cnt(_n,","$":"_lng("},bi={"~":"_val(_n,","%":"_val(_n,","*":"_val(_n,","#":"_cnt(_n,","$":"_lng("},bK,I={"~":"_val(_n,","%":"_xml(_n,","*":"_xmls(_n,","#":"_cnt(_n,","$":"_lng("},aq={"~":"_val(_n,","%":"_xml(_n,","*":"_xmls(_n,","#":"_cnt(_n,","$":"_lnged("},n={"[":1,"(":1,",":1,"=":1,"return":1,"throw":1},ag={"else":1,"return":1,"delete":1},aG={"do":1,"else":1,"try":1},ba={"=":"_asn(","+=":"_add(","-=":"_sub(","/=":"_div(","*=":"_mul("},aI={"+":1,"%":1,"-":1,"/":1,"=":1,"(":1,"?":1,"|":1,"^":1,"[":1,"&":1,"*":1,"!":1,":":1,"<":1,",":1},aY={"{":1,"} ":1,")":1,")   ":1,";":1,"\n":1,"else":1},R={"{":1,";":1,"\n":1,"else":1},B={"} ":1,")   ":1,"(":1,";":1,"&":1,"^":1,"|":1,",":1,'"':1,"'":1,"=":1,"!=":2,"+=":2,"-=":2,"/=":2,"*=":2,"?":1,"{":1,"}":1,">":1,"[":1,"+":1,":":1,"else":1,"return":1},L={'"':1,"'":1,">":1,"]":1,"}":1},bA={'\\"':'"',"\\'":"'","\\{":"{","\\}":"}","\\[":"[","\\]":"]","\\(":"(","\\)":")","\\\\":"\\"},bG={alert:1,confirm:1,setTimeout:1,setInterval:1,"switch":1,call:1,"return":1,"throw":1,"case":1,"catch":1,abs:1,acos:1,asin:1,atan:1,atan2:1,ceil:1,cos:1,exp:1,floor:1,log:1,max:1,min:1,pow:1,random:1,round:1,sin:1,sqrt:1,tan:1,lin:1,linear:1,idx:1},u={" ":1,"\n":1},a8={"{":1,";":1,"(":1,"\n":1},bp={"\\{":"{","\\}":"}","\\[":"[","\\]":"]","\\(":"(","\\)":")"},H={"\\{":"{","\\}":"}","\\[":"[","\\]":"]","\\(":"(","\\)":")","\\\\":"\\\\\\\\","\\":"\\\\","\\<":"<","\\>":">"},ay={lte:"<=",gte:">=",lt:"<",gt:">",and:"&&",or:"||",andbin:"&",orbin:"|",LTE:"<=",GTE:">=",LT:"<",GT:">",AND:"&&",OR:"||",ANDBIN:"&",ORBIN:"|"},U={0:"_val(_n,",1:"_valcr(_n,_cr,",2:"_nod(_n,",3:"_nodcr(_n,_cr,",4:"_nods(_n,",5:"_xpt(_n,",6:"_valst(_n,",7:"_valed(_n,",8:"_valattr(_n,",foreach:"_nods(_n,",each:"_nods(_n,",local:"_nod(_n,",tagName:"_nod(_n,",localName:"_nod(_n,",xml:"_xmlq(",_call:"_val(_n,"},a6={"_val(_n,":"_valm(","_valcr(_n,_cr,":"_valcr(0,_cr,","_nod(_n,":"_nodm(","_nodcr(_n,_cr,":"_nodcr(0,_cr,","_nods(_n,":"_nodsm(","_xml(_n,":"_xml(0,","_xmls(_n,":"_xmls(0,","_cnt(_n,":"_cntm(","_xpt(_n,":"_xptm(","_valst(_n,":"_valm(","_valed(_n,":"_valed(0,","_lng(":"_lng(","_lnged(":"_lnged(","_nod_del(_n,":"_nod_del(0,","_nods_del(_n,":"_nods_del(0,"},ah={"=":{"_val(_n,":"_nod_asn(_n,","_valm(":"_nod_asn(0,","_valcr(_n,_cr,":"_nod_asn(_n,","_valcr(0,_cr,":"_nod_asn(0,","_nod(_n,":"_nod_asn(_n,","_nodm(":"_nod_asn(0,","_nodcr(_n,_cr,":"_nod_asn(_n,","_nodcr(0,_cr,":"_nod_asn(0,","_nods(_n,":"_nods_asn(_n,","_nodsm(":"_nods_asn(0,"},"+=":{"_val(_n,":"_nod_add(_n,","_valm(":"_nod_add(0,","_valcr(_n,_cr,":"_nod_add(_n,","_valcr(0,_cr,":"_nod_add(0,","_nod(_n,":"_nod_add(_n,","_nodm(":"_nod_add(0,","_nodcr(_n,_cr,":"_nod_add(_n,","_nodcr(0,_cr,":"_nod_add(0,","_nods(_n,":"_nods_add(_n,","_nodsm(":"_nods_add(0,"}},w={"_cnt(_n,":"_nod_del(_n,","_xpt(_n,":"_nod_del(_n,","_val(_n,":"_nod_del(_n,","_valcr(_n,":"_nod_del(_n,","_nod(_n,":"_nod_del(_n,","_nodcr(_n,_cr,":"_nod_del(_n,","_nods(_n,":"_nods_del(_n,"},ak=/(\r?[\n]|\/\*|\*\/|\/\/|\<\!\-\-|\-\-\>|[=\!+\/\*-]=|\+\+|\-\-|["'{(\[\])}\]\<\>]|$)|([ \t]+)|([a-zA-Z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF.$_][\w.$_]*)|(\d[x\d.]*)|(\\?[\w._?,:;!=+-\\\/^&|*"'[\]{}()%$#@~`<>]?)/g,am=/(^|\|)(?!\@|text\(\)|\.\.|[\w\-\:]+?\:\:)/g,aE={},aJ={},aF={},bB=apf.$asyncObjects||{comm:1,rpc:1,http:1,"apf.ajax":1},aL,bI,aM,m,aR,bs,at,au,aj,bl,aN,bL,bJ,Y,al=[],bk,aA=[],aB=[],bv,bc,A,bw,bN,M,aH,bu,ar,F,by,aP,ae,aZ,ap,aO,bh,br,Q;aE["if"]="if(",aJ["if"]=")",aE["while"]="while(",aJ["while"]=")",aE["for"]="for(",aJ["for"]=")",aE["switch"]="switch(",aJ["switch"]=")",aE["catch"]="catch(",aJ["catch"]=")",aJ["function"]=")  ";aE.foreach=aE.each="\nfor(var _t=_t||[],_t=(_t.push(_n,0,(";aJ.foreach=aJ.each=")||[]),_t);(_n=_t[_t.length-1][_t[_t.length-2]++])||(_t.length-=2,_n=_t.pop(),0);)";aE.local="\nfor(var _t=_t||[],_t=(_t.push(_n,((_n=_local(";aJ.local=")),1)),_t);(_t[_t.length-1]--&&_n)||(_t.length--,_n=_t.pop(),0);)";aE.localName="_localName(_n",aJ.localName=")";aE.output="_o.join(''",aJ.output=")";aE.reset="(_o=[],l=0",aJ.reset=")";aE.index="apf.getChildNumber(_n",aJ.index=")",aE.item="(_t[_t.length-1][_t[_t.length-2]-1]",aJ.item=")",aE.first="(_t[_t.length-2]==1",aJ.first=")",aE.last="(_t[_t.length-2]==_t[_t.length-1].length",aJ.last=")",aE.total="(_t[_t.length-1].length",aJ.total=")",aE.pos="(_t[_t.length-2]-1",aJ.pos=")",aE.tagName="_tagName(_n",aJ.tagName=")";aE._nodeValue="_nodeValue(_n",aJ._nodeValue=")";aJ.async="])";aJ.precall="])";aJ._call=")";var T={_call:".call(_n",localName:aE.localName,tagName:aE.tagName,nodeValue:aE.nodeValue,index:aE.index},E="(function(){var _o=[],_l=0;\n",P=";return _l==1?_o[0]:_o.join('');})()",D="_async(_n,_c,_a,_w,_f,this,",G="',_a[++_a.i]||[",K="_r=",ai,ax="_o[_l++]=",bF="",aV="{var _o=[],_l=0,_n=this;\n",a7=";\nreturn _l==1?_o[0]:_o.join('');}",a4="(_a=_a||{}).i=0;try{\n",bf="}catch(_e){if(_e.x)return;throw(_e);}\n",a3="(_a=_a||{}).i=0;try{_pc(_w);",be="}catch(_e){if(_e.x)return;throw(_e);}",bg="with(_w){",bo="}",bC="var _o=[],_l=0;_o[_l++]=",Z="var _o=[],_l=0;\n",bM=";\nreturn _ret(_l==1?_o[0]:_o.join(''));",W=";\n_c(_ret(_l==1?_o[0]:_o.join('')),apf.SUCCESS,apf.$lmx);apf.$lmx=null;",ao="return _ret(",az=");",a9="_c(_ret(",bj="),apf.SUCCESS,apf.$lmx);apf.$lmx=null;\n",J="var _r=",t="var _r;",S=";\nreturn _r;",d=";\n_c(_r,apf.SUCCESS,apf.$lmx);apf.$lmx=null;",c=";\n_c(0,apf.SUCCESS,apf.$lmx);apf.$lmx=null;;",a2="return ",bd="",aT="_c(",a1=",apf.SUCCESS);",bb="var _f=function(_n,_c,_w,_a){",g="var _f=function(_n,_w){",k="var _f=function(_n){",ad="var _f=function(_n,_c,_w,_cr,_a){",j="var _f=function(_n,_w,_cr,){",an="var _f=function(_n,_cr){",aa="var _f=function(event,_c,_w,_a,_n){",bm="var _f=function(event,_w,_n){",ac="var _f=function(event,_n){",C="}",V="var _f=function(_m){",O=";\nif(_n=_r){if(!_n.nodeType)_n=_m;",aw=";\nif(_n=",aD="){if(!_n.nodeType)_n=_m;",bn="\nreturn ",aS="\nreturn _ret(",a0=");",b="\nreturn _n;",bx="\nreturn (_r = (",bH="))?(_r.nodeType?_r:_n):(_r===null?null:_n);",bq="var _r, _n = _m;",N=";\n_n = _m;",r="\nreturn _ret(_nodeValue(_n));",aQ="\nreturn _n;",bE="\n}";function ab(o){var bt,s;if(at[bc-1]=="{{"){bt=bc-1;}else{for(s=bk-2,bt=0;s>=0&&at[bt=(al[s]&268435455)-1]!="{{";s-=2){}}if(!o&&au>bt+1){at[bt]=E+ax;}else{at[bt]=E;}bv=1;}function aK(bV,bP,s,bO,o,bt,bR){var bU,bT,bS,bQ=bP?aC[bP]:(s?0:(bO?3:(o?4:(bV?2:15))));switch(bv){case 0:case 1:switch(bQ){case 0:if((F==3&&ar!="$")||F==4){at[au++]=" ";}else{if(aW[ar]){F=0;}}break;case 1:aH++,bh=bR;if(at[au-1]!="\n"&&!a8[ar]){at[au++]="\n";}if(aW[ar]){F=0;}break;case 2:if(bT=a5[bV]){switch(bT){case 1:if(!al[bk-1]){at[au++]=")",bk-=2;}if(!bv){if(at[au-1]!="\n"&&ar!="{"&&ar!=";"){at[au++]="\n";}}else{if(!bk||al[bk-1]){at[au++]=";";}}break;case 2:if(!al[bk-1]){at[au++]=")",bk-=2;}at[au++]=",";break;case 3:if(at[au-1]=="\n"||at[au-1]==";"||ar=="{"||ar=="} "||au==bc){if(!bv){ab();}at[au++]="  ";}else{at[au++]="^";}break;case 4:if(ar!="<"&&ar!=">"){if(!bv&&at[bc-1]!="("){ab(true);}at[au++]=bV;for(bT=au;bT>=bc&&!bD[at[bT]]&&!((at[bT]=="  "||at[bT]==(bu?ax:ai))&&(at[bT]="",1));bT--){}if(F==3&&by>0&&ar.charAt(0)!="."){if(aR){au-=2;while(u[at[au]]){au--;}bS=ar;at[au++]=ba[bV],at[au++]=bS.slice(0,by),at[au++]=",'",at[au++]=bS.slice(by+1),at[au++]="',",al[bk++]=bc|(bv<<28),al[bk++]="";}}else{if(at[bT=au-2]==") "){if(!(bU=ah[bV])||!(bU=bU[at[bS=al[bk]&268435455]])){throw {t:"Invalid xpath assign",p:bR};}at[bS]=bU,at[bT]=",",at[bT+1]="",at[bT+2]="";al[bk++]=bc|(bv<<28),al[bk++]="";}}}else{at[au++]=bV;}break;case 5:if(n[ar]){al[bk++]=bc|(bv<<28);al[bk++]=at[au++]=bV;bc=A=au-1;bu++,bv=5,bw=bV;}else{at[au++]="/";}break;case 6:if(bk>2&&al[bk-1]=="{{"&&(au<bc+4&&F==5)||(au<bc+3&&(F==3||F==4))){at[bc-1]=al[bk-1]="{";bv=(bT=al[bk-2])>>28;al[bk-2]=bT&268435455,bu--;}else{if(at[au-3]=="case"||(F==5&&Q=="case")){bV=";";}}at[au++]=":";break;default:at[au++]=bV;break;}}else{at[au++]=bA[bV]||bV;}break;case 3:case 4:bT=bU=bS=0;by=(Q=bV).lastIndexOf(".");if(bV.charAt(0)!="."&&((bT=(bU=((aY[ar]||at[au-1]=="\n")&&!aI[ar]))&&!al[bk-1].indexOf("{")&&au>bc)||(bS=bD[bV]))&&!bv){if(bS==2&&al[bk-1].indexOf("{")){bS=0;}ab(bS);}if(bU&&!al[bk-1]){at[au-1]=="\n"&&(at[au-1]=""),at[au++]=")",at[au++]="\n",bT=1,bk-=2;}if(bT&&bv&&!bD[bV]&&!bG[bV]){at[au++]=(bu?ax:ai);}if(by>0&&bV.charAt(0)!="."){aN[at[au++]=ae=bV]=1;}else{at[au++]=ay[bV]||bV;}break;case 5:if((bT=(bU=((aY[ar]||at[au-1]=="\n")&&!aI[ar]))&&!al[bk-1].indexOf("{")&&au>bc)&&!bv){ab();}if(bU&&!al[bk-1]){at[au-1]=="\n"&&(at[au-1]=""),at[au++]=")",at[au++]="\n",bT=1,bk-=2;}if(bT){at[au++]=(at[au-2]!="\n"&&L[ar])?"+":(bu?ax:ai);}else{if(L[ar]){at[au++]="+";}}al[bk++]=bc|(bv<<28),al[bk++]=at[au++]=bV;bc=A=au-1,bu++,bv=5,bw=bV;break;case 6:if(bV=="*/"||bV=="-->"){throw {t:"Unmatched comment "+bV,p:bR};}aZ=bv,ap=ar,aO=F,bv=6,bw=bV;break;case 7:if(at[au-1]==")  "||(at[au-2]==")  "&&au--)){if(al[bk-1]!="("&&al[bk-1]!="["){al[bk++]=bc|(bv<<28),al[bk++]="{{",at[au++]=aV,bc=au,bv=1,bu++,at[au++]="";}else{al[bk++]=bc,al[bk++]=at[au++]=bV,bc=au;bv=1;}}else{if((aE[al[bk+1]]&&ar==")   ")||aG[ar]){al[bk++]=bc,al[bk++]=at[au++]=bV,bc=au;at[au++]="";}else{if((bT=(bU=((aY[ar]||at[au-1]=="\n")&&!aI[ar]))&&!al[bk-1].indexOf("{")&&au>bc)&&!bv){ab();}if(bU&&!al[bk-1]){at[au-1]=="\n"&&(at[au-1]=""),at[au++]=")",at[au++]="\n",bT=1,bk-=2;}if(bT){at[au++]=(at[au-2]!="\n"&&L[ar])?"+''+":(bu?ax:ai);}else{if(L[ar]){at[au++]=(ar=="}")?"+''+":"+";}}al[bk++]=bc|(bv<<28),al[bk++]=at[au++]="{{";if(!bu&&bc!=au){bL++;}bu++,A=bc=au,bv=0;}}break;case 8:if(!al[bk-1]){at[au++]=")",at[au++]="\n",bk-=2;}if(aU[bT=al[--bk]]!=(at[au++]=bV)){throw {t:"Cannot close "+bT+" with "+bV,p:bR};}if(bT=="{{"){if(bc==au-1){if((al[bk-1]>>28)<=1){at[bc-1]="{",at[au-1]="}";}else{at[bc-1]=at[au-1]="'";}}else{if(!bv){at[bc-1]="(",at[au-1]=")";}else{if(at[bc-1]==aV){if(bc==au-2){at[bc-1]="{",at[au-1]="}";}else{at[au-1]=a7;}}else{at[au-1]=P;}}}bv=(bT=al[--bk])>>28,bc=bT&268435455;A=au,bu--;if(!bu){bL++;}if(bv==7){at[au++]='+"\\"',bv=4;}}else{bc=al[--bk];}break;case 9:if(((F==3&&!ag[ar]&&ar!="$")||ar==")"||ar=="]")&&at[au-1]!="\n"){at[au++]="[",al[bk++]=bc|(bv<<28),al[bk++]=bV,A=bc=au;}else{aP=null;if((bS=aW[ar])){au--,ar=at[au-1];if(at[au-1]=="delete"||(at[au-2]=="delete"&&au--)){bS=w[bS],au--;}}else{bS=U[al[bk-1]]||U[bu?0:aL];if(ar=="delete"){bS=w[bS],au-=2;}}if((bT=(bU=((aY[ar]||at[au-1]=="\n")&&!aI[ar]))&&!al[bk-1].indexOf("{")&&(au>bc||al[bk-1].length==1))&&!bv){ab();}if(bU&&!al[bk-1]){at[au-1]=="\n"&&(at[au-1]=""),at[au++]=")",at[au++]="\n",bT=1,bk-=2;}if(bT){at[au++]=(at[au-2]!="\n"&&L[ar])?"+":(bu?ax:ai);}else{if(L[ar]){at[au++]="+";}}if(!bu&&au!=bc){bL++;}bu++,al[bk++]=bc|(bv<<28),al[bk++]=at[au++]=bS,A=bc=au,aA[bc]=bR,bv=3;}break;case 10:if(!al[bk-1]){at[au++]=")",bk-=2;}if(aU[bT=al[--bk]]!=(at[au++]=bV)){throw {t:"Cannot close "+bT+" with "+bV,p:bR};}bc=al[--bk]&268435455;break;case 11:if(((bT=(bU=((R[ar]||at[au-1]=="\n")&&!aI[ar]))&&!al[bk-1].indexOf("{")&&au>bc))&&!bv){ab();}if(bU&&!al[bk-1]){at[au-1]=="\n"&&(at[au-1]=""),at[au++]=")",at[au++]="\n",bT=1,bk-=2;}if(bT&&bv){at[au++]=(bu?ax:ai),F=0;}if(bS=aE[ar]){if(at[au-1]==" "){au--;}at[au-1]=bS,al[bk++]=bc,al[bk++]=ar,bc=A=au;}else{if(F==3){if(by<0){bT=0;if(ar=="function"||at[au-3]=="function"||at[au-4]=="function"){al[bk++]=bc,al[bk++]="function",at[au++]="(",bc=A=au;if(ar!="function"&&bs&&bk==4){at[bT=(at[au-4]=="function")?(au-4):(au-5)]="var "+ar+" = self."+ar+" = function";at[bT+2]="";}}else{if(!bG[ar]&&at[au-3]!="new"){at[au++]=".call(_n",al[bk++]=bc,al[bk++]="_call",bc=A=au;}else{al[bk++]=bc,al[bk++]=at[au++]=bV,bc=A=au;}}}else{if(by>1&&(bB[bT=ar.substring(0,by)]||bB[bT=ar])){if(at[--au]==" "){au--;}at[au++]=D,at[au++]=bT,at[au++]=",'";at[au++]=ar.slice(by+1);at[au++]=G,al[bk++]=bc,al[bk++]="async",bc=A=au,aj++;}else{if(ar.indexOf(".")!=by){aN[ar.slice(0,by)]=1;}al[bk++]=bc,al[bk++]=at[au++]=bV,bc=A=au;}}}else{al[bk++]=bc,al[bk++]=at[au++]=bV,bc=A=au;}if(ar==ae){delete aN[ar];}}break;case 12:if(!al[bk-1]){at[au-1]=="\n"&&(at[au-1]=""),at[au++]=")",at[au++]="\n",bT=1,bk-=2;}if(bS=aJ[bT=al[--bk]]){if(bT!="_call"){bV=")   ";}if((bU=T[bT])&&bU!=at[au-1]){at[bc-1]=bU+",";}at[au++]=bS;}else{if(aU[bT]!=(at[au++]=bV)){throw {t:"Cannot close "+bT+" with "+bV,p:bR};}}bc=al[--bk]&268435455;break;case 13:if(au==bc||B[ar]||at[au-1]=="\n"){if((bT=(bU=((aY[ar]||at[au-1]=="\n")&&!aI[ar]))&&!al[bk-1].indexOf("{")&&au>bc)&&!bv){ab();}if(bU&&!al[bk-1]){at[au-1]=="\n"&&(at[au-1]=""),at[au++]=")",at[au++]="\n",bT=1,bk-=2;}if(bT){at[au++]=(at[au-2]!="\n"&&L[ar])?"+''+":(bu?ax:ai);}else{if(L[ar]){at[au++]="+";}}br=null,at[au++]='"',at[au++]="<",bu++,al[bk++]=bc|(bv<<28),bk+=3,al[bk-2]=al[bk-1]=0;A=bc=au-1,bv=4;}else{at[au++]="<";}break;case 14:at[au++]=">";break;case 15:if(bk&&!al[bk-1]){at[au-1]=="\n"&&(at[au-1]=""),at[au++]=")",at[au++]="\n",bT=1,bk-=2;}break;}break;case 2:switch(bQ){case 1:aH++,bh=bR;if(au!=bc&&au!=A){at[au++]="\\n";}break;case 2:if(au==A){at[au]=(au++==bc)?'"':'+"';}at[au++]=H[bV]||bV;break;case 3:if(au==A){at[au]=(au++==bc)?'"':'+"';}if(bV.charAt(bV.length-1)=="$"){at[au++]=bV.slice(0,-1);at[au++]=bV="$";}else{at[au++]=bV;}break;case 5:if(au==A){at[au]=(au++==bc)?'"':'+"';}at[au++]=(bV=='"')?'\\"':"'";break;case 7:if(au==A){if(au!=bc){at[au++]="+";}}else{at[au++]='"+',bu||bL++;}al[bk++]=bc|536870912,al[bk++]=at[au++]="{{",bu++,A=bc=au,bv=0;break;case 9:aP=null;if((bS=q[ar])&&at[au-1]==ar){if(--au-1==bc){au--;}}else{bS=U[(bu||bc!=au)?0:aL];}if(au!=bc){at[au]=(au++==A)?"+":(bu||bL++,'"+');if(!bu){bL++;}}al[bk++]=bc|536870912,al[bk++]=at[au++]=bS,A=bc=au,bu++,bv=3;break;case 15:if(bk){throw {t:"Unclosed "+al[bk-1]+" found at end in textmode",p:bR};}if(au!=bc&&au!=A){at[au++]='"',bu||bL++;}break;default:if(au==A){at[au]=(au++==bc)?'"':'+"';}at[au++]=bV;}break;case 3:switch(bQ){case 0:if(au!=bc){if(au==A){at[au++]='+"';}at[au++]=bV;}break;case 1:aH++,bh=bR;break;case 2:if(bV==":"&&ar==":"&&!aX[bS=at[au-2]]&&((bT=al[bk-2])>>28)!=6){if(at[au-2]=='+"'){at[au-2]=at[au-1]="",aP="#";}else{at[au-1]='"';if(A==bc){aP=at.slice(A+1,au-1).join("");}else{aP="#";}}if(!(bS=a6[at[bc-1]])){throw {t:"Invalid model found for: "+at[bc-1],p:bR};}at[bc-1]=bS,at[au++]=",",A=bc=au;}else{if(bV==","&&(bT=(al[bk-2]>>28))<=1){au=bc-1,bU=bN.slice(aA[bc]+1,bR+1);F=9,bv=bT,at[au++]=ar="[";al[bk-2]=(al[bk-2]&268435455)|(bv<<28),al[bk-1]=ar,A=bc=au,bu--;if(!bu){bJ--;}if(bU.length>1){aB.push(bN);(bN=bU).replace(ak,aK);bN=aB.pop();}}else{if(au==A){at[au]=(au++==bc)?'"':'+"';}at[au++]=bA[bV]||bV;}}break;case 3:if(au==A){at[au]=(au++==bc)?'"':'+"';}if(bV.charAt(bV.length-1)=="$"){at[au++]=bV.slice(0,-1);at[au++]=bV="$";}else{at[au++]=bV;}break;case 5:if(au==A){at[au]=(au++==bc)?'"':'+"';}if(al[bk-1]=="["){al[bk-1]=bV;}else{if(al[bk-1]==bV){al[bk-1]="[";}}if(bV=='"'){at[au++]="\\";}at[au++]=bV;break;case 7:if(au==A){if(au!=bc){at[au++]="+''+";}}else{at[au++]='"+';}al[bk++]=bc|805306368,al[bk++]=at[au++]="{{",bu++,A=bc=au,bv=0;if(aP&&al[bk-3]!=q["$"]){bl.push(aP,"#");aP=null,Y++;}break;case 9:if(al[bk-1]=="'"||al[bk-1]=='"'||((F!=3||ar=="$")&&ar!=")"&&ar!="]")){if(aP){bl.push(aP,"#"),Y++;}aP=null;if((bS=q[ar])&&at[au-1]==ar){au--;}else{bS=U[0];}if(au==A){if(au!=bc){at[au++]="+";}}else{at[au++]='"+';}al[bk++]=bc|805306368,al[bk++]=at[au++]=bS,bu++,A=bc=au,bv=3;}else{if(au==A){at[au]=(au++==bc)?'"':'+"';}al[bk++]=bc|1610612736,al[bk++]=at[au++]="[";}break;case 10:bk--,bv=(bS=al[--bk])>>28,bS=bS&268435455;if(bv==6){if(al[bk+1]!="["){throw {t:"In xpath, cannot close "+al[bk+1]+" with "+bV,p:bR};}if(au==A){at[au]=(au++==bc)?'"':'+"';}at[au++]="]";bv=3;}else{if(au==bc){if((al[bk]>>28)<=1){at[bc-1]="[",at[au++]="]";}else{at[bc-1]=at[au++]='"';}A=au;}else{if(au!=A){at[au++]='"';}if(A==bc){bT=at.slice(A+1,au-1).join("");if(m&&at[bc-1]!=","&&bT!=(bU=bT.replace(am,"$1self::"))&&al[bk+1]!=q["$"]){at[bc+1]=bT=bU;for(bU=bc+2;bU<au-1;bU++){at[bU]="";}}}else{if((bU=at[bc-1])!=","){bT="#";if(m){at[bc-1]=bU+"_injself(",at[au++]=")";}}else{bT="";}}if(al[bk+1]!=q["$"]&&bT){bl.push(aP,bT);if(aP){Y++;}}at[au++]=") ",A=au;if(bv==7){at[au++]='+"\\"',bv=4;}}bu--,aP=null;if(!bu){bL++,bJ++;}}bc=bS;break;case 11:if(au==A){at[au]=(au++==bc)?'"':'+"';}al[bk++]=bc|805306368,al[bk++]=at[au++]="(";break;case 12:if(au==A){at[au]=(au++==bc)?'"':'+"';}if(aU[bT=al[--bk]]!=(at[au++]=bV)){throw {t:"Cannot close "+bT+" with "+bV,p:bR};}bc=al[--bk]&268435455;break;case 15:throw {t:"Unexpected end whilst parsing xpath",p:bR};break;default:if(au==A){at[au]=(au++==bc)?'"':'+"';}at[au++]=bV;break;}break;case 4:switch(bQ){case 0:if(au==A){at[au++]='+"';}at[au++]=" ",F=0;break;case 1:if(au==A){at[au++]='+"';}aH++,bh=bR,at[au++]="\\n",F=1;break;case 2:if(au==A){at[au++]='+"';}if(bV=="/"&&ar=="<"){bk-=4;if(al[bk]||al[bk+2]){throw {t:"Unexpected closing tag whilst parsing xml",p:bR};}}else{if(bV==":"&&F==3&&at[au-2]=="<"){br=ar;}}at[au++]=H[bV]||bV;break;case 3:if(au==A){at[au++]='+"';}if(bV.charAt(bV.length-1)=="$"){at[au++]=bV.slice(0,-1);at[au++]=bV="$";}else{at[au++]=bV;}break;case 5:if(au==A){at[au++]='+"';}if(bV=='"'){at[au++]="\\";}at[au++]=bV;break;case 6:if(bV=="//"&&!al[bk-1]){if(au==A){at[au++]='+"';}at[au++]=bV;}else{if(bV=="*/"){throw {t:"Unmatched comment "+bV,p:bR};}aZ=bv,ap=ar,aO=F,bv=6,bw=bV;}break;case 13:br=null;if(au==A){at[au++]='+"';}at[au++]=bV,al[bk]=al[bk+2]=0,bk+=4,al[bk-1]=0;break;case 14:if(au==A){at[au++]='+"';}at[au++]=bV;if(ar!="<"){if(ar=="/"){bk-=4;if(al[bk+2]){throw {t:"Unexpected / whilst parsing xml",p:bR};}if(at[au-3]=="<"){au-=2,at[au-1]="";}}else{bk-=2;}if(al[bk]){bu--,at[au++]='"',bc=al[bk],A=au,bv=bc>>28,bc=bc&268435455;}else{al[bk-1]=1;}}else{au--,at[au-1]="";}break;case 9:aP=null;if(ar=="!"&&at[au-2]=="<"&&!al[bk-1]){at[au++]=bV,al[bk++]=bc|(bv<<28);al[bk++]="]]>",bc=A=au-1;bu++,bv=5;}else{if(al[bk-1]){if((bT=bK[ar])){au--;}else{bT=U[br?bI:0];}al[bk++]=bc|1073741824;}else{al[bk++]=bc|1073741824;if((bT=bi[ar])){au--;if(at[au-1]=="="){ar="=";}}else{bT=U[br?aM:8];}if(ar=="="){at[au++]='\\"',al[bk-1]=bc|1879048192;}}at[au]=(au++==A)?"+''+":'"+';bu++,al[bk++]=at[au++]=bT,A=bc=au,bv=3;}break;case 7:if(!al[bk-1]&&ar=="="){at[au++]='\\"',al[bk++]=bc|1879048192;}else{al[bk++]=bc|1073741824;}at[au]=(au++==A)?"+''+":'"+';al[bk++]=at[au++]="{{",bu++;A=bc=au,bv=0;break;default:if(au==A){at[au++]='+"';}at[au++]=bV;break;case 15:throw {t:"Unexpected end whilst parsing xml",p:bR};break;}break;case 5:switch(bQ){case 1:aH++,bh=bR;if(au==A){at[au]=(au++==bc)?'"':'+"';}at[au++]="\\n";break;case 2:if(bV=="/"&&al[bk-1]=="/"){at[au++]="/",bc=al[bk-=2],A=au,bv=bc>>28,bc=bc&268435455,bu--;}else{if(au==A){at[au]=(au++==bc)?'"':'+"';}at[au++]=(al[bk-1]!="/"&&bp[bV])||bV;}break;case 3:if(au==A){at[au]=(au++==bc)?"":'+"';}if(bV.charAt(bV.length-1)=="$"){at[au++]=bV.slice(0,-1);at[au++]=bV="$";}else{at[au++]=bV;}break;case 5:if(al[bk-1]==bV){if(bc!=A){at[au]=(au++!=A)?(bV+")"):")";}else{at[au++]=bV;}bc=al[bk-=2],A=au,bv=bc>>28;bc=bc&268435455,bu--;}else{if(au==A){at[au]=(au++==bc)?'"':'+"';}at[au++]=bV=='"'?'\\"':bV;}break;case 6:if(al[bk-1]=="/"&&bV=="*/"){at[au++]="*/",bc=al[bk-=2],A=au,bv=bc>>28,bc=bc&268435455,bu--;}else{if(au==A){at[au]=(au++==bc)?"":'+"';}at[au++]=bV;}break;case 7:if(al[bk-1]!="'"&&al[bk-1]!="/"){if(al[bk-1]=='"'){at[bc]='("';}if(au==A){if(au!=bc){at[au++]="+";}}else{at[au++]='"+';}al[bk++]=bc|1342177280,at[au++]=al[bk++]="{{",bu++,A=bc=au,bv=0;}else{at[au++]=bV;}break;case 9:if(al[bk-1]!="'"&&al[bk-1]!="/"&&(al[bk-1]=='"'&&(at[bc]='("')||au!=bc+2||ar!="CDATA")){aP=null;if((bS=q[ar])&&at[au-1]==ar){au--;}else{bS=U[0];}if(au!=bc){at[au]=(au++==A)?"+":'"+';}al[bk++]=bc|1342177280,al[bk++]=at[au++]=bS,A=bc=au,bu++,bv=3;}else{at[au++]=bV;}break;case 14:if(au==A){at[au]=(au++==bc)?"":'+"';}at[au++]=bV;if(al[bk-1]=="]]>"&&ar=="]"&&at[au-3]=="]"){bc=al[bk-=2],bv=bc>>28;bc=bc&268435455,bu--;bk-=4;if(al[bk]){bu--,at[au++]='"',bc=al[bk],A=au,bv=bc>>28,bc=bc&268435455;}else{al[bk-1]=1;}}break;case 15:throw {t:"Unexpected end whilst parsing string",p:bR};break;default:if(au==A){at[au]=(au++==bc)?"":'+"';}at[au++]=bV;break;}break;case 6:switch(bQ){case 1:aH++,bh=bR;if(bw=="//"){bv=aZ,bV=ar=ap,bQ=F=aO;}break;case 6:if((bw=="/*"&&bV=="*/")||(bw=="<!--"&&bV=="-->")){bv=aZ,bV=ar=ap,bQ=F=aO;}break;case 15:if(bw!="//"){throw {t:"Unexpected end whilst parsing comment",p:bR};}else{bv=aZ,bV=ar=ap,bQ=F=aO;if(bk&&!al[bk-1]){at[au-1]=="\n"&&(at[au-1]=""),at[au++]=")",at[au++]="\n",bT=1,bk-=2;}}break;}break;}if(bQ>1){ar=bV,F=bQ;}}this.lastCode=function(){if(typeof(at)=="object"){return at.join("");}return at;};function bz(bt,o,s){if(bt.t){throw new Error(apf.formatErrorString(0,null,"Parsing live markup source","Error whilst parsing: "+bt.t+" on line:"+aH+" col:"+(bt.p-o-2)+(s?(" part: "+s):"")+"\n"+bN));}else{throw new Error(apf.formatErrorString(0,null,"Compiling live markup function","Error whilst compiling: "+bt.message+"\nInput:\n"+bN+"\nGenerated:\n"+apf.lm.lastCode()));}}var af={},X={};this.resetCache=function(){af={};};var av=/^\s*~~(c\d+)~~/;this.compile=function(s,o){if(!o){o=X;}if(s==null||!s.length){return o.nostring?function(){return s;}:{type:2,str:s};}var bQ,bO;if(s.charAt(0)=="~"&&(bQ=s.match(av))){if(bQ=apf.lm_exec[bQ[1]]){return bQ;}alert("ERROR, undefined live markup cache marker found:"+s);return{type:2,str:s};}var bt=(o.xpathmode|(o.withopt&&16)|(o.precall&&32)|(o.alwayscb&&64)|(o.nostring&&128)|(o.parsecode&&256)|(o.nostate&&512)|(o.editable&&1024)|(o.langedit&&2048)|(o.injectself&&4096)|(o.event&&8192)|(o.funcglobal&&16384))+s;if(bQ=af[bt]){return bQ;}m=o.injectself,aL=o.xpathmode||0,aM=o.nostate?0:6,bI=o.editable?7:0;bs=o.funcglobal;bK=o.langedit?aq:I;aN={},bl=[],al=[],at=["","","",""],bN=s,M=bN.length;au=bc=A=at.length,bL=bJ=aj=Y=bu=aH=F=bh=0;if(o.parsecode){bv=0,bk=2,al[0]=au,al[1]="{{",ar="{",ai=o.event?"":(aL<=1?ax:K);}else{bv=2,bk=ar=0,ai=ax;}if(o.nothrow){bN.replace(ak,aK);}else{try{bN.replace(ak,aK);}catch(bP){bz(bP,bh);return null;}}if(o.parsecode){if(bu||al[bk-1].length==1){bz({t:"Unclosed "+al[bk-1]+" found at end in codemode",p:M},bh);}if(A!=au){bL++;}}if(!o.nostring&&(bv==2&&A==4||au==4)){return{type:2,str:at.slice(5,-1).join("").replace(/\\n/g,"\n").replace(/\\"/g,'"')};}if(aj||o.alwayscb){if(o.event){if(bv==1){at[3]="";}at[au++]=c;}else{if(aL){if(bv==1){at[3]=(at[3]!=E)?J:t,at[au++]=d;}else{at[3]=aT,at[au++]=a1;}}else{if(bv==1){at[3]=(at[3]!=E)?bC:Z,at[au++]=W;}else{at[3]=a9,at[au++]=bj;}}}if(aj){if(bv==1){if(o.precall){at[2]=a3,at[au-1]=be+at[au-1];}else{at[2]=a4,at[au-1]=bf+at[au-1];}}else{at[au++]=at[3]+"_r"+at[au-2];if(o.precall){at[2]=a3,at[3]=J,at[au-2]=be;}else{at[2]=a4,at[3]=J,at[au-2]=bf;}}}if(o.withopt){at[1]=bg,at[au++]=bo;}at[0]=o.event?aa:((aL==1||aL==3)?ad:bb);at[au++]=C;}else{if(o.event){if(bv==1){at[3]="";}}else{if(aL){if(bv==1){at[3]=(at[3]!=E)?J:t,at[au++]=S;}else{at[3]=a2,at[au++]=bd;}}else{if(bv==1){at[3]=(at[3]!=E)?bC:Z,at[au++]=bM;}else{at[3]=ao,at[au++]=az;}}}if(o.withopt){at[2]=bg,at[au++]=bo;}at[0]=o.event?(o.withopt?bm:ac):(o.withopt?((aL==1||aL==3)?j:g):((aL==1||aL==3)?an:k));at[au++]=C;}if(o.nothrow){bO=apf.lm_exec.compile(at.join(""));}else{try{bO=apf.lm_exec.compile(at.join(""));}catch(bP){bz(bP,bh);return null;}}bO.type=(bL==1&&bJ==1)?3:1;bO.xpaths=bl,bO.models=Y,bO.props=aN,bO.asyncs=aj;af[bt]=bO;return bO;};this.compileMatch=function(bQ,o){if(!o){o=X;}aN={},bl=[],at=[V,bq],al=[],bu=0,au=at.length,bK=I;for(var bO,s,bP=0,bt=bQ.length;bP<bt;bP+=2){if(bN=bQ[bP]){M=al.length,aL=2;if(bP){at[au++]=N;}at[au++]="";al[0]=s=au=bc=A=at.length,ai=K;aH=F=bL=bJ=aj=bv=bh=0;bk=2,al[1]="{{",ar="{";m=1;if(o.nothrow){bN.replace(ak,aK);}else{try{bN.replace(ak,aK);}catch(bS){bz(bS,bh);return null;}}if(bu||al[bk-1].length==1){bz({t:"Unclosed "+al[bk-1]+" found at end in codemode",p:M});}if(aj){bz({t:"Asynchronous calls not supported in match/value"});}if(bv==1){at[s-1]=(at[s-1]!=E)?ai:"",at[au++]=O;}else{at[s-1]=aw,at[au++]=aD;}}if(bN=bQ[bP+1]){M=al.length;if(!bQ[bP]&&bP){at[au++]=N;}at[au++]="";s=au=bc=A=at.length,ai=ax;aL=m=ar=bk=aH=bL=bJ=F=aj=bh=0;if(o.node){aL=2;}bv=2,m=0;if(o.nothrow){bN.replace(ak,aK);}else{try{bN.replace(ak,aK);}catch(bS){bz(bS,bh);return null;}}if(aj){bz({t:"Asynchronous calls not supported in match/value"});}if(o.node){if(bv==2&&A==s||au==s){at[s-1]=b;}else{at[s-1]=bx,at[au++]=bH;}}else{if(bv==2&&A==s||au==s){at[s-1]=bn;}else{at[s-1]=aS,at[au++]=a0;}}if(bQ[bP]){at[au++]=bE;}else{break;}}else{if(!bQ[bP]){bz({t:"Both match and value are empty"});}if(o.node){at[au++]=aQ;}else{at[au++]=r;}aL=2;at[au++]=bE;}}at[au++]=C;var bR;if(o.nothrow){bR=apf.lm_exec.compile(at.join(""));}else{try{bR=apf.lm_exec.compile(at.join(""));}catch(bS){bz(bS,bh);return null;}}bR.type=1,bR.xpaths=bl,bR.props=aN,bR.asyncs=aj;return bR;};this.setWarnLevel=function(o){apf.lm_exec.setWarnLevel(o);};this.parseExpression=function(s,o){if(!o){o=X;}aN={},bl=[],at=[],al=[],bu=0,bK=I;bN=s,M=bN.length;ob=au=bc=A=at.length,ai=ax;aL=m=ar=bk=aH=bL=bJ=F=aj=bh=0;bv=2;if(o.nothrow){bN.replace(ak,aK);}else{try{bN.replace(ak,aK);}catch(bt){bz(bt,bh);return null;}}return at.join("");};})();apf.lm_exec=new (function(){var wlvl=1;this.setWarnLevel=function(lvl){wlvl=lvl;};function wxpath(x,t){apf.console.warn("Live Markup warning in "+t+", no results for xpath: '"+x+"'");}function wnode(x,t){apf.console.warn("Live Markup warning in "+t+", xpath on null node: '"+x+"'");}function wmodel(m,x,t){apf.console.log("Live Markup warning in "+t+", xpath on empty model: '"+m+"' xpath: '"+x+"'");}function wlang(x,t){apf.console.log("Live Markup warning in "+t+", language symbol not found: '"+x+"'");}function xmlParse(str){var n=apf.getXmlDom("<_apflmlist_>"+str+"</_apflmlist_>");if(!n||!(n=n.documentElement)){return null;}return(n.firstChild==n.lastChild)?n.firstChild:n;}function __val(n,x){if(!n){return(wlvl>1&&wnode(x),"");}return(n=(n.nodeType!=1&&n||(n=n.selectSingleNode(x))&&(n.nodeType!=1&&n||(n=n.firstChild)&&n.nodeType!=1&&n)))&&n.nodeValue||(wlvl>2&&wxpath(x,"_val"),"");}var __valattrrx=/(["'])/g;function __valattrrp(m,a){return m=='"'?"&quot;":"&apos;";}function __valattr(n,x){if(!n){return(wlvl>1&&wnode(x),"");}return(n=(n.nodeType!=1&&n||(n=n.selectSingleNode(x))&&(n.nodeType!=1&&n||(n=n.firstChild)&&n.nodeType!=1&&n)))&&n.nodeValue.replace(__valattrrx,__valattrrp)||(wlvl>2&&wxpath(x,"_val"),"");}function __valm(m,x){var n;if(!m||!(n=(m.charAt&&((m.charAt(0)=="<"&&xmlParse(m))||((n=apf.nameserver.lookup.model[m])&&n.data)))||(m.$isModel?m.data:(m.charAt?0:m)))){return(wlvl>0&&wmodel(m,x,"_valm"),"");}return(n=(n.nodeType!=1&&n||(n=n.selectSingleNode(x))&&(n.nodeType!=1&&n||(n=n.firstChild)&&n.nodeType!=1&&n)))&&n.nodeValue||(wlvl>2&&wxpath(x),"");}function __nod(n,x){return n?n.selectSingleNode(x):(wlvl>1&&wnode(x,"_nod"),null);}function _nods(n,x){return n?n.selectNodes(x):(wlvl>1&&wnode(x,"_nods"),[]);}function __nodm(m,x){var n;if(!m||!(n=(m.charAt&&((m.charAt(0)=="<"&&xmlParse(m))||((n=apf.nameserver.lookup.model[m])&&n.data)))||(m.$isModel?m.data:(m.charAt?0:m)))){return(wlvl>0&&wmodel(m,x,"_nodm"),null);}return n.selectSingleNode(x);}function _nodsm(m,x){var n;if(!m||!(n=(m.charAt&&((m.charAt(0)=="<"&&xmlParse(m))||((n=apf.nameserver.lookup.model[m])&&n.data)))||(m.$isModel?m.data:(m.charAt?0:m)))){return(wlvl>0&&wmodel(m,x,"_nodsm"),[]);}return n.selectNodes(x);}function __cnt(n,x){return n?n.selectNodes(x).length:(wlvl>1&&wnode(x,"_cnt"),0);}function __cntm(m,x){var n;if(!m||!(n=(m.charAt&&((m.charAt(0)=="<"&&xmlParse(m))||((n=apf.nameserver.lookup.model[m])&&n.data)))||(m.$isModel?m.data:(m.charAt?0:m)))){return(wlvl>0&&wmodel(m,x,"_cntm"),0);}return n.selectNodes(x).length;}function _xpt(n,x){return{xpath:x,toString:function(){return"LM Xpath object: "+this.x;}};}function _xptm(m,x){return{model:m,xpath:x,toString:function(){return"LM Xpath object with model: "+this.x;}};}function _xml(n,m,x){if(n){x=m;}else{if(!m||!(n=(m.charAt&&((m.charAt(0)=="<"&&xmlParse(m))||((n=apf.nameserver.lookup.model[m])&&n.data)))||(m.$isModel?m.data:(m.charAt?0:m)))){return(wlvl>0&&wmodel(m,x,"_xml"),"");}}return(n&&(n=n.selectSingleNode(x)))&&n.xml||(wlvl>0&&!n&&wnode(x,"_xml"),"");}function _xmls(n,m,x){if(n){x=m;}else{if(!m||!(n=(m.charAt&&((m.charAt(0)=="<"&&xmlParse(m))||((n=apf.nameserver.lookup.model[m])&&n.data)))||(m.$isModel?m.data:(m.charAt?0:m)))){return(wlvl>0&&wmodel(m,x,"_xmls"),"");}}for(var i=0,j=((n=n.selectNodes(x))).length,o=[];i<j;i++){o[i]=n[i].xml;}return o.join("");}function _valcr(n,cr,m,x){if(n){x=m;}else{if(!m||!(n=(m.charAt&&((m.charAt(0)=="<"&&xmlParse(m))||((n=apf.nameserver.lookup.model[m])&&n.data)))||(m.$isModel?m.data:(m.charAt?0:m)))){return(wlvl>0&&wmodel(m,x,"_valcr"),"");}}if(cr){apf.createNodeFromXpath(ni,x);}else{if(n=ni.selectSingleNode(x)){return(n=(n.nodeType!=1&&n||(n=n.selectSingleNode(x))&&(n.nodeType!=1&&n||(n=n.firstChild)&&n.nodeType!=1&&n)))&&n.nodeValue||"";}}return(wlvl>2&&wxpath(x,"_valcr"),"");}function _nodcr(n,cr,m,x){if(n){x=m;}else{if(!m||!(n=(m.charAt&&((m.charAt(0)=="<"&&xmlParse(m))||((n=apf.nameserver.lookup.model[m])&&n.data)))||(m.$isModel?m.data:(m.charAt?0:m)))){return(wlvl>0&&wmodel(m,x,"_nodcr"),null);}}return n.selectSingleNode(x)||(cr&&apf.createNodeFromXpath(n,x));}function _valst(n,x){var m=apf.xmldb.findModel(n);if(!m){return(wlvl>0&&wmodel(m,x,"_valst"),"");}return"["+m.id+"::"+apf.xmlToXpath(n,m.data,true)+"/"+x+"]";}function _valed(n,m,x){if(n){x=m;}return"<div contenteditable='true' class='contenteditable'>CONTENT_EDITABLE_TODO</div>";}function _nod_del(n,m,x){if(n){x=m;}else{if(!m||!(n=(m.charAt&&((m.charAt(0)=="<"&&xmlParse(m))||((n=apf.nameserver.lookup.model[m])&&n.data)))||(m.$isModel?m.data:(m.charAt?0:m)))){return(wlvl>0&&wmodel(m,x,"_nod_del"),null);}}if(!(n=n.selectSingleNode(x))){return(wlvl>2&&wxpath(m,x,"_nod_del"),null);}apf.xmldb.removeNode(n);}function _nods_del(n,m,x){if(n){x=m;}else{if(!m||!(n=(m.charAt&&((m.charAt(0)=="<"&&xmlParse(m))||((n=apf.nameserver.lookup.model[m])&&n.data)))||(m.$isModel?m.data:(m.charAt?0:m)))){return(wlvl>0&&wmodel(m,x,"_nods_del"),null);}}if(!(n=n.selectNodes(x))){return;}apf.xmldb.removeNodeList(n);}function _nod_asn(n,m,x,v){if(n){v=x,x=m;}else{if(!m||!(n=(m.charAt&&((m.charAt(0)=="<"&&xmlParse(m))||((n=apf.nameserver.lookup.model[m])&&n.data)))||(m.$isModel?m.data:(m.charAt?0:m)))){throw new Error(apf.formatErrorString(0,0,"LM Xpath Assign","Cannot assign to nonresolving model:"+m+"\nxpath:"+x+"\nvalue:"+v));}}if(!n||(x&&!(n=apf.createNodeFromXpath(n,x)))){throw new Error(apf.formatErrorString(0,0,"LM Xpath Assign","Cannot assign could not resolve \nxpath:"+x+"\nvalue:"+v));}var c;if(!v||(v.charAt&&(c=v.charAt(0)!="<"))||typeof(v)=="number"){apf.setNodeValue(n,v,true);return v;}if(!c){if(n.nodeType!=1){throw new Error(apf.formatErrorString(0,0,"LM Xpath Assign","Cannot assign to a non-element node\nxpath:"+x+"\nvalue:"+v));}if(!(c=xmlParse(v))){throw new Error(apf.formatErrorString(0,0,"LM Xpath append","Cannot append broken XML.\nxpath:"+x+"\nvalue:"+v));}if(c.tagName!="_apflmlist_"){return apf.xmldb.replaceNode(c,n);}else{c=c.childNodes;apf.xmldb.replaceNode(n=c[0],n);for(var i=0,j=c.length;i<j;i++){n=apf.xmldb.appendChild(n.parentNode,c[0],n.nextSibling);}return n;}}else{if(v.length){throw new Error(apf.formatErrorString(0,0,"LM Xpath Assign","Assign of xpath nodelists not yet supported\nxpath:"+x+"\nvalue:"+v));}else{if(!v.selectNodes){throw new Error(apf.formatErrorString(0,0,"LM Xpath Assign","Cannot assign non-element node\nxpath:"+x+"\nvalue:"+v));}if(v.nodeType==2){if(n.nodeType!=2){throw new Error(apf.formatErrorString(0,0,"LM Xpath Assign","Cannot assign attribute node to replace non attribute, use += xpath:"+x+"\nvalue:"+v));}apf.xmldb.removeAttribute(c=n.ownerElement||n.selectSingleNode(".."),n.nodeName);apf.xmldb.setAttribute(c,v.nodeName,v.nodeValue);c.getAttributeNode(v.nodeName);}else{apf.xmldb.replaceNode(v,n);}}}return v;}function _nods_asn(n,m,x,v){if(n){v=x,x=m;}else{if(!m||!(n=(m.charAt&&((m.charAt(0)=="<"&&xmlParse(m))||((n=apf.nameserver.lookup.model[m])&&n.data)))||(m.$isModel?m.data:(m.charAt?0:m)))){throw new Error(apf.formatErrorString(0,0,"LM Xpath Assign","Cannot assign to nonresolving model:"+m+"\nxpath:"+x+"\nvalue:"+v));}}for(var i=0,j=(n=n.selectNodes(x)).length;i<j;i++){_nod_asn(n[i],null,v);}return v;}function _nod_add(n,m,x,v){if(n){v=x,x=m;}else{if(!m||!(n=(m.charAt&&((m.charAt(0)=="<"&&xmlParse(m))||((n=apf.nameserver.lookup.model[m])&&n.data)))||(m.$isModel?m.data:(m.charAt?0:m)))){throw new Error(apf.formatErrorString(0,0,"LM Xpath append","Cannot append to nonresolving model:"+m+"\nxpath:"+x+"\nvalue:"+v));}}if(!n||(x&&!(n=n.selectSingleNode(x)))){return _nod_asn(n,0,x,v);}var c;if(!v||(v.charAt&&(c=v.charAt(0)!="<"))||typeof(v)=="number"){apf.setNodeValue(n,v=((n=(n.nodeType!=1&&n||(n=n.selectSingleNode(x))&&(n.nodeType!=1&&n||(n=n.firstChild)&&n.nodeType!=1&&n)))&&n.nodeValue||"")+v,true);return v;}if(!c){if(n.nodeType!=1){throw new Error(apf.formatErrorString(0,0,"LM Xpath append","Cannot append to a non-element node\nxpath:"+x+"\nvalue:"+v));}if(!(c=xmlParse(v))){throw new Error(apf.formatErrorString(0,0,"LM Xpath append","Cannot append broken XML.\nxpath:"+x+"\nvalue:"+v));}if(c.tagName!="_apflmlist_"){return apf.xmldb.appendChild(n.parentNode,xmlParse(v),n.nextSibling);}else{c=c.childNodes;for(var i=0,j=c.length;i<j;i++){n=apf.xmldb.appendChild(n.parentNode,c[0],n.nextSibling);}return n;}}else{if(v.length){throw new Error(apf.formatErrorString(0,0,"LM Xpath append","Nodelists not yet supported\nxpath:"+x+"\nvalue:"+v));}else{if(!v.selectNodes){throw new Error(apf.formatErrorString(0,0,"LM Xpath append","Cannot assign non-element node\nxpath:"+x+"\nvalue:"+v));}if(v.nodeType==2){if(n.nodeType!=1){throw new Error(apf.formatErrorString(0,0,"LM Xpath append","Cannot append attribute to anything but element node"));}apf.xmldb.setAttribute(c=n.ownerElement||n.selectSingleNode(".."),v.nodeName,v.nodeValue);apf.xmldb.removeAttribute(v.ownerElement||v.selectSingleNode(".."),v.nodeName);return c.getAttributeNode(v.nodeName);}else{return apf.xmldb.appendChild(n.parentNode,v,n.nextSibling);}}}}function _nods_add(n,m,x,v){if(n){v=x,x=m;}else{if(!m||!(n=(m.charAt&&((m.charAt(0)=="<"&&xmlParse(m))||((n=apf.nameserver.lookup.model[m])&&n.data)))||(m.$isModel?m.data:(m.charAt?0:m)))){throw new Error(apf.formatErrorString(0,0,"LM Xpath Assign","Cannot append to nonresolving model:"+m+"\nxpath:"+x+"\nvalue:"+v));}}for(var i=0,j=(n=n.selectNodes(x)).length;i<j;i++){_nod_add(n[i],null,v);}return v;}function _asn(o,p,v){if(!o||typeof(o)!="object"){throw new Error(apf.formatErrorString(0,0,"LM Property Assign","Cannot assign property on non object, property:"+p));}if(o.setAttribute){o.setAttribute(p,v);}else{o[p]=v;}return v;}function _add(o,p,v){return _asn(o,p,o&&o[p]+v);}function _sub(o,p,v){return _asn(o,p,o&&o[p]-v);}function _div(o,p,v){return _asn(o,p,o&&o[p]/v);}function _mul(o,p,v){return _asn(o,p,o&&o[p]*v);}function _local(n){if(n&&n.charAt&&n.charAt(0)=="<"){return apf.getXmlDom(n).documentElement;}if(!n&&wlvl>1){wnode("-","_local");}return n;}function _tagName(n1,n2){return(n2&&n2.tagName)||(n1&&n1.tagName);}function _localName(n1,n2){return(n2&&n2[apf.TAGNAME])||(n1&&n1[apf.TAGNAME]);}function _nodeValue(n,n2){if(n2){n=n2;}return(n=(n.nodeType!=1&&n||(n.nodeType!=1&&n||(n=n.firstChild)&&n.nodeType!=1&&n)))&&n.nodeValue||"";}function __ret(r){return r;}function __lng(x,x2){return"$["+x+"]";}function _lnged(x,x2){return"$["+x+"]";}function _injself(s){return s.charAt?s.replace(selfrx,"$1self::"):s;}apf.$lmx=null;function _async(_n,_c,_a,_w,_f,_this,obj,func,args){var i=_a.i,v;if(!_a.ret){_a.ret=[];}if(_a[i]){return _a.ret[i];}_a[i]=true;if(!obj.exec){return _a.ret[i]=(func)?obj[func].apply(obj,args):obj.apply(obj,args);}var cb=function(data,state,extra){if(_w){delete _w._pc;}if(state!=apf.SUCCESS){_c(null,state,extra);}else{apf.$lmx=extra;_a.ret[i]=data;if(_w){_f.call(_this,_n,_c,_w,_a);}else{_f.call(_this,_n,_c,_a);}}};if(_w&&_w._pc){_w._pc={obj:obj,func:func,args:args,message:obj.createMessage&&obj.createMessage(func,args),_c:_c,cb:cb};}else{obj.exec(func,args,cb);}throw ({x:1});}function _pc(_w){var o;if(typeof(o=_w._pc)!="object"||!o){return;}o.obj.exec(o.func,o.args,o.cb,{message:o.message});throw ({x:1});}var _clut=apf.color?apf.color.colorshex:{},_cparse=/^(rgb|hsv|hsb)\(\s+(\d+)\s+,\s+(\d+)\s+,\s+(\d+)\)/;function _cthex(c){var t;if((t=typeof(c))=="string"){if(c.indexOf("#")==0){if(c.length==7){return parseInt(c.slice(-1),16);}return parseInt(c.slice(-1),16);}if(t=_clut[a]){return t;}if(c=c.match(_cparse)){if((t=c[1])=="rgb"){return(((t=c[2])<0?0:(t>255?255:parseInt(t)))<<16)+(((t=c[3])<0?0:(t>255?255:parseInt(t)))<<8)+(((t=c[4])<0?0:(t>255?255:parseInt(t))));}else{var h=parseFloat(c[2]),s=parseFloat(c[3]),v=parseFloat(c[4]),i,m=v*(1-s),n=v*(1-s*((i=floor(((h<0?-h:h)%1)*6))?h-i:1-(h-i)));switch(i){case 6:case 0:return((v&255)<<16)+((n&255)<<8)+(m&255);case 1:return((n&255)<<16)+((v&255)<<8)+(m&255);case 2:return((m&255)<<16)+((v&255)<<8)+(n&255);case 3:return((m&255)<<16)+((n&255)<<8)+(v&255);case 4:return((n&255)<<16)+((m&255)<<8)+(v&255);default:case 5:return((v&255)<<16)+((m&255)<<8)+(n&255);}}}}else{if(t=="number"){return t;}}return null;}function lin(f,a,b){var fa=parseFloat(a),fb=parseFloat(b),fm=1-(f=f<0?0:(f>1?1:f));if(fa!=a||fb!=b){return(((fa=_cthex(a))&16711680)*f+((fb=_cthex(b))&16711680)*fm)&16711680|((fa&65280)*f+(fb&65280)*fm)&65280|((fa&255)*f+(fb&255)*fm)&255;}return f*fa+fm*fb;}var abs=Math.abs,acos=Math.acos,asin=Math.asin,atan=Math.atan,atan2=Math.atan2,ceil=Math.ceil,cos=Math.cos,exp=Math.exp,floor=Math.floor,log=Math.log,max=Math.max,min=Math.min,pow=Math.pow,random=Math.random,round=Math.round,sin=Math.sin,sqrt=Math.sqrt,tan=Math.tan,linear=lin;function tsin(x){return 0.5*sin(x)+0.5;}function tcos(x){return 0.5*cos(x)+0.5;}function usin(x){return 0.5-0.5*sin(x);}function ucos(x){return 0.5-0.5*cos(x);}function snap(a,b){return round(a/b)*b;}function clamp(a,b,c){return a<b?b:(a>c?c:a);}this.compile=function(code){var _ret=__ret,_val=__val,_valm=__valm,_nod=__nod,_nodm=__nodm,_cnt=__cnt,_cntm=__cntm,_lng=__lng,_valattr=__valattr;eval(code);return _f;};var LMBEGINCACHE;var LMENDCACHE;})();apf.url=function(k){var g;if(k.indexOf(":")==-1&&(g=location.toString()).indexOf(":")!=-1){g=new apf.url(g);k=apf.getAbsolutePath(g.protocol+"://"+g.host+"/"+(g.directory.charAt(g.directory.length-1)=="/"?g.directory:g.directory+"/"),k).replace(/\/\/\/\//,"///");}var j=apf.url.options,c=j.parser[j.strictMode?"strict":"loose"].exec(k),d=14;this.uri=k.toString();while(d--){this[j.key[d]]=c[d]||"";}this[j.q.name]={};var b=this;this[j.key[12]].replace(j.q.parser,function(n,m,o){if(m){b[j.q.name][m]=o;}});this.isSameLocation=function(){if(this.uri.length&&this.uri.charAt(0)=="#"){return false;}if(!this.protocol&&!this.port&&!this.host){return true;}if(!this.protocol&&this.host&&this.port&&window.location.hostname==this.host&&window.location.port==this.port){return true;}if(!this.protocol&&this.host&&!this.port&&window.location.hostname==this.host&&window.location.port==80){return true;}return window.location.protocol==(this.protocol+":")&&window.location.hostname==this.host&&(window.location.port==this.port||!window.location.port&&!this.port);};};apf.url.options={strictMode:false,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}};apf.runXpath=function(){apf.XPath={cache:{},getSelf:function(htmlNode,tagName,info,count,num,sResult){var numfound=0,result=null,data=info[count];if(data){data[0](htmlNode,data[1],info,count+1,numfound++,sResult);}else{sResult.push(htmlNode);}},getChildNode:function(htmlNode,tagName,info,count,num,sResult){var numfound=0,result=null,data=info[count];var nodes=htmlNode.childNodes;if(!nodes){return;}for(var i=0;i<nodes.length;i++){if(tagName&&(tagName!=nodes[i].tagName)&&(nodes[i].style?nodes[i].tagName.toLowerCase():nodes[i].tagName)!=tagName){continue;}htmlNode=nodes[i];if(data){data[0](nodes[i],data[1],info,count+1,numfound++,sResult);}else{sResult.push(nodes[i]);}}},doQuery:function(htmlNode,qData,info,count,num,sResult){var result=null,data=info[count];var query=qData[0];var returnResult=qData[1];try{var qResult=eval(query);}catch(e){apf.console.error(e.name+" "+e.type+":"+apf.XPath.lastExpr+"\n\n"+query);return;}if(returnResult){return sResult.push(qResult);}if(!qResult||qResult.dataType==apf.ARRAY&&!qResult.length){return;}if(data){data[0](htmlNode,data[1],info,count+1,0,sResult);}else{sResult.push(htmlNode);}},getTextNode:function(htmlNode,empty,info,count,num,sResult){var data=info[count],nodes=htmlNode.childNodes;for(var i=0;i<nodes.length;i++){if(nodes[i].nodeType!=3&&nodes[i].nodeType!=4){continue;}if(data){data[0](nodes[i],data[1],info,count+1,i,sResult);}else{sResult.push(nodes[i]);}}},getAnyNode:function(htmlNode,empty,info,count,num,sResult){var data=info[count],nodes=htmlNode.getElementsByTagName("*");for(var i=0;i<nodes.length;i++){if(data){data[0](nodes[i],data[1],info,count+1,i,sResult);}else{sResult.push(nodes[i]);}}},getAttributeNode:function(htmlNode,attrName,info,count,num,sResult){if(!htmlNode||htmlNode.nodeType!=1){return;}if(attrName=="*"){var nodes=htmlNode.attributes;for(var i=0;i<nodes.length;i++){arguments.callee.call(this,htmlNode,nodes[i].nodeName,info,count,i,sResult);}return;}var data=info[count],value=htmlNode.getAttributeNode(attrName);if(data){data[0](value,data[1],info,count+1,0,sResult);}else{if(value){sResult.push(value);}}},getAllNodes:function(htmlNode,x,info,count,num,sResult){var data=info[count],tagName=x[0],inclSelf=x[1],prefix=x[2],nodes,i,l;if(inclSelf&&(htmlNode.tagName==tagName||tagName=="*"||tagName=="node()")){if(data){data[0](htmlNode,data[1],info,count+1,0,sResult);}else{sResult.push(htmlNode);}}if(tagName=="node()"){tagName="*";prefix="";if(apf.isIE){nodes=htmlNode.getElementsByTagName("*");}else{nodes=[];(function recur(x){for(var n,i=0;i<x.childNodes.length;i++){n=x.childNodes[i];if(n.nodeType!=1){continue;}nodes.push(n);recur(n);}})(htmlNode);}}else{nodes=htmlNode.getElementsByTagName((prefix&&(apf.isGecko||apf.isOpera||htmlNode.nodeFunc)?prefix+":":"")+tagName);}for(i=0,l=nodes.length;i<l;i++){if(data){data[0](nodes[i],data[1],info,count+1,i,sResult);}else{sResult.push(nodes[i]);}}},getAllAncestorNodes:function(htmlNode,x,info,count,num,sResult){var data=info[count],tagName=x[0],inclSelf=x[1],i=0,s=inclSelf?htmlNode:htmlNode.parentNode;while(s&&s.nodeType==1){if(s.tagName==tagName||tagName=="*"||tagName=="node()"){if(data){data[0](s,data[1],info,count+1,++i,sResult);}else{sResult.push(s);}}s=s.parentNode;}},getParentNode:function(htmlNode,empty,info,count,num,sResult){var data=info[count],node=htmlNode.parentNode;if(data){data[0](node,data[1],info,count+1,0,sResult);}else{if(node){sResult.push(node);}}},getPrecedingSibling:function(htmlNode,tagName,info,count,num,sResult){var data=info[count],node=htmlNode.previousSibling;while(node){if(tagName!="node()"&&(node.style?node.tagName.toLowerCase():node.tagName)!=tagName){node=node.previousSibling;continue;}if(data){data[0](node,data[1],info,count+1,0,sResult);}else{if(node){sResult.push(node);break;}}}},getFollowingSibling:function(htmlNode,tagName,info,count,num,sResult){var result=null,data=info[count];var node=htmlNode.nextSibling;while(node){if(tagName!="node()"&&(node.style?node.tagName.toLowerCase():node.tagName)!=tagName){node=node.nextSibling;continue;}if(data){data[0](node,data[1],info,count+1,0,sResult);}else{if(node){sResult.push(node);break;}}}},multiXpaths:function(contextNode,list,info,count,num,sResult){for(var i=0;i<list.length;i++){info=list[i][0];var rootNode=(info[3]?contextNode.ownerDocument.documentElement:contextNode);info[0](rootNode,info[1],list[i],1,0,sResult);}sResult.makeUnique();},compile:function(sExpr){var isAbsolute=sExpr.match(/^\//);sExpr=sExpr.replace(/\[(\d+)\]/g,"/##$1").replace(/\|\|(\d+)\|\|\d+/g,"##$1").replace(/\.\|\|\d+/g,".").replace(/\[([^\]]*)\]/g,function(match,m1){return"/##"+m1.replace(/\|/g,"_@_");});if(sExpr=="/"||sExpr=="."){return sExpr;}return this.processXpath(sExpr.replace(/\/\//g,"descendant::"),isAbsolute);},processXpath:function(sExpr,isAbsolute){var results=[],i,l,m,query;sExpr=sExpr.replace(/'[^']*'/g,function(m){return m.replace("|","_@_");});sExpr=sExpr.split("|");for(i=0,l=sExpr.length;i<l;i++){sExpr[i]=sExpr[i].replace(/_\@\_/g,"|");}if(sExpr.length==1){sExpr=sExpr[0];}else{for(i=0,l=sExpr.length;i<l;i++){sExpr[i]=this.processXpath(sExpr[i]);}results.push([this.multiXpaths,sExpr]);return results;}var sections=sExpr.split("/");for(i=0,l=sections.length;i<l;i++){if(sections[i]=="."||sections[i]==""){continue;}else{if(sections[i]==".."){results.push([this.getParentNode,null]);}else{if(sections[i].match(/^[\w-_\.]+(?:\:[\w-_\.]+){0,1}$/)){results.push([this.getChildNode,sections[i]]);}else{if(sections[i].match(/^\#\#(\d+)$/)){results.push([this.doQuery,["num+1 == "+parseInt(RegExp.$1)]]);}else{if(sections[i].match(/^\#\#(.*)$/)){query=RegExp.$1;m=[query.match(/\(/g),query.match(/\)/g)];if(m[0]||m[1]){while(!m[0]&&m[1]||m[0]&&!m[1]||m[0].length!=m[1].length){if(!sections[++i]){break;}query+="/"+sections[i];m=[query.match(/\(/g),query.match(/\)/g)];}}results.push([this.doQuery,[this.compileQuery(query)]]);}else{if(sections[i]=="*"){results.push([this.getChildNode,null]);}else{if(sections[i].substr(0,2)=="[]"){results.push([this.getAllNodes,["*",false]]);}else{if(sections[i].match(/descendant-or-self::node\(\)$/)){results.push([this.getAllNodes,["*",true]]);}else{if(sections[i].match(/descendant-or-self::([^\:]*)(?:\:(.*)){0,1}$/)){results.push([this.getAllNodes,[RegExp.$2||RegExp.$1,true,RegExp.$1]]);}else{if(sections[i].match(/descendant::([^\:]*)(?:\:(.*)){0,1}$/)){results.push([this.getAllNodes,[RegExp.$2||RegExp.$1,false,RegExp.$1]]);}else{if(sections[i].match(/ancestor-or-self::([^\:]*)(?:\:(.*)){0,1}$/)){results.push([this.getAllAncestorNodes,[RegExp.$2||RegExp.$1,true,RegExp.$1]]);}else{if(sections[i].match(/ancestor::([^\:]*)(?:\:(.*)){0,1}$/)){results.push([this.getAllAncestorNodes,[RegExp.$2||RegExp.$1,false,RegExp.$1]]);}else{if(sections[i].match(/^\@(.*)$/)){results.push([this.getAttributeNode,RegExp.$1]);}else{if(sections[i]=="text()"){results.push([this.getTextNode,null]);}else{if(sections[i]=="node()"){results.push([this.getChildNode,null]);}else{if(sections[i].match(/following-sibling::(.*)$/)){results.push([this.getFollowingSibling,RegExp.$1.toLowerCase()]);}else{if(sections[i].match(/preceding-sibling::(.*)$/)){results.push([this.getPrecedingSibling,RegExp.$1.toLowerCase()]);}else{if(sections[i]=="self::node()"){results.push([this.getSelf,null]);}else{if(sections[i].match(/self::(.*)$/)){results.push([this.doQuery,["apf.XPath.doXpathFunc(htmlNode, 'local-name') == '"+RegExp.$1+"'"]]);}else{query=sections[i];m=[query.match(/\(/g),query.match(/\)/g)];if(m[0]||m[1]){while(!m[0]&&m[1]||m[0]&&!m[1]||m[0].length!=m[1].length){if(!sections[++i]){break;}query+="/"+sections[i];m=[query.match(/\(/g),query.match(/\)/g)];}}results.push([this.doQuery,[this.compileQuery(query),true]]);}}}}}}}}}}}}}}}}}}}}results[0][3]=isAbsolute;return results;},compileQuery:function(code){return new apf.CodeCompilation(code).compile();},doXpathFunc:function(contextNode,type,nodelist,arg2,arg3,xmlNode,force){if(!nodelist||nodelist.length==0){nodelist="";}if(type=="not"){return !nodelist;}if(!force){var arg1,i,l;if(typeof nodelist=="object"||nodelist.dataType==apf.ARRAY){if(nodelist&&!nodelist.length){nodelist=[nodelist];}var res=false,value;for(i=0,l=nodelist.length;i<l;i++){xmlNode=nodelist[i];if(!xmlNode||typeof xmlNode=="string"||"position|last|count|local-name|name".indexOf(type)>-1){value=xmlNode;}else{if(xmlNode.nodeType==1&&xmlNode.firstChild&&xmlNode.firstChild.nodeType!=1){xmlNode=xmlNode.firstChild;}value=xmlNode.nodeValue;}if(res=arguments.callee.call(this,contextNode,type,value,arg2,arg3,xmlNode,true)){return res;}}return res;}else{arg1=nodelist;}}switch(type){case"position":return apf.getChildNumber(contextNode)+1;case"format-number":return apf.formatNumber(arg1);case"floor":return Math.floor(arg1);case"ceiling":return Math.ceil(arg1);case"starts-with":return arg1?arg1.substr(0,arg2.length)==arg2:false;case"string-length":return arg1?arg1.length:0;case"count":return arg1?arg1.length:0;case"last":return arg1?arg1[arg1.length-1]:null;case"name":var c=xmlNode||contextNode;return c.nodeName||c.tagName;case"local-name":var c=xmlNode||contextNode;if(c.nodeType!=1){return false;}return c.tagName.split(":").pop();case"substring":return arg1&&arg2?arg1.substring(arg2,arg3||0):"";case"contains":return arg1&&arg2?arg1.indexOf(arg2)>-1:false;case"concat":var str="";for(i=1,l=arguments.length;i<l;i++){if(typeof arguments[i]=="object"){str+=getNodeValue(arguments[i][0]);continue;}str+=arguments[i];}return str;case"translate":for(i=0,l=arg2.length;i<l;i++){arg1=arg1.replace(arg2.substr(i,1),arg3.substr(i,1));}return arg1;}},selectNodeExtended:function(sExpr,contextNode,match){var sResult=this.selectNodes(sExpr,contextNode);if(sResult.length==0){return null;}if(!match){return sResult;}for(var i=0,l=sResult.length;i<l;i++){if(getNodeValue(sResult[i])==match){return[sResult[i]];}}return null;},getRoot:function(xmlNode){while(xmlNode.parentNode&&xmlNode.parentNode.nodeType==1){xmlNode=xmlNode.parentNode;}return xmlNode.parentNode;},selectNodes:function(sExpr,contextNode){if(!this.cache[sExpr]){this.cache[sExpr]=this.compile(sExpr);}if(sExpr.length>20){this.lastExpr=sExpr;this.lastCompile=this.cache[sExpr];}if(typeof this.cache[sExpr]=="string"){if(this.cache[sExpr]=="."){return[contextNode];}if(this.cache[sExpr]=="/"){return[(contextNode.nodeType==9?contextNode.documentElement:this.getRoot(contextNode))];}}if(typeof this.cache[sExpr]=="string"&&this.cache[sExpr]=="."){return[contextNode];}var info=this.cache[sExpr][0],rootNode=(info[3]?(contextNode.nodeType==9?contextNode.documentElement:this.getRoot(contextNode)):contextNode),sResult=[];if(rootNode){info[0](rootNode,info[1],this.cache[sExpr],1,0,sResult);}return sResult;}};function getNodeValue(sResult){if(sResult.nodeType==1){return sResult.firstChild?sResult.firstChild.nodeValue:"";}if(sResult.nodeType>1||sResult.nodeType<5){return sResult.nodeValue;}return sResult;}apf.CodeCompilation=function(code){this.data={F:[],S:[],I:[],X:[]};this.compile=function(){code=code.replace(/ or /g," || ").replace(/ and /g," && ").replace(/!=/g,"{}").replace(/=/g,"==").replace(/\{\}/g,"!=");this.tokenize();this.insert();code=code.replace(/, \)/g,", htmlNode)");return code;};this.tokenize=function(){var data=this.data.F;code=code.replace(/(translate|format-number|contains|substring|local-name|last|position|round|starts-with|string|string-length|sum|floor|ceiling|concat|count|not)\s*\(/g,function(d,match){return(data.push(match)-1)+"F_";});data=this.data.S;code=code.replace(/'([^']*)'/g,function(d,match){return(data.push(match)-1)+"S_";}).replace(/"([^"]*)"/g,function(d,match){return(data.push(match)-1)+"S_";});data=this.data.X;code=code.replace(/(^|\W|\_)([\@\.\/A-Za-z\*][\*\.\@\/\w\-]*(?:\(\)){0,1})/g,function(d,m1,m2){return m1+(data.push(m2)-1)+"X_";}).replace(/(\.[\.\@\/\w]*)/g,function(d,m1,m2){return(data.push(m1)-1)+"X_";});data=this.data.I;code=code.replace(/(\d+)(\W)/g,function(d,m1,m2){return(data.push(m1)-1)+"I_"+m2;});};this.insert=function(){var data=this.data;code=code.replace(/(\d+)X_\s*==\s*(\d+S_)/g,function(d,nr,str){return"apf.XPath.selectNodeExtended('"+data.X[nr].replace(/'/g,"\\'")+"', htmlNode, "+str+")";}).replace(/(\d+)([FISX])_/g,function(d,nr,type){var value=data[type][nr];if(type=="F"){return"apf.XPath.doXpathFunc(htmlNode, '"+value+"', ";}else{if(type=="S"){return"'"+value+"'";}else{if(type=="I"){return value;}else{if(type=="X"){return"apf.XPath.selectNodeExtended('"+value.replace(/'/g,"\\'")+"', htmlNode)";}}}}}).replace(/, \)/g,")");};};};apf.dump2=apf.vardump2=function(k,j,g,q){if(apf.isWebkit){return"";}if(!k){return k+"";}if(!q){q="";}if(!j){j=0;}var o;switch(k.dataType){case apf.STRING:return'"'+k+'"';case apf.NUMBER:return k;case apf.BOOLEAN:return(k?"true":"false");case apf.DATE:return'Date("'+k+")";case apf.ARRAY:if(k[k.length-2]=="$__vardump"){return"this"+k[k.length-1];}k.push("$__vardump",q);o=["[ "];for(var m=0;m<k.length-2;m++){o.push(o.length>1?",":"",(g&&j>0?"{/*"+typeof(k[m])+"*/}":apf.vardump2(k[m],j+1,g,q+"["+m+"]")));}o.push(" ]");k.pop();k.pop();return o.join("");default:if(typeof k=="function"){return"{/*function*/}";}if(k.nodeType!==undefined&&k.style&&j!=0){return"{/*HTML Element: "+k.tagName+"*/}";}if(k.nodeType!==undefined){return"{/*XML Element : "+k.tagName+"*/}";}if(g&&j>0){return"{/*object/*}";}if(k["$__vardump"]){return"this"+k["$__vardump"]+"";}k["$__vardump"]=q;o=["{\n"];for(var b in k){if(b!="$__vardump"){try{var d=(parseInt(b)==b)?"0x"+("00000000"+parseInt(b).toString(16)).slice(-8):b;if(o.length>1){o.push(",\n");}o.push("\t".repeat(j+1),d,": ",(g&&j>0?"{/*"+typeof(k[b])+"*/}":apf.vardump2(k[b],j+1,g,q+"."+b)));}catch(n){o.push("\t".repeat(j+1),b,": null /*ERROR*/");}}}o.push("\n",("\t".repeat(j)),"}");function c(s){if(!s["$__vardump"]){return;}delete s["$__vardump"];for(var t in s){var r=s[t];if(typeof(r)=="object"){c(s);}}}c(k);return o.join("");}};if(apf.isOpera){window.console={};["log","debug","info","warn","error"].forEach(function(b){window.console[b]=function(){if(typeof arguments==="undefined"){return null;}if(arguments.length===1){opera.postError(b+": "+arguments[0]);return b+": "+arguments[0];}var j=arguments[0],k=/%([sdifo])/g,g=0,d=null;while(d=k.exec(j)){j=j.replace(d[0],String(arguments[++g]));}var c=arguments.length;while(c>g++){if(arguments[g]){j+=" ";j+=String(arguments[g]);}}opera.postError(b+": "+j);};});}apf.dump=apf.vardump=function(j,m,d,b){if(!j){return j+"";}if(!m){m=0;}switch(j.dataType){case"string":return'"'+j+'"';case"number":return j;case"boolean":return j?"true":"false";case"date":return"Date["+new Date()+"]";case"array":var k="{\n";for(var c=0;c<j.length;c++){k+="     ".repeat(m+1)+c+" => "+(!d&&m>0?typeof j[c]:apf.vardump(j[c],m+1,!d))+"\n";}k+="     ".repeat(m)+"}";return k;default:if(typeof j=="function"){return"function";}if(j.xml||j.serialize){return m==0?"[ "+(j.xml||j.serialize())+" ]":"XML Element";}if(!d&&m>0){return"object";}var k="{\n";for(prop in j){try{k+="     ".repeat(m+1)+prop+" => "+(!d&&m>0?typeof j[prop]:apf.vardump(j[prop],m+1,!d))+"\n";}catch(g){k+="     ".repeat(m+1)+prop+" => [ERROR]\n";}}k+="     ".repeat(m)+"}";return k;}};String.prototype.s=function(){return this.replace(/[\r\n]/g,"");};apf.alert_r=function(c,b){alert(apf.vardump(c,null,b));};apf.alert_r2=function(c,b){alert(apf.vardump2(c,null,!b));};apf.ProfilerClass=function(b){this.totalTime=0;this.start=function(c){if(c){this.totalTime=0;}this.startTime=new Date().getTime();this.isStarted=true;};this.stop=this.end=function(){if(!this.startTime){return;}this.totalTime+=new Date().getTime()-this.startTime;this.isStarted=false;};this.addPoint=function(c){this.end();apf.console.time("[TIME] "+(c||"Profiled Section")+": "+this.totalTime+"ms");this.start(true);};if(!b){this.start();}};apf.Latometer=new apf.ProfilerClass(true);if(self.navigator&&navigator.userAgent.indexOf("Opera")!=-1){window.console={};["log","debug","info","warn","error"].forEach(function(b){window.console[b]=function(){if(typeof arguments==="undefined"){return null;}if(arguments.length===1){opera.postError(b+": "+arguments[0]);return b+": "+arguments[0];}var j=arguments[0],k=/%([sdifo])/g,g=0,d=null;while(d=k.exec(j)){j=j.replace(d[0],String(arguments[++g]));}var c=arguments.length;while(c>g++){if(arguments[g]){j+=" ";j+=String(arguments[g]);}}opera.postError(b+": "+j);};});}function prettySize(b){if(b<1024){return b+" Bytes";}else{if(b<1024*1024){return Math.round(b/1024)+" KB";}else{if(b<1024*1024*1024){return Math.round(b/(1024*1024))+" MB";}}}}apf.$debugwin={showtime:true,nativedebug:apf.debug?true:false,highlighthover:true,cache:(function(){apf.isDebugWindow=self.frameElement&&self.frameElement.isDebugWin>-1;return apf.isDebugWindow?self.parent.apf.$debugwin.cache:[];})(),apf:(function(){if(apf.isDebugWindow){var b=self.parent.apf;apf.xmldb.$xmlDocLut=b.xmldb.$xmlDocLut;apf.xmldb.$listeners=b.xmldb.$listeners;apf.xmldb.$nodeCount=b.xmldb.$nodeCount;(apf.$asyncObjects||(apf.$asyncObjects={}))["$apf_ide_mdlProps"]=1;return b;}return apf;})(),init:function(){this.updateLog();this.apf.addEventListener("debug",this.debugHandler);apf.importCssString(".console_date{display:inline}");apf.storage.init();this.showtime=apf.storage.get("apfdebug_console_date")!==false;this.nativedebug=apf.storage.get("apfdebug_debugger")==true;this.highlighthover=apf.storage.get("apfdebug_highlight_hover")!==false;txtCode.setValue(apf.storage.get("jsexec")||"");codetype.setProperty("value",apf.storage.get("scriptype")||"Javascript");txtModel.setValue(apf.storage.get("mdlvalue")||"");this.setNativeDebug(this.nativedebug);itmShowtime.setAttribute("checked",this.showtime);itmDebug.setAttribute("checked",this.nativedebug);cbHighlightHover.setAttribute("checked",this.highlighthover);$apf_ide_mdl.load(this.apf.document.documentElement);var _self=this,excl={DIV:1,BLOCKQUOTE:1,SPAN:1,I:1};this.$mmouseover=function(e){if(!cbHighlightHover.checked||mnuData.visible){return;}var oHtml=e.htmlEvent.srcElement||e.htmlEvent.target;var xmlNode=excl[oHtml.tagName]?null:apf.xmldb.findXmlNode(oHtml);_self.apf.$debugwin.highlightAmlNode(xmlNode,!xmlNode);e.cancelBubble=true;};this.$mmouseout=function(e){self.apf.$debugwin.highlightAmlNode(null,true);(e||event).cancelBubble=true;};$apf_ide_mdlProps.exec=function(method,args,callback,options){if(method=="getProperty"&&args[0]){var xml,tag=args[0];if(xml=$apf_ide_mdlProps.queryNode(tag)){return callback(xml,apf.SUCCESS);}if(!options){options={};}if(!options.callback){options.callback=function(data,state,extra){if(state!=apf.SUCCESS){$apf_ide_mdlProps.exec(method,["empty"],callback,options);tag="empty";return false;}else{callback($apf_ide_mdlProps.queryNode(tag),state,extra);}};}this.insert("props/"+tag+".xml",options);}};apf.addEventListener("mousedown",function(){errBox.hide();});tabDebug.$ext.onmousemove=function(e){if(!e){e=event;}document.body.style.cursor=e.clientY<5?"s-resize":"";};tabDebug.$ext.onmousedown=function(e){if(!e){e=event;}if(e.clientY<5){apf.$debugwin.apf.$debugwin.$startResize(e.clientY);}};browse.addEventListener("afterrender",function(){trTools.hide();});mnuData.onitemclick=function(e){if(this.$lastObj){switch(e.value){case"doc":apf.$debugwin.showDocs(this.$lastObj);break;case"aml":apf.$debugwin.showAmlNode(this.$lastObj);break;case"data":apf.$debugwin.showCmlNode(this.$lastObj);break;case"obj":apf.$debugwin.showObject(this.$lastObj);break;case"root-data":apf.$debugwin.showXmlNode(this.$lastObj.xmlRoot);break;case"sel-data":apf.$debugwin.showXmlNode(this.$lastObj.selected);break;}return;}switch(e.value){case"doc":eval(mnuData.$lastCl.replace(/showObject|showXmlNode|showAmlNode/,"showDocs"));break;case"aml":eval(mnuData.$lastCl.replace(/showObject|showXmlNode|showAmlNode/,"showAmlNode"));break;case"data":eval(mnuData.$lastCl.replace(/showObject|showXmlNode|showAmlNode/,"showXmlNode"));break;case"obj":eval(mnuData.$lastCl.replace(/showObject|showXmlNode|showAmlNode/,"showObject"));break;case"root-data":var hasData=eval(mnuData.$lastCl.replace(/showAmlNode/,"$hasAmlData"));apf.$debugwin.showXmlNode(hasData[0]);break;case"sel-data":var hasData=eval(mnuData.$lastCl.replace(/showAmlNode/,"$hasAmlData"));apf.$debugwin.showXmlNode(hasData[1]);break;}};},start:function(){if(!apf.isDebugWindow){window.onerror=this.nativedebug?null:this.errorHandler;}},errorHandler:function(g,b,d,c){if(!g){g="";}if(!c){apf.$debugwin.apf.console.error((apf.$debugwin.apf!=apf?"[Debug Window Error]: ":"")+"Error on line "+d+" of "+apf.removePathContext(apf.hostPath,b)+"\n"+g);}if(apf.$debugwin.apf==apf){apf.$debugwin.show();}return true;},updateLog:function(){apf_console.clear();apf_console.setValue(this.apf.console.getAll(btnError.value,btnWarn.value,btnLog.value));},updateTeleportFilter:function(b){var c=tlist.each.split("|");if(b.value){c.push(b.firstChild.nodeValue.toLowerCase());}else{c=c.remove(b.firstChild.nodeValue.toLowerCase());}tlist.setAttribute("each",c.join("|")||"none");},debugHandler:function(b){if((self["btn"+b.type.uCaseFirst()]||btnLog).value||b.type=="custom"){apf_console.setValue(b.message);}if(b.type=="error"&&tabDebug.activepagenr!=0){errBox.setMessage(";<a href='javascript:void(0)' onclick='tabDebug.set(0);errBox.hide()'>"+b.message+"</a>");errBox.show();}},showDocs:function(b){tabDebug.set("docs");},showAmlNode:function(b){tabDebug.set(1);pgBrowse.set(0);if(!mrkAml.xmlRoot){mrkAml.addEventListener("afterload",function(){apf.$debugwin.showAmlNode(b);mrkAml.removeEventListener("afterload",arguments.callee);});}else{mrkAml.expandAndSelect(b);if(mrkAml.selected!=b){this.showObject(b,b.getAttribute("id")||"");}}},toggleHighlight:function(b,c){if(document.onmousemove){document.onmousemove=document.onmousedown=null;return;}var d;document.onmousemove=function(m){if(apf.$debugwin.$hdiv){apf.$debugwin.$hdiv.style.top="10000px";}var g=(m||(m=event)).clientX;var n=m.clientY;var k=document.elementFromPoint(g,n);var j=apf.findHost(k);if(d!=j){apf.$debugwin.highlightAmlNode(null,true);}if(d=j){apf.$debugwin.highlightAmlNode(j,false,true);}};document.onmousedown=function(j){var g=d||apf.findHost((j||(j=event)).srcElement||j.target);if(g){b.showAmlNode(g);apf.$debugwin.highlightAmlNode(null,true);c.setValue(false);document.onmousemove=document.onmousedown=null;}};},highlightAmlNode:function(d,b,c){if(b){if(this.$hdiv){this.$hdiv.style.display="none";}return;}if(!d){return;}if(!this.$hdiv){apf.importCssString(".apf_highlight_div{                    background : #004eff;                    position   : absolute;                    z-index    : 1000000;                    opacity    : 0.3;                }                .apf_border_div{                    background : url(images/spacer.gif);                    position   : absolute;                    z-index    : 1000000;                    border     : 1px solid blue;                }");this.$hdiv=document.body.appendChild(document.createElement("div"));this.$hdiv.style.display="none";}apf.setStyleClass(this.$hdiv,c?"apf_border_div":"apf_highlight_div",["apf_border_div","apf_highlight_div"]);if(false&&d.tagName=="html"){this.$hdiv.style.left="0px";this.$hdiv.style.top="0px";this.$hdiv.style.width="100%";this.$hdiv.style.height="100%";this.$hdiv.style.display="block";}else{if(d.$ext&&(d.$ext.offsetHeight||d.$ext.offsetWidth)){var j=apf.getAbsolutePosition(d.$ext);this.$hdiv.style.left=j[0]+"px";this.$hdiv.style.top=j[1]+"px";var g=apf.getDiff(this.$hdiv);this.$hdiv.style.width=(d.$ext.offsetWidth-g[0])+"px";this.$hdiv.style.height=(d.$ext.offsetHeight-g[1])+"px";this.$hdiv.style.display="block";}else{this.$hdiv.style.display="none";}}},showObject:function(d,g,c){tabDebug.set(1);pgBrowse.set(2);if(!c&&d&&d.$regbase){c=d.getAttribute("id")||"Aml Node";g=this.apf.$debugwin.cache.push(d)-1;}txtCurObject.setValue(c);trObject.clear("loading");var b=this;setTimeout(function(){if(!g&&g!==0){$apf_ide_mdlObject.load(b.analyze(d,c,c));}else{$apf_ide_mdlObject.load(b.analyze(b.apf.$debugwin.cache[g],"apf.$debugwin.cache["+g+"]",c));}},10);},types:["Object","Number","Boolean","String","Array","Date","RegExp","Function","Object"],domtypes:[null,"Element","Attr","Text","CDataSection","EntityReference","Entity","ProcessingInstruction","Comment","Document","DocumentType","DocumentFragment","Notation"],calcName:function(d,j){var b,c=d.tagName=="method"?d.parentNode:d,g=[];do{b=j?c.getAttribute("display")||c.getAttribute("name"):c.getAttribute("name");if(!b){break;}g.unshift(!b.match(/^[a-z_\$][\w_\$]*$/i)?(parseInt(b)==b?"["+b+"]":'["'+b.replace(/'/g,"\\'")+'"]'):b);c=c.parentNode;}while(c&&c.nodeType==1);if(g[0].charAt(0)=="["){g[0]=g[0].substr(2,g[0].length-4);}return g.join(".").replace(/\.\[/g,"[");},analyze:function(pNode,ref,displayName){var item,prop,o,obj;if(pNode&&!pNode.dataType&&pNode.nodeType&&"item|method".indexOf(pNode.tagName)>-1){var name,loopNode=pNode.tagName=="method"?pNode.parentNode:pNode,path=[];do{name=loopNode.getAttribute("name");if(!name){break;}path.unshift("['"+name.replace(/'/g,"\\'")+"']");loopNode=loopNode.parentNode;}while(loopNode&&loopNode.nodeType==1);path[0]=path[0].substr(2,path[0].length-4);o=self.parent.eval(path.join(""));}else{o=pNode;pNode=null;}if(pNode&&pNode.tagName=="method"){var xml=apf.getXml("<method />");var doc=xml.ownerDocument;for(prop in o){if(typeof o[prop]=="function"&&prop.charAt(0)!="$"){item=xml.appendChild(doc.createElement("method"));item.setAttribute("name",prop);item.setAttribute("type","Function");item.setAttribute("value",prop+o[prop].toString().match(/function\s*[\w-]*(\([\s\S]*?\))/)[1]);}}return xml;}if(!pNode){var xml=apf.getXml("<obj />");var n={};n[displayName]=o;if(typeof o=="object"||o&&o.dataType==apf.ARRAY){n.$isSingleValue=true;}o=n;}else{var xml=apf.getXml("<item "+(ref?"name='"+ref+"'":"")+(displayName?' display="'+displayName.replace(/"/g,"&quot;")+'"':"")+" expand='true' />");}var doc=xml.ownerDocument;try{prop in o;}catch(e){return xml;}for(prop in o){obj=o[prop];if(prop.charAt(0)=="$"||prop.substr(0,2)=="a_"){continue;}if(typeof obj=="function"&&(o.dataType!=apf.ARRAY||prop!=parseInt(prop))){hasMethods=true;continue;}item=xml.appendChild(doc.createElement("item"));item.setAttribute("name",prop);if(typeof obj=="undefined"||obj==null){item.setAttribute("value",String(obj));item.setAttribute("type",String(obj));item.setAttribute("numtype",0);continue;}if(this.types[obj.dataType]){item.setAttribute("type",this.types[obj.dataType]);}var hasProperties=null;try{for(hasProperties in obj){break;}}catch(e){hasProperties=true;}item.setAttribute("numtype",obj.dataType||(hasProperties?8:0));var str,hasMethods;switch(obj.dataType){case apf.STRING:if(obj.length>10000){item.setAttribute("value","String of "+obj.length+" bytes (too large to display)");}else{item.setAttribute("value",'"'+obj.replace(/"/g,'\\"').replace(/</g,"&lt;").replace(/\n/g,"\\n").replace(/\r/g,"\\r")+'"');}break;case apf.NUMBER:item.setAttribute("value",obj);break;case apf.BOOLEAN:item.setAttribute("value",obj?"true":"false");break;case apf.DATE:item.setAttribute("value","["+obj.toString()+"]");break;case apf.FUNCTION:item.setAttribute("value",prop+o[prop].toString().match(/function\s*[\w-]*(\([\s\S]*?\))/)[1]);break;case apf.ARRAY:item.setAttribute("value","("+obj.length+" items)");break;default:item.setAttribute("value","{"+(obj.nodeType==2?"@"+obj.nodeName:(obj.nodeType!=1&&obj.nodeName?obj.nodeName+" Node":(obj.tagName?obj.tagName+" Element":"...")))+"}");if(obj.nodeType!==undefined&&typeof obj.style=="object"){item.setAttribute("type",obj.nodeType==1?"HTML"+obj.tagName.toLowerCase().uCaseFirst()+"Element":"HTML"+this.domtypes[obj.nodeType]);}else{if(obj.nodeType!==undefined){var s;if(obj.$regbase&apf.__AMLNODE__){if(obj.nodeType==1){if(obj.namespaceURI==apf.ns.xhtml){item.setAttribute("type","apf.Xhtml"+obj.localName.uCaseFirst()+"Element");break;}else{if(obj.namespaceURI==apf.ns.xsd){item.setAttribute("type","apf.Xsd"+obj.localName.uCaseFirst()+"Element");break;}}}item.setAttribute("type",obj.nodeType==1?"apf."+obj.localName:"apf.Aml"+this.domtypes[obj.nodeType]);break;}item.setAttribute("type","XML"+this.domtypes[obj.nodeType]);}else{item.setAttribute("type","Object");}}break;}}if(!pNode&&displayName){xml.firstChild.setAttribute("display",displayName);xml.firstChild.setAttribute("name",ref);xml.firstChild.setAttribute("expand","true");if(o.$isSingleValue){apf.mergeXml(this.analyze(xml.firstChild,name),xml.firstChild);}}if(hasMethods){xml.insertBefore(doc.createElement("method"),xml.firstChild).setAttribute("name","[Methods]");}return doc.documentElement;},checkChange:function(b){var c=b.getAttribute("value");if(b.tagName=="method"||"Boolean|String|undefined|null|Number".indexOf(b.getAttribute("type"))==-1){return false;}},applyChange:function(xmlNode){var value=xmlNode.getAttribute("value");var name=this.calcName(xmlNode);try{if(name.indexOf(".")>-1){var prop,obj=self.parent.eval(name.replace(/\.([^\.\s]+)$/,""));if(obj&&obj.$supportedProperties&&obj.$supportedProperties.contains(prop=RegExp.$1)){obj.setProperty(prop,self.parent.eval(value));return;}}self.parent.eval(name+" = "+value);}catch(e){trObject.getActionTracker().undo();alert("Invalid Action: "+e.message);}},showXmlNode:function(b){tabDebug.set(1);pgBrowse.set(1);var d=apf.xmldb.$xmlDocLut;var g=b.ownerDocument.documentElement;var m=b.getAttribute(apf.xmldb.xmlIdTag);if(!m){m=apf.xmldb.nodeConnect(apf.xmldb.getXmlDocId(b),b);}var c=m.split("|")[0];if(!d[c]){d[c]=g;}else{if(d[c]!=g){var k=this.apf.nameserver.get("model",c);d[c]=g;var j=apf.nameserver.get("model",c);apf.xmldb.getXmlDocId(g,j);if(k){apf.nameserver.register("model",c,k);}}}mrkData.load(b);},$handleDataContext:function(ev,obj){if(obj){this.apf.$debugwin.highlightAmlNode(null,true);if(obj.$regbase){itInspAml.hide();itInspData.hide();itInspObj.show();var hasData=[obj.xmlRoot,obj.selected];itInspRoot.setProperty("visible",hasData[0]?1:0);itInspSel.setProperty("visible",hasData[1]?1:0);div2.setProperty("visible",hasData[0]||hasData[1]?1:0);}else{itInspAml.hide();itInspData.hide();itInspObj.show();itInspRoot.hide();itInspSel.hide();div2.hide();}mnuData.$lastObj=obj;mnuData.display(ev.x,ev.y);return false;}e=ev&&ev.htmlEvent;if(!e){return;}var el=e.srcElement||e.target;while(el.tagName!="A"&&el.tagName!="DIV"){el=el.parentNode;}if(el.tagName=="A"){var cl=el.getAttribute("onclick");if(cl.indexOf("showObject")>-1){itInspAml.hide();itInspData.hide();itInspObj.show();itInspRoot.hide();itInspSel.hide();div2.hide();}else{if(cl.indexOf("showXmlNode")>-1){itInspAml.hide();itInspData.show();itInspObj.show();itInspRoot.hide();itInspSel.hide();div2.hide();}else{if(cl.indexOf("showAmlNode")>-1){itInspAml.show();itInspData.hide();itInspObj.show();var hasData=eval(cl.replace(/showAmlNode/,"$hasAmlData"));itInspRoot.setProperty("visible",hasData[0]?1:0);itInspSel.setProperty("visible",hasData[1]?1:0);div2.setProperty("visible",hasData[0]||hasData[1]?1:0);}}}mnuData.$lastCl=cl;mnuData.display(ev.x,ev.y);return false;}},$hasAmlData:function(b){return[b.xmlRoot,b.selected];},jRunCode:function(code,scripttype,model){apf.storage.put("jsexec",code);apf.storage.put("scriptype",scripttype);apf.storage.put("mdlvalue",model);var islm=scripttype=="Live Markup";this.apf.console.write("<span style='color:blue'><span style='float:left'>&gt;&gt;&gt;</span><div style='margin:0 0 0 30px'>"+code.replace(/ /g,"&nbsp;").replace(/\t/g,"&nbsp;&nbsp;&nbsp;").replace(/</g,"&lt;").replace(/\n/g,"\n<br />")+"</div></span>","custom",null,null,null,true);var _self=this;var doIt=function(data,loaded){if(islm){var func=apf.$debugwin.apf.lm.compile(code,{parsecode:true});if(model&&!loaded){if(data=apf.$debugwin.apf.nameserver.get("model",model)){data=data.data;}if(!data){var data=_self.apf.getData(model,{useXML:true,callback:function(data,state,extra){if(state==apf.SUCCESS){doIt(data,true);}else{_self.apf.console.error("Could not find resource '"+model+"'\nMessage:"+extra.message);}}});return;}}var x=func(data);}else{var x=self.parent.eval(code);}var s=_self.$serializeObject(x,code);if(typeof s=="string"){_self.apf.console.write(s,"custom",null,null,null,true);}else{_self.apf.console.write(x?"Could not serialize object: "+s.message:x,"error",null,null,null,true);}};if(apf.$debugwin.nativedebug){doIt();}else{try{doIt();}catch(e){this.apf.console.write(e.message,"error",null,null,null,true);}}},$serializeObject:function(b,d){if(b===null){b="null";}else{if(b===undefined){b="undefined";}}var g;if(b.nodeType&&!b.style&&(!b.$regbase||b.nodeType==1||b.nodeType==7)){if(b.nodeType==1||b.nodeType==7){if(b.serialize){g="<a class='xmlhl' href='javascript:void(0)'                           onmouseout='if (cbHighlightHover.checked) apf.$debugwin.apf.$debugwin.highlightAmlNode(null, true)'                           onmouseover='if(!mnuData.visible &amp;&amp; cbHighlightHover.checked) apf.$debugwin.apf.$debugwin.highlightAmlNode(apf.$debugwin.apf.all["+b.$uniqueId+"])' onclick='apf.$debugwin.showAmlNode(apf.$debugwin.apf.all["+b.$uniqueId+"])'>"+apf.highlightXml(b.serialize().split(">")[0]+">").replace(/<\/?a(?:>| [^>]*>)/g,"")+"</a>";}else{g="<a class='xmlhl' href='javascript:void(0)' onclick='apf.$debugwin.showXmlNode(apf.$debugwin.cache["+(apf.$debugwin.cache.push(b)-1)+"])'>"+apf.highlightXml(apf.getCleanCopy(b).xml.split(">")[0]+">")+"</a>";}}else{g=b.xml||b.serialize();}return g;}else{if(typeof b=="object"){if(b.dataType==apf.ARRAY){var c=["Array { length: "+b.length];}else{var c=[b.toString(),"{"];for(prop in b){if(c.length==5){c.push("more...");break;}if(typeof b[prop]!="function"&&typeof b[prop]!="object"&&b[prop]&&prop.substr(0,1)!="$"){c.push(prop+"="+b[prop]+", ");}}}return"<a class='xmlhl' href='javascript:void(0)' style='font-weight:bold;font-size:7pt;color:green' onclick='apf.$debugwin.showObject(null, "+(this.apf.$debugwin.cache.push(b)-1)+', "'+d.split(";").pop().replace(/"/g,"\\&quot;")+"\")'>"+c.join(" ")+" }</a>";}else{g=b.toString();return g.replace(/</g,"&lt;").replace(/\n/g,"\n<br />");}}},consoleTextHandler:function(b){if(b.keyCode==9&&b.currentTarget==txtCode){txtCode.focus();b.cancelBubble=true;return false;}else{if(b.keyCode==13&&b.ctrlKey){apf.$debugwin.jRunCode(txtCode.value,codetype.value,txtModel.value);return false;}}},setShowTime:function(b){apf.storage.put("apfdebug_console_date",b);apf.setStyleRule(".console_date","display",b?"inline":"none");this.showtime=b;},setNativeDebug:function(d,b){if(!b){apf.storage.put("apfdebug_debugger",d);this.apf.$debugwin.setNativeDebug(d,true);}else{window.onerror=d?null:this.errorHandler;}this.nativedebug=d;},setHighlightHover:function(b){apf.storage.put("apfdebug_highlight_hover",b);this.highlighthover=b;},firstEdit:true,$setEditable:function(b){if(b){apf.document.documentElement.setAttribute("editable","true");}else{apf.document.documentElement.removeAttribute("editable");}},setEditable:function(b){this.apf.$debugwin.$setEditable(b);if(!self.pgBrowse){return;}if(b){pgBrowse.setAttribute("anchors","61 0 0 0");mrkAml.setAttribute("border","1 1 0 1");tbEdit.show();trTools.show();}else{pgBrowse.setAttribute("anchors","25 0 0 0");mrkAml.setAttribute("border","1 1 0 0");tbEdit.hide();trTools.hide();}},first:true,show:function(){if(apf.isDebugWindow){return;}if(apf.loadScreen){apf.loadScreen.hide();}if(this.first){var c,b,d;if(apf.isIE){apf.setStyleRule("BODY","overflow","",0);c=apf.getBox(apf.getStyle(document.body,"padding"));b=apf.getBox(apf.getStyle(document.body,"margin"));d=[apf.getStyle(document.documentElement,"overflow"),apf.getStyle(document.documentElement,"overflowX"),apf.getStyle(document.documentElement,"overflowY")];}else{c=[parseInt(apf.getStyle(document.body,"paddingTop")),parseInt(apf.getStyle(document.body,"paddingRight")),parseInt(apf.getStyle(document.body,"paddingBottom")),parseInt(apf.getStyle(document.body,"paddingLeft"))];b=[parseInt(apf.getStyle(document.body,"marginTop")),parseInt(apf.getStyle(document.body,"marginRight")),parseInt(apf.getStyle(document.body,"marginBottom")),parseInt(apf.getStyle(document.body,"marginLeft"))];d=[apf.getStyleRule("html","overflow")||"auto",apf.getStyleRule("html","overflowX")||"auto",apf.getStyleRule("html","overflowY")||"auto"];}apf.importCssString("                html{                    height : 100%;                    overflow : hidden;                    overflow-x : hidden;                    overflow-y : hidden;                    margin-bottom : "+(c[0]+b[0]+c[2]+b[2])+"px;                }                body{                    position : absolute;                    left : 0;                    top : 0;                    right : 0;                    bottom : 350px;                    margin:0;                    overflow  : "+d[0]+";                    overflow-x : "+d[1]+";                    overflow-y : "+d[2]+";                    padding : "+(c[0]+b[0])+"px "+(c[1]+b[1])+"px "+(c[2]+b[2])+"px "+(c[3]+b[3])+"px;                    width : auto;                }                #apf_debugwin {                    position: fixed;                    bottom: 0px;                    text-align: left;                    height: 350px;                    width : 100%;                    left: 0px;                    z-index: 100000000;                }            ");document.documentElement.style.overflow="hidden";this.first=false;document.body.insertAdjacentHTML("beforeend","<div id='apf_debugwin'><iframe frameborder='0' width='100%' height='100%' /></div>");this.$iframe=(this.$ext=document.getElementById("apf_debugwin")).firstChild;this.$iframe.isDebugWin=true;apf.getWindowWidth=function(){return document.body.offsetWidth;};apf.getWindowHeight=function(){return document.body.offsetHeight;};setTimeout(function(){apf.$debugwin.$iframe.src=apf.basePath+"debugwin/debugwin.html";});}this.$ext.style.display="block";document.body.style.bottom=this.$ext.offsetHeight+"px";},hide:function(){this.$ext.style.display="none";document.body.style.bottom="0";document.body.focus();},$startResize:function(j){var c=this.$ext;apf.plane.show(null,null,null,true);apf.dragMode=true;document.body.style.cursor="s-resize";var g,m,b=document.body,k=c.offsetHeight,d=document.documentElement.offsetHeight-k+((apf.isIE?0:1)*j);document.onmousemove=f=function(n){if(!n){n=event;}var q=n.offsetY||n.pageY;clearTimeout(m);if(g&&new Date().getTime()-g<apf.mouseEventBuffer){var o={clientX:n.clientX,clientY:n.clientY};m=setTimeout(function(){c.style.height=(k+(d-q))+"px";b.style.bottom=c.offsetHeight+"px";},10);return;}g=new Date().getTime();c.style.height=(k+(d-q))+"px";b.style.bottom=c.offsetHeight+"px";};document.onmouseup=function(n){if(!n){n=event;}document.body.style.cursor="";document.onmousemove=document.onmouseup=null;apf.dragMode=false;apf.plane.hide();};},activate:function(){this.show();}};apf.BindingRule=function(c,b){this.$init(b||true,apf.NODE_HIDDEN,c);};(function(){this.$bindingRule=true;this.compile=function(b){return(this["c"+b]=apf.lm.compile(this[b],{xpathmode:3,injectself:true}));};this.$compile=function(c,b){return(this["c"+c+"2"]=apf.lm.compile(this[c],b));};this.$attrExcludePropBind=apf.extend({value:1,match:1},this.$attrExcludePropBind);this.$propHandlers.value=this.$propHandlers.match=function(c,d){delete this["c"+d];if(this.$amlLoaded){var b=this;while(b&&b.$bindingRule){b=b.parentNode;}if(!b){return;}apf.queue.add("reload"+b.$uniqueId,function(){b.reload();});if(b.$bindings.$isCompiled){b.$bindings.$compiled=b.$bindings.compile(this.localName!="each"&&this.localName);}}};this.addEventListener("DOMNodeInserted",function(c){var b=this;while(b.$bindingRule){b=b.parentNode;}apf.queue.add("reload"+b.$uniqueId,function(){b.reload();});if(c.currentTarget==this){(b.$bindings[this.localName]||(b.$bindings[this.localName]=[])).push(this);}else{if(!this.attributes.getNamedItem("value")){this.value=apf.serializeChildren(this);}else{return;}}if(b.$bindings.$isCompiled){b.$bindings.$compiled=b.$bindings.compile(this.localName!="each"&&this.localName);}});this.addEventListener("DOMNodeRemoved",function(c){var d,b=this;while(b&&b.$bindingRule){b=b.parentNode;}if(!b){return;}if(c.currentTarget==this){if(b.$bindings&&b.$bindings[this.localName]){b.$bindings[this.localName].remove(this);}else{return;}}else{if(!this.attributes.getNamedItem("value")&&(d=this.firstChild)){if(d.nodeType==this.NODE_PROCESSING_INSTRUCTION){if(d.target=="lm"){this.value="{"+d.nodeValue+"}";}else{this.value=d.nodeValue;}}else{this.value=apf.serializeChildren(this).trim();}}else{return;}}apf.queue.add("reload"+b.$uniqueId,function(){if(!b.$amlDestroyed){b.reload();}});if(b.$bindings.$isCompiled){b.$bindings.$compiled=b.$bindings.compile(this.localName!="each"&&this.localName);}});this.addEventListener("DOMNodeInsertedIntoDocument",function(d){if(!this.match&&(!this.value&&!this.childNodes.length&&!this.get||this.localName=="each")||this.select){throw new Error(apf.formatErrorString(0,this,"Bindingrule","Missing attribute 'match'"));}var g;if(!this.value&&(g=this.$aml&&this.$aml.firstChild||this.firstChild)){if(g.nodeType==this.NODE_PROCESSING_INSTRUCTION){if(g.target=="lm"){this.value="{"+g.nodeValue+"}";}else{this.value=g.nodeValue;}}else{this.value=apf.serializeChildren(this.$aml).trim();}}var b=this.parentNode;while(b.$bindingRule){b=b.parentNode;}var j=b.$bindings||(b.$bindings=new apf.ruleList());(j[this.localName]||(j[this.localName]=[])).push(this);if(b.localName!="bindings"&&(this.localName!="each"||!this.childNodes.length)){var c=this;while((c=c.nextSibling)&&c.nodeType!=1){}if(!c||!c.$bindingRule){b.$cbindings=b.$bindings.compile(b.$bindings.$isCompiled?this.localName:null);b.dispatchEvent("bindingsload",{bindings:b.$bindings,compiled:b.$cbindings});b.$checkLoadQueue();}}});}).call(apf.BindingRule.prototype=new apf.AmlElement());apf.aml.setElement("icon",apf.BindingRule);apf.aml.setElement("image",apf.BindingRule);apf.aml.setElement("caption",apf.BindingRule);apf.aml.setElement("css",apf.BindingRule);apf.aml.setElement("selectable",apf.BindingRule);apf.aml.setElement("value",apf.BindingRule);apf.aml.setElement("src",apf.BindingRule);apf.aml.setElement("collapsed",apf.BindingRule);apf.aml.setElement("expanded",apf.BindingRule);apf.aml.setElement("empty",apf.BindingRule);apf.ActionRule=function(c,b){this.$init(b||true,apf.NODE_HIDDEN,c);};(function(){this.$actionRule=true;this.compile=function(c,b){return(this["c"+c]=apf.lm.compile(this[c],b||{xpathmode:2}));};this.$attrExcludePropBind=apf.extend({set:1,get:1,undo:1,lock:1,match:1,parent:1},this.$attrExcludePropBind);this.$propHandlers.set=this.$propHandlers.get=this.$propHandlers.parent=this.$propHandlers.match=function(b,c){delete this["c"+c];};this.addEventListener("DOMNodeInserted",function(c){if(c.currentTarget==this){var b=this.parentNode;if(!b.$actions){b.$actions=new apf.ruleList();}(b.$actions[this.localName]||(b.$actions[this.localName]=[])).push(this);}else{if(this.attributes.getNamedItem("value")){return;}this.value=apf.serializeChildren(this);}});this.addEventListener("DOMNodeRemoved",function(b){if(b.currentTarget==this){this.parentNode.$actions[this.localName].remove(this);}else{if(this.attributes.getNamedItem("value")){return;}this.value=apf.serializeChildren(this);}});this.addEventListener("DOMNodeInsertedIntoDocument",function(b){if(!this.get){this.get=apf.serializeChildren(this.$aml).trim();}var c=this.parentNode.$actions||(this.parentNode.$actions=new apf.ruleList());(c[this.localName]||(c[this.localName]=[])).push(this);});}).call(apf.ActionRule.prototype=new apf.AmlElement());apf.aml.setElement("rename",apf.ActionRule);apf.aml.setElement("remove",apf.ActionRule);apf.aml.setElement("add",apf.ActionRule);apf.aml.setElement("update",apf.ActionRule);apf.aml.setElement("copy",apf.ActionRule);apf.aml.setElement("move",apf.ActionRule);apf.aml.setElement("check",apf.ActionRule);apf.aml.setElement("change",apf.ActionRule);apf.item=function(c,b){this.$init(b||"item",apf.NODE_VISIBLE,c);};(function(){this.$focussable=false;this.$childProperty="caption";this.$canLeechSkin="item";this.implement(apf.ChildValue);this.$attrExcludePropBind=apf.extend({match:1},this.$attrExcludePropBind);this.$supportedProperties.push("submenu","value","match","group","icon","checked","selected","disabled","caption","type");this.$propHandlers.submenu=function(c){apf.setStyleClass(this.$ext,"submenu");};this.$propHandlers.select=function(c){this.select=c?"self::"+c.split("|").join("|self::"):c;};this.$propHandlers.hotkey=function(d){if(this.$hotkey){apf.setNodeValue(this.$hotkey,d);}if(this.$lastHotkey){apf.removeHotkey(this.$lastHotkey);}if(d){this.$lastHotkey=d;var c=this;apf.registerHotkey(d,function(){if(c.disabled||!c.visible){return;}var k=apf.document.getElementsByTagNameNS(apf.ns.aml,"button");for(var j=0;j<k.length;j++){if(k[j].submenu==c.parentNode.name){var g=k[j];g.$setState("Over",{});$setTimeout(function(){g.$setState("Out",{});},200);break;}}c.$down();c.$up();c.$click();});}};this.$propHandlers.icon=function(c){if(this.$icon){apf.skins.setIcon(this.$icon,c,this.parentNode.iconPath);}};this.$propHandlers.caption=function(c){if(this.$caption){apf.setNodeValue(this.$caption,c);}};this.$propHandlers.type=function(c){apf.setStyleClass(this.$ext,c,["item","check","radio"]);};this.$propHandlers.checked=function(c){if(this.type!="check"){return;}if(apf.isTrue(c)){apf.setStyleClass(this.$ext,"checked");}else{apf.setStyleClass(this.$ext,"",["checked"]);}};this.$propHandlers.selected=function(c){if(this.type!="radio"){return;}if(apf.isTrue(c)){apf.setStyleClass(this.$ext,"selected");}else{apf.setStyleClass(this.$ext,"",["selected"]);}};this.$propHandlers.disabled=function(c){if(apf.isTrue(c)){apf.setStyleClass(this.$ext,"disabled");}else{apf.setStyleClass(this.$ext,"",["disabled"]);}};this.enable=function(c){apf.setStyleClass(this.$ext,this.parentNode.$baseCSSname+"Disabled");};this.disable=function(c){apf.setStyleClass(this.$ext,null,[this.parentNode.$baseCSSname+"Disabled"]);};this.addEventListener("AMLReparent",function(c,g,d){if(!this.$amlLoaded){return;}if(!d&&this.skinName!=g.skinName){this.loadAml();}});this.$down=function(){};this.$up=function(){if(this.type=="radio"){this.parentNode.select(this.group,this.value||this.caption);}else{if(this.type=="check"){this.$handlePropSet("checked",!this.checked);}}if(this.submenu){this.$over(null,true);return;}this.parentNode.$hideTree=true;this.parentNode.hide();this.parentNode.dispatchEvent("itemclick",{value:this.value||this.caption,relatedNode:this});};this.$click=function(){this.dispatchEvent("click",{xmlContext:this.parentNode.xmlReference,opener:this.parentNode.opener});};var b;this.$out=function(d){if(apf.isChildOf(this.$ext,d.toElement||d.explicitOriginalTarget)||apf.isChildOf(this.$ext,d.srcElement||d.target)){return;}clearTimeout(b);if(!this.submenu||this.$submenu(true)){apf.setStyleClass(this.$ext,"",["hover"]);var c=this.parentNode.$selected;if(c&&c!=this){apf.setStyleClass(c.$ext,"",["hover"]);}this.parentNode.$selected=null;}};this.$over=function(g,d){if(this.parentNode.$selected==this){return;}if(this.parentNode.$selected){apf.setStyleClass(this.parentNode.$selected.$ext,"",["hover"]);}apf.setStyleClass(this.$ext,"hover");this.parentNode.$selected=this;if(!d&&(apf.isChildOf(this.$ext,g.toElement||g.explicitOriginalTarget)||apf.isChildOf(this.$ext,g.fromElement||g.target))){return;}var j=this.parentNode.$showingSubMenu;if(j){if(j.name==this.submenu){return;}j.hide();this.parentNode.$showingSubMenu=null;}if(this.submenu){if(d){this.$submenu();}else{var c=this;clearTimeout(b);b=$setTimeout(function(){c.$submenu();b=null;},200);}}};this.$submenu=function(c,d){if(!this.submenu){return true;}var g=self[this.submenu];if(!g){throw new Error(apf.formatErrorString(0,this,"Displaying submenu","Could not find submenu '"+this.submenu+"'",this.$aml));return;}if(!c){this.parentNode.$showingSubMenu=g;var j=apf.getAbsolutePosition(this.$ext,this.parentNode.$ext.offsetParent);g.display(j[0]+this.$ext.offsetWidth-3,j[1]+3,false,this,this.parentNode.xmlReference,this.parentNode.$uniqueId);g.setAttribute("zindex",(this.parentNode.zindex||1)+1);}else{if(g.visible&&!d){return false;}if(this.parentNode.$showingSubMenu){this.parentNode.$showingSubMenu=null;}apf.setStyleClass(this.$ext,"",["hover"]);g.hide();return true;}};this.$draw=function(d){var j=this.parentNode;while(j.$canLeechSkin=="item"){j=j.parentNode;}if(j.hasFeature(apf.__MULTISELECT__)){var c=this;if(!this.$hasSetSkinListener){var g;this.parentNode.addEventListener("$skinchange",g=function(){if(c.$amlDestroyed){return;}if(c.$ext.parentNode){this.$deInitNode(c,c.$ext);}var n=j==c.parentNode?j.$container:c.parentNode.$container;var m=n.lastChild;j.$add(c,c.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId,c.parentNode,n!=j.$container&&n,null);j.$fill();if(j.$isTreeArch){c.$container=j.$getLayoutNode("item","container",c.$ext=m&&m.nextSibling||n.firstChild);}else{c.$ext=m&&m.nextSibling||n.firstChild;}var k=c;while((k=k.nextSibling)&&k.nodeType!=1){}if(!k||k.$canLeechSkin!="item"){j.dispatchEvent("afterload");}});this.addEventListener("DOMNodeRemoved",function(k){this.parentNode.removeEventListener("$skinchange",g);});this.$hasSetSkinListener=true;}if(!j.$itemInited){j.canrename=false;j.$removeClearMessage();j.$itemInited=[j.getTraverseNodes,j.getFirstTraverseNode,j.getTraverseParent];j.getTraverseNodes=function(k){return(k||j).getElementsByTagNameNS(apf.ns.apf,"item");};j.getFirstTraverseNode=function(k){return(k||j).getElementsByTagNameNS(apf.ns.apf,"item")[0];};j.getTraverseParent=function(k){return k&&k.parentNode;};j.each=(this.prefix?this.prefix+":":"")+"item";j.$preventDataLoad=true;j.$initingModel=true;j.$setDynamicProperty("icon","[@icon]");j.$setDynamicProperty("image","[@image]");j.$setDynamicProperty("caption","[label/text()|@caption|text()]");j.$setDynamicProperty("eachvalue","[value/text()|@value|text()]");j.$canLoadDataAttr=false;if(!j.xmlRoot){j.xmlRoot=j;}}this.$loadAml=function(){if(!this.getAttribute("caption")){this.setAttribute("caption",this.caption);}var n=j==this.parentNode?j.$container:this.parentNode.$container;var m=n.lastChild;if(!j.documentId){j.documentId=apf.xmldb.getXmlDocId(this);}j.$add(this,apf.xmldb.nodeConnect(j.documentId,this,null,j),this.parentNode,n!=j.$container&&n,null);j.$fill();if(j.$isTreeArch){this.$container=j.$getLayoutNode("item","container",this.$ext=m&&m.nextSibling||n.firstChild);}else{this.$ext=m&&m.nextSibling||n.firstChild;}var k=this;while((k=k.nextSibling)&&k.nodeType!=1){}if(!k||k.$canLeechSkin!="item"){j.dispatchEvent("afterload");if(j.autoselect){j.$selectDefault(this.parentNode);}}};return;}this.$ext=this.$getExternal(this.$isLeechingSkin?"item":"main",null,function(k){var m="var o = apf.lookup("+this.$uniqueId+"); if (o.disabled) return; o";k.setAttribute("onmouseup",m+".$up(event)");k.setAttribute("onmousemove",m+".$over(event)");k.setAttribute("onmouseout",m+".$out(event)");k.setAttribute("onmousedown",m+".$down()");k.setAttribute("onclick",m+".$click()");});this.$caption=this.$getLayoutNode("item","caption",this.$ext);this.$icon=this.$getLayoutNode("item","icon",this.$ext);this.$hotkey=this.$getLayoutNode("item","hotkey",this.$ext);if(!d&&this.nextSibling&&this.nextSibling.$ext){this.$ext.parentNode.insertBefore(this.$ext,this.nextSibling.$ext);}};this.addEventListener("DOMNodeInsertedIntoDocument",function(d){var c=this.$ext?true:false;if(c){if(typeof this.checked!=="undefined"){this.$handlePropSet("checked",this.checked);}else{if(typeof this.selected!=="undefined"){this.$handlePropSet("selected",this.selected);}}if(this.disabled){this.$handlePropSet("disabled",this.disabled);}if(this.caption){this.$handlePropSet("caption",this.caption);}}});}).call(apf.item.prototype=new apf.Presentation());apf.aml.setElement("item",apf.item);apf.WinServer={count:9000,wins:[],setTop:function(d,c){if(d.zindex){return;}if(d.$opened){if(d.$opened.visible){return;}else{delete d.$opened;}}var b;if(!c&&this.wins.length){var b=this.wins[this.wins.length-1];if(b==d){return;}if(!b.modal||!b.visible){b=null;}else{if(b&&d.modal){d.$opener=b;b.$opened=d;b=null;}}}this.count+=2;d.setProperty("zindex",this.count);this.wins.remove(d);this.wins.push(d);if(b){this.setTop(b,true);}return d;},setNext:function(){if(this.wins.length<2){return;}var b,c=this.wins.shift();do{if(this.setTop(b||c).visible){break;}b=this.wins.shift();}while(c!=b);},setPrevious:function(){if(this.wins.length<2){return;}this.wins.unshift(this.wins.pop());var b,c=this.wins.pop();do{if(this.setTop(b||c).visible){break;}b=this.wins.pop();}while(c!=b);},remove:function(b){this.wins.remove(b);}};apf.toolwindow=function(c,b){this.$init(b||"toolwindow",apf.NODE_VISIBLE,c);};apf.modalwindow=function(c,b){this.$init(b||"modalwindow",apf.NODE_VISIBLE,c);};apf.AmlWindow=function(c,b){this.$init(b||"window",apf.NODE_VISIBLE,c);};(function(){this.implement(apf.BaseStateButtons);this.$isWindowContainer=true;this.collapsedHeight=30;this.canHaveChildren=2;this.visible=false;this.showdragging=false;this.kbclose=false;this.$focussable=apf.KEYBOARD;this.$editableCaption=["title"];this.setTitle=function(d){this.setProperty("title",d,false,true);return this;};this.setIcon=function(d){this.setProperty("icon",d,false,true);return this;};this.show=function(d){this.execAction=d;this.setProperty("visible",true,false,true);return this;};this.slideIn=function(m,j){if(!m){m="bottom";}var q=this.center;this.center=false;this.setProperty("visible",true);this.center=q;var g=0,t=0,o=(apf.isIE?this.$ext.offsetParent.offsetWidth:window.innerWidth),k=(apf.isIE?this.$ext.offsetParent.offsetHeight:window.innerHeight),s=Math.max(0,((o-this.$ext.offsetWidth)/2)),r=Math.max(0,((k-this.$ext.offsetHeight)/3)),d="top",n=10;switch(m){case"top":g=-(this.$ext.offsetHeight)-n;t=j?0:r;break;case"left":g=-(this.$ext.offsetWidth)-n;t=j?0:s;d="left";break;case"bottom":g=k+this.$ext.offsetHeight+n;t=j?k-this.$ext.offsetHeight:r;break;case"right":g=o+this.$ext.offsetLeft+n;t=j?o-this.$ext.offsetWidth:s;d="left";break;}apf.tween.single(this.$ext,{steps:apf.isIphone?5:30,interval:10,from:g,to:t,type:d,anim:apf.tween.EASEIN});return this;};this.slideOut=function(g){if(!g){g="bottom";}var n=0,m=0,k="top",j=10;switch(g){case"top":n=this.$ext.offsetTop;m=-(this.$ext.offsetHeight)-j;break;case"left":n=this.$ext.offsetLeft;m=-(this.$ext.offsetWidth)-j;k="left";break;case"bottom":n=this.$ext.offsetTop;m=(apf.isIE?this.$ext.offsetParent.offsetHeight:window.innerHeight)+this.$ext.offsetHeight+j;break;case"right":n=this.$ext.offsetLeft;m=(apf.isIE?this.$ext.offsetParent.offsetWidth:window.innerWidth)+this.$ext.offsetLeft+j;k="left";break;}var d=this;apf.tween.single(this.$ext,{steps:apf.isIphone?5:30,interval:10,from:n,to:m,type:k,anim:apf.tween.EASEOUT,onfinish:function(){d.setProperty("visible",false);}});return this;};this.bringToFront=function(){apf.WinServer.setTop(this);return this;};this.syncAlignment=function(d){if(d.hidden==3){apf.WinServer.setTop(this);}if(d.state>0){this.$setStyleClass(this.$ext,this.$baseCSSname+"Min",[this.$baseCSSname+"Edit",this.$baseCSSname+"Max"]);}else{this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Min",this.$baseCSSname+"Edit",this.$baseCSSname+"Max"]);}};this.$booleanProperties.modal=true;this.$booleanProperties.center=true;this.$booleanProperties.transaction=true;this.$booleanProperties.hideselects=true;this.$booleanProperties.showdragging=true;this.$booleanProperties.kbclose=true;this.$supportedProperties.push("title","icon","modal","minwidth","minheight","hideselects","center","kbclose","maxwidth","maxheight","showdragging","transaction");this.$propHandlers.modal=function(g){if(g&&!this.oCover){var d=this.$getLayoutNode("cover");if(d){this.oCover=apf.insertHtmlNode(d,this.$pHtmlNode);if(!this.visible){this.oCover.style.display="none";}if(this.zindex){this.oCover.style.zIndex=this.zindex;}}}if(!g&&this.oCover){this.oCover.style.display="none";}};this.$propHandlers.center=function(d){this.$ext.style.position="absolute";};this.$propHandlers.title=function(d){if(this.oTitle){this.oTitle.nodeValue=d;}};this.$propHandlers.icon=function(d){if(!this.oIcon){return;}this.oIcon.style.display=d?"block":"none";apf.skins.setIcon(this.oIcon,d,this.iconPath);};var c=[],b;this.$propHandlers.visible=function(o){if(apf.isTrue(o)){if(this.oCover){if(this.oCover.offsetParent){}this.oCover.style.display="block";}this.state=this.state.split("|").remove("closed").join("|");this.$ext.style.display="block";if(apf.layout&&this.$int){apf.layout.forceResize(this.$int);}if(this.center){apf.layout.processQueue();var n=!this.$ext.offsetParent||this.$ext.offsetParent.tagName=="BODY"?[apf.getWindowWidth(),apf.getWindowHeight()]:[this.$ext.offsetParent.offsetWidth,this.$ext.offsetParent.offsetHeight,0,0];if(n.length==2){n.push(document.documentElement.scrollLeft,document.documentElement.scrollTop);}this.$ext.style.left=(Math.max(0,((n[0]-parseInt(this.width))/2))+n[2])+"px";this.$ext.style.top=(Math.max(0,((n[1]-parseInt(this.height))/3))+n[3])+"px";}if(!apf.canHaveHtmlOverSelects&&this.hideselects){c=[];var k=document.getElementsByTagName("select");for(var m=0;m<k.length;m++){var j=apf.getStyle(k[m],"display");c.push([k[m],j]);k[m].style.display="none";}}if(this.modal){this.bringToFront();}if(!this.$rendered){this.addEventListener("afterrender",function(){if(this.$amlLoaded&&(this.model||(!this.dockable||!this.aData)&&!this.$isWidget&&this.localName!="toolwindow")){this.focus(false,{mouse:true});}});}else{if(this.$amlLoaded&&(this.model||(!this.dockable||!this.aData)&&!this.$isWidget&&this.localName!="toolwindow")){this.focus(false,{mouse:true});}}if(apf.isIE){var g=this.$ext.className;this.$ext.className="rnd"+Math.random();this.$ext.className=g;}var d=this;$setTimeout(function(){d.dispatchEvent("show");});}else{if(this.oCover){this.oCover.style.display="none";}this.$ext.style.display="none";if(!apf.canHaveHtmlOverSelects&&this.hideselects){for(var m=0;m<c.length;m++){c[m][0].style.display=c[m][1];}}if(this.hasFocus()){apf.window.moveNext(true,this,true);}this.dispatchEvent("close");this.visible=false;}b=o;};this.$propHandlers.zindex=function(d){this.$ext.style.zIndex=d+1;if(this.oCover){this.oCover.style.zIndex=d;}};if(!apf.isIphone){this.addEventListener("keydown",function(j){var g=j.keyCode;var m=j.ctrlKey;var d=j.shiftKey;var k=false;switch(g){case 38:if(d&&this.resizable){this.setProperty("height",Math.max(this.minheight||0,this.$ext.offsetHeight-(m?50:10)));}else{if(this.draggable){this.setProperty("top",this.$ext.offsetTop-(m?50:10));}}break;case 37:if(d&&this.resizable){this.setProperty("width",Math.max(this.minwidth||0,this.$ext.offsetWidth-(m?50:10)));}else{if(this.draggable){this.setProperty("left",this.$ext.offsetLeft-(m?50:10));}}break;case 39:if(d&&this.resizable){this.setProperty("width",Math.min(this.maxwidth||10000,this.$ext.offsetWidth+(m?50:10)));}else{if(this.draggable){this.setProperty("left",this.$ext.offsetLeft+(m?50:10));}}break;case 40:if(d&&this.resizable){this.setProperty("height",Math.min(this.maxheight||10000,this.$ext.offsetHeight+(m?50:10)));}else{if(this.draggable){this.setProperty("top",this.$ext.offsetTop+(m?50:10));}}break;default:k=null;return;}if(apf.hasSingleRszEvent){apf.layout.forceResize(this.$int);}return k;},true);this.addEventListener("keydown",function(d){if(d.keyCode==27&&this.buttons.indexOf("close")>-1&&(!this.dockable||!this.aData)&&this.kbclose){this.close();}});}this.$draw=function(){this.popout=apf.isTrue(this.getAttribute("popout"));if(this.popout){this.$pHtmlNode=document.body;}this.$ext=this.$getExternal(null,null,function(g){this.$initButtons(g);});this.oTitle=this.$getLayoutNode("main","title",this.$ext);this.oIcon=this.$getLayoutNode("main","icon",this.$ext);this.oDrag=this.$getLayoutNode("main","drag",this.$ext);this.$buttons=this.$getLayoutNode("main","buttons",this.$ext);this.oDrag.host=this;if(this.popout){this.$ext.style.position="absolute";}if(this.oIcon){this.oIcon.style.display="none";}if(!apf.isIphone){var d=this;this.oDrag.onmousedown=function(g){if(!g){g=event;}if(!d.$isWidget&&(!d.aData||!d.dockable||d.aData.hidden==3)){apf.WinServer.setTop(d);}if(d.$lastState.maximized){return false;}if(d.aData&&d.dockable){if(d.$lastState.normal){d.startDocking(g);}return false;}};this.$ext.onmousedown=function(){var g=apf.document.activeElement;if(g&&g.$focusParent!=d&&g.$focusParent.modal){return false;}if(!d.$isWidget&&(!d.aData||!d.dockable||d.aData.hidden==3)){apf.WinServer.setTop(d);}if(!d.$lastState.normal){return false;}};this.$ext.onmousemove=function(){if(!d.$lastState.normal){return false;}};}};this.$loadAml=function(g){apf.WinServer.setTop(this);this.$int=this.$getLayoutNode("main","container",this.$ext);if(!apf.isIphone){if(this.oTitle){var d=this;(this.oTitle.nodeType!=1?this.oTitle.parentNode:this.oTitle).ondblclick=function(j){if(d.state.indexOf("normal")==-1){d.restore();}else{if(d.buttons.indexOf("max")>-1){d.maximize();}else{if(d.buttons.indexOf("min")>-1){d.minimize();}}}};}if(typeof this.draggable=="undefined"){(this.$propHandlers.draggable||apf.GuiElement.propHandlers.draggable).call(this,true);this.draggable=true;}if(typeof this.buttons=="undefined"){this.buttons="";}}if(this.modal===undefined&&this.oCover){this.$propHandlers.modal.call(this,true);this.modal=true;}if(!this.visible){this.$ext.style.display="none";if(this.oCover){this.oCover.style.display="none";}}else{if(this.modal){var d=this;apf.queue.add("focus",function(){d.focus(false,{mouse:true});});}}if(this.minwidth===undefined){this.minwidth=this.$getOption("Main","min-width");}if(this.minheight===undefined){this.minheight=this.$getOption("Main","min-height");}if(this.maxwidth===undefined){this.maxwidth=this.$getOption("Main","max-width");}if(this.maxheight===undefined){this.maxheight=this.$getOption("Main","max-height");}if(this.center&&this.visible){this.visible=false;this.$ext.style.display="none";var d=this;$setTimeout(function(){d.setProperty("visible",true);});}};this.$destroy=function(d){if(this.oDrag){this.oDrag.host=null;this.oDrag.onmousedown=null;apf.destroyHtmlNode(this.oDrag);this.oDrag=null;}this.oTitle=this.oIcon=this.oCover=null;if(this.$ext&&!d){this.$ext.onmousedown=null;this.$ext.onmousemove=null;}};}).call(apf.modalwindow.prototype=new apf.Presentation());apf.AmlWindow.prototype=apf.toolwindow.prototype=apf.modalwindow.prototype;apf.aml.setElement("toolwindow",apf.toolwindow);apf.aml.setElement("modalwindow",apf.modalwindow);apf.aml.setElement("window",apf.modalwindow);apf.actiontracker=function(c,b){this.$init(b||"actiontracker",apf.NODE_HIDDEN,c);this.$undostack=[];this.$redostack=[];this.$execstack=[];};(function(){this.$lastExecStackItem=null;this.realtime=true;this.undolength=0;this.redolength=0;this.$booleanProperties={};this.$booleanProperties.realtime=true;this.$supportedProperties=["realtime","undolength","redolength","alias","length","position"];this.$handlePropSet=function(g,d,c){switch(g){case"undolength":this.undolength=this.$undostack.length;break;case"redolength":this.redolength=this.$redostack.length;break;default:this[g]=d;}};this.addEventListener("DOMNodeInsertedIntoDocument",function(c){if(this.parentNode){this.parentNode.$at=this;}});this.define=function(d,c){apf.actiontracker.actions[d]=c;};this.getParent=function(){return this.parentNode&&this.parentNode.getActionTracker?this.parentNode.getActionTracker(true):(apf.window.$at!=this?apf.window.$at:null);};this.getDone=function(g){if(typeof g!="number"){return[];}for(var j,c,d=c=this.$stackDone.length;d>=0;--d){if(!(j=this.$stackDone[d])||!j.timestamp){continue;}if(j.timestamp>=g){return this.$stackDone.slice(d);}}return[];};this.getUndone=function(g){if(typeof g!="number"){return[];}for(var j,d=0,c=this.$stackDone.length;d<c;++d){if(!(j=this.$stackUndone[d])||!j.timestamp){continue;}if(j.timestamp<=g){return this.$stackUndone.slice(0,d+1);}}return[];};this.execute=function(c){if(this.dispatchEvent("beforechange",c)===false){return false;}var d=new apf.UndoData(c,this);if(c.action&&!c.transaction){apf.actiontracker.actions[c.action](d,false,this);}d.id=this.$undostack.push(d)-1;this.setProperty("undolength",this.$undostack.length);if(d.multiple){this.$addToQueue(d.multiple,false,true);}else{this.$addToQueue(d,false);}this.$redostack.length=0;this.setProperty("redolength",this.$redostack.length);this.dispatchEvent("afterchange",{action:"do"});return d;};this.purge=function(d,c){if(true){if(this.$execstack.length){this.$execstack[0].undoObj.saveChange(this.$execstack[0].undo,this);this.$lastExecStackItem=this.$execstack[this.$execstack.length-1];}}else{if(parent){this.reset();}}};this.reset=function(){this.$undostack.length=this.$redostack.length=0;this.setProperty("undolength",0);this.setProperty("redolength",0);this.dispatchEvent("afterchange",{action:"reset"});};this.undo=function(g,d,c){b.call(this,g,d,true,c);};this.redo=function(g,d,c){b.call(this,g,d,false,c);};function b(o,n,d,c){var g=d?this.$undostack:this.$redostack,m=d?this.$redostack:this.$undostack;if(!g.length){return;}if(n){var k=g[o];if(!k){return;}if(o!=g.length-1){throw new Error("callstack got corrupted");}g.length--;m.push(k);if(k.action){apf.actiontracker.actions[k.action](k,d,this);}if(!c){if(k.multiple){this.$addToQueue(k.multiple,d,true);}else{this.$addToQueue(k,d);}}this.setProperty("undolength",this.$undostack.length);this.setProperty("redolength",this.$redostack.length);return k;}if(this.dispatchEvent("beforechange")===false){return;}apf.console.info("Executing "+(d?"undo":"redo"));if(o==-1){o=g.length;}if(!o){o=1;}var j=0;while(j<o&&g.length>0){if(!g[g.length-1]){g.length--;apf.console.error("The actiontracker is in an invalid                                    state. The entire undo and redo stack will                                    be cleared to prevent further corruption                                   This is a serious error, please contact                                    the system administrator.");this.$undostack=[];this.$redostack=[];return false;}else{b.call(this,g.length-1,true,d,c);j++;}}this.dispatchEvent("afterchange",{action:d?"undo":"redo",rollback:c});}this.$receive=function(j,g,c,d,m){if(g==apf.TIMEOUT&&c.tpModule.retryTimeout(c,g,this)===true){return true;}if(g!=apf.SUCCESS){if(this.dispatchEvent("actionfail",apf.extend(c,{state:g,message:"Could not sent Action RPC request for control "+this.name+"["+this.localName+"] \n\n"+c.message,bubbles:true}))===false){apf.console.warn("You have cancelled the automatic undo                     process! Please be aware that if you don't retry this call                     the queue will fill up and none of the other actions will                     be sent through.");return true;}if(typeof apf.offline!="undefined"&&!apf.offline.reloading){this.undo(d.id,c.userdata,true);}if(m){m(!c.userdata);}if(!c.userdata){this.$execstack=[];var k=new Error(apf.formatErrorString(0,this,"Executing action","Error sending action to the server:\n"+(c.url?"Url:"+c.url+"\n\n":"")+c.message));if((d&&d.xmlActionNode||c.amlNode||apf).dispatchEvent("error",apf.extend({error:k,state:g,bubbles:true},c))===false){return;}throw k;}}else{this.dispatchEvent("actionsuccess",apf.extend(c,{state:g,bubbles:true},c));if(m){m();}}this.$queueNext(d,m);};this.$addToQueue=function(j,d,n){if(!n&&this.$execstack.length&&!j.state&&this.$execstack[this.$execstack.length-1].undoObj==j){this.$execstack.length--;return;}var c,k,m;if(n){var k,m=this.$execstack.shift();for(var g=0;g<j.length;g++){k=j[g];this.$execstack.unshift({undoObj:(k.tagName?k:new apf.UndoData(k,this)).preparse(d,this),undo:d});}if(m){this.$execstack.unshift(m);}return;}m={undoObj:j.preparse(d,this),undo:d};this.$execstack.push(m)-1;if(this.$execstack.length==1&&this.realtime){j.saveChange(d,this);}};this.$queueNext=function(d,g){if(!this.$execstack[0]||this.$execstack[0].undoObj!=d){throw new Error(apf.formatErrorString(0,this,"Executing Next                 action in queue","The execution stack was corrupted. This is                 a fatal error. The application should be restarted. You will                 lose all your changes. Please contact the administrator."));}d.state=null;var c=this.$execstack.shift();if(!this.$execstack[0]||c==this.$lastExecStackItem){return;}this.$execstack[0].undoObj.saveChange(this.$execstack[0].undo,this,g);};}).call(apf.actiontracker.prototype=new apf.AmlElement());apf.aml.setElement("actiontracker",apf.actiontracker);apf.param=function(c,b){this.$init(b||"param",apf.NODE_HIDDEN,c);};apf.param.prototype=new apf.AmlElement();apf.param.prototype.$parsePrio="002";apf.aml.setElement("variable",apf.param);apf.aml.setElement("param",apf.param);apf.datagrid=function(c,b){this.$init(b||"datagrid",apf.NODE_VISIBLE,c);this.$headings=[],this.$cssRules=[];this.$lastOpened={};this.$editors={};this.$dynCssClasses=[];};(function(){var c=1<<1,g=1<<2,j=1<<3,k=1<<4,d=this.$treeState;this.implement(apf.DataAction);this.bufferselect=false;this.$useTable=false;this.$focussable=true;this.$isWindowContainer=-1;this.$widthdiff=0;this.$defaultwidth=0;this.$useiframe=0;this.$needsDepth=true;this.canrename=false;this.$booleanProperties.iframe=true;function b(q,r){for(var o=0;o<q.length;o++){if(!q[o][1]){continue;}if(apf.isIE){(r||window).document.styleSheets[0].addRule(q[o][0],q[o][1]);}else{(r||window).document.styleSheets[0].insertRule(q[o][0]+" {"+q[o][1]+"}",0);}}}function n(){var q=(this.current||this.$selected),r=this.$container;r.scrollTop=(q.offsetTop)-21;}this.$focus=function(){if(!this.$ext||(apf.isIE&&this.$useiframe&&this.cssfix)){return;}this.$setStyleClass(this.$ext,this.$baseCSSname+"Focus");if(this.oDoc){this.$setStyleClass(this.oDoc.documentElement,this.$baseCSSname+"Focus");}};this.$blur=function(){if(!this.$ext||(apf.isIE&&this.$useiframe&&this.cssfix)){return;}this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Focus"]);if(this.oDoc){this.$setStyleClass(this.oDoc.documentElement,"",[this.$baseCSSname+"Focus"]);}m.call(this);};this.addEventListener("bindingsload",this.$loaddatabinding=function(u){var A=u.bindings.column;if(!A||!A.length){return;}this.$headings=A;var s=0,t=false;for(var r,q=0,o=A.length;q<o;q++){r=A[q];if(!r.$width){throw new Error("missing width");}if(!r.$isPercentage){s+=parseFloat(r.$width)||0;}else{t=true;}}if(!t){this.$isFixedGrid=true;this.$setStyleClass(this.$ext,"fixed");if(this.$useiframe){this.$setStyleClass(this.oDoc.documentElement,"fixed");}}else{}if(s>0&&!this.$isFixedGrid){var w=s;this.$cssRules.push(["."+this.$baseCSSname+" .row"+this.$uniqueId,"padding-right:"+w+"px;margin-right:-"+w+"px"]);this.$container.style.paddingRight=this.$head.style.paddingRight=w+"px";}this.$fixed=s;this.$first=0;this.$withContainer=u.bindings.description?true:false;b(this.$cssRules,window);if(this.$useiframe){b(this.$cssRules,this.oWin);}});this.$initNode=function(C,q,B,t){this.$getNewContext("item");var r=this.$getLayoutNode("item");r.setAttribute("id",B);r.setAttribute("class",r.getAttribute("class")+" "+d[q]+" item"+this.$uniqueId);this.$setStyleClass(this.$getLayoutNode("item","container"),d[q]);r.setAttribute("ondblclick","var o = apf.lookup("+this.$uniqueId+");o.choose(null, true);"+(this.$withContainer?"o.slideToggle(this, null, true);":"")+(this.celledit&&!this.namevalue?"o.startRename(null, null, true);":""));if(this.hasFeature(apf.__DRAGDROP__)){r.setAttribute("onmouseout","this.hasPassedDown = false;");r.setAttribute("onmousedown","var o = apf.lookup("+this.$uniqueId+");                var xmlNode = apf.xmldb.findXmlNode(this);                 var isSelected = o.isSelected(xmlNode);                 this.hasPassedDown = true;                 if (!o.hasFeature(apf.__DRAGDROP__) || !isSelected && !event.ctrlKey)                     o.select(this, event.ctrlKey, event.shiftKey, -1);"+(this.cellselect||this.namevalue?"o.selectCell(event, this, isSelected);":""));r.setAttribute("onmouseup","if (!this.hasPassedDown) return;                var o = apf.lookup("+this.$uniqueId+");                 var xmlNode = apf.xmldb.findXmlNode(this);                 var isSelected = o.isSelected(xmlNode);                 if (o.hasFeature(apf.__DRAGDROP__))                     o.select(this, event.ctrlKey, event.shiftKey, -1);");}else{r.setAttribute("onmousedown","var o = apf.lookup("+this.$uniqueId+");                var wasSelected = o.$selected == this;                o.select(this, event.ctrlKey, event.shiftKey, -1);"+(this.cellselect||this.namevalue?"o.selectCell(event, this, wasSelected);":""));}for(var D,w,u=0;u<this.$headings.length;u++){w=this.$headings[u];if(w.tree){this.$getNewContext("treecell");D=this.$getLayoutNode("treecell");var o=this.$getLayoutNode("treecell","openclose");o.setAttribute("style","margin-left:"+(((t||0))*15+4)+"px;");o.setAttribute("onmousedown","var o = apf.lookup("+this.$uniqueId+");                    o.slideToggle(this, null, null, true);                    event.cancelBubble = true;                    apf.window.$mousedown(event);");o.setAttribute("ondblclick","event.cancelBubble = true");}else{this.$getNewContext("cell");D=this.$getLayoutNode("cell");}apf.setStyleClass(D,w.$className);if(w.css){apf.setStyleClass(D,(apf.lm.compile(w.css))(C));}if(w.icon){var s=this.$getLayoutNode(w.tree?"treecell":"cell","caption",r.appendChild(D));(s.nodeType==1&&s||s.parentNode).setAttribute("style","padding-left:19px;background:url("+apf.getAbsolutePath(this.iconPath,((w.cicon||w.$compile("icon",{nostring:true}))(C)||""))+") no-repeat 0 0;");}if(w.value){apf.setNodeValue(this.$getLayoutNode(w.tree?"treecell":"cell","caption",r.appendChild(D)),(w.cvalue2||w.$compile("value",{nostring:true}))(C)||"");}}if(this.$bindings&&this.$bindings.color){var A=this.$getDataNode("color",C);this.$setStyleClass(r,A?"highlight":null,A?["highlight"]:null);}var E=this.$applyBindRule("css",C);if(E){this.$setStyleClass(r,E);if(E){this.$dynCssClasses.push(E);}}return r;};this.$updateNode=function(B,A){if(!A){return;}var o=this.$head.childNodes,r=A.childNodes,C,q;if(!this.namevalue&&this.$curBtn){q=this.$curBtn.parentNode;}var t,u,s=0;t=r[0];while(t){if(t.nodeType!=1){t=t.nextSibling;continue;}u=apf.all[o[s].getAttribute("hid")];C=this.$getLayoutNode(u.tree?"treecell":"cell","caption",t)||t;if(u.css){apf.setStyleClass(C,(apf.lm.compile(u.css))(B));}if(u.tree){}if(u.value){C.innerHTML=(u.cvalue2||u.$compile("value",{nostring:true}))(B)||"";}if(u.icon){(C.nodeType==1&&C||C.parentNode).style.backgroundImage="url("+apf.getAbsolutePath(this.iconPath,((u.cicon||u.$compile("icon",{nostring:true}))(B)||""))+")";}s++;t=t.nextSibling;}if(this.$bindings&&this.$bindings.color){var w=this.$getDataNode("color",B);this.$setStyleClass(A,w?"highlight":null,w?["highlight"]:null);}var D=this.$applyBindRule("css",B);if(D||this.$dynCssClasses.length){this.$setStyleClass(A,D,this.$dynCssClasses);if(D&&!this.$dynCssClasses.contains(D)){this.$dynCssClasses.push(D);}}};this.$dblclick=function(w){var s=this,D,o;while(!(D=w.getAttribute(apf.xmldb.htmlIdTag))||D.indexOf("|")==-1){w=(o=w).parentNode;}if(this.$lastEditor&&this.$lastEditor[3]==w){return;}var J,q=o.className.match(/(col\d+)/)[1];for(var I=0;I<this.$headings.length;I++){if(this.$headings[I].$className==q){J=this.$headings[I];break;}}if(!J.editor){return;}var r=apf.xmldb.getNode(w);var H=J.tree?this.$getLayoutNode("cell","caption",o):o;var C,t=J.editor;var u=apf.lm.compile(t,{xpathmode:2});var F=H.childNodes;for(var I=0,G=F.length;I<G;I++){if(!F[I].host){if(F[I].nodeType==1){F[I].style.display="none";}else{this.$lastTextValue=F[I].nodeValue;F[I].nodeValue="";}}}if(u.type==2){if(!this.$editors[t]){var E=apf.namespaces[apf.ns.aml].elements[t];var K={htmlNode:H,style:"position:relative;z-index:10000",value:"[{"+this.id+".selected}::"+(v=J.value).substr(1,v.length-2)+"]",focussable:false};if(!J.tree){K.width="100%-3";}C=this.$editors[t]=new E(K);var A=apf.getBox(apf.getStyle(C.$ext,"margin"));if(A[1]||A[3]){C.setAttribute("width","100%+2-"+(A[1]+A[3]));}C.addEventListener("blur",function(){m.call(s);});C.parentNode=this;C.realtime=false;C.$focusParent=this;C.setAttribute("focussable","true");C.addEventListener("keydown",function(L){if(L.keyCode==13){m.call(s);s.$focus();}else{if(L.keyCode==27){C.removeAttribute("value");m.call(s);}}});C.$executeAction=function(){this.parentNode.$executeAction.apply(this.parentNode,arguments);};}else{C=this.$editors[t];if(C.hasFeature(apf.__MULTISELECT__)){C.setAttribute("model","{apf.xmldb.getElementById('"+prop.getAttribute(apf.xmldb.xmlIdTag)+"')}");}C.setAttribute("value","[{"+this.id+".selected}::"+(v=J.value).substr(1,v.length-2)+"]");C.setProperty("visible",true);H.appendChild(C.$ext);C.setAttribute("width",J.tree?"":"100%-3");}}else{var B=u.call(this,this.xmlRoot);if(B.localName=="template"){}else{}}if(C.localName=="textbox"){C.select();}C.focus();C.$focus();this.$setStyleClass(w,"editing");this.$lastEditor=[C,H,r,w,this.getActionTracker().undolength];};this.addEventListener("mousedown",function(o){if(this.$lastEditor&&!apf.isChildOf(this.$lastEditor[1],o.htmlEvent.srcElement||o.htmlEvent.target,true)){m.call(this);}});this.addEventListener("beforeselect",function m(t){if(this.$lastEditor){var r=this.$lastEditor;this.$lastEditor=null;r[0].setProperty("visible",false);var q=r[1].childNodes;for(var s=0,o=q.length;s<o;s++){if(!q[s].host){if(q[s].nodeType==1){q[s].style.display="";}else{if(!r[0].value){q[s].nodeValue=this.$lastTextValue;}}}}this.$setStyleClass(r[3],"",["editing"]);this.focus();}});this.getColumn=function(o){return this.$headings[o||this.$lastcol||0];};this.resizeColumn=function(r,q){var o=this.$headings[r];o.resize(q);};this.hideColumn=function(q){var o=this.$headings[q];o.hide();};this.showColumn=function(q){var o=this.$headings[q];o.show();};this.sortColumn=function(o){var q=this.$headings[nr];q.sort();};this.moveColumn=function(r,q){var o=this.$headings[nr];o.move(q);};this.$draw=function(){this.$drawBase();var o=this;this.$ext.onmousedown=function(s){o.dispatchEvent("mousedown",{htmlEvent:s||event});};this.$head=this.$getLayoutNode("main","head",this.$ext);this.$pointer=this.$getLayoutNode("main","pointer",this.$ext);if(this.$head.firstChild){this.$head.removeChild(this.$head.firstChild);}if(this.$container.firstChild){this.$container.removeChild(this.$container.firstChild);}var q=this.$widthdiff=this.$getOption("main","widthdiff")||0;this.$defaultwidth=this.$getOption("main","defaultwidth")||"100";this.$useiframe=apf.isIE&&(apf.isTrue(this.$getOption("main","iframe"))||this.iframe);if(this.$useiframe&&!this.oIframe){var r=this.$container.className;this.oIframe=this.$container.appendChild(document.createElement(apf.isIE?"<iframe frameborder='0'></iframe>":"iframe"));this.oIframe.frameBorder=0;this.oWin=this.oIframe.contentWindow;this.oDoc=this.oWin.document;this.oDoc.write('<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">                <html xmlns="http://www.w3.org/1999/xhtml">                    <head><script>                        apf = {                            lookup : function(uid){                                return window.parent.apf.lookup(uid);                            },                            Init : {add:function(){},run:function(){}}                        };<\/script>                    </head>                    <body></body>                </html>');this.$container=this.oDoc.body;this.$container.className=r;this.oDoc.documentElement.className=this.$ext.className;apf.skins.loadCssInWindow(this.skinName,this.oWin,this.mediaPath,this.iconPath);if(apf.isIE){this.$setStyleClass(this.oDoc.documentElement,this.$baseCSSname+"Focus");}apf.convertIframe(this.oIframe,true);if(apf.getStyle(this.oDoc.documentElement,"overflowY")=="auto"){this.oIframe.onresize=function(){o.$head.style.marginRight=o.oDoc.documentElement.scrollHeight>o.oDoc.documentElement.offsetHeight?"16px":"0";};this.addEventListener("afterload",this.oIframe.onresize);this.addEventListener("xmlupdate",this.oIframe.onresize);}this.oDoc.documentElement.onscroll=function(){if(o.$isFixedGrid){o.$head.scrollLeft=o.oDoc.documentElement.scrollLeft;}};}else{if(apf.getStyle(this.$container,"overflowY")=="auto"){this.$resize=function(){o.$head.style.marginRight=o.$container.scrollHeight>o.$container.offsetHeight?"16px":"0";};apf.layout.setRules(this.$ext,this.$uniqueId+"_datagrid","var o = apf.all["+this.$uniqueId+"];                     if (o) o.$resize()");apf.layout.queue(this.$ext);this.addEventListener("afterload",this.$resize);this.addEventListener("xmlupdate",this.$resize);}this.$container.onscroll=function(){if(o.$isFixedGrid){o.$head.scrollLeft=o.$container.scrollLeft;}};}this.$container.ondblclick=function(s){if(!s){s=event;}o.$dblclick(s.srcElement||s.target);};};this.$destroy=function(){this.$ext.onclick=this.$container.onresize=null;apf.layout.removeRule(this.$container,"dg"+this.$uniqueId);apf.layout.activateRules(this.$container);};}).call(apf.datagrid.prototype=new apf.BaseTree());apf.aml.setElement("datagrid",apf.datagrid);apf.aml.setElement("description",apf.BindingRule);apf.aml.setElement("color",apf.BindingRule);apf.aml.setElement("contents",apf.BindingRule);apf.skin=function(c,b){this.$init(b||"skin",apf.NODE_HIDDEN,c);};apf.aml.setElement("skin",apf.skin);(function(){this.$parsePrio="002";this.$includesRemaining=0;this.$propHandlers.src=function(j){this.$path=apf.getAbsolutePath(apf.hostPath,j);b.call(this,this.$path);};this.$propHandlers.name=function(j){if(!this.attributes.getNamedItem("src")){this.$path=apf.getAbsolutePath(apf.hostPath,j)+"/index.xml";b.call(this,this.$path);}};function g(m){if(!m.ownerDocument.documentElement){return false;}var j=m.ownerDocument.documentElement.attributes;for(var n=false,k=0;k<j.length;k++){if(j[k].nodeValue==apf.ns.aml){n=true;break;}}if(!n){throw new Error(apf.formatErrorString(0,null,"Checking for the aml namespace","The Ajax.org Platform xml namespace was not found in "+(m.getAttribute("filename")?"in '"+m.getAttribute("filename")+"'":"")));}return n;}function b(j){var m=this.ownerDocument.$domParser;if(!apf.skins.$first){apf.skins.$first=this;}var k=this.attributes.getNamedItem("defer");if(!k||!apf.isTrue(k.nodeValue)){m.$shouldWait++;this.$parseContext=m.$parseContext||[this.ownerDocument.documentElement];}c.call(this,j);}function d(j){if(j){apf.skins.Init(j,this,this.$path);}if(!this.defer){var k=this.ownerDocument.$domParser;k.$continueParsing.apply(k,this.$parseContext);}}function c(k){apf.console.info("Loading include file: "+k);var j=this;apf.getData(k,{type:"skin",callback:function(q,o,m){if(o!=apf.SUCCESS){var r=new Error(apf.formatErrorString(1007,j,"Loading skin file","Could not load skin file '"+(k||j.src)+"'\nReason: "+m.message));if(m.tpModule.retryTimeout(m,o,null,r)===true){return true;}throw r;}q=q.replace(/\<\!DOCTYPE[^>]*>/,"").replace(/^[\r\n\s]*/,"").replace(/xmlns\=\"[^"]*\"/g,"");if(!q){throw new Error(apf.formatErrorString(0,j,"Loading skin","Empty skin file. Maybe the file does not exist?",j));}var n=apf.getXml(q);g(n);if(!n){throw new Error(apf.formatErrorString(0,j,"Loading skin","Could not parse skin. Maybe the file does not exist?",j));}n.setAttribute("filename",m.url);apf.console.info("Loading of "+n[apf.TAGNAME].toLowerCase()+" skin done from file: "+m.url);d.call(j,n);},async:true,ignoreOffline:true});}this.addEventListener("DOMNodeInsertedIntoDocument",function(j){if(this.src||this.name){return;}apf.skins.Init(this.$aml||this);});}).call(apf.skin.prototype=new apf.AmlElement());apf.model=function(c,b){this.$init(b||"model",apf.NODE_HIDDEN,c);this.$amlNodes={};this.$propBinds={};this.$listeners={};this.$proplisteners={};if(!apf.globalModel){apf.globalModel=this;apf.nameserver.register("model","@default",this);}};(function(){this.$parsePrio="020";this.$isModel=true;this.canHaveChildren=false;this["save-original"]=true;this.$state=0;this.$attrExcludePropBind=apf.extend({submission:1,src:1,session:1},this.$attrExcludePropBind);this.$booleanProperties.autoinit=true;this.$booleanProperties["save-original"]=true;this.$supportedProperties=["submission","src","session","autoinit","save-original","remote"];this.$propHandlers.src=this.$propHandlers.get=function(b,c){if(this.$amlLoaded){this.$loadFrom(b);}};this.$propHandlers.validation=function(b,c){apf.nameserver.get("validation",b).register(this);};this.register=function(k,m){if(!k||!k.load){return this;}var g=k.$model==this;if(k.$model&&!g){k.$model.unregister(k);}var o=this.$amlNodes[k.$uniqueId]={amlNode:k,xpath:m};k.$model=this;if(typeof k.noloading=="undefined"&&k.$setInheritedAttribute&&!k.$setInheritedAttribute("noloading")){k.noloading=false;}if(this.$state==1){if(k.clear&&!k.noloading){k.clear("loading");}}else{if(this.data){this.$loadInAmlNode(o);}else{if(k.clear){k.clear("empty");}}}var d,j,n=k.$propsUsingMainModel,c=k.$uniqueId;for(var b in n){this.$unbindXmlProperty(k,b);d=this.$bindXmlProperty(k,b,n[b].xpath,n[b].optimize);if(this.data){if(j=d.root||d.listen?this.data.selectSingleNode(d.root||d.listen):this.data){k.$execProperty(b,j);}else{this.$waitForXml(k,b);}}}return this;};this.$register=function(c,b){this.$amlNodes[c.$uniqueId].xpath=b;};this.unregister=function(b){delete this.$amlNodes[b.$uniqueId];var c=b.$propsUsingMainModel;for(var d in c){this.$unbindXmlProperty(b,d);}};this.getXpathByAmlNode=function(b){var c=this.$amlNodes[b.$uniqueId];if(!c){return false;}return c.xpath;};this.$loadInAmlNode=function(g){var d;var b=g.xpath;var c=g.amlNode;if(this.data&&b){d=this.data.selectSingleNode(b);}else{d=this.data||null;}if(d){delete this.$listeners[c.$uniqueId];c.load(d);}else{this.$waitForXml(c);}};this.$loadInAmlProp=function(k,c){var j,d,g=this.$propBinds[k],b=apf.all[k];if(!b){delete this.$propBinds[k];return;}if(b.$noInitModel){delete b.$noInitModel;return;}for(j in g){if(d=g[j].root?c.selectSingleNode(g[j].root):c){apf.xmldb.addNodeListener(c,b,"p|"+k+"|"+j+"|"+this.$uniqueId);delete this.$proplisteners[k];b.$execProperty(j,d);}else{this.$waitForXml(b,j);}}};this.$bindXmlProperty=function(j,b,m,r,n){var c,g,d=j.$uniqueId;if(!this.$propBinds[d]){this.$propBinds[d]={};}g=this.$propBinds[d][b]={bind:m};if(r){if((c=this.$amlNodes[d])&&c.xpath){m=(g.root=c.xpath)+"/"+m;}var k=m.split("/"),o=k.pop();if(o.indexOf("@")==0||o.indexOf("text()")>-1||o.indexOf("node()")>-1){g.listen=k.join("/");}else{g.listen=m;}}else{if((c=this.$amlNodes[d])&&c.xpath){g.listen=c.xpath;}}if(n){g.listen=".";}if(this.data){var s=j.$noInitModel?j.xmlRoot:(g.listen?this.data.selectSingleNode(g.listen):this.data);if(s){apf.xmldb.addNodeListener(s,j,"p|"+j.$uniqueId+"|"+b+"|"+this.$uniqueId);return g;}}this.$waitForXml(j,b);return g;};this.$unbindXmlProperty=function(c,j){var g=c.$uniqueId;var d=this.$propBinds[g]&&this.$propBinds[g][j];if(!d){return;}if(this.data){var b=d.listen?this.data.selectSingleNode(d.listen):this.data;if(b){apf.xmldb.removeNodeListener(b,c,"p|"+g+"|"+j+"|"+this.$uniqueId);}}delete this.$proplisteners[g+j];delete this.$propBinds[g][j];return d;};this.getXml=function(){return this.data?apf.xmldb.cleanNode(this.data.cloneNode(true)):false;};this.setQueryValue=function(b,d){if(!this.data){return false;}var c=apf.createNodeFromXpath(this.data,b);if(!c){return null;}apf.setNodeValue(c,d,true);return c;};this.queryValue=function(b){if(!this.data){return false;}return apf.queryValue(this.data,b);};this.queryValues=function(b){if(!this.data){return false;}return apf.queryValue(this.data,b);};this.queryNode=function(b){if(!this.data){return null;}return this.data.selectSingleNode(b);};this.queryNodes=function(b){if(!this.data){return null;}return this.data.selectNodes(b);};this.appendXml=function(d,b){var c=b?apf.createNodeFromXpath(this.data,b):this.data;if(!c){return null;}if(typeof d=="string"){d=apf.getXml(d);}else{d=!d.nodeType?d.getXml():apf.xmldb.getCleanCopy(d);}if(!d){return;}apf.xmldb.appendChild(c,d);};this.removeXml=function(b){if(typeof b=="string"){b=this.data.selectNodes(b);}else{if(!b.length){b=[b];}}if(b){apf.xmldb.removeNodeList(b);}};this.clear=function(){this.load(null);doc=null;};this.reset=function(){this.load(this.$copy);};this.savePoint=function(){this.$copy=apf.xmldb.getCleanCopy(this.data);};this.reloadAmlNode=function(d){if(!this.data){return;}var c=this.$amlNodes[d];var b=c.xpath?this.data.selectSingleNode(c.xpath):this.data;c.amlNode.load(b);};this.addEventListener("DOMNodeInsertedIntoDocument",function(d){var b=this.$aml;if(this.parentNode.hasFeature(apf.__DATABINDING__)){if(!this.name){this.setProperty("id","model"+this.parentNode.$uniqueId);}this.register(this.parentNode);}if(!this.src){var g,c=b;if(c.childNodes.length){if(apf.getNode(c,[0])){if((g=c.xml||c.serialize()).match(/^[\s\S]*?>([\s\S]*)<[\s\S]*?$/)){g=RegExp.$1;if(!apf.supportNamespaces){g=g.replace(/xmlns=\"[^"]*\"/g,"");}}return this.load(apf.getXmlDom(g).documentElement);}else{if(apf.isJson(c.childNodes[0].nodeValue)){return this.load(apf.getXmlDom(c.childNodes[0].nodeValue).documentElement);}}}if(this.submission){this.load("<data />");}}if(!apf.isFalse(this.autoinit)){this.init();}return this;});this.init=function(b){if(this.session){this.$loadFrom(this.session,{isSession:true});}else{if(this.src){this.$loadFrom(this.src,{callback:b});}}};this.$loadFrom=function(c,d){var j=c.split(":");if(!d){d={};}if(!d.isSession){this.src=c;this.$srcOptions=[c,d];}this.dispatchEvent("beforeretrieve");var n,g;for(n in this.$amlNodes){if(!(g=this.$amlNodes[n])||!g.amlNode){continue;}if(!g.amlNode.noloading){g.amlNode.clear("loading");}}this.$state=1;if(!this.$callCount){this.$callCount=1;}else{this.$callCount++;}var b=this,k=this.$callCount,m=d.callback;d.callback=function(r,q,o){if(k!=b.$callCount){return;}b.dispatchEvent("afterretrieve");if(q!=apf.SUCCESS){var s;s=new Error(apf.formatErrorString(1032,b,"Inserting xml data","Could not load data\nInstruction: "+c+"\nUrl: "+o.url+"\nInfo: "+o.message+"\n\n"+r));if(m&&m.apply(this,arguments)===true){return true;}if(o.tpModule&&o.tpModule.retryTimeout(o,q,b,s)===true){return true;}b.$state=0;throw s;}if(d&&d.isSession&&!r){if(this.src){return b.$loadFrom(this.src);}}else{if(d&&d.cancel){return;}b.load(r);b.dispatchEvent("receive",{data:r});if(m){m.apply(this,arguments);}}};return apf.getData(c,d);};this.reload=function(){if(!this.data){return;}if(this.$srcOptions){this.$loadFrom.apply(this,this.$srcOptions);}else{if(this.src){this.$loadFrom(this.src);}}};this.load=function(n,o){if(typeof n=="string"){if(n.charAt(0)=="<"){if(n.substr(0,5).toUpperCase()=="<!DOC"){n=n.substr(n.indexOf(">")+1);}if(!apf.supportNamespaces){n=n.replace(/xmlns\=\"[^"]*\"/g,"");}n=apf.getXmlDom(n,null,true).documentElement;}else{return this.$loadFrom(n,o);}}if(this.ownerDocument&&this.ownerDocument.$domParser.$shouldWait){var k=this;this.data=this.$copy=n;this.$queueLoading=true;apf.queue.add("modelload"+this.$uniqueId,function(){k.load(n,o);k.$queueLoading=false;});return;}else{if(this.$queueLoading){apf.queue.remove("modelload"+this.$uniqueId);}}this.$state=0;if(this.dispatchEvent("beforeload",{xmlNode:n})===false){return false;}var m=n?n.ownerDocument:null;if(n){if(!apf.supportNamespaces){var d=[],j=n.attributes;for(var g=0,c=j.length;g<c;g++){if(j[g].nodeName.substr(0,5)=="xmlns"){d.push(j[g].xml);}}if(d.length){m.setProperty("SelectionNamespaces",d.join(" "));}}apf.xmldb.addNodeListener(n,this);apf.xmldb.nodeConnect(apf.xmldb.getXmlDocId(n,this),n,null,this);if((!o||!o.nocopy)&&this["save-original"]){this.$copy=apf.xmldb.getCleanCopy(n);}}this.data=n;this.dispatchEvent("afterload",{xmlNode:n});for(var b in this.$amlNodes){this.$loadInAmlNode(this.$amlNodes[b]);}for(b in this.$propBinds){this.$loadInAmlProp(b,n);}return this;};this.$waitForXml=function(b,c){if(c){this.$proplisteners[b.$uniqueId+c]={id:b.$uniqueId,amlNode:b,prop:c};}else{this.$listeners[b.$uniqueId]=b;}};this.$xmlUpdate=function(k,d,j,g){var m,c;for(var n in this.$listeners){if(d=this.data.selectSingleNode(this.$amlNodes[n].xpath||".")){this.$listeners[n].load(d);delete this.$listeners[n];}}for(n in this.$proplisteners){m=this.$proplisteners[n];c=this.$propBinds[m.id][m.prop];if(d=c.listen?this.data.selectSingleNode(c.listen):this.data){apf.xmldb.addNodeListener(d,m.amlNode,"p|"+m.id+"|"+m.prop+"|"+this.$uniqueId);delete this.$proplisteners[n];m.amlNode.$execProperty(m.prop,c.root?this.data.selectSingleNode(c.root):this.data);}}this.dispatchEvent("update",{xmlNode:d,action:k});};this.$insertFrom=function(c,d){if(!c){return false;}this.dispatchEvent("beforeretrieve");var g=d.amlNode;var j=d.callback,b=this;d.callback=function(n,m,k){b.dispatchEvent("afterretrieve");if(!k){k={};}if(m!=apf.SUCCESS){var o;o=new Error(apf.formatErrorString(0,b,"Inserting xml data","Could not insert data\nInstruction:"+c+"\nUrl: "+k.url+"\nInfo: "+k.message+"\n\n"+n));if(k.tpModule.retryTimeout(k,m,d.amlNode||b,o)===true){return true;}if(j&&j.call(this,k.data,m,k)===false){return;}throw o;}if(typeof d.insertPoint=="string"){d.insertPoint=b.data.selectSingleNode(d.insertPoint);}if(typeof d.clearContents=="undefined"&&k.userdata){d.clearContents=apf.isTrue(k.userdata[1]);}(d.amlNode||b).insert(n,d);if(j){j.call(this,k.data,m,k);}};apf.getData(c,d);};this.insert=function(d,b){if(typeof d=="string"){if(d.charAt(0)=="<"){if(d.substr(0,5).toUpperCase()=="<!DOC"){d=d.substr(d.indexOf(">")+1);}if(!apf.supportNamespaces){d=d.replace(/xmlns\=\"[^"]*\"/g,"");}d=apf.getXmlDom(d).documentElement;}else{return this.$insertFrom(d,b);}}if(!b.insertPoint){b.insertPoint=this.data;}if(!b.insertPoint){throw new Error(apf.formatErrorString(0,amlNode||_self,"Inserting data","Could not determine insertion point for instruction: "+instruction));}if(typeof b.copyAttributes=="undefined"){b.copyAttributes=true;}var c=apf.mergeXml(d,b.insertPoint,b);apf.xmldb.applyChanges("insert",b.insertPoint);return d;};this.convertXml=function(b){if(!b){return this.data.xml;}return apf.convertXml(this.data,b);};this.submit=function(b,j,g,d){if(!b){b=this.submission;}if(!g){g=this.data;}if(!g){throw new Error(apf.formatErrorString(0,this,"Submitting model","Could not submit data, because no data was passed and the model does not have data loaded."));}if(!j){j="form";}if(this.dispatchEvent("beforesubmit",{instruction:b})===false){return false;}var c=this;function m(q,o,n){if((o==apf.TIMEOUT||(c.retryOnError&&o==apf.ERROR))&&n.retries<apf.maxHttpRetries){return n.tpModule.retry(n.id);}else{if(o!=apf.SUCCESS){c.dispatchEvent("submiterror",n);}else{c.dispatchEvent("submitsuccess",apf.extend({data:q},n));}}}var k;if(j.indexOf("xml")>-1){k=apf.getXmlString(g);}else{if(j.indexOf("form")>-1){k=apf.convertXml(apf.xmldb.getCleanCopy(g),"cgiobjects");}else{if(j.indexOf("json")>-1){k=apf.convertXml(g,"json");}}}apf.saveData(b,apf.extend({xmlNode:g,data:k,callback:m},d));this.dispatchEvent("aftersubmit");};this.$destroy=function(){if(this.session&&this.data){apf.saveData(this.session,{xmlNode:this.getXml()});}};}).call(apf.model.prototype=new apf.AmlElement());apf.aml.setElement("model",apf.model);apf.list=function(c,b){this.$init(b||"list",apf.NODE_VISIBLE,c);};apf.thumbnail=function(c,b){this.$init(b||"thumbnail",apf.NODE_VISIBLE,c);};apf.select=function(c,b){this.$init(b||"select",apf.NODE_VISIBLE,c);};apf.select1=function(c,b){this.$init(b||"selectl",apf.NODE_VISIBLE,c);};(function(){if(!apf.isIphone){this.implement(apf.Rename);}this.$getCaptionElement=function(){if(!(this.$caret||this.$selected)){return;}var d=this.$getLayoutNode("item","caption",this.$caret||this.$selected);if(!d){return;}return d.nodeType==1?d:d.parentNode;};this.$supportedProperties.push("appearance","mode","more","thumbsize");this.$propHandlers.thumbsize=function(j){var g=this.thumbclass;if(apf.isIE){g=g.splitSafe(",");for(var d=0;d<g.length;d++){apf.setStyleRule(g[d],"width",j+"px");apf.setStyleRule(g[d],"height",j+"px");}return;}apf.setStyleRule(g,"width",j+"px");apf.setStyleRule(g,"height",j+"px");};this.$propHandlers.appearance=function(d){};this.mode="normal";this.$propHandlers.mode=function(d){this.mode=d||"normal";if("check|radio".indexOf(this.mode)>-1){this.allowdeselect=false;this.addEventListener("afterrename",b);if(this.mode=="check"){this.autoselect=false;this.ctrlselect=true;}else{if(this.mode=="radio"){this.multiselect=false;}}}else{this.ctrlselect=false;this.removeEventListener("afterrename",b);}};function b(){}this.$propHandlers.more=function(d){if(d){this.delayedselect=false;this.addEventListener("xmlupdate",c);this.addEventListener("afterload",c);this.$setClearMessage=function(g){if(!this.moreItem){this.$fill();}this.$container.appendChild(this.moreItem);};this.$updateClearMessage=function(){};this.$removeClearMessage=function(){};}else{this.removeEventListener("xmlupdate",c);this.removeEventListener("afterload",c);}};function c(d){if((!d.action||"insert|add|synchronize|move".indexOf(d.action)>-1)&&this.moreItem){this.$container.appendChild(this.moreItem);}}this.addEventListener("keydown",this.$keyHandler,true);this.$draw=function(){this.appearance=this.getAttribute("appearance")||"compact";var g=this.getAttribute("mode");this.$ext=this.$getExternal();this.$container=this.$getLayoutNode("main","container",this.$ext);if(apf.hasCssUpdateScrollbarBug&&!this.mode){this.$fixScrollBug();}var d=this;this.$ext.onclick=function(j){d.dispatchEvent("click",{htmlEvent:j||event});};this.$ext.setAttribute("onmouseout",this.$ext.getAttribute("onmouseout")+";var o = apf.lookup("+this.$uniqueId+");o.$selectSeries(event);");this.listtype=parseInt(this.$getOption("main","type"))||1;this.behaviour=parseInt(this.$getOption("main","behaviour"))||1;this.thumbsize=this.$getOption("main","thumbsize");this.thumbclass=this.$getOption("main","thumbclass");};this.$selectSeries=function(g){g=g||event;var d=g.target||g.srcElement;if(g.type=="mouseover"){var d=(d.className||"").indexOf("item")!=-1?d:d.parentNode;this.highlight(d);}else{d=g.toElement?g.toElement:(g.relatedTarget?g.relatedTarget:null);if(!apf.isChildOf(this.$ext,d,true)){this.highlight(this.$selected);}}};this.highlight=function(m){var d=this.$ext.childNodes;var k=d.length;var j=false;for(var g=0;g<k;g++){if((d[g].className||"").indexOf("item")!=-1){if(!j){this.$setStyleClass(d[g],"selected");}else{this.$setStyleClass(d[g],"",["selected"]);}if(d[g]==m){j=true;}}}};this.$loadAml=function(d){};this.$destroy=function(){if(this.$ext){this.$ext.onclick=null;}apf.destroyHtmlNode(this.oDrag);this.oDrag=null;};}).call(apf.list.prototype=new apf.BaseList());apf.thumbnail.prototype=apf.select.prototype=apf.select1.prototype=apf.list.prototype;apf.aml.setElement("thumbnail",apf.thumbnail);apf.aml.setElement("select",apf.select);apf.aml.setElement("select1",apf.select1);apf.aml.setElement("list",apf.list);apf.errorbox=function(c,b){this.$init(b||"errorbox",apf.NODE_VISIBLE,c);};(function(){this.$positioning="basic";this.display=function(d){this.host=d;var c=d.$ext;document.body.appendChild(this.$ext);var b=(parseFloat(d.$getOption&&d.$getOption("main","erroffsetx")||0)),g=(parseFloat(d.$getOption&&d.$getOption("main","erroffsety")||0));this.show();apf.popup.show(this.$uniqueId,{x:b,y:g,animate:false,ref:c});this.$setStyleClass(this.$ext,b+this.$ext.offsetWidth>this.$ext.offsetParent.offsetWidth?"rightbox":"leftbox",["leftbox","rightbox"]);};this.setMessage=function(b){if(b&&b.indexOf(";")>-1){b=b.split(";");b="<strong>"+b.shift()+"</strong>"+b.join(";");}this.$int.innerHTML=b||"";};this.$draw=function(){this.$ext=this.$getExternal();this.$int=this.$getLayoutNode("main","container",this.$ext);this.oClose=this.$getLayoutNode("main","close",this.$ext);if(this.oClose){var b=this;this.oClose.onclick=function(){b.hide();if(apf.document.activeElement){apf.document.activeElement.focus(true,{mouse:true});}};}this.$ext.onmousedown=function(c){(c||event).cancelBubble=true;if(apf.hasFocusBug){apf.window.$focusfix();}};apf.popup.setContent(this.$uniqueId,this.$ext,"",null,null);};this.$loadAml=function(b){if(!apf.isTrue(this.getAttribute("visible"))){this.hide();}};this.$destroy=function(){if(this.oClose){this.oClose.onclick=null;}this.$ext.onmousedown=null;apf.popup.removeContent(this.$uniqueId);};}).call(apf.errorbox.prototype=new apf.Presentation());apf.aml.setElement("errorbox",apf.errorbox);apf.BindingQuicksandRule=function(c,b){this.$init(b,apf.NODE_HIDDEN,c);};(function(){function getFilteredNodes(pNode){pNode=pNode||this.$parent;var attr,tmp,res=[],dataIDs=[],xmlNodes=pNode.$getDataNode("quicksand",pNode.xmlRoot,false,null,true),domNodes=pNode.$ext.childNodes,i=0,l=xmlNodes.length;if(!domNodes.length||!l){return res;}for(;i<l;++i){dataIDs.push(xmlNodes[i].getAttribute("a_id"));}for(i=0,l=domNodes.length;i<l;++i){if(!domNodes[i]||!(attr=domNodes[i].getAttribute("id"))){continue;}tmp=attr.split("|");tmp.pop();if(dataIDs.indexOf(tmp.join("|"))>-1){res.push(domNodes[i]);}}return res;}function nodeInFilter(node,filtered){var i=0,l=filtered.length,s=node.getAttribute("id");for(;i<l;++i){if(filtered[i].getAttribute("id")==s){return filtered[i];}}return null;}function quicksand(parent,customOptions){parent=this.$parent.$ext;var i,l,dest,src,offset,_self=this,coll=getFilteredNodes.call(this),parentOffset=apf.getAbsolutePosition(parent),offsets=[],callbackFunction=typeof(arguments[1])=="function"?arguments[1]:typeof arguments[2]=="function"?arguments[2]:apf.K,postCallback=function(){_self.dispatchEvent("afterquicksand");callbackFunction.call(_self);},options={steps:60,anim:apf.tween.easeInOutQuad,onfinish:postCallback,adjustHeight:true};apf.extend(options,customOptions);if(apf.isIE&&apf.isIE<7){parent.innerHTML="";for(i=0,l=coll.length;i<l;i++){parent.appendChild(coll[i]);}return;}var $source=parent.childNodes;var correctionOffset=[0,0];parent.style.height=parent.offsetHeight+"px";apf.tween.clearQueue(parent,true);for(i=0,l=$source.length;i<l;++i){src=$source[i];offsets[i]=apf.getAbsolutePosition(src,parent,false);}for(i=0,l=$source.length;i<l;++i){src=$source[i];with(src.style){position="absolute";margin="0";top=(offsets[i][1]-parentOffset[1])+"px";left=(offsets[i][0]-parentOffset[0])+"px";}}var $dest=parent.cloneNode(false);$dest.setAttribute("id","");for(i=0,l=coll.length;i<l;++i){$dest.appendChild(coll[i].cloneNode(true));coll[i].$offset=apf.getAbsolutePosition(coll[i]);}parent.parentNode.insertBefore($dest,parent);with($dest.style){zIndex=1;opacity=0;margin=0;position="absolute";top=parentOffset[1]-correctionOffset[1]+"px";left=parentOffset[0]-correctionOffset[0]+"px";}if(false){apf.tween.single(parent,{steps:options.steps,anim:options.anim,type:"height",from:parent.offsetHeight,to:$dest.offsetHeight});}var insets=[];for(i=0,l=$source.length;i<l;++i){src=$source[i];if(dest=nodeInFilter(src,coll)){offset=insets.shift()||offsets[i];options.tweens=[{type:"top",from:dest.$offset[1]-parentOffset[1],to:offset[1]-parentOffset[1]},{type:"left",from:dest.$offset[0]-parentOffset[0],to:offset[0]-parentOffset[0]},{type:"opacity",from:apf.getStyle(src,"opacity"),to:1}];if(apf.supportCSSAnim){options.tweens.push({type:"transform",subType:"scale",from:0,to:1});}apf.tween.multi(src,options);}else{options.tweens=[{type:"opacity",from:apf.getStyle(src,"opacity"),to:0}];if(apf.supportCSSAnim){options.tweens.push({type:"transform",subType:"scale",from:1,to:0});}insets.push(offsets[i]);apf.tween.multi(src,options);}}for(i=0,l=coll.length;i<l;++i){var item=coll[i];if(!nodeInFilter(item,$source)){dest=nodeInFilter(item,coll);options.tweens=[{type:"opacity",from:0,to:1}];if(!apf.isIE){}offset=apf.getAbsolutePosition(dest);dest=dest.cloneNode(true);with(dest.style){position="absolute";margin="0";top=(offset[1]-parentOffset[1])+"px";left=(offset[0]-parentOffset[0])+"px";opacity="0";transform="scale(.0)";}parent.appendChild(dest);apf.tween.multi(dest,options);}}}this.addEventListener("DOMNodeInsertedIntoDocument",function(e){var pNode=this;while(pNode&&pNode.$bindingRule){pNode=pNode.parentNode;}this.$parent=pNode;if(!pNode){return;}var _self=this;setTimeout(function(){quicksand.call(_self);});});}).call(apf.BindingQuicksandRule.prototype=new apf.BindingRule());apf.aml.setElement("quicksand",apf.BindingQuicksandRule);apf.validation=function(c,b){this.$init(b||"validation",apf.NODE_HIDDEN,c);};(function(){this.$rules=[];var b={};this.register=function(c){if(c.tagName!="model"){return;}b[c.$uniqueId]=c;c.$validation=this;};this.unregister=function(){b[amlNode.$uniqueId]=null;delete b[amlNode.$uniqueId];amlNode.$validation=null;};this.getRule=function(g){var j=apf.xmldb.nodeConnect(apf.xmldb.getXmlDocId(g),g.nodeType==1?g:g.parentNode);for(var d=0,c=this.$rules.length;d<c;d++){if(g.ownerDocument.selectSingleNode("(.//"+this.$rules[d][0].split("|").join("|.//")+")[@"+apf.xmldb.xmlIdTag+"='"+j+"']")){return this.$rules[d][1];}}};this.validate=function(d,g,c){var j=this.getRule(d);if(!j){return c;}return(j.isValid||(j.isValid=apf.validator.compile(j)))(apf.queryValue(d),g,c);};this.addEventListener("DOMNodeInsertedIntoDocument",function(n){var r=this.$aml;var q,o,d,c=r.childNodes;for(var m=0,g=c.length;m<g;m++){if((d=c[m]).nodeType!=1){continue;}this.$rules.push([d.getAttribute("match"),(q={})]);o=d.attributes;for(var k=0;k<o.length;k++){q[o[k].nodeName]=o[k].nodeValue;}q.node=d;}this.register(this.parentNode);});}).call(apf.validation.prototype=new apf.AmlElement());apf.aml.setElement("validation",apf.validation);apf.splitter=function(c,b){this.$init(b||"splitter",apf.NODE_VISIBLE,c);apf.plane.init();};(function(){this.$focussable=true;this.update=function(){var D=(this.type=="vertical")?{fsize:"fwidth",size:"width",offsetPos:"offsetLeft",offsetSize:"offsetWidth",pos:"left"}:{fsize:"fheight",size:"height",offsetPos:"offsetTop",offsetSize:"offsetHeight",pos:"top"};this.$ext.offsetTop;this.$amlNode=this.refNode;var m=this.refHtml;var o=apf.layout.vars;var t=this.oItem;var C=false;var B=m?m[D.offsetPos]:o[D.pos+"_"+t.id];var k=m?m[D.offsetSize]:o[D.size+"_"+t.id];var g=t.parent.children;for(var n=0,w=0;w<g.length;w++){if(!g[w][D.fsize]){n++;}}if(!t[D.fsize]&&n>1){for(var d=0,c=0,w=t.stackId+1;w<g.length;w++){if(!g[w][D.fsize]){d+=g[w].weight||1;c+=(g[w].node?g[w].oHtml[D.offsetSize]:o[D.size+"_"+g[w].id]);}}var q=this.$ext[D.offsetPos]-B-k;var A=(c-q)/d;for(var w=0;w<t.stackId;w++){if(!g[w][D.fsize]){g[w].original.weight=(g[w].node?g[w].oHtml[D.offsetSize]:o[D.size+"_"+g[w].id])/A;}}t.original.weight=(k+q)/A;C=true;}else{var r=t[D.fsize]?t[D.fsize].match(/^\d+$/):false;var F=t[D.fsize]?t[D.fsize].match(/^([\d\.]+)\%$/):false;if(r||F||!t[D.fsize]){var q=this.$ext[D.offsetPos]-B-k;var u=this.$ext[D.offsetPos]-B;for(var G=0,s=0,w=t.stackId+1;w<g.length;w++){if(!g[w][D.fsize]){G+=g[w].weight||1;s+=(g[w].node?g[w].oHtml[D.offsetSize]:o[D.size+"_"+g[w].id]);}}if(G>0){var j=((s-q)/G)/(s/G);for(var w=t.stackId+1;w<g.length;w++){g[w].original.weight=j*(g[w].weight||1);}}else{for(var w=t.stackId+1;w<g.length;w++){if(g[w][D.fsize].match(/^\d+$/)){var E=(g[w].node?g[w].oHtml[D.offsetSize]:o[D.size+"_"+g[w].id])-q;g[w].original[D.fsize]=""+Math.max(0,E,g[w].minheight||0);if(g[w][D.fsize]-E!=0){q=g[w][D.fsize]-E;}else{break;}}else{if(g[w][D.fsize].match(/^([\d\.]+)\%$/)){var E=(g[w].node?g[w].oHtml[D.offsetSize]:o[D.size+"_"+g[w].id])-q;g[w].original[D.fsize]=Math.max(0,((parseFloat(RegExp.$1)/(g[w].node?g[w].oHtml[D.offsetSize]:o[D.size+"_"+g[w].id]))*E))+"%";break;}}}}if(t.original[D.fsize]){t.original[D.fsize]=F?((parseFloat(F[1])/k)*u)+"%":""+u;}C=true;}}if(C){apf.layout.compile(this.$ext.parentNode);apf.layout.activateRules(this.$ext.parentNode);if(apf.hasSingleRszEvent){apf.layout.forceResize();}return;}apf.layout.forceResize(this.$ext.parentNode);};this.init=function(t,o,u){this.min=0;this.max=1000000;this.size=parseInt(t)||3;this.refNode=null;this.refHtml=null;var c;if(o){if(typeof o!="object"){o=apf.lookup(o);}this.refNode=o;this.refHtml=this.refNode.$ext;c=this.refHtml.parentNode;u=o.aData.calcData;}else{c=u.pHtml;}this.oItem=u;if(c&&c!=this.$ext.parentNode){c.appendChild(this.$ext);}var s=apf.getDiff(this.$ext);this.$verdiff=s[0];this.$hordiff=s[1];this.$sizeArr=[];this.type=u.parent.vbox?"horizontal":"vertical";var C=apf.layout.get(this.$ext.parentNode).layout;var D="splitter"+this.$uniqueId;C.addRule("var "+D+" = apf.lookup("+this.$uniqueId+").$ext");var b=[D+".style.left = "];var j=[D+".style.top = "];var k=[D+".style.width = -"+this.$hordiff+" + "];var r=[D+".style.height = -"+this.$verdiff+" + "];var q=u.parent.children[u.stackId+1];if(this.type=="horizontal"){k.push("Math.max(");if(u.node){b.push(u.id+".offsetLeft");j.push(u.id+".offsetTop + "+u.id+".offsetHeight");k.push(u.id+".offsetWidth");}else{b.push("v.left_"+u.id);j.push("v.top_"+u.id+" + v.height_"+u.id);k.push("v.width_"+u.id);}k.push(",",q?(q.node?q.id+".offsetWidth":"v.width_"+q.id):0,")");C.addRule(k.join(""));this.$ext.style.height=(u.splitter-this.$hordiff)+"px";}else{r.push("Math.max(");if(u.node){b.push(u.id+".offsetLeft + "+u.id+".offsetWidth");j.push(u.id+".offsetTop");r.push(u.id+".offsetHeight");}else{b.push("v.left_"+u.id+" + v.width_"+u.id);j.push("v.top_"+u.id);r.push("v.height_"+u.id);}r.push(",",q?(q.node?q.id+".offsetHeight":"v.height_"+q.id):0,")");C.addRule(r.join(""));this.$ext.style.width=(u.splitter-this.$hordiff)+"px";}C.addRule(b.join(""));C.addRule(j.join(""));var m=u.parent.children;if(this.type=="vertical"){C.addRule(D+".host.min = "+(u.node?"document.getElementById('"+u.id+"').offsetLeft":"v.left_"+u.id)+" + "+parseInt(u.minwidth||u.childminwidth||10));var w=[],g=[];for(var n=false,A=u.stackId+1;A<m.length;A++){if(!m[A].fwidth){n=true;}}for(var B,A=u.stackId+1;A<m.length;A++){B=m[A];if(B.minwidth||B.childminheight){w.push(parseInt(B.minwidth||B.childminheight));}else{if(B.fwidth){if(!n&&A==u.stackId+1){w.push(10);}else{if(B.fwidth.indexOf("%")!=-1){w.push("("+B.parent.innerspace+") * "+(parseFloat(B.fwidth)/100));}else{w.push(B.fwidth);}}}else{w.push(10);}}w.push(B.edgeMargin);}C.addRule(D+".host.max = v.left_"+u.parent.id+" + v.width_"+u.parent.id+" - ("+(w.join("+")||0)+")");}else{C.addRule(D+".host.min = "+(u.node?"document.getElementById('"+u.id+"').offsetTop":"v.top_"+u.id)+" + "+parseInt(u.minheight||u.childminheight||10));var w=[],g=[];for(var n=false,A=u.stackId+1;A<m.length;A++){if(!m[A].fheight){n=true;}}if(!n&&q&&q.state>0){return this.$ext.parentNode.removeChild(this.$ext);}for(var B,A=u.stackId+1;A<m.length;A++){B=m[A];if(B.minheight||B.childminheight){w.push(parseInt(B.minheight||B.childminheight));}else{if(B.fheight){if(!n&&A==u.stackId+1){w.push(10);}else{if(B.fheight.indexOf("%")!=-1){w.push("("+B.parent.innerspace+") * "+(parseFloat(B.fheight)/100));}else{w.push(B.fheight);}}}else{w.push(10);}}if(B.edgeMargin){w.push(B.edgeMargin);}}C.addRule(D+".host.max = v.top_"+u.parent.id+" + v.height_"+u.parent.id+" - ("+(w.join("+")||0)+")");}this.$setStyleClass(this.$ext,this.type,[this.type=="horizontal"?"vertical":"horizontal"]);if(this.type=="vertical"){this.$setStyleClass(this.$ext,"w-resize",["n-resize"]);}else{this.$setStyleClass(this.$ext,"n-resize",["w-resize"]);}return this;};this.$draw=function(){this.$ext=this.$getExternal();var b=this;this.$ext.onmousedown=function(d){if(!d){d=event;}var c=b;var g=apf.getAbsolutePosition(this);if(c.type=="vertical"){c.tx=d.clientX-g[0];}else{c.ty=d.clientY-g[1];}c.startPos=c.type=="vertical"?this.offsetLeft:this.offsetTop;d.returnValue=false;d.cancelBubble=true;apf.plane.show(this);c.$setStyleClass(this,"moving");c.$setStyleClass(document.body,c.type=="vertical"?"w-resize":"n-resize",[c.type=="vertical"?"n-resize":"w-resize"]);document.onmouseup=function(){c.$setStyleClass(c.$ext,"",["moving"]);apf.plane.hide();c.update();c.$setStyleClass(document.body,"",["n-resize","w-resize"]);document.onmouseup=document.onmousemove=null;};document.onmousemove=function(j){if(!j){j=event;}if(c.type=="vertical"){if(j.clientX>=0){var k=apf.getAbsolutePosition(c.$ext.offsetParent);c.$ext.style.left=(Math.min(c.max,Math.max(c.min,(j.clientX-k[0])-c.tx)))+"px";}}else{if(j.clientY>=0){var k=apf.getAbsolutePosition(c.$ext.offsetParent);c.$ext.style.top=(Math.min(c.max,Math.max(c.min,(j.clientY-k[1])-c.ty)))+"px";}}j.returnValue=false;j.cancelBubble=true;};};};this.$loadAml=function(c){if(this.left||this.top){var j=this.left||this.top;var g=this.right||this.bottom;j=j.split(/\s*,\s*/);g=g.split(/\s*,\s*/);for(var d=0;d<j.length;d++){j[d]=j[d];}for(var d=0;d<g.length;d++){g[d]=g[d];}var b=this;$setTimeout(function(){this.$amlNode.init(b.type,b.size,b.min,b.max,b.change,j,g);});}};}).call(apf.splitter.prototype=new apf.Presentation());apf.aml.setElement("splitter",apf.splitter);apf.comment=function(){this.$init("comment",apf.NODE_HIDDEN);};apf.comment.prototype=new apf.AmlComment();apf.aml.setElement("comment",apf.comment);apf.dropdown=function(c,b){this.$init(b||"dropdown",apf.NODE_VISIBLE,c);};(function(){this.$animType=1;this.$animSteps=5;this.$animSpeed=20;this.$itemSelectEvent="onmouseup";this.dragdrop=false;this.reselectable=true;this.$focussable=true;this.autoselect=false;this.multiselect=false;this.disableremove=true;this.delayedselect=false;this.maxitems=5;this.$booleanProperties.disableremove=true;this.$supportedProperties.push("maxitems","disableremove","initial-message","fill");this.$propHandlers.maxitems=function(c){this.sliderHeight=c?(Math.min(this.maxitems||100,c)*this.itemHeight):10;this.containerHeight=c?(Math.min(this.maxitems||100,c)*this.itemHeight):10;};this.slideToggle=function(c,d){if(!c){c=event;}if(d&&this.disabled){return;}if(this.isOpen){this.slideUp();}else{this.slideDown(c);}};this.slideDown=function(d){if(this.dispatchEvent("slidedown")===false){return false;}this.isOpen=true;this.$propHandlers.maxitems.call(this,this.xmlRoot&&this.each?this.getTraverseNodes().length:this.childNodes.length);this.oSlider.style.display="block";if(!this.ignoreOverflow){this.oSlider.style[apf.supportOverflowComponent?"overflowY":"overflow"]="visible";this.$container.style.overflowY="hidden";}this.oSlider.style.display="";this.$setStyleClass(this.$ext,this.$baseCSSname+"Down");this.oSlider.style.height=(this.sliderHeight-1)+"px";this.oSlider.style.width=(this.$ext.offsetWidth-2-this.widthdiff)+"px";var c=this;apf.popup.show(this.$uniqueId,{x:0,y:this.$ext.offsetHeight,animate:true,ref:this.$ext,width:this.$ext.offsetWidth-this.widthdiff,height:this.containerHeight,callback:function(g){if(!c.ignoreOverflow){c.$container.style.overflowY="auto";}}});};this.slideUp=function(){if(this.isOpen==2){return false;}if(this.dispatchEvent("slideup")===false){return false;}this.isOpen=false;if(this.selected){var c=apf.xmldb.findHtmlNode(this.selected,this);if(c){this.$setStyleClass(c,"",["hover"]);}}this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Down"]);apf.popup.hide();return false;};this.$setLabel=function(c){this.oLabel.innerHTML=c||this["initial-message"]||"";this.$setStyleClass(this.$ext,c?"":this.$baseCSSname+"Initial",!c?[]:[this.$baseCSSname+"Initial"]);};this.addEventListener("afterselect",function(c){if(!c){c=event;}this.slideUp();if(!this.isOpen){this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Over"]);}this.$setLabel(c.selection.length?this.$applyBindRule("caption",this.selected):"");});function b(){if(this.isOpen==2){this.slideDown();}}this.addEventListener("afterload",b);this.addEventListener("xmlupdate",function(){b.call(this);this.$setLabel(this.$applyBindRule("caption",this.selected));});this.$blur=function(){this.slideUp();if(!this.isOpen){this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Over"]);}this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Focus"]);};this.$setClearMessage=function(c){this.$setLabel(c);};this.$removeClearMessage=function(){this.$setLabel("");};this.addEventListener("popuphide",this.slideUp);this.addEventListener("keydown",function(m){var j=m.keyCode;if(!this.xmlRoot){return;}var k;switch(j){case 38:if(m.altKey){this.slideToggle(m.htmlEvent);return;}if(!this.selected){return;}k=this.getNextTraverseSelected(this.caret||this.selected,false);if(k){this.select(k);}break;case 40:if(m.altKey){this.slideToggle(m.htmlEvent);return;}if(!this.selected){k=this.getFirstTraverseNode();if(!k){return;}}else{k=this.getNextTraverseSelected(this.selected,true);}if(k){this.select(k);}break;default:if(j==9||!this.xmlRoot){return;}if(!this.lookup||new Date().getTime()-this.lookup.date.getTime()>1000){this.lookup={str:"",date:new Date()};}this.lookup.str+=String.fromCharCode(j);var d,c=this.getTraverseNodes();for(var g=0;g<c.length;g++){d=this.$applyBindRule("caption",c[g]);if(d&&d.indexOf(this.lookup.str)>-1){this.select(c[g]);return;}}return;}return false;},true);this.$draw=function(){this.$getNewContext("main");this.$getNewContext("container");this.$animType=this.$getOption("main","animtype")||1;this.clickOpen=this.$getOption("main","clickopen")||"button";this.$ext=this.$getExternal(null,null,function(d){d.setAttribute("onmouseover","var o = apf.lookup("+this.$uniqueId+');o.$setStyleClass(o.$ext, o.$baseCSSname + "Over", null, true);');d.setAttribute("onmouseout","var o = apf.lookup("+this.$uniqueId+');if(o.isOpen) return;o.$setStyleClass(o.$ext, "", [o.$baseCSSname + "Over"], true);');var c=this.$getLayoutNode("main","button",d);if(c){c.setAttribute("onmousedown","apf.lookup("+this.$uniqueId+").slideToggle(event, true);");}var g=this.$getLayoutNode("main","label",d);if(this.clickOpen=="both"){g.parentNode.setAttribute("onmousedown","apf.lookup("+this.$uniqueId+").slideToggle(event, true);");}});this.oLabel=this.$getLayoutNode("main","label",this.$ext);if(this.oLabel.nodeType==3){this.oLabel=this.oLabel.parentNode;}this.oIcon=this.$getLayoutNode("main","icon",this.$ext);if(this.$button){this.$button=this.$getLayoutNode("main","button",this.$ext);}this.oSlider=apf.insertHtmlNode(this.$getLayoutNode("container"),document.body);this.$container=this.$getLayoutNode("container","contents",this.oSlider);this.$container.host=this;this.$pHtmlDoc=apf.popup.setContent(this.$uniqueId,this.oSlider,apf.skins.getCssString(this.skinName));this.listtype=parseInt(this.$getLayoutNode("main","type"))||1;this.itemHeight=this.$getOption("main","item-height")||18.5;this.widthdiff=this.$getOption("main","width-diff")||0;this.ignoreOverflow=apf.isTrue(this.$getOption("main","ignore-overflow"))||false;};this.addEventListener("DOMNodeInsertedIntoDocument",function(){if(typeof this["initial-message"]=="undefined"){this.$setInheritedAttribute("initial-message");}if(!this.selected&&this["initial-message"]){this.$setLabel();}});this.$destroy=function(){apf.popup.removeContent(this.$uniqueId);apf.destroyHtmlNode(this.oSlider);this.oSlider=null;};}).call(apf.dropdown.prototype=new apf.BaseList());apf.config.$inheritProperties["initial-message"]=1;apf.aml.setElement("dropdown",apf.dropdown);apf.contextmenu=function(){this.$init("contextmenu",apf.NODE_HIDDEN);};(function(){this.$amlNodes=[];this.$attrExcludePropBind=apf.extend({match:1},this.$attrExcludePropBind);this.register=function(b){if(!b.contextmenus){b.contextmenus=[];}b.contextmenus.push(this);};this.unregister=function(b){b.contextmenus.remove(this);};this.addEventListener("DOMNodeInsertedIntoDocument",function(b){this.register(this.parentNode);});}).call(apf.contextmenu.prototype=new apf.AmlElement());apf.aml.setElement("contextmenu",apf.contextmenu);apf.menu=function(c,b){this.$init(b||"menu",apf.NODE_VISIBLE,c);};(function(){this.$focussable=apf.KEYBOARD;this.$positioning="basic";this.anim=true;this.zindex=10000000;this.visible=false;this.$booleanProperties.anim=true;this.$propHandlers.visible=function(m,o,k,j,d){if(m){this.$ext.style.display="block";if(this.opener&&this.opener.localName.indexOf("item")>-1){this.opener.parentNode.$showingSubMenu=this;}}else{this.$ext.style.display="none";var n=apf.menu.lastFocus;if(n!=this.opener&&this.opener&&this.opener.$blur){this.opener.$blur();}if(this.opener&&this.opener.parentNode.localName=="menu"){if(!this.$hideTree){this.$hideTree=-1;}this.opener.parentNode.focus();}else{if(n){if(apf.window.$settingFocus){if(apf.window.$settingFocus!=n&&n.$blur){n.$blur();}this.$blur();if(apf.window.$settingFocus.localName!="menu"){apf.menu.lastFocus=null;}}else{if(!apf.window.hasFocus()){if(n.$blur){n.$blur();}this.$blur();apf.document.activeElement=n;if(n.$focusParent){n.$focusParent.$lastFocussed=n;}apf.menu.lastFocus=null;}else{if(this.$hideTree){if(!this.$hideTree){this.$hideTree=-1;}var g=(n.disabled||!n.visible)&&n!=apf.document.documentElement;if(j||g){if(n.$blur){n.$blur();}this.$blur();apf.document.activeElement=null;if(g&&apf.window.moveNext()===false){apf.window.$focusRoot();}}else{n.focus(null,null,true);}apf.menu.lastFocus=null;}}}}}if(this.$showingSubMenu){this.$showingSubMenu.hide();this.$showingSubMenu=null;}if(this.opener&&this.opener.$submenu){this.opener.$submenu(true,true);if(this.$hideTree===true&&this.opener.parentNode.localName=="menu"){this.opener.parentNode.$hideTree=true;this.opener.parentNode.hide();}this.opener=null;}this.$hideTree=null;if(this.$selected){apf.setStyleClass(this.$selected.$ext,"",["hover"]);this.$selected=null;}}};var c;this.display=function(s,q,m,r,A,n,u){this.opener=r;this.dispatchEvent("display");if(A){var w,k,g,d=this.childNodes,o=0,j=d.length,C;for(k=0;k<j;k++){g=d[k];if(g.nodeType!=1){continue;}C=!A||!g.match||(g.cmatch||(g.cmatch=apf.lm.compile(g.match,{xpathmode:3,injectself:true})))(A);if(C){g.show();if(g.localName=="divider"){w=g;if(o==0){g.hide();}o=0;}else{o++;}}else{g.hide();if(!g.nextSibling&&o==0){w.hide();}}}}if(this.oOverlay){if(u){this.oOverlay.style.display="block";this.oOverlay.style.width=u+"px";}else{this.oOverlay.style.display="none";}}this.visible=false;this.show();if(s===null){apf.popup.show(this.$uniqueId,{x:0,y:r.$ext.offsetHeight,animate:m||!this.anim?false:"fade",ref:r.$ext,allowTogether:n});}else{var t=apf.getAbsolutePosition(document.body);apf.popup.show(this.$uniqueId,{x:s-t[0],y:q-t[1]-(apf.isIE&&apf.isIE<8?1:0),animate:m||!this.anim?false:"fade",ref:this.$ext.offsetParent,allowTogether:n,autoCorrect:false});}var B=apf.menu.lastFocus=r&&r.$focussable===true?r:apf.menu.lastFocus||apf.document.activeElement;apf.popup.last=null;this.focus();if(B&&B!=this&&B.$focus){B.$focus();}this.xmlReference=A;};this.getValue=function(d){return this.getSelected(d).value||"";};this.getSelected=function(k){var g=this.childNodes;var j,d=g.length;for(j=0;j<d;j++){if(g[j].group!=k){continue;}if(g[j].selected){return g[j];}}return false;};this.select=function(m,k){var g=this.childNodes;var j,d=g.length;for(j=0;j<d;j++){if(g[j].group!=m){continue;}if(g[j].value==k||!g[j].value&&g[j].caption==k){g[j].$handlePropSet("selected",true);}else{if(g[j].selected){g[j].$handlePropSet("selected",false);}}}};this.addEventListener("keydown",function(k){var j,d=k.keyCode;switch(d){case 13:if(!this.$selected){return;}j=this.$selected;j.$down();j.$up();j.$click();break;case 38:j=this.$selected&&this.$selected.previousSibling||this.lastChild;if(j&&j.localName=="divider"){j=j.previousSibling;}if(!j){return;}if(this.$selected){apf.setStyleClass(this.$selected.$ext,"",["hover"]);}apf.setStyleClass(j.$ext,"hover");this.$selected=j;break;case 40:j=this.$selected&&this.$selected.nextSibling||this.firstChild;if(j&&j.localName=="divider"){j=j.nextSibling;}if(!j){return;}if(this.$selected){apf.setStyleClass(this.$selected.$ext,"",["hover"]);}apf.setStyleClass(j.$ext,"hover");this.$selected=j;break;case 37:if(!this.opener){return;}if(this.opener.localName=="button"){j=this.opener.previousSibling;while(j&&!j.submenu){j=j.previousSibling;}if(j){j.dispatchEvent("mouseover");var g=j.parentNode.menuIsPressed;if(g){self[g.submenu].dispatchEvent("keydown",{keyCode:40});}}}else{if(this.opener.parentNode.localName=="menu"){var m=this.opener;this.hide();apf.setStyleClass(m.$ext,"hover");m.parentNode.$showingSubMenu=null;}}break;case 39:if(this.$selected&&this.$selected.submenu){this.$selected.$submenu(null,true);this.$showingSubMenu.dispatchEvent("keydown",{keyCode:40});return;}if(this.opener){var m=this.opener;while(m&&m.parentNode&&m.parentNode.localName=="menu"){m=m.parentNode.opener;}if(m&&m.localName=="button"){j=m.nextSibling;while(j&&!j.submenu){j=j.nextSibling;}if(j){j.dispatchEvent("mouseover");var g=j.parentNode.menuIsPressed;if(g){self[g.submenu].dispatchEvent("keydown",{keyCode:40});}return;}}}if(!this.$selected){arguments.callee.call(this,{keyCode:40});}break;default:return;}return false;},true);function b(){if(this.$showingSubMenu){return;}if(this.$hideTree!=-1){this.$hideTree=true;this.hide();}return false;}this.addEventListener("focus",function(){apf.popup.last=this.$uniqueId;});this.addEventListener("blur",b);this.addEventListener("popuphide",b);this.$draw=function(){this.$pHtmlNode=document.body;this.$ext=this.$getExternal();this.oOverlay=this.$getLayoutNode("main","overlay",this.$ext);apf.popup.setContent(this.$uniqueId,this.$ext,"",null,null);};this.$loadAml=function(d){this.$int=this.$getLayoutNode("main","container",this.$ext);};this.$destroy=function(){apf.popup.removeContent(this.$uniqueId);};}).call(apf.menu.prototype=new apf.Presentation());apf.aml.setElement("menu",apf.menu);apf.input=function(c,b){this.$init(b||"input",apf.NODE_VISIBLE,c);};apf.secret=function(c,b){this.$init(b||"secret",apf.NODE_VISIBLE,c);};apf.password=function(c,b){this.$init(b||"password",apf.NODE_VISIBLE,c);};apf.textarea=function(c,b){this.$init(b||"textarea",apf.NODE_VISIBLE,c);this.multiline=true;};apf.email=function(c,b){this.$init(b||"email",apf.NODE_VISIBLE,c);};apf.textbox=function(c,b){this.$init(b||"textbox",apf.NODE_VISIBLE,c);};(function(){this.implement(apf.DataAction);this.$focussable=true;this.$masking=false;this.$childProperty="value";this.value="";this.isContentEditable=true;this.multiline=false;this.$booleanProperties.focusselect=true;this.$booleanProperties.realtime=true;this.$supportedProperties.push("value","mask","initial-message","focusselect","realtime","type");this.$propHandlers.value=function(d,g,c){if(!this.$input||!c&&this.getValue()==d){return;}if(!c&&!d){this.clear();}else{if(this.isHTMLBox){if(this.$input.innerHTML!=d){this.$input.innerHTML=d;}}else{if(this.$input.value!=d){this.$input.value=d;}}}if(this.$button){this.$button.style.display=d&&!c?"block":"none";}};this.addEventListener("prop.maxlength",function(c){if(this.$input.tagName.toLowerCase().match(/input|textarea/)){this.$input.maxLength=parseInt(c.value)||null;}});this.$propHandlers.mask=function(c){if(this.mask.toLowerCase()=="password"){return;}if(!c){throw new Error("Not Implemented");}if(!this.$masking){this.$masking=true;this.implement(apf.textbox.masking);this.focusselect=false;}this.setMask(this.mask);};this.$propHandlers["initial-message"]=function(c){if(c){if(apf.hasFocusBug){this.$input.onblur();}}if(!this.value){this.clear();}};this.$propHandlers.focusselect=function(d){var c=this;this.$input.onmousedown=function(){c.focusselect=false;};this.$input.onmouseup=this.$input.onmouseout=function(){c.focusselect=d;};};this.$propHandlers.type=function(c){if(c&&"password|username".indexOf(c)>-1&&typeof this.focusselect=="undefined"){this.focusselect=true;this.$propHandlers.focusselect.call(this,true);}};this.setValue=function(c){return this.setProperty("value",c,false,true);};this.clear=function(){if(this["initial-message"]){this.$propHandlers.value.call(this,this["initial-message"],null,true);apf.setStyleClass(this.$ext,this.$baseCSSname+"Initial");}else{this.$propHandlers.value.call(this,"",null,true);}this.dispatchEvent("clear");};this.getValue=function(){var c=this.isHTMLBox?this.$input.innerHTML:this.$input.value;return c==this["initial-message"]?"":c.replace(/\r/g,"");};this.select=function(){try{this.$input.select();}catch(c){}};this.deselect=function(){this.$input.deselect();};this.$enable=function(){this.$input.disabled=false;};this.$disable=function(){this.$input.disabled=true;};this.$insertData=function(c){return this.setValue(c);};this.insert=function(g){if(apf.hasMsRangeObject){try{this.$input.focus();}catch(d){}var c=document.selection.createRange();if(this.oninsert){g=this.oninsert(g);}c.pasteHTML(g);c.collapse(true);c.select();}else{this.$input.value+=g;}};this.addEventListener("$clear",function(){this.value="";if(this["initial-message"]&&apf.document.activeElement!=this){this.$propHandlers.value.call(this,this["initial-message"],null,true);apf.setStyleClass(this.$ext,this.$baseCSSname+"Initial");}else{this.$propHandlers.value.call(this,"");}if(!this.$input.tagName.toLowerCase().match(/input|textarea/i)){if(apf.hasMsRangeObject){try{var c=document.selection.createRange();c.moveStart("sentence",-1);c.select();}catch(d){}}}this.dispatchEvent("clear");});this.$keyHandler=function(d,k,c,g,j){if(this.$button&&d==27){this.clear();this.blur();}};var b;this.$focus=function(g){if(!this.$ext||this.$ext.disabled){return;}this.$setStyleClass(this.$ext,this.$baseCSSname+"Focus");if(this["initial-message"]&&this.$input.value==this["initial-message"]){this.$propHandlers.value.call(this,"",null,true);apf.setStyleClass(this.$ext,"",[this.$baseCSSname+"Initial"]);}var c=this;function d(){try{if(!b||document.activeElement!=c.$input){c.$input.focus();}else{clearInterval(b);return;}}catch(j){}if(c.$masking){c.setPosition();}if(c.focusselect){c.select();}}if((!g||g.mouse)&&apf.isIE){clearInterval(b);b=setInterval(d,1);}else{d();}};this.$blur=function(c){if(!this.$ext){return;}if(!this.realtime){this.change(this.getValue());}this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Focus"]);if(this["initial-message"]&&this.$input.value==""){this.$propHandlers.value.call(this,this["initial-message"],null,true);apf.setStyleClass(this.$ext,this.$baseCSSname+"Initial");}try{if(apf.isIE||!c||c.srcElement!=apf.window){this.$input.blur();}}catch(c){}if(this.oContainer){$setTimeout("var o = apf.lookup("+this.$uniqueId+");                o.oContainer.style.display = 'none'",100);}clearInterval(b);};this.$draw=function(){var c=this;this.$ext=this.$getExternal(null,null,function(j){var g=this.getAttribute("mask");if((typeof g=="string"&&g.toLowerCase()=="password")||"secret|password".indexOf(this.localName)>-1){this.type=="password";this.$getLayoutNode("main","input").setAttribute("type","password");}j.setAttribute("onmousedown","if (!this.host.disabled)                 this.host.dispatchEvent('mousedown', {htmlEvent : event});");j.setAttribute("onmouseup","if (!this.host.disabled)                 this.host.dispatchEvent('mouseup', {htmlEvent : event});");j.setAttribute("onclick","if (!this.host.disabled)                 this.host.dispatchEvent('click', {htmlEvent : event});");});this.$input=this.$getLayoutNode("main","input",this.$ext);this.$button=this.$getLayoutNode("main","button",this.$ext);if(this.type=="password"){this.$propHandlers.type.call(this,"password");}if(!apf.hasContentEditable&&"input|textarea".indexOf(this.$input.tagName.toLowerCase())==-1){var d=this.$input;this.$input=d.parentNode.insertBefore(document.createElement("textarea"),d);d.parentNode.removeChild(d);this.$input.className=d.className;if(this.$ext==d){this.$ext=this.$input;}}if(this.$button){this.$button.onmousedown=function(){c.clear();c.focus({mouse:true});};}if(this.$input.tagName.toLowerCase()=="textarea"){this.addEventListener("focus",function(g){});}this.$input.onselectstart=function(g){if(!g){g=event;}g.cancelBubble=true;};this.$input.host=this;this.$input.onkeydown=function(m){m=m||window.event;if(this.host.disabled){m.returnValue=false;return false;}if(!c.realtime){var j=c.getValue();if(m.keyCode==13&&j!=this.value){c.change(j);}}else{if(apf.isWebkit&&c.xmlRoot&&c.getValue()!=this.value){$setTimeout("var o = apf.lookup("+c.$uniqueId+");                    o.change(o.getValue())");}}if(c.multiline=="optional"&&m.keyCode==13&&!m.shiftKey||m.ctrlKey&&(m.keyCode==66||m.keyCode==73||m.keyCode==85)){m.returnValue=false;return false;}if(c.oContainer){var g=c;var k=m.keyCode;$setTimeout(function(){g.fillAutocomplete(k);});}if(!c.mask){return c.$keyHandler(m.keyCode,m.ctrlKey,m.shiftKey,m.altKey,m);}};this.$input.onkeyup=function(j){if(!j){j=event;}if(this.host.disabled){return false;}var g=j.keyCode;if(c.$button){c.$button.style.display=this.value?"block":"none";}if(c.realtime){$setTimeout(function(){var k;if(!c.mask&&(k=c.getValue())!=c.value){c.change(k);}c.dispatchEvent("keyup",{keyCode:g});});}else{c.dispatchEvent("keyup",{keyCode:g});}if(c.isValid&&c.isValid()&&j.keyCode!=13&&j.keyCode!=17){c.clearError();}};if(apf.hasFocusBug){apf.sanitizeTextbox(this.$input);}if(apf.hasAutocompleteXulBug){this.$input.setAttribute("autocomplete","off");}if(!this.$input.tagName.toLowerCase().match(/input|textarea/)){this.isHTMLBox=true;this.$input.unselectable="Off";this.$input.contentEditable=true;this.$input.style.width="1px";this.$input.select=function(){var g=document.selection.createRange();g.moveToElementText(this);g.select();};}this.$input.deselect=function(){if(!document.selection){return;}var g=document.selection.createRange();g.collapse();g.select();};};this.$loadAml=function(){if(typeof this["initial-message"]=="undefined"){this.$setInheritedAttribute("initial-message");}if(typeof this.realtime=="undefined"){this.$setInheritedAttribute("realtime");}};this.addEventListener("DOMNodeRemovedFromDocument",function(){if(this.$button){this.$button.onmousedown=null;}if(this.$input){this.$input.onkeypress=this.$input.onmouseup=this.$input.onmouseout=this.$input.onmousedown=this.$input.onkeydown=this.$input.onkeyup=this.$input.onselectstart=null;}});}).call(apf.textbox.prototype=new apf.StandardBinding());apf.config.$inheritProperties["initial-message"]=1;apf.config.$inheritProperties.realtime=1;apf.input.prototype=apf.secret.prototype=apf.password.prototype=apf.textarea.prototype=apf.email.prototype=apf.textbox.prototype;apf.aml.setElement("input",apf.input);apf.aml.setElement("secret",apf.secret);apf.aml.setElement("password",apf.password);apf.aml.setElement("textarea",apf.textarea);apf.aml.setElement("textbox",apf.textbox);apf.script=function(){this.$init("script",apf.NODE_HIDDEN);};(function(){this.$propHandlers.src=function(b){if(apf.isOpera){$setTimeout(function(){apf.window.loadCodeFile(apf.hostPath+b);},1000);}else{apf.window.loadCodeFile(apf.getAbsolutePath(apf.hostPath,b));}};this.addEventListener("DOMNodeInserted",function(d){if(d.currentTarget.nodeType==3||d.currentTarget.nodeType==4){var c=d.currentTarget.nodeValue;if(!this.type||this.type=="text/javascript"){apf.jsexec(c);}else{if(this.type=="application/livemarkup"||this.type=="application/lm"){var b=apf.lm.compile(c,{event:true,parsecode:true,funcglobal:true});b(window.event);}}}});this.addEventListener("DOMNodeInsertedIntoDocument",function(m){var c=this.childNodes,g=[];for(var d=0,b=c.length;d<b;d++){g[g.length]=c[d].nodeValue;}var k=g.join("\n");if(!this.type||this.type=="text/javascript"){apf.jsexec(k);}else{if(this.type=="application/livemarkup"||this.type=="application/lm"){var j=apf.lm.compile(k,{event:true,parsecode:true,funcglobal:true});j(window.event);}}});}).call(apf.script.prototype=new apf.AmlElement());apf.aml.setElement("script",apf.script);apf.tree=function(c,b){this.$init(b||"tree",apf.NODE_VISIBLE,c);};(function(){var b=1<<1,d=1<<2,j=1<<3,k=1<<4,c=this.$treeState;this.$mode=0;this.$propHandlers.mode=function(m){if("check|radio".indexOf(m)>-1){this.implement(apf.MultiCheck);this.addEventListener("afterrename",g);this.multicheck=m=="check";this.$mode=this.multicheck?1:2;}else{this.removeEventListener("afterrename",g);this.$mode=0;}};function g(){}this.$initNode=function(F,n,B){this.$getNewContext("item");var t=n&b||this.emptyMessage&&this.$applyBindRule("empty",F),A=this.$getLayoutNode("item");A.setAttribute("onmouseover","var o = apf.lookup("+this.$uniqueId+");            o.$setStyleClass(this, 'hover', null, true);");A.setAttribute("onmouseout","var o = apf.lookup("+this.$uniqueId+");            o.$setStyleClass(this, '', ['hover'], true);");this.$setStyleClass(this.$getLayoutNode("item","class"),c[n]).setAttribute(apf.xmldb.htmlIdTag,B);this.$setStyleClass(this.$getLayoutNode("item","container"),c[n]);var s=this.$getLayoutNode("item","openclose");if(s){s.setAttribute("children",t);s.setAttribute("onmousedown","if (this.getAttribute('children') == false) return;                var o = apf.lookup("+this.$uniqueId+");                o.slideToggle(this, null, null, true);                apf.cancelBubble(event, o);");s.setAttribute("ondblclick","event.cancelBubble = true");}var o=this.opencloseaction||"ondblclick";var C=this.$getLayoutNode("item","icon");if(C&&C!=s){if(o!="ondblclick"){C.setAttribute(o,"var o = apf.lookup("+this.$uniqueId+");"+(o=="onmousedown"?"o.select(this, event.ctrlKey, event.shiftKey, -1);":"")+(true?"o.slideToggle(this, null, null, true);":""));}if(o!="onmousedown"){C.setAttribute("onmousedown","apf.lookup("+this.$uniqueId+").select(this, event.ctrlKey, event.shiftKey, -1);");}C.setAttribute("ondblclick","var o = apf.lookup("+this.$uniqueId+");              o.choose();o.stopRename();"+(true&&!o=="ondblclick"?"o.slideToggle(this, null, null, true);":"")+"apf.cancelBubble(event,o);");}var r=this.$getLayoutNode("item","select"),E;if(this.hasFeature(apf.__RENAME__)||this.hasFeature(apf.__DRAGDROP__)){E="var o = apf.lookup("+this.$uniqueId+");                 var xmlNode = apf.xmldb.findXmlNode(this);                 var isSelected = o.isSelected(xmlNode);                 this.hasPassedDown = true;                 if (!o.renaming && o.hasFocus() && isSelected == 1)                     this.dorename = true;                 if (!o.hasFeature(apf.__DRAGDROP__) || !isSelected && !event.ctrlKey)                     o.select(this, event.ctrlKey, event.shiftKey, -1);                 apf.cancelBubble(event, o);";r.setAttribute("onmouseout","this.hasPassedDown = false;"+(r.getAttribute("onmouseout")||""));r.setAttribute("onmouseup","if (!this.hasPassedDown) return;                var o = apf.lookup("+this.$uniqueId+");if (this.dorename && !o.mode)                    o.startDelayedRename(event, null, true);this.dorename = false;                 var xmlNode = apf.xmldb.findXmlNode(this);                 var isSelected = o.isSelected(xmlNode);                 if (o.hasFeature(apf.__DRAGDROP__))                     o.select(this, event.ctrlKey, event.shiftKey, -1);");}else{E="o.select(this, event.ctrlKey, event.shiftKey, -1);                            apf.cancelBubble(event, o);";}if(o!="ondblclick"){r.setAttribute(o,"var o = apf.lookup("+this.$uniqueId+");"+(o=="onmousedown"?E:"")+(true?"o.slideToggle(this, null, null, true);":""));}if(o!="onmousedown"){r.setAttribute("onmousedown","var o = apf.lookup("+this.$uniqueId+");"+E);}r.setAttribute("ondblclick","var o = apf.lookup("+this.$uniqueId+");          o.choose();o.stopRename();this.dorename=false;"+(o=="ondblclick"?"o.slideToggle(this, null, null, true);":"")+"apf.cancelBubble(event,o);");if(C){var w=this.$applyBindRule("icon",F);if(w){if(C.tagName.match(/^img$/i)){C.setAttribute("src",apf.getAbsolutePath(this.iconPath,w));}else{C.setAttribute("style","background-image:url("+apf.getAbsolutePath(this.iconPath,w)+")");}}}var D=this.$getLayoutNode("item","caption");if(D){if(D.nodeType==1&&this.$cbindings.caption&&this.$cbindings.caption.hasAml){var m=(this.$cbindings.queue||(this.$cbindings.queue={}));D.setAttribute("id","placeholder_"+this.$uniqueId+"_"+((m.caption||(m.caption=[])).push(F)-1));apf.setNodeValue(D,"");}else{apf.setNodeValue(D,this.$applyBindRule("caption",F));}}var u=this.$applyBindRule("tooltip",F);if(u){A.setAttribute("title",u);}var G=this.$applyBindRule("css",F);if(G){this.$setStyleClass(this.$getLayoutNode("item",null,A),G);this.$setStyleClass(this.$getLayoutNode("item","container",A),G);this.$dynCssClasses.push(G);}return A;};this.$updateNode=function(o,r){var n=this.$getLayoutNode("item","icon",r),q=this.$applyBindRule("icon",o);if(n&&q){if(n.tagName&&n.tagName.match(/^img$/i)){n.src=apf.getAbsolutePath(this.iconPath,q);}else{n.style.backgroundImage="url("+apf.getAbsolutePath(this.iconPath,q)+")";}}var t=this.$getLayoutNode("item","caption",r);if(t){if(t.nodeType==1){if(!this.$cbindings.caption||!this.$cbindings.caption.hasAml){t.innerHTML=this.$applyBindRule("caption",o);}}else{t.nodeValue=this.$applyBindRule("caption",o);}}var s=this.$applyBindRule("tooltip",o);if(s){r.setAttribute("title",s);}var m=this.$applyBindRule("css",o);if(m||this.$dynCssClasses.length){this.$setStyleClass(r,m,this.$dynCssClasses);if(m&&!this.$dynCssClasses.contains(m)){this.$dynCssClasses.push(m);}}};this.$draw=function(){this.$drawBase();};}).call(apf.tree.prototype=new apf.BaseTree());apf.aml.setElement("tree",apf.tree);apf.aml.setElement("checked",apf.BindingRule);apf.section=function(c,b){this.$init(b||"section",apf.NODE_VISIBLE,c);};apf.menubar=function(c,b){this.$init(b||"menubar",apf.NODE_VISIBLE,c);};apf.bar=function(c,b){this.$init(b||"bar",apf.NODE_VISIBLE,c);};(function(){this.$focussable=false;this.$canLeechSkin=true;this.$isLeechingSkin=false;this.$propHandlers.caption=function(b){this.$int.innerHTML=b;};this.addEventListener("AMLReparent",function(b,d,c){if(!this.$amlLoaded){return;}if(this.$isLeechingSkin&&!c&&this.skinName!=d.skinName||!this.$isLeechingSkin&&this.parentNode.$hasLayoutNode&&this.parentNode.$hasLayoutNode(this.localName)){this.$isLeechingSkin=true;this.$forceSkinChange(this.parentNode.skinName.split(":")[0]+":"+skinName);}});this.$draw=function(){this.$ext=this.$getExternal(this.$isLeechingSkin?this.localName:"main");if(this.oDrag){this.oDrag.parentNode.removeChild(this.oDrag);}this.oDrag=this.$getLayoutNode(this.$isLeechingSkin?this.localName:"main","dragger",this.$ext);this.$int=this.$getLayoutNode(this.$isLeechingSkin?this.localName:"main","container",this.$ext);};this.$loadAml=function(b){};}).call(apf.bar.prototype=new apf.Presentation());apf.menubar.prototype=apf.section.prototype=apf.bar.prototype;apf.aml.setElement("bar",apf.bar);apf.aml.setElement("menubar",apf.menubar);apf.aml.setElement("section",apf.section);apf.actions=function(c,b){this.$init(b||"actions",apf.NODE_HIDDEN,c);this.$actions=new apf.ruleList();this.$amlNodes={};};(function(){this.$smartbinding=null;this.register=function(b){if(b.localName=="smartbinding"){this.$smartbinding=b;this.$smartbinding.add(this);return;}this.$amlNodes[b.$uniqueId]=b;b.$actions=this.$actions;b.dispatchEvent("actionsload",{bindings:this});};this.unregister=function(b){this.$amlNodes[b.$uniqueId]=null;delete this.$amlNodes[b.$uniqueId];delete b.$actions;b.dispatchEvent("actionsunload",{bindings:this});};this.addEventListener("DOMNodeInsertedIntoDocument",function(j){var c=this.childNodes;for(var g,d=0,b=c.length;d<b;d++){if((g=c[d]).nodeType!=1){continue;}g.dispatchEvent("DOMNodeInsertedIntoDocument");}this.register(this.parentNode);});}).call(apf.actions.prototype=new apf.AmlElement());apf.aml.setElement("actions",apf.actions);apf.radiobutton=function(d,b){this.$init(b||"radiobutton",apf.NODE_VISIBLE,d);this.$constructor=apf.radiobutton;var c=apf.aml.setElement("radiobutton",function(){this.$init(b||"radiobutton",apf.NODE_VISIBLE,d);});c.prototype=apf.radiobutton.prototype;apf.radiobutton=c;};(function(){this.implement(apf.ChildValue);this.$childProperty="label";this.$focussable=true;this.$booleanProperties.checked=true;this.$supportedProperties.push("value","background","group","label","checked","tooltip","icon");this.$propHandlers.group=function(b){if(!this.$amlLoaded){return;}if(this.$group&&this.$group.$removeRadio){this.$group.$removeRadio(this);}if(!b){this.$group=null;return;}var c=typeof b=="string"?apf.nameserver.get("radiogroup",b):b;if(!c){c=apf.nameserver.register("radiogroup",b,new apf.$group());c.setAttribute("id",b);c.dispatchEvent("DOMNodeInsertedIntoDocument");c.parentNode=this;}this.$group=c;if(this.oInput){this.oInput.setAttribute("name",b);}this.$group.$addRadio(this);};this.$propHandlers.tooltip=function(b){this.$ext.setAttribute("title",b);};this.$propHandlers.icon=function(b){if(!this.oIcon){return apf.console.warn("No icon defined in the Button skin","button");}if(b){this.$setStyleClass(this.$ext,this.$baseCSSname+"Icon");}else{this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Icon"]);}apf.skins.setIcon(this.oIcon,b,this.iconPath);};this.$propHandlers.label=function(b){if(b){this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Empty"]);}else{this.$setStyleClass(this.$ext,this.$baseCSSname+"Empty");}if(this.oLabel){this.oLabel.innerHTML=b;}};this.$propHandlers.checked=function(b){if(!this.$group){return;}if(b){this.$group.setProperty("value",this.value);}};this.addEventListener("prop.model",function(b){if(this.$group){this.$group.setProperty("model",b.value);}});this.$propHandlers.background=function(d){var g=this.$getLayoutNode("main","background",this.$ext);if(d){var c=d.split("|");this.$background=c.concat(["vertical",2,16].slice(c.length-1));g.style.backgroundImage="url("+this.mediaPath+c[0]+")";g.style.backgroundRepeat="no-repeat";}else{g.style.backgroundImage="";g.style.backgroundRepeat="";this.$background=null;}};this.setValue=function(b){this.setProperty("value",b,false,true);};this.getValue=function(){return this.value;};this.check=function(){this.setProperty("checked",true,false,true);};this.uncheck=function(){this.setProperty("checked",false,false,true);};this.getGroup=function(){return this.$group;};this.$check=function(b){this.$setStyleClass(this.$ext,this.$baseCSSname+"Checked");this.checked=true;if(this.oInput){this.oInput.checked=true;}this.doBgSwitch(2);};this.$uncheck=function(){this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Checked"]);this.checked=false;if(this.oInput){this.oInput.checked=false;}this.doBgSwitch(1);};this.$enable=function(){if(this.oInput){this.oInput.disabled=false;}var b=this;this.$ext.onclick=function(c){if(!c){c=event;}if((c.srcElement||c.target)==this){return;}b.dispatchEvent("click",{htmlEvent:c});b.$group.change(b.value);};this.$ext.onmousedown=function(c){if(!c){c=event;}if((c.srcElement||c.target)==this){return;}apf.setStyleClass(this,b.$baseCSSname+"Down");};this.$ext.onmouseover=function(c){if(!c){c=event;}if((c.srcElement||c.target)==this){return;}apf.setStyleClass(this,b.$baseCSSname+"Over");};this.$ext.onmouseout=this.$ext.onmouseup=function(){apf.setStyleClass(this,"",[b.$baseCSSname+"Down",b.$baseCSSname+"Over"]);};};this.$disable=function(){if(this.oInput){this.oInput.disabled=true;}this.$ext.onclick=null;this.$ext.onmousedown=null;};this.doBgSwitch=function(c){if(this.bgswitch&&(this.bgoptions[1]>=c||c==4)){if(c==4){c=this.bgoptions[1]+1;}var b=this.bgoptions[0]=="vertical"?"0 -"+(parseInt(this.bgoptions[2])*(c-1))+"px":"-"+(parseInt(this.bgoptions[2])*(c-1))+"px 0";this.$getLayoutNode("main","background",this.$ext).style.backgroundPosition=b;}};this.$focus=function(){if(!this.$ext){return;}if(this.oInput&&this.oInput.disabled){return false;}this.$setStyleClass(this.$ext,this.$baseCSSname+"Focus");};this.$blur=function(){if(!this.$ext){return;}this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Focus"]);};this.addEventListener("keydown",function(d){var b=d.keyCode;if(b==13||b==32){this.$group.change(this.value);return false;}else{if(b==38){var c=this;while(c&&c.previousSibling){c=c.previousSibling;if(c.localName=="radiobutton"&&!c.disabled&&c.$group==this.$group){c.check();c.focus();return;}}}else{if(b==40){var c=this;while(c&&c.nextSibling){c=c.nextSibling;if(c.localName=="radiobutton"&&!c.disabled&&c.$group==this.$group){c.check();c.focus();return;}}}}}},true);this.$draw=function(){this.$ext=this.$getExternal();this.oInput=this.$getLayoutNode("main","input",this.$ext);this.oLabel=this.$getLayoutNode("main","label",this.$ext);this.oIcon=this.$getLayoutNode("main","icon",this.$ext);if(this.oLabel&&this.oLabel.nodeType!=1){this.oLabel=this.oLabel.parentNode;}this.enable();};this.$childProperty="label";this.$loadAml=function(b){if(this.group){this.$propHandlers.group.call(this,this.group);}else{if(this.parentNode.localName=="group"){this.$propHandlers.group.call(this,this.parentNode);}}if(!this.$group){this.$propHandlers.group.call(this,"radiogroup"+this.parentNode.$uniqueId);}};this.$destroy=function(){if(this.$group){this.$group.$removeRadio(this);}};}).call(apf.radiobutton.prototype=new apf.Presentation());apf.aml.setElement("radiobutton",apf.radiobutton);apf.$group=function(g,b){this.$init(b||"radiogroup",apf.NODE_VISIBLE,g);this.implement(apf.StandardBinding,apf.DataAction);var d=[];this.$supportedProperties.push("value","selectedItem");this.$propHandlers.value=function(k){for(var j=0;j<d.length;j++){if(d[j].value==k){return this.setProperty("selectedItem",d[j]);}}return this.setProperty("selectedItem",null);};var c;this.$propHandlers.selectedItem=function(k){if(c){c.$uncheck();}if(!k){return;}k.$check();c=k;for(var j=0;j<d.length;j++){d[j].setProperty("selectedItem",k);}};this.$addRadio=function(j){var k=d.push(j)-1;if(!j.value){j.setProperty("value",k);}if(this.value&&j.value==this.value){this.setProperty("selectedItem",j);}else{if(j.checked){this.setProperty("value",j.value);}}};this.$removeRadio=function(j){d.remove(j);if(j.value===j.id){j.setProperty("value","");}if(j.selectedItem==j){this.setProperty("value",null);}};this.setValue=function(j){this.setProperty("value",j);};this.getValue=function(){return this.value;};this.$draw=function(){this.$ext=this.$int=this.$pHtmlNode;};};apf.$group.prototype=new apf.GuiElement();apf.aml.setElement("group",apf.$group);apf.style=function(c,b){this.$init(b||"style",apf.NODE_HIDDEN,c);};(function(){this.$focussable=false;this.$propHandlers.src=function(b){apf.getData(b,{callback:function(d,c){if(c==apf.SUCCESS){apf.importCssString(d);}}});};this.addEventListener("DOMNodeInsertedIntoDocument",function(b){if(this.type!="text/chartcss"&&this.firstChild){apf.importCssString(this.firstChild.nodeValue);}});}).call(apf.style.prototype=new apf.AmlElement());apf.aml.setElement("style",apf.style);apf.xhtml.setElement("style",apf.style);apf.page=function(c,b){this.$init(b||"page",apf.NODE_VISIBLE,c);};(function(){this.canHaveChildren=true;this.$focussable=false;this.buttons=false;this.closebtn=false;this.setCaption=function(b){this.setProperty("caption",b,false,true);};this.setIcon=function(b){this.setProperty("icon",b,false,true);};this.addEventListener("beforerender",function(){this.parentNode.dispatchEvent("beforerender",{page:this});});this.addEventListener("afterrender",function(){this.parentNode.dispatchEvent("afterrender",{page:this});});this.$booleanProperties.visible=true;this.$booleanProperties.fake=true;this.$booleanProperties.closebtn=true;this.$supportedProperties.push("fake","caption","icon","type","buttons","closebtn");this.$propHandlers.buttons=function(b){this.buttons=b;};this.$propHandlers.closebtn=function(b){this.closebtn=b;};this.$propHandlers.caption=function(c){if(!this.parentNode){return;}var b=this.parentNode.$getLayoutNode("button","caption",this.$button);if(b.nodeType==1){b.innerHTML=c;}else{b.nodeValue=c;}};this.$propHandlers.icon=function(c){if(!this.parentNode){return;}var b=this.parentNode.$getLayoutNode("button","icon",this.$button);if(b&&b.nodeType==1){apf.skins.setIcon(b,c,this.parentNode.iconPath);}};this.$propHandlers.visible=function(g){if(!this.parentNode){return;}if(g){this.$ext.style.display="";if(this.parentNode.$hasButtons){this.$button.style.display="block";}if(!this.parentNode.$activepage){this.parentNode.set(this);}}else{if(this.$active){this.$deactivate();var d=this.parentNode.activepagenr+1;var c=this.parentNode.getPages();var b=c.length;while(d<b&&!c[d].visible){d++;}if(d==b){d=this.parentNode.activepagenr-1;while(d>=0&&b&&!c[d].visible){d--;}}if(d>=0){this.parentNode.set(d);}else{this.parentNode.activepage=this.parentNode.activepagenr=this.parentNode.$activepage=null;}}this.$ext.style.display="none";if(this.parentNode.$hasButtons){this.$button.style.display="none";}}};this.$propHandlers.fake=function(b){if(this.$ext){apf.destroyHtmlNode(this.$ext);this.$int=this.$ext=null;}};this.$propHandlers.type=function(b){this.setProperty("fake",true);this.relPage=this.parentNode.getPage(b);if(this.$active){this.$activate();}};this.addEventListener("DOMNodeRemoved",function(b){if(b&&b.currentTarget!=this){return;}if(this.$button){if(this.$position&1){this.parentNode.$setStyleClass(this.$button,"",["firstbtn","firstcurbtn"]);}if(this.$position&2){this.parentNode.$setStyleClass(this.$button,"",["lastbtn"]);}}if(!b.$doOnlyAdmin){if(this.$button){this.$button.parentNode.removeChild(this.$button);}if(this.parentNode.$activepage==this){if(this.$button){this.parentNode.$setStyleClass(this.$button,"",["curbtn"]);}this.parentNode.$setStyleClass(this.$ext,"",["curpage"]);}}});this.addEventListener("DOMNodeInserted",function(b){if(b&&b.currentTarget!=this||!this.$amlLoaded||!b.$oldParent){return;}if(!b.$isMoveWithinParent&&this.skinName!=this.parentNode.skinName){this.$destroy();}else{if(this.$button&&b.$oldParent.$hasButtons){this.parentNode.$buttons.insertBefore(this.$button,b.$beforeNode&&b.$beforeNode.$button||null);}}},true);this.$position=0;this.$first=function(b){if(b){this.$position-=1;this.parentNode.$setStyleClass(this.$button,"",["firstbtn","firstcurbtn"]);}else{this.$position=this.$position|1;this.parentNode.$setStyleClass(this.$button,"firstbtn"+(this.parentNode.$activepage==this?" firstcurbtn":""));}};this.$last=function(b){if(b){this.$position-=2;this.parentNode.$setStyleClass(this.$button,"",["lastbtn"]);}else{this.$position=this.$position|2;this.parentNode.$setStyleClass(this.$button,"lastbtn");}};this.$deactivate=function(b){this.$active=false;if(this.parentNode.$hasButtons){if(this.$position>0){this.parentNode.$setStyleClass(this.$button,"",["firstcurbtn"]);}this.parentNode.$setStyleClass(this.$button,"",["curbtn"]);}if((!this.fake||this.relPage)&&!b){this.parentNode.$setStyleClass(this.fake?this.relPage.$ext:this.$ext,"",["curpage"]);this.dispatchEvent("prop.visible",{value:false});}};this.$activate=function(){this.$active=true;if(!this.$drawn){var c;this.addEventListener("DOMNodeInsertedIntoDocument",c=function(d){this.removeEventListener("DOMNodeInsertedIntoDocument",c);if(!this.$active){return;}this.$activate();});return;}if(this.parentNode.$hasButtons){if(this.$position>0){this.parentNode.$setStyleClass(this.$button,"firstcurbtn");}this.parentNode.$setStyleClass(this.$button,"curbtn");}if(!this.fake||this.relPage){this.parentNode.$setStyleClass(this.fake?this.relPage.$ext:this.$ext,"curpage");if(apf.layout){apf.layout.forceResize(this.fake?this.relPage.$int:this.$int);}}if(this.$render){this.$render();}if(!this.fake){if(apf.isIE){var b=this.$ext.className;this.$ext.className="rnd"+Math.random();this.$ext.className=b;}this.dispatchEvent("prop.visible",{value:true});}};this.addEventListener("$skinchange",function(){if(this.caption){this.$propHandlers.caption.call(this,this.caption);}if(this.icon){this.$propHandlers.icon.call(this,this.icon);}});this.$canLeechSkin=true;this.$draw=function(d){this.skinName=this.parentNode.skinName;var m=this.getAttribute("type");if(m){this.fake=true;this.relPage=this.parentNode.getPage(m)||null;}if(this.parentNode.$hasButtons){this.parentNode.$getNewContext("button");var j=this.parentNode.$getLayoutNode("button");j.setAttribute(this.parentNode.$getOption("main","select")||"onmousedown","var page = apf.lookup("+this.$uniqueId+");                 if (page.disabled) return;                 page.parentNode.set(page);                 page.canHaveChildren = 2;");j.setAttribute("onmouseover","var o = apf.lookup("+this.parentNode.$uniqueId+");if(apf.lookup("+this.$uniqueId+') != o.$activepage) o.$setStyleClass(this, "over", null, true);');j.setAttribute("onmouseout","var o = apf.lookup("+this.parentNode.$uniqueId+');                  o.$setStyleClass(this, "", ["over"], true);                  var page = apf.lookup('+this.$uniqueId+");                  page.canHaveChildren = true;");var g=this.getAttribute("id")||this.getAttribute("name"),b=this.getAttribute("closebtn");if((b=="true"||(this.parentNode.buttons=="close"&&b==null))&&g){var c=this.parentNode.$getLayoutNode("button","btncontainer");this.parentNode.$getNewContext("btnclose");var k=this.parentNode.$getLayoutNode("btnclose");if(!k){return;}k.setAttribute("onclick","var page = apf.lookup("+this.$uniqueId+");                     page.parentNode.remove("+g+");");c.appendChild(k);}this.$button=apf.insertHtmlNode(j,this.parentNode.$buttons);if(!d&&this.nextSibling&&this.nextSibling.$button){this.$button.parentNode.insertBefore(this.$button,this.nextSibling.$button);}this.$button.host=this;}if(this.fake){return;}if(this.$ext){this.$ext.parentNode.removeChild(this.$ext);}this.$ext=this.parentNode.$getExternal("page",this.parentNode.oPages,null,this);this.$ext.host=this;this.$int=this.parentNode.$getLayoutNode("page","container",this.$ext);};this.$loadAml=function(b){};this.$destroy=function(){if(this.$button){this.$button.host=null;this.$button=null;}};}).call(apf.page.prototype=new apf.Presentation());apf.aml.setElement("page",apf.page);apf.BindingDndRule=function(c,b){this.$init(b,apf.NODE_HIDDEN,c);};(function(){this.compile=function(c){if(!this[c]){return;}var b;if(c=="value"){b=apf.lm.compile(this[c],{xpathmode:3});}else{if(c=="match"){b=apf.lm.compile(this[c],{xpathmode:3,injectself:true});}else{if(c=="target"){b=apf.lm.compile(this[c],{xpathmode:2,injectself:true});}else{if(c=="action"){b=apf.lm.compile(this[c],{nostring:true});}else{if(c=="copy"){b=apf.lm.compile(this[c],{withopt:true,nostring:true});}else{throw new Error("Missing property handler for compile");}}}}}return(this["c"+c]=b);};this.$attrExcludePropBind=apf.extend({target:1,parent:1,action:1,dragcopy:1},this.$attrExcludePropBind);this.$propHandlers.target=this.$propHandlers.parent=this.$propHandlers.action=this.$propHandlers.dragcopy=function(b,c){delete this["c"+c];};this.$noderegister=function(b){apf.GuiElement.propHandlers.drop.call(b.amlNode,true);};this.addEventListener("DOMNodeInsertedIntoDocument",function(g){var d=this;while(d&&d.$bindingRule){d=d.parentNode;}if(!d){return;}if(d.localName=="bindings"){d.addEventListener("noderegister",this.$noderegister);var b=d.$amlNodes;for(var c=0;c<b.length;c++){apf.GuiElement.propHandlers.drop.call(b[c],true);}}else{apf.GuiElement.propHandlers.drop.call(d,true);}});}).call(apf.BindingDndRule.prototype=new apf.BindingRule());apf.aml.setElement("drag",apf.BindingDndRule);apf.aml.setElement("drop",apf.BindingDndRule);apf.toolbar=function(c,b){this.$init(b||"toolbar",apf.NODE_VISIBLE,c);};(function(){this.$focussable=false;this.$draw=function(){this.$ext=this.$getExternal();this.$int=this.$getLayoutNode("main","container",this.$ext);};}).call(apf.toolbar.prototype=new apf.Presentation());apf.aml.setElement("toolbar",apf.toolbar);apf.divider=function(c,b){this.$init(b||"divider",apf.NODE_VISIBLE,c);};(function(){this.$focussable=false;this.implement(apf.ChildValue);this.$childProperty="caption";this.addEventListener("AMLReparent",function(b,d,c){if(!this.$amlLoaded){return;}if(!c&&this.skinName!=d.skinName){this.loadAml();}});this.$supportedProperties.push("caption","value","for","textalign");this.$propHandlers.caption=function(b){if(this.$caption){this.$caption.style.display=b?"inline":"";this.$caption.innerHTML=b;}};this.show=function(){this.setProperty("visible",true);};this.hide=function(){this.setProperty("visible",false);};this.$canLeechSkin=true;this.$draw=function(){if(this.parentNode.isPaged&&this.parentNode.$buttons){this.$pHtmlNode=this.parentNode.$buttons;}if(this.$isLeechingSkin){this.$ext=apf.insertHtmlNode(this.parentNode.$getLayoutNode("divider"),this.$pHtmlNode);}else{this.$ext=this.$getExternal("main");this.$caption=this.$getLayoutNode("main","caption",this.$ext);}};}).call(apf.divider.prototype=new apf.Presentation);apf.aml.setElement("divider",apf.divider);apf.hbox=function(c,b){this.$init(b||"hbox",apf.NODE_VISIBLE,c);this.$lastRules=[];};apf.vbox=function(c,b){this.$init(b||"vbox",apf.NODE_VISIBLE,c);this.$lastRules=[];};(function(){var b=apf.layout;this.$focussable=false;this.$update=false;this.padding=2;this.edge="5 5 5 5";this.pack="start";this.stretch=true;var d=apf.isIE?"styleFloat":"cssFloat";this.$supportedProperties.push("padding","margin","flex","pack","stretch");this.$booleanProperties.stretch=true;this.$propHandlers.padding=this.$propHandlers.edge=this.$propHandlers.pack=this.$propHandlers.stretch=function(j){if(!this.$update&&apf.loaded){b.queue(this.$ext,this.$updateObj);}this.$update=true;};function c(){var j=this.parentNode;if(!j.$update&&apf.loaded){b.queue(j.$ext,j.$updateObj);}j.$update=true;}this.register=function(j){j.$propHandlers.left=j.$propHandlers.top=j.$propHandlers.right=j.$propHandlers.bottom=apf.K;j.$propHandlers.align=j.$propHandlers.flex=j.$propHandlers.width=j.$propHandlers.height=j.$propHandlers.margin=this.$updateObj.updateTrigger;j.addEventListener("prop.visible",c);j.$ext.style.left=j.$ext.style.right=j.$ext.style.top=j.$ext.style.bottom="";b.queue(this.$ext,this.$updateObj);this.$update=true;};this.unregister=function(j){j.$propHandlers.left=j.$propHandlers.top=j.$propHandlers.right=j.$propHandlers.bottom=j.$propHandlers.align=j.$propHandlers.flex=j.$propHandlers.width=j.$propHandlers.height=j.$propHandlers.margin=null;j.removeEventListener("prop.visible",c);j.$altExt=null;if(j.nodeFunc==apf.NODE_VISIBLE){j.$ext.style.display=j.visible?"block":"none";j.$ext.style.verticalAlign="";j.$ext.style[d]="";}b.queue(this.$ext,this.$updateObj);this.$update=true;};this.addEventListener("DOMNodeRemoved",function(k){if(this.$isWaitingOnDisplay||!this.$updateObj||k.$doOnlyAdmin){return;}if(k.currentTarget==this){var j=this;while(j){j.unwatch("visible",this.$updateObj.propChange);j=j.parentNode;}}else{if(k.relatedNode==this){this.unregister(k.currentTarget);}}});this.addEventListener("DOMNodeInserted",function(k){if(this.$isWaitingOnDisplay||k.currentTarget.nodeType!=1){return;}if(k.currentTarget==this){var j=this;while(j){j.watch("visible",this.$updateObj.propChange);j=j.parentNode;}}else{if(k.relatedNode==this){if(k.$isMoveWithinParent){b.queue(this.$ext,this.$updateObj);this.$update=true;}else{k.currentTarget.$setLayout(this.localName);}}}});function g(k,j){return typeof k=="string"?k.replace(apf.percentageMatch,"(("+j+" * $1)/100)"):k;}this.addEventListener("prop.height",function(j){if(!this.$update){this.$update=true;b.queue(this.$ext,this.$updateObj);}});this.addEventListener("prop.width",function(j){if(!this.$update){this.$update=true;b.queue(this.$ext,this.$updateObj);}});this.$isWaitingOnDisplay=false;this.$updateBox=function(){if(!this.$update){return;}if(this.$lastRules.length){for(var ab=0,N=this.$lastRules.length;ab<N;ab++){b.removeRule(this.$lastRules[ab][0],this.$lastRules[ab][1]);b.queue(this.$lastRules[ab][0]);}this.$lastRules=[];}if(!this.$ext.offsetWidth){this.$isWaitingOnDisplay=true;this.watch("visible",this.$updateObj.propChange);var W=this.parentNode;while(W){W.watch("visible",this.$updateObj.propChange);W=W.parentNode;}return;}this.padding=parseInt(this.padding);var P;var L="pWidth",X="pHeight",A=apf.getBox(String(this.edge)),q=this.childNodes,S={total:0,count:[],html:[]},J=[],w,K,aa,Y,U,ad,G,F,H;this.ids=[this.$ext];var E=q.length,O=this.localName=="vbox",Z=!O;this.$hasPerc=false;this.$totalPerc=0;this.$totalFixed=(O?A[2]:A[1])+((E-1)*this.padding);var I=this.$ext.style.width;var R=this.$ext.style.height;var r=this.height||this.top&&this.bottom||this.anchors;var ac=0;var u=O?"height":"width";var T=O?"offsetHeight":"offsetWidth";for(var Q=[],ab=0,N=q.length;ab<N;ab++){F=q[ab];if(F.nodeType!=1&&F.nodeType!=7||F.nodeFunc==apf.NODE_HIDDEN||F.visible===false){continue;}Y=apf.getBox(String(F.margin));K=apf.getDiff(w=F.$ext);G=F.span;ad={m:Y,weight:parseInt(F.weight)||1,align:F.align,width:F.width,height:F.height,minwidth:F.minwidth||0,minheight:F.minheight||0,oHtml:w};ad.isPerc=String(ad[u]).indexOf("%")>-1;if(ad.width&&!String(ad.width).match(/^\d+%?$/)){throw new Error("Invalid width specified:"+ad.width);}if(ad.height&&!String(ad.height).match(/^\d+%?$/)){throw new Error("Invalid height specified:"+ad.height);}Q.push(ad);w.style.display=Z?"inline-block":"block";if(Z){w.style.verticalAlign="top";}var B=false;if(!R&&!r&&ad.isPerc){delete ad[u];ad.isPerc=false;}if(ad.isPerc){this.$createInt();if(!F.$altExt){F.$altExt=this.$int.insertBefore(document.createElement("div"),w);F.$altExt.appendChild(w);F.$altExt.style.position="relative";if(Z){F.$altExt.style.display="inline-block";F.$altExt.style.verticalAlign="top";}B=true;}if((F.width||O&&(this.stretch||!w.style.width))&&(F.height||Z&&this.stretch)){w.style.position="absolute";w.style.left=0;w.style.top=0;w.style.right=0;w.style.bottom=0;w.style.height="";w.style.width="";}else{w.style.position="relative";w.style.display="block";w.style.width="auto";}w.style.margin="";w=ad.oHtml=F.$altExt;F.$altExt.style[u]=ad[u];this.$hasPerc=true;this.$totalPerc++;if(B&&apf.isIE){apf.layout.forceResize(F.$ext);}if(Z){w.style[d]="";}}else{if(F.$altExt){if(F.$altExt.parentNode==this.$int){this.$int.insertBefore(w,F.$altExt);}F.$altExt.parentNode.removeChild(F.$altExt);F.$altExt=null;B=true;w.style.position="";w.style.display="";}if(ad[u]||ad[u]===0){if(parseInt(ad[u])==NaN){apf.console.warn("Invalid "+u+" specific. Only                             numbers or percentage is allowed:"+ad[u]);ad[u]=null;}else{this.$totalFixed+=parseInt(ad[u]);}w.style[u]=Math.max(0,ad[u]-K[O?1:0])+"px";}else{w.style[u]="";this.$totalFixed+=w[T];if(!w.getAttribute("id")){H="document.getElementById('"+apf.setUniqueHtmlId(w)+"')";}else{H="document.getElementById('"+w.getAttribute("id")+"')";}S.html.push(w);S.count.push(H+"."+T);S.total+=w[T];}w.style.position="relative";if(B&&apf.isIE){apf.layout.forceResize(F.$ext);}if(Z){w.style[d]=ad.align&&ad.align!=this.pack?(ad.align=="start"?"left":"right"):"";}}if(O){if((ad.width||ad.width===0)&&String(ad.width).indexOf("%")==-1){ac=Math.max(ac,ad.width);w.style.width=(ad.width-K[0])+"px";}else{if(this.stretch){ac=Math.max(ac,ad.minwidth||5);w.style.width="auto";}else{w.style.width="";ac=Math.max(ac,ad.minwidth);}}ac+=Y[1]+Y[3];}else{if(Z){if((ad.height||ad.height===0)&&String(ad.height).indexOf("%")==-1){ac=Math.max(ac,ad.height);w.style.height=(ad.height-K[1])+"px";}else{if(r&&this.stretch){ac=Math.max(ac,ad.minheight||5);J.push([w,K[1],ad.m]);}else{w.style.height="";ac=Math.max(ac,ad.minheight);}}ac+=Y[0]+Y[2];}}this.$totalFixed+=(O?Y[0]+Y[2]:Y[1]+Y[3]);}if(Q.length==0){this.$update=false;return;}var C,Y,o;for(ab=0,N=Q.length;ab<N;ab++){ad=Q[ab];Y=ad.m;o=Q[ab+1]&&Q[ab+1].m;ad.oHtml.style.margin=O?(Y[0]+(C&&C[2]||0))+"px "+Y[1]+"px "+(Y[2]+(o&&o[0]||0)+(ab<N-1?this.padding:0))+"px "+Y[3]+"px":Y[0]+"px "+(Y[1]+(o&&o[3]||0)+(ab<N-1?this.padding:0))+"px "+Y[2]+"px "+(Y[3]+(C&&C[1]||0))+"px";C=ad.m;}var M=apf.getBox(this.$ext.style.padding);if(this.$hasPerc){this.$ext.style.padding=O?A[0]+"px "+A[1]+"px "+this.$totalFixed+"px "+A[3]+"px":A[0]+"px "+this.$totalFixed+"px "+A[2]+"px "+A[3]+"px";}else{this.$ext.style.padding=A.join("px ")+"px";}if(S.count){var D="apf.all["+this.$uniqueId+"]";S.count=S.count.join(" + ");for(var ab=0;ab<S.html.length;ab++){html=S.html[ab];if(this.$hasPerc){b.setRules(html,"boxp","try{"+D+".$ext.style.padding"+(O?"Bottom":"Right")+" = ("+(this.$totalFixed-S.total)+" + "+S.count+") + 'px';}catch(e){}",true);}else{b.setRules(html,"boxp","try{"+D+".$ext.style.min"+(O?"Height":"Width")+" = -"+(O?A[2]:A[1])+" + ("+D+"['min"+u+"'] = "+(this.$totalFixed-S.total)+" + "+S.count+") + 'px';}catch(e){}",true);}b.queue(html);this.$lastRules.push([html,"boxp"]);}this.$totalFixed+=O?A[0]:A[3];}var V=apf.getBox(this.$ext.style.padding);var k=parseInt(apf.getStyle(this.$ext,"width"));var n=parseInt(apf.getStyle(this.$ext,"height"));if(I&&(k||k===0)){if(this.width){this.$propHandlers.width.call(this,this.width);}else{if(this.left&&this.right){this.$propHandlers.right.call(this,this.right);}else{this.$ext.style.width=Math.max(0,k+M[1]-V[1]+M[3]-V[3])+"px";}}}if(R&&(n||n===0)){if(this.height){this.$propHandlers.height.call(this,this.height);}else{if(this.top&&this.bottom){this.$propHandlers.bottom.call(this,this.bottom);}else{this.$ext.style.height=Math.max(0,n+M[0]-V[0]+M[2]-V[2])+"px";}}}if(r&&J.length){var t=["var height = apf.all["+this.$uniqueId+"].$ext.offsetHeight"];for(ab=0;ab<J.length;ab++){html=J[ab][0];if(!html.getAttribute("id")){H="document.getElementById('"+apf.setUniqueHtmlId(html)+"')";}else{H="document.getElementById('"+html.getAttribute("id")+"')";}t.push(H+".style.height = (height - apf.getHeightDiff("+H+") - "+ +(A[0]+A[2]+J[ab][2][0]+J[ab][2][2])+") + 'px'");}b.setRules(this.$ext,"boxh",(t.length?"try{"+t.join(";}catch(e){};\ntry{")+";}catch(e){};":""),true);b.queue(this.$ext);this.$lastRules.push([this.$ext,"boxh"]);}if(Z){this.$int.style.textAlign=this.$hasPerc||!this.pack||this.pack=="start"?"left":(this.pack=="middle"?"center":"right");}else{if(this.pack||this.$ext!=this.$int){this.$createInt();if(this.$hasPerc||!this.pack||this.pack=="start"){this.$int.style.position="static";if(O){this.$int.style.height="100%";}this.$int.style.top="";this.$int.style.marginTop="";}else{if(this.pack=="middle"){this.$int.style.position="relative";this.$int.style.top="50%";this.$int.style.height="auto";this.$int.style.marginTop="-"+(this.$int.offsetHeight/2)+"px";}else{if(this.pack=="end"){this.$int.style.position="relative";this.$int.style.top="100%";this.$int.style.height="auto";this.$int.style.marginTop="-"+this.$int.offsetHeight+"px";}}}}}this["min"+u]=this.$totalFixed+(O?A[0]:A[3])-3+(this.$totalPerc*5);this.$ext.style["min"+u.uCaseFirst()]=((this.$hasPerc?(this.$totalPerc*5):this.$totalFixed-(O?A[2]:A[1])-3))+"px";this["min"+(O?"width":"height")]=ac+(O?A[1]+A[3]:A[0]+A[2]);this.$ext.style["min"+(O?"Width":"Height")]=(ac)+"px";this.$update=false;};this.$createInt=function(){if(this.$ext==this.$int){this.$int=this.$ext.appendChild(document.createElement("div"));this.$int.style.whiteSpace="nowrap";this.$int.className="int";var m=this.$ext.childNodes;for(var k=m.length-2;k>=0;k--){this.$int.insertBefore(m[k],this.$int.firstChild);}if(this.localName=="vbox"){this.$int.style.height="100%";}}};this.$draw=function(){var j=this;this.$updateObj={$updateLayout:function(){j.$updateBox();},updateTrigger:function(k){if(!j.$update&&j.$amlLoaded){b.queue(j.$ext,j.$updateObj);}j.$update=true;},propChange:function(m,k,n){if(j.$update&&apf.isTrue(n)&&j.$ext.offsetWidth){j.$updateBox();b.activateRules(j.$ext);var o=j;while(o){o.unwatch("visible",j.$updateObj.propChange);o=o.parentNode;}j.$isWaitingOnDisplay=false;}}};this.$ext=this.$pHtmlNode.appendChild(document.createElement("div"));this.$ext.className=this.localName+" "+(this.getAttribute("class")||"");this.$ext.style.whiteSpace="nowrap";this.$int=this.$ext;this.$ext.host=this;this.$ext.style.position="relative";this.$ext.style.minHeight="10px";if(!apf.vbox.$initedcss){apf.importCssString(".vbox>*{white-space:normal;} .hbox>*{white-space:normal;} .vbox>.int>*{white-space:normal;} .hbox>.int>*{white-space:normal;}");apf.vbox.$initedcss=true;}b.queue(this.$ext,this.$updateObj);this.$update=true;};this.$loadAml=function(j){if(!this.width&&(apf.getStyle(this.$ext,"position")=="absolute"||this.left||this.top||this.right||this.bottom||this.anchors)){this.$ext.style.width="100%";}};}).call(apf.vbox.prototype=new apf.GuiElement());apf.hbox.prototype=apf.vbox.prototype;apf.aml.setElement("hbox",apf.hbox);apf.aml.setElement("vbox",apf.vbox);apf.event=function(c,b){this.$init(b||"event",apf.NODE_HIDDEN,c);};(function(){this.$hasInitedWhen=false;this.$booleanProperties.repeat=true;this.$supportedProperties.push("when","message","icon","repeat");this.$propHandlers.when=function(c){if(this.$hasInitedWhen&&c&&this.parentNode&&this.parentNode.popup){var b=this;$setTimeout(function(){b.parentNode.popup(b.message,b.icon,b);});}this.$hasInitedWhen=true;if(this.repeat){delete this.when;}};this.$loadAml=function(b){};}).call(apf.event.prototype=new apf.AmlElement());apf.aml.setElement("event",apf.event);apf.BindingSeriesRule=function(c,b){this.$init(b||"series",apf.NODE_HIDDEN,c);};(function(){this.$attrExcludePropBind=apf.extend({formula:1},this.$attrExcludePropBind);this.$propHandlers.formula=function(b,c){delete this["c"+c];};}).call(apf.BindingSeriesRule.prototype=new apf.BindingRule());apf.aml.setElement("series",apf.BindingSeriesRule);apf.iconmap=function(){this.$init("iconmap",apf.NODE_HIDDEN);};(function(){this.$parsePrio="050";this.addEventListener("DOMNodeInsertedIntoDocument",function(b){if(!this.id){throw new Error(apf.formatErrorString(0,this,"Creating icon map","Could not create iconmap. Missing id attribute",this.$aml));}apf.skins.addIconMap({name:this.id,src:this.src,type:this.type,size:parseInt(this.size),width:parseInt(this.width),height:parseInt(this.height),offset:(this.offset||"0,0").splitSafe(",")});});}).call(apf.iconmap.prototype=new apf.AmlElement());apf.aml.setElement("iconmap",apf.iconmap);apf.BindingColumnRule=function(c,b){this.$init(b,apf.NODE_HIDDEN,c);this.$className="col"+this.$uniqueId;};(function(){this.$defaultwidth="100";this.$width=100;this.$sortable=true;this.$resizable=true;this.$movable=true;this.$cssInit=false;this.$attrExcludePropBind=apf.extend({css:1,icon:1,caption:1},this.$attrExcludePropBind);this.$supportedProperties.push("tree","icon","caption","width","options","editor","colspan","align","css");this.$booleanProperties.tree=true;this.$propHandlers.icon=function(b,c){};this.$propHandlers.caption=function(b,c){};this.$propHandlers.width=function(b,c){if(!b){b=this.$defaultwidth;}this.$isPercentage=b&&String(b).indexOf("%")>-1;this.$width=parseFloat(b);};this.$propHandlers.options=function(b,c){this.$sortable=b.indexOf("sort")>-1;this.$resizable=b.indexOf("size")>-1;this.$movable=b.indexOf("move")>-1;};this.$propHandlers.editor=function(b,c){};this.$propHandlers.colspan=function(b,c){};this.$propHandlers.align=function(b,c){};this.$propHandlers.css=function(b,c){};this.resize=function(c,B){var r;if(this.$isPercentage){var u=(this.$ext.offsetWidth-(B.$widthdiff-3)),t=c/u,s=[],k=[],w=0,d=this.$ext.nextSibling;while(d&&d.getAttribute("hid")){r=apf.all[d.getAttribute("hid")];if(r.$isPercentage){s.push(r);w+=r.$width;}else{k.push(r);}d=d.nextSibling;}if(k.length&&!s.length){return k[0].resize(k[0].$width+(u-c),B);}var j=t*this.$width,q=j-this.$width,o=(w-q)/w;if(o<0.01){if(c<20){return;}return this.resize(c-10,B);}for(var b,m=0;m<s.length;m++){b=s[m];b.$width*=o;apf.setStyleRule("."+b.$className,"width",b.$width+"%");}this.$width=j;apf.setStyleRule("."+this.$className,"width",this.$width+"%");}else{var A=c-this.$width;this.$width=c;if(apf.isIE&&B.oIframe){this.$ext.style.width=c+"px";}else{}apf.setStyleRule("."+this.$className,"width",c+"px",null,B.oWin);B.$fixed+=A;var g=(B.$fixed)+"px";if(!this.$isFixedGrid){apf.setStyleRule("."+B.$baseCSSname+" .row"+B.$uniqueId,"paddingRight",g,null,this.oWin);apf.setStyleRule("."+B.$baseCSSname+" .row"+B.$uniqueId,"marginRight","-"+g,null,B.oWin);B.$container.style.paddingRight=B.$head.style.paddingRight=g;}}};this.hide=function(){apf.setStyleRule("."+this.$baseCSSname+" .records ."+h.$className,"visibility","hidden",null,this.oWin);};this.show=function(){apf.setStyleRule("."+this.$baseCSSname+" .records ."+h.$className,"visibility","visible",null,this.oWin);};this.sort=function(b){if(b.$lastSorted==this){apf.setStyleClass(this.$int,b.toggleSortOrder()?"ascending":"descending",["descending","ascending"]);return;}var c;if(c=b.$lastSorted){apf.setStyleRule("."+c.$className,"background","white");apf.setStyleClass(c.$int,"",["descending","ascending"]);}apf.setStyleRule("."+this.$className,"background","#f3f3f3");apf.setStyleClass(this.$int,"ascending",["descending","ascending"]);if(!b.length){return;}b.resort({order:"ascending",xpath:this.cvalue2.xpaths[1]});b.$lastSorted=this;};this.move=function(d,j){if(d&&this==d){return;}var g=this,c=apf.getChildNumber(g.$int),k=d&&apf.getChildNumber(d.$int);j.$head.insertBefore(g.$int,d&&d.$int||null);if(!j.length){return;}(function b(m){for(var o,n=0;n<m.length;n++){o=m[n];if(j.$isTreeArch&&o.tagName=="BLOCKQUOTE"){b(o.childNodes);}else{o.insertBefore(o.childNodes[c],typeof k!="undefined"&&o.childNodes[k]||null);}}})(j.$container.childNodes);};this.$draw=function(j,d,m,k){var j=j||this.parentNode;while(j.$bindingRule){j=j.parentNode;}if(!j.hasFeature(apf.__PRESENTATION__)){return;}if(m){this.$propHandlers.width.call(this,m);}apf.importStylesheet([["."+this.$className,"width:"+this.$width+(this.$isPercentage?"%;":"px;")+"text-align:"+this.align]]);j.$getNewContext("headitem");var c=j.$getLayoutNode("headitem");c.setAttribute("class",this.$className+(k?" "+k:""));c.setAttribute("hid",this.$uniqueId);var g=j.$getLayoutNode("headitem","caption");g.nodeValue=this.caption||d||"";this.$ext=this.$int=apf.insertHtmlNode(c,j.$head||j.$container);var n=false;var b=this;this.$int.onmouseover=function(o){if(!o){o=event;}if(j.disabled){return;}apf.setStyleClass(this,"hover",["down"]);};this.$int.onmouseup=function(o){if(!o){o=event;}if(j.disabled||!apf.isChildOf(n,this,true)){return;}apf.setStyleClass(this,"hover",["down"]);if(b.$sortable){b.sort(j);}j.dispatchEvent("sortcolumn",b);};this.$int.onmousedown=function(s){if(!s){s=event;}n=target=this;if(j.disabled){return;}var A=apf.getAbsolutePosition(target),u=j.$head.scrollLeft;var w=s.clientX-A[0]+u;if(w<4||target.offsetWidth-w-8<3&&apf.getChildNumber(b.$int)<j.$headings.length-1){var D=w<4&&target.previousSibling||target;if(b.$resizable){A=apf.getAbsolutePosition(D);apf.setStyleClass(j.$pointer,"size_pointer",["move_pointer"]);j.$pointer.style.display="block";j.$pointer.style.left=(D.offsetLeft-u-1)+"px";j.$pointer.style.width=(D.offsetWidth-j.$widthdiff+1)+"px";apf.plane.show(j.$pointer,null,true);n=true;document.onmouseup=function(){if(!s){s=event;}document.onmouseup=document.onmousemove=null;apf.all[D.getAttribute("hid")].resize(j.$pointer.offsetWidth,j);n=false;j.$pointer.style.display="none";apf.plane.hide();};document.onmousemove=function(t){if(!t){t=event;}j.$pointer.style.width=Math.max(10,Math.min(j.$container.offsetWidth-j.$pointer.offsetLeft-20,t.clientX-A[0]-1+u))+"px";};return;}}apf.setStyleClass(target,"down",["hover"]);if(!b.$movable){document.onmouseup=function(t){document.onmouseup=null;n=false;};return;}apf.setStyleClass(j.$pointer,"move_pointer",["size_pointer"]);var C=s.clientX-target.offsetLeft,r=s.clientX,B=s.clientY-target.offsetTop,q=s.clientY,o;document.onmouseup=function(F){if(!F){F=event;}document.onmouseup=document.onmousemove=null;n=false;j.$pointer.style.display="none";if(!o){return;}o.style.top="-100px";var E=document.elementFromPoint(F.clientX,F.clientY);if(E.parentNode==o.parentNode){var G=apf.getAbsolutePosition(E);var t=(F.clientX-G[0]>E.offsetWidth/2?E.nextSibling:E);b.move(t?apf.all[t.getAttribute("hid")]:null,j);}apf.destroyHtmlNode(o);};document.onmousemove=function(F){if(!F){F=event;}if(!o){if(Math.abs(F.clientX-r)<3&&Math.abs(F.clientY-q)<3){return;}o=target.cloneNode(true);o.style.position="absolute";var E=apf.getWidthDiff(target);o.style.width=(target.offsetWidth-E-j.$widthdiff+2)+"px";o.style.left=target.offsetLeft;o.style.top=target.offsetTop;o.style.margin=0;o.removeAttribute("hid");apf.setStyleClass(o,"drag",["ascending","descending"]);target.parentNode.appendChild(o);}o.style.top="-100px";j.$pointer.style.display="none";var t=document.elementFromPoint(F.clientX,F.clientY);if(t.parentNode==o.parentNode){var G=apf.getAbsolutePosition(t);j.$pointer.style.left=(t.offsetLeft+((F.clientX-G[0]>t.offsetWidth/2)?t.offsetWidth-8:0))+"px";j.$pointer.style.display="block";}o.style.left=(F.clientX-C)+"px";o.style.top=(F.clientY-B)+"px";};};this.$int.onmouseout=function(o){if(!o){o=event;}if(j.disabled){return;}j.$ext.style.cursor="";apf.setStyleClass(this,"",["hover","down"]);};this.$int.onmousemove=function(r){if(n||j.disabled){return;}if(!r){r=event;}var u=apf.getAbsolutePosition(this),o=j.$head.scrollLeft;var s=r.clientX-u[0]+o;if(s<4||this.offsetWidth-s-j.$widthdiff<3&&apf.getChildNumber(b.$int)<j.$headings.length-1){var q=s<4?this.previousSibling:this;j.$ext.style.cursor=q&&b.$resizable?"w-resize":"default";}else{j.$ext.style.cursor="default";}};return this;};this.addEventListener("DOMNodeInsertedIntoDocument",function(b){this.$draw();});this.addEventListener("DOMNodeRemovedFromDocument",function(b){if(!this.$int){return;}this.$int.onmouseover=this.$int.onmouseup=this.$int.onmousedown=this.$int.onmousemove=this.$int.onmouseout=null;});}).call(apf.BindingColumnRule.prototype=new apf.BindingRule());apf.aml.setElement("column",apf.BindingColumnRule);apf.table=function(c,b){this.$init(b||"table",apf.NODE_VISIBLE,c);};(function(){this.$focussable=false;this.$update=false;this.columns="150,200";this.padding=2;this.$edge=[5,5,5,5];this.cellheight=19;this.$supportedProperties.push("columns","padding","edge","cellheight","span");this.$propHandlers.columns=function(s){if(!s.match(/^(\d+\%?\s*(?:,\s*|\s*$))+$/)){apf.console.warn("Invalid column string found for table: "+s);return;}var g,k=this.$columns=s.splitSafe(",");var r=0,q=this.$table.getElementsByTagName("col");if(q.length){for(var o,m=0,j=Math.min(q.length,k.length);m<j;m++){q[m].style.width=(o=k[m]).indexOf("%")>-1?o:o+"px";r+=parseInt(o);}}var d=q.length-k.length;if(d>0){for(var m=q.length-d;m<q.length;m++){q[m].parentNode.removeChild(q[m]);}}else{if(d<0){for(var m=k.length+d;m<k.length;m++){g=this.$table.appendChild(document.createElement("col"));g.style.width=(o=k[m]).indexOf("%")>-1?o:o+"px";g.setAttribute("valign","top");r+=parseInt(o);}}}this.$table.style.width=String(s).indexOf("%")>-1?"auto":(r+((k.length-1)*this.padding)+this.$edge[0]+this.$edge[2])+"px";var t=this.$tbody.firstChild.getElementsByTagName("td");for(var m=t.length-1;m>=0;m--){t[m].parentNode.removeChild(t[m]);}for(var n,m=0;m<k.length;m++){n=this.$tbody.firstChild.appendChild(document.createElement("td"));if(k[m].indexOf("%")>-1){n.appendChild(document.createElement("div")).style.width="50px";}}if(d&&this.$amlLoaded){b({sync:true,parentNode:this});}};this.$propHandlers.padding=function(q){var m=this.$table.getElementsByTagName("td");var j,o,g,d=this.$tbody.lastChild;for(var n=this.$columns.length,k=m.length;n<k;n++){j=(g=m[n]).parentNode.lastChild==g;o=g.parentNode==d;g.style.padding="0px "+(j?0:q)+"px "+(o?0:q)+"px 0px";}};this.$propHandlers.edge=function(d){this.$table.style.padding=(this.$edge=apf.getBox(d)).join("px ")+"px";};function b(G){var F=G.parentNode||this.parentNode;if(G.sync||G.value&&!this.$altExt||!G.value&&this.$altExt){var u=F.childNodes;var d=apf.getArrayFromNodelist(F.$tbody.getElementsByTagName("td"));var s=F.$tbody.getElementsByTagName("tr");var r=[],j=1,g,m,t=F.$columns.length;var o=F.$columns.length,A,D;for(var w,n,q,B=u.length,E=0;E<B;E++){if((w=u[E]).visible===false){continue;}n=w.$altExt=q=d[o++];if(!s[j]){F.$tbody.appendChild(document.createElement("tr"));}s[j].appendChild(n);n.appendChild(w.$ext);n.setAttribute("colspan",g=Math.min(t-(r[0]||0),parseInt(w.colspan||w.span||1)));n.setAttribute("rowspan",m=parseInt(w.rowspan||1));if(!r[0]){r[0]=0;}r[0]+=g;if(m>1){for(var C=1;C<m;C++){if(!r[C]){r[C]=0;}r[C]+=g;}}if(r[0]>=t){A=true;r.shift();j++;}else{A=false;}n.style.padding="0px "+(A?0:F.padding)+"px "+(E==B-1?0:F.padding)+"px 0px";}for(;o<d.length;o++){d[o].parentNode.removeChild(d[o]);}if(G.sync){return;}if(G.value){F.$addTd(u[B-1]);}else{this.$altExt=null;}}}this.$addTd=function(k){var g=this.$table.getElementsByTagName("td");var n=0;for(var d,j=0;j<g.length;j++){n+=1+(parseInt((d=g[j]).getAttribute("colspan")||1)-1)+(parseInt((d=g[j]).getAttribute("rowspan")||1)-1);}if(n%this.$columns.length==0){var o=this.$tbody.appendChild(document.createElement("tr"));}else{o=g[g.length-1].parentNode;}var m=o.appendChild(document.createElement("td"));m.style.position="relative";if(k.colspan||k.span){m.setAttribute("colspan",k.colspan||k.span);}if(k.rowspan){m.setAttribute("rowspan",k.rowspan);}m.appendChild(k.$ext);k.$altExt=m;};var c={width:function(d){this.$ext.style.width="";},height:function(d){this.$ext.style.height=d?Math.max(0,d-apf.getHeightDiff(this.$ext))+"px":"";},margin:function(d){this.$ext.style.margin=apf.getBox(d).join("px ")+"px";},colspan:function(d){if(!d){this.$altExt.removeAttribute("colspan");}else{this.$altExt.setAttribute("colspan",d);}b.call(this,{sync:true});},rowspan:function(d){if(!d){this.$altExt.removeAttribute("rowspan");}else{this.$altExt.setAttribute("rowspan",d);}b.call(this,{sync:true});},valign:function(d){this.$altExt.valign=d;},align:function(d){this.$altExt.align=d;}};c.span=c.colspan;this.register=function(d){if(d.$altExt){return;}d.$propHandlers.left=d.$propHandlers.top=d.$propHandlers.right=d.$propHandlers.bottom=apf.K;for(var g in c){d.$propHandlers[g]=c[g];}d.addEventListener("prop.visible",b);this.$addTd(d);if(d.margin){c.margin.call(d,d.margin);}if(d.$ext.tagName=="INPUT"){}else{d.$ext.style.width="auto";}if(this.lastChild==d){this.$propHandlers.padding.call(this,this.padding);}};this.unregister=function(d){d.$propHandlers.left=d.$propHandlers.top=d.$propHandlers.right=d.$propHandlers.bottom=null;for(var g in c){delete d.$propHandlers[g];}d.removeEventListener("prop.visible",b);b.call(d,{value:false});if(d.margin){d.$ext.style.margin="";}if(d.width){d.$ext.style.width="";}};this.addEventListener("DOMNodeRemoved",function(d){if(d.$doOnlyAdmin||d.currentTarget==this){return;}if(d.relatedNode==this){this.unregister(d.currentTarget);d.currentTarget.$setLayout();}});this.addEventListener("DOMNodeInserted",function(d){if(d.currentTarget==this||d.currentTarget.nodeType!=1){return;}if(d.relatedNode==this){if(d.$isMoveWithinParent){b.call(d.currentTarget,{sync:true});}else{d.currentTarget.$setLayout("table");if(d.currentTarget.nextSibling){b.call(d.currentTarget,{sync:true});}}}});this.$draw=function(){this.$pHtmlNode.insertAdjacentHTML("beforeend","<div><table cellSpacing='0' cellPadding='0'><tbody><tr class='first'></tr></tbody></table></div>");this.$ext=this.$pHtmlNode.lastChild;this.$table=this.$ext.firstChild;this.$tbody=this.$table.firstChild;this.$ext.className="table "+(this.getAttribute("class")||"");this.$int=this.$ext;this.$ext.host=this;if(this.getAttribute("class")){apf.setStyleClass(this.$ext,this.getAttribute("class"));}apf.layout.setRules(this.$ext,"table","apf.all["+this.$uniqueId+"].$resize()",true);apf.layout.queue(this.$ext);this.$originalMin=[this.minwidth||0,this.minheight||0];};this.$resize=function(){if(this.$table.offsetWidth>=this.$ext.offsetWidth){this.$ext.style.minWidth=(this.minwidth=Math.max(0,this.$table.offsetWidth-apf.getWidthDiff(this.$ext)))+"px";}else{this.$ext.style.minWidth="";this.minwidth=this.$originalMin[0];}if(this.$table.offsetHeight>=this.$ext.offsetHeight){this.$ext.style.minHeight=(this.minheight=Math.max(0,this.$table.offsetHeight-apf.getHeightDiff(this.$ext)))+"px";}else{this.$ext.style.minHeight="";this.minheight=this.$originalMin[1];}};this.$loadAml=function(d){this.$amlLoaded=false;if(!this.$columns){this.$propHandlers.columns.call(this,this.columns);}this.$amlLoaded=true;};}).call(apf.table.prototype=new apf.GuiElement());apf.aml.setElement("table",apf.table);apf["switch"]=function(c,b){this.$hasButtons=false;this.$init(b||"switch",apf.NODE_VISIBLE,c);};apf.pages=function(c,b){this.$hasButtons=false;this.$init(b||"pages",apf.NODE_VISIBLE,c);};apf.tab=function(c,b){this.$hasButtons=true;this.$init(b||"tab",apf.NODE_VISIBLE,c);};(function(){this.$focussable=apf.KEYBOARD;this.$draw=function(b){this.$ext=this.$getExternal();this.$loadChildren();};}).call(apf.tab.prototype=new apf.BaseTab());apf["switch"].prototype=apf.pages.prototype=apf.tab.prototype;apf.aml.setElement("switch",apf["switch"]);apf.aml.setElement("pages",apf.pages);apf.aml.setElement("tab",apf.tab);apf.aml.setElement("teleport",apf.AmlElement);apf.label=function(c,b){this.$init(b||"label",apf.NODE_VISIBLE,c);};(function(){this.implement(apf.DataAction,apf.ChildValue);var b=this;this.$focussable=false;var c;this.setValue=function(d){this.setProperty("value",d,false,true);};this.getValue=function(){return this.value;};this.$supportedProperties.push("caption","for","textalign");this.$propHandlers.caption=function(d){this.$caption.innerHTML=d;};this.$propHandlers["for"]=function(d){c=typeof d=="string"?self[d]:d;};this.$propHandlers.textalign=function(d){this.$caption.style.textAlign=d||"";};this.$draw=function(){this.$ext=this.$getExternal();this.$caption=this.$getLayoutNode("main","caption",this.$ext);if(this.$caption.nodeType!=1){this.$caption=this.$caption.parentNode;}this.$ext.onmousedown=function(){if(c&&c.$focussable&&c.focussable){c.focus();}};};this.$childProperty="caption";}).call(apf.label.prototype=new apf.BaseSimple());apf.aml.setElement("label",apf.label);apf.BindingLoadRule=function(c,b){this.$init(b,apf.NODE_HIDDEN,c);};(function(){this.$attrExcludePropBind=apf.extend({get:1},this.$attrExcludePropBind);this.$propHandlers.get=function(b,c){delete this["c"+c];};}).call(apf.BindingLoadRule.prototype=new apf.BindingRule());apf.aml.setElement("load",apf.BindingLoadRule);apf.aml.setElement("insert",apf.BindingLoadRule);apf.submit=function(c,b){this.$init(b||"submit",apf.NODE_VISIBLE,c);};apf.trigger=function(c,b){this.$init(b||"trigger",apf.NODE_VISIBLE,c);};apf.reset=function(c,b){this.$init(b||"reset",apf.NODE_VISIBLE,c);};apf.button=function(c,b){this.$init(b||"button",apf.NODE_VISIBLE,c);};(function(){this.$useExtraDiv;this.$childProperty="caption";this.$inited=false;this.$isLeechingSkin=false;this.$canLeechSkin=true;this.$focussable=true;this.value=null;this.$init(function(){var n,g=this;this.$propHandlers["default"]=function(o){if(!this.focussable&&o||n){this.setAttribute("focussable",n=o);}this.parentNode.removeEventListener("focus",m);this.parentNode.removeEventListener("blur",j);if(!o){return;}this.parentNode.addEventListener("focus",m);this.parentNode.addEventListener("blur",j);};function m(o){if(o.defaultButtonSet||o.returnValue===false){return;}o.defaultButtonSet=true;if(this.$useExtraDiv){g.$ext.appendChild(apf.button.$extradiv);}g.$setStyleClass(g.$ext,g.$baseCSSname+"Default");if(o.srcElement!=g&&g.$focusParent){g.$focusParent.addEventListener("keydown",k);}}function j(o){if(this.$useExtraDiv&&apf.button.$extradiv.parentNode==g.$ext){g.$ext.removeChild(apf.button.$extradiv);}g.$setStyleClass(g.$ext,"",[g.$baseCSSname+"Default"]);if(o.srcElement!=g&&g.$focusParent){g.$focusParent.removeEventListener("keydown",k);}}function k(q){var r;var o=apf.document.activeElement;if(o){if(o.hasFeature(apf.__MULTISELECT__)){return;}r=o.multiline;}if(!g.$ext.onmouseup){return;}if(r&&r!="optional"&&q.keyCode==13&&q.ctrlKey||(!r||r=="optional")&&q.keyCode==13&&!q.ctrlKey&&!q.shiftKey&&!q.altKey){g.$ext.onmouseup(q.htmlEvent,true);}}this.addEventListener("focus",m);this.addEventListener("blur",j);this.$enable=function(){if(this["default"]){m({});if(apf.document.activeElement){apf.document.activeElement.focus(true);}}if(this.state&&this.value){this.$setState("Down",{});}this.$doBgSwitch(1);};this.$disable=function(){if(this["default"]){j({});}this.$doBgSwitch(4);this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Over",this.$baseCSSname+"Down"]);};});this.$booleanProperties["default"]=true;this.$supportedProperties.push("icon","value","tooltip","state","color","caption","action","target","default","submenu","hotkye");this.$propHandlers.icon=function(g){if(!this.oIcon){return apf.console.warn("No icon defined in the Button skin","button");}if(g){this.$setStyleClass(this.$ext,this.$baseCSSname+"Icon");}else{this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Icon"]);}apf.skins.setIcon(this.oIcon,g,this.iconPath);};this.$propHandlers.value=function(g){if(!this.state&&!this.submenu){return;}if(g===undefined){g=!this.value;}this.value=g;if(this.value){this.$setState("Down",{});}else{this.$setState("Out",{});}};this.$propHandlers.state=function(g){this.$setStateBehaviour(g==1);};this.$propHandlers.color=function(g){if(this.oCaption){this.oCaption.parentNode.style.color=g;}};this.$propHandlers.caption=function(g){if(!this.oCaption){return;}if(g){this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Empty"]);}else{this.$setStyleClass(this.$ext,this.$baseCSSname+"Empty");}if(this.oCaption.nodeType==1){this.oCaption.innerHTML=String(g||"").trim();}else{this.oCaption.nodeValue=String(g||"").trim();}};this.$propHandlers.hotkey=function(j){if(this.$hotkey){apf.setNodeValue(this.$hotkey,j);}if(this.$lastHotkey){apf.removeHotkey(this.$lastHotkey);}if(j){this.$lastHotkey=j;var g=this;apf.registerHotkey(j,function(){g.$setState("Over",{});$setTimeout(function(){g.$setState("Out",{});},200);if(g.$clickHandler&&g.$clickHandler()){g.$updateState(e||event,"click");}else{g.dispatchEvent("click");}});}};function b(m){return;var g=m.keyCode;var j,k=apf.getChildNumber(this);if(g==37){j=k==0?this.parentNode.childNodes.length-1:k-1;this.parentNode.childNodes[j].dispatchEvent("mouseover");}else{if(g==39){j=(k>=this.parentNode.childNodes.length-1)?0:k+1;this.parentNode.childNodes[j].dispatchEvent("mouseover");}}}function d(g){var j=self[this.submenu];this.value=!this.value;if(this.value){this.$setState("Down",{});}if(!j){throw new Error(apf.formatErrorString(0,this,"Showing submenu","Could not find submenu '"+this.submenu+"'"));}if(!this.value){j.hide();this.$setState("Over",{},"toolbarover");this.parentNode.menuIsPressed=false;if(this.parentNode.hasMoved){this.value=false;}if(apf.hasFocusBug){apf.window.$focusfix();}return false;}this.parentNode.menuIsPressed=this;j.display(null,null,false,this,null,null,this.$ext.offsetWidth-2);this.parentNode.hasMoved=false;g.htmlEvent.cancelBubble=true;return false;}function c(){var j=this.parentNode.menuIsPressed;if(!j||j==this){return;}j.setValue(false);var g=self[j.submenu];g.$propHandlers.visible.call(g,false,true);this.setValue(true);this.parentNode.menuIsPressed=this;var k=self[this.submenu];if(!k){throw new Error(apf.formatErrorString(0,this,"Showing submenu","Could not find submenu '"+this.submenu+"'"));}var m=apf.getAbsolutePosition(this.$ext,k.$ext.offsetParent);k.display(m[0],m[1]+this.$ext.offsetHeight,true,this,null,null,this.$ext.offsetWidth-2);this.$focus();this.parentNode.hasMoved=true;return false;}this.$propHandlers.submenu=function(g){if(!g){if(this.value&&this.parentNode){d.call(this);}this.$focussable=true;this.$setNormalBehaviour();this.removeEventListener("mousedown",d);this.removeEventListener("mouseover",c);this.removeEventListener("keydown",b,true);return;}this.$focussable=false;this.$setStateBehaviour();this.addEventListener("mousedown",d);this.addEventListener("mouseover",c);this.addEventListener("keydown",b,true);};this.setValue=function(g){this.setProperty("value",g,false,true);};this.setCaption=function(g){this.setProperty("caption",g,false,true);};this.setIcon=function(g){this.setProperty("icon",g,false,true);};this.$setStateBehaviour=function(g){this.value=g||false;this.isBoolean=true;this.$setStyleClass(this.$ext,this.$baseCSSname+"Bool");if(this.value){this.$setStyleClass(this.$ext,this.$baseCSSname+"Down");this.$doBgSwitch(this.states.Down);}};this.$setNormalBehaviour=function(){this.value=null;this.isBoolean=false;this.$setStyleClass(this.$ext,"",[this.$baseCSSname+"Bool"]);};this.$setState=function(j,m,k){if(k&&this.dispatchEvent(k,{htmlEvent:m})===false){return;}this.$doBgSwitch(this.states[j]);var g=this.$baseCSSname;this.$setStyleClass(this.$ext,(j!="Out"?g+j:""),[(this.value?"":g+"Down"),g+"Over"]);if(this.submenu){g=this.$baseCSSname+"menu";this.$setStyleClass(this.$ext,(j!="Out"?g+j:""),[(this.value?"":g+"Down"),g+"Over"]);}};this.$clickHandler=function(){if(this.isBoolean&&!this.submenu){this.setProperty("value",!this.value);return true;}};this.$submenu=function(g,j){if(g){this.setValue(false);this.$setState("Out",{},"mouseout");this.parentNode.menuIsPressed=false;}};this.$draw=function(){var j,g=(j=this.parentNode).localName=="toolbar"||j.parentNode&&j.parentNode.localName=="toolbar";if(g){if(typeof this.focussable=="undefined"){this.focussable=false;}this.$focussable=apf.KEYBOARD;}this.$ext=this.$getExternal();this.oIcon=this.$getLayoutNode("main","icon",this.$ext);this.oCaption=this.$getLayoutNode("main","caption",this.$ext);this.$useExtraDiv=apf.isTrue(this.$getOption("main","extradiv"));if(!apf.button.$extradiv&&this.$useExtraDiv){(apf.button.$extradiv=document.createElement("div")).className="extradiv";}if(this.localName=="submit"){this.action="submit";}else{if(this.localName=="reset"){this.action="reset";}}this.$setupEvents();};}).call(apf.button.prototype=new apf.BaseButton());apf.submit.prototype=apf.trigger.prototype=apf.reset.prototype=apf.button.prototype;apf.aml.setElement("submit",apf.submit);apf.aml.setElement("trigger",apf.trigger);apf.aml.setElement("reset",apf.reset);apf.aml.setElement("button",apf.button);apf.smartbinding=function(c,b){this.$init(b||"smartbinding",apf.NODE_HIDDEN,c);this.$bindNodes={};};(function(){this.$supportedProperties=["bindings","actions","model"];this.$handlePropSet=function(j,d,c){switch(j){case"model":if(typeof d=="string"){d=apf.nameserver.get("model",d);}this.model=apf.nameserver.register("model",this.name,d);var b;for(var g in this.$bindNodes){b=this.$bindNodes[g];this.model.unregister(b);this.model.register(b,this.$modelXpath[b.getHost?b.getHost().$uniqueId:b.$uniqueId]||this.modelBaseXpath);}break;case"bindings":if(this.$bindings){this.remove(this.$bindings);}this.$bindings=typeof d=="object"?d:apf.nameserver.lookup("bindings",d);this.add(this.$bindings);break;case"actions":if(this.$actions){this.remove(this.$actions);}this.$actions=typeof d=="object"?d:apf.nameserver.lookup("actions",d);this.add(this.$actions);break;}this[j]=d;};this.add=function(c){for(var b in this.$bindNodes){c.register(this.$bindNodes[b]);}this["$"+c.localName]=c;};this.remove=function(c){for(var b in this.$bindNodes){c.unregister(this.$bindNodes[b]);}};this.register=function(b){this.$bindNodes[b.$uniqueId]=b;if(this.$bindings){this.$bindings.register(b);}if(this.$actions){this.$actions.register(b);}if(this.$model){this.$model.register(b);}};this.unregister=function(b){this.$bindNodes[b.$uniqueId]=null;delete this.$bindNodes[b.$uniqueId];if(this.$bindings){this.$bindings.unregister(b);}if(this.$actions){this.$actions.unregister(b);}if(this.$model){this.$model.unregister(b);}};this.load=function(b){new apf.model().register(this).load(b);};this.clear=function(b){};this.addEventListener("DOMNodeInsertedIntoDocument",function(b){if(this.parentNode.hasFeature(apf.__DATABINDING__)){this.register(this.parentNode);}apf.console.info(this.name?"Creating SmartBinding ["+this.name+"]":"Creating implicitly assigned SmartBinding");});}).call(apf.smartbinding.prototype=new apf.AmlElement());apf.aml.setElement("smartbinding",apf.smartbinding);var HAS_CHILD=1<<1,IS_CLOSED=1<<2,IS_LAST=1<<3,IS_ROOT=1<<4;apf.markupedit=function(c,b){this.$init(b||"markupedit",apf.NODE_VISIBLE,c);};(function(){this.implement(apf.DataAction,apf.Rename);this.$isTreeArch=true;this.$focussable=true;this.$preventRecursiveUpdate=true;this.$enableTextNodeHack=true;this.startcollapsed=true;this.$animType=0;this.$animSteps=3;this.$animSpeed=20;this.reselectable=true;this.prerender=false;this.each="node()[local-name(.) and not(@nomk = 'true')]";this.$dynCssClasses=[];this.expandAndSelect=function(s){if(!this.xmlRoot){return;}var r=this;if((function q(u){var t=r.getTraverseParent(u);if(!t||t!=r.xmlRoot&&q(t)===false){return false;}r.slideToggle(apf.xmldb.getHtmlNode(t,r),1,true);})(s)!==false){this.select(s);}};this.setAttributeValue=function(r,q,s){if(!r){r=this.caret||this.selected;}if(!r||r.getAttribute(q)==s){return;}this.$executeAction("setAttribute",[r,q,s],"setAttributeValue",r);};this.removeAttribute=function(r,q,s){if(!r){r=this.caret||this.selected;}if(!r||r.getAttribute(q)==s){return;}this.$executeAction("removeAttribute",[r,q],"removeAttribute",r);};this.renameAttribute=function(s,r,q){if(!s){s=this.caret||this.selected;}if(!s||r==q){return;}this.$executeAction("multicall",[{func:"removeAttribute",args:[s,r]},{func:"setAttribute",args:[s,q,s.getAttribute(r)]}],"renameAttribute",s);};this.setTextNode=function(q,r){if(!q){q=this.caret||this.selected;}if(!q||apf.queryValue(q,"text()")==r){return;}this.$executeAction("setTextNode",[q,r],"setTextNode",q);};this.slideToggle=function(u,t,r){if(this.nocollapse){return;}if(!u){u=this.$selected;}var w=u.getAttribute(apf.xmldb.htmlIdTag);while(!w&&u.parentNode){var w=(u=u.parentNode).getAttribute(apf.xmldb.htmlIdTag);}var s,q=this.$getLayoutNode("item","container",u);if(apf.getStyle(q,"display")=="block"){if(t==1){return;}s=this.$getLayoutNode("item","openclose",u);s.className=s.className.replace(/min/,"plus");u.className=u.className.replace(/min/,"plus");this.slideClose(q,apf.xmldb.getNode(u),r);}else{if(t==2){return;}s=this.$getLayoutNode("item","openclose",u);s.className=s.className.replace(/plus/,"min");u.className=u.className.replace(/plus/,"min");this.slideOpen(q,apf.xmldb.getNode(u),r);}};this.isCollapsed=function(q){return(apf.getStyle(this.$getLayoutNode("item","container",apf.xmldb.getHtmlNode(q,this)),"display")=="none");};var d={};this.slideOpen=function(r,u,s){if(!u){u=this.selected;}var w=apf.xmldb.findHtmlNode(u,this);if(!r){r=this.$findContainer(w);}if(!r.innerHTML&&!this.getTraverseNodes(u).length){return;}if(this.singleopen){var t=this.getTraverseParent(u),A=(t||this.xmlRoot).getAttribute(apf.xmldb.xmlIdTag);if(d[A]&&d[A][1]!=u&&this.getTraverseParent(d[A][1])==t){this.slideToggle(d[A][0],2);}d[A]=[w,u];}r.style.display="block";if(!this.prerender&&this.$hasLoadStatus(u,"potential")){this.$extend(u,r,s);return;}if(s){r.style.height="auto";return;}var q=this;apf.tween.single(r,{type:"scrollheight",from:0,to:r.scrollHeight,anim:this.$animType,steps:this.$animOpenStep,interval:this.$animSpeed,onfinish:function(B){if(u&&q.$hasLoadStatus(u,"potential")){$setTimeout(function(){q.$extend(u,B);});B.style.height="auto";}else{B.style.height="auto";}}});};this.slideClose=function(q,r){if(this.nocollapse){return;}if(!r){r=this.selected;}if(this.singleopen){var s=(this.getTraverseParent(r)||this.xmlRoot).getAttribute(apf.xmldb.xmlIdTag);d[s]=null;}q.style.height=q.offsetHeight;q.style.overflow="hidden";apf.tween.single(q,{type:"scrollheight",from:q.scrollHeight,to:0,anim:this.$animType,steps:this.$animCloseStep,interval:this.$animSpeed,onfinish:function(t,u){t.style.display="none";}});};this.doUpdate=function(s,r){var w=this.$getBindRule("insert",s);var u=w&&w[1]?w[1](s):null;if(w&&u){this.$setLoadStatus(s,"loading");if(w.getAttribute("get")){this.getModel().$insertFrom(w.getAttribute("get"),{xmlNode:u,insertPoint:u,amlNode:this});}else{var t=this.$applyBindRule("Insert",s);if(t){this.insert(t,{insertPoint:u});}}}else{if(!this.prerender){this.$setLoadStatus(s,"loading");var q=this.$addNodes(s,r,true);c.call(this,"insert",s,q);}}};var k={};k[0]="";k[HAS_CHILD]="min";k[HAS_CHILD|IS_CLOSED]="plus";k[IS_LAST]="last";k[IS_LAST|HAS_CHILD]="minlast";k[IS_LAST|HAS_CHILD|IS_CLOSED]="pluslast";k[IS_ROOT]="root";this.fixItem=function(E,C,B,D,t){if(!C){return;}if(B){var u;if(u=this.getNextTraverse(E,true)){this.fixItem(u,this.$findHtmlNode(u.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId),null,true);}if(!this.emptyMessage&&E.parentNode.selectNodes(this.each).length==1){this.fixItem(E.parentNode,this.$findHtmlNode(E.parentNode.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId),null,false,true);}}else{var A,r=this.$getLayoutNode("item","container",C);if(t){A=false;}else{if(E.selectNodes(this.each).length>0){A=true;}else{if(this.$getBindRule("insert",E)){A=true;}else{A=false;}}}var s=A&&r.style.display!="block";var w=this.getNextTraverse(E,null,D?2:1)?false:true;var q=(A?HAS_CHILD:0)|(s?IS_CLOSED:0)|(w?IS_LAST:0);this.$setStyleClass(this.$getLayoutNode("item","openclose",C),k[q],["min","plus","last","minlast","pluslast"]);this.$setStyleClass(this.$getLayoutNode("item",null,C),k[q],["min","plus","last","minlast","pluslast"]);if(!A){r.style.display="none";}if(q&HAS_CHILD){}}};this.startRenameThis=function(w,r,u,A){if(this.renaming){this.stopRename(null,true);var q=this;return setTimeout(function(){q.startRenameThis(w,r,u);});}this.$getCaptionElement=function(){return w;};var t=w.getAttribute("aname");var s=A?b[A]:apf.xmldb.getNodeById(r);if(!s){throw new Error();}this.$multiLineRename=A&&s.nodeType!=3?true:false;this.$getCaptionXml=function(){return s.nodeType!=1?s:(t?s.getAttributeNode(t):s.firstChild);};this.getSelectFromRule=function(B,C){return[null,s.nodeType!=1?s:(t?s.getAttributeNode(t):s.firstChild)];};this.$validateRename=function(B){return !u||!B||B.match(/^[a-z]/i);};this.rename=function(B,C){this.$noanim=true;if(t){if(u){if(C==""){this.removeAttribute(s,t);}else{this.renameAttribute(s,t,C);}}else{this.setAttributeValue(s,t,C);}}else{this.setTextNode(s,C);}this.$noanim=false;};this.startRename();if(u){this.$txt[apf.hasContentEditable?"innerHTML":"value"]=t;this.$txt.className="";}else{this.$txt.className="attrvalue";}apf.selectTextHtml(this.$txt);};function o(s,r,w,u,q){this.$getNewContext("attribute");var A=this.$getLayoutNode("attribute","name");var t=this.$getLayoutNode("attribute","value");apf.setNodeValue(A,r);apf.setNodeValue(t,(w.length>50?"...":w));if(w.length>50){t.setAttribute("title",w);}A.setAttribute("aname",r);A.setAttribute("onmousedown","if ((event.which || event.button) == 1)            apf.lookup("+this.$uniqueId+").startRenameThis(this, '"+q+"', true);            event.cancelBubble=true;");A.setAttribute("onmouseup","            event.cancelBubble=true;            return false;");A.setAttribute("onkeydown","if (event.keyCode==13) {              this.blur();              return false;            };            event.cancelBubble=true;");A.setAttribute("onselectstart","event.cancelBubble = true;");A.setAttribute("ondblclick","event.cancelBubble = true;");t.setAttribute("aname",r);t.setAttribute("onmousedown","if ((event.which || event.button) == 1)            apf.lookup("+this.$uniqueId+").startRenameThis(this, '"+q+"');            event.cancelBubble=true;");t.setAttribute("onmouseup","            event.cancelBubble=true;            return false;");t.setAttribute("onkeydown","if (event.keyCode==13) {              this.blur();              return false;            };            event.cancelBubble=true;");t.setAttribute("onselectstart","event.cancelBubble = true;");t.setAttribute("ondblclick","event.cancelBubble = true;");if(s.style){this.$setStyleClass(this.$getLayoutNode("attribute"),"generated");u=apf.insertHtmlNode(this.$getLayoutNode("attribute"),s,this.$getLayoutNode("item","begintag",u).nextSibling);if(!this.$noanim){j(u);j(this.$getLayoutNode("attribute","name",u));j(this.$getLayoutNode("attribute","value",u));}}else{s.appendChild(this.$getLayoutNode("attribute"));}}function m(s,u,r){this.$getNewContext("textnode");var w=this.$getLayoutNode("textnode","text");var q=this.$getLayoutNode("textnode","tag");apf.setNodeValue(w,(u.length>50?"...":u));if(u.length>50){w.setAttribute("title",u);}w.setAttribute("onmousedown","if ((event.which || event.button) == 1)            apf.lookup("+this.$uniqueId+").startRenameThis(this, '"+r+"');");w.setAttribute("onmouseup","            event.cancelBubble=true;            return false;");w.setAttribute("onkeydown","if (event.keyCode==13) {              this.blur();              return false;            };            event.cancelBubble=true;");w.setAttribute("onselectstart","event.cancelBubble = true;");w.setAttribute("ondblclick","event.cancelBubble = true;");apf.setNodeValue(q,"&gt;");if(s.style){var t=apf.insertHtmlNode(this.$getLayoutNode("textnode"),s,s.lastChild);if(!this.$noanim){j(this.$getLayoutNode("textnode","text",t));}}else{s.appendChild(this.$getLayoutNode("textnode"));}}this.$initNode=function(E,q,D){this.$getNewContext("item");var A=(q&HAS_CHILD||this.emptyMessage&&this.$applyBindRule("empty",E));var G=this.$getLayoutNode("item");G.setAttribute(apf.xmldb.htmlIdTag,D);this.$setStyleClass(this.$getLayoutNode("item","openclose"),k[q]);this.$setStyleClass(this.$getLayoutNode("item"),k[q]);var s=this.$getLayoutNode("item","openclose");if(A){s.setAttribute(this.opencloseaction||"onmousedown","var o = apf.lookup("+this.$uniqueId+");                o.slideToggle(this);                apf.cancelBubble(event,o);");}var t=this.$getLayoutNode("item","select");if(A){var F="var o = apf.lookup("+this.$uniqueId+");                o.slideToggle(this, true);";}t.setAttribute("onmousedown","var o = apf.lookup("+this.$uniqueId+");            apf.cancelBubble(event, o);            if (o.hasFocus())                 o.select(this);"+(F&&this.opencloseaction=="onmousedown"?F:""));var J=this.$getLayoutNode("item","begintag");apf.setNodeValue(J,"&lt;"+E.tagName);var r=this.$getLayoutNode("item","attributes");var B=E.attributes.length;if(typeof B=="function"){B=E.attributes.length();}for(var w=0;w<B;w++){var C=E.attributes.item(w);if(C.nodeName.match(/a_id|a_listen|a_doc|a_loaded/)){continue;}o.call(this,r,C.nodeName,C.nodeValue,null,D);}var H=this.$getLayoutNode("item","begintail");var u=this.$getLayoutNode("item","endtag");if(!(q&HAS_CHILD)){u.setAttribute("style","display:none");if(this.$enableTextNodeHack&&(E.childNodes.length>1||E.childNodes.length==1&&E.firstChild.nodeValue.trim())){m.call(this,r,E.childNodes[0].nodeValue,D);apf.setNodeValue(H,"&lt;/"+E.tagName+"&gt;");}else{apf.setNodeValue(H," /&gt;");}}else{apf.setNodeValue(u,"&lt;/"+E.tagName+"&gt;");apf.setNodeValue(H,"&gt;");}H.parentNode.appendChild(H);u.setAttribute("onmousedown","var o = apf.lookup("+this.$uniqueId+");apf.cancelBubble(event, o);");var I=this.$applyBindRule("css",E);if(I){this.$setStyleClass(this.$getLayoutNode("item",null,this.$getLayoutNode("item")),I);if(I){this.$dynCssClasses.push(I);}}return this.$getLayoutNode("item");};this.$deInitNode=function(r,t){var q=this.$getLayoutNode("item","container",t);var s=t.parentNode;q.parentNode.removeChild(q);s.removeChild(t);if(r.parentNode!=this.xmlRoot){this.fixItem(r,t,true);}if(this.emptyMessage&&!s.childNodes.length){this.setEmpty(s);}this.fixItem(r,t,true);if(r==this.selected){this.clearSelection();}};function j(q){if(!q.offsetHeight){return;}apf.setStyleClass(q,"highlight");$setTimeout(function(){apf.setStyleClass(q,"",["highlight"]);},1000);}this.$updateNode=function(q,t){var I,H,A={};var K=this.$getLayoutNode("item","attributes",t);var J=this.$getLayoutNode("item","endtag",t);var L=this.$getLayoutNode("item","begintail",t);I=q.attributes.length;for(var H=0;H<I;H++){var E=q.attributes.item(H);if(E.nodeName.match(/a_id|a_listen|a_doc|a_loaded/)){continue;}A[E.nodeName]=E.nodeValue;}var C=false;var s=[];var D=[],G=K.childNodes;for(H=0;H<G.length;H++){D.push(G[H]);}for(H=0;H<D.length;H++){if(D[H].nodeType!=1){continue;}if(D[H].className.indexOf("textnode")>-1){if(q.childNodes.length==1&&q.childNodes[0].nodeType==3){var F=this.$getLayoutNode("textnode","text",D[H]);if(q.firstChild.nodeValue!=F.innerHTML){F.innerHTML=q.firstChild.nodeValue;j(F);}}else{D[H].parentNode.removeChild(D[H]);apf.setNodeValue(L," /&gt;");}C=true;}if(D[H].className.indexOf("attribute")==-1){continue;}var r=this.$getLayoutNode("attribute","name",D[H]);var B=this.$getLayoutNode("attribute","value",D[H]);var M=r.innerHTML;if(!A[M]){s.push(D[H]);}else{if(A[M]!=B.innerHTML){B.innerHTML=A[M];j(B);delete A[M];}else{if(A[M]){delete A[M];}}}r.setAttribute("aname",M);B.setAttribute("aname",M);}for(var E in A){if(s.length){var w=s.pop();var r=this.$getLayoutNode("attribute","name",w);var B=this.$getLayoutNode("attribute","value",w);r.setAttribute("aname",E);B.setAttribute("aname",E);r.innerHTML=E;B.innerHTML=A[E];j(r);}else{o.call(this,K,E,A[E],t,q.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId);}}for(var H=0;H<s.length;H++){s[H].parentNode.removeChild(s[H]);}if(this.$enableTextNodeHack&&!C&&q.childNodes.length==1&&q.childNodes[0].nodeType==3){m.call(this,K,q.childNodes[0].nodeValue);apf.setNodeValue(L,"</"+q.tagName+">");}var u=this.$applyBindRule("css",q);if(u||this.$dynCssClasses.length){this.$setStyleClass(t,u,this.$dynCssClasses);if(u&&!this.$dynCssClasses.contains(u)){this.$dynCssClasses.push(u);}}};this.clearEmpty=function(q){q.innerHTML="";};this.setEmpty=function(q){this.$getNewContext("empty");var r=this.$getLayoutNode("empty");this.$getLayoutNode("empty","caption").nodeValue=this.emptyMessage;apf.insertHtmlNode(r,q);if(!this.startcollapsed){if(q.style){}}};this.$setLoading=function(r,q){this.$getNewContext("loading");this.$setLoadStatus(r,"potential");apf.insertHtmlNode(this.$getLayoutNode("loading"),q);};this.$removeLoading=function(q){if(!q){return;}this.$getLayoutNode("item","container",q).innerHTML="";};this.$extend=function(s,q,r){var u=this.$getBindRule("insert",s),t=u&&u.match?(u.cmatch||u.compile("match"))(s):s;if(u&&t){this.$setLoadStatus(s,"loading");if(u.get){this.getModel().$insertFrom(u.getAttribute("get"),{xmlNode:t,insertPoint:t,amlNode:this});}else{if(this.$applyBindRule("insert",s)){this.insert(data,{insertPoint:t});}}}else{if(!this.prerender){this.$setLoadStatus(s,"loading");this.$removeLoading(apf.xmldb.findHtmlNode(s,this));this.$noanim=true;c.call(this,{action:"insert",xmlNode:s,result:this.$addNodes(s,q,true),anim:!r});delete this.$noanim;}}};function c(s){if(s.action=="move-away"){this.fixItem(s.xmlNode,apf.xmldb.findHtmlNode(s.xmlNode,this),true);}if(s.action!="insert"){return;}var r=this.$findHtmlNode(s.xmlNode.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId);if(!r){return;}if(this.$hasLoadStatus(s.xmlNode,"loading")&&s.result.length>0){var q=this.$getLayoutNode("item","container",r);this.slideOpen(q,s.xmlNode);}else{this.fixItem(s.xmlNode,r);}if(this.$hasLoadStatus(s.xmlNode,"loading")){this.$setLoadStatus(s.xmlNode,"loaded");}}this.addEventListener("xmlupdate",c);this.addEventListener("beforeload",function(q){this.$enableTextNodeHack=!q.xmlNode.$regbase;this.each=q.xmlNode.$regbase?"node()[not(@nomk = 'true')]":"node()[local-name(.) and not(@nomk = 'true')]";});this.addEventListener("keydown",function(B){var G=B.keyCode;var s=B.ctrlKey;var D=B.shiftKey;var C=this.$caret||this.$selected;if(!C||this.renaming){return;}var E=this.caret||this.selected;var t=this.$ext;switch(G){case 13:if(this.$tempsel){this.$selectTemp();}if(this.ctrlselect=="enter"){this.select(this.caret,true);}this.choose(C);break;case 32:if(s){this.select(this.caret,true);}break;case 46:if(this.$tempsel){this.$selectTemp();}this.remove(this.mode?this.caret:null);break;case 109:case 37:if(this.$tempsel){this.$selectTemp();}if(this.caret.selectSingleNode(this.each)){this.slideToggle(this.$caret||this.$selected,2);}break;case 107:case 39:if(this.$tempsel){this.$selectTemp();}if(this.caret.selectSingleNode(this.each)){this.slideToggle(this.$caret||this.$selected,1);}break;case 187:if(D){arguments.callee(39);}break;case 189:if(!D){arguments.callee(37);}break;case 38:if(!E&&!this.$tempsel){return;}var u=this.$tempsel?apf.xmldb.getNode(this.$tempsel):E;var A=this.getNextTraverse(u,true);if(A){var r=this.getTraverseNodes(A);do{var q=this.$getLayoutNode("item","container",this.$findHtmlNode(apf.xmldb.getID(A,this)));if(q&&apf.getStyle(q,"display")=="block"&&r.length){A=r[r.length-1];}else{break;}}while(A&&(r=this.getTraverseNodes(A)).length);}else{if(this.getTraverseParent(u)==this.xmlRoot){this.dispatchEvent("selecttop");return;}else{A=this.getTraverseParent(u);}}if(A&&A.nodeType==1){this.$setTempSelected(A,s,D);}if(this.$tempsel&&this.$tempsel.offsetTop<t.scrollTop){t.scrollTop=this.$tempsel.offsetTop;}return false;break;case 40:if(!E&&!this.$tempsel){return;}var u=this.$tempsel?apf.xmldb.getNode(this.$tempsel):E;var A=this.getFirstTraverseNode(u);if(A){var q=this.$getLayoutNode("item","container",this.$findHtmlNode(apf.xmldb.getID(u,this)));if(q&&apf.getStyle(q,"display")!="block"){A=null;}}while(!A){var F=this.getTraverseParent(u);if(!F){break;}var w=0;var r=this.getTraverseNodes(F);while(r[w]&&r[w]!=u){w++;}A=r[w+1];u=F;}if(A&&A.nodeType==1){this.$setTempSelected(A,s,D);}if(this.$tempsel&&this.$tempsel.offsetTop+this.$tempsel.offsetHeight>t.scrollTop+t.offsetHeight){t.scrollTop=this.$tempsel.offsetTop-t.offsetHeight+this.$tempsel.offsetHeight+10;}return false;break;case 33:break;case 34:break;case 36:break;case 35:break;}},true);var g=[];this.$add=function(K,D,F,L,G,B){var E=this.$getBindRule("insert",K)?true:false,J=this.getTraverseNodes(K),A=J.length?true:false,C=E||A,u=this.$hasBindRule("collapsed")?(this.$getDataNode("collapsed",K)?true:false):(this.$hasBindRule("expanded")?(this.$getDataNode("expanded",K)?false:true):this.startcollapsed),t=(C?HAS_CHILD:0)|(u&&C||E?IS_CLOSED:0)|(B?IS_LAST:0),I=this.$initNode(K,t,D),s=this.$getLayoutNode("item","container"),w;if(!u&&!this.nocollapse){s.setAttribute("style","overflow:visible;height:auto;display:block;");}if(!C||E){s.setAttribute("style","display:none;");}if(!this.prerender){w=J.length;}if(C&&!this.prerender&&w>0&&u||E&&(!this.$hasLoadStatus(K)||this.$hasLoadStatus(K,"potential"))){this.$setLoading(K,s);}else{if(!A&&(msg=this.$applyBindRule("empty",K))){this.setEmpty(s);}}if(!L&&(F==this.xmlRoot||K==this.xmlRoot)){g.push(I);if(!apf.isChildOf(I,s,true)){g.push(s);}this.$setStyleClass(I,"root");this.$setStyleClass(s,"root");}else{if(!L){L=apf.xmldb.findHtmlNode(K.parentNode,this);L=L?this.$getLayoutNode("item","container",L):this.$container;}if(L==this.$container){this.$setStyleClass(I,"root");this.$setStyleClass(s,"root");if(this.renderRoot){var H=apf.xmldb.findHtmlNode(this.xmlRoot,this);L=this.$getLayoutNode("item","container",H);}}if(!G&&this.getNextTraverse(K)){G=apf.xmldb.findHtmlNode(this.getNextTraverse(K),this);}if(G&&G.parentNode!=L){G=null;}if(L.style&&this.getTraverseNodes(K.parentNode).length==1){this.clearEmpty(L);}if(L.style){var r=apf.insertHtmlNode(I,L,G);if(!this.$noanim){j(this.$getLayoutNode("item","select",r));}if(!apf.isChildOf(I,s,true)){var s=apf.insertHtmlNode(s,L,G);}}else{L.insertBefore(I,G);if(!apf.isChildOf(L,s,true)){L.insertBefore(s,G);}}if(L.style){if(!u&&this.openOnAdd&&L!=this.$container&&L.style.display!="block"){this.slideOpen(L,F);}this.fixItem(F,apf.xmldb.findHtmlNode(F,this));if(this.getNextTraverse(K,true)){this.fixItem(this.getNextTraverse(K,true),apf.xmldb.findHtmlNode(this.getNextTraverse(K,true),this));}}}if(this.prerender||w<1||!u){this.$addNodes(K,s,false);}return s;};this.$fill=function(){var q;apf.insertHtmlNodes(g,q||this.$container);g.length=0;};var n={};n[3]="textnode";n[4]="cdata";n[7]="procinstr";n[8]="comment";var b=[null];this.$addNonElement=function(E,F,s,w,t){if(!E.$regbase){return;}if(s){C=false;}if(C){return;}if(E.nodeType==3){this.$getNewContext("textnode");var r=this.$getLayoutNode("textnode");var q=this.$getLayoutNode("textnode","text");}else{this.$getNewContext("anynode");var r=this.$getLayoutNode("anynode");var u=this.$getLayoutNode("anynode","tagstart");var A=this.$getLayoutNode("anynode","tagend");switch(E.nodeType){case 4:apf.setNodeValue(u,"&lt;![CDATA[");apf.setNodeValue(A,"]]&gt;");break;case 7:apf.setNodeValue(u,"&lt;?"+E.target);apf.setNodeValue(A,"?&gt;");break;case 8:apf.setNodeValue(u,"&lt;!--");apf.setNodeValue(A,"--&gt;");break;default:return;}this.$getLayoutNode("anynode","openclose").setAttribute("onmousedown","var o = this.parentNode;                 apf.setStyleClass(o, o.className.indexOf('open') > -1 ? '' : 'open', ['open']);");var q=this.$getLayoutNode("anynode","text");}var D=E.nodeValue;if(D.trim().indexOf("\n")>-1){D=(E.nodeValue=apf.removeStartWhitespaces(D.replace(/^ *\n/,"").replace(/\n *$/,""))).replace(/</g,"&lt;").replace(/\n/g,"<br />");}else{D=D.trim().replace(/</g,"&lt;");}apf.setNodeValue(q,D);this.$setStyleClass(r,n[E.nodeType],"");var B=E.parentNode.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId;q.setAttribute("onmousedown","apf.lookup("+this.$uniqueId+").startRenameThis(this, '"+B+"', false, "+(b.push(E)-1)+");");q.setAttribute("onmouseup","            event.cancelBubble=true;            return false;");q.setAttribute("onkeydown","if (event.keyCode==13) {              this.blur();              return false;            };            event.cancelBubble=true;");q.setAttribute("onselectstart","event.cancelBubble = true;");q.setAttribute("ondblclick","event.cancelBubble = true;");if(F.style){var C=apf.insertHtmlNode(r,F);}else{F.appendChild(r);}};this.$getParentNode=function(q){return q?this.$getLayoutNode("item","container",q):this.$container;};this.$calcSelectRange=function(r,q){return[r,q];};this.$findContainer=function(q){return this.$getLayoutNode("item","container",q);};this.multiselect=false;this.$selectDefault=function(s){if(this.select(this.getFirstTraverseNode(s),null,null,null,true)){return true;}else{var q=this.getTraverseNodes(s);for(var r=0;r<q.length;r++){if(this.$selectDefault(q[r])){return true;}}}};this.$select=function(q){if(!q||!q.style){return;}this.$setStyleClass(this.$getLayoutNode("item","class",q),"selected");return q;};this.$deselect=function(q){if(!q){return;}this.$setStyleClass(this.$getLayoutNode("item","class",q),"",["selected","indicate"]);return q;};this.$indicate=function(q){if(!q){return;}this.$setStyleClass(this.$getLayoutNode("item","class",q),"indicate");return q;};this.$deindicate=function(q){if(!q){return;}this.$setStyleClass(this.$getLayoutNode("item","class",q),"",["indicate"]);return q;};this.$draw=function(){this.$ext=this.$getExternal();this.$container=this.$getLayoutNode("main","container",this.$ext);this.opencloseaction=this.$getOption("Main","openclose");this.$ext.onclick=function(r){this.host.dispatchEvent("click",{htmlEvent:r||event});};var q=this;this.$ext.onmouseover=function(r){q.dispatchEvent("mouseover",{htmlEvent:r||event});};this.$ext.onmouseout=function(r){q.dispatchEvent("mouseover",{htmlEvent:r||event});};};this.$loadAml=function(q){this.openOnAdd=!apf.isFalse(q.getAttribute("openonadd"));this.startcollapsed=!apf.isFalse(this.getAttribute("startcollapsed")||this.$getOption("Main","startcollapsed"));this.nocollapse=apf.isTrue(this.getAttribute("nocollapse"));if(this.nocollapse){this.startcollapsed=false;}this.singleopen=apf.isTrue(this.getAttribute("singleopen"));};this.$destroy=function(){if(!this.$ext){apf.console.error("destroy is called more than once for markupedit");return;}this.$ext.onclick=null;apf.destroyHtmlNode(this.oDrag);this.oDrag=null;};}).call(apf.markupedit.prototype=new apf.MultiSelect());apf.aml.setElement("markupedit",apf.markupedit);apf.BindingEachRule=function(d,c){this.$init(c,apf.NODE_HIDDEN,d);var b=this;this.$noderegister=function(g){g.amlNode.$handleBindingRule(b.match,"each");g.amlNode.$sort=b.sort?new apf.Sort(b):null;};};(function(){this.$attrExcludePropBind=apf.extend({sort:1,"data-type":1,"date-format":1,"sort-method":1,order:1,"case-order":1},this.$attrExcludePropBind);this.$booleanProperties.animate=true;this.$propHandlers.sort=this.$propHandlers["data-type"]=this.$propHandlers["date-format"]=this.$propHandlers.order=this.$propHandlers["case-order"]=function(c,d){delete this["c"+d];};this.addEventListener("prop.match",function(k){var j=this.parentNode;if(j.localName=="bindings"){var d=j.$amlNodes,g=0,c=d.length;for(;g<c;++g){d[g].$handleBindingRule(this.match,"each");}}else{j.$handleBindingRule(this.match,"each");}});var b;this.addEventListener("DOMNodeInserted",b=function(k){if(k.currentTarget!=this){return;}var j=this.parentNode;if(j.localName=="bindings"){j.addEventListener("noderegister",this.$noderegister);var d=j.$amlNodes,g=0,c=d.length;for(;g<c;++g){d[g].$handleBindingRule(this.match,"each");d[g].$sort=this.sort?new apf.Sort(this):null;}}else{j.$handleBindingRule(this.match,"each");j.$sort=this.sort?new apf.Sort(this):null;}});this.addEventListener("DOMNodeRemoved",function(k){if(k.currentTarget!=this){return;}var j=this.parentNode;if(j.localName=="bindings"){j.removeEventListener("noderegister",this.$noderegister);var d=j.$amlNodes,g=0,c=d.length;for(;g<c;++g){delete d[g].$sort;}}else{delete j.$sort;}});this.addEventListener("DOMNodeInsertedIntoDocument",b);}).call(apf.BindingEachRule.prototype=new apf.BindingRule());apf.aml.setElement("each",apf.BindingEachRule);apf.text=function(c,b){this.$init(b||"text",apf.NODE_VISIBLE,c);};(function(){this.implement(apf.ChildValue);this.$focussable=true;this.focussable=false;this.$allowSelect=true;this.$hasStateMessages=true;this.$textTimer=this.$lastMsg=this.$lastClass=this.$changedHeight=null;this.$booleanProperties.scrolldown=true;this.$booleanProperties.secure=true;this.$supportedProperties.push("behavior","scrolldown","secure","value");this.$propHandlers.behavior=function(b){this.addOnly=b=="addonly";};this.$propHandlers.value=function(c){var b=false;if(typeof c!="string"){if(c.nodeType){c=c.nodeType>1&&c.nodeType<5?c.nodeValue:c.firstChild&&c.firstChild.nodeValue||"";}else{c=c?c.toString():"";}}if(this.secure){c=c.replace(/<a /gi,"<a target='_blank' ").replace(/<object.*?\/object>/g,"").replace(/<script.*?\/script>/g,"").replace(new RegExp("ondblclick|onclick|onmouseover|onmouseout|onmousedown|onmousemove|onkeypress|onkeydown|onkeyup|onchange|onpropertychange","g"),"ona");}if(this.addOnly){this.$container.insertAdjacentHTML("beforeend",c);}else{c=c.replace(/\<\?xml version="1\.0" encoding="UTF-16"\?\>/,"");this.$container.innerHTML=c;}if(apf.cannotSizeIframe&&this.oIframe){this.oIframe.style.width=this.oIframe.offsetWidth+"px";}if(this.scrolldown&&this.$scrolldown){this.oScroll.scrollTop=this.oScroll.scrollHeight;}};this.$propHandlers["empty-message"]=function(b){if(!this.childNodes.length){this.$setClearMessage(this["empty-message"]);}};this.setValue=function(b){this.setProperty("value",b,false,true);};this.getValue=function(){return this.$container.innerHTML;};this.addEventListener("keydown",function(c){var b=c.keyCode;switch(b){case 33:this.$container.scrollTop-=this.$container.offsetHeight;break;case 34:this.$container.scrollTop+=this.$container.offsetHeight;break;case 35:this.$container.scrollTop=this.$container.scrollHeight;break;case 36:this.$container.scrollTop=0;break;case 38:this.$container.scrollTop-=10;break;case 40:this.$container.scrollTop+=10;break;default:return;}return false;},true);this.$xmlUpdate=function(j,c,g,d){if(this.addOnly&&j!="add"){return;}if(d){d.xmlNode=this.addOnly?c:this.xmlRoot;}if(this.addOnly){apf.xmldb.nodeConnect(this.documentId,c,null,this);var b=this.$findHtmlNode(g.getAttribute("id")+"|"+this.$uniqueId);this.$propHandlers.value.call(this,this.$applyBindRule("value",c)||"");}else{this.$propHandlers.value.call(this,this.$applyBindRule("value",this.xmlRoot)||"");}};this.$load=function(c){apf.xmldb.addNodeListener(c,this);var d=this.$applyBindRule("value",c);if(d||typeof d=="string"){if(this.caching){var b=this.$findHtmlNode(c.getAttribute("id")+"|"+this.$uniqueId);if(b){b.contents=d;}}this.$propHandlers.value.call(this,d);}else{this.$propHandlers.value.call(this,"");}};this.$draw=function(){var b=this;this.$ext=this.$getExternal();this.$container=this.$getLayoutNode("main","container",this.$ext);if(apf.hasCssUpdateScrollbarBug&&!apf.getStyle(this.$container,"padding")){this.$fixScrollBug();}this.oScroll=this.oFocus?this.oFocus.parentNode:this.$container;this.$scrolldown=true;this.oScroll.onscroll=function(){b.$scrolldown=this.scrollTop>=this.scrollHeight-this.offsetHeight+apf.getVerBorders(this);};clearInterval(this.$textTimer);this.$textTimer=setInterval(function(){if(b.oScroll&&b.$scrolldown&&b.scrolldown){b.oScroll.scrollTop=b.oScroll.scrollHeight;}},60);if(this.$container.tagName.toLowerCase()=="iframe"){if(apf.isIE){this.oIframe=this.$container;var d=this.skin.selectSingleNode("iframe_style");this.oIframe.contentWindow.document.write('<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">                    <head>                        <style>'+(d?d.firstChild.nodeValue:"")+"</style>                        <script>                            document.onkeydown = function(e){                                if (!e) e = event;                                if (top.apf.disableF5 && e.keyCode == 116) {                                    e.keyCode = 0;                                    return false;                                }                            }                        <\/script>                    </head>                    <body oncontextmenu='return false'></body>");this.$container=this.oIframe.contentWindow.document.body;}else{var c=document.createElement("div");this.$ext.parentNode.replaceChild(c,this.$ext);c.className=this.$ext.className;this.$ext=this.$container=c;}}};this.addEventListener("DOMNodeRemovedFromDocument",function(){clearInterval(this.$textTimer);apf.destroyHtmlNode(this.oDrag);if(this.oScroll){this.oScroll.onscoll=this.oScroll=null;}this.oDrag=this.oIframe=this.oFocus=null;});}).call(apf.text.prototype=new apf.BaseSimple());apf.aml.setElement("text",apf.text);apf.propedit=function(c,b){this.$init(b||"propedit",apf.NODE_VISIBLE,c);this.$nodes=[];this.$editors={};this.$dynCssClasses=[];};(function(){this.$init(function(){this.addEventListener("keydown",b,true);});this.implement(apf.DataAction);this.$focussable=true;this.$isTreeArch=true;this.$isWindowContainer=-1;this.startClosed=true;this.$animType=apf.tween.NORMAL;this.$animSteps=3;this.$animSpeed=20;this.$useiframe=0;this.$attrExcludePropBind=apf.extend({properties:3},this.$attrExcludePropBind);this.$booleanProperties.iframe=true;this.$propHandlers.properties=function(k){if(!k){return this.clear();}var d=this;var j={load:function(m){d.$loadingProps=false;if(typeof m=="string"){m=apf.getXml(m);}d.$properties=m;if(d.xmlRoot){d.load(d.xmlRoot);}},clear:function(){d.$loadingProps=false;},xmlRoot:this.xmlRoot};var g;this.$loadingProps=true;if(typeof k=="string"){if(k.substr(0,1)=="<"){j.load(k);}else{apf.setModel(k,j);}}else{if(k.$isModel){k.register(j);}else{if(this.$properties==k){return;}setTimeout(function(){j.load(k);});}}delete this.$properties;};this.$canLoadData=function(){return this.$headings?true:false;};this.$columns=["50%","50%"];this.$propHandlers.columns=function(d){this.$columns=d&&d.splitSafe(",")||["50%","50%"];if(this.$headings){this.$headings[0].setProperty("width",this.$columns[0]);this.$headings[1].setProperty("width",this.$columns[1]);}};function c(){var d=(this.current||this.$selected),g=this.$body;g.scrollTop=(d.offsetTop)-21;}this.$findHtmlNode=function(d){return this.$pHtmlDoc.getElementById(d);};function b(w){var E=w.keyCode,j=w.ctrlKey,q=w.shiftKey;var d=this.$lastEditor&&this.$lastEditor[2],C=this.$useiframe?this.oDoc.documentElement:this.$body,o,t,m,D,B,r,g;switch(E){case 36:return false;case 35:return false;case 107:break;case 37:this.$slideToggle(this.$selected.firstChild);return false;case 107:case 39:this.$slideToggle(this.$selected.firstChild);return false;case 38:var t=d;var A=d.previousSibling;while(A&&A.nodeType!=1){A=A.previousSibling;}if(A){var k=A,s;while((s=k.selectNodes("prop")).length){k=s[s.length-1];}A=k;}else{A=t.parentNode;if(A[apf.TAGNAME]!="prop"){A=A.previousSibling;while(A&&A.nodeType!=1){A=A.previousSibling;}if(A&&A[apf.TAGNAME]!="prop"){A=(s=A.selectNodes("prop"))[s.length-1];while(A&&A.nodeType!=1){A=A.previousSibling;}}}}if(!A){return;}var u=apf.xmldb.findHtmlNode(A,this);while(!u.offsetWidth){u=apf.xmldb.findHtmlNode(A=A.parentNode,this);}var n=apf.getAbsolutePosition(u,this.$body)[1]-(u.offsetHeight/2);if(n<=this.$ext.scrollTop){this.$ext.scrollTop=n;}this.select(u);return false;case 40:var t,A=(t=d).selectSingleNode("prop")||t.nextSibling;do{while(A&&(A.nodeType!=1||A[apf.TAGNAME]!="prop")){A=A.nextSibling;}if(!A){A=t.parentNode.nextSibling;if(A&&A[apf.TAGNAME]!="prop"){A=A.selectSingleNode("prop");}}}while(A&&A.nodeType!=1);if(!A){return;}var u=apf.xmldb.findHtmlNode(A,this);while(!u.offsetWidth){u=apf.xmldb.findHtmlNode(A=A.parentNode,this);}if(A==t){A=t.nextSibling;while(A&&(A.nodeType!=1||A[apf.TAGNAME]!="prop")){A=A.nextSibling;}var u=apf.xmldb.findHtmlNode(A,this);}var n=apf.getAbsolutePosition(u,this.$body)[1]+(u.offsetHeight/2);if(n>this.$ext.scrollTop+this.$ext.offsetHeight){this.$ext.scrollTop=n-this.$ext.offsetHeight;}this.select(u);return false;}}this.$focus=function(){if(!this.$ext||(apf.isIE&&this.$useiframe&&this.cssfix)){return;}this.$setStyleClass(this.oFocus||this.$ext,this.$baseCSSname+"Focus");if(this.oDoc){this.$setStyleClass(this.oDoc.documentElement,this.$baseCSSname+"Focus");}};this.$blur=function(){if(this.renaming){this.stopRename(null,true);}if(!this.$ext||(apf.isIE&&this.$useiframe&&this.cssfix)){return;}this.$setStyleClass(this.oFocus||this.$ext,"",[this.$baseCSSname+"Focus"]);if(this.oDoc){this.$setStyleClass(this.oDoc.documentElement,"",[this.$baseCSSname+"Focus"]);}};this.$slideToggle=function(d){container=d.parentNode.lastChild;if(apf.getStyle(container,"display")=="block"){d.className=d.className.replace(/min/,"plus");this.$slideClose(container);}else{d.className=d.className.replace(/plus/,"min");this.$slideOpen(container);}};this.$slideOpen=function(d){d.style.display="";apf.tween.single(d,{type:"scrollheight",from:3,diff:-2,to:d.scrollHeight,anim:this.$animType,steps:this.$animSteps,interval:this.$animSpeed,onfinish:function(g){g.style.overflow="visible";g.style.height="auto";}});};this.$slideClose=function(d){d.style.height=d.offsetHeight;d.style.overflow="hidden";apf.tween.single(d,{type:"scrollheight",from:d.scrollHeight,diff:-2,to:0,anim:this.$animType,steps:this.$animSteps,interval:this.$animSpeed,onfinish:function(g,j){g.style.display="none";}});};this.$findContainer=function(g){var d=g.nextSibling;if(!d){return g;}return d.nodeType==1?d:d.nextSibling;};this.addEventListener("bindingsload",this.$loaddatabinding=function(j){var k=j.bindings.properties;if(!k||!k.length){return;}for(var g=0,d=k.length;g<d;g++){}});this.$unloaddatabinding=function(){};this.getColumn=function(d){return this.$headings[d||this.$lastcol||0];};this.resizeColumn=function(j,g){var d=this.$headings[j];d.resize(g);};this.hideColumn=function(g){var d=this.$headings[g];d.hide();};this.showColumn=function(g){var d=this.$headings[g];d.show();};this.$getProperties=function(g){if(this.properties){return this.$properties||false;}else{if(this.$bindings.properties){var j=this.$bindings.properties;for(var d=0;d<j.length;d++){if(!j[d].match){return xx;}}}}return false;};this.$load=function(m){var o=this.$getProperties();if(!o){return false;}var j=[];var k=this.documentId=apf.xmldb.getXmlDocId(o);apf.xmldb.addNodeListener(m,this);var d=this,n=o.ownerDocument;(function g(r,F,B){for(var H,I,G,E,D,C,t,A=0,w=r.length;A<w;A++){t=r[A];d.$getNewContext("row");C=d.$getLayoutNode("row");if(t[apf.TAGNAME]=="group"){d.$getNewContext("cell");apf.setStyleClass(C,"heading");G=C.appendChild(d.$getLayoutNode("cell"));apf.setNodeValue(d.$getLayoutNode("cell","caption",G),(t.getAttribute("caption")||"").trim()||"");D=C.appendChild(n.createElement("blockquote"));g(t.selectNodes("prop"),D,B);C.insertBefore(H=n.createElement("u"),C.firstChild).appendChild(n.createTextNode(" "));H.setAttribute("class","min");}else{apf.xmldb.nodeConnect(k,t,C,d);d.$getNewContext("cell");h=d.$headings[0];G=C.appendChild(d.$setStyleClass(d.$getLayoutNode("cell"),h.$className));apf.setNodeValue(d.$getLayoutNode("cell","caption",G),(t.getAttribute("caption")||"").trim()||"");if(B){G.firstChild.setAttribute("style","padding-left:"+(B*15)+"px");}d.$getNewContext("cell");h=d.$headings[1];G=C.appendChild(d.$setStyleClass(d.$getLayoutNode("cell"),h.$className));apf.setNodeValue(d.$getLayoutNode("cell","caption",G),((apf.lm.compile(t.getAttribute("value"),{nostring:true}))(d.xmlRoot)||"")||"");if((I=t.selectNodes("prop")).length){D=C.appendChild(n.createElement("blockquote"));D.setAttribute("style","display:none;overflow:hidden;height:0;");g(I,d.$getLayoutNode("heading","container",D),B+1);C.insertBefore(H=n.createElement("u"),C.firstChild).appendChild(n.createTextNode(" "));H.setAttribute("class","plus");}}if(!F){j.push(C);}else{F.appendChild(C);}}})(o.selectNodes("group|prop"),null,0);apf.insertHtmlNodes(j,this.$body);this.setProperty("root",this.xmlRoot);var q=o.selectSingleNode(".//prop");if(q){this.select(this.$findHtmlNode(q.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId));}};this.$xmlUpdate=function(n,s,j,q){if(s!=this.xmlRoot){return;}if(q&&this.$lastEditor[0]==q.amlNode){this.$lastEditor[1].firstChild.innerHTML=((apf.lm.compile(this.$lastEditor[2].getAttribute("value"),{nostring:true}))(this.xmlRoot)||"")||"";}else{var g=this.$getProperties();if(!g){return;}var k,r,d=g.selectNodes(".//prop");for(var o=0,m=d.length;o<m;o++){k=d[o];r=this.$findHtmlNode(k.getAttribute(apf.xmldb.xmlIdTag)+"|"+this.$uniqueId);r.childNodes[r.firstChild.tagName=="U"?2:1].firstChild.innerHTML=((apf.lm.compile(k.getAttribute("value"),{nostring:true}))(this.xmlRoot)||"")||"";}}};this.$hideEditor=function(d){if(this.$lastEditor){this.$lastEditor[0].setProperty("visible",false);if(d){var m=this.$lastEditor[0].$ext.parentNode;m.removeChild(this.$lastEditor[0].$ext);m.removeAttribute("id");delete m.onresize;}var j=this.$lastEditor[1].childNodes;for(var k=0,g=j.length;k<g;k++){if(!j[k].host){j[k].style.display="";}}delete this.$lastEditor;}};this.select=function(B){if(this.$selected==B){return;}if(this.$selected){this.$setStyleClass(this.$selected,"",["selected"]);}this.$setStyleClass(B,"selected");this.$selected=B;this.$hideEditor();var g=apf.xmldb.getNode(B);var t=this;this.setProperty("selected",g);var u=this.$selected.childNodes[this.$selected.firstChild.tagName=="U"?2:1];var A,s=g.getAttribute("editor");var n=apf.lm.compile(s,{xpathmode:2});if(n.type==2){if(!s){if(g.childNodes.length){return;}else{throw new Error("Missing editor attribute on property element: "+g.xml);}}if(!this.$editors[s]){var w=apf.namespaces[apf.ns.aml].elements[s];var k="textarea|textbox|secret".indexOf(s)>-1;var j={htmlNode:u,width:"100%+2",height:19,style:"position:relative;z-index:10000",value:"[{"+this.id+".root}::"+(v=g.getAttribute("value")).substr(1,v.length-2)+"]",focussable:false,realtime:!k};if(k){j.onkeydown=function(C){if(C.keyCode==13){this.change(this.getValue());}};}if(w.prototype.hasFeature(apf.__MULTISELECT__)){j.caption="[text()]";j.eachvalue="[@value]";j.each="item";j.model="{apf.xmldb.getElementById('"+g.getAttribute(apf.xmldb.xmlIdTag)+"')}";}A=this.$editors[s]=new w(j);var r=apf.getBox(apf.getStyle(A.$ext,"margin"));if(r[1]||r[3]){A.setAttribute("width","100%+2-"+(r[1]+r[3]));}else{if(!r[3]){A.$ext.style.marginLeft="-1px";}}A.parentNode=this;A.$focusParent=this;A.setAttribute("focussable","true");A.$parentId=u.getAttribute("id");A.$parentRsz=u.onresize;A.$executeAction=function(){this.parentNode.$executeAction.apply(this.parentNode,arguments);};}else{A=this.$editors[s];if(A.hasFeature(apf.__MULTISELECT__)){A.setAttribute("model","{apf.xmldb.getElementById('"+g.getAttribute(apf.xmldb.xmlIdTag)+"')}");}A.setAttribute("value","[{"+this.id+".root}::"+(v=g.getAttribute("value")).substr(1,v.length-2)+"]");A.setProperty("visible",true);if(A.$ext.parentNode&&A.$ext.parentNode.nodeType==1){if(!A.$parentRsz){A.$parentRsz=A.$ext.parentNode.onresize;}A.$ext.parentNode.removeAttribute("id");delete A.$ext.parentNode.onresize;}u.appendChild(A.$ext);u.setAttribute("id",u.$parentId);if(A.$parentRsz){u.onresize=A.$parentRsz;u.onresize();}}}else{var q=n.call(this,this.xmlRoot);if(q.localName=="template"){}else{}}var d=u.childNodes;for(var o=0,m=d.length;o<m;o++){if(!d[o].host){d[o].style.display="none";}}this.$lastEditor=[A,u,g];};this.addEventListener("$clear",function(d){this.$hideEditor(true);});this.$draw=function(){this.$ext=this.$getExternal();this.$body=this.$getLayoutNode("main","body",this.$ext);this.$head=this.$getLayoutNode("main","head",this.$ext);this.$pointer=this.$getLayoutNode("main","pointer",this.$ext);this.$container=this.$body;if(this.$head.firstChild){this.$head.removeChild(this.$head.firstChild);}if(this.$body.firstChild){this.$body.removeChild(this.$body.firstChild);}var g=this.$widthdiff=this.$getOption("main","widthdiff")||0;this.$defaultwidth=this.$getOption("main","defaultwidth")||"100";this.$useiframe=apf.isIE&&(apf.isTrue(this.$getOption("main","iframe"))||this.iframe);var d=this;if(this.$useiframe&&!this.oIframe){var j=this.$body.className;this.oIframe=this.$body.appendChild(document.createElement(apf.isIE?"<iframe frameborder='0'></iframe>":"iframe"));this.oIframe.frameBorder=0;this.oWin=this.oIframe.contentWindow;this.oDoc=this.oWin.document;this.oDoc.write('<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">                <html xmlns="http://www.w3.org/1999/xhtml">                    <head><script>                        apf = {                            lookup : function(uid){                                return window.parent.apf.lookup(uid);                            },                            Init : {add:function(){},run:function(){}}                        };<\/script>                    </head>                    <body></body>                </html>');this.$body=this.oDoc.body;this.$body.className=j;this.oDoc.documentElement.className=this.$ext.className;apf.skins.loadCssInWindow(this.skinName,this.oWin,this.mediaPath,this.iconPath);if(apf.isIE){this.$setStyleClass(this.oDoc.documentElement,this.$baseCSSname+"Focus");}apf.convertIframe(this.oIframe,true);if(apf.getStyle(this.oDoc.documentElement,"overflowY")=="auto"){this.oIframe.onresize=function(){d.$head.style.marginRight=d.oDoc.documentElement.scrollHeight>d.oDoc.documentElement.offsetHeight?"16px":"0";};this.addEventListener("afterload",this.oIframe.onresize);this.addEventListener("xmlupdate",this.oIframe.onresize);}this.oDoc.documentElement.onmousedown=function(k){if(!k){k=d.oWin.event;}if((k.srcElement||k.target).tagName=="HTML"){apf.popup.forceHide();}};this.oDoc.documentElement.onscroll=function(){if(d.$isFixedGrid){d.$head.scrollLeft=d.oDoc.documentElement.scrollLeft;}};}else{if(apf.getStyle(this.$body,"overflowY")=="auto"){this.$resize=function(){d.$head.style.marginRight=d.$body.scrollHeight>d.$body.offsetHeight?"16px":"0";};apf.layout.setRules(this.$ext,this.$uniqueId+"_datagrid","var o = apf.all["+this.$uniqueId+"];                     if (o) o.$resize()");apf.layout.queue(this.$ext);this.addEventListener("afterload",this.$resize);this.addEventListener("xmlupdate",this.$resize);}this.$body.onmousedown=function(k){if(!k){k=event;}if((k.srcElement||k.target)==this){apf.popup.forceHide();}};this.$body.onscroll=function(){if(d.$isFixedGrid){d.$head.scrollLeft=d.$body.scrollLeft;}};}var d=this;this.$body.onmousedown=function(m){if(!m){m=event;}var k=m.srcElement||m.target;if(k==this){return;}if(k.tagName=="U"){d.$slideToggle(k);return;}while(k.host||(k.getAttribute(apf.xmldb.htmlIdTag)||"").indexOf("|")==-1){k=k.parentNode;if(k==this){return;}}d.select(k);};};this.$loadAml=function(d){this.$headings=[new apf.BindingColumnRule().$draw(this,"Property",this.$columns[0],"first"),new apf.BindingColumnRule().$draw(this,"Value",this.$columns[1])];};this.$destroy=function(){apf.popup.removeContent(this.$uniqueId);for(var d in this.$editors){this.$editors[d].destroy();}this.$ext.onclick=this.$body.onresize=null;apf.layout.removeRule(this.$body,"dg"+this.$uniqueId);apf.layout.activateRules(this.$body);};}).call(apf.propedit.prototype=new apf.DataBinding());apf.aml.setElement("propedit",apf.propedit);apf.aml.setElement("column",apf.BindingColumnRule);apf.aml.setElement("description",apf.BindingRule);apf.aml.setElement("color",apf.BindingRule);apf.checkbox=function(c,b){this.$init(b||"checkbox",apf.NODE_VISIBLE,c);};(function(){this.implement(apf.DataAction);this.$notfromext=true;this.$focussable=true;this.checked=false;this.$values=[1,0];this.$booleanProperties.checked=true;this.$supportedProperties.push("value","checked","label","values");this.$propHandlers.value=function(b){b=(typeof b=="string"?b.trim():b);this.checked=(typeof b!="undefined"&&b!==null&&b.toString()==this.$values[0].toString());if(this.checked){apf.setStyleClass(this.$ext,this.$baseCSSname+"Checked");}else{apf.setStyleClass(this.$ext,"",[this.$baseCSSname+"Checked"]);}};this.$propHandlers.checked=function(b){if(!this.$values){if(this.getAttribute("values")){this.$propHandler.values.call(this,this.getAttribute("values"));}else{this.$values=[false,true];}}this.setProperty("value",this.$values[b?0:1]);};this.$propHandlers.label=function(c){if(!this.$ext){return;}var b=this.$getLayoutNode("main","label",this.$ext);if(b.nodeType==1){b.innerHTML=c;}else{b.nodeValue=c;}};this.$propHandlers.values=function(b){this.$values=typeof b=="string"?b.split("|"):(b||[1,0]);};this.setValue=function(b){if(!this.$values){return;}this.setProperty("value",b,false,true);};this.getValue=function(){return this.xmlRoot?this.$values[this.checked?0:1]:this.value;};this.check=function(){this.setProperty("value",this.$values[0],false,true);};this.uncheck=function(){this.setProperty("value",this.$values[1],false,true);};this.addEventListener("$clear",function(){this.setProperty("value",this.$values[1]);});this.$enable=function(){if(this.$input){this.$input.disabled=false;}this.$doBgSwitch(1);};this.$disable=function(){if(this.$input){this.$input.disabled=true;}this.$doBgSwitch(4);};this.$setState=function(b,d,c){this.$doBgSwitch(this.states[b]);this.$setStyleClass(this.$ext,(b!="Out"?this.$baseCSSname+b:""),[this.$baseCSSname+"Down",this.$baseCSSname+"Over"]);this.state=b;if(c){this.dispatchEvent(c,d);}};this.$clickHandler=function(){this.change(this.$values[(!this.checked)?0:1]);if(this.validate){this.validate(true);}return true;};this.$draw=function(){this.$ext=this.$getExternal();this.$input=this.$getLayoutNode("main","input",this.$ext);this.$setupEvents();};this.$childProperty="label";}).call(apf.checkbox.prototype=new apf.BaseButton());apf.aml.setElement("checkbox",apf.checkbox);apf.application=function(){this.$init("application",apf.NODE_HIDDEN);if(!apf.isO3){this.$int=document.body;this.$tabList=[];this.$focussable=apf.KEYBOARD;this.focussable=true;this.visible=true;this.$isWindowContainer=true;this.focus=function(){this.dispatchEvent("focus");};this.blur=function(){this.dispatchEvent("blur");};apf.window.$addFocus(this);}};apf.application.prototype=new apf.AmlElement();apf.aml.setElement("application",apf.application);apf.loader=function(){this.$init("loader",apf.NODE_HIDDEN);this.show=function(){this.$ext.style.display="block";};this.hide=function(){this.$ext.style.display="none";};this.addEventListener("DOMNodeInsertedIntoDocument",function(c){var d;if(!(d=this.parentNode.$int)){return;}this.$ext=apf.insertHtmlNode(null,d,null,this.$aml?(this.$aml.serialize?this.$aml.serialize():this.$aml.xml):this.serialize());if(!apf.loaded){var b=this;apf.addEventListener("load",function(){if(apf.config.autoHideLoading){apf.queue.empty();b.hide();}});}});};apf.loader.prototype=new apf.AmlElement();apf.aml.setElement("loader",apf.loader);apf.AmlConfig=function(){this.$init("config",apf.NODE_VISIBLE);};(function(){this.focussable=false;this.$canLeechSkin=true;this.$draw=function(){this.$ext=this.$int=this.$getExternal(this.$isLeechingSkin?this.localName:"main");};}).call(apf.AmlConfig.prototype=new apf.Presentation());apf.aml.setElement("config",apf.AmlConfig);apf.bindings=function(c,b){this.$init(b||"bindings",apf.NODE_HIDDEN,c);this.$bindings=new apf.ruleList();this.$amlNodes={};};(function(){this.$smartbinding=null;this.register=function(b){if(b.localName=="smartbinding"){this.$smartbinding=b;this.$smartbinding.add(this);return;}if(!b.hasFeature(apf.__DATABINDING__)){return;}this.$amlNodes[b.$uniqueId]=b;if(!this.$amlLoaded){return;}if(!this.$bindings.$isCompiled){this.$cbindings=this.$bindings.compile();}b.$bindings=this.$bindings;b.$cbindings=this.$cbindings;b.dispatchEvent("bindingsload",{bindings:this.$bindings,compiled:this.$cbindings});this.dispatchEvent("noderegister",{amlNode:b});b.$checkLoadQueue();};this.unregister=function(){this.$amlNodes[this.amlNode.$uniqueId]=null;delete this.$amlNodes[this.amlNode.$uniqueId];this.amlNode.$bindings=this.amlNode.$cbindings=false;this.amlNode.dispatchEvent("bindingsunload",{bindings:this.$bindings,compiled:this.$cbindings});};this.reload=function(){for(var b in this.$amlNodes){this.$amlNodes[b].reload();}};this.addEventListener("DOMNodeInsertedIntoDocument",function(j){var c=this.childNodes;for(var g,d=0,b=c.length;d<b;d++){if(!(g=c[d]).$amlLoaded&&g.nodeType==1){g.dispatchEvent("DOMNodeInsertedIntoDocument");}}this.register(this.parentNode);for(var k in this.$amlNodes){this.register(this.$amlNodes[k]);}});}).call(apf.bindings.prototype=new apf.AmlElement());apf.ruleList=function(){this.$compiled={};};apf.ruleList.prototype={$isCompiled:false,getRule:function(c,g){var m=this[c];if(!m){return false;}for(var j,k,d=0,b=m.length;d<b;d++){k=m[d];if(!k.match){return k;}j=k.cmatch||k.compile("match",{injectself:true,xpathmode:2});if(j&&j(g)){return k;}}},compile:function(d){var n,j,o=this.$compiled,k=false;if(d){j=[];n=this[d];for(var m,g=0,b=n.length;g<b;g++){if(!(m=n[g]).match&&!m.value){continue;}j.push(m.match,m.value);if(!k&&m.value){k=m.value.indexOf("<a:")>-1;}}o[d]=apf.lm.compileMatch(j);o[d].hasAml=k;return o;}for(d in this){if(d=="each"){continue;}n=this[d];if(n.dataType!=apf.ARRAY){continue;}j=[],k=false;for(var m,g=0,b=n.length;g<b;g++){if(!(m=n[g]).match&&!m.value){continue;}j.push(m.match,m.value);if(!k&&m.value){k=m.value.indexOf("<a:")>-1;}}o[d]=apf.lm.compileMatch(j);o[d].hasAml=k;}this.$isCompiled=true;return o;},getRuleIndex:function(c,b){var d=this[c][b];if(d.value){if(!d.cvalue){d.compile("value");}}else{if(d.match){if(!d.cmatch){d.compile("match");}}}return d;},getDataNode:function(b,o,n,j,r){var k,g,d,c,m,q=this[b];if(!q){return;}for(m,k=0,g=q.length;k<g;k++){m=q[k];d=m.cvaluematch;if(!d){if(m.match&&m.value){m.valuematch="{_n = "+m.match+"; %[child::"+m.value.substr(1,m.value.length-2).split("|").join("|child::")+"]}";}else{m.valuematch=m.match||m.value;}d=m.$compile("valuematch",{xpathmode:r?4:3,injectself:m.match?true:false});}if(d&&(c=d(o,n))){if(j){j.push(m);}return c;}}return false;}};apf.aml.setElement("bindings",apf.bindings);apf.appsettings=function(c,b){this.$init(b||"appsettings",apf.NODE_HIDDEN,c);};(function(){this.$parsePrio="001";this.$attrExcludePropBind={language:1,login:1,logout:1,layout:1};this.$supportedProperties=["debug","name","baseurl","resource-path","disable-right-click","allow-select","allow-blur","auto-disable-actions","auto-disable","disable-f5","auto-hide-loading","disable-space","disable-backspace","undokeys","initdelay","default-page","query-append","outline","drag-outline","resize-outline","resize-outline","iepngfix","iepngfix-elements","iphone-fullscreen","iphone-statusbar","iphone-icon","iphone-icon-is-glossy","iphone-fixed-viewport","layout","skinset","language","storage","offline","login"];this.$booleanProperties={debug:1,"disable-right-click":1,"allow-select":1,"allow-blur":1,"auto-disable-actions":1,"auto-disable":1,"disable-f5":1,"auto-hide-loading":1,"disable-space":1,"disable-backspace":1,undokeys:1,initdelay:1,outline:1,iepngfix:1,"iphone-fullscreen":1,"iphone-icon-is-glossy":1,"iphone-fixed-viewport":1};var b=this.setProperty;this.setProperty=function(k,j,g,d,c){if(c!=2){b.apply(this,arguments);}};this.$handlePropSet=function(g,d,c){if(this.$booleanProperties[g]){d=apf.isTrue(d);}this[g]=d;apf.config.setProperty(g,d);};this.addEventListener("DOMNodeInsertedIntoDocument",function(c){if(apf.isIphone&&apf.runIphone){apf.runIphone();delete apf.runIphone;}});}).call(apf.appsettings.prototype=new apf.AmlElement());apf.aml.setElement("appsettings",apf.appsettings);apf.BindingColorRule=function(c,b){this.$init(b,apf.NODE_HIDDEN,c);};(function(){this.addEventListener("DOMNodeInsertedIntoDocument",function(c){if(this.$bindings&&this.$bindings.color){var b=this.$bindings.color[0];apf.setStyleRule("."+this.$baseCSSname+(apf.isIE?" .records .highlight SPAN":" .records .highlight span"),"color",b.getAttribute("text"),null,this.oWin);apf.setStyleRule("."+this.$baseCSSname+(apf.isIE?" .records .highlight SPAN":" .records .highlight span"),"backgroundColor",b.getAttribute("row"),null,this.oWin);apf.setStyleRule("."+this.$baseCSSname+(apf.isIE?" .records .highlight":" .records .highlight"),"backgroundColor",b.getAttribute("row"),null,this.oWin);}apf.importStylesheet([["."+this.className,"width:"+this.$width+(this.$isPercentage?"%;":"px;")+"text-align:"+h.align],["."+this.className,"width:"+this.$width+(this.$isPercentage?"%;":"px;")+"text-align:"+h.align]]);this.$draw();});}).call(apf.BindingColorRule.prototype=new apf.BindingRule());apf.aml.setElement("color",apf.BindingColorRule);apf.rpc=function(c,b){this.$init(b||"rpc",apf.NODE_HIDDEN,c);if(!this.supportMulticall){this.multicall=false;}this.stack={};this.urls={};this.$methods={};};(function(){this.useHTTP=true;this.namedArguments=false;this["route-server"]=apf.host+"/cgi-bin/rpcproxy.cgi";this.autoroute=false;this.$auth=false;this.$booleanProperties.multicall=true;this.$supportedProperties.push("protocol","type","multicall","http-method");this.$propHandlers["route-server"]=function(c){this.autoroute=c?true:false;};this.$propHandlers.protocol=function(c){if(!c){return;}if(!apf[c]){throw new Error(apf.formatErrorString(1025,null,"Teleport baseclass","Could not find Ajax.org Teleport RPC Component '"+c+"'",this));return;}this.implement(apf[c]);};this.$propHandlers.type=function(c){this.$useXml=(typeof c=="string"&&c.toUpperCase()=="XML");};this.setCallback=function(c,d){if(!this.$methods[c]){throw new Error(apf.formatErrorString(0,this,"Teleport RPC","Trying to set callback: method not found."));}this.$methods[c].callback=d;};this.setUrl=function(d,c){if(!this.$methods[d]){throw new Error(apf.formatErrorString(0,this,"Teleport RPC","Trying to set callback: method not found."));}this.$methods[d].setProperty("url",c);};this.$convertArgs=function(n,m){if(!this.namedArguments){return Array.prototype.slice.call(m);}var g=this.$methods[n].names;if(!g||!g.length){return{};}var q,k,o,d,c={};for(k=0,o=0,d=g.length;o<d;o++){n=g[o].name;q=g[o].value;if(q){q=apf.parseExpression(q);}else{q=m[k++];if(apf.isNot(q)&&g[o]["default"]){q=apf.parseExpression(g[o]["default"]);}}q=apf.isTrue(g[o].encoded)?encodeURIComponent(q):q;c[n]=q;}return c;};function b(c){var g,d;if(typeof c.callback=="string"){g=c.callback.split("."),d=self[g.shift()];while(d&&g.length){d=d[g.shift()];}}else{d=c.callback;}return d||apf.K;}this.call=function(d,q,t){var s,m=this.$methods[d];if(typeof q[q.length-1]=="function"){q=Array.prototype.slice.call(q);s=q.pop();}else{s=b(m);}q=this.$convertArgs(d,q);if(this.multicall){if(!this.stack[this.url]){this.stack[this.url]=this.getMulticallObject?this.getMulticallObject():[];}this.getSingleCall(d,q,this.stack[this.url]);return true;}var r=this,n=t.message||this.createMessage(m["method-name"]||d,q);function j(w,u,o){o.data=w;if(u!=apf.SUCCESS){s.call(r,null,u,o);}else{if(r.isValid&&!r.isValid(o)){s.call(r,null,apf.ERROR,o);}else{s.call(r,r.unserialize(o.data),u,o);}}}var k,c=apf.getAbsolutePath(this.baseurl||apf.config.baseurl,this.url),g=apf.extend({callback:j,async:m.async,userdata:m.userdata,nocache:(this.nocache===false)?false:true,data:n,useXML:this.$useXml||m.type=="xml",caching:m.caching,ignoreOffline:m["ignore-offline"]},t);return this.$get(c,g);};this.purge=function(o,n,g,q){if(!this.stack[this.url]||!this.stack[this.url].length){throw new Error(apf.formatErrorString(0,null,"Executing a multicall","No RPC calls where executed before calling purge()."));}var j=this.createMessage("multicall",[this.stack[this.url]]),c=apf.getAbsolutePath(this.baseurl||apf.config.baseurl,this.url);if(q){for(var m=[],k=0;k<q.length;k++){m.push(encodeURIComponent(q[k][0])+"="+encodeURIComponent(q[k][1]||""));}c=c+(c.match(/\?/)?"&":"?")+m.join("&");}var d=this.$get(c,{callback:o,async:g,userdata:n,nocache:true,data:j,useXML:this.$useXml});this.stack[this.url]=this.getMulticallObject?this.getMulticallObject():[];};this.revert=function(c){this.stack[c.url]=this.getMulticallObject?this.getMulticallObject():[];};this.getStackLength=function(){return this.stack[this.url]?this.stack[this.url].length:0;};this.$addMethod=function(k){if(k.localName!="method"){throw new Error(apf.formatErrorString(0,this,"Parsing RPC Teleport node","Found element which is not a method",this));return false;}var g=k.name,c=k.receive||this.receive,j=0,d=k.childNodes.length,m;this[g]=function(){return this.call(g,arguments);};if(c){k.callback=c;}this.$methods[g]=k;if(!k.names){k.names=[];}for(;j<d;j++){m=k.childNodes[j];if(m.localName=="param"||m.localName=="variable"){k.names.push(m);}}return true;};this.$removeMethod=function(d){var c=d.name;delete this[c];delete this.$methods[c];};this.$setAuth=function(c){this.$auth=c;};this.exec=function(m,g,k,d){if(!d){d={};}if(d.multicall){this.forceMulticall=true;}if(!this[m]){throw new Error(apf.formatErrorString(0,null,"Saving/Loading data","Could not find RPC function by name '"+m+"' in data instruction '"+d.instruction+"'"));}var j=this.$methods[m];if(d.userdata){j.userdata=d.userdata;}if(!this.multicall){j.callback=k;}var c=this.call(m,g,d);if(this.multicall){return this.purge(k,"&@^%!@");}else{if(d.multicall){this.forceMulticall=false;return this;}}if(!this.multicall&&!j.async&&k){k(c,apf.SUCCESS,{tpModule:this});}};}).call(apf.rpc.prototype=new apf.Teleport());apf.config.$inheritProperties.baseurl=1;apf.aml.setElement("rpc",apf.rpc);apf.method=function(c,b){this.$init(b||"method",apf.NODE_HIDDEN,c);this.async=true;this.caching=false;this["ignore-offline"]=false;};(function(){this.$parsePrio="002";this.$booleanProperties.async=true;this.$booleanProperties.caching=true;this.$booleanProperties["ignore-offline"]=true;this.$supportedProperties.push("name","receive","async","caching","ignore-offline","method-name","type","url");this.$propHandlers["ignore-offline"]=function(b){this.ignoreOffline=b;};this.$propHandlers["method-name"]=function(b){this.methodName=b;};this.addEventListener("DOMNodeInserted",function(b){if(this.parentNode.$addMethod&&b.currentTarget==this){this.parentNode.$addMethod(this);}});this.addEventListener("DOMNodeRemoved",function(b){if(this.parentNode.$removeMethod&&b.currentTarget==this){this.parentNode.$removeMethod(this);}});this.addEventListener("DOMNodeInsertedIntoDocument",function(b){if(this.parentNode.$addMethod){this.parentNode.$addMethod(this);}});}).call(apf.method.prototype=new apf.AmlElement());apf.aml.setElement("method",apf.method);apf.cgi=function(){this.supportMulticall=false;this.namedArguments=true;this.unserialize=function(b){return b;};this.getSingleCall=function(c,b,d){d.push(b);};this.createMessage=function(g,b){var k,j=[];function d(t,m){if(t&&t.dataType==apf.ARRAY){for(var n=0;n<t.length;n++){d(t[n],m+"%5B"+n+"%5D");}}else{if(typeof t=="object"){if(t.nodeType){try{var q=t.outerHTML||t.serialize&&t.serialize()||apf.getCleanCopy(t).xml;}catch(r){var q="Could not serialize object";}j.push(m+"="+encodeURIComponent(q));}else{for(k in t){if(typeof t[k]=="function"){continue;}d(t[k],m+"%5B"+encodeURIComponent(k)+"%5D");}}}else{if(typeof t!="undefined"&&t!==null){j.push(m+"="+encodeURIComponent(t));}}}}if(this.multicall){j.push("func="+this.mcallname);for(var c=0;c<b[0].length;c++){d(b[0][c],"f%5B"+c+"%5D");}}else{for(k in b){d(b[k],k);}}if(!this.baseUrl){this.baseUrl=this.url;}this.url=this.$methods[g].url?this.$methods[g].url:this.baseUrl;if(this.method!="GET"){return j.join("&");}this.url=this.url+(j.length?(this.url.indexOf("?")>-1?"&":"?")+j.join("&"):"");return"";};this.addEventListener("DOMNodeInsertedIntoDocument",function(){this.method=(this["http-method"]||"GET").toUpperCase();this.contentType=this.method=="GET"?null:"application/x-www-form-urlencoded";});this.submitForm=function(k,n){if(!this["postform"]){this.addMethod("postform",n);}var d=[];for(var g=0,b=k.elements.length;g<b;g++){if(!k.elements[g].name){continue;}if(k.elements[g].tagname=="input"&&(k.elements[g].type=="checkbox"||k.elements[g].type=="radio")&&!k.elements[g].checked){continue;}if(k.elements[g].tagname="select"&&k.elements[g].multiple){for(var c=0;c<k.elements[g].options.length;c++){if(k.elements[g].options[c].selected){d.push(k.elements[g].name+"="+encodeURIComponent(k.elements[g].options[c].value));}}}else{d.push(k.elements[g].name+"="+encodeURIComponent(k.elements[g].value));}}var m=(k.action||location.href);this.urls.postform=m+(m.indexOf("?")>-1?"&":"?")+d.join("&");this["postform"].call(this);return false;};};apf.UndoData=function(g,c){this.localName="UndoData";this.extra={};apf.extend(this,g);if(c){this.at=c;}else{if(g&&g.tagName=="UndoData"){this.args=g.args.slice();}else{this.selNode=this.selNode||(this.action=="removeNode"?this.args[0]:(this.amlNode?this.amlNode.selected:null));}}var d,b=this;this.saveChange=function(k,j,o){if(this.action=="group"){var n=this.args[1];j.$addToQueue(n,k,true);return j.$queueNext(this);}var m;if(this.xmlActionNode){m=this.xmlActionNode.getAttribute(k?"undo":"set");if(k&&!m){m=this.xmlActionNode.getAttribute("set");}}if(!m){return j.$queueNext(this);}this.state=k?"restoring":"saving";if(!d.asyncs){return j.$receive(null,apf.SUCCESS,{amlNode:this.amlNode},this,o);}d.ignoreOffline=true;apf.saveData(m,d);};this.preparse=function(k,j,m){var n;if(this.xmlActionNode){n=this.xmlActionNode.getAttribute(k?"undo":"set");if(k&&!n){n=this.xmlActionNode.getAttribute("set");}}if(!n){return this;}d=apf.extend({xmlNode:this.action=="multicall"?this.args[0].xmlNode:this.selNode||this.xmlNode,userdata:apf.isTrue(this.xmlActionNode.getAttribute("ignore-fail")),multicall:m,undo:k,precall:true,callback:function(r,q,o){if(d.asyncs){o.amlNode=b.amlNode;return j.$receive(r,q,o,b,callback);}}},this.extra);apf.saveData(n,d);return this;};};apf.actiontracker.actions={setTextNode:function(d,b){var c=d.args;if(!b){apf.xmldb.setTextNode(c[0],c[1],c[2],d);}else{apf.xmldb.setTextNode(c[0],d.extra.oldValue,c[2]);}},setAttribute:function(d,b){var c=d.args;if(!b){d.extra.name=c[1];d.extra.oldValue=c[0].getAttribute(c[1]);apf.xmldb.setAttribute(c[0],c[1],c[2],c[3],d);}else{if(!d.extra.oldValue){apf.xmldb.removeAttribute(c[0],c[1]);}else{apf.xmldb.setAttribute(c[0],c[1],d.extra.oldValue,c[3]);}}},removeAttribute:function(d,b){var c=d.args;if(!b){d.extra.name=c[1];d.extra.oldValue=c[0].getAttribute(c[1]);apf.xmldb.removeAttribute(c[0],c[1],c[2],d);}else{apf.xmldb.setAttribute(c[0],c[1],d.extra.oldValue,c[2]);}},replaceNode:function(d,b){var c=d.args;if(!b){apf.xmldb.replaceNode(c[1],c[0],c[2],d);}else{apf.xmldb.replaceNode(c[0],c[1],c[2],d);}},addChildNode:function(d,b){var c=d.args;if(!b){apf.xmldb.addChildNode(c[0],c[1],c[2],c[3],d);}else{apf.xmldb.removeNode(d.extra.addedNode);}},appendChild:function(d,b){var c=d.args;if(!b){apf.xmldb.appendChild(c[0],c[1],c[2],c[3],c[4],d);}else{apf.xmldb.removeNode(d.xmlNode);}},moveNode:function(d,b){var c=d.args;if(!b){apf.xmldb.moveNode(c[0],c[1],c[2],c[3],d);}else{apf.xmldb.moveNode(d.extra.oldParent,c[1],d.extra.beforeNode,c[3]);}},removeNode:function(d,b){var c=d.args;if(!b){apf.xmldb.removeNode(c[0],c[1],d);}else{apf.xmldb.appendChild(d.extra.parent,d.extra.removedNode,d.extra.beforeNode);}},removeNodeList:function(g,b){if(b){var j=g.extra.removeList;for(var c=j.length-1;c>=0;c--){apf.xmldb.appendChild(j[c].pNode,j[c].removedNode,j[c].beforeNode);}}else{apf.xmldb.removeNodeList(g.args,g);}},group:function(g,d,b){if(!g.$undostack){var c=g.args[0];g.$undostack=c;g.$redostack=[];}b[d?"undo":"redo"](g.$undostack.length,false,g.$undostack,g.$redostack);},setValueByXpath:function(g,b){var d=g.args;if(!b){if(g.extra.newNode){apf.xmldb.appendChild(g.extra.parentNode,g.extra.newNode);}else{var c=[];apf.setNodeValue(d[0],d[1],true,{undoObj:g,xpath:d[2],newNodes:c,forceNew:d[3]});g.extra.newNode=c[0];}}else{if(g.extra.newNode){g.extra.parentNode=g.extra.newNode.parentNode;apf.xmldb.removeNode(g.extra.newNode);}else{apf.setNodeValue(g.extra.appliedNode,g.extra.oldValue,true);}}},multicall:function(k,c,b){var j=k.args;var g=apf.xmldb.delayUpdate;apf.xmldb.delayUpdate=true;if(!c){for(var d=0;d<j.length;d++){if(!j[d].extra){j[d].extra={};}apf.actiontracker.actions[j[d].action](j[d],false,b);}}else{for(var d=j.length-1;d>=0;d--){apf.actiontracker.actions[j[d].action](j[d],true,b);}}apf.xmldb.delayUpdate=g;}};apf.LiveMarkupPi=function(){this.$init();};(function(){this.mainBind="data";this.implement(apf.StandardBinding);this.getDocument=function(){return this.$data&&this.$data.ownerDocument;};this.clear=function(b){if(b=="loading"&&apf.getInheritedAttribute(this,"loading-message")){this.$propHandlers.calcdata.call(this,"<span class='loading'>Loading...</span>");this.calcdata="";}};this.$propHandlers.calcdata=function(d){if(this.$data){var b=this.$data.childNodes;for(var c=b.length-1;c>=0;c--){b[c].destroy(true);}}if(typeof d=="string"&&d.indexOf("<a:")>-1){this.$ext.innerHTML="";this.$data=this.ownerDocument.$domParser.parseFromString("<a:application xmlns:a='"+apf.ns.apf+"'>"+d+"</a:application>","text/xml",{htmlNode:this.$ext}).documentElement;}else{if(this.$data){var b=this.$data.childNodes;for(var c=0;c<b.length;c++){b[c].destroy(true);}}this.$ext.innerHTML=d||"";}};}).call(apf.LiveMarkupPi.prototype=new apf.AmlProcessingInstruction(true));apf.aml.setProcessingInstruction("lm",apf.LiveMarkupPi);apf.aml.setProcessingInstruction("lm-debug",apf.LiveMarkupPi);apf.aml.setProcessingInstruction("livemarkup",apf.LiveMarkupPi);apf.LiveTextPi=function(){this.$init();};(function(){this.mainBind="data";this.implement(apf.StandardBinding);this.$propHandlers.calcdata=function(b){this.$ext.innerHTML=b&&apf.htmlentities(b)||"";};}).call(apf.LiveTextPi.prototype=new apf.AmlProcessingInstruction(true));apf.aml.setProcessingInstruction("lt",apf.LiveTextPi);apf.aml.setProcessingInstruction("livetext",apf.LiveTextPi);if(document.all){var oldWinError=window.onerror,z;window.onerror=z=function(b){apf.console.error("Error caught from early startup. Might be a html parser syntax error (not your fault). "+b);if(!arguments.caller){return true;}};}apf.Init.addConditional(function(){if(document.all&&window.onerror==z){window.onerror=oldWinError;}apf.dispatchEvent("domready");},null,["body","class"]);apf.addDomLoadEvent(function(){apf.Init.run("body");});apf.start();