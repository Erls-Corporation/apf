<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns:a="http://ajax.org/2005/aml" xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>TEST CLIENT</title>
        <script type="text/javascript" src="apf.js"></script>
    </head>
    <body>
        <a:skin 
          src        = "skins.xml" 
        />

        <a:appsettings name   = "worknets" debug="false"
          disable-right-click = "false"
          disable-space       = "true"
          disable-f5          = "false"
          auto-hide-loading   = "true"
          allow-select        = "true"
          allow-blur          = "true"
          initdelay           = "false"
          loading-message     = "Loading..."
          empty-message       = "Loading..."
          baseurl             = "{apf.host ? apf.host + '/' : 'http://dev.worknets.com/'}">
        </a:appsettings>

        <a:xmpp id="myXMPP"
          url               = "{apf.host ? apf.host : 'http://localhost'}:5280/http-bind"
          host              = "worknets.com"
          type              = "binding"
          resource          = "{'apf_'.appendRandomNumber(5)}" />

        <a:remote transport="myXMPP" id="rmtFs" />

	    <a:script><![CDATA[
			function createClient(user, pass, prio){
				var cMyXmpp = myXMPP.cloneNode(true);
				cMyXmpp.setAttribute("id", "cMyXmpp" + prio);
				apf.document.body.appendChild(cMyXmpp);

				var cRmtFs = rmtFs.cloneNode(true);
				cRmtFs.setAttribute("transport", "cMyXmpp" + prio);
				apf.document.body.appendChild(cRmtFs);
				
				//Model
				var model = apf.document.body.appendChild(apf.document.createElementNS(apf.ns.aml, "model"));
				model.setAttribute("id", "mdlComputed" + prio);
				model.setAttribute("remote", "rmtFs");
				model.setAttribute("src", "rdb://worknets.com/computed" + prio)
				
				//Label
				var label = apf.document.body.appendChild(apf.document.createElementNS(apf.ns.aml, "label"));
				label.setAttribute("caption", "[{mdlComputed" + prio + "}::caption]");

				cMyXmpp.connect(user, pass);

				apf.addEventListener("exit", function(){
					//mode.unshare();
					cMyXmpp.disconnect();
				})

				return {
					xmpp: cMyXmpp,
					remote: cRmtFs,
					name: user
				}
			}

			createClient("fabian", "fabian", 1);
	    ]]></a:script>

    </body>
</html>
