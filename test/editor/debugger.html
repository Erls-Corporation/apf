<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns:a="http://ajax.org/2005/aml" xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <script src="../../apf.js"></script>
        
        <style type="text/css" media="screen">
            html{
                overflow: hidden;
            }
        </style>
    </head>
    <body>
    	<embed type="application/o3stem-aaaaaaaa-1111-bbbb-1111-cccccccccccc" width="0" height="0" /> 
    	
        <a:skin src="../../skins.xml" media-path="../../images/" icon-path="debugger_icons/" />       
        <a:appsettings debug="0" />
       
       	<a:model id="mdlTabs" />
       	<a:model id="mdlScripts" src="{attachDebugger([{lstTabs.selected}::@id])}" autoinit="false" />
       	<a:model id="mdlStack" />
       	<a:model id="mdlDebugger">
       		<debugger running="true" connected="false">
       			<breakpoints />
       			<scripts />
       		</debugger>
    	</a:model>


        <a:window id="winTab" title="Choose a Tab" zindex="10" center="true" modal="true" width="450" height="200" visible="true">
        	<a:list 
        		model="mdlTabs" 
        		anchors="10 10 40 10" 
        		id="lstTabs" 
        		multiselect="false" 
        		eachvalue="[text()]" 
        		autoselect="false" 
        		each="[tab]" 
        		caption="[text()]" 
        		empty-message="Loading tabs..."
        		onafterchoose = "btnOk.dispatchEvent('click');"/>
        	<a:button id="btnOk"
        		right="10" 
        		bottom="10" 
        		width="60" 
        		disabled="{!lstTabs.selected}" 
        		default="true"
        		onclick="winTab.close();mdlScripts.init();">OK
       		</a:button>
        </a:window>
        
		<a:toolbar align="top" height="26">
			<a:bar>
	        	<a:button id="btnContinue" icon="{this.disabled ? 'resume_co_disabled.gif' : 'resume_co.gif'}" onclick="continueScript();" disabled="[mdlDebugger::@running]" />
	        	<a:button icon="{this.disabled ? 'suspend_co_disabled.gif' : 'suspend_co.gif'}" disabled="true" />
	        	<a:button icon="{this.disabled ? 'disconnect_co_disabled.gif' : 'disconnect_co.gif'}" onclick="disconnect();" disabled="{![mdlDebugger::@connected]}" />
	        	<a:button icon="{this.disabled ? 'stepinto_co_disabled.gif' : 'stepinto_co.gif'}" onclick="stepInto();" disabled="[mdlDebugger::@running]" />
	        	<a:button icon="{this.disabled ? 'stepover_co_disabled.gif' : 'stepover_co.gif'}" onclick="stepNext();" disabled="[mdlDebugger::@running]" />
	        	<a:button icon="{this.disabled ? 'stepreturn_co_disabled.gif' : 'stepreturn_co.gif'}" onclick="stepOut();" disabled="[mdlDebugger::@running]" />
	        </a:bar>
        </a:toolbar>
        
        
        <a:window skin="dockwin" dock="true" align="left-splitter" width="400" visible="true" title="Sources" zindex="9">
	        <a:list
	          id="lstScripts"
	          model="mdlScripts"
	          anchors="0 0 0 0"
	          each="[script]"
	          caption="[@text]"
	          icon="file_obj.gif">
	        	<a:actions />
	        </a:list>
        </a:window>
          
        <a:window skin="dockwin" dock="true" align="left-splitter" visible="true" title="Stack" zindex="9">
	        <a:datagrid
	          id         = "lstStack"
	          anchors    = "0 0 0 0" 
	          options    = "size|move"
	          caching    = "false"
	          prerender  = "false"
	          model      = "mdlStack"
	          loading-message = "Calculating..."
	          >
	        	<a:actions />
	            <a:column caption="Function" value="[@name]" width="100%" icon="stckframe_obj.gif" />
	            <a:column caption="Script" value="[@script]" width="100" />
	            <a:column caption="Line" value="[@line]" width="40"/>
	            <a:column caption="Column" value="[@column]" width="40"/>
	            <a:each match="[frame]" />
	        </a:datagrid>		
	        <!-- <a:list
	          id="lstStack"
	          model="mdlStack"
	          anchors="0 0 0 0"
	          each="[frame]"
	          caption="[@text]"
	          icon="stckframe_obj.gif">
	        	<a:actions />
	        </a:list> -->        
        </a:window>
        
        <a:window skin="dockwin" dock="true" align="left-splitter" height="200" visible="true" title="Watch" zindex="9">
	        <a:datagrid
	          anchors    = "0 0 0 0" 
	          options    = "size|move"
	          caching    = "false"
	          prerender  = "false"
	          model      = "{lstStack.selected}"
	          loading-message = "Calculating..."
	          >
	        	<a:actions />
	            <a:column caption="Property" value="[@name]" width="120" icon="genericvariable_obj.gif" tree="true" />
	            <a:column caption="Value" value="[@text]" width="100%" editor="textbox" />
	            <a:column caption="Type" value="[@type]" width="80"/>
	            <a:each match="[vars/var]" sort="[@name]" />
	        </a:datagrid>		
        </a:window>
        
        <a:codeeditor id="ce" 
            align       = "right"
            model       = "{lstScripts.selected}"  
            syntax      = "js" 
            readonly    = "true"        
            showinvisibles = "true"
            showprintmargin = "true"
            printmargincolumn = "80"
            ongutterdblclick = "toggleBreakPoint([{lstScripts.selected}::@id], event.row)">
            <a:load get="{adbg.loadScript([@id])}"/>
            <a:value value="[text()]" />
        </a:codeeditor>   
          
          
        <a:script src="debugger.js"></a:script>
    </body>
</html>