<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns:a="http://ajax.org/2005/aml" xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <script>var loader2 = true</script>        
        <script src="../../apf.js"></script>
        <script src="debugger.js"></script>
        
        <style type="text/css" media="screen">
            html{
                overflow: hidden;
            }
        </style>
    </head>
    <body>
    	<embed type="application/o3stem-aaaaaaaa-1111-bbbb-1111-cccccccccccc" width="0" height="0" /> 
    	
        <a:skin src="../../skins.xml" media-path="../../images/" icon-path="debugger_icons/" />       
        <a:appsettings debug="0" />
       
       	<a:model id="$apf_dbg_mdlTabs" />
       	<a:model id="$apf_dbg_mdlScripts" src="{apf.$debugger.attach([{lstTabs.selected}::@id])}" autoinit="false" />
       	<a:model id="$apf_dbg_mdlStack" />
       	<a:model id="$apf_dbg_mdlBreakpoints">
       		<breakpoints />
       	</a:model>
       	<a:model id="$apf_dbg_mdlDebugger">
       		<debugger running="true" connected="false">
       			<breakpoints />
       			<scripts />
       		</debugger>
    	</a:model>


        <a:window id="winTab" title="Choose a Tab" zindex="10" center="true" modal="true" width="450" height="200" visible="true">
        	<a:list 
        		model="$apf_dbg_mdlTabs" 
        		anchors="10 10 40 10" 
        		id="lstTabs" 
        		multiselect="false" 
        		eachvalue="[text()]" 
        		autoselect="false" 
        		each="[tab]" 
        		caption="[text()]" 
        		empty-message="Loading tabs..."
        		onafterchoose = "btnOk.dispatchEvent('click');"/>
        	<a:button id="btnOk"
        		right="10" 
        		bottom="10" 
        		width="60" 
        		disabled="{!lstTabs.selected}" 
        		default="true"
        		onclick="winTab.close();$apf_dbg_mdlScripts.init();">OK
       		</a:button>
        </a:window>
        
		<a:toolbar align="top" height="26">
			<a:bar>
	        	<a:button id="btnContinue" icon="{this.disabled ? 'resume_co_disabled.gif' : 'resume_co.gif'}" onclick="apf.$debugger.continueScript();" disabled="[$apf_dbg_mdlDebugger::@running]" />
	        	<a:button icon="{this.disabled ? 'suspend_co_disabled.gif' : 'suspend_co.gif'}" disabled="true" />
	        	<a:button icon="{this.disabled ? 'disconnect_co_disabled.gif' : 'disconnect_co.gif'}" onclick="apf.$debugger.disconnect();" disabled="{![$apf_dbg_mdlDebugger::@connected]}" />
	        	<a:button icon="{this.disabled ? 'stepinto_co_disabled.gif' : 'stepinto_co.gif'}" onclick="apf.$debugger.stepInto();" disabled="[$apf_dbg_mdlDebugger::@running]" />
	        	<a:button icon="{this.disabled ? 'stepover_co_disabled.gif' : 'stepover_co.gif'}" onclick="apf.$debugger.stepNext();" disabled="[$apf_dbg_mdlDebugger::@running]" />
	        	<a:button icon="{this.disabled ? 'stepreturn_co_disabled.gif' : 'stepreturn_co.gif'}" onclick="apf.$debugger.stepOut();" disabled="[$apf_dbg_mdlDebugger::@running]" />
	        </a:bar>
        </a:toolbar>
        
        
        <a:window skin="dockwin" dock="true" align="left-splitter" width="400" visible="true" title="Sources" zindex="9">
	        <a:list
	          id="lstScripts"
	          model="$apf_dbg_mdlScripts"
	          anchors="0 0 0 0"
	          each="[script]"
	          caption="[@text]"
	          onafterselect = "apf.$debugger.changeScript(this.selected)"
	          icon="file_obj.gif">
	        	<a:actions />
	        </a:list>
        </a:window>
          
        <a:window skin="dockwin" dock="true" align="left-splitter" visible="true" title="Stack" zindex="9">
	        <a:datagrid
	          id         = "lstStack"
	          anchors    = "0 0 0 0" 
	          options    = "size|move"
	          caching    = "false"
	          prerender  = "false"
	          model      = "$apf_dbg_mdlStack"
	          onafterselect = "apf.$debugger.changeStackFrame(this.selected)"
	          >
	        	<a:actions />
	            <a:column caption="Function" value="[@name]" width="100%" icon="stckframe_obj.gif" />
	            <a:column caption="Script" value="[@script]" width="100" />
	            <a:column caption="Line" value="[@line]" width="40"/>
	            <a:column caption="Column" value="[@column]" width="40"/>
	            <a:each match="[frame]" />
	        </a:datagrid>    
        </a:window>
        
        <a:window skin="dockwin" dock="true" align="left-splitter" visible="true" title="Watch" zindex="9">
	        <a:datagrid id="dgWatch"
	          anchors    = "0 0 0 0" 
	          options    = "size|move"
	          prerender  = "false"
	          model      = "[{lstStack.selected}::vars]"
	          loading-message = "Calculating..."
	          >
                <a:insert match="[item[@children]]" get="{adbg.loadObjects(%[.])}" />
	            <a:column caption="Property" value="[@name]" width="120" icon="genericvariable_obj.gif" tree="true" />
	            <a:column caption="Value" value="[@value]" width="100%" />
	            <a:column caption="Type" value="[@type]" width="80"/>
	            <a:each match="[item]" sort="[@name]" />
	        </a:datagrid>		
        </a:window>

<!--         <a:window skin="dockwin" dock="true" align="left-splitter" visible="true" title="Breakpoints" zindex="9">
			<a:list
			  id="lstBreakpoints"
			  anchors="0 0 0 0"
			  model="$apf_dbg_mdlBreakpoints"
			  each="[breakpoint]"
			  caption="[@text]"
			  icon="brkp_obj.gif"
			  onafterchoose = "winBreakpointEdit.show();">
			    <a:actions />
			</a:list>
        </a:window> -->
        
        <a:codeeditor id="ce" 
          align       = "right"
          model       = "{lstScripts.selected}"  
          syntax      = "js" 
          readonly    = "true"        
          showinvisibles = "true"
          showprintmargin = "true"
          printmargincolumn = "80"
          ongutterdblclick = "apf.$debugger.toggleBreakPoint([{lstScripts.selected}::@id], event.row)">
            <a:load get="{adbg.loadScript([@id])}"/>
            <a:value value="[text()]" />
        </a:codeeditor>  
        <!-- 
        <a:window skin="dockwin" dock="true" align="right-splitter" height="200" visible="true" title="Console" zindex="9">
        	<a:text anchors="0 0 0 0"></a:text>
        	<a:textbox></a:textbox>
        </a:window>
         -->
        
        <!-- 
        <a:window
          id="winBreakpointEdit"
          title="Breakpoint"
          center="true"
          buttons="close"
          width="410"
          >
          	<a:table columns="150,230" edge="5">
	          	<a:label>Resource:</a:label>
	          	<a:label value="[{lstBreakpoints.selected}::@script]" />
	          	
	          	<a:label>Line Number:</a:label>
	          	<a:label value="[{lstBreakpoints.selected}::@line]" />
	          	
	          	<a:checkbox span="2" checked="[{lstBreakpoints.selected}::@enabled]">Enabled</a:checkbox>
	          	
	          	<a:label for="inpIgnoreCount">Ignore Count:</a:label>
	          	<a:spinner width="230" id="inpIgnoreCount" value="[{lstBreakpoints.selected}::@ignorecount]" min="0" max="10000"/>
	          	
	          	<a:label span="*" for="txtCondition">Condition</a:label>
	          	<a:textarea span="*" height="*" id="txtCondition" value="[{lstBreakpoints.selected}::@condition]" />
          	</a:table>
        </a:window> 
        -->
           
        <a:script>//<!--
            apf.$debugger.init();
        //--></a:script>
    </body>
</html>