<html>
 <head>
     <!--meta http-equiv='X-UA-Compatible' content='IE=EmulateIE7'/-->
    <script LANGUAGE="JavaScript" type="text/javascript" src="apf_stub.js"></script>
    <script LANGUAGE="JavaScript" type="text/javascript" src="../core/lib/util/color.js"></script>
    <script LANGUAGE="JavaScript" type="text/javascript" src="../core/parsers/livemarkup.js"></script>
    <script LANGUAGE="JavaScript" type="text/javascript" src="../core/lib/vector.js"></script>
       
    <script LANGUAGE="JavaScript" type="text/javascript">
    var ctx;
    
    var gravity = 0.0015;
    var friction = 0.99;
    var bounce = .6;
    
    function init(){
        ctx = new apf.vector.vml('drawnode',1880,980,0,0,'white');
        var rects = [];
        for (var i = 0; i < 200; i++) {
            rects.push(new Rect());
        }

        var lastTime = new Date().getTime();
        var __floor = Math.floor;
        window.setInterval(function(){
            var timeDiff = new Date().getTime() - lastTime;
            lastTime += timeDiff;
            
            for (var i = 0, r, l = rects.length; i < l; i++) {
                if ((r=rects[i]).ignore) continue;
                var newX = __floor(r.x + timeDiff*r.dx),
                    newY = __floor(r.y + timeDiff*r.dy);
                
                //waterfall
                if (newY <= 1800) {
                    r.dy += gravity * timeDiff;
                    r.shape.style({
                        x: r.x + timeDiff*r.dx,
                        y: r.y + timeDiff*r.dy
                    });
                }
                else {
                    r.dx = r.startDx;
                    r.dy = r.startDy;
                    newX = r.startX;
                    newY = r.startY;
                }
                // end waterfall

/*
                //bounce against borders
                r.dy += gravity * timeDiff;
                if (newY < 0 || newY > 940) {
                    r.dy *= -bounce * friction;
                    newY = (newY >= 940) ? 940 : 0;
                }
                if (newX < 0 || newX > 1800) {
                    r.dx *= -bounce;
                    newX = (newX >= 1800) ? 1800 : 0;
                }
                else {
                    r.dx *= friction;
                }
                
                if (newY >= 940 && r.dx > -.1 && r.dx < .1 && r.dy > -.1 && r.dy < .1) {
                    r.dy = 0;
                    r.dx = 0;
                    newY = 940;
                    r.ignore = true;
                }
                //end bounce against borders
*/
                r.shape.style({x: r.x=newX, y: r.y=newY});
            }
            
            ctx.repaint();
        },20);
    }
    var colors = ["black", "blue", "red", "green", "yellow"];
    function Rect() {
        this.ignore = false;  // flag for ignoring calculating this shape
        
        this.startX  = Math.ceil(900 + 100*Math.random());
        this.startY  = Math.ceil(150 + 100*Math.random());

        
        this.x  = Math.ceil(900 + 100*Math.random());
        this.y  = Math.ceil(150 + 100*Math.random());

        this.startDx = -2 + 4*Math.random();
        this.startDy = -.5 + 1*Math.random();
        this.dx = this.startDx;
        this.dy = this.startDy;

        this.shape = ctx.rect({
            x: this.x,
            y: this.y,
            w: 10,
            h: 10,
            s: colors[1],
            f: colors[1]
            //s: colors[Math.floor(colors.length*Math.random())],
            //f: colors[Math.floor(colors.length*Math.random())]
        })
        
        return this;
    }
  </script>

 </head>
 <body onload="init()">
    <div id="drawnode" style2="width:300px;height:300px;background-color:black">
    </div>
 </body>
 
	

 </html>
