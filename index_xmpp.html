<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns:j="http://www.javeline.com/2005/PlatForm" xmlns="http://www.w3.org/1999/xhtml" debug="true">
	<head>
		<script src="jpf.js"></script>
        <script src="loader.js"></script>
        <script type="text/javascript">
            function doLogin() {
                myXMPP.connect(document.getElementById('username').value,
                    document.getElementById('password').value);
            }
            
            function sendMessage(oText) {
                var oMsg = document.getElementById('messagebox');
                myXMPP.sendMessage(null, oMsg.value);
                oMsg.value = "";
            }
        </script>
        <style type="text/css">
            #message_log {
                border: 1px solid silver;
                font-family: "Lucida Console", Sans Serif;
                padding: 8px;
                color: green;
                background: #333;
                height: 250px;
                width: 250px;
            }
            
            .loginform {
                width: 250px;
                border: 1px solid silver;
            }
        </style>
	</head>
	<body>
		<j:skin src="skins/skins.xml" />
        
        <j:appsettings debug="true" debug-teleport="true" allow-select="true"  />
		
		<j:teleport>
			<!-- <j:xmpp id="myXMPP" url="http://chatslave4.hyves.org:5222/http-poll" roster-model="myRoster" -->
            <j:xmpp id="myXMPP" url="http://javeline.com:5280/http-bind" roster-model="myRoster"
             connection="bosh"
             onconnected="alert('yay')"
             onconnectfailed="alert('boohoo')"
             onauthfailure="alert('AUTHFAILURE')"
             onconnectionlost="alert('connection lost!')"
             onreconnecting="alert('attempting to restore connection')" />
		</j:teleport>
        
        <j:remote transport="myXMPP" id="rmtPersons">
            <j:person unique="@id" />
        </j:remote>
        
        <j:model id="mdlPersons" remote="rmtPersons" submission="rpc:comm.savePerson(xpath:.)">
            <persons>
                <person id="1">mike</person>
                <person id="2">ruben</person>
            </persons>
        </j:model>
        
        <j:list model="myRoster" width="200" height="100">
            <j:bindings>
                <j:traverse select="user" />
                <j:caption>{@node}@{@domain}</j:caption>
                <j:icon value="icoUsers.gif" />
            </j:bindings>
        </j:list>
        
        <j:list id="lstPersons" model="mdlPersons" width="200" height="100">
            <j:bindings>
                <j:traverse select="person" />
                <j:caption select="text()" />
                <j:icon value="icoUsers.gif" />
            </j:bindings>
            <j:actions>
                <j:remove set="rpc:comm.removePerson(xpath:@id)" />
                <j:rename set="rpc:comm.updatePerson(xpath:@id, 'name', xpath:@name)" />
            </j:actions>
        </j:list>
        
        <j:button onclick="lstPersons.rename(lstPersons.selected, 'test' + Math.round(Math.random()*100));">Rename</j:button>

		<j:button onclick="jpf.XMLDatabase.setAttribute(lstPersons.selected, 'id', 'test' + Math.round(Math.random()*100));">Change Attr</j:button>
		<j:button onclick="lstPersons.add('&lt;person&gt;new person&lt;/person&gt;')">Add</j:button>
        
        <input type="text" class="loginform" id="username" value="mike" />
        <br/>
        <input type="password" class="loginform" id="password" value="open" />
        <br/><br/>
        <button onclick="doLogin()">Login</button>
        <br/><br/>
        
        <div id="message_log"></div>
        
        <br/>
        <input type="text" class="loginform" id="messagebox" value="Type a message and click Send" />
        <br/><br/>
        <button onclick="sendMessage()">Send</button>
        <br/><br/>
		
		<j:script><![CDATA[
            jpf.debugwin.activate();
		]]></j:script>
	</body>
</html>